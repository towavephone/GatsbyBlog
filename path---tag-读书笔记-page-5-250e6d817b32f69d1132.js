webpackJsonp([92917171071317],{1625:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"基础概念 背景 WebGL 经常被当成 3D API，人们总想“我可以使用 WebGL 和一些神奇的东西做出炫酷的 3D 作品”。事实上 WebGL 仅仅是一个光栅化引擎，它可以根据你的代码绘制出点，线和三角形。想要利用 WebGL 完成更复杂任务，取决于你能否提供合适的代码，组合使用点，线和三角形代替实现。 WebGL 在电脑的 GPU 中运行。因此你需要使用能够在 GPU 上运行的代码。这样的代码需要提供成对的方法。每对方法中一个叫顶点着色器，另一个叫片断着色器，并且使用一种和 C 或 C…",html:'<h1 id="基础概念"><a href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基础概念</h1>\n<h2 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h2>\n<p>WebGL 经常被当成 3D API，人们总想“我可以使用 WebGL 和一些神奇的东西做出炫酷的 3D 作品”。事实上 WebGL 仅仅是一个光栅化引擎，它可以根据你的代码绘制出点，线和三角形。想要利用 WebGL 完成更复杂任务，取决于你能否提供合适的代码，组合使用点，线和三角形代替实现。</p>\n<p>WebGL 在电脑的 GPU 中运行。因此你需要使用能够在 GPU 上运行的代码。这样的代码需要提供成对的方法。每对方法中一个叫顶点着色器，另一个叫片断着色器，并且使用一种和 C 或 C++ 类似的强类型的语言 GLSL（GL 着色语言），每一对组合起来称作一个 program（着色程序）。</p>\n<p>顶点着色器的作用是计算顶点的位置。根据计算出的一系列顶点位置，WebGL 可以对点，线和三角形在内的一些图元进行光栅化处理。当对这些图元进行光栅化处理时需要使用片断着色器方法。片断着色器的作用是计算出当前绘制图元中每个像素的颜色值。</p>\n<p>几乎整个 WebGL API 都是关于如何设置这些成对方法的状态值以及运行它们。对于想要绘制的每一个对象，都需要先设置一系列状态值，然后通过调用 gl.drawArrays 或 gl.drawElements 运行一个着色方法对，使得你的着色器对能够在 GPU 上运行。</p>\n<p>这些方法对所需的任何数据都需要发送到 GPU，这里有着色器获取数据的 4 种方法。</p>\n<h3 id="属性（attributes）和缓冲"><a href="#%E5%B1%9E%E6%80%A7%EF%BC%88attributes%EF%BC%89%E5%92%8C%E7%BC%93%E5%86%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>属性（Attributes）和缓冲</h3>\n<p>缓冲是发送到 GPU 的一些二进制数据序列，通常情况下缓冲数据包括位置，法向量，纹理坐标，顶点颜色值等。你可以存储任何数据。</p>\n<p>属性用来指明怎么从缓冲中获取所需数据并将它提供给顶点着色器。例如你可能在缓冲中用三个 32 位的浮点型数据存储一个位置值。对于一个确切的属性你需要告诉它从哪个缓冲中获取数据，获取什么类型的数据（三个 32 位的浮点数据），起始偏移值是多少，到下一个位置的字节数是多少。</p>\n<p>缓冲不是随意读取的。事实上顶点着色器运行的次数是一个指定的确切数字，每一次运行属性会从指定的缓冲中按照指定规则依次获取下一个值。</p>\n<h3 id="全局变量（uniforms）"><a href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%EF%BC%88uniforms%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>全局变量（Uniforms）</h3>\n<p>全局变量在着色程序运行前赋值，在运行过程中全局有效。</p>\n<h3 id="纹理（textures）"><a href="#%E7%BA%B9%E7%90%86%EF%BC%88textures%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>纹理（Textures）</h3>\n<p>纹理是一个数据序列，可以在着色程序运行中随意读取其中的数据。大多数情况存放的是图像数据，但是纹理仅仅是数据序列，你也可以随意存放除了颜色数据以外的其它数据。</p>\n<h3 id="可变量（varyings）"><a href="#%E5%8F%AF%E5%8F%98%E9%87%8F%EF%BC%88varyings%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可变量（Varyings）</h3>\n<p>可变量是一种顶点着色器给片断着色器传值的方式，依照渲染的图元是点，线还是三角形，顶点着色器中设置的可变量会在片断着色器运行中获取不同的插值。</p>\n<h2 id="hello-world"><a href="#hello-world" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hello World</h2>\n<p>WebGL 只关心两件事：裁剪空间中的坐标值和颜色值。使用 WebGL 只需要给它提供这两个东西。你需要提供两个着色器来做这两件事，一个顶点着色器提供裁剪空间坐标值，一个片断着色器提供颜色值。</p>\n<p>无论你的画布有多大，裁剪空间的坐标范围永远是 -1 到 1。这里有一个简单的 WebGL 例子展示 WebGL 的简单用法。</p>\n<p>让我们从顶点着色器开始</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38710004942471170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 一个属性值，将会从缓冲中获取数据\nattribute vec4 a_position;\n\n// 所有着色器都有一个 main 方法\nvoid main() {\n\n  // gl_Position 是一个顶点着色器主要设置的变量\n  gl_Position = a_position;\n}`, `38710004942471170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 一个属性值，将会从缓冲中获取数据</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n\n<span class="token comment">// 所有着色器都有一个 main 方法</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n  <span class="token comment">// gl_Position 是一个顶点着色器主要设置的变量</span>\n  gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果用 JavaScript 代替 GLSL，当它运行的时候，你可以想象它做了类似以下的事情</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50448689063252110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 伪代码\nvar positionBuffer = [0, 0, 0, 0, 0, 0.5, 0, 0, 0.7, 0, 0, 0];\nvar attributes = {};\nvar gl_Position;\n\nfunction drawArrays(_, offset, count) {\n  var stride = 4;\n  var size = 4;\n  for (var i = 0; i < count; ++i) {\n    // 从 positionBuffer 复制接下来 4 个值给 a_position 属性\n    const start = offset + i * stride;\n    attributes.a_position = positionBuffer.slice(start, start + size);\n    runVertexShader(); // 运行顶点着色器\n    // ...\n    doSomethingWith_gl_Position();\n  }\n}`, `50448689063252110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 伪代码</span>\n<span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> attributes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> gl_Position<span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">drawArrays</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 从 positionBuffer 复制接下来 4 个值给 a_position 属性</span>\n    <span class="token keyword">const</span> start <span class="token operator">=</span> offset <span class="token operator">+</span> i <span class="token operator">*</span> stride<span class="token punctuation">;</span>\n    attributes<span class="token punctuation">.</span>a_position <span class="token operator">=</span> positionBuffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> start <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">runVertexShader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 运行顶点着色器</span>\n    <span class="token comment">// ...</span>\n    <span class="token function">doSomethingWith_gl_Position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际情况没有那么简单，因为 positionBuffer 将会被转换成二进制数据（见下文），所以真实情况下从缓冲中读取数据有些麻烦，但是希望这个例子能够让你想象出顶点着色器是怎么执行的。</p>\n<p>接下来我们需要一个片断着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37296530705283645000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 片断着色器没有默认精度，所以我们需要设置一个精度\n// mediump 是一个不错的默认值，代表 medium precision（中等精度）\nprecision mediump float;\n\nvoid main() {\n  // gl_FragColor 是一个片断着色器主要设置的变量\n  gl_FragColor = vec4(1, 0, 0.5, 1); // 返回“红紫色”\n}`, `37296530705283645000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 片断着色器没有默认精度，所以我们需要设置一个精度</span>\n<span class="token comment">// mediump 是一个不错的默认值，代表 medium precision（中等精度）</span>\n<span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// gl_FragColor 是一个片断着色器主要设置的变量</span>\n  gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回“红紫色”</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上方我们设置 gl_FragColor 为 <code class="language-text">1, 0, 0.5, 1</code>，其中 1 代表红色值，0 代表绿色值，0.5 代表蓝色值，最后一个 1 表示阿尔法通道值。WebGL 中的颜色值范围从 0 到 1 。</p>\n<p>现在我们有了两个着色器方法，让我们开始使用 WebGL 吧</p>\n<p>首先我们需要一个 HTML 中的 canvas（画布）对象</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4614592894942038000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<canvas id=&quot;c&quot;></canvas>`, `4614592894942038000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后可以用 JavaScript 获取它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46503605492181290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var canvas = document.querySelector(\'#c\');`, `46503605492181290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们创建一个 WebGL 渲染上下文（WebGLRenderingContext）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26846567356870255000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var gl = canvas.getContext(\'webgl\');\nif (!gl) {\n  // 你不能使用 WebGL！\n  // ...\n}`, `26846567356870255000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 你不能使用 WebGL！</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们需要编译着色器对然后提交到 GPU，先让我们通过字符串获取它们。 你可以利用 JavaScript 中创建字符串的方式创建 GLSL 字符串：用串联的方式（concatenating），用 AJAX 下载，用多行模板数据。或者在这个例子里，将它们放在非 JavaScript 类型的标签中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14067771585853061000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;notjs&quot;>\n\n  // 一个属性变量，将会从缓冲中获取数据\n  attribute vec4 a_position;\n\n  // 所有着色器都有一个 main 方法\n  void main() {\n\n    // gl_Position 是一个顶点着色器主要设置的变量\n    gl_Position = a_position;\n  }\n</script>\n\n<script id=&quot;fragment-shader-2d&quot; type=&quot;notjs&quot;>\n\n  // 片断着色器没有默认精度，所以我们需要设置一个精度\n  // mediump 是一个不错的默认值，代表 medium precision（中等精度）\n  precision mediump float;\n\n  void main() {\n    // gl_FragColor 是一个片断着色器主要设置的变量\n    gl_FragColor = vec4(1, 0, 0.5, 1); // 返回“红紫色”\n  }\n</script>`, `14067771585853061000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n  <span class="token comment">// 一个属性变量，将会从缓冲中获取数据</span>\n  attribute vec4 a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 所有着色器都有一个 main 方法</span>\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n    <span class="token comment">// gl_Position 是一个顶点着色器主要设置的变量</span>\n    gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n  <span class="token comment">// 片断着色器没有默认精度，所以我们需要设置一个精度</span>\n  <span class="token comment">// mediump 是一个不错的默认值，代表 medium precision（中等精度）</span>\n  precision mediump float<span class="token punctuation">;</span>\n\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// gl_FragColor 是一个片断着色器主要设置的变量</span>\n    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回“红紫色”</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>事实上，大多数三维引擎在运行时利用模板，串联等方式创建 GLSL。对于这个网站上的例子来说，没有复杂到要在运行时创建 GLSL 的程度。</p>\n<p>接下来我们使用的方法将会创建一个着色器，只需要上传 GLSL 数据，然后编译成着色器。你可能注意到这段代码没有任何注释，因为可以从方法名很清楚的了解方法的作用（这里作为翻译版本我还是稍微注释一下）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42127698304447510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建着色器方法，输入参数：渲染上下文，着色器类型，数据源\nfunction createShader(gl, type, source) {\n  var shader = gl.createShader(type); // 创建着色器对象\n  gl.shaderSource(shader, source); // 提供数据源\n  gl.compileShader(shader); // 编译 -> 生成着色器\n  var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (success) {\n    return shader;\n  }\n\n  console.log(gl.getShaderInfoLog(shader));\n  gl.deleteShader(shader);\n}`, `42127698304447510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建着色器方法，输入参数：渲染上下文，着色器类型，数据源</span>\n<span class="token keyword">function</span> <span class="token function">createShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建着色器对象</span>\n  gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提供数据源</span>\n  gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 编译 -> 生成着色器</span>\n  <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getShaderParameter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COMPILE_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> shader<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getShaderInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们可以使用以上方法创建两个着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65348343250313110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var vertexShaderSource = document.querySelector(\'#vertex-shader-2d\').text;\nvar fragmentShaderSource = document.querySelector(\'#fragment-shader-2d\').text;\n\nvar vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);\nvar fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);`, `65348343250313110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> vertexShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#vertex-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n<span class="token keyword">var</span> fragmentShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#fragment-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> vertexShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vertexShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> fragmentShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fragmentShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后我们将这两个着色器 link（链接）到一个 program（着色程序）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61166129850564534000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function createProgram(gl, vertexShader, fragmentShader) {\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader); // 添加顶点着色器\n  gl.attachShader(program, fragmentShader); // 添加片元着色器\n  gl.linkProgram(program); // 连接 program 中的着色器\n  var success = gl.getProgramParameter(program, gl.LINK_STATUS);\n  if (success) {\n    return program;\n  }\n\n  console.log(gl.getProgramInfoLog(program));\n  gl.deleteProgram(program);\n}`, `61166129850564534000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加顶点着色器</span>\n  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加片元着色器</span>\n  gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 连接 program 中的着色器</span>\n  <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getProgramParameter</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINK_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> program<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getProgramInfoLog</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">deleteProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后调用它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97106301636610100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var program = createProgram(gl, vertexShader, fragmentShader);`, `97106301636610100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们已经在 GPU 上创建了一个 GLSL 着色程序，我们还需要给它提供数据。WebGL 的主要任务就是设置好状态并为 GLSL 着色程序提供数据。在这个例子中 GLSL 着色程序的唯一输入是一个属性值 a_position。我们要做的第一件事就是从刚才创建的 GLSL 着色程序中找到这个属性值所在的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60537585401307800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positionAttributeLocation = gl.getAttribLocation(program, \'a_position\');`, `60537585401307800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>寻找属性值位置（和全局属性位置）应该在初始化的时候完成，而不是在渲染循环中。</p>\n<p>属性值从缓冲中获取数据，所以我们创建一个缓冲</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89686552143240200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positionBuffer = gl.createBuffer();`, `89686552143240200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>WebGL 可以通过绑定点操控全局范围内的许多数据，你可以把绑定点想象成一个 WebGL 内部的全局变量。首先绑定一个数据源到绑定点，然后可以引用绑定点指向该数据源。所以让我们来绑定位置信息缓冲（下面的绑定点就是 ARRAY_BUFFER）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32345974826220147000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);`, `32345974826220147000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们需要通过绑定点向缓冲中存放数据</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29068697818469302000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 三个二维点坐标\nvar positions = [0, 0, 0, 0.5, 0.7, 0];\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);`, `29068697818469302000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 三个二维点坐标</span>\n<span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这里完成了一系列事情，第一件事是我们有了一个 JavaScript 序列 positions。然而 WebGL 需要强类型数据，所以 <code class="language-text">new Float32Array(positions)</code> 创建了 32 位浮点型数据序列，并从 positions 中复制数据到序列中，然后 gl.bufferData 复制这些数据到 GPU 的 positionBuffer 对象上。它最终传递到 positionBuffer 上是因为在前一步中我们我们将它绑定到了 ARRAY_BUFFER（也就是绑定点）上。</p>\n<p>最后一个参数 <code class="language-text">gl.STATIC_DRAW</code> 是提示 WebGL 我们将怎么使用这些数据。WebGL 会根据提示做出一些优化。<code class="language-text">gl.STATIC_DRAW</code> 提示 WebGL 我们不会经常改变这些数据。</p>\n<p>在此之上的代码是初始化代码。这些代码在页面加载时只会运行一次。接下来的代码是渲染代码，而这些代码将在我们每次要渲染或者绘制时执行。</p>\n<h2 id="渲染"><a href="#%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染</h2>\n<p>在绘制之前我们应该调整画布（canvas）的尺寸以匹配它的显示尺寸。画布就像图片一样有两个尺寸。一个是它拥有的实际像素个数，另一个是它显示的大小。CSS 决定画布显示的大小。你应该尽可能用 CSS 设置所需画布大小，因为它比其它方式灵活的多。</p>\n<p>这里的例子中，有独立窗口显示的示例大多使用 400x300 像素大小的画布。但是如果像稍后展示的示例那样嵌在页面中，它就会被拉伸以填满可用空间。通过使用 CSS 调整画布尺寸可以轻松处理这些情况。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60839531944568190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`webglUtils.resizeCanvasToDisplaySize(gl.canvas);`, `60839531944568190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们需要告诉 WebGL 怎样把提供的 gl_Position 裁剪空间坐标对应到画布像素坐标，通常我们也把画布像素坐标叫做屏幕空间。为了实现这个目的，我们只需要调用 gl.viewport 方法并传递画布的当前尺寸。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95544082882132720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);`, `95544082882132720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这样就告诉 WebGL 裁剪空间的 -1 -> +1 分别对应到 x 轴的 0 -> gl.canvas.width 和 y 轴的 0 -> gl.canvas.height。</p>\n<p>我们用 <code class="language-text">0, 0, 0, 0</code> 清空画布，分别对应 r, g, b, alpha（红，绿，蓝，阿尔法）值，所以在这个例子中我们让画布变透明了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46985850877135960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 清空画布\ngl.clearColor(0, 0, 0, 0);\ngl.clear(gl.COLOR_BUFFER_BIT);`, `46985850877135960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 清空画布</span>\ngl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>我们需要告诉 WebGL 运行哪个着色程序</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50659954564406436000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 告诉它用我们之前写好的着色程序（一个着色器对）\ngl.useProgram(program);`, `50659954564406436000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 告诉它用我们之前写好的着色程序（一个着色器对）</span>\ngl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>接下来我们需要告诉 WebGL 怎么从我们之前准备的缓冲中获取数据给着色器中的属性。首先我们需要启用对应属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59547262890224650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enableVertexAttribArray(positionAttributeLocation);`, `59547262890224650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后指定从缓冲中读取数据的方式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60249203661488110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 将绑定点绑定到缓冲数据（positionBuffer）\ngl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n\n// 告诉属性怎么从 positionBuffer 中读取数据 (ARRAY_BUFFER)\nvar size = 2; // 每次迭代运行提取两个单位数据\nvar type = gl.FLOAT; // 每个单位的数据类型是 32 位浮点型\nvar normalize = false; // 不需要归一化数据\nvar stride = 0; // 0 = 移动单位数量 * 每个单位占用内存（sizeof(type)）\n// 每次迭代运行运动多少内存到下一个数据开始点\nvar offset = 0; // 从缓冲起始位置开始读取\ngl.vertexAttribPointer(positionAttributeLocation, size, type, normalize, stride, offset);`, `60249203661488110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 将绑定点绑定到缓冲数据（positionBuffer）</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉属性怎么从 positionBuffer 中读取数据 (ARRAY_BUFFER)</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代运行提取两个单位数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 每个单位的数据类型是 32 位浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不需要归一化数据</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动单位数量 * 每个单位占用内存（sizeof(type)）</span>\n<span class="token comment">// 每次迭代运行运动多少内存到下一个数据开始点</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从缓冲起始位置开始读取</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一个隐藏信息是 <code class="language-text">gl.vertexAttribPointer</code> 是将属性绑定到当前的 <code class="language-text">ARRAY_BUFFER</code>。换句话说就是属性绑定到了 positionBuffer 上。这也意味着现在利用绑定点随意将 <code class="language-text">ARRAY_BUFFER</code> 绑定到其它数据上后，该属性依然从 positionBuffer 上读取数据。</p>\n<p>从 GLSL 的顶点着色器中注意到 a_position 属性的数据类型是 vec4</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79374827833865180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;`, `79374827833865180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">attribute vec4 a_position;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>vec4 是一个有四个浮点数据的数据类型。在 JavaScript 中你可以把它想象成 <code class="language-text">a_position = {x: 0, y: 0, z: 0, w: 0}</code>。之前我们设置的 size = 2， 属性默认值是 <code class="language-text">0, 0, 0, 1</code>，然后属性将会从缓冲中获取前两个值（ x 和 y ）。z 和 w 还是默认值 0 和 1 。</p>\n<p>我们终于可以让 WebGL 运行我们的 GLSL 着色程序了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30712567223889908000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 3;\ngl.drawArrays(primitiveType, offset, count);`, `30712567223889908000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为 count = 3，所以顶点着色器将运行三次。第一次运行将会从位置缓冲中读取前两个值赋给属性值 <code class="language-text">a_position.x</code> 和 <code class="language-text">a_position.y</code>。第二次运行 <code class="language-text">a_position.x</code> 和 <code class="language-text">a_position.y</code> 将会被赋予后两个值，最后一次运行将被赋予最后两个值。</p>\n<p>因为我们设置 primitiveType（图元类型）为 <code class="language-text">gl.TRIANGLES</code>（三角形），顶点着色器每运行三次 WebGL 将会根据三个 gl_Position 值绘制一个三角形，不论我们的画布大小是多少，在裁剪空间中每个方向的坐标范围都是 -1 到 1。</p>\n<p>由于我们的顶点着色器仅仅是传递位置缓冲中的值给 gl_Position，所以三角形在裁剪空间中的坐标如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91533746930048200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`0, 0,\n0, 0.5,\n0.7, 0,`, `91533746930048200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">0, 0,\n0, 0.5,\n0.7, 0,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>WebGL 将会把它们从裁剪空间转换到屏幕空间并在屏幕空间绘制一个三角形，如果画布大小是 400×300 我们会得到类似以下的转换</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72810508126957800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(` 裁剪空间            屏幕空间\n   0, 0       ->   200, 150\n   0, 0.5     ->   200, 225\n 0.7, 0       ->   340, 150`, `72810508126957800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text"> 裁剪空间            屏幕空间\n   0, 0       -&gt;   200, 150\n   0, 0.5     -&gt;   200, 225\n 0.7, 0       -&gt;   340, 150</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在 WebGL 将渲染出这个三角形。绘制每个像素时 WebGL 都将调用我们的片断着色器。我们的片断着色器只是简单设置 gl_FragColor 为 <code class="language-text">1, 0, 0.5, 1</code>， 由于画布的每个通道宽度为 8 位，这表示 WebGL 最终在画布上绘制<code class="language-text">[255, 0, 127, 255]</code>。</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-triangle.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// an attribute will receive data from a buffer</span>\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      <span class="token comment">// all shaders have a main function</span>\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n        <span class="token comment">// gl_Position is a special variable a vertex shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// fragment shaders don\'t have a default precision so we need</span>\n      <span class="token comment">// to pick one. mediump is a good default</span>\n      precision mediump float<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// gl_FragColor is a special variable a fragment shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return redish-purple</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">function</span> <span class="token function">createShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getShaderParameter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COMPILE_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> shader<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getShaderInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getProgramParameter</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINK_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> program<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getProgramInfoLog</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">deleteProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Get the strings for our GLSL shaders</span>\n        <span class="token keyword">var</span> vertexShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#vertex-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> fragmentShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#fragment-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n\n        <span class="token comment">// create GLSL shaders, upload the GLSL source, compile the shaders</span>\n        <span class="token keyword">var</span> vertexShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vertexShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> fragmentShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fragmentShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Link the two shaders into a program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer and put three 2d clip space points in it</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// code above this line is initialization code.</span>\n        <span class="token comment">// code below this line is rendering code.</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw</span>\n        <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>在上例中可以发现顶点着色器只是简单的传递了位置信息。由于位置数据坐标就是裁剪空间中的坐标，所以顶点着色器没有做什么特别的事。如果你想做三维渲染，你需要提供合适的着色器将三维坐标转换到裁剪空间坐标，因为 WebGL 只是一个光栅化 API。</p>\n<p>你可能会好奇为什么这个三角形从中间开始然后朝向右上方。裁剪空间的 x 坐标范围是 -1 到 +1. 这就意味着 0 在中间并且正值在它右边。</p>\n<p>至于它为什么在上方，是因为裁剪空间中 -1 是最底端 +1 是最顶端，这也意味值 0 在中间，正值在上方。</p>\n<p>对于描述二维空间中的物体，比起裁剪空间坐标你可能更希望使用屏幕像素坐标。所以我们来改造一下顶点着色器，让我们提供给它像素坐标而不是裁剪空间坐标。这是我们新的顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31737237632451666000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;notjs&quot;>\n  // attribute vec4 a_position;\n  attribute vec2 a_position;\n\n  uniform vec2 u_resolution;\n\n  void main() {\n    // 从像素坐标转换到 0.0 到 1.0\n    vec2 zeroToOne = a_position / u_resolution;\n\n    // 再把 0->1 转换 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n\n    // 把 0->2 转换到 -1->+1 (裁剪空间)\n    vec2 clipSpace = zeroToTwo - 1.0;\n\n    gl_Position = vec4(clipSpace, 0, 1);\n  }\n</script>`, `31737237632451666000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  <span class="token comment">// attribute vec4 a_position;</span>\n  attribute vec2 a_position<span class="token punctuation">;</span>\n\n  uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 从像素坐标转换到 0.0 到 1.0</span>\n    vec2 zeroToOne <span class="token operator">=</span> a_position <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n    <span class="token comment">// 再把 0->1 转换 0->2</span>\n    vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 把 0->2 转换到 -1->+1 (裁剪空间)</span>\n    vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里有些变化需要注意，我们将 a_position 改成 vec2 类型是因为我们只需要用 x 和 y 值。vec2 和 vec4 有些类似但是仅有 x 和 y 值。</p>\n<p>接着我们添加了一个 uniform（全局变量）叫做 u_resolution，为了设置它的值我们需要找到它的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91466222121915580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var resolutionUniformLocation = gl.getUniformLocation(program, \'u_resolution\');`, `91466222121915580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其余变化的应该能从注释中理解。通过设置 u_resolution 为画布的分辨率，着色器将会从 positionBuffer 中获取像素坐标将之转换为对应的裁剪空间坐标。</p>\n<p>现在我们可以将位置信息转换为像素坐标。这次我们将通过绘制两个三角形来绘制一个矩形，每个三角形有三个点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3416090286609208000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positions = [10, 20, 80, 20, 10, 30, 10, 30, 80, 20, 80, 30];\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);`, `3416090286609208000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>在我们设置好使用这个着色程序后，可以设置刚才创建的全局变量的值。gl.useProgram 就与之前讲到的 gl.bindBuffer 相似，设置当前使用的着色程序。之后所有类似 gl.uniformXXX 格式的方法都是设置当前着色程序的全局变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23064525408726500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.useProgram(program);\n\n// ...\n\n// 设置全局变量分辨率\ngl.uniform2f(resolutionUniformLocation, gl.canvas.width, gl.canvas.height);`, `23064525408726500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 设置全局变量分辨率</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>显然我们需要告诉 WebGL 要运行六次顶点着色器来画两个三角形。所以我们将 count 改成 6。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59796482809808650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制\nvar primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 6;\ngl.drawArrays(primitiveType, offset, count);`, `59796482809808650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制</span>\n<span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-two-triangle.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// convert the position from pixels to 0.0 to 1.0</span>\n         vec2 zeroToOne <span class="token operator">=</span> a_position<span class="token punctuation">.</span>xy <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->1 to 0->2</span>\n         vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->2 to -1->+1 (clipspace)</span>\n         vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n         gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// fragment shaders don\'t have a default precision so we need</span>\n      <span class="token comment">// to pick one. mediump is a good default</span>\n      precision mediump float<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// gl_FragColor is a special variable a fragment shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return redish-purple</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Use our boilerplate utils to compile the shaders and link into a program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> webglUtils<span class="token punctuation">.</span><span class="token function">createProgramFromScripts</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'vertex-shader-2d\'</span><span class="token punctuation">,</span> <span class="token string">\'fragment-shader-2d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up uniform locations</span>\n        <span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer to put three 2d clip space points in</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// set the resolution</span>\n        gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw</span>\n        <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>你可能注意到矩形在区域左下角，WebGL 认为左下角是 0，0。想要像传统二维 API 那样起点在左上角，我们只需翻转 y 轴即可。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90620346819210200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);`, `90620346819210200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在矩形在我们期望的位置了</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-two-triangle-revert.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// convert the position from pixels to 0.0 to 1.0</span>\n         vec2 zeroToOne <span class="token operator">=</span> a_position<span class="token punctuation">.</span>xy <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->1 to 0->2</span>\n         vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->2 to -1->+1 (clipspace)</span>\n         vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n         gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// fragment shaders don\'t have a default precision so we need</span>\n      <span class="token comment">// to pick one. mediump is a good default</span>\n      precision mediump float<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// gl_FragColor is a special variable a fragment shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return redish-purple</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Use our boilerplate utils to compile the shaders and link into a program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> webglUtils<span class="token punctuation">.</span><span class="token function">createProgramFromScripts</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'vertex-shader-2d\'</span><span class="token punctuation">,</span> <span class="token string">\'fragment-shader-2d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up uniform locations</span>\n        <span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer to put three 2d clip space points in</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// set the resolution</span>\n        gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw</span>\n        <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>让我们来定义一个可以生成矩形的方法，这样我们就可以调用它定义形状不一的多个矩形。同时我们需要矩形的颜色是可设置的。</p>\n<p>首先我们定义一个片断着色器，可以通过全局变量接收自定义颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93420783984810080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;notjs&quot;>\n  precision mediump float;\n\n  uniform vec4 u_color;\n\n  void main() {\n    gl_FragColor = u_color;\n  }\n</script>`, `93420783984810080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  precision mediump float<span class="token punctuation">;</span>\n\n  uniform vec4 u_color<span class="token punctuation">;</span>\n\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里是一段新代码，可以随机绘制 50 个随机位置，随机大小，随机颜色的矩形。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80948878002910410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var colorUniformLocation = gl.getUniformLocation(program, \'u_color\');\n{\n  // ...\n  // 绘制 50 个随机颜色矩形\n  for (var ii = 0; ii < 50; ++ii) {\n    // 创建一个随机矩形并将写入位置缓冲\n    // 因为位置缓冲是我们绑定在 ARRAY_BUFFER 绑定点上的最后一个缓冲\n    setRectangle(gl, randomInt(300), randomInt(300), randomInt(300), randomInt(300));\n\n    // 设置一个随机颜色\n    gl.uniform4f(colorUniformLocation, Math.random(), Math.random(), Math.random(), 1);\n\n    // 绘制矩形\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}\n\n// 返回 0 到 range 范围内的随机整数\nfunction randomInt(range) {\n  return Math.floor(Math.random() * range);\n}\n\n// 用参数生成矩形顶点并写进缓冲\nfunction setRectangle(gl, x, y, width, height) {\n  var x1 = x;\n  var x2 = x + width;\n  var y1 = y;\n  var y2 = y + height;\n\n  // 注意: gl.bufferData(gl.ARRAY_BUFFER, ...) 将会影响到当前绑定点 ARRAY_BUFFER 的绑定缓冲\n  // 目前我们只有一个缓冲，如果我们有多个缓冲，我们需要先将所需缓冲绑定到 ARRAY_BUFFER\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), gl.STATIC_DRAW);\n}`, `80948878002910410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> colorUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 绘制 50 个随机颜色矩形</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 创建一个随机矩形并将写入位置缓冲</span>\n    <span class="token comment">// 因为位置缓冲是我们绑定在 ARRAY_BUFFER 绑定点上的最后一个缓冲</span>\n    <span class="token function">setRectangle</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 设置一个随机颜色</span>\n    gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>colorUniformLocation<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 绘制矩形</span>\n    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 返回 0 到 range 范围内的随机整数</span>\n<span class="token keyword">function</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token parameter">range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 用参数生成矩形顶点并写进缓冲</span>\n<span class="token keyword">function</span> <span class="token function">setRectangle</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> x1 <span class="token operator">=</span> x<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> x2 <span class="token operator">=</span> x <span class="token operator">+</span> width<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y1 <span class="token operator">=</span> y<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y2 <span class="token operator">=</span> y <span class="token operator">+</span> height<span class="token punctuation">;</span>\n\n  <span class="token comment">// 注意: gl.bufferData(gl.ARRAY_BUFFER, ...) 将会影响到当前绑定点 ARRAY_BUFFER 的绑定缓冲</span>\n  <span class="token comment">// 目前我们只有一个缓冲，如果我们有多个缓冲，我们需要先将所需缓冲绑定到 ARRAY_BUFFER</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里是 50 个矩形。</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-many-triangle.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// convert the position from pixels to 0.0 to 1.0</span>\n         vec2 zeroToOne <span class="token operator">=</span> a_position<span class="token punctuation">.</span>xy <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->1 to 0->2</span>\n         vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->2 to -1->+1 (clipspace)</span>\n         vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n         gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      precision mediump float<span class="token punctuation">;</span>\n\n      uniform vec4 u_color<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token comment">/** @type {HTMLCanvasElement} */</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// setup GLSL program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> webglUtils<span class="token punctuation">.</span><span class="token function">createProgramFromScripts</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'vertex-shader-2d\'</span><span class="token punctuation">,</span> <span class="token string">\'fragment-shader-2d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up uniform locations</span>\n        <span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> colorUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer to put three 2d clip space points in</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// set the resolution</span>\n        gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw 50 random rectangles in random colors</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// Setup a random rectangle</span>\n          <span class="token comment">// This will write to positionBuffer because</span>\n          <span class="token comment">// its the last thing we bound on the ARRAY_BUFFER</span>\n          <span class="token comment">// bind point</span>\n          <span class="token function">setRectangle</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token comment">// Set a random color.</span>\n          gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>colorUniformLocation<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token comment">// Draw the rectangle.</span>\n          <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n          <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n          <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\n          gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// Returns a random integer from 0 to range - 1.</span>\n      <span class="token keyword">function</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token parameter">range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// Fill the buffer with the values that define a rectangle.</span>\n      <span class="token keyword">function</span> <span class="token function">setRectangle</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> x1 <span class="token operator">=</span> x<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> x2 <span class="token operator">=</span> x <span class="token operator">+</span> width<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> y1 <span class="token operator">=</span> y<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> y2 <span class="token operator">=</span> y <span class="token operator">+</span> height<span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n          gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n          <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>WebGL 其实是一个非常简单的 API。好吧，“简单”可能是一个不恰当的描述。它做的是一件简单的事，它仅仅运行用户提供的两个方法，一个顶点着色器和一个片断着色器，去绘制点，线和三角形。虽然做三维可以变得很复杂，但是这种复杂只是作为程序员的你，是一种复杂形式的“着色器”。WebGL API 只做光栅化处理并且在概念上十分容易理解。</p>\n<p>我们简单的示例向你展示了怎么给属性和两个全局变量提供数据。它和多个属性以及多个全局变量的原理一致。在这篇文章的开始部分，我们还提到了 varyings（可变量）和 textures（纹理），这些将会在随后的课程中出现。</p>\n<p>上例中用 setRectangle 更新缓冲数据的方式在大多数程序中并不常见。我这么用只是因为在这个例子中，为了解释 GLSL 接收像素坐标并通过少量数学运算得到期望结果，这可能是最简单的方式，不是常规做法。</p>\n<h1 id="工作原理"><a href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工作原理</h1>\n<p>在继续学习之前，我们需要探讨一下 WebGL 在 GPU 上究竟做了什么。WebGL 在 GPU 上的工作基本上分为两部分，第一部分是将顶点（或数据流）转换到裁剪空间坐标，第二部分是基于第一部分的结果绘制像素点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53578028891811406000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 9;\ngl.drawArrays(primitiveType, offset, count);`, `53578028891811406000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里的 9 表示“处理 9 个顶点”，所以将会有 9 个顶点被转换。</p>\n<p><img src="/static/vertex-shader-anim-33263e801ba33d7a89d6af77129031ac.gif"></p>\n<p>左侧是你提供的数据。顶点着色器（Vertex Shader）是你写进 GLSL 中的一个方法，每个顶点调用一次，在这个方法中做一些数学运算后设置了一个特殊的 gl_Position 变量，这个变量就是该顶点转换到裁剪空间中的坐标值，GPU 接收该值并将其保存起来。</p>\n<p>假设你正在画三角形，顶点着色器每完成三次顶点处理，WebGL 就会用这三个顶点画一个三角形。它计算出这三个顶点对应的像素后，就会光栅化这个三角形，“光栅化”其实就是“用像素画出来”的花哨叫法。对于每一个像素，它会调用你的片断着色器询问你使用什么颜色。你通过给片断着色器的一个特殊变量 gl_FragColor 设置一个颜色值，实现自定义像素颜色。</p>\n<p>使用它们可以做出非常有趣的东西，但如你所见，到目前为止的例子中，处理每个像素时片断着色器可用信息很少，幸运的是我们可以给它传递更多信息。想要从顶点着色器传值到片断着色器，我们可以定义“可变量（varyings）”。</p>\n<p>一个简单的例子，将顶点着色器计算出的裁剪空间坐标从顶点着色器传递到片断着色器。</p>\n<p>我们来画一个简单的三角形，从之前的例子继续，让我们把矩形改成三角形。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33513907875856440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 定义一个三角形填充到缓冲里\nfunction setGeometry(gl) {\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, -100, 150, 125, -175, 100]), gl.STATIC_DRAW);\n}`, `33513907875856440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 定义一个三角形填充到缓冲里</span>\n<span class="token keyword">function</span> <span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们只需要画三个顶点</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16567085698799856000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制场景\nfunction drawScene() {\n  // ...\n  // 绘制几何体\n  var primitiveType = gl.TRIANGLES;\n  var offset = 0;\n  var count = 3;\n  gl.drawArrays(primitiveType, offset, count);\n}`, `16567085698799856000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制场景</span>\n<span class="token keyword">function</span> <span class="token function">drawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 绘制几何体</span>\n  <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在我们的顶点着色器中定义一个 varying（可变量）用来给片断着色器传值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16578013350909604000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`varying vec4 v_color;\n// ...\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n\n  // 从裁减空间转换到颜色空间\n  // 裁减空间范围 -1.0 到 +1.0\n  // 颜色空间范围 0.0 到 1.0\n  v_color = gl_Position * 0.5 + 0.5;\n}`, `16578013350909604000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{10}"\n              >\n                <span class="gatsby-code-button-language">glsl{10}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_matrix <span class="token operator">*</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span>a_position<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 从裁减空间转换到颜色空间</span>\n  <span class="token comment">// 裁减空间范围 -1.0 到 +1.0</span>\n  <span class="token comment">// 颜色空间范围 0.0 到 1.0</span>\n<span class="gatsby-highlight-code-line">  v_color <span class="token operator">=</span> gl_Position <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在片断着色器中定义同名 varying 变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78903186597154590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}`, `78903186597154590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{3,6}"\n              >\n                <span class="gatsby-code-button-language">glsl{3,6}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span></span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">  gl_FragColor <span class="token operator">=</span> v_color<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>WebGL 会将同名的可变量从顶点着色器输入到片断着色器中。</p>\n<p>下面是运行结果</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/7xbtl?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [draw-colorful-triangle](embedded-codesandbox://webgl-fundamental-base-concept/draw-colorful-triangle) -->\n<p>当你移动、缩放、旋转三角形时，发现颜色随位置变化，不跟着三角形移动。</p>\n<p>回想一下，我们只计算了三个顶点，调用了三次顶点着色器，所以也只计算出了三个颜色值，但是我们的三角形却有很多颜色，这就是称之为可变量的 varying 的原因啦！</p>\n<p>WebGL 先获得顶点着色器中计算的三个颜色值，在光栅化三角形时将会根据这三个值进行插值。 每一个像素在调用片断着色器时，可变量的值是与之对应的插值。</p>\n<p>让我们从上例的三个顶点开始分析</p>\n<table>\n   <tbody>\n      <tr>\n         <th colspan="2">顶点</th>\n      </tr>\n      <tr>\n         <td>0</td>\n         <td>-100</td>\n      </tr>\n      <tr>\n         <td>150</td>\n         <td>125</td>\n      </tr>\n      <tr>\n         <td>-175</td>\n         <td>100</td>\n      </tr>\n   </tbody>\n</table>\n<p>我们的给顶点着色器施加了一个包含平移，旋转和缩放的的矩阵，并将结果转换到裁剪空间。默认平移，旋转和缩放值为：平移 = 200, 150，旋转 = 0，缩放 = 1，所以这里只进行了平移。画布大小（背景缓冲）为 400×300，所以三个顶点在裁剪空间中为以下坐标值。</p>\n<table>\n   <tbody>\n      <tr>\n         <th colspan="2">写入 gl_Position 的值</th>\n      </tr>\n      <tr>\n         <td>0.000</td>\n         <td>0.660</td>\n      </tr>\n      <tr>\n         <td>0.750</td>\n         <td>-0.830</td>\n      </tr>\n      <tr>\n         <td>-0.875</td>\n         <td>-0.660</td>\n      </tr>\n   </tbody>\n</table>\n<p>同时将这些值转换到颜色空间中赋给我们定义的可变量 v_color。</p>\n<table>\n   <tbody>\n      <tr>\n         <th colspan="3">写入 v_color 的值</th>\n      </tr>\n      <tr>\n         <td>0.5000</td>\n         <td>0.830</td>\n         <td>0.5</td>\n      </tr>\n      <tr>\n         <td>0.8750</td>\n         <td>0.086</td>\n         <td>0.5</td>\n      </tr>\n      <tr>\n         <td>0.0625</td>\n         <td>0.170</td>\n         <td>0.5</td>\n      </tr>\n   </tbody>\n</table>\n<p>利用这三个值进行插值后传进每个像素运行的片断着色器中。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/zi15x?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [fragment-shader-anim](embedded-codesandbox://webgl-fundamental-base-concept/fragment-shader-anim?view=preview) -->\n<p>想要给片断着色器传值，我们可以先把值传递给顶点着色器然后再传给片断着色器。让我们来画一个由两个不同颜色三角形组成的矩形。我们需要给顶点着色器添加一个属性值，把值通过属性传递给它后它再直接传递给片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28595544694563290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec2 a_position;\nattribute vec4 a_color;\n// ...\nvarying vec4 v_color;\n\nvoid main() {\n  // 直接把属性值中的数据赋给可变量\n  v_color = a_color;\n}`, `28595544694563290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{2,8}"\n              >\n                <span class="gatsby-code-button-language">glsl{2,8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_position<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_color<span class="token punctuation">;</span></span><span class="token comment">// ...</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 直接把属性值中的数据赋给可变量</span>\n<span class="gatsby-highlight-code-line">  v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在要给 WebGL 提供要用的颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96608787592197360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 寻找顶点着色器中需要的数据\nvar positionLocation = gl.getAttribLocation(program, \'a_position\');\nvar colorLocation = gl.getAttribLocation(program, \'a_color\');\n// ..\n// 给颜色数据创建一个缓冲\nvar colorBuffer = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n// 设置颜色\nsetColors(gl);\n// ..\n\n// 给矩形的两个三角形\n// 设置颜色值并发到缓冲\nfunction setColors(gl) {\n  // 生成两个随机颜色\n  var r1 = Math.random();\n  var b1 = Math.random();\n  var g1 = Math.random();\n\n  var r2 = Math.random();\n  var b2 = Math.random();\n  var g2 = Math.random();\n\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([r1, b1, g1, 1, r1, b1, g1, 1, r1, b1, g1, 1, r2, b2, g2, 1, r2, b2, g2, 1, r2, b2, g2, 1]),\n    gl.STATIC_DRAW\n  );\n}`, `96608787592197360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3,5-9,12-29}"\n              >\n                <span class="gatsby-code-button-language">js{3,5-9,12-29}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 寻找顶点着色器中需要的数据</span>\n<span class="token keyword">var</span> positionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token comment">// ..</span>\n<span class="gatsby-highlight-code-line"><span class="token comment">// 给颜色数据创建一个缓冲</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">var</span> colorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// 设置颜色</span></span><span class="gatsby-highlight-code-line"><span class="token function">setColors</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token comment">// ..</span>\n\n<span class="gatsby-highlight-code-line"><span class="token comment">// 给矩形的两个三角形</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// 设置颜色值并发到缓冲</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token comment">// 生成两个随机颜色</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> r1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> b1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> g1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> r2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> b2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> g2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>r1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> g1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> g1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> g1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在渲染的时候设置颜色属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82197246326529900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enableVertexAttribArray(colorLocation);\n\n// 绑定颜色缓冲\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n\n// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值\nvar size = 4; // 每次迭代使用4个单位的数据\nvar type = gl.FLOAT; // 单位数据类型是32位的浮点型\nvar normalize = false; // 不需要归一化数据\nvar stride = 0; // 0 = 移动距离 * 单位距离长度sizeof(type)\n\n// 每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);`, `82197246326529900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 绑定颜色缓冲</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用4个单位的数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是32位的浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不需要归一化数据</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度sizeof(type)</span>\n\n<span class="token comment">// 每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调整顶点的数量为 6 用来画两个三角形</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13805978395331131000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 画几何体\nvar primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 6;\ngl.drawArrays(primitiveType, offset, count);`, `13805978395331131000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4}"\n              >\n                <span class="gatsby-code-button-language">js{4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 画几何体</span>\n<span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span></span>gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/fi4uh?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-2d-rectangle-with-2-colors](embedded-codesandbox://webgl-fundamental-base-concept/webgl-2d-rectangle-with-2-colors) -->\n<p>你可能注意到这两个三角形是纯色的。我们传递给每个三角形的顶点的颜色值是相同的，所以我们传递的 varying 会被插值成相同的颜色，如果我们传递不同的颜色，就会看到插值的颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44067333961753860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 给矩形的两个三角形\n// 设置颜色值并发到缓冲\nfunction setColors(gl) {\n  // 给每个顶点定义不同的颜色\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1\n    ]),\n    gl.STATIC_DRAW\n  );\n}`, `44067333961753860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{8-31}"\n              >\n                <span class="gatsby-code-button-language">js{8-31}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 给矩形的两个三角形</span>\n<span class="token comment">// 设置颜色值并发到缓冲</span>\n<span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 给每个顶点定义不同的颜色</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n<span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span></span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在看到的是插值的 varying</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/5ohcj?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!--\n[webgl-2d-rectangle-with-random-colors](embedded-codesandbox://webgl-fundamental-base-concept/webgl-2d-rectangle-with-random-colors) -->\n<p>上例还演示了使用多个属性并且通过顶点着色器向片断着色器传值。如果你看了处理图片的例子，那里面还用了另外一个属性传递纹理坐标。</p>\n<h2 id="关于-buffer-和-attribute-的代码是干什么的？"><a href="#%E5%85%B3%E4%BA%8E-buffer-%E5%92%8C-attribute-%E7%9A%84%E4%BB%A3%E7%A0%81%E6%98%AF%E5%B9%B2%E4%BB%80%E4%B9%88%E7%9A%84%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 buffer 和 attribute 的代码是干什么的？</h2>\n<p>缓冲操作是在 GPU 上获取顶点和其他顶点数据的一种方式。gl.createBuffer 创建一个缓冲；gl.bindBuffer 是设置缓冲为当前使用缓冲；gl.bufferData 将数据拷贝到缓冲，这个操作一般在初始化完成。</p>\n<p>一旦数据存到缓冲中，还需要告诉 WebGL 怎么从缓冲中提取数据传给顶点着色器的属性。</p>\n<p>要做这些，首先需要获取 WebGL 给属性分配的地址，如下方代码所示</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97419562203498760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 询问顶点数据应该放在哪里\nvar positionLocation = gl.getAttribLocation(program, \'a_position\');\nvar colorLocation = gl.getAttribLocation(program, \'a_color\');`, `97419562203498760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 询问顶点数据应该放在哪里</span>\n<span class="token keyword">var</span> positionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这一步一般也是在初始化部分完成。</p>\n<p>一旦知道了属性的地址，在绘制前还需要发出三个命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34389746802680430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enableVertexAttribArray(location); // 这个命令是告诉 WebGL 我们想从缓冲中提供数据。\ngl.bindBuffer(gl.ARRAY_BUFFER, someBuffer); // 这个命令是将缓冲绑定到 ARRAY_BUFFER 绑定点，它是 WebGL 内部的一个全局变量。\ngl.vertexAttribPointer(location, numComponents, typeOfData, normalizeFlag, strideToNextPieceOfData, offsetIntoBuffer);`, `34389746802680430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个命令是告诉 WebGL 我们想从缓冲中提供数据。</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> someBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个命令是将缓冲绑定到 ARRAY_BUFFER 绑定点，它是 WebGL 内部的一个全局变量。</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> numComponents<span class="token punctuation">,</span> typeOfData<span class="token punctuation">,</span> normalizeFlag<span class="token punctuation">,</span> strideToNextPieceOfData<span class="token punctuation">,</span> offsetIntoBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>最后一条命令告诉 WebGL 从 <code class="language-text">ARRAY_BUFFER</code> 绑定点当前绑定的缓冲获取数据。每个顶点有几个单位的数据(1 - 4)，单位数据类型是什么(BYTE, FLOAT, INT, <code class="language-text">UNSIGNED_SHORT</code>, 等等…)，stride 是从一个数据到下一个数据要跳过多少位，最后是数据在缓冲的什么位置。</p>\n<p>单位个数永远是 1 到 4 之间。</p>\n<p>如果每个类型的数据都用一个缓冲存储，stride 和 offset 都是 0。对 stride 来说 0 表示 “用符合单位类型和单位个数的大小”。对 offset 来说 0 表示从缓冲起始位置开始读取。它们使用 0 以外的值时会复杂得多，虽然这样会取得一些性能能上的优势，但是一般情况下并不值得，除非你想充分压榨 WebGL 的性能。</p>\n<h2 id="vertexattribpointer-中的-normalizeflag-参数是什么意思？"><a href="#vertexattribpointer-%E4%B8%AD%E7%9A%84-normalizeflag-%E5%8F%82%E6%95%B0%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vertexAttribPointer 中的 normalizeFlag 参数是什么意思？</h2>\n<p>标准化标记（normalizeFlag）适用于所有非浮点型数据。如果传递 false 就解读原数据类型。 BYTE 类型的范围是从 -128 到 127，UNSIGNED_BYTE 类型的范围是从 0 到 255， SHORT 类型的范围是从 -32768 到 32767，等等…</p>\n<p>如果标准化标记设为 true，BYTE 数据的值(-128 to 127)将会转换到 -1.0 到 +1.0 之间， UNSIGNED_BYTE (0 to 255) 变为 0.0 到 +1.0 之间，SHORT 也是转换到 -1.0 到 +1.0 之间， 但比 BYTE 精确度高。</p>\n<p>最常用的是标准化颜色数据。大多数情况颜色值范围为 0.0 到 +1.0。 使用 4 个浮点型数据存储红，绿，蓝和阿尔法通道数据时，每个顶点的颜色将会占用 16 字节空间， 如果你有复杂的几何体将会占用很多内存。代替的做法是将颜色数据转换为四个 UNSIGNED_BYTE ， 其中 0 表示 0.0，255 表示 1.0。现在每个顶点只需要四个字节存储颜色值，省了 75% 空间。</p>\n<p>我们来修改之前代码实现。当我们告诉 WebGL 如何获取颜色数据时将这样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63325116024439550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 告诉颜色属性如何从 colorBuffer 中提取数据 (ARRAY_BUFFER)\nvar size = 4; // 每次迭代使用四个单位数据\nvar type = gl.UNSIGNED_BYTE; // 数据类型是 8 位的 UNSIGNED_BYTE 类型。\nvar normalize = true; // 标准化数据\nvar stride = 0; // 0 = 移动距离 * 单位距离长度 sizeof(type)\n// 每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从缓冲的起始处开始\ngl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);`, `63325116024439550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3-4}"\n              >\n                <span class="gatsby-code-button-language">js{3-4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 告诉颜色属性如何从 colorBuffer 中提取数据 (ARRAY_BUFFER)</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用四个单位数据</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">;</span> <span class="token comment">// 数据类型是 8 位的 UNSIGNED_BYTE 类型。</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 标准化数据</span></span><span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度 sizeof(type)</span>\n<span class="token comment">// 每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如下向缓冲添加数据</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29792785807117880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 给矩形的两个三角形\n// 设置颜色值并发到缓冲\nfunction setColors(gl) {\n  // 设置两个随机颜色\n  var r1 = Math.random() * 256; // 0 到 255.99999 之间\n  var b1 = Math.random() * 256; // 这些数据\n  var g1 = Math.random() * 256; // 在存入缓冲时\n  var r2 = Math.random() * 256; // 将被截取成\n  var b2 = Math.random() * 256; // Uint8Array 类型\n  var g2 = Math.random() * 256;\n\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Uint8Array([\n      // Uint8Array\n      r1,\n      b1,\n      g1,\n      255,\n      r1,\n      b1,\n      g1,\n      255,\n      r1,\n      b1,\n      g1,\n      255,\n      r2,\n      b2,\n      g2,\n      255,\n      r2,\n      b2,\n      g2,\n      255,\n      r2,\n      b2,\n      g2,\n      255\n    ]),\n    gl.STATIC_DRAW\n  );\n}`, `29792785807117880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 给矩形的两个三角形</span>\n<span class="token comment">// 设置颜色值并发到缓冲</span>\n<span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 设置两个随机颜色</span>\n  <span class="token keyword">var</span> r1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 0 到 255.99999 之间</span>\n  <span class="token keyword">var</span> b1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 这些数据</span>\n  <span class="token keyword">var</span> g1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 在存入缓冲时</span>\n  <span class="token keyword">var</span> r2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 将被截取成</span>\n  <span class="token keyword">var</span> b2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// Uint8Array 类型</span>\n  <span class="token keyword">var</span> g2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span>\n\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n      <span class="token comment">// Uint8Array</span>\n      r1<span class="token punctuation">,</span>\n      b1<span class="token punctuation">,</span>\n      g1<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r1<span class="token punctuation">,</span>\n      b1<span class="token punctuation">,</span>\n      g1<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r1<span class="token punctuation">,</span>\n      b1<span class="token punctuation">,</span>\n      g1<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r2<span class="token punctuation">,</span>\n      b2<span class="token punctuation">,</span>\n      g2<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r2<span class="token punctuation">,</span>\n      b2<span class="token punctuation">,</span>\n      g2<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r2<span class="token punctuation">,</span>\n      b2<span class="token punctuation">,</span>\n      g2<span class="token punctuation">,</span>\n      <span class="token number">255</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/x51g6?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-2d-rectangle-with-2-byte-colors](embedded-codesandbox://webgl-fundamental-base-concept/webgl-2d-rectangle-with-2-byte-colors) -->\n<h1 id="webgl-着色器和-glsl"><a href="#webgl-%E7%9D%80%E8%89%B2%E5%99%A8%E5%92%8C-glsl" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 着色器和 GLSL</h1>\n<p>我们之前提到过着色器和 GLSL，但是没有涉及细节，你可能已经对此有所了解，但以防万一，这里将详细讲解着色器和 GLSL。</p>\n<p>在工作原理中我们提到，WebGL 每次绘制需要两个着色器，一个顶点着色器和一个片断着色器，每一个着色器都是一个方法。一个顶点着色器和一个片断着色器链接在一起放入一个着色程序中（或者只叫程序）。一个典型的 WebGL 应用会有多个着色程序。</p>\n<h2 id="顶点着色器"><a href="#%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点着色器</h2>\n<p>一个顶点着色器的工作是生成裁剪空间坐标值，通常是以下的形式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7476612159273710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`void main() {\n   gl_Position = doMathToMakeClipspaceCoordinates\n}`, `7476612159273710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_Position <span class="token operator">=</span> doMathToMakeClipspaceCoordinates\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>每个顶点调用一次（顶点）着色器，每次调用都需要设置一个特殊的全局变量 gl_Position， 该变量的值就是裁减空间坐标值。</p>\n<p>顶点着色器需要的数据，可以通过以下三种方式获得</p>\n<ol>\n<li>Attributes 属性 (从缓冲中获取的数据)</li>\n<li>Uniforms 全局变量 (在一次绘制中对所有顶点保持一致值)</li>\n<li>Textures 纹理 (从像素或纹理元素中获取的数据)</li>\n</ol>\n<h3 id="attributes-属性"><a href="#attributes-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Attributes 属性</h3>\n<p>最常用的方法是缓冲和属性，在工作原理中讲到了缓冲和属性，你可以创建缓冲</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34887499379104715000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var buf = gl.createBuffer();`, `34887499379104715000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> buf <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>将数据存入缓冲</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43798314100629800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.bindBuffer(gl.ARRAY_BUFFER, buf);\ngl.bufferData(gl.ARRAY_BUFFER, someData, gl.STATIC_DRAW);`, `43798314100629800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> someData<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然后初始化的时候，在你制作的（着色）程序中找到属性所在地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29096187881836323000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positionLoc = gl.getAttribLocation(someShaderProgram, \'a_position\');`, `29096187881836323000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positionLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>someShaderProgram<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在渲染的时候告诉 WebGL 怎么从缓冲中获取数据传递给属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82692368545283380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 开启从缓冲中获取数据\ngl.enableVertexAttribArray(positionLoc);\n\nvar numComponents = 3; // (x, y, z)\nvar type = gl.FLOAT; // 32 位浮点数据\nvar normalize = false; // 不标准化\nvar offset = 0; // 从缓冲起始位置开始获取\nvar stride = 0; // 到下一个数据跳多少位内存\n// 0 = 使用当前的单位个数和单位长度（3 * Float32Array.BYTES_PER_ELEMENT）\n\ngl.vertexAttribPointer(positionLoc, numComponents, type, false, stride, offset);`, `82692368545283380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 开启从缓冲中获取数据</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionLoc<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> numComponents <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// (x, y, z)</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 32 位浮点数据</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不标准化</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从缓冲起始位置开始获取</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 到下一个数据跳多少位内存</span>\n<span class="token comment">// 0 = 使用当前的单位个数和单位长度（3 * Float32Array.BYTES_PER_ELEMENT）</span>\n\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionLoc<span class="token punctuation">,</span> numComponents<span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 <code class="language-text">WebGL 基础概念</code> 中示范了不做任何运算直接将数据传递给 <code class="language-text">gl_Position</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43987484524488016000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\n\nvoid main() {\n   gl_Position = a_position;\n}`, `43987484524488016000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果缓冲中存的是裁剪空间坐标就没什么问题。</p>\n<p>属性可以用 float, vec2, vec3, vec4, mat2, mat3 和 mat4 数据类型。</p>\n<h3 id="uniforms-全局变量"><a href="#uniforms-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uniforms 全局变量</h3>\n<p>全局变量在一次绘制过程中传递给着色器的值都一样，在下面的一个简单的例子中，用全局变量给顶点着色器添加了一个偏移量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53825354057732770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nuniform vec4 u_offset;\n\nvoid main() {\n   gl_Position = a_position + u_offset;\n}`, `53825354057732770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_offset<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_Position <span class="token operator">=</span> a_position <span class="token operator">+</span> u_offset<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在可以把所有顶点偏移一个固定值，首先在初始化时找到全局变量的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10066890813274320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var offsetLoc = gl.getUniformLocation(someProgram, \'u_offset\');`, `10066890813274320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> offsetLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_offset\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后在绘制前设置全局变量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46051761808785410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform4fv(offsetLoc, [1, 0, 0, 0]); // 向右偏移一半屏幕宽度`, `46051761808785410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>offsetLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 向右偏移一半屏幕宽度</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>要注意的是全局变量属于单个着色程序，如果多个着色程序有同名全局变量，需要找到每个全局变量并设置自己的值。 我们调用 <code class="language-text">gl.uniform???</code> 的时候只是设置了当前程序的全局变量，当前程序是传递给 <code class="language-text">gl.useProgram</code> 的最后一个程序。</p>\n<p>全局变量有很多类型，对应的类型有对应的设置方法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62991114204376910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform1f(floatUniformLoc, v);                 // float\ngl.uniform1fv(floatUniformLoc, [v]);              // float 或 float array\ngl.uniform2f(vec2UniformLoc, v0, v1);             // vec2\ngl.uniform2fv(vec2UniformLoc, [v0, v1]);          // vec2 或 vec2 array\ngl.uniform3f(vec3UniformLoc, v0, v1, v2);         // vec3\ngl.uniform3fv(vec3UniformLoc, [v0, v1, v2]);      // vec3 或 vec3 array\ngl.uniform4f(vec4UniformLoc, v0, v1, v2, v4);     // vec4\ngl.uniform4fv(vec4UniformLoc, [v0, v1, v2, v4]);  // vec4 或 vec4 array\n\ngl.uniformMatrix2fv(mat2UniformLoc, false, [4x element array])    // mat2 或 mat2 array\ngl.uniformMatrix3fv(mat3UniformLoc, false, [9x element array])    // mat3 或 mat3 array\ngl.uniformMatrix4fv(mat4UniformLoc, false, [16x element array])   // mat4 或 mat4 array\n\ngl.uniform1i(intUniformLoc, v);                   // int\ngl.uniform1iv(intUniformLoc, [v]);                // int 或 int array\ngl.uniform2i(ivec2UniformLoc, v0, v1);            // ivec2\ngl.uniform2iv(ivec2UniformLoc, [v0, v1]);         // ivec2 或 ivec2 array\ngl.uniform3i(ivec3UniformLoc, v0, v1, v2);        // ivec3\ngl.uniform3iv(ivec3UniformLoc, [v0, v1, v2]);     // ivec3 or ivec3 array\ngl.uniform4i(ivec4UniformLoc, v0, v1, v2, v4);    // ivec4\ngl.uniform4iv(ivec4UniformLoc, [v0, v1, v2, v4]); // ivec4 或 ivec4 array\n\ngl.uniform1i(sampler2DUniformLoc, v);             // sampler2D (textures)\ngl.uniform1iv(sampler2DUniformLoc, [v]);          // sampler2D 或 sampler2D array\n\ngl.uniform1i(samplerCubeUniformLoc, v);           // samplerCube (textures)\ngl.uniform1iv(samplerCubeUniformLoc, [v]);        // samplerCube 或 samplerCube array`, `62991114204376910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>floatUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// float</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1fv</span><span class="token punctuation">(</span>floatUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// float 或 float array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>vec2UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// vec2</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>vec2UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// vec2 或 vec2 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3f</span><span class="token punctuation">(</span>vec3UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// vec3</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>vec3UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// vec3 或 vec3 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>vec4UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// vec4</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>vec4UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// vec4 或 vec4 array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix2fv</span><span class="token punctuation">(</span>mat2UniformLoc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span>x element array<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// mat2 或 mat2 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix3fv</span><span class="token punctuation">(</span>mat3UniformLoc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span>x element array<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// mat3 或 mat3 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>mat4UniformLoc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span>x element array<span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment">// mat4 或 mat4 array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>intUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// int</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1iv</span><span class="token punctuation">(</span>intUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// int 或 int array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2i</span><span class="token punctuation">(</span>ivec2UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ivec2</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2iv</span><span class="token punctuation">(</span>ivec2UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// ivec2 或 ivec2 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3i</span><span class="token punctuation">(</span>ivec3UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ivec3</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3iv</span><span class="token punctuation">(</span>ivec3UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// ivec3 or ivec3 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4i</span><span class="token punctuation">(</span>ivec4UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ivec4</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4iv</span><span class="token punctuation">(</span>ivec4UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ivec4 或 ivec4 array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>sampler2DUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// sampler2D (textures)</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1iv</span><span class="token punctuation">(</span>sampler2DUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// sampler2D 或 sampler2D array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>samplerCubeUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// samplerCube (textures)</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1iv</span><span class="token punctuation">(</span>samplerCubeUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// samplerCube 或 samplerCube array</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有一些类型 bool, bvec2, bvec3, bvec4。它们可用 <code class="language-text">gl.uniform?f?</code> 或 <code class="language-text">gl.uniform?i?</code>。</p>\n<p>一个数组可以一次设置所有的全局变量，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91635873852508290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 着色器里\nuniform vec2 u_someVec2[3];\n\n// JavaScript 初始化时\nvar someVec2Loc = gl.getUniformLocation(someProgram, &quot;u_someVec2&quot;);\n\n// 渲染的时候\ngl.uniform2fv(someVec2Loc, [1, 2, 3, 4, 5, 6]);  // 设置数组 u_someVec2`, `91635873852508290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 着色器里</span>\nuniform vec2 u_someVec2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// JavaScript 初始化时</span>\n<span class="token keyword">var</span> someVec2Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">"u_someVec2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 渲染的时候</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置数组 u_someVec2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果你想单独设置数组中的某个值，就要单独找到该值的地址。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86526830923903370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// JavaScript 初始化时\nvar someVec2Element0Loc = gl.getUniformLocation(someProgram, \'u_someVec2[0]\');\nvar someVec2Element1Loc = gl.getUniformLocation(someProgram, \'u_someVec2[1]\');\nvar someVec2Element2Loc = gl.getUniformLocation(someProgram, \'u_someVec2[2]\');\n\n// 渲染的时候\ngl.uniform2fv(someVec2Element0Loc, [1, 2]); // set element 0\ngl.uniform2fv(someVec2Element1Loc, [3, 4]); // set element 1\ngl.uniform2fv(someVec2Element2Loc, [5, 6]); // set element 2`, `86526830923903370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// JavaScript 初始化时</span>\n<span class="token keyword">var</span> someVec2Element0Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someVec2[0]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> someVec2Element1Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someVec2[1]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> someVec2Element2Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someVec2[2]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 渲染的时候</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Element0Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set element 0</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Element1Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set element 1</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Element2Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set element 2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样的，如果你创建了一个结构体</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62353999287284440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct SomeStruct {\n  bool active;\n  vec2 someVec2;\n};\n\nuniform SomeStruct u_someThing;`, `62353999287284440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">struct</span> SomeStruct <span class="token punctuation">{</span>\n  <span class="token keyword">bool</span> <span class="token keyword">active</span><span class="token punctuation">;</span>\n  <span class="token keyword">vec2</span> someVec2<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> SomeStruct u_someThing<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你需要找到每个元素的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83910142316239930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var someThingActiveLoc = gl.getUniformLocation(someProgram, \'u_someThing.active\');\nvar someThingSomeVec2Loc = gl.getUniformLocation(someProgram, \'u_someThing.someVec2\');`, `83910142316239930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> someThingActiveLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someThing.active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> someThingSomeVec2Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someThing.someVec2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="纹理（顶点着色器中）"><a href="#%E7%BA%B9%E7%90%86%EF%BC%88%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8%E4%B8%AD%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>纹理（顶点着色器中）</h3>\n<p>同 Textures 纹理（在片断着色器中）。</p>\n<h2 id="片断着色器"><a href="#%E7%89%87%E6%96%AD%E7%9D%80%E8%89%B2%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>片断着色器</h2>\n<p>一个片断着色器的工作是为当前光栅化的像素提供颜色值，通常是以下的形式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77874461514780520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nvoid main() {\n   gl_FragColor = doMathToMakeAColor;\n}`, `77874461514780520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_FragColor <span class="token operator">=</span> doMathToMakeAColor<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>每个像素都将调用一次片断着色器，每次调用需要从你设置的特殊全局变量 gl_FragColor 中获取颜色信息。</p>\n<p>片断着色器所需的数据，可以通过以下三种方式获取</p>\n<ol>\n<li>Uniforms 全局变量 (values that stay the same for every pixel of a single draw call)</li>\n<li>Textures 纹理 (data from pixels/texels)</li>\n<li>Varyings 可变量 (data passed from the vertex shader and interpolated)</li>\n</ol>\n<h3 id="uniform-全局变量（片断着色器中）"><a href="#uniform-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%EF%BC%88%E7%89%87%E6%96%AD%E7%9D%80%E8%89%B2%E5%99%A8%E4%B8%AD%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uniform 全局变量（片断着色器中）</h3>\n<p>同 Uniforms 全局变量</p>\n<h3 id="textures-纹理（片断着色器中）"><a href="#textures-%E7%BA%B9%E7%90%86%EF%BC%88%E7%89%87%E6%96%AD%E7%9D%80%E8%89%B2%E5%99%A8%E4%B8%AD%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Textures 纹理（片断着色器中）</h3>\n<p>在着色器中获取纹理信息，可以先创建一个 sampler2D 类型全局变量，然后用 GLSL 方法 texture2D 从纹理中提取信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40601814800367395000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nuniform sampler2D u_texture;\n\nvoid main() {\n   vec2 texcoord = vec2(0.5, 0.5)  // 获取纹理中心的值\n   gl_FragColor = texture2D(u_texture, texcoord);\n}`, `40601814800367395000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">sampler2D</span> u_texture<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">vec2</span> texcoord <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>  <span class="token comment">// 获取纹理中心的值</span>\n   gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_texture<span class="token punctuation">,</span> texcoord<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从纹理中获取的数据取决于很多设置，至少要创建并给纹理填充数据，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20737665470160073000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var tex = gl.createTexture();\ngl.bindTexture(gl.TEXTURE_2D, tex);\nvar level = 0;\nvar width = 2;\nvar height = 1;\nvar data = new Uint8Array([\n  255,\n  0,\n  0,\n  255, // 一个红色的像素\n  0,\n  255,\n  0,\n  255 // 一个绿色的像素\n]);\ngl.texImage2D(gl.TEXTURE_2D, level, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\ngl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);`, `20737665470160073000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> tex <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> tex<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> level <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> width <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> height <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token number">255</span><span class="token punctuation">,</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">255</span><span class="token punctuation">,</span> <span class="token comment">// 一个红色的像素</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">255</span><span class="token punctuation">,</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">255</span> <span class="token comment">// 一个绿色的像素</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在初始化时找到全局变量的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44014663991375370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var someSamplerLoc = gl.getUniformLocation(someProgram, \'u_texture\');`, `44014663991375370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> someSamplerLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_texture\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在渲染的时候 WebGL 要求纹理必须绑定到一个纹理单元上</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34632231075186360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var unit = 5; // 挑选一个纹理单元\ngl.activeTexture(gl.TEXTURE0 + unit);\ngl.bindTexture(gl.TEXTURE_2D, tex);`, `34632231075186360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> unit <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 挑选一个纹理单元</span>\ngl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span> <span class="token operator">+</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> tex<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后告诉着色器你要使用的纹理在那个纹理单元</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21649124251011244000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform1i(someSamplerLoc, unit);`, `21649124251011244000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>someSamplerLoc<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="varyings-可变量"><a href="#varyings-%E5%8F%AF%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Varyings 可变量</h3>\n<p>在工作原理提到过，可变量是一种顶点着色器给片断着色器传值的方式。</p>\n<p>为了使用可变量，要在两个着色器中定义同名的可变量。给顶点着色器中可变量设置的值，会作为参考值进行内插，在绘制像素时传给片断着色器的可变量。</p>\n<p>顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13383772883675537000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\n\nuniform vec4 u_offset;\n\nvarying vec4 v_positionWithOffset;\n\nvoid main() {\n  gl_Position = a_position + u_offset;\n  v_positionWithOffset = a_position + u_offset;\n}`, `13383772883675537000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_offset<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_positionWithOffset<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl_Position <span class="token operator">=</span> a_position <span class="token operator">+</span> u_offset<span class="token punctuation">;</span>\n  v_positionWithOffset <span class="token operator">=</span> a_position <span class="token operator">+</span> u_offset<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>片断着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48955424370823586000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nvarying vec4 v_positionWithOffset;\n\nvoid main() {\n  // 从裁剪空间 (-1 <-> +1) 转换到颜色空间 (0 -> 1).\n  vec4 color = v_positionWithOffset * 0.5 + 0.5\n  gl_FragColor = color;\n}`, `48955424370823586000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_positionWithOffset<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 从裁剪空间 (-1 &lt;-> +1) 转换到颜色空间 (0 -> 1).</span>\n  <span class="token keyword">vec4</span> color <span class="token operator">=</span> v_positionWithOffset <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token number">0.5</span>\n  gl_FragColor <span class="token operator">=</span> color<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上方的示例几乎没有意义，通常情况下直接将裁剪空间的值传给片断着色器当作颜色值是没有意义的，虽然它可以运行并且可以生成颜色值。</p>\n<h2 id="glsl"><a href="#glsl" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GLSL</h2>\n<p>GLSL 全称是 Graphics Library Shader Language（图形库着色器语言），是着色器使用的语言。它有一些不同于 JavaScript 的特性，主要目的是为栅格化图形提供常用的计算功能。所以它内建的数据类型例如 vec2, vec3 和 vec4 分别代表两个值，三个值和四个值，类似的还有 mat2, mat3 和 mat4 分别代表 2x2, 3x3 和 4x4 矩阵。你可以做一些运算例如常量和矢量的乘法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52983234310189430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 a = vec4(1, 2, 3, 4);\nvec4 b = a * 2.0;\n// b 现在是 vec4(2, 4, 6, 8);`, `52983234310189430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> a <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">vec4</span> b <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n<span class="token comment">// b 现在是 vec4(2, 4, 6, 8);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>它同样可以做矩阵乘法以及矢量和矩阵的乘法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73017432554949080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mat4 a = ???\nmat4 b = ???\nmat4 c = a * b;\n\nvec4 v = ???\nvec4 y = c * v;`, `73017432554949080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">mat4</span> a <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>\n<span class="token keyword">mat4</span> b <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>\n<span class="token keyword">mat4</span> c <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>\n\n<span class="token keyword">vec4</span> v <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>\n<span class="token keyword">vec4</span> y <span class="token operator">=</span> c <span class="token operator">*</span> v<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>他还为矢量数据提供多种分量选择器，例如 vec4</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37401387877296770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 v;`, `37401387877296770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> v<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<ul>\n<li>v.x 和 v.s 以及 v.r ， <code class="language-text">v[0]</code> 表达的是同一个分量。</li>\n<li>v.y 和 v.t 以及 v.g ， <code class="language-text">v[1]</code> 表达的是同一个分量。</li>\n<li>v.z 和 v.p 以及 v.b ， <code class="language-text">v[2]</code> 表达的是同一个分量。</li>\n<li>v.w 和 v.q 以及 v.a ， <code class="language-text">v[3]</code> 表达的是同一个分量。</li>\n</ul>\n<p>它还支持矢量调制，意味者你可以交换或重复分量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22533755681480126000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v.yyyy`, `22533755681480126000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">v<span class="token punctuation">.</span>yyyy</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29056888090058707000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.y, v.y, v.y, v.y)`, `29056888090058707000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是一样的。同样的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56206208639799750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v.bgra`, `56206208639799750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">v<span class="token punctuation">.</span>bgra</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39087976521598390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.b, v.g, v.r, v.a)`, `39087976521598390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>b<span class="token punctuation">,</span> v<span class="token punctuation">.</span>g<span class="token punctuation">,</span> v<span class="token punctuation">.</span>r<span class="token punctuation">,</span> v<span class="token punctuation">.</span>a<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>等价。当构造一个矢量或矩阵时可以一次提供多个分量，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92236600227096720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.rgb, 1)`, `92236600227096720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60228023614918840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.r, v.g, v.b, 1)`, `60228023614918840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>r<span class="token punctuation">,</span> v<span class="token punctuation">.</span>g<span class="token punctuation">,</span> v<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是一样的。同样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34234710837848216000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(1)`, `34234710837848216000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8788947242213840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(1, 1, 1, 1)`, `8788947242213840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>相同。值得注意的是 GLSL 是一个强类型的语言。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83429563533558460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float f = 1;  // 错误，1 是 int 类型，不能将 int 型赋值给 float`, `83429563533558460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 错误，1 是 int 类型，不能将 int 型赋值给 float</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>正确的方式是</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91040035171118560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float f = 1.0;      // 使用 float\nfloat f = float(1)  // 转换 integer 为 float`, `91040035171118560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>      <span class="token comment">// 使用 float</span>\n<span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// 转换 integer 为 float</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>上例中 <code class="language-text">vec4(v.rgb, 1)</code> 不会因为 1 报错，因为 vec4 内部进行了转换类似 <code class="language-text">float(1)</code> 。</p>\n<p>GLSL 有一系列内置方法，其中大多数运算支持多种数据类型，并且一次可以运算多个分量，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31575712000259703000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`T sin(T angle)`, `31575712000259703000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">T <span class="token function">sin</span><span class="token punctuation">(</span>T angle<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>T 可以是 float, vec2, vec3 或 vec4。如果你传的是 vec4 返回的也是 vec4, 返回结果对应每个分量的正弦值。换句话说如果 v 是 vec4 类型。那么</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57794191757349080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 s = sin(v);`, `57794191757349080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> s <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15191697461167774000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 s = vec4(sin(v.x), sin(v.y), sin(v.z), sin(v.w));`, `15191697461167774000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> s <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是一样的。有时一个参数是浮点型而剩下的都是 T，意思是那个浮点数据会作为所有其他参数的一个新分量。例如如果 v1 和 v2 是 vec4 同时 f 是浮点型，那么</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17360250082865125000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 m = mix(v1, v2, f);`, `17360250082865125000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> m <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29731131786122834000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 m = vec4(\n  mix(v1.x, v2.x, f),\n  mix(v1.y, v2.y, f),\n  mix(v1.z, v2.z, f),\n  mix(v1.w, v2.w, f));`, `29731131786122834000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> m <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>z<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>z<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>w<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>w<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>等价。你可以在 <a href="https://www.khronos.org/files/webgl/webgl-reference-card-1_0.pdf" target="_blank" rel="nofollow noreferrer noopener">WebGL 引用表</a> 最后一页看到所有 GLSL 方法的列表。如果你喜欢干货以更详细的东西你可以看看 <a href="https://www.khronos.org/files/opengles_shading_language.pdf" target="_blank" rel="nofollow noreferrer noopener">GLSL 规范</a>。</p>\n<h2 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>\n<p>这是当前系列文章的重点。WebGL 的全部内容就是创建不同的着色器，向着色器提供数据然后调用 gl.drawArrays 或 gl.drawElements 让 WebGL 调用当前顶点着色器处理每个顶点，调用当前片断着色器渲染每个像素。</p>\n<p>实际上创建着色器需要为数不多的几行代码，并且在大多数 WebGL 应用程序中都相似， 因此一旦写完几乎可以不再关心它们了。</p>\n<h1 id="webgl-state-diagram"><a href="#webgl-state-diagram" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL State Diagram</h1>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/8gqf5w?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-state-diagram](embedded-codesandbox://webgl-fundamental-base-concept/webgl-state-diagram) -->',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——基础概念/index.md absPath of file >>> MarkdownRemark",timeToRead:34,frontmatter:{date:"2022-04-26 11:03:10",path:"/webgl-fundamental-base-concept/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——基础概念",draft:null}},{excerpt:"版本一 版本二 工具 虚拟环境 对象自省 语法 异常 For - Else 三元运算符 Global Return open 函数  和  上下文管理器 // TODO  https://py.eastlakeside.cn/book/FunctionalProgramming/README.html",html:'<h1 id="版本一"><a href="#%E7%89%88%E6%9C%AC%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>版本一</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60803776768855530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# _*_ coding: utf-8 _*_\n\n&quot;&quot;&quot;类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算&quot;&quot;&quot;\n\n#-- 寻求帮助:\n    dir(obj)            # 简单的列出对象obj所包含的方法名称，返回一个字符串列表\n    help(obj.func)      # 查询obj.func的具体介绍和用法\n\n#-- 测试类型的三种方法，推荐第三种\n    if type(L) == type([]):\n        print(&quot;L is list&quot;)\n    if type(L) == list:\n        print(&quot;L is list&quot;)\n    if isinstance(L, list):\n        print(&quot;L is list&quot;)\n\n#-- Python数据类型：哈希类型、不可哈希类型\n    # 哈希类型，即在原地不能改变的变量类型，不可变类型。可利用hash函数查看其hash值，也可以作为字典的key\n    &quot;数字类型：int, float, decimal.Decimal, fractions.Fraction, complex&quot;\n    &quot;字符串类型：str, bytes&quot;\n    &quot;元组：tuple&quot;\n    &quot;冻结集合：frozenset&quot;\n    &quot;布尔类型：True, False&quot;\n    &quot;None&quot;\n    # 不可hash类型：原地可变类型：list、dict和set。它们不可以作为字典的key。\n\n#-- 数字常量\n    1234, -1234, 0, 999999999                    # 整数\n    1.23, 1., 3.14e-10, 4E210, 4.0e+210          # 浮点数\n    0o177, 0x9ff, 0X9FF, 0b101010                # 八进制、十六进制、二进制数字\n    3+4j, 3.0+4.0j, 3J                           # 复数常量，也可以用complex(real, image)来创建\n    hex(I), oct(I), bin(I)                       # 将十进制数转化为十六进制、八进制、二进制表示的“字符串”\n    int(string, base)                            # 将字符串转化为整数，base为进制数\n    # 2.x中，有两种整数类型：一般整数（32位）和长整数（无穷精度）。可以用l或L结尾，迫使一般整数成为长整数\n    float(\'inf\'), float(\'-inf\'), float(\'nan\')    # 无穷大, 无穷小, 非数\n\n#-- 数字的表达式操作符\n    yield x                                      # 生成器函数发送协议\n    lambda args: expression                      # 生成匿名函数\n    x if y else z                                # 三元选择表达式\n    x and y, x or y, not x                       # 逻辑与、逻辑或、逻辑非\n    x in y, x not in y                           # 成员对象测试\n    x is y, x is not y                           # 对象实体测试\n    x<y, x<=y, x>y, x>=y, x==y, x!=y             # 大小比较，集合子集或超集值相等性操作符\n    1 < a < 3                                    # Python中允许连续比较\n    x|y, x&y, x^y                                # 位或、位与、位异或\n    x<<y, x>>y                                   # 位操作：x左移、右移y位\n    +, -, *, /, //, %, **                        # 真除法、floor除法：返回不大于真除法结果的整数值、取余、幂运算\n    -x, +x, ~x                                   # 一元减法、识别、按位求补（取反）\n    x[i], x[i:j:k]                               # 索引、分片\n    int(3.14), float(3)                          # 强制类型转换\n\n#-- 整数可以利用bit_length函数测试所占的位数\n    a = 1;       a.bit_length()    # 1\n    a = 1024;    a.bit_length()    # 11\n\n#-- repr和str显示格式的区别\n    &quot;&quot;&quot;\n    repr格式：默认的交互模式回显，产生的结果看起来它们就像是代码。\n    str格式：打印语句，转化成一种对用户更加友好的格式。\n    &quot;&quot;&quot;\n\n#-- 数字相关的模块\n    # math模块\n    # Decimal模块：小数模块\n        import decimal\n        from decimal import Decimal\n        Decimal(&quot;0.01&quot;) + Decimal(&quot;0.02&quot;)        # 返回Decimal(&quot;0.03&quot;)\n        decimal.getcontext().prec = 4            # 设置全局精度为4 即小数点后边4位\n    # Fraction模块：分数模块\n        from fractions import Fraction\n        x = Fraction(4, 6)                       # 分数类型 4/6\n        x = Fraction(&quot;0.25&quot;)                     # 分数类型 1/4 接收字符串类型的参数\n\n#-- 集合set\n    &quot;&quot;&quot;\n    set是一个无序不重复元素集, 基本功能包括关系测试和消除重复元素。\n    set支持union(联合), intersection(交), difference(差)和symmetric difference(对称差集)等数学运算。\n    set支持x in set, len(set), for x in set。\n    set不记录元素位置或者插入点, 因此不支持indexing, slicing, 或其它类序列的操作\n    &quot;&quot;&quot;\n    s = set([3,5,9,10])                          # 创建一个数值集合，返回{3, 5, 9, 10}\n    t = set(&quot;Hello&quot;)                             # 创建一个字符的集合，返回{\'l\', \'H\', \'e\', \'o\'}\n    a = t | s;    t.union(s)                     # t 和 s的并集\n    b = t & s;    t.intersection(s)              # t 和 s的交集\n    c = t – s;    t.difference(s)                # 求差集（项在t中, 但不在s中）\n    d = t ^ s;    t.symmetric_difference(s)      # 对称差集（项在t或s中, 但不会同时出现在二者中）\n    t.add(\'x\');   t.remove(\'H\')                  # 增加/删除一个item\n    s.update([10,37,42])                         # 利用[......]更新s集合\n    x in s,  x not in s                          # 集合中是否存在某个值\n    s.issubset(t);      s <= t                   # 测试是否 s 中的每一个元素都在 t 中\n    s.issuperset(t);    s >= t                   # 测试是否 t 中的每一个元素都在 s 中\n    s.copy();\n    s.discard(x);                                # 删除s中x\n    s.clear()                                    # 清空s\n    {x**2 for x in [1, 2, 3, 4]}                 # 集合解析，结果：{16, 1, 4, 9}\n    {x for x in \'spam\'}                          # 集合解析，结果：{\'a\', \'p\', \'s\', \'m\'}\n\n#-- 集合frozenset，不可变对象\n    &quot;&quot;&quot;\n    set是可变对象，即不存在hash值，不能作为字典的键值。同样的还有list等(tuple是可以作为字典key的)\n    frozenset是不可变对象，即存在hash值，可作为字典的键值\n    frozenset对象没有add、remove等方法，但有union/intersection/difference等方法\n    &quot;&quot;&quot;\n    a = set([1, 2, 3])\n    b = set()\n    b.add(a)                     # error: set是不可哈希类型\n    b.add(frozenset(a))          # ok，将set变为frozenset，可哈希\n\n#-- 布尔类型bool\n    type(True)                   # 返回<class \'bool\'>\n    isinstance(False, int)       # bool类型属于整型，所以返回True\n    True == 1; True is 1         # 输出(True, False)\n\n#-- 动态类型简介\n    &quot;&quot;&quot;\n    变量名通过引用，指向对象。\n    Python中的“类型”属于对象，而不是变量，每个对象都包含有头部信息，比如&quot;类型标示符&quot; &quot;引用计数器&quot;等\n    &quot;&quot;&quot;\n    #共享引用及在原处修改：对于可变对象，要注意尽量不要共享引用！\n    #共享引用和相等测试：\n        L = [1], M = [1], L is M            # 返回False\n        L = M = [1, 2, 3], L is M           # 返回True，共享引用\n    #增强赋值和共享引用：普通+号会生成新的对象，而增强赋值+=会在原处修改\n        L = M = [1, 2]\n        L = L + [3, 4]                      # L = [1, 2, 3, 4], M = [1, 2]\n        L += [3, 4]                         # L = [1, 2, 3, 4], M = [1, 2, 3, 4]\n\n#-- 常见字符串常量和表达式\n    S = \'\'                                  # 空字符串\n    S = &quot;spam’s&quot;                            # 双引号和单引号相同\n    S = &quot;s\\np\\ta\\x00m&quot;                      # 转义字符\n    S = &quot;&quot;&quot;spam&quot;&quot;&quot;                          # 三重引号字符串，一般用于函数说明\n    S = r\'\\temp\'                            # Raw字符串，不会进行转义，抑制转义\n    S = b\'Spam\'                             # Python3中的字节字符串\n    S = u\'spam\'                             # Python2.6中的Unicode字符串\n    s1+s2, s1*3, s[i], s[i:j], len(s)       # 字符串操作\n    \'a %s parrot\' % \'kind\'                  # 字符串格式化表达式\n    \'a {1} {0} parrot\'.format(\'kind\', \'red\')# 字符串格式化方法\n    for x in s: print(x)                    # 字符串迭代，成员关系\n    [x*2 for x in s]                        # 字符串列表解析\n    \',\'.join([\'a\', \'b\', \'c\'])               # 字符串输出，结果：a,b,c\n\n#-- 内置str处理函数：\n    str1 = &quot;stringobject&quot;\n    str1.upper(); str1.lower(); str1.swapcase(); str1.capitalize(); str1.title()        # 全部大写，全部小写、大小写转换，首字母大写，每个单词的首字母都大写\n    str1.ljust(width)                       # 获取固定长度，左对齐，右边不够用空格补齐\n    str1.rjust(width)                       # 获取固定长度，右对齐，左边不够用空格补齐\n    str1.center(width)                      # 获取固定长度，中间对齐，两边不够用空格补齐\n    str1.zfill(width)                       # 获取固定长度，右对齐，左边不足用0补齐\n    str1.find(\'t\',start,end)                # 查找字符串，可以指定起始及结束位置搜索\n    str1.rfind(\'t\')                         # 从右边开始查找字符串\n    str1.count(\'t\')                         # 查找字符串出现的次数\n    #上面所有方法都可用index代替，不同的是使用index查找不到会抛异常，而find返回-1\n    str1.replace(\'old\',\'new\')               # 替换函数，替换old为new，参数中可以指定maxReplaceTimes，即替换指定次数的old为new\n    str1.strip();                           # 默认删除空白符\n    str1.strip(\'d\');                        # 删除str1字符串中开头、结尾处，位于 d 删除序列的字符\n    str1.lstrip();\n    str1.lstrip(\'d\');                       # 删除str1字符串中开头处，位于 d 删除序列的字符\n    str1.rstrip();\n    str1.rstrip(\'d\')                        # 删除str1字符串中结尾处，位于 d 删除序列的字符\n    str1.startswith(\'start\')                # 是否以start开头\n    str1.endswith(\'end\')                    # 是否以end结尾\n    str1.isalnum(); str1.isalpha(); str1.isdigit(); str1.islower(); str1.isupper()      # 判断字符串是否全为字符、数字、小写、大写\n\n#-- 三重引号编写多行字符串块，并且在代码折行处嵌入换行字符\\n\n    mantra = &quot;&quot;&quot;hello world\n            hello python\n            hello my friend&quot;&quot;&quot;\n    # mantra为&quot;&quot;&quot;hello world \\n hello python \\n hello my friend&quot;&quot;&quot;\n\n#-- 索引和分片：\n    S[0], S[len(S)–1], S[-1]                # 索引\n    S[1:3], S[1:], S[:-1], S[1:10:2]        # 分片，第三个参数指定步长，如\\`S[1:10:2]\\`是从1位到10位没隔2位获取一个字符。\n\n#-- 字符串转换工具：\n    int(\'42\'), str(42)                      # 返回(42, \'42\')\n    float(\'4.13\'), str(4.13)                # 返回(4.13, \'4.13\')\n    ord(\'s\'), chr(115)                      # 返回(115, \'s\')\n    int(\'1001\', 2)                          # 将字符串作为二进制数字，转化为数字，返回9\n    bin(13), oct(13), hex(13)               # 将整数转化为二进制/八进制/十六进制字符串，返回(\'0b1101\', \'015\', \'0xd\')\n\n#-- 另类字符串连接\n    name = &quot;wang&quot; &quot;hong&quot;                    # 单行，name = &quot;wanghong&quot;\n    name = &quot;wang&quot; \\\n            &quot;hong&quot;                          # 多行，name = &quot;wanghong&quot;\n\n#-- Python中的字符串格式化实现1--字符串格式化表达式\n    &quot;&quot;&quot;\n    基于C语言的\'print\'模型，并且在大多数的现有的语言中使用。\n    通用结构：%[(name)][flag][width].[precision]typecode\n    &quot;&quot;&quot;\n    &quot;this is %d %s bird&quot; % (1, \'dead\')                          # 一般的格式化表达式\n    &quot;%s---%s---%s&quot; % (42, 3.14, [1, 2, 3])                      # 字符串输出：\'42---3.14---[1, 2, 3]\'\n    &quot;%d...%6d...%-6d...%06d&quot; % (1234, 1234, 1234, 1234)         # 对齐方式及填充：&quot;1234...  1234...1234  ...001234&quot;\n    x = 1.23456789\n    &quot;%e | %f | %g&quot; % (x, x, x)                                  # 对齐方式：&quot;1.234568e+00 | 1.234568 | 1.23457&quot;\n    &quot;%6.2f*%-6.2f*%06.2f*%+6.2f&quot; % (x, x, x, x)                 # 对齐方式：\'  1.23*1.23  *001.23* +1.23\'\n    &quot;%(name1)d---%(name2)s&quot; % {&quot;name1&quot;:23, &quot;name2&quot;:&quot;value2&quot;}    # 基于字典的格式化表达式\n    &quot;%(name)s is %(age)d&quot; % vars()                              # vars()函数调用返回一个字典，包含了所有本函数调用时存在的变量\n\n#-- Python中的字符串格式化实现2--字符串格式化调用方法\n    # 普通调用\n    &quot;{0}, {1} and {2}&quot;.format(\'spam\', \'ham\', \'eggs\')            # 基于位置的调用\n    &quot;{motto} and {pork}&quot;.format(motto = \'spam\', pork = \'ham\')   # 基于Key的调用\n    &quot;{motto} and {0}&quot;.format(\'ham\', motto = \'spam\')             # 混合调用\n    # 添加键 属性 偏移量 (import sys)\n    &quot;my {1[spam]} runs {0.platform}&quot;.format(sys, {\'spam\':\'laptop\'})                 # 基于位置的键和属性\n    &quot;{config[spam]} {sys.platform}&quot;.format(sys = sys, config = {\'spam\':\'laptop\'})   # 基于Key的键和属性\n    &quot;first = {0[0]}, second = {0[1]}&quot;.format([\'A\', \'B\', \'C\'])                       # 基于位置的偏移量\n    # 具体格式化\n    &quot;{0:e}, {1:.3e}, {2:g}&quot;.format(3.14159, 3.14159, 3.14159)   # 输出\'3.141590e+00, 3.142e+00, 3.14159\'\n    &quot;{fieldname:format_spec}&quot;.format(......)\n    # 说明:\n    &quot;&quot;&quot;\n        fieldname是指定参数的一个数字或关键字, 后边可跟可选的&quot;.name&quot;或&quot;[index]&quot;成分引用\n        format_spec ::=  [[fill]align][sign][#][0][width][,][.precision][type]\n        fill        ::=  <any character>              #填充字符\n        align       ::=  &quot;<&quot; | &quot;>&quot; | &quot;=&quot; | &quot;^&quot;        #对齐方式\n        sign        ::=  &quot;+&quot; | &quot;-&quot; | &quot; &quot;              #符号说明\n        width       ::=  integer                      #字符串宽度\n        precision   ::=  integer                      #浮点数精度\n        type        ::=  &quot;b&quot; | &quot;c&quot; | &quot;d&quot; | &quot;e&quot; | &quot;E&quot; | &quot;f&quot; | &quot;F&quot; | &quot;g&quot; | &quot;G&quot; | &quot;n&quot; | &quot;o&quot; | &quot;s&quot; | &quot;x&quot; | &quot;X&quot; | &quot;%&quot;\n    &quot;&quot;&quot;\n    # 例子:\n        \'={0:10} = {1:10}\'.format(\'spam\', 123.456)    # 输出\'=spam       =    123.456\'\n        \'={0:>10}=\'.format(\'test\')                    # 输出\'=      test=\'\n        \'={0:<10}=\'.format(\'test\')                    # 输出\'=test      =\'\n        \'={0:^10}=\'.format(\'test\')                    # 输出\'=   test   =\'\n        \'{0:X}, {1:o}, {2:b}\'.format(255, 255, 255)   # 输出\'FF, 377, 11111111\'\n        \'My name is {0:{1}}.\'.format(\'Fred\', 8)       # 输出\'My name is Fred    .\'  动态指定参数\n\n#-- 常用列表常量和操作\n    L = [[1, 2], \'string\', {}]                        # 嵌套列表\n    L = list(\'spam\')                                  # 列表初始化\n    L = list(range(0, 4))                             # 列表初始化\n    list(map(ord, \'spam\'))                            # 列表解析\n    len(L)                                            # 求列表长度\n    L.count(value)                                    # 求列表中某个值的个数\n    L.append(obj)                                     # 向列表的尾部添加数据，比如append(2)，添加元素2\n    L.insert(index, obj)                              # 向列表的指定index位置添加数据，index及其之后的数据后移\n    L.extend(interable)                               # 通过添加iterable中的元素来扩展列表，比如extend([2])，添加元素2，注意和append的区别\n    L.index(value, [start, [stop]])                   # 返回列表中值value的第一个索引\n    L.pop([index])                                    # 删除并返回index处的元素，默认为删除并返回最后一个元素\n    L.remove(value)                                   # 删除列表中的value值，只删除第一次出现的value的值\n    L.reverse()                                       # 反转列表\n    L.sort(cmp=None, key=None, reverse=False)         # 排序列表\n    a = [1, 2, 3], b = a[10:]                         # 注意，这里不会引发IndexError异常，只会返回一个空的列表[]\n    a = [], a += [1]                                  # 这里实在原有列表的基础上进行操作，即列表的id没有改变\n    a = [], a = a + [1]                               # 这里最后的a要构建一个新的列表，即a的id发生了变化\n\n#-- 用切片来删除序列的某一段\n    a = [1, 2, 3, 4, 5, 6, 7]\n    a[1:4] = []                                       # a = [1, 5, 6, 7]\n    a = [0, 1, 2, 3, 4, 5, 6, 7]\n    del a[::2]                                        # 去除偶数项(偶数索引的)，a = [1, 3, 5, 7]\n\n#-- 常用字典常量和操作\n    D = {}\n    D = {\'spam\':2, \'tol\':{\'ham\':1}}                   # 嵌套字典\n    D = dict.fromkeys([\'s\', \'d\'], 8)                  # {\'s\': 8, \'d\': 8}\n    D = dict(name = \'tom\', age = 12)                  # {\'age\': 12, \'name\': \'tom\'}\n    D = dict([(\'name\', \'tom\'), (\'age\', 12)])          # {\'age\': 12, \'name\': \'tom\'}\n    D = dict(zip([\'name\', \'age\'], [\'tom\', 12]))       # {\'age\': 12, \'name\': \'tom\'}\n    D.keys(); D.values(); D.items()                   # 字典键、值以及键值对\n    D.get(key, default)                               # get函数\n    D.update(D_other)                                 # 合并字典，如果存在相同的键值，D_other的数据会覆盖掉D的数据\n    D.pop(key, [D])                                   # 删除字典中键值为key的项，返回键值为key的值，如果不存在，返回默认值D，否则异常\n    D.popitem()                                       # pop字典中随机的一项（一个键值对）\n    D.setdefault(k[, d])                              # 设置D中某一项的默认值。如果k存在，则返回D[k]，否则设置D[k]=d，同时返回D[k]。\n    del D                                             # 删除字典\n    del D[\'key\']                                      # 删除字典的某一项\n    if key in D:   if key not in D:                   # 测试字典键是否存在\n    # 字典注意事项：（1）对新索引赋值会添加一项（2）字典键不一定非得是字符串，也可以为任何的不可变对象\n    # 不可变对象：调用对象自身的任意方法，也不会改变该对象自身的内容，这些方法会创建新的对象并返回。\n    # 字符串、整数、tuple都是不可变对象，dict、set、list都是可变对象\n    D[(1,2,3)] = 2                                    # tuple作为字典的key\n\n#-- 字典解析\n    D = {k:8 for k in [\'s\', \'d\']}                     # {\'s\': 8, \'d\': 8}\n    D = {k:v for (k, v) in zip([\'name\', \'age\'], [\'tom\', 12])}       # {\'age\': 12, \'name\': tom}\n\n#-- 字典的特殊方法__missing__：当查找找不到key时，会执行该方法\n    class Dict(dict):\n        def __missing__(self, key):\n            self[key] = []\n            return self[key]\n    dct = dict()\n    dct[&quot;foo&quot;].append(1)    # 这有点类似于collections.defalutdict\n    dct[&quot;foo&quot;]              # [1]\n\n#-- 元组和列表的唯一区别在于元组是不可变对象，列表是可变对象\n    a = [1, 2, 3]           # a[1] = 0, OK\n    a = (1, 2, 3)           # a[1] = 0, Error\n    a = ([1, 2],)           # a[0][1] = 0, OK\n    a = [(1, 2)]            # a[0][1] = 0, Error\n\n#-- 元组的特殊语法: 逗号和圆括号\n    D = (12)                # 此时D为一个整数 即D = 12\n    D = (12, )              # 此时D为一个元组 即D = (12, )\n\n#-- 文件基本操作\n    output = open(r\'C:\\spam\', \'w\')          # 打开输出文件，用于写\n    input = open(\'data\', \'r\')               # 打开输入文件，用于读。打开的方式可以为\'w\', \'r\', \'a\', \'wb\', \'rb\', \'ab\'等\n    fp.read([size])                         # size为读取的长度，以byte为单位\n    fp.readline([size])                     # 读一行，如果定义了size，有可能返回的只是一行的一部分\n    fp.readlines([size])                    # 把文件每一行作为一个list的一个成员，并返回这个list。其实它的内部是通过循环调用readline()来实现的。如果提供size参数，size是表示读取内容的总长。\n    fp.readable()                           # 是否可读\n    fp.write(str)                           # 把str写到文件中，write()并不会在str后加上一个换行符\n    fp.writelines(seq)                      # 把seq的内容全部写到文件中(多行一次性写入)\n    fp.writeable()                          # 是否可写\n    fp.close()                              # 关闭文件。\n    fp.flush()                              # 把缓冲区的内容写入硬盘\n    fp.fileno()                             # 返回一个长整型的”文件标签“\n    fp.isatty()                             # 文件是否是一个终端设备文件（unix系统中的）\n    fp.tell()                               # 返回文件操作标记的当前位置，以文件的开头为原点\n    fp.next()                               # 返回下一行，并将文件操作标记位移到下一行。把一个file用于for … in file这样的语句时，就是调用next()函数来实现遍历的。\n    fp.seek(offset[,whence])                # 将文件打开操作标记移到offset的位置。whence为0表示从头开始计算，1表示以当前位置为原点计算。2表示以文件末尾为原点进行计算。\n    fp.seekable()                           # 是否可以seek\n    fp.truncate([size])                     # 把文件裁成规定的大小，默认的是裁到当前文件操作标记的位置。\n    for line in open(\'data\'):\n        print(line)                         # 使用for语句，比较适用于打开比较大的文件\n    with open(\'data\') as file:\n        print(file.readline())              # 使用with语句，可以保证文件关闭\n    with open(\'data\') as file:\n        lines = file.readlines()            # 一次读入文件所有行，并关闭文件\n    open(\'f.txt\', encoding = \'latin-1\')     # Python3.x Unicode文本文件\n    open(\'f.bin\', \'rb\')                     # Python3.x 二进制bytes文件\n    # 文件对象还有相应的属性：buffer closed encoding errors line_buffering name newlines等\n\n#-- 其他\n    # Python中的真假值含义：1. 数字如果非零，则为真，0为假。 2. 其他对象如果非空，则为真\n    # 通常意义下的类型分类：1. 数字、序列、映射。 2. 可变类型和不可变类型\n\n\n&quot;&quot;&quot;语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句&quot;&quot;&quot;\n\n#-- 赋值语句的形式\n    spam = \'spam\'                          # 基本形式\n    spam, ham = \'spam\', \'ham\'              # 元组赋值形式\n    [spam, ham] = [\'s\', \'h\']               # 列表赋值形式\n    a, b, c, d = \'abcd\'                    # 序列赋值形式\n    a, *b, c = \'spam\'                      # 序列解包形式（Python3.x中才有）\n    spam = ham = \'no\'                      # 多目标赋值运算，涉及到共享引用\n    spam += 42                             # 增强赋值，涉及到共享引用\n\n#-- 序列赋值 序列解包\n    [a, b, c] = (1, 2, 3)                  # a = 1, b = 2, c = 3\n    a, b, c, d = &quot;spam&quot;                    # a = \'s\', b = \'p\', c = \'a\', d = \'m\'\n    a, b, c = range(3)                     # a = 0, b = 1, c = 2\n    a, *b = [1, 2, 3, 4]                   # a = 1, b = [2, 3, 4]\n    *a, b = [1, 2, 3, 4]                   # a = [1, 2, 3], b = 4\n    a, *b, c = [1, 2, 3, 4]                # a = 1, b = [2, 3], c = 4\n    # 带有*时 会优先匹配*之外的变量 如\n    a, *b, c = [1, 2]                      # a = 1, c = 2, b = []\n\n#-- print函数原型\n    print(value, ..., sep=\' \', end=\'\\n\', file=sys.stdout, flush=False)\n    # 流的重定向\n    print(\'hello world\')                   # 等于sys.stdout.write(\'hello world\')\n    temp = sys.stdout                      # 原有流的保存\n    sys.stdout = open(\'log.log\', \'a\')      # 流的重定向\n    print(\'hello world\')                   # 写入到文件log.log\n    sys.stdout.close()\n    sys.stdout = temp                      # 原有流的复原\n\n#-- Python中and或or总是返回对象(左边的对象或右边的对象) 且具有短路求值的特性\n    1 or 2 or 3                            # 返回 1\n    1 and 2 and 3                          # 返回 3\n\n#-- if/else三元表达符（if语句在行内）\n    A = 1 if X else 2\n    A = 1 if X else (2 if Y else 3)\n    # 也可以使用and-or语句（一条语句实现多个if-else）\n    a = 6\n    result = (a > 20 and &quot;big than 20&quot; or a > 10 and &quot;big than 10&quot; or a > 5 and &quot;big than 5&quot;)    # 返回&quot;big than 5&quot;\n\n#-- Python的while语句或者for语句可以带else语句 当然也可以带continue/break/pass语句\n    while a > 1:\n        anything\n    else:\n        anything\n    # else语句会在循环结束后执行，除非在循环中执行了break，同样的还有for语句\n    for i in range(5):\n        anything\n    else:\n        anything\n\n#-- for循环的元组赋值\n    for (a, b) in [(1, 2), (3, 4)]:                   # 最简单的赋值\n    for ((a, b), c) in [((1, 2), 3), ((4, 5), 6)]:    # 自动解包赋值\n    for ((a, b), c) in [((1, 2), 3), (&quot;XY&quot;, 6)]:      # 自动解包 a = X, b = Y, c = 6\n    for (a, *b) in [(1, 2, 3), (4, 5, 6)]:            # 自动解包赋值\n\n#-- 列表解析语法\n    M = [[1,2,3], [4,5,6], [7,8,9]]\n    res = [sum(row) for row in M]                     # G = [6, 15, 24] 一般的列表解析 生成一个列表\n    res = [c * 2 for c in \'spam\']                     # [\'ss\', \'pp\', \'aa\', \'mm\']\n    res = [a * b for a in [1, 2] for b in [4, 5]]     # 多解析过程 返回[4, 5, 8, 10]\n    res = [a for a in [1, 2, 3] if a < 2]             # 带判断条件的解析过程\n    res = [a if a > 0 else 0 for a in [-1, 0, 1]]     # 带判断条件的高级解析过程\n    # 两个列表同时解析：使用zip函数\n    for teama, teamb in zip([&quot;Packers&quot;, &quot;49ers&quot;], [&quot;Ravens&quot;, &quot;Patriots&quot;]):\n        print(teama + &quot; vs. &quot; + teamb)\n    # 带索引的列表解析：使用enumerate函数\n    for index, team in enumerate([&quot;Packers&quot;, &quot;49ers&quot;, &quot;Ravens&quot;, &quot;Patriots&quot;]):\n        print(index, team)                            # 输出0, Packers \\n 1, 49ers \\n ......\n\n#-- 生成器表达式\n    G = (sum(row) for row in M)                       # 使用小括号可以创建所需结果的生成器generator object\n    next(G), next(G), next(G)                         # 输出(6, 15, 24)\n    G = {sum(row) for row in M}                       # G = {6, 15, 24} 解析语法还可以生成集合和字典\n    G = {i:sum(M[i]) for i in range(3)}               # G = {0: 6, 1: 15, 2: 24}\n\n#-- 文档字符串:出现在Module的开端以及其中函数或类的开端 使用三重引号字符串\n    &quot;&quot;&quot;\n    module document\n    &quot;&quot;&quot;\n    def func():\n        &quot;&quot;&quot;\n        function document\n        &quot;&quot;&quot;\n        print()\n    class Employee(object):\n        &quot;&quot;&quot;\n        class document\n        &quot;&quot;&quot;\n        print()\n    print(func.__doc__)                # 输出函数文档字符串\n    print(Employee.__doc__)            # 输出类的文档字符串\n\n#-- 命名惯例:\n    &quot;&quot;&quot;\n    以单一下划线开头的变量名(_X)不会被from module import*等语句导入\n    前后有两个下划线的变量名(__X__)是系统定义的变量名，对解释器有特殊意义\n    以两个下划线开头但不以下划线结尾的变量名(__X)是类的本地(私有)变量\n    &quot;&quot;&quot;\n\n#-- 列表解析 in成员关系测试 map sorted zip enumerate内置函数等都使用了迭代协议\n    \'first line\' in open(\'test.txt\')   # in测试 返回True或False\n    list(map(str.upper, open(\'t\')))    # map内置函数\n    sorted(iter([2, 5, 8, 3, 1]))      # sorted内置函数\n    list(zip([1, 2], [3, 4]))          # zip内置函数 [(1, 3), (2, 4)]\n\n#-- del语句: 手动删除某个变量\n    del X\n\n#-- 获取列表的子表的方法:\n    x = [1,2,3,4,5,6]\n    x[:3]                              # 前3个[1,2,3]\n    x[1:5]                             # 中间4个[2,3,4,5]\n    x[-3:]                             # 最后3个[4,5,6]\n    x[::2]                             # 奇数项[1,3,5]\n    x[1::2]                            # 偶数项[2,4,6]\n\n#-- 手动迭代：iter和next\n    L = [1, 2]\n    I = iter(L)                        # I为L的迭代器\n    I.next()                           # 返回1\n    I.next()                           # 返回2\n    I.next()                           # Error:StopIteration\n\n#-- Python中的可迭代对象\n    &quot;&quot;&quot;\n    1.range迭代器\n    2.map、zip和filter迭代器\n    3.字典视图迭代器：D.keys()), D.items()等\n    4.文件类型\n    &quot;&quot;&quot;\n\n\n&quot;&quot;&quot;函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则&quot;&quot;&quot;\n\n#-- 函数相关的语句和表达式\n    myfunc(\'spam\')                     # 函数调用\n    def myfunc():                      # 函数定义\n    return None                        # 函数返回值\n    global a                           # 全局变量\n    nonlocal x                         # 在函数或其他作用域中使用外层（非全局）变量\n    yield x                            # 生成器函数返回\n    lambda                             # 匿名函数\n\n#-- Python函数变量名解析:LEGB原则，即:\n    &quot;&quot;&quot;\n    local(functin) --> encloseing function locals --> global(module) --> build-in(python)\n    说明:以下边的函数maker为例 则相对于action而言 X为Local N为Encloseing\n    &quot;&quot;&quot;\n\n#-- 嵌套函数举例:工厂函数\n    def maker(N):\n        def action(X):\n            return X ** N\n        return action\n    f = maker(2)                       # pass 2 to N\n    f(3)                               # 9, pass 3 to X\n\n#-- 嵌套函数举例:lambda实例\n    def maker(N):\n        action = (lambda X: X**N)\n        return action\n    f = maker(2)                       # pass 2 to N\n    f(3)                               # 9, pass 3 to X\n\n#-- nonlocal和global语句的区别\n    # nonlocal应用于一个嵌套的函数的作用域中的一个名称 例如:\n    start = 100\n    def tester(start):\n        def nested(label):\n            nonlocal start             # 指定start为tester函数内的local变量 而不是global变量start\n            print(label, start)\n            start += 3\n        return nested\n    # global为全局的变量 即def之外的变量\n    def tester(start):\n        def nested(label):\n            global start               # 指定start为global变量start\n            print(label, start)\n            start += 3\n        return nested\n\n#-- 函数参数，不可变参数通过“值”传递，可变参数通过“引用”传递\n    def f(a, b, c): print(a, b, c)\n    f(1, 2, 3)                         # 参数位置匹配\n    f(1, c = 3, b = 2)                 # 参数关键字匹配\n    def f(a, b=1, c=2): print(a, b, c)\n    f(1)                               # 默认参数匹配\n    f(1, 2)                            # 默认参数匹配\n    f(a = 1, c = 3)                    # 关键字参数和默认参数的混合\n    # Keyword-Only参数:出现在*args之后 必须用关键字进行匹配\n    def keyOnly(a, *b, c): print(\'\')   # c就为keyword-only匹配 必须使用关键字c = value匹配\n    def keyOnly(a, *, b, c): ......    # b c为keyword-only匹配 必须使用关键字匹配\n    def keyOnly(a, *, b = 1): ......   # b有默认值 或者省略 或者使用关键字参数b = value\n\n#-- 可变参数匹配: * 和 **\n    def f(*args): print(args)          # 在元组中收集不匹配的位置参数\n    f(1, 2, 3)                         # 输出(1, 2, 3)\n    def f(**args): print(args)         # 在字典中收集不匹配的关键字参数\n    f(a = 1, b = 2)                    # 输出{\'a\':1, \'b\':2}\n    def f(a, *b, **c): print(a, b, c)  # 两者混合使用\n    f(1, 2, 3, x=4, y=5)               # 输出1, (2, 3), {\'x\':4, \'y\':5}\n\n#-- 函数调用时的参数解包: * 和 ** 分别解包元组和字典\n    func(1, *(2, 3))  <==>  func(1, 2, 3)\n    func(1, **{\'c\':3, \'b\':2})  <==>  func(1, b = 2, c = 3)\n    func(1, *(2, 3), **{\'c\':3, \'b\':2})  <==>  func(1, 2, 3, b = 2, c = 3)\n\n#-- 函数属性:(自己定义的)函数可以添加属性\n    def func():.....\n    func.count = 1                     # 自定义函数添加属性\n    print.count = 1                    # Error 内置函数不可以添加属性\n\n#-- 函数注解: 编写在def头部行 主要用于说明参数范围、参数类型、返回值类型等\n    def func(a:\'spam\', b:(1, 10), c:float) -> int :\n        print(a, b, c)\n    func.__annotations__               # {\'c\':<class \'float\'>, \'b\':(1, 10), \'a\':\'spam\', \'return\':<class \'int\'>}\n    # 编写注解的同时 还是可以使用函数默认值 并且注解的位置位于=号的前边\n    def func(a:\'spam\'=\'a\', b:(1, 10)=2, c:float=3) -> int :\n        print(a, b, c)\n\n#-- 匿名函数:lambda\n    f = lambda x, y, z : x + y + z     # 普通匿名函数，使用方法f(1, 2, 3)\n    f = lambda x = 1, y = 1: x + y     # 带默认参数的lambda函数\n    def action(x):                     # 嵌套lambda函数\n        return (lambda y : x + y)\n    f = lambda: a if xxx() else b      # 无参数的lambda函数，使用方法f()\n\n#-- lambda函数与map filter reduce函数的结合\n    list(map((lambda x: x + 1), [1, 2, 3]))              # [2, 3, 4]\n    list(filter((lambda x: x > 0), range(-4, 5)))        # [1, 2, 3, 4]\n    functools.reduce((lambda x, y: x + y), [1, 2, 3])    # 6\n    functools.reduce((lambda x, y: x * y), [2, 3, 4])    # 24\n\n#-- 生成器函数:yield VS return\n    def gensquare(N):\n        for i in range(N):\n            yield i** 2                # 状态挂起 可以恢复到此时的状态\n    for i in gensquare(5):             # 使用方法\n        print(i, end = \' \')            # [0, 1, 4, 9, 16]\n    x = gensquare(2)                   # x是一个生成对象\n    next(x)                            # 等同于x.__next__() 返回0\n    next(x)                            # 等同于x.__next__() 返回1\n    next(x)                            # 等同于x.__next__() 抛出异常StopIteration\n\n#-- 生成器表达式:小括号进行列表解析\n    G = (x ** 2 for x in range(3))     # 使用小括号可以创建所需结果的生成器generator object\n    next(G), next(G), next(G)          # 和上述中的生成器函数的返回值一致\n    #（1）生成器(生成器函数/生成器表达式)是单个迭代对象\n    G = (x ** 2 for x in range(4))\n    I1 = iter(G)                       # 这里实际上iter(G) = G\n    next(I1)                           # 输出0\n    next(G)                            # 输出1\n    next(I1)                           # 输出4\n    #（2）生成器不保留迭代后的结果\n    gen = (i for i in range(4))\n    2 in gen                           # 返回True\n    3 in gen                           # 返回True\n    1 in gen                           # 返回False，其实检测2的时候，1已经就不在生成器中了，即1已经被迭代过了，同理2、3也不在了\n\n#-- 本地变量是静态检测的\n    X = 22                             # 全局变量X的声明和定义\n    def test():\n        print(X)                       # 如果没有下一语句 则该句合法 打印全局变量X\n        X = 88                         # 这一语句使得上一语句非法 因为它使得X变成了本地变量 上一句变成了打印一个未定义的本地变量(局部变量)\n        if False:                      # 即使这样的语句 也会把print语句视为非法语句 因为:\n            X = 88                     # Python会无视if语句而仍然声明了局部变量X\n    def test():                        # 改进\n        global X                       # 声明变量X为全局变量\n        print(X)                       # 打印全局变量X\n        X = 88                         # 改变全局变量X\n\n#-- 函数的默认值是在函数定义的时候实例化的 而不是在调用的时候 例子:\n    def foo(numbers=[]):               # 这里的[]是可变的\n        numbers.append(9)\n        print(numbers)\n    foo()                              # first time, like before, [9]\n    foo()                              # second time, not like before, [9, 9]\n    foo()                              # third time, not like before too, [9, 9, 9]\n    # 改进:\n    def foo(numbers=None):\n        if numbers is None: numbers = []\n        numbers.append(9)\n        print(numbers)\n    # 另外一个例子 参数的默认值为不可变的:\n    def foo(count=0):                  # 这里的0是数字, 是不可变的\n        count += 1\n        print(count)\n    foo()                              # 输出1\n    foo()                              # 还是输出1\n    foo(3)                             # 输出4\n    foo()                              # 还是输出1\n\n\n&quot;&quot;&quot;函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子&quot;&quot;&quot;\n\n    &quot;&quot;&quot;数学运算类&quot;&quot;&quot;\n    abs(x)                              # 求绝对值，参数可以是整型，也可以是复数，若参数是复数，则返回复数的模\n    complex([real[, imag]])             # 创建一个复数\n    divmod(a, b)                        # 分别取商和余数，注意：整型、浮点型都可以\n    float([x])                          # 将一个字符串或数转换为浮点数。如果无参数将返回0.0\n    int([x[, base]])                    # 将一个字符串或浮点数转换为int类型，base表示进制\n    long([x[, base]])                   # 将一个字符串或浮点数转换为long类型\n    pow(x, y)                           # 返回x的y次幂\n    range([start], stop[, step])        # 产生一个序列，默认从0开始\n    round(x[, n])                       # 四舍五入\n    sum(iterable[, start])              # 对集合求和\n    oct(x)                              # 将一个数字转化为8进制字符串\n    hex(x)                              # 将一个数字转换为16进制字符串\n    chr(i)                              # 返回给定int类型对应的ASCII字符\n    unichr(i)                           # 返回给定int类型的unicode\n    ord(c)                              # 返回ASCII字符对应的整数\n    bin(x)                              # 将整数x转换为二进制字符串\n    bool([x])                           # 将x转换为Boolean类型\n\n    &quot;&quot;&quot;集合类操作&quot;&quot;&quot;\n    basestring()                        # str和unicode的超类，不能直接调用，可以用作isinstance判断\n    format(value [, format_spec])       # 格式化输出字符串，格式化的参数顺序从0开始，如“I am {0},I like {1}”\n    enumerate(sequence[, start=0])      # 返回一个可枚举的对象，注意它有第二个参数\n    iter(obj[, sentinel])               # 生成一个对象的迭代器，第二个参数表示分隔符\n    max(iterable[, args...][key])       # 返回集合中的最大值\n    min(iterable[, args...][key])       # 返回集合中的最小值\n    dict([arg])                         # 创建数据字典\n    list([iterable])                    # 将一个集合类转换为另外一个集合类\n    set()                               # set对象实例化\n    frozenset([iterable])               # 产生一个不可变的set\n    tuple([iterable])                   # 生成一个tuple类型\n    str([object])                       # 转换为string类型\n    sorted(iterable[, cmp[, key[, reverse]]])             # 集合排序\n        L = [(\'b\',2),(\'a\',1),(\'c\',3),(\'d\',4)]\n        sorted(L, key=lambda x: x[1], reverse=True)       # 使用Key参数和reverse参数\n        sorted(L, key=lambda x: (x[0], x[1]))             # 使用key参数进行多条件排序，即如果x[0]相同，则比较x[1]\n\n    &quot;&quot;&quot;逻辑判断&quot;&quot;&quot;\n    all(iterable)                       # 集合中的元素都为真的时候为真，特别的，若为空串返回为True\n    any(iterable)                       # 集合中的元素有一个为真的时候为真，特别的，若为空串返回为False\n    cmp(x, y)                           # 如果x < y ,返回负数；x == y, 返回0；x > y,返回正数\n\n    &quot;&quot;&quot;IO操作&quot;&quot;&quot;\n    file(filename [, mode [, bufsize]]) # file类型的构造函数。\n    input([prompt])                     # 获取用户输入，推荐使用raw_input，因为该函数将不会捕获用户的错误输入，意思是自行判断类型\n    # 在 Built-in Functions 里有一句话是这样写的：Consider using the raw_input() function for general input from users.\n    raw_input([prompt])                 # 设置输入，输入都是作为字符串处理\n    open(name[, mode[, buffering]])     # 打开文件，与file有什么不同？推荐使用open\n\n    &quot;&quot;&quot;其他&quot;&quot;&quot;\n    callable(object)                    # 检查对象object是否可调用\n    classmethod(func)                   # 用来说明这个func是个类方法\n    staticmethod(func)                  # 用来说明这个func为静态方法\n    dir([object])                       # 不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。\n    help(obj)                           # 返回obj的帮助信息\n    eval(expression)                    # 计算表达式expression的值，并返回\n    exec(str)                           # 将str作为Python语句执行\n    execfile(filename)                  # 用法类似exec()，不同的是execfile的参数filename为文件名，而exec的参数为字符串。\n    filter(function, iterable)          # 构造一个序列，等价于[item for item in iterable if function(item)]，function返回值为True或False的函数\n        list(filter(bool, range(-3, 4)))# 返回[-3, -2, -1, 1, 2, 3], 没有0\n    hasattr(object, name)               # 判断对象object是否包含名为name的特性\n    getattr(object, name [, defalut])   # 获取一个类的属性\n    setattr(object, name, value)        # 设置属性值\n    delattr(object, name)               # 删除object对象名为name的属性\n    globals()                           # 返回一个描述当前全局符号表的字典\n    hash(object)                        # 如果对象object为哈希表类型，返回对象object的哈希值\n    id(object)                          # 返回对象的唯一标识，一串数字\n    isinstance(object, classinfo)       # 判断object是否是class的实例\n        isinstance(1, int)              # 判断是不是int类型\n        isinstance(1, (int, float))     # isinstance的第二个参数接受一个元组类型\n    issubclass(class, classinfo)        # 判断class是否为classinfo的子类\n    locals()                            # 返回当前的变量列表\n    map(function, iterable, ...)        # 遍历每个元素，执行function操作\n        list(map(abs, range(-3, 4)))    # 返回[3, 2, 1, 0, 1, 2, 3]\n    next(iterator[, default])           # 类似于iterator.next()\n    property([fget[, fset[, fdel[, doc]]]])           # 属性访问的包装类，设置后可以通过c.x=value等来访问setter和getter\n    reduce(function, iterable[, initializer])         # 合并操作，从第一个开始是前两个参数，然后是前两个的结果与第三个合并进行处理，以此类推\n        def add(x,y):return x + y\n        reduce(add, range(1, 11))                     # 返回55 (注:1+2+3+4+5+6+7+8+9+10 = 55)\n        reduce(add, range(1, 11), 20)                 # 返回75\n    reload(module)                      # 重新加载模块\n    repr(object)                        # 将一个对象变幻为可打印的格式\n    slice(start, stop[, step])          # 产生分片对象\n    type(object)                        # 返回该object的类型\n    vars([object])                      # 返回对象的变量名、变量值的字典\n        a = Class();                    # Class为一个空类\n        a.name = \'qi\', a.age = 9\n        vars(a)                         # {\'name\':\'qi\', \'age\':9}\n    zip([iterable, ...])                # 返回对应数组\n        list(zip([1, 2, 3], [4, 5, 6])) # [(1, 4), (2, 5), (3, 6)]\n        a = [1, 2, 3],  b = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]\n        z = zip(a, b)                   # 压缩：[(1, &quot;a&quot;), (2, &quot;b&quot;), (3, &quot;c&quot;)]\n        zip(*z)                         # 解压缩：[(1, 2, 3), (&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)]\n    unicode(string, encoding, errors)   # 将字符串string转化为unicode形式，string为encoded string。\n\n\n&quot;&quot;&quot;模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle&quot;&quot;&quot;\n\n#-- Python模块搜索路径:\n    &quot;&quot;&quot;\n    (1)程序的主目录    (2)PYTHONPATH目录 (3)标准链接库目录 (4)任何.pth文件的内容\n    &quot;&quot;&quot;\n\n#-- 查看全部的模块搜索路径\n    import sys\n    sys.path\n    sys.argv                            # 获得脚本的参数\n    sys.builtin_module_names            # 查找内建模块\n    sys.platform                        # 返回当前平台 出现如： &quot;win32&quot; &quot;linux&quot; &quot;darwin&quot;等\n    sys.modules                         # 查找已导入的模块\n    sys.modules.keys()\n    sys.stdout                          # stdout 和 stderr 都是类文件对象，但是它们都是只写的。它们都没有 read 方法，只有 write 方法\n    sys.stdout.write(&quot;hello&quot;)\n    sys.stderr\n    sys.stdin\n\n#-- 模块的使用代码\n    import module1, module2             # 导入module1 使用module1.printer()\n    from module1 import printer         # 导入module1中的printer变量 使用printer()\n    from module1 import *               # 导入module1中的全部变量 使用不必添加module1前缀\n\n#-- 重载模块reload: 这是一个内置函数 而不是一条语句\n    from imp import reload\n    reload(module)\n\n#-- 模块的包导入:使用点号(.)而不是路径(dir1\\dir2)进行导入\n    import dir1.dir2.mod                # d导入包(目录)dir1中的包dir2中的mod模块 此时dir1必须在Python可搜索路径中\n    from dir1.dir2.mod import *         # from语法的包导入\n\n#-- __init__.py包文件:每个导入的包中都应该包含这么一个文件\n    &quot;&quot;&quot;\n    该文件可以为空\n    首次进行包导入时 该文件会自动执行\n    高级功能:在该文件中使用__all__列表来定义包(目录)以from*的形式导入时 需要导入什么\n    &quot;&quot;&quot;\n\n#-- 包相对导入:使用点号(.) 只能使用from语句\n    from . import spam                  # 导入当前目录下的spam模块（Python2: 当前目录下的模块, 直接导入即可）\n    from .spam import name              # 导入当前目录下的spam模块的name属性（Python2: 当前目录下的模块, 直接导入即可，不用加.）\n    from .. import spam                 # 导入当前目录的父目录下的spam模块\n\n#-- 包相对导入与普通导入的区别\n    from string import *                # 这里导入的string模块为sys.path路径上的 而不是本目录下的string模块(如果存在也不是)\n    from .string import *               # 这里导入的string模块为本目录下的(不存在则导入失败) 而不是sys.path路径上的\n\n#-- 模块数据隐藏:最小化from*的破坏\n    _X                                  # 变量名前加下划线可以防止from*导入时该变量名被复制出去\n    __all__ = [\'x\', \'x1\', \'x2\']         # 使用__all__列表指定from*时复制出去的变量名(变量名在列表中为字符串形式)\n\n#-- 可以使用__name__进行模块的单元测试:当模块为顶层执行文件时值为\'__main__\' 当模块被导入时为模块名\n    if __name__ == \'__main__\':\n        doSomething\n    # 模块属性中还有其他属性，例如：\n    __doc__                             # 模块的说明文档\n    __file__                            # 模块文件的文件名，包括全路径\n    __name__                            # 主文件或者被导入文件\n    __package__                         # 模块所在的包\n\n#-- import语句from语句的as扩展\n    import modulename as name\n    from modulename import attrname as name\n\n#-- 得到模块属性的几种方法 假设为了得到name属性的值\n    M.name\n    M.__dict__[\'name\']\n    sys.modules[\'M\'].name\n    getattr(M, \'name\')\n\n\n&quot;&quot;&quot;类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象&quot;&quot;&quot;\n\n#-- 最普通的类\n    class C1(C2, C3):\n        spam = 42                       # 数据属性\n        def __init__(self, name):       # 函数属性:构造函数\n            self.name = name\n        def __del__(self):              # 函数属性:析构函数\n            print(&quot;goodbey &quot;, self.name)\n    I1 = C1(\'bob\')\n\n#-- Python的类没有基于参数的函数重载\n    class FirstClass(object):\n        def test(self, string):\n            print(string)\n        def test(self):                 # 此时类中只有一个test函数 即后者test(self) 它覆盖掉前者带参数的test函数\n            print(&quot;hello world&quot;)\n\n#-- 子类扩展超类: 尽量调用超类的方法\n    class Manager(Person):\n        def giveRaise(self, percent, bonus = .10):\n            self.pay = int(self.pay*(1 + percent + bonus))     # 不好的方式 复制粘贴超类代码\n            Person.giveRaise(self, percent + bonus)            # 好的方式 尽量调用超类方法\n\n#-- 类内省工具\n    bob = Person(\'bob\')\n    bob.__class__                       # <class \'Person\'>\n    bob.__class__.__name__              # \'Person\'\n    bob.__dict__                        # {\'pay\':0, \'name\':\'bob\', \'job\':\'Manager\'}\n\n#-- 返回1中 数据属性spam是属于类 而不是对象\n    I1 = C1(\'bob\'); I2 = C2(\'tom\')      # 此时I1和I2的spam都为42 但是都是返回的C1的spam属性\n    C1.spam = 24                        # 此时I1和I2的spam都为24\n    I1.spam = 3                         # 此时I1新增自有属性spam 值为3 I2和C1的spam还都为24\n\n#-- 类方法调用的两种方式\n    instance.method(arg...)\n    class.method(instance, arg...)\n\n#-- 抽象超类的实现方法\n    # (1)某个函数中调用未定义的函数 子类中定义该函数\n        def delegate(self):\n            self.action()               # 本类中不定义action函数 所以使用delegate函数时就会出错\n    # (2)定义action函数 但是返回异常\n        def action(self):\n            raise NotImplementedError(&quot;action must be defined&quot;)\n    # (3)上述的两种方法还都可以定义实例对象 实际上可以利用@装饰器语法生成不能定义的抽象超类\n        from abc import ABCMeta, abstractmethod\n        class Super(metaclass = ABCMeta):\n            @abstractmethod\n            def action(self): pass\n        x = Super()                     # 返回 TypeError: Can\'t instantiate abstract class Super with abstract methods action\n\n#-- # OOP和继承: &quot;is-a&quot;的关系\n    class A(B):\n        pass\n    a = A()\n    isinstance(a, B)                    # 返回True, A是B的子类 a也是B的一种\n    # OOP和组合: &quot;has-a&quot;的关系\n    pass\n    # OOP和委托: &quot;包装&quot;对象 在Python中委托通常是以&quot;__getattr__&quot;钩子方法实现的, 这个方法会拦截对不存在属性的读取\n    # 包装类(或者称为代理类)可以使用__getattr__把任意读取转发给被包装的对象\n    class wrapper(object):\n        def __init__(self, object):\n            self.wrapped = object\n        def __getattr(self, attrname):\n            print(\'Trace: \', attrname)\n            return getattr(self.wrapped, attrname)\n    # 注:这里使用getattr(X, N)内置函数以变量名字符串N从包装对象X中取出属性 类似于X.__dict__[N]\n    x = wrapper([1, 2, 3])\n    x.append(4)                         # 返回 &quot;Trace: append&quot; [1, 2, 3, 4]\n    x = wrapper({\'a\':1, \'b\':2})\n    list(x.keys())                      # 返回 &quot;Trace: keys&quot; [\'a\', \'b\']\n\n#-- 类的伪私有属性:使用__attr\n    class C1(object):\n        def __init__(self, name):\n            self.__name = name          # 此时类的__name属性为伪私有属性 原理 它会自动变成self._C1__name = name\n        def __str__(self):\n            return \'self.name = %s\' % self.__name\n    I = C1(\'tom\')\n    print(I)                            # 返回 self.name = tom\n    I.__name = \'jeey\'                   # 这里无法访问 __name为伪私有属性\n    I._C1__name = \'jeey\'                # 这里可以修改成功 self.name = jeey\n\n#-- 类方法是对象:无绑定类方法对象 / 绑定实例方法对象\n    class Spam(object):\n        def doit(self, message):\n            print(message)\n        def selfless(message)\n            print(message)\n    obj = Spam()\n    x = obj.doit                        # 类的绑定方法对象 实例 + 函数\n    x(\'hello world\')\n    x = Spam.doit                       # 类的无绑定方法对象 类名 + 函数\n    x(obj, \'hello world\')\n    x = Spam.selfless                   # 类的无绑定方法函数 在3.0之前无效\n    x(\'hello world\')\n\n#-- 获取对象信息: 属性和方法\n    a = MyObject()\n    dir(a)                              # 使用dir函数\n    hasattr(a, \'x\')                     # 测试是否有x属性或方法 即a.x是否已经存在\n    setattr(a, \'y\', 19)                 # 设置属性或方法 等同于a.y = 19\n    getattr(a, \'z\', 0)                  # 获取属性或方法 如果属性不存在 则返回默认值0\n    #这里有个小技巧，setattr可以设置一个不能访问到的属性，即只能用getattr获取\n    setattr(a, &quot;can\'t touch&quot;, 100)      # 这里的属性名带有空格，不能直接访问\n    getattr(a, &quot;can\'t touch&quot;, 0)        # 但是可以用getattr获取\n\n#-- 为类动态绑定属性或方法: MethodType方法\n    # 一般创建了一个class的实例后, 可以给该实例绑定任何属性和方法, 这就是动态语言的灵活性\n    class Student(object):\n        pass\n    s = Student()\n    s.name = \'Michael\'                  # 动态给实例绑定一个属性\n    def set_age(self, age):             # 定义一个函数作为实例方法\n        self.age = age\n    from types import MethodType\n    s.set_age = MethodType(set_age, s)  # 给实例绑定一个方法 类的其他实例不受此影响\n    s.set_age(25)                       # 调用实例方法\n    Student.set_age = MethodType(set_age, Student)    # 为类绑定一个方法 类的所有实例都拥有该方法\n\n\n&quot;&quot;&quot;类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题&quot;&quot;&quot;\n\n#-- 多重继承: &quot;混合类&quot;, 搜索方式&quot;从下到上 从左到右 广度优先&quot;\n    class A(B, C):\n        pass\n\n#-- 类的继承和子类的初始化\n    # 1.子类定义了__init__方法时，若未显示调用基类__init__方法，python不会帮你调用。\n    # 2.子类未定义__init__方法时，python会自动帮你调用首个基类的__init__方法，注意是首个。\n    # 3.子类显示调用基类的初始化函数：\n    class FooParent(object):\n        def __init__(self, a):\n            self.parent = \'I\\\'m the Parent.\'\n            print(\'Parent:a=\' + str(a))\n        def bar(self, message):\n            print(message + \' from Parent\')\n    class FooChild(FooParent):\n        def __init__(self, a):\n            FooParent.__init__(self, a)\n            print(\'Child:a=\' + str(a))\n        def bar(self, message):\n            FooParent.bar(self, message)\n            print(message + \' from Child\')\n    fooChild = FooChild(10)\n    fooChild.bar(\'HelloWorld\')\n\n#-- #实例方法 / 静态方法 / 类方法\n    class Methods(object):\n        def imeth(self, x): print(self, x)      # 实例方法：传入的是实例和数据，操作的是实例的属性\n        def smeth(x): print(x)                  # 静态方法：只传入数据 不传入实例，操作的是类的属性而不是实例的属性\n        def cmeth(cls, x): print(cls, x)        # 类方法：传入的是类对象和数据\n        smeth = staticmethod(smeth)             # 调用内置函数，也可以使用@staticmethod\n        cmeth = classmethod(cmeth)              # 调用内置函数，也可以使用@classmethod\n    obj = Methods()\n    obj.imeth(1)                                # 实例方法调用 <__main__.Methods object...> 1\n    Methods.imeth(obj, 2)                       # <__main__.Methods object...> 2\n    Methods.smeth(3)                            # 静态方法调用 3\n    obj.smeth(4)                                # 这里可以使用实例进行调用\n    Methods.cmeth(5)                            # 类方法调用 <class \'__main__.Methods\'> 5\n    obj.cmeth(6)                                # <class \'__main__.Methods\'> 6\n\n#-- 函数装饰器:是它后边的函数的运行时的声明 由@符号以及后边紧跟的&quot;元函数&quot;(metafunction)组成\n        @staticmethod\n        def smeth(x): print(x)\n    # 等同于:\n        def smeth(x): print(x)\n        smeth = staticmethod(smeth)\n    # 同理\n        @classmethod\n        def cmeth(cls, x): print(x)\n    # 等同于\n        def cmeth(cls, x): print(x)\n        cmeth = classmethod(cmeth)\n\n#-- 类修饰器:是它后边的类的运行时的声明 由@符号以及后边紧跟的&quot;元函数&quot;(metafunction)组成\n        def decorator(aClass):.....\n        @decorator\n        class C(object):....\n    # 等同于:\n        class C(object):....\n        C = decorator(C)\n\n#-- 限制class属性: __slots__属性\n    class Student(object):\n        __slots__ = (\'name\', \'age\')             # 限制Student及其实例只能拥有name和age属性\n    # __slots__属性只对当前类起作用, 对其子类不起作用\n    # __slots__属性能够节省内存\n    # __slots__属性可以为列表list，或者元组tuple\n\n#-- 类属性高级话题: @property\n    # 假设定义了一个类:C，该类必须继承自object类，有一私有变量_x\n    class C(object):\n        def __init__(self):\n            self.__x = None\n    # 第一种使用属性的方法\n        def getx(self):\n            return self.__x\n        def setx(self, value):\n            self.__x = value\n        def delx(self):\n            del self.__x\n        x = property(getx, setx, delx, \'\')\n    # property函数原型为property(fget=None,fset=None,fdel=None,doc=None)\n    # 使用\n    c = C()\n    c.x = 100                         # 自动调用setx方法\n    y = c.x                           # 自动调用getx方法\n    del c.x                           # 自动调用delx方法\n    # 第二种方法使用属性的方法\n        @property\n        def x(self):\n            return self.__x\n        @x.setter\n        def x(self, value):\n           self.__x = value\n        @x.deleter\n        def x(self):\n           del self.__x\n    # 使用\n    c = C()\n    c.x = 100                         # 自动调用setter方法\n    y = c.x                           # 自动调用x方法\n    del c.x                           # 自动调用deleter方法\n\n#-- 定制类: 重写类的方法\n    # (1)__str__方法、__repr__方法: 定制类的输出字符串\n    # (2)__iter__方法、next方法: 定制类的可迭代性\n    class Fib(object):\n        def __init__(self):\n            self.a, self.b = 0, 1     # 初始化两个计数器a，b\n        def __iter__(self):\n            return self               # 实例本身就是迭代对象，故返回自己\n        def next(self):\n            self.a, self.b = self.b, self.a + self.b\n            if self.a > 100000:       # 退出循环的条件\n                raise StopIteration()\n            return self.a             # 返回下一个值\n    for n in Fib():\n        print(n)                      # 使用\n    # (3)__getitem__方法、__setitem__方法: 定制类的下标操作[] 或者切片操作slice\n    class Indexer(object):\n        def __init__(self):\n            self.data = {}\n        def __getitem__(self, n):             # 定义getitem方法\n            print(\'getitem:\', n)\n            return self.data[n]\n        def __setitem__(self, key, value):    # 定义setitem方法\n            print(\'setitem:key = {0}, value = {1}\'.format(key, value))\n            self.data[key] = value\n    test = Indexer()\n    test[0] = 1;   test[3] = \'3\'              # 调用setitem方法\n    print(test[0])                            # 调用getitem方法\n    # (4)__getattr__方法: 定制类的属性操作\n    class Student(object):\n        def __getattr__(self, attr):          # 定义当获取类的属性时的返回值\n            if attr==\'age\':\n                return 25                     # 当获取age属性时返回25\n        raise AttributeError(\'object has no attribute: %s\' % attr)\n        # 注意: 只有当属性不存在时 才会调用该方法 且该方法默认返回None 需要在函数最后引发异常\n    s = Student()\n    s.age                                     # s中age属性不存在 故调用__getattr__方法 返回25\n    # (5)__call__方法: 定制类的\'可调用\'性\n    class Student(object):\n        def __call__(self):                   # 也可以带参数\n            print(\'Calling......\')\n    s = Student()\n    s()                                       # s变成了可调用的 也可以带参数\n    callable(s)                               # 测试s的可调用性 返回True\n    #    (6)__len__方法：求类的长度\n    def __len__(self):\n        return len(self.data)\n\n#-- 动态创建类type()\n    # 一般创建类 需要在代码中提前定义\n        class Hello(object):\n            def hello(self, name=\'world\'):\n                print(\'Hello, %s.\' % name)\n        h = Hello()\n        h.hello()                             # Hello, world\n        type(Hello)                           # Hello是一个type类型 返回<class \'type\'>\n        type(h)                               # h是一个Hello类型 返回<class \'Hello\'>\n    # 动态类型语言中 类可以动态创建 type函数可用于创建新类型\n        def fn(self, name=\'world\'):           # 先定义函数\n            print(\'Hello, %s.\' % name)\n        Hello = type(\'Hello\', (object,), dict(hello=fn))    # 创建Hello类 type原型: type(name, bases, dict)\n        h = Hello()                           # 此时的h和上边的h一致\n\n\n&quot;&quot;&quot;异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关&quot;&quot;&quot;\n\n#-- #捕获异常:\n        try:\n        except:                               # 捕获所有的异常 等同于except Exception:\n        except name:                          # 捕获指定的异常\n        except name, value:                   # 捕获指定的异常和额外的数据(实例)\n        except (name1, name2):\n        except (name1, name2), value:\n        except name4 as X:\n        else:                                 # 如果没有发生异常\n        finally:                              # 总会执行的部分\n    # 引发异常: raise子句(raise IndexError)\n        raise <instance>                      # raise instance of a class, raise IndexError()\n        raise <class>                         # make and raise instance of a class, raise IndexError\n        raise                                 # reraise the most recent exception\n\n#-- Python3.x中的异常链: raise exception from otherException\n    except Exception as X:\n        raise IndexError(\'Bad\') from X\n\n#-- assert子句: assert <test>, <data>\n    assert x < 0, \'x must be negative\'\n\n#-- with/as环境管理器:作为常见的try/finally用法模式的替代方案\n    with expression [as variable], expression [as variable]:\n    # 例子:\n        with open(\'test.txt\') as myfile:\n            for line in myfile: print(line)\n    # 等同于:\n        myfile = open(\'test.txt\')\n        try:\n            for line in myfile: print(line)\n        finally:\n            myfile.close()\n\n#-- 用户自定义异常: class Bad(Exception):.....\n    &quot;&quot;&quot;\n    Exception超类 / except基类即可捕获到其所有子类\n    Exception超类有默认的打印消息和状态 当然也可以定制打印显示:\n    &quot;&quot;&quot;\n    class MyBad(Exception):\n        def __str__(self):\n            return \'定制的打印消息\'\n    try:\n        MyBad()\n    except MyBad as x:\n        print(x)\n\n#-- 用户定制异常数据\n    class FormatError(Exception):\n        def __init__(self, line ,file):\n            self.line = line\n            self.file = file\n    try:\n        raise FormatError(42, \'test.py\')\n    except FormatError as X:\n        print(\'Error at \', X.file, X.line)\n    # 用户定制异常行为(方法):以记录日志为例\n    class FormatError(Exception):\n        logfile = \'formaterror.txt\'\n        def __init__(self, line ,file):\n            self.line = line\n            self.file = file\n        def logger(self):\n            open(self.logfile, \'a\').write(\'Error at \', self.file, self.line)\n    try:\n        raise FormatError(42, \'test.py\')\n    except FormatError as X:\n        X.logger()\n\n#-- 关于sys.exc_info:允许一个异常处理器获取对最近引发的异常的访问\n    try:\n        ......\n    except:\n        # 此时sys.exc_info()返回一个元组(type, value, traceback)\n        # type:正在处理的异常的异常类型\n        # value:引发的异常的实例\n        # traceback:堆栈信息\n\n#-- 异常层次\n    BaseException\n    +-- SystemExit\n    +-- KeyboardInterrupt\n    +-- GeneratorExit\n    +-- Exception\n        +-- StopIteration\n        +-- ArithmeticError\n        +-- AssertionError\n        +-- AttributeError\n        +-- BufferError\n        +-- EOFError\n        +-- ImportError\n        +-- LookupError\n        +-- MemoryError\n        +-- NameError\n        +-- OSError\n        +-- ReferenceError\n        +-- RuntimeError\n        +-- SyntaxError\n        +-- SystemError\n        +-- TypeError\n        +-- ValueError\n        +-- Warning\n\n\n&quot;&quot;&quot;Unicode和字节字符串---Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串&quot;&quot;&quot;\n\n#-- Python的字符串类型\n    &quot;&quot;&quot;Python2.x&quot;&quot;&quot;\n    # 1.str表示8位文本和二进制数据\n    # 2.unicode表示宽字符Unicode文本\n    &quot;&quot;&quot;Python3.x&quot;&quot;&quot;\n    # 1.str表示Unicode文本（8位或者更宽）\n    # 2.bytes表示不可变的二进制数据\n    # 3.bytearray是一种可变的bytes类型\n\n#-- 字符编码方法\n    &quot;&quot;&quot;ASCII&quot;&quot;&quot;                   # 一个字节，只包含英文字符，0到127，共128个字符，利用函数可以进行字符和数字的相互转换\n    ord(\'a\')                      # 字符a的ASCII码为97，所以这里返回97\n    chr(97)                       # 和上边的过程相反，返回字符\'a\'\n    &quot;&quot;&quot;Latin-1&quot;&quot;&quot;                 # 一个字节，包含特殊字符，0到255，共256个字符，相当于对ASCII码的扩展\n    chr(196)                      # 返回一个特殊字符：Ä\n    &quot;&quot;&quot;Unicode&quot;&quot;&quot;                 # 宽字符，一个字符包含多个字节，一般用于亚洲的字符集，比如中文有好几万字\n    &quot;&quot;&quot;UTF-8&quot;&quot;&quot;                   # 可变字节数，小于128的字符表示为单个字节，128到0X7FF之间的代码转换为两个字节，0X7FF以上的代码转换为3或4个字节\n    # 注意：可以看出来，ASCII码是Latin-1和UTF-8的一个子集\n    # 注意：utf-8是unicode的一种实现方式，unicode、gbk、gb2312是编码字符集\n\n#-- 查看Python中的字符串编码名称，查看系统的编码\n    import encodings\n    help(encoding)\n    import sys\n    sys.platform                  # \'win64\'\n    sys.getdefaultencoding()      # \'utf-8\'\n    sys.getdefaultencoding()      # 返回当前系统平台的编码类型\n    sys.getsizeof(object)         # 返回object占有的bytes的大小\n\n#-- 源文件字符集编码声明: 添加注释来指定想要的编码形式 从而改变默认值 注释必须出现在脚本的第一行或者第二行\n    &quot;&quot;&quot;说明：其实这里只会检查#和coding:utf-8，其余的字符都是为了美观加上的&quot;&quot;&quot;\n    # _*_ coding: utf-8 _*_\n    # coding = utf-8\n\n#-- #编码: 字符串 --> 原始字节       #解码: 原始字节 --> 字符串\n\n#-- Python3.x中的字符串应用\n    s = \'...\'                     # 构建一个str对象，不可变对象\n    b = b\'...\'                    # 构建一个bytes对象，不可变对象\n    s[0], b[0]                    # 返回(\'.\', 113)\n    s[1:], b[1:]                  # 返回(\'..\', b\'..\')\n    B = B&quot;&quot;&quot;\n        xxxx\n        yyyy\n        &quot;&quot;&quot;\n    # B = b\'\\nxxxx\\nyyyy\\n\'\n    # 编码，将str字符串转化为其raw bytes形式：\n        str.encode(encoding = \'utf-8\', errors = \'strict\')\n        bytes(str, encoding)\n    # 编码例子：\n        S = \'egg\'\n        S.encode()                    # b\'egg\'\n        bytes(S, encoding = \'ascii\')  # b\'egg\'\n    # 解码，将raw bytes字符串转化为str形式：\n        bytes.decode(encoding = \'utf-8\', errors = \'strict\')\n        str(bytes_or_buffer[, encoding[, errors]])\n    # 解码例子：\n        B = b\'spam\'\n        B.decode()                # \'spam\'\n        str(B)                    # &quot;b\'spam\'&quot;，不带编码的str调用，结果为打印该bytes对象\n        str(B, encoding = \'ascii\')# \'spam\'，带编码的str调用，结果为转化该bytes对象\n\n#-- Python2.x的编码问题\n    u = u\'汉\'\n    print repr(u)                 # u\'\\xba\\xba\'\n    s = u.encode(\'UTF-8\')\n    print repr(s)                 # \'\\xc2\\xba\\xc2\\xba\'\n    u2 = s.decode(\'UTF-8\')\n    print repr(u2)                # u\'\\xba\\xba\'\n    # 对unicode进行解码是错误的\n    s2 = u.decode(\'UTF-8\')        # UnicodeEncodeError: \'ascii\' codec can\'t encode characters in position 0-1: ordinal not in range(128)\n    # 同样，对str进行编码也是错误的\n    u2 = s.encode(\'UTF-8\')        # UnicodeDecodeError: \'ascii\' codec can\'t decode byte 0xc2 in position 0: ordinal not in range(128)\n\n#-- bytes对象\n    B = b\'abc\'\n    B = bytes(\'abc\', \'ascii\')\n    B = bytes([97, 98, 99])\n    B = \'abc\'.encode()\n    # bytes对象的方法调用基本和str类型一致 但:B[0]返回的是ASCII码值97, 而不是b\'a\'\n\n#-- #文本文件: 根据Unicode编码来解释文件内容，要么是平台的默认编码，要么是指定的编码类型\n    # 二进制文件：表示字节值的整数的一个序列 open(\'bin.txt\', \'rb\')\n\n#-- Unicode文件\n    s = \'A\\xc4B\\xe8C\'             # s = \'A?BèC\'  len(s) = 5\n    #手动编码\n        l = s.encode(\'latin-1\')   # l = b\'A\\xc4B\\xe8C\'  len(l) = 5\n        u = s.encode(\'utf-8\')     # u = b\'A\\xc3\\x84B\\xc3\\xa8C\'  len(u) = 7\n    #文件输出编码\n        open(\'latindata\', \'w\', encoding = \'latin-1\').write(s)\n        l = open(\'latindata\', \'rb\').read()                        # l = b\'A\\xc4B\\xe8C\'  len(l) = 5\n        open(\'uft8data\', \'w\', encoding = \'utf-8\').write(s)\n        u = open(\'uft8data\', \'rb\').read()                         # u = b\'A\\xc3\\x84B\\xc3\\xa8C\'  len(u) = 7\n    #文件输入编码\n        s = open(\'latindata\', \'r\', encoding = \'latin-1\').read()   # s = \'A?BèC\'  len(s) = 5\n        s = open(\'latindata\', \'rb\').read().decode(\'latin-1\')      # s = \'A?BèC\'  len(s) = 5\n        s = open(\'utf8data\', \'r\', encoding = \'utf-8\').read()      # s = \'A?BèC\'  len(s) = 5\n        s = open(\'utf8data\', \'rb\').read().decode(\'utf-8\')         # s = \'A?BèC\'  len(s) = 5\n\n\n&quot;&quot;&quot;其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他&quot;&quot;&quot;\n\n#-- Python实现任意深度的赋值 例如a[0] = \'value1\'; a[1][2] = \'value2\'; a[3][4][5] = \'value3\'\n    class MyDict(dict):\n        def __setitem__(self, key, value):                 # 该函数不做任何改动 这里只是为了输出\n            print(\'setitem:\', key, value, self)\n            super().__setitem__(key, value)\n        def __getitem__(self, item):                       # 主要技巧在该函数\n            print(\'getitem:\', item, self)                  # 输出信息\n            # 基本思路: a[1][2]赋值时 需要先取出a[1] 然后给a[1]的[2]赋值\n            if item not in self:                           # 如果a[1]不存在 则需要新建一个dict 并使得a[1] = dict\n                temp = MyDict()                            # 新建的dict: temp\n                super().__setitem__(item, temp)            # 赋值a[1] = temp\n                return temp                                # 返回temp 使得temp[2] = value有效\n            return super().__getitem__(item)               # 如果a[1]存在 则直接返回a[1]\n    # 例子:\n        test = MyDict()\n        test[0] = \'test\'\n        print(test[0])\n        test[1][2] = \'test1\'\n        print(test[1][2])\n        test[1][3] = \'test2\'\n        print(test[1][3])\n\n#-- Python中的多维数组\n    lists = [0] * 3                                        # 扩展list，结果为[0, 0, 0]\n    lists = [[]] * 3                                       # 多维数组，结果为[[], [], []]，但有问题，往下看\n    lists[0].append(3)                                     # 期望看到的结果[[3], [], []]，实际结果[[3], [3], [3]]，原因：list*n操作，是浅拷贝，如何避免？往下看\n    lists = [[] for i in range(3)]                         # 多维数组，结果为[[], [], []]\n    lists[0].append(3)                                     # 结果为[[3], [], []]\n    lists[1].append(6)                                     # 结果为[[3], [6], []]\n    lists[2].append(9)                                     # 结果为[[3], [6], [9]]\n    lists = [[[] for j in range(4)] for i in range(3)]     # 3行4列，且每一个元素为[]`, `60803776768855530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># _*_ coding: utf-8 _*_</span>\n\n<span class="token triple-quoted-string string">"""类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算"""</span>\n\n<span class="token comment">#-- 寻求帮助:</span>\n    <span class="token builtin">dir</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>            <span class="token comment"># 简单的列出对象obj所包含的方法名称，返回一个字符串列表</span>\n    <span class="token builtin">help</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>func<span class="token punctuation">)</span>      <span class="token comment"># 查询obj.func的具体介绍和用法</span>\n\n<span class="token comment">#-- 测试类型的三种方法，推荐第三种</span>\n    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"L is list"</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"L is list"</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"L is list"</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- Python数据类型：哈希类型、不可哈希类型</span>\n    <span class="token comment"># 哈希类型，即在原地不能改变的变量类型，不可变类型。可利用hash函数查看其hash值，也可以作为字典的key</span>\n    <span class="token string">"数字类型：int, float, decimal.Decimal, fractions.Fraction, complex"</span>\n    <span class="token string">"字符串类型：str, bytes"</span>\n    <span class="token string">"元组：tuple"</span>\n    <span class="token string">"冻结集合：frozenset"</span>\n    <span class="token string">"布尔类型：True, False"</span>\n    <span class="token string">"None"</span>\n    <span class="token comment"># 不可hash类型：原地可变类型：list、dict和set。它们不可以作为字典的key。</span>\n\n<span class="token comment">#-- 数字常量</span>\n    <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">999999999</span>                    <span class="token comment"># 整数</span>\n    <span class="token number">1.23</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">3.14e-10</span><span class="token punctuation">,</span> <span class="token number">4E210</span><span class="token punctuation">,</span> <span class="token number">4.0e+210</span>          <span class="token comment"># 浮点数</span>\n    <span class="token number">0o177</span><span class="token punctuation">,</span> <span class="token number">0x9ff</span><span class="token punctuation">,</span> <span class="token number">0X9FF</span><span class="token punctuation">,</span> <span class="token number">0b101010</span>                <span class="token comment"># 八进制、十六进制、二进制数字</span>\n    <span class="token number">3</span><span class="token operator">+</span><span class="token number">4j</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token operator">+</span><span class="token number">4.0j</span><span class="token punctuation">,</span> <span class="token number">3J</span>                           <span class="token comment"># 复数常量，也可以用complex(real, image)来创建</span>\n    <span class="token builtin">hex</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">oct</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">bin</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span>                       <span class="token comment"># 将十进制数转化为十六进制、八进制、二进制表示的“字符串”</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> base<span class="token punctuation">)</span>                            <span class="token comment"># 将字符串转化为整数，base为进制数</span>\n    <span class="token comment"># 2.x中，有两种整数类型：一般整数（32位）和长整数（无穷精度）。可以用l或L结尾，迫使一般整数成为长整数</span>\n    <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'inf\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'-inf\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'nan\'</span><span class="token punctuation">)</span>    <span class="token comment"># 无穷大, 无穷小, 非数</span>\n\n<span class="token comment">#-- 数字的表达式操作符</span>\n    <span class="token keyword">yield</span> x                                      <span class="token comment"># 生成器函数发送协议</span>\n    <span class="token keyword">lambda</span> args<span class="token punctuation">:</span> expression                      <span class="token comment"># 生成匿名函数</span>\n    x <span class="token keyword">if</span> y <span class="token keyword">else</span> z                                <span class="token comment"># 三元选择表达式</span>\n    x <span class="token keyword">and</span> y<span class="token punctuation">,</span> x <span class="token keyword">or</span> y<span class="token punctuation">,</span> <span class="token keyword">not</span> x                       <span class="token comment"># 逻辑与、逻辑或、逻辑非</span>\n    x <span class="token keyword">in</span> y<span class="token punctuation">,</span> x <span class="token keyword">not</span> <span class="token keyword">in</span> y                           <span class="token comment"># 成员对象测试</span>\n    x <span class="token keyword">is</span> y<span class="token punctuation">,</span> x <span class="token keyword">is</span> <span class="token keyword">not</span> y                           <span class="token comment"># 对象实体测试</span>\n    x<span class="token operator">&lt;</span>y<span class="token punctuation">,</span> x<span class="token operator">&lt;=</span>y<span class="token punctuation">,</span> x<span class="token operator">></span>y<span class="token punctuation">,</span> x<span class="token operator">>=</span>y<span class="token punctuation">,</span> x<span class="token operator">==</span>y<span class="token punctuation">,</span> x<span class="token operator">!=</span>y             <span class="token comment"># 大小比较，集合子集或超集值相等性操作符</span>\n    <span class="token number">1</span> <span class="token operator">&lt;</span> a <span class="token operator">&lt;</span> <span class="token number">3</span>                                    <span class="token comment"># Python中允许连续比较</span>\n    x<span class="token operator">|</span>y<span class="token punctuation">,</span> x<span class="token operator">&amp;</span>y<span class="token punctuation">,</span> x<span class="token operator">^</span>y                                <span class="token comment"># 位或、位与、位异或</span>\n    x<span class="token operator">&lt;&lt;</span>y<span class="token punctuation">,</span> x<span class="token operator">>></span>y                                   <span class="token comment"># 位操作：x左移、右移y位</span>\n    <span class="token operator">+</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span> <span class="token operator">//</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token punctuation">,</span> <span class="token operator">**</span>                        <span class="token comment"># 真除法、floor除法：返回不大于真除法结果的整数值、取余、幂运算</span>\n    <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">+</span>x<span class="token punctuation">,</span> <span class="token operator">~</span>x                                   <span class="token comment"># 一元减法、识别、按位求补（取反）</span>\n    x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span>i<span class="token punctuation">:</span>j<span class="token punctuation">:</span>k<span class="token punctuation">]</span>                               <span class="token comment"># 索引、分片</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                          <span class="token comment"># 强制类型转换</span>\n\n<span class="token comment">#-- 整数可以利用bit_length函数测试所占的位数</span>\n    a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>       a<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 1</span>\n    a <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>    a<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 11</span>\n\n<span class="token comment">#-- repr和str显示格式的区别</span>\n    <span class="token triple-quoted-string string">"""\n    repr格式：默认的交互模式回显，产生的结果看起来它们就像是代码。\n    str格式：打印语句，转化成一种对用户更加友好的格式。\n    """</span>\n\n<span class="token comment">#-- 数字相关的模块</span>\n    <span class="token comment"># math模块</span>\n    <span class="token comment"># Decimal模块：小数模块</span>\n        <span class="token keyword">import</span> decimal\n        <span class="token keyword">from</span> decimal <span class="token keyword">import</span> Decimal\n        Decimal<span class="token punctuation">(</span><span class="token string">"0.01"</span><span class="token punctuation">)</span> <span class="token operator">+</span> Decimal<span class="token punctuation">(</span><span class="token string">"0.02"</span><span class="token punctuation">)</span>        <span class="token comment"># 返回Decimal("0.03")</span>\n        decimal<span class="token punctuation">.</span>getcontext<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prec <span class="token operator">=</span> <span class="token number">4</span>            <span class="token comment"># 设置全局精度为4 即小数点后边4位</span>\n    <span class="token comment"># Fraction模块：分数模块</span>\n        <span class="token keyword">from</span> fractions <span class="token keyword">import</span> Fraction\n        x <span class="token operator">=</span> Fraction<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>                       <span class="token comment"># 分数类型 4/6</span>\n        x <span class="token operator">=</span> Fraction<span class="token punctuation">(</span><span class="token string">"0.25"</span><span class="token punctuation">)</span>                     <span class="token comment"># 分数类型 1/4 接收字符串类型的参数</span>\n\n<span class="token comment">#-- 集合set</span>\n    <span class="token triple-quoted-string string">"""\n    set是一个无序不重复元素集, 基本功能包括关系测试和消除重复元素。\n    set支持union(联合), intersection(交), difference(差)和symmetric difference(对称差集)等数学运算。\n    set支持x in set, len(set), for x in set。\n    set不记录元素位置或者插入点, 因此不支持indexing, slicing, 或其它类序列的操作\n    """</span>\n    s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                          <span class="token comment"># 创建一个数值集合，返回{3, 5, 9, 10}</span>\n    t <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span>                             <span class="token comment"># 创建一个字符的集合，返回{\'l\', \'H\', \'e\', \'o\'}</span>\n    a <span class="token operator">=</span> t <span class="token operator">|</span> s<span class="token punctuation">;</span>    t<span class="token punctuation">.</span>union<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                     <span class="token comment"># t 和 s的并集</span>\n    b <span class="token operator">=</span> t <span class="token operator">&amp;</span> s<span class="token punctuation">;</span>    t<span class="token punctuation">.</span>intersection<span class="token punctuation">(</span>s<span class="token punctuation">)</span>              <span class="token comment"># t 和 s的交集</span>\n    c <span class="token operator">=</span> t – s<span class="token punctuation">;</span>    t<span class="token punctuation">.</span>difference<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                <span class="token comment"># 求差集（项在t中, 但不在s中）</span>\n    d <span class="token operator">=</span> t <span class="token operator">^</span> s<span class="token punctuation">;</span>    t<span class="token punctuation">.</span>symmetric_difference<span class="token punctuation">(</span>s<span class="token punctuation">)</span>      <span class="token comment"># 对称差集（项在t或s中, 但不会同时出现在二者中）</span>\n    t<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">\'x\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   t<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">\'H\'</span><span class="token punctuation">)</span>                  <span class="token comment"># 增加/删除一个item</span>\n    s<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">37</span><span class="token punctuation">,</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                         <span class="token comment"># 利用[......]更新s集合</span>\n    x <span class="token keyword">in</span> s<span class="token punctuation">,</span>  x <span class="token keyword">not</span> <span class="token keyword">in</span> s                          <span class="token comment"># 集合中是否存在某个值</span>\n    s<span class="token punctuation">.</span>issubset<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>      s <span class="token operator">&lt;=</span> t                   <span class="token comment"># 测试是否 s 中的每一个元素都在 t 中</span>\n    s<span class="token punctuation">.</span>issuperset<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>    s <span class="token operator">>=</span> t                   <span class="token comment"># 测试是否 t 中的每一个元素都在 s 中</span>\n    s<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span>discard<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment"># 删除s中x</span>\n    s<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>                                    <span class="token comment"># 清空s</span>\n    <span class="token punctuation">{</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">}</span>                 <span class="token comment"># 集合解析，结果：{16, 1, 4, 9}</span>\n    <span class="token punctuation">{</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token string">\'spam\'</span><span class="token punctuation">}</span>                          <span class="token comment"># 集合解析，结果：{\'a\', \'p\', \'s\', \'m\'}</span>\n\n<span class="token comment">#-- 集合frozenset，不可变对象</span>\n    <span class="token triple-quoted-string string">"""\n    set是可变对象，即不存在hash值，不能作为字典的键值。同样的还有list等(tuple是可以作为字典key的)\n    frozenset是不可变对象，即存在hash值，可作为字典的键值\n    frozenset对象没有add、remove等方法，但有union/intersection/difference等方法\n    """</span>\n    a <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    b <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    b<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">)</span>                     <span class="token comment"># error: set是不可哈希类型</span>\n    b<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token builtin">frozenset</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment"># ok，将set变为frozenset，可哈希</span>\n\n<span class="token comment">#-- 布尔类型bool</span>\n    <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>                   <span class="token comment"># 返回&lt;class \'bool\'></span>\n    <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>       <span class="token comment"># bool类型属于整型，所以返回True</span>\n    <span class="token boolean">True</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token boolean">True</span> <span class="token keyword">is</span> <span class="token number">1</span>         <span class="token comment"># 输出(True, False)</span>\n\n<span class="token comment">#-- 动态类型简介</span>\n    <span class="token triple-quoted-string string">"""\n    变量名通过引用，指向对象。\n    Python中的“类型”属于对象，而不是变量，每个对象都包含有头部信息，比如"类型标示符" "引用计数器"等\n    """</span>\n    <span class="token comment">#共享引用及在原处修改：对于可变对象，要注意尽量不要共享引用！</span>\n    <span class="token comment">#共享引用和相等测试：</span>\n        L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L <span class="token keyword">is</span> M            <span class="token comment"># 返回False</span>\n        L <span class="token operator">=</span> M <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L <span class="token keyword">is</span> M           <span class="token comment"># 返回True，共享引用</span>\n    <span class="token comment">#增强赋值和共享引用：普通+号会生成新的对象，而增强赋值+=会在原处修改</span>\n        L <span class="token operator">=</span> M <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\n        L <span class="token operator">=</span> L <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                      <span class="token comment"># L = [1, 2, 3, 4], M = [1, 2]</span>\n        L <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                         <span class="token comment"># L = [1, 2, 3, 4], M = [1, 2, 3, 4]</span>\n\n<span class="token comment">#-- 常见字符串常量和表达式</span>\n    S <span class="token operator">=</span> <span class="token string">\'\'</span>                                  <span class="token comment"># 空字符串</span>\n    S <span class="token operator">=</span> <span class="token string">"spam’s"</span>                            <span class="token comment"># 双引号和单引号相同</span>\n    S <span class="token operator">=</span> <span class="token string">"s\\np\\ta\\x00m"</span>                      <span class="token comment"># 转义字符</span>\n    S <span class="token operator">=</span> <span class="token triple-quoted-string string">"""spam"""</span>                          <span class="token comment"># 三重引号字符串，一般用于函数说明</span>\n    S <span class="token operator">=</span> <span class="token string">r\'\\temp\'</span>                            <span class="token comment"># Raw字符串，不会进行转义，抑制转义</span>\n    S <span class="token operator">=</span> <span class="token string">b\'Spam\'</span>                             <span class="token comment"># Python3中的字节字符串</span>\n    S <span class="token operator">=</span> <span class="token string">u\'spam\'</span>                             <span class="token comment"># Python2.6中的Unicode字符串</span>\n    s1<span class="token operator">+</span>s2<span class="token punctuation">,</span> s1<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token punctuation">:</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>       <span class="token comment"># 字符串操作</span>\n    <span class="token string">\'a %s parrot\'</span> <span class="token operator">%</span> <span class="token string">\'kind\'</span>                  <span class="token comment"># 字符串格式化表达式</span>\n    <span class="token string">\'a {1} {0} parrot\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'kind\'</span><span class="token punctuation">,</span> <span class="token string">\'red\'</span><span class="token punctuation">)</span><span class="token comment"># 字符串格式化方法</span>\n    <span class="token keyword">for</span> x <span class="token keyword">in</span> s<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                    <span class="token comment"># 字符串迭代，成员关系</span>\n    <span class="token punctuation">[</span>x<span class="token operator">*</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> s<span class="token punctuation">]</span>                        <span class="token comment"># 字符串列表解析</span>\n    <span class="token string">\',\'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>               <span class="token comment"># 字符串输出，结果：a,b,c</span>\n\n<span class="token comment">#-- 内置str处理函数：</span>\n    str1 <span class="token operator">=</span> <span class="token string">"stringobject"</span>\n    str1<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>swapcase<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 全部大写，全部小写、大小写转换，首字母大写，每个单词的首字母都大写</span>\n    str1<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>width<span class="token punctuation">)</span>                       <span class="token comment"># 获取固定长度，左对齐，右边不够用空格补齐</span>\n    str1<span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>width<span class="token punctuation">)</span>                       <span class="token comment"># 获取固定长度，右对齐，左边不够用空格补齐</span>\n    str1<span class="token punctuation">.</span>center<span class="token punctuation">(</span>width<span class="token punctuation">)</span>                      <span class="token comment"># 获取固定长度，中间对齐，两边不够用空格补齐</span>\n    str1<span class="token punctuation">.</span>zfill<span class="token punctuation">(</span>width<span class="token punctuation">)</span>                       <span class="token comment"># 获取固定长度，右对齐，左边不足用0补齐</span>\n    str1<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">\'t\'</span><span class="token punctuation">,</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span>                <span class="token comment"># 查找字符串，可以指定起始及结束位置搜索</span>\n    str1<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">\'t\'</span><span class="token punctuation">)</span>                         <span class="token comment"># 从右边开始查找字符串</span>\n    str1<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">\'t\'</span><span class="token punctuation">)</span>                         <span class="token comment"># 查找字符串出现的次数</span>\n    <span class="token comment">#上面所有方法都可用index代替，不同的是使用index查找不到会抛异常，而find返回-1</span>\n    str1<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">\'old\'</span><span class="token punctuation">,</span><span class="token string">\'new\'</span><span class="token punctuation">)</span>               <span class="token comment"># 替换函数，替换old为new，参数中可以指定maxReplaceTimes，即替换指定次数的old为new</span>\n    str1<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment"># 默认删除空白符</span>\n    str1<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">\'d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment"># 删除str1字符串中开头、结尾处，位于 d 删除序列的字符</span>\n    str1<span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    str1<span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">\'d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment"># 删除str1字符串中开头处，位于 d 删除序列的字符</span>\n    str1<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    str1<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">\'d\'</span><span class="token punctuation">)</span>                        <span class="token comment"># 删除str1字符串中结尾处，位于 d 删除序列的字符</span>\n    str1<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">\'start\'</span><span class="token punctuation">)</span>                <span class="token comment"># 是否以start开头</span>\n    str1<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">\'end\'</span><span class="token punctuation">)</span>                    <span class="token comment"># 是否以end结尾</span>\n    str1<span class="token punctuation">.</span>isalnum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>islower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># 判断字符串是否全为字符、数字、小写、大写</span>\n\n<span class="token comment">#-- 三重引号编写多行字符串块，并且在代码折行处嵌入换行字符\\n</span>\n    mantra <span class="token operator">=</span> <span class="token triple-quoted-string string">"""hello world\n            hello python\n            hello my friend"""</span>\n    <span class="token comment"># mantra为"""hello world \\n hello python \\n hello my friend"""</span>\n\n<span class="token comment">#-- 索引和分片：</span>\n    S<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span>–<span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                <span class="token comment"># 索引</span>\n    S<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>        <span class="token comment"># 分片，第三个参数指定步长，如`S[1:10:2]`是从1位到10位没隔2位获取一个字符。</span>\n\n<span class="token comment">#-- 字符串转换工具：</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">\'42\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回(42, \'42\')</span>\n    <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'4.13\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">4.13</span><span class="token punctuation">)</span>                <span class="token comment"># 返回(4.13, \'4.13\')</span>\n    <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">\'s\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回(115, \'s\')</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">\'1001\'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>                          <span class="token comment"># 将字符串作为二进制数字，转化为数字，返回9</span>\n    <span class="token builtin">bin</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">oct</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>               <span class="token comment"># 将整数转化为二进制/八进制/十六进制字符串，返回(\'0b1101\', \'015\', \'0xd\')</span>\n\n<span class="token comment">#-- 另类字符串连接</span>\n    name <span class="token operator">=</span> <span class="token string">"wang"</span> <span class="token string">"hong"</span>                    <span class="token comment"># 单行，name = "wanghong"</span>\n    name <span class="token operator">=</span> <span class="token string">"wang"</span> \\\n            <span class="token string">"hong"</span>                          <span class="token comment"># 多行，name = "wanghong"</span>\n\n<span class="token comment">#-- Python中的字符串格式化实现1--字符串格式化表达式</span>\n    <span class="token triple-quoted-string string">"""\n    基于C语言的\'print\'模型，并且在大多数的现有的语言中使用。\n    通用结构：%[(name)][flag][width].[precision]typecode\n    """</span>\n    <span class="token string">"this is %d %s bird"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'dead\'</span><span class="token punctuation">)</span>                          <span class="token comment"># 一般的格式化表达式</span>\n    <span class="token string">"%s---%s---%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                      <span class="token comment"># 字符串输出：\'42---3.14---[1, 2, 3]\'</span>\n    <span class="token string">"%d...%6d...%-6d...%06d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">)</span>         <span class="token comment"># 对齐方式及填充："1234...  1234...1234  ...001234"</span>\n    x <span class="token operator">=</span> <span class="token number">1.23456789</span>\n    <span class="token string">"%e | %f | %g"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span>                                  <span class="token comment"># 对齐方式："1.234568e+00 | 1.234568 | 1.23457"</span>\n    <span class="token string">"%6.2f*%-6.2f*%06.2f*%+6.2f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span>                 <span class="token comment"># 对齐方式：\'  1.23*1.23  *001.23* +1.23\'</span>\n    <span class="token string">"%(name1)d---%(name2)s"</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">"name1"</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token string">"name2"</span><span class="token punctuation">:</span><span class="token string">"value2"</span><span class="token punctuation">}</span>    <span class="token comment"># 基于字典的格式化表达式</span>\n    <span class="token string">"%(name)s is %(age)d"</span> <span class="token operator">%</span> <span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># vars()函数调用返回一个字典，包含了所有本函数调用时存在的变量</span>\n\n<span class="token comment">#-- Python中的字符串格式化实现2--字符串格式化调用方法</span>\n    <span class="token comment"># 普通调用</span>\n    <span class="token string">"{0}, {1} and {2}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'spam\'</span><span class="token punctuation">,</span> <span class="token string">\'ham\'</span><span class="token punctuation">,</span> <span class="token string">\'eggs\'</span><span class="token punctuation">)</span>            <span class="token comment"># 基于位置的调用</span>\n    <span class="token string">"{motto} and {pork}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>motto <span class="token operator">=</span> <span class="token string">\'spam\'</span><span class="token punctuation">,</span> pork <span class="token operator">=</span> <span class="token string">\'ham\'</span><span class="token punctuation">)</span>   <span class="token comment"># 基于Key的调用</span>\n    <span class="token string">"{motto} and {0}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'ham\'</span><span class="token punctuation">,</span> motto <span class="token operator">=</span> <span class="token string">\'spam\'</span><span class="token punctuation">)</span>             <span class="token comment"># 混合调用</span>\n    <span class="token comment"># 添加键 属性 偏移量 (import sys)</span>\n    <span class="token string">"my {1[spam]} runs {0.platform}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sys<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">\'spam\'</span><span class="token punctuation">:</span><span class="token string">\'laptop\'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>                 <span class="token comment"># 基于位置的键和属性</span>\n    <span class="token string">"{config[spam]} {sys.platform}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sys <span class="token operator">=</span> sys<span class="token punctuation">,</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'spam\'</span><span class="token punctuation">:</span><span class="token string">\'laptop\'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment"># 基于Key的键和属性</span>\n    <span class="token string">"first = {0[0]}, second = {0[1]}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'A\'</span><span class="token punctuation">,</span> <span class="token string">\'B\'</span><span class="token punctuation">,</span> <span class="token string">\'C\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                       <span class="token comment"># 基于位置的偏移量</span>\n    <span class="token comment"># 具体格式化</span>\n    <span class="token string">"{0:e}, {1:.3e}, {2:g}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">3.14159</span><span class="token punctuation">,</span> <span class="token number">3.14159</span><span class="token punctuation">,</span> <span class="token number">3.14159</span><span class="token punctuation">)</span>   <span class="token comment"># 输出\'3.141590e+00, 3.142e+00, 3.14159\'</span>\n    <span class="token string">"{fieldname:format_spec}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>\n    <span class="token comment"># 说明:</span>\n    <span class="token triple-quoted-string string">"""\n        fieldname是指定参数的一个数字或关键字, 后边可跟可选的".name"或"[index]"成分引用\n        format_spec ::=  [[fill]align][sign][#][0][width][,][.precision][type]\n        fill        ::=  &lt;any character>              #填充字符\n        align       ::=  "&lt;" | ">" | "=" | "^"        #对齐方式\n        sign        ::=  "+" | "-" | " "              #符号说明\n        width       ::=  integer                      #字符串宽度\n        precision   ::=  integer                      #浮点数精度\n        type        ::=  "b" | "c" | "d" | "e" | "E" | "f" | "F" | "g" | "G" | "n" | "o" | "s" | "x" | "X" | "%"\n    """</span>\n    <span class="token comment"># 例子:</span>\n        <span class="token string">\'={0:10} = {1:10}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'spam\'</span><span class="token punctuation">,</span> <span class="token number">123.456</span><span class="token punctuation">)</span>    <span class="token comment"># 输出\'=spam       =    123.456\'</span>\n        <span class="token string">\'={0:>10}=\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'test\'</span><span class="token punctuation">)</span>                    <span class="token comment"># 输出\'=      test=\'</span>\n        <span class="token string">\'={0:&lt;10}=\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'test\'</span><span class="token punctuation">)</span>                    <span class="token comment"># 输出\'=test      =\'</span>\n        <span class="token string">\'={0:^10}=\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'test\'</span><span class="token punctuation">)</span>                    <span class="token comment"># 输出\'=   test   =\'</span>\n        <span class="token string">\'{0:X}, {1:o}, {2:b}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>   <span class="token comment"># 输出\'FF, 377, 11111111\'</span>\n        <span class="token string">\'My name is {0:{1}}.\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'Fred\'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>       <span class="token comment"># 输出\'My name is Fred    .\'  动态指定参数</span>\n\n<span class="token comment">#-- 常用列表常量和操作</span>\n    L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\'string\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span>                        <span class="token comment"># 嵌套列表</span>\n    L <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">\'spam\'</span><span class="token punctuation">)</span>                                  <span class="token comment"># 列表初始化</span>\n    L <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                             <span class="token comment"># 列表初始化</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">,</span> <span class="token string">\'spam\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                            <span class="token comment"># 列表解析</span>\n    <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>                                            <span class="token comment"># 求列表长度</span>\n    L<span class="token punctuation">.</span>count<span class="token punctuation">(</span>value<span class="token punctuation">)</span>                                    <span class="token comment"># 求列表中某个值的个数</span>\n    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>                                     <span class="token comment"># 向列表的尾部添加数据，比如append(2)，添加元素2</span>\n    L<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>index<span class="token punctuation">,</span> obj<span class="token punctuation">)</span>                              <span class="token comment"># 向列表的指定index位置添加数据，index及其之后的数据后移</span>\n    L<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>interable<span class="token punctuation">)</span>                               <span class="token comment"># 通过添加iterable中的元素来扩展列表，比如extend([2])，添加元素2，注意和append的区别</span>\n    L<span class="token punctuation">.</span>index<span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">[</span>start<span class="token punctuation">,</span> <span class="token punctuation">[</span>stop<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                   <span class="token comment"># 返回列表中值value的第一个索引</span>\n    L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>                                    <span class="token comment"># 删除并返回index处的元素，默认为删除并返回最后一个元素</span>\n    L<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>value<span class="token punctuation">)</span>                                   <span class="token comment"># 删除列表中的value值，只删除第一次出现的value的值</span>\n    L<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>                                       <span class="token comment"># 反转列表</span>\n    L<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token builtin">cmp</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>         <span class="token comment"># 排序列表</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">]</span>                         <span class="token comment"># 注意，这里不会引发IndexError异常，只会返回一个空的列表[]</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>                                  <span class="token comment"># 这里实在原有列表的基础上进行操作，即列表的id没有改变</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>                               <span class="token comment"># 这里最后的a要构建一个新的列表，即a的id发生了变化</span>\n\n<span class="token comment">#-- 用切片来删除序列的某一段</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>\n    a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                       <span class="token comment"># a = [1, 5, 6, 7]</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>\n    <span class="token keyword">del</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>                                        <span class="token comment"># 去除偶数项(偶数索引的)，a = [1, 3, 5, 7]</span>\n\n<span class="token comment">#-- 常用字典常量和操作</span>\n    D <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    D <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'spam\'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'tol\'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">\'ham\'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                   <span class="token comment"># 嵌套字典</span>\n    D <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">.</span>fromkeys<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'s\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>                  <span class="token comment"># {\'s\': 8, \'d\': 8}</span>\n    D <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">\'tom\'</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">)</span>                  <span class="token comment"># {\'age\': 12, \'name\': \'tom\'}</span>\n    D <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'tom\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'age\'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token comment"># {\'age\': 12, \'name\': \'tom\'}</span>\n    D <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'age\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'tom\'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment"># {\'age\': 12, \'name\': \'tom\'}</span>\n    D<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> D<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> D<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>                   <span class="token comment"># 字典键、值以及键值对</span>\n    D<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">,</span> default<span class="token punctuation">)</span>                               <span class="token comment"># get函数</span>\n    D<span class="token punctuation">.</span>update<span class="token punctuation">(</span>D_other<span class="token punctuation">)</span>                                 <span class="token comment"># 合并字典，如果存在相同的键值，D_other的数据会覆盖掉D的数据</span>\n    D<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">[</span>D<span class="token punctuation">]</span><span class="token punctuation">)</span>                                   <span class="token comment"># 删除字典中键值为key的项，返回键值为key的值，如果不存在，返回默认值D，否则异常</span>\n    D<span class="token punctuation">.</span>popitem<span class="token punctuation">(</span><span class="token punctuation">)</span>                                       <span class="token comment"># pop字典中随机的一项（一个键值对）</span>\n    D<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token punctuation">,</span> d<span class="token punctuation">]</span><span class="token punctuation">)</span>                              <span class="token comment"># 设置D中某一项的默认值。如果k存在，则返回D[k]，否则设置D[k]=d，同时返回D[k]。</span>\n    <span class="token keyword">del</span> D                                             <span class="token comment"># 删除字典</span>\n    <span class="token keyword">del</span> D<span class="token punctuation">[</span><span class="token string">\'key\'</span><span class="token punctuation">]</span>                                      <span class="token comment"># 删除字典的某一项</span>\n    <span class="token keyword">if</span> key <span class="token keyword">in</span> D<span class="token punctuation">:</span>   <span class="token keyword">if</span> key <span class="token keyword">not</span> <span class="token keyword">in</span> D<span class="token punctuation">:</span>                   <span class="token comment"># 测试字典键是否存在</span>\n    <span class="token comment"># 字典注意事项：（1）对新索引赋值会添加一项（2）字典键不一定非得是字符串，也可以为任何的不可变对象</span>\n    <span class="token comment"># 不可变对象：调用对象自身的任意方法，也不会改变该对象自身的内容，这些方法会创建新的对象并返回。</span>\n    <span class="token comment"># 字符串、整数、tuple都是不可变对象，dict、set、list都是可变对象</span>\n    D<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>                                    <span class="token comment"># tuple作为字典的key</span>\n\n<span class="token comment">#-- 字典解析</span>\n    D <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span><span class="token number">8</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">\'s\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>                     <span class="token comment"># {\'s\': 8, \'d\': 8}</span>\n    D <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span>v <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'age\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'tom\'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>       <span class="token comment"># {\'age\': 12, \'name\': tom}</span>\n\n<span class="token comment">#-- 字典的特殊方法__missing__：当查找找不到key时，会执行该方法</span>\n    <span class="token keyword">class</span> <span class="token class-name">Dict</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__missing__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">[</span>key<span class="token punctuation">]</span>\n    dct <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    dct<span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># 这有点类似于collections.defalutdict</span>\n    dct<span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">]</span>              <span class="token comment"># [1]</span>\n\n<span class="token comment">#-- 元组和列表的唯一区别在于元组是不可变对象，列表是可变对象</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>           <span class="token comment"># a[1] = 0, OK</span>\n    a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>           <span class="token comment"># a[1] = 0, Error</span>\n    a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span>           <span class="token comment"># a[0][1] = 0, OK</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>            <span class="token comment"># a[0][1] = 0, Error</span>\n\n<span class="token comment">#-- 元组的特殊语法: 逗号和圆括号</span>\n    D <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>                <span class="token comment"># 此时D为一个整数 即D = 12</span>\n    D <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>              <span class="token comment"># 此时D为一个元组 即D = (12, )</span>\n\n<span class="token comment">#-- 文件基本操作</span>\n    output <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r\'C:\\spam\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span>          <span class="token comment"># 打开输出文件，用于写</span>\n    <span class="token builtin">input</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">)</span>               <span class="token comment"># 打开输入文件，用于读。打开的方式可以为\'w\', \'r\', \'a\', \'wb\', \'rb\', \'ab\'等</span>\n    fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>                         <span class="token comment"># size为读取的长度，以byte为单位</span>\n    fp<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>                     <span class="token comment"># 读一行，如果定义了size，有可能返回的只是一行的一部分</span>\n    fp<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>                    <span class="token comment"># 把文件每一行作为一个list的一个成员，并返回这个list。其实它的内部是通过循环调用readline()来实现的。如果提供size参数，size是表示读取内容的总长。</span>\n    fp<span class="token punctuation">.</span>readable<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 是否可读</span>\n    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>                           <span class="token comment"># 把str写到文件中，write()并不会在str后加上一个换行符</span>\n    fp<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>seq<span class="token punctuation">)</span>                      <span class="token comment"># 把seq的内容全部写到文件中(多行一次性写入)</span>\n    fp<span class="token punctuation">.</span>writeable<span class="token punctuation">(</span><span class="token punctuation">)</span>                          <span class="token comment"># 是否可写</span>\n    fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 关闭文件。</span>\n    fp<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 把缓冲区的内容写入硬盘</span>\n    fp<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment"># 返回一个长整型的”文件标签“</span>\n    fp<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment"># 文件是否是一个终端设备文件（unix系统中的）</span>\n    fp<span class="token punctuation">.</span>tell<span class="token punctuation">(</span><span class="token punctuation">)</span>                               <span class="token comment"># 返回文件操作标记的当前位置，以文件的开头为原点</span>\n    fp<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                               <span class="token comment"># 返回下一行，并将文件操作标记位移到下一行。把一个file用于for … in file这样的语句时，就是调用next()函数来实现遍历的。</span>\n    fp<span class="token punctuation">.</span>seek<span class="token punctuation">(</span>offset<span class="token punctuation">[</span><span class="token punctuation">,</span>whence<span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token comment"># 将文件打开操作标记移到offset的位置。whence为0表示从头开始计算，1表示以当前位置为原点计算。2表示以文件末尾为原点进行计算。</span>\n    fp<span class="token punctuation">.</span>seekable<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 是否可以seek</span>\n    fp<span class="token punctuation">.</span>truncate<span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>                     <span class="token comment"># 把文件裁成规定的大小，默认的是裁到当前文件操作标记的位置。</span>\n    <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>                         <span class="token comment"># 使用for语句，比较适用于打开比较大的文件</span>\n    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token comment"># 使用with语句，可以保证文件关闭</span>\n    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>\n        lines <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># 一次读入文件所有行，并关闭文件</span>\n    <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'f.txt\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'latin-1\'</span><span class="token punctuation">)</span>     <span class="token comment"># Python3.x Unicode文本文件</span>\n    <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'f.bin\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>                     <span class="token comment"># Python3.x 二进制bytes文件</span>\n    <span class="token comment"># 文件对象还有相应的属性：buffer closed encoding errors line_buffering name newlines等</span>\n\n<span class="token comment">#-- 其他</span>\n    <span class="token comment"># Python中的真假值含义：1. 数字如果非零，则为真，0为假。 2. 其他对象如果非空，则为真</span>\n    <span class="token comment"># 通常意义下的类型分类：1. 数字、序列、映射。 2. 可变类型和不可变类型</span>\n\n\n<span class="token triple-quoted-string string">"""语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句"""</span>\n\n<span class="token comment">#-- 赋值语句的形式</span>\n    spam <span class="token operator">=</span> <span class="token string">\'spam\'</span>                          <span class="token comment"># 基本形式</span>\n    spam<span class="token punctuation">,</span> ham <span class="token operator">=</span> <span class="token string">\'spam\'</span><span class="token punctuation">,</span> <span class="token string">\'ham\'</span>              <span class="token comment"># 元组赋值形式</span>\n    <span class="token punctuation">[</span>spam<span class="token punctuation">,</span> ham<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'s\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>               <span class="token comment"># 列表赋值形式</span>\n    a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token string">\'abcd\'</span>                    <span class="token comment"># 序列赋值形式</span>\n    a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token string">\'spam\'</span>                      <span class="token comment"># 序列解包形式（Python3.x中才有）</span>\n    spam <span class="token operator">=</span> ham <span class="token operator">=</span> <span class="token string">\'no\'</span>                      <span class="token comment"># 多目标赋值运算，涉及到共享引用</span>\n    spam <span class="token operator">+=</span> <span class="token number">42</span>                             <span class="token comment"># 增强赋值，涉及到共享引用</span>\n\n<span class="token comment">#-- 序列赋值 序列解包</span>\n    <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>                  <span class="token comment"># a = 1, b = 2, c = 3</span>\n    a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token string">"spam"</span>                    <span class="token comment"># a = \'s\', b = \'p\', c = \'a\', d = \'m\'</span>\n    a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                     <span class="token comment"># a = 0, b = 1, c = 2</span>\n    a<span class="token punctuation">,</span> <span class="token operator">*</span>b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                   <span class="token comment"># a = 1, b = [2, 3, 4]</span>\n    <span class="token operator">*</span>a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                   <span class="token comment"># a = [1, 2, 3], b = 4</span>\n    a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                <span class="token comment"># a = 1, b = [2, 3], c = 4</span>\n    <span class="token comment"># 带有*时 会优先匹配*之外的变量 如</span>\n    a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>                      <span class="token comment"># a = 1, c = 2, b = []</span>\n\n<span class="token comment">#-- print函数原型</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">\' \'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">\'\\n\'</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> flush<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\n    <span class="token comment"># 流的重定向</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'hello world\'</span><span class="token punctuation">)</span>                   <span class="token comment"># 等于sys.stdout.write(\'hello world\')</span>\n    temp <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout                      <span class="token comment"># 原有流的保存</span>\n    sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'log.log\'</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">)</span>      <span class="token comment"># 流的重定向</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'hello world\'</span><span class="token punctuation">)</span>                   <span class="token comment"># 写入到文件log.log</span>\n    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> temp                      <span class="token comment"># 原有流的复原</span>\n\n<span class="token comment">#-- Python中and或or总是返回对象(左边的对象或右边的对象) 且具有短路求值的特性</span>\n    <span class="token number">1</span> <span class="token keyword">or</span> <span class="token number">2</span> <span class="token keyword">or</span> <span class="token number">3</span>                            <span class="token comment"># 返回 1</span>\n    <span class="token number">1</span> <span class="token keyword">and</span> <span class="token number">2</span> <span class="token keyword">and</span> <span class="token number">3</span>                          <span class="token comment"># 返回 3</span>\n\n<span class="token comment">#-- if/else三元表达符（if语句在行内）</span>\n    A <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> X <span class="token keyword">else</span> <span class="token number">2</span>\n    A <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> X <span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token keyword">if</span> Y <span class="token keyword">else</span> <span class="token number">3</span><span class="token punctuation">)</span>\n    <span class="token comment"># 也可以使用and-or语句（一条语句实现多个if-else）</span>\n    a <span class="token operator">=</span> <span class="token number">6</span>\n    result <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">20</span> <span class="token keyword">and</span> <span class="token string">"big than 20"</span> <span class="token keyword">or</span> a <span class="token operator">></span> <span class="token number">10</span> <span class="token keyword">and</span> <span class="token string">"big than 10"</span> <span class="token keyword">or</span> a <span class="token operator">></span> <span class="token number">5</span> <span class="token keyword">and</span> <span class="token string">"big than 5"</span><span class="token punctuation">)</span>    <span class="token comment"># 返回"big than 5"</span>\n\n<span class="token comment">#-- Python的while语句或者for语句可以带else语句 当然也可以带continue/break/pass语句</span>\n    <span class="token keyword">while</span> a <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>\n        anything\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        anything\n    <span class="token comment"># else语句会在循环结束后执行，除非在循环中执行了break，同样的还有for语句</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        anything\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        anything\n\n<span class="token comment">#-- for循环的元组赋值</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                   <span class="token comment"># 最简单的赋值</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token comment"># 自动解包赋值</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"XY"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>      <span class="token comment"># 自动解包 a = X, b = Y, c = 6</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token comment"># 自动解包赋值</span>\n\n<span class="token comment">#-- 列表解析语法</span>\n    M <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">sum</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> M<span class="token punctuation">]</span>                     <span class="token comment"># G = [6, 15, 24] 一般的列表解析 生成一个列表</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token operator">*</span> <span class="token number">2</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">\'spam\'</span><span class="token punctuation">]</span>                     <span class="token comment"># [\'ss\', \'pp\', \'aa\', \'mm\']</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span>a <span class="token operator">*</span> b <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span>     <span class="token comment"># 多解析过程 返回[4, 5, 8, 10]</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span>a <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">if</span> a <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">]</span>             <span class="token comment"># 带判断条件的解析过程</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span>a <span class="token keyword">if</span> a <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>     <span class="token comment"># 带判断条件的高级解析过程</span>\n    <span class="token comment"># 两个列表同时解析：使用zip函数</span>\n    <span class="token keyword">for</span> teama<span class="token punctuation">,</span> teamb <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Packers"</span><span class="token punctuation">,</span> <span class="token string">"49ers"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"Ravens"</span><span class="token punctuation">,</span> <span class="token string">"Patriots"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>teama <span class="token operator">+</span> <span class="token string">" vs. "</span> <span class="token operator">+</span> teamb<span class="token punctuation">)</span>\n    <span class="token comment"># 带索引的列表解析：使用enumerate函数</span>\n    <span class="token keyword">for</span> index<span class="token punctuation">,</span> team <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Packers"</span><span class="token punctuation">,</span> <span class="token string">"49ers"</span><span class="token punctuation">,</span> <span class="token string">"Ravens"</span><span class="token punctuation">,</span> <span class="token string">"Patriots"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> team<span class="token punctuation">)</span>                            <span class="token comment"># 输出0, Packers \\n 1, 49ers \\n ......</span>\n\n<span class="token comment">#-- 生成器表达式</span>\n    G <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> M<span class="token punctuation">)</span>                       <span class="token comment"># 使用小括号可以创建所需结果的生成器generator object</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>                         <span class="token comment"># 输出(6, 15, 24)</span>\n    G <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">sum</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> M<span class="token punctuation">}</span>                       <span class="token comment"># G = {6, 15, 24} 解析语法还可以生成集合和字典</span>\n    G <span class="token operator">=</span> <span class="token punctuation">{</span>i<span class="token punctuation">:</span><span class="token builtin">sum</span><span class="token punctuation">(</span>M<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span>               <span class="token comment"># G = {0: 6, 1: 15, 2: 24}</span>\n\n<span class="token comment">#-- 文档字符串:出现在Module的开端以及其中函数或类的开端 使用三重引号字符串</span>\n    <span class="token triple-quoted-string string">"""\n    module document\n    """</span>\n    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token triple-quoted-string string">"""\n        function document\n        """</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token triple-quoted-string string">"""\n        class document\n        """</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>__doc__<span class="token punctuation">)</span>                <span class="token comment"># 输出函数文档字符串</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>Employee<span class="token punctuation">.</span>__doc__<span class="token punctuation">)</span>            <span class="token comment"># 输出类的文档字符串</span>\n\n<span class="token comment">#-- 命名惯例:</span>\n    <span class="token triple-quoted-string string">"""\n    以单一下划线开头的变量名(_X)不会被from module import*等语句导入\n    前后有两个下划线的变量名(__X__)是系统定义的变量名，对解释器有特殊意义\n    以两个下划线开头但不以下划线结尾的变量名(__X)是类的本地(私有)变量\n    """</span>\n\n<span class="token comment">#-- 列表解析 in成员关系测试 map sorted zip enumerate内置函数等都使用了迭代协议</span>\n    <span class="token string">\'first line\'</span> <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">)</span>   <span class="token comment"># in测试 返回True或False</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'t\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># map内置函数</span>\n    <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment"># sorted内置函数</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment"># zip内置函数 [(1, 3), (2, 4)]</span>\n\n<span class="token comment">#-- del语句: 手动删除某个变量</span>\n    <span class="token keyword">del</span> X\n\n<span class="token comment">#-- 获取列表的子表的方法:</span>\n    x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>\n    x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>                              <span class="token comment"># 前3个[1,2,3]</span>\n    x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>                             <span class="token comment"># 中间4个[2,3,4,5]</span>\n    x<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span>                             <span class="token comment"># 最后3个[4,5,6]</span>\n    x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>                             <span class="token comment"># 奇数项[1,3,5]</span>\n    x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>                            <span class="token comment"># 偶数项[2,4,6]</span>\n\n<span class="token comment">#-- 手动迭代：iter和next</span>\n    L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\n    I <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>                        <span class="token comment"># I为L的迭代器</span>\n    I<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 返回1</span>\n    I<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 返回2</span>\n    I<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># Error:StopIteration</span>\n\n<span class="token comment">#-- Python中的可迭代对象</span>\n    <span class="token triple-quoted-string string">"""\n    1.range迭代器\n    2.map、zip和filter迭代器\n    3.字典视图迭代器：D.keys()), D.items()等\n    4.文件类型\n    """</span>\n\n\n<span class="token triple-quoted-string string">"""函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则"""</span>\n\n<span class="token comment">#-- 函数相关的语句和表达式</span>\n    myfunc<span class="token punctuation">(</span><span class="token string">\'spam\'</span><span class="token punctuation">)</span>                     <span class="token comment"># 函数调用</span>\n    <span class="token keyword">def</span> <span class="token function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                      <span class="token comment"># 函数定义</span>\n    <span class="token keyword">return</span> <span class="token boolean">None</span>                        <span class="token comment"># 函数返回值</span>\n    <span class="token keyword">global</span> a                           <span class="token comment"># 全局变量</span>\n    <span class="token keyword">nonlocal</span> x                         <span class="token comment"># 在函数或其他作用域中使用外层（非全局）变量</span>\n    <span class="token keyword">yield</span> x                            <span class="token comment"># 生成器函数返回</span>\n    <span class="token keyword">lambda</span>                             <span class="token comment"># 匿名函数</span>\n\n<span class="token comment">#-- Python函数变量名解析:LEGB原则，即:</span>\n    <span class="token triple-quoted-string string">"""\n    local(functin) --> encloseing function locals --> global(module) --> build-in(python)\n    说明:以下边的函数maker为例 则相对于action而言 X为Local N为Encloseing\n    """</span>\n\n<span class="token comment">#-- 嵌套函数举例:工厂函数</span>\n    <span class="token keyword">def</span> <span class="token function">maker</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> X <span class="token operator">**</span> N\n        <span class="token keyword">return</span> action\n    f <span class="token operator">=</span> maker<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                       <span class="token comment"># pass 2 to N</span>\n    f<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                               <span class="token comment"># 9, pass 3 to X</span>\n\n<span class="token comment">#-- 嵌套函数举例:lambda实例</span>\n    <span class="token keyword">def</span> <span class="token function">maker</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        action <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">lambda</span> X<span class="token punctuation">:</span> X<span class="token operator">**</span>N<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> action\n    f <span class="token operator">=</span> maker<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                       <span class="token comment"># pass 2 to N</span>\n    f<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                               <span class="token comment"># 9, pass 3 to X</span>\n\n<span class="token comment">#-- nonlocal和global语句的区别</span>\n    <span class="token comment"># nonlocal应用于一个嵌套的函数的作用域中的一个名称 例如:</span>\n    start <span class="token operator">=</span> <span class="token number">100</span>\n    <span class="token keyword">def</span> <span class="token function">tester</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">nested</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">nonlocal</span> start             <span class="token comment"># 指定start为tester函数内的local变量 而不是global变量start</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> start<span class="token punctuation">)</span>\n            start <span class="token operator">+=</span> <span class="token number">3</span>\n        <span class="token keyword">return</span> nested\n    <span class="token comment"># global为全局的变量 即def之外的变量</span>\n    <span class="token keyword">def</span> <span class="token function">tester</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">nested</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">global</span> start               <span class="token comment"># 指定start为global变量start</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> start<span class="token punctuation">)</span>\n            start <span class="token operator">+=</span> <span class="token number">3</span>\n        <span class="token keyword">return</span> nested\n\n<span class="token comment">#-- 函数参数，不可变参数通过“值”传递，可变参数通过“引用”传递</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>                         <span class="token comment"># 参数位置匹配</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>                 <span class="token comment"># 参数关键字匹配</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                               <span class="token comment"># 默认参数匹配</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>                            <span class="token comment"># 默认参数匹配</span>\n    f<span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>                    <span class="token comment"># 关键字参数和默认参数的混合</span>\n    <span class="token comment"># Keyword-Only参数:出现在*args之后 必须用关键字进行匹配</span>\n    <span class="token keyword">def</span> <span class="token function">keyOnly</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span>   <span class="token comment"># c就为keyword-only匹配 必须使用关键字c = value匹配</span>\n    <span class="token keyword">def</span> <span class="token function">keyOnly</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token comment"># b c为keyword-only匹配 必须使用关键字匹配</span>\n    <span class="token keyword">def</span> <span class="token function">keyOnly</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   <span class="token comment"># b有默认值 或者省略 或者使用关键字参数b = value</span>\n\n<span class="token comment">#-- 可变参数匹配: * 和 **</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>          <span class="token comment"># 在元组中收集不匹配的位置参数</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>                         <span class="token comment"># 输出(1, 2, 3)</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">**</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>         <span class="token comment"># 在字典中收集不匹配的关键字参数</span>\n    f<span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>                    <span class="token comment"># 输出{\'a\':1, \'b\':2}</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> <span class="token operator">**</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>  <span class="token comment"># 两者混合使用</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>               <span class="token comment"># 输出1, (2, 3), {\'x\':4, \'y\':5}</span>\n\n<span class="token comment">#-- 函数调用时的参数解包: * 和 ** 分别解包元组和字典</span>\n    func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token operator">&lt;=</span><span class="token operator">=</span><span class="token operator">></span>  func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n    func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{</span><span class="token string">\'c\'</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token operator">&lt;=</span><span class="token operator">=</span><span class="token operator">></span>  func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>\n    func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{</span><span class="token string">\'c\'</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token operator">&lt;=</span><span class="token operator">=</span><span class="token operator">></span>  func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 函数属性:(自己定义的)函数可以添加属性</span>\n    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    func<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span>                     <span class="token comment"># 自定义函数添加属性</span>\n    <span class="token keyword">print</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span>                    <span class="token comment"># Error 内置函数不可以添加属性</span>\n\n<span class="token comment">#-- 函数注解: 编写在def头部行 主要用于说明参数范围、参数类型、返回值类型等</span>\n    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token string">\'spam\'</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span><span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span> <span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    func<span class="token punctuation">.</span>__annotations__               <span class="token comment"># {\'c\':&lt;class \'float\'>, \'b\':(1, 10), \'a\':\'spam\', \'return\':&lt;class \'int\'>}</span>\n    <span class="token comment"># 编写注解的同时 还是可以使用函数默认值 并且注解的位置位于=号的前边</span>\n    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token string">\'spam\'</span><span class="token operator">=</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span><span class="token builtin">float</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span> <span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 匿名函数:lambda</span>\n    f <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token punctuation">:</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z     <span class="token comment"># 普通匿名函数，使用方法f(1, 2, 3)</span>\n    f <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">:</span> x <span class="token operator">+</span> y     <span class="token comment"># 带默认参数的lambda函数</span>\n    <span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>                     <span class="token comment"># 嵌套lambda函数</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">lambda</span> y <span class="token punctuation">:</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span>\n    f <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> a <span class="token keyword">if</span> xxx<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> b      <span class="token comment"># 无参数的lambda函数，使用方法f()</span>\n\n<span class="token comment">#-- lambda函数与map filter reduce函数的结合</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token comment"># [2, 3, 4]</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment"># [1, 2, 3, 4]</span>\n    functools<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 6</span>\n    functools<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 24</span>\n\n<span class="token comment">#-- 生成器函数:yield VS return</span>\n    <span class="token keyword">def</span> <span class="token function">gensquare</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> i<span class="token operator">**</span> <span class="token number">2</span>                <span class="token comment"># 状态挂起 可以恢复到此时的状态</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> gensquare<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token comment"># 使用方法</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">\' \'</span><span class="token punctuation">)</span>            <span class="token comment"># [0, 1, 4, 9, 16]</span>\n    x <span class="token operator">=</span> gensquare<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                   <span class="token comment"># x是一个生成对象</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                            <span class="token comment"># 等同于x.__next__() 返回0</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                            <span class="token comment"># 等同于x.__next__() 返回1</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                            <span class="token comment"># 等同于x.__next__() 抛出异常StopIteration</span>\n\n<span class="token comment">#-- 生成器表达式:小括号进行列表解析</span>\n    G <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">**</span> <span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 使用小括号可以创建所需结果的生成器generator object</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>          <span class="token comment"># 和上述中的生成器函数的返回值一致</span>\n    <span class="token comment">#（1）生成器(生成器函数/生成器表达式)是单个迭代对象</span>\n    G <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">**</span> <span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    I1 <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>                       <span class="token comment"># 这里实际上iter(G) = G</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>I1<span class="token punctuation">)</span>                           <span class="token comment"># 输出0</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>                            <span class="token comment"># 输出1</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>I1<span class="token punctuation">)</span>                           <span class="token comment"># 输出4</span>\n    <span class="token comment">#（2）生成器不保留迭代后的结果</span>\n    gen <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token number">2</span> <span class="token keyword">in</span> gen                           <span class="token comment"># 返回True</span>\n    <span class="token number">3</span> <span class="token keyword">in</span> gen                           <span class="token comment"># 返回True</span>\n    <span class="token number">1</span> <span class="token keyword">in</span> gen                           <span class="token comment"># 返回False，其实检测2的时候，1已经就不在生成器中了，即1已经被迭代过了，同理2、3也不在了</span>\n\n<span class="token comment">#-- 本地变量是静态检测的</span>\n    X <span class="token operator">=</span> <span class="token number">22</span>                             <span class="token comment"># 全局变量X的声明和定义</span>\n    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>                       <span class="token comment"># 如果没有下一语句 则该句合法 打印全局变量X</span>\n        X <span class="token operator">=</span> <span class="token number">88</span>                         <span class="token comment"># 这一语句使得上一语句非法 因为它使得X变成了本地变量 上一句变成了打印一个未定义的本地变量(局部变量)</span>\n        <span class="token keyword">if</span> <span class="token boolean">False</span><span class="token punctuation">:</span>                      <span class="token comment"># 即使这样的语句 也会把print语句视为非法语句 因为:</span>\n            X <span class="token operator">=</span> <span class="token number">88</span>                     <span class="token comment"># Python会无视if语句而仍然声明了局部变量X</span>\n    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token comment"># 改进</span>\n        <span class="token keyword">global</span> X                       <span class="token comment"># 声明变量X为全局变量</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>                       <span class="token comment"># 打印全局变量X</span>\n        X <span class="token operator">=</span> <span class="token number">88</span>                         <span class="token comment"># 改变全局变量X</span>\n\n<span class="token comment">#-- 函数的默认值是在函数定义的时候实例化的 而不是在调用的时候 例子:</span>\n    <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>numbers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>               <span class="token comment"># 这里的[]是可变的</span>\n        numbers<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># first time, like before, [9]</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># second time, not like before, [9, 9]</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># third time, not like before too, [9, 9, 9]</span>\n    <span class="token comment"># 改进:</span>\n    <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>numbers<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> numbers <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        numbers<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    <span class="token comment"># 另外一个例子 参数的默认值为不可变的:</span>\n    <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                  <span class="token comment"># 这里的0是数字, 是不可变的</span>\n        count <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 输出1</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 还是输出1</span>\n    foo<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                             <span class="token comment"># 输出4</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 还是输出1</span>\n\n\n<span class="token triple-quoted-string string">"""函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子"""</span>\n\n    <span class="token triple-quoted-string string">"""数学运算类"""</span>\n    <span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                              <span class="token comment"># 求绝对值，参数可以是整型，也可以是复数，若参数是复数，则返回复数的模</span>\n    <span class="token builtin">complex</span><span class="token punctuation">(</span><span class="token punctuation">[</span>real<span class="token punctuation">[</span><span class="token punctuation">,</span> imag<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>             <span class="token comment"># 创建一个复数</span>\n    <span class="token builtin">divmod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>                        <span class="token comment"># 分别取商和余数，注意：整型、浮点型都可以</span>\n    <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>                          <span class="token comment"># 将一个字符串或数转换为浮点数。如果无参数将返回0.0</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span> base<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    <span class="token comment"># 将一个字符串或浮点数转换为int类型，base表示进制</span>\n    <span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span> base<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                   <span class="token comment"># 将一个字符串或浮点数转换为long类型</span>\n    <span class="token builtin">pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>                           <span class="token comment"># 返回x的y次幂</span>\n    <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span> stop<span class="token punctuation">[</span><span class="token punctuation">,</span> step<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment"># 产生一个序列，默认从0开始</span>\n    <span class="token builtin">round</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span>                       <span class="token comment"># 四舍五入</span>\n    <span class="token builtin">sum</span><span class="token punctuation">(</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> start<span class="token punctuation">]</span><span class="token punctuation">)</span>              <span class="token comment"># 对集合求和</span>\n    <span class="token builtin">oct</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                              <span class="token comment"># 将一个数字转化为8进制字符串</span>\n    <span class="token builtin">hex</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                              <span class="token comment"># 将一个数字转换为16进制字符串</span>\n    <span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                              <span class="token comment"># 返回给定int类型对应的ASCII字符</span>\n    <span class="token builtin">unichr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                           <span class="token comment"># 返回给定int类型的unicode</span>\n    <span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>                              <span class="token comment"># 返回ASCII字符对应的整数</span>\n    <span class="token builtin">bin</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                              <span class="token comment"># 将整数x转换为二进制字符串</span>\n    <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>                           <span class="token comment"># 将x转换为Boolean类型</span>\n\n    <span class="token triple-quoted-string string">"""集合类操作"""</span>\n    <span class="token builtin">basestring</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token comment"># str和unicode的超类，不能直接调用，可以用作isinstance判断</span>\n    <span class="token builtin">format</span><span class="token punctuation">(</span>value <span class="token punctuation">[</span><span class="token punctuation">,</span> format_spec<span class="token punctuation">]</span><span class="token punctuation">)</span>       <span class="token comment"># 格式化输出字符串，格式化的参数顺序从0开始，如“I am {0},I like {1}”</span>\n    <span class="token builtin">enumerate</span><span class="token punctuation">(</span>sequence<span class="token punctuation">[</span><span class="token punctuation">,</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token comment"># 返回一个可枚举的对象，注意它有第二个参数</span>\n    <span class="token builtin">iter</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token punctuation">,</span> sentinel<span class="token punctuation">]</span><span class="token punctuation">)</span>               <span class="token comment"># 生成一个对象的迭代器，第二个参数表示分隔符</span>\n    <span class="token builtin">max</span><span class="token punctuation">(</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>       <span class="token comment"># 返回集合中的最大值</span>\n    <span class="token builtin">min</span><span class="token punctuation">(</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>       <span class="token comment"># 返回集合中的最小值</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span>arg<span class="token punctuation">]</span><span class="token punctuation">)</span>                         <span class="token comment"># 创建数据字典</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iterable<span class="token punctuation">]</span><span class="token punctuation">)</span>                    <span class="token comment"># 将一个集合类转换为另外一个集合类</span>\n    <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                               <span class="token comment"># set对象实例化</span>\n    <span class="token builtin">frozenset</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iterable<span class="token punctuation">]</span><span class="token punctuation">)</span>               <span class="token comment"># 产生一个不可变的set</span>\n    <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iterable<span class="token punctuation">]</span><span class="token punctuation">)</span>                   <span class="token comment"># 生成一个tuple类型</span>\n    <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">object</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                       <span class="token comment"># 转换为string类型</span>\n    <span class="token builtin">sorted</span><span class="token punctuation">(</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token builtin">cmp</span><span class="token punctuation">[</span><span class="token punctuation">,</span> key<span class="token punctuation">[</span><span class="token punctuation">,</span> reverse<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>             <span class="token comment"># 集合排序</span>\n        L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">\'b\'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">\'c\'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">\'d\'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n        <span class="token builtin">sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>       <span class="token comment"># 使用Key参数和reverse参数</span>\n        <span class="token builtin">sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token comment"># 使用key参数进行多条件排序，即如果x[0]相同，则比较x[1]</span>\n\n    <span class="token triple-quoted-string string">"""逻辑判断"""</span>\n    <span class="token builtin">all</span><span class="token punctuation">(</span>iterable<span class="token punctuation">)</span>                       <span class="token comment"># 集合中的元素都为真的时候为真，特别的，若为空串返回为True</span>\n    <span class="token builtin">any</span><span class="token punctuation">(</span>iterable<span class="token punctuation">)</span>                       <span class="token comment"># 集合中的元素有一个为真的时候为真，特别的，若为空串返回为False</span>\n    <span class="token builtin">cmp</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>                           <span class="token comment"># 如果x &lt; y ,返回负数；x == y, 返回0；x > y,返回正数</span>\n\n    <span class="token triple-quoted-string string">"""IO操作"""</span>\n    <span class="token builtin">file</span><span class="token punctuation">(</span>filename <span class="token punctuation">[</span><span class="token punctuation">,</span> mode <span class="token punctuation">[</span><span class="token punctuation">,</span> bufsize<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># file类型的构造函数。</span>\n    <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">[</span>prompt<span class="token punctuation">]</span><span class="token punctuation">)</span>                     <span class="token comment"># 获取用户输入，推荐使用raw_input，因为该函数将不会捕获用户的错误输入，意思是自行判断类型</span>\n    <span class="token comment"># 在 Built-in Functions 里有一句话是这样写的：Consider using the raw_input() function for general input from users.</span>\n    <span class="token builtin">raw_input</span><span class="token punctuation">(</span><span class="token punctuation">[</span>prompt<span class="token punctuation">]</span><span class="token punctuation">)</span>                 <span class="token comment"># 设置输入，输入都是作为字符串处理</span>\n    <span class="token builtin">open</span><span class="token punctuation">(</span>name<span class="token punctuation">[</span><span class="token punctuation">,</span> mode<span class="token punctuation">[</span><span class="token punctuation">,</span> buffering<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>     <span class="token comment"># 打开文件，与file有什么不同？推荐使用open</span>\n\n    <span class="token triple-quoted-string string">"""其他"""</span>\n    <span class="token builtin">callable</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                    <span class="token comment"># 检查对象object是否可调用</span>\n    <span class="token builtin">classmethod</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>                   <span class="token comment"># 用来说明这个func是个类方法</span>\n    <span class="token builtin">staticmethod</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>                  <span class="token comment"># 用来说明这个func为静态方法</span>\n    <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">object</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                       <span class="token comment"># 不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。</span>\n    <span class="token builtin">help</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>                           <span class="token comment"># 返回obj的帮助信息</span>\n    <span class="token builtin">eval</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span>                    <span class="token comment"># 计算表达式expression的值，并返回</span>\n    <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>                           <span class="token comment"># 将str作为Python语句执行</span>\n    <span class="token builtin">execfile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>                  <span class="token comment"># 用法类似exec()，不同的是execfile的参数filename为文件名，而exec的参数为字符串。</span>\n    <span class="token builtin">filter</span><span class="token punctuation">(</span>function<span class="token punctuation">,</span> iterable<span class="token punctuation">)</span>          <span class="token comment"># 构造一个序列，等价于[item for item in iterable if function(item)]，function返回值为True或False的函数</span>\n        <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 返回[-3, -2, -1, 1, 2, 3], 没有0</span>\n    <span class="token builtin">hasattr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>               <span class="token comment"># 判断对象object是否包含名为name的特性</span>\n    <span class="token builtin">getattr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> name <span class="token punctuation">[</span><span class="token punctuation">,</span> defalut<span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment"># 获取一个类的属性</span>\n    <span class="token builtin">setattr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>        <span class="token comment"># 设置属性值</span>\n    <span class="token builtin">delattr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>               <span class="token comment"># 删除object对象名为name的属性</span>\n    <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 返回一个描述当前全局符号表的字典</span>\n    <span class="token builtin">hash</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                        <span class="token comment"># 如果对象object为哈希表类型，返回对象object的哈希值</span>\n    <span class="token builtin">id</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                          <span class="token comment"># 返回对象的唯一标识，一串数字</span>\n    <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> classinfo<span class="token punctuation">)</span>       <span class="token comment"># 判断object是否是class的实例</span>\n        <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>              <span class="token comment"># 判断是不是int类型</span>\n        <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># isinstance的第二个参数接受一个元组类型</span>\n    <span class="token builtin">issubclass</span><span class="token punctuation">(</span><span class="token keyword">class</span><span class="token punctuation">,</span> classinfo<span class="token punctuation">)</span>        <span class="token comment"># 判断class是否为classinfo的子类</span>\n    <span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># 返回当前的变量列表</span>\n    <span class="token builtin">map</span><span class="token punctuation">(</span>function<span class="token punctuation">,</span> iterable<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>        <span class="token comment"># 遍历每个元素，执行function操作</span>\n        <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 返回[3, 2, 1, 0, 1, 2, 3]</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">[</span><span class="token punctuation">,</span> default<span class="token punctuation">]</span><span class="token punctuation">)</span>           <span class="token comment"># 类似于iterator.next()</span>\n    <span class="token builtin">property</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fget<span class="token punctuation">[</span><span class="token punctuation">,</span> fset<span class="token punctuation">[</span><span class="token punctuation">,</span> fdel<span class="token punctuation">[</span><span class="token punctuation">,</span> doc<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>           <span class="token comment"># 属性访问的包装类，设置后可以通过c.x=value等来访问setter和getter</span>\n    <span class="token builtin">reduce</span><span class="token punctuation">(</span>function<span class="token punctuation">,</span> iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> initializer<span class="token punctuation">]</span><span class="token punctuation">)</span>         <span class="token comment"># 合并操作，从第一个开始是前两个参数，然后是前两个的结果与第三个合并进行处理，以此类推</span>\n        <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">return</span> x <span class="token operator">+</span> y\n        <span class="token builtin">reduce</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                     <span class="token comment"># 返回55 (注:1+2+3+4+5+6+7+8+9+10 = 55)</span>\n        <span class="token builtin">reduce</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>                 <span class="token comment"># 返回75</span>\n    <span class="token builtin">reload</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span>                      <span class="token comment"># 重新加载模块</span>\n    <span class="token builtin">repr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                        <span class="token comment"># 将一个对象变幻为可打印的格式</span>\n    <span class="token builtin">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> stop<span class="token punctuation">[</span><span class="token punctuation">,</span> step<span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token comment"># 产生分片对象</span>\n    <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                        <span class="token comment"># 返回该object的类型</span>\n    <span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">object</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回对象的变量名、变量值的字典</span>\n        a <span class="token operator">=</span> Class<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment"># Class为一个空类</span>\n        a<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'qi\'</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">9</span>\n        <span class="token builtin">vars</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>                         <span class="token comment"># {\'name\':\'qi\', \'age\':9}</span>\n    <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iterable<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token comment"># 返回对应数组</span>\n        <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [(1, 4), (2, 5), (3, 6)]</span>\n        a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span>\n        z <span class="token operator">=</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>                   <span class="token comment"># 压缩：[(1, "a"), (2, "b"), (3, "c")]</span>\n        <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>z<span class="token punctuation">)</span>                         <span class="token comment"># 解压缩：[(1, 2, 3), ("a", "b", "c")]</span>\n    <span class="token builtin">unicode</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> errors<span class="token punctuation">)</span>   <span class="token comment"># 将字符串string转化为unicode形式，string为encoded string。</span>\n\n\n<span class="token triple-quoted-string string">"""模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle"""</span>\n\n<span class="token comment">#-- Python模块搜索路径:</span>\n    <span class="token triple-quoted-string string">"""\n    (1)程序的主目录    (2)PYTHONPATH目录 (3)标准链接库目录 (4)任何.pth文件的内容\n    """</span>\n\n<span class="token comment">#-- 查看全部的模块搜索路径</span>\n    <span class="token keyword">import</span> sys\n    sys<span class="token punctuation">.</span>path\n    sys<span class="token punctuation">.</span>argv                            <span class="token comment"># 获得脚本的参数</span>\n    sys<span class="token punctuation">.</span>builtin_module_names            <span class="token comment"># 查找内建模块</span>\n    sys<span class="token punctuation">.</span>platform                        <span class="token comment"># 返回当前平台 出现如： "win32" "linux" "darwin"等</span>\n    sys<span class="token punctuation">.</span>modules                         <span class="token comment"># 查找已导入的模块</span>\n    sys<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    sys<span class="token punctuation">.</span>stdout                          <span class="token comment"># stdout 和 stderr 都是类文件对象，但是它们都是只写的。它们都没有 read 方法，只有 write 方法</span>\n    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span>\n    sys<span class="token punctuation">.</span>stderr\n    sys<span class="token punctuation">.</span>stdin\n\n<span class="token comment">#-- 模块的使用代码</span>\n    <span class="token keyword">import</span> module1<span class="token punctuation">,</span> module2             <span class="token comment"># 导入module1 使用module1.printer()</span>\n    <span class="token keyword">from</span> module1 <span class="token keyword">import</span> printer         <span class="token comment"># 导入module1中的printer变量 使用printer()</span>\n    <span class="token keyword">from</span> module1 <span class="token keyword">import</span> <span class="token operator">*</span>               <span class="token comment"># 导入module1中的全部变量 使用不必添加module1前缀</span>\n\n<span class="token comment">#-- 重载模块reload: 这是一个内置函数 而不是一条语句</span>\n    <span class="token keyword">from</span> imp <span class="token keyword">import</span> <span class="token builtin">reload</span>\n    <span class="token builtin">reload</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 模块的包导入:使用点号(.)而不是路径(dir1\\dir2)进行导入</span>\n    <span class="token keyword">import</span> dir1<span class="token punctuation">.</span>dir2<span class="token punctuation">.</span>mod                <span class="token comment"># d导入包(目录)dir1中的包dir2中的mod模块 此时dir1必须在Python可搜索路径中</span>\n    <span class="token keyword">from</span> dir1<span class="token punctuation">.</span>dir2<span class="token punctuation">.</span>mod <span class="token keyword">import</span> <span class="token operator">*</span>         <span class="token comment"># from语法的包导入</span>\n\n<span class="token comment">#-- __init__.py包文件:每个导入的包中都应该包含这么一个文件</span>\n    <span class="token triple-quoted-string string">"""\n    该文件可以为空\n    首次进行包导入时 该文件会自动执行\n    高级功能:在该文件中使用__all__列表来定义包(目录)以from*的形式导入时 需要导入什么\n    """</span>\n\n<span class="token comment">#-- 包相对导入:使用点号(.) 只能使用from语句</span>\n    <span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> spam                  <span class="token comment"># 导入当前目录下的spam模块（Python2: 当前目录下的模块, 直接导入即可）</span>\n    <span class="token keyword">from</span> <span class="token punctuation">.</span>spam <span class="token keyword">import</span> name              <span class="token comment"># 导入当前目录下的spam模块的name属性（Python2: 当前目录下的模块, 直接导入即可，不用加.）</span>\n    <span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">import</span> spam                 <span class="token comment"># 导入当前目录的父目录下的spam模块</span>\n\n<span class="token comment">#-- 包相对导入与普通导入的区别</span>\n    <span class="token keyword">from</span> string <span class="token keyword">import</span> <span class="token operator">*</span>                <span class="token comment"># 这里导入的string模块为sys.path路径上的 而不是本目录下的string模块(如果存在也不是)</span>\n    <span class="token keyword">from</span> <span class="token punctuation">.</span>string <span class="token keyword">import</span> <span class="token operator">*</span>               <span class="token comment"># 这里导入的string模块为本目录下的(不存在则导入失败) 而不是sys.path路径上的</span>\n\n<span class="token comment">#-- 模块数据隐藏:最小化from*的破坏</span>\n    _X                                  <span class="token comment"># 变量名前加下划线可以防止from*导入时该变量名被复制出去</span>\n    __all__ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'x\'</span><span class="token punctuation">,</span> <span class="token string">\'x1\'</span><span class="token punctuation">,</span> <span class="token string">\'x2\'</span><span class="token punctuation">]</span>         <span class="token comment"># 使用__all__列表指定from*时复制出去的变量名(变量名在列表中为字符串形式)</span>\n\n<span class="token comment">#-- 可以使用__name__进行模块的单元测试:当模块为顶层执行文件时值为\'__main__\' 当模块被导入时为模块名</span>\n    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">\'__main__\'</span><span class="token punctuation">:</span>\n        doSomething\n    <span class="token comment"># 模块属性中还有其他属性，例如：</span>\n    __doc__                             <span class="token comment"># 模块的说明文档</span>\n    __file__                            <span class="token comment"># 模块文件的文件名，包括全路径</span>\n    __name__                            <span class="token comment"># 主文件或者被导入文件</span>\n    __package__                         <span class="token comment"># 模块所在的包</span>\n\n<span class="token comment">#-- import语句from语句的as扩展</span>\n    <span class="token keyword">import</span> modulename <span class="token keyword">as</span> name\n    <span class="token keyword">from</span> modulename <span class="token keyword">import</span> attrname <span class="token keyword">as</span> name\n\n<span class="token comment">#-- 得到模块属性的几种方法 假设为了得到name属性的值</span>\n    M<span class="token punctuation">.</span>name\n    M<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">\'name\'</span><span class="token punctuation">]</span>\n    sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">\'M\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name\n    <span class="token builtin">getattr</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token string">\'name\'</span><span class="token punctuation">)</span>\n\n\n<span class="token triple-quoted-string string">"""类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象"""</span>\n\n<span class="token comment">#-- 最普通的类</span>\n    <span class="token keyword">class</span> <span class="token class-name">C1</span><span class="token punctuation">(</span>C2<span class="token punctuation">,</span> C3<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        spam <span class="token operator">=</span> <span class="token number">42</span>                       <span class="token comment"># 数据属性</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>       <span class="token comment"># 函数属性:构造函数</span>\n            self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        <span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>              <span class="token comment"># 函数属性:析构函数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"goodbey "</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>\n    I1 <span class="token operator">=</span> C1<span class="token punctuation">(</span><span class="token string">\'bob\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- Python的类没有基于参数的函数重载</span>\n    <span class="token keyword">class</span> <span class="token class-name">FirstClass</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                 <span class="token comment"># 此时类中只有一个test函数 即后者test(self) 它覆盖掉前者带参数的test函数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 子类扩展超类: 尽量调用超类的方法</span>\n    <span class="token keyword">class</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">giveRaise</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> percent<span class="token punctuation">,</span> bonus <span class="token operator">=</span> <span class="token number">.10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>pay <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pay<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> percent <span class="token operator">+</span> bonus<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 不好的方式 复制粘贴超类代码</span>\n            Person<span class="token punctuation">.</span>giveRaise<span class="token punctuation">(</span>self<span class="token punctuation">,</span> percent <span class="token operator">+</span> bonus<span class="token punctuation">)</span>            <span class="token comment"># 好的方式 尽量调用超类方法</span>\n\n<span class="token comment">#-- 类内省工具</span>\n    bob <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">\'bob\'</span><span class="token punctuation">)</span>\n    bob<span class="token punctuation">.</span>__class__                       <span class="token comment"># &lt;class \'Person\'></span>\n    bob<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__              <span class="token comment"># \'Person\'</span>\n    bob<span class="token punctuation">.</span>__dict__                        <span class="token comment"># {\'pay\':0, \'name\':\'bob\', \'job\':\'Manager\'}</span>\n\n<span class="token comment">#-- 返回1中 数据属性spam是属于类 而不是对象</span>\n    I1 <span class="token operator">=</span> C1<span class="token punctuation">(</span><span class="token string">\'bob\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> I2 <span class="token operator">=</span> C2<span class="token punctuation">(</span><span class="token string">\'tom\'</span><span class="token punctuation">)</span>      <span class="token comment"># 此时I1和I2的spam都为42 但是都是返回的C1的spam属性</span>\n    C1<span class="token punctuation">.</span>spam <span class="token operator">=</span> <span class="token number">24</span>                        <span class="token comment"># 此时I1和I2的spam都为24</span>\n    I1<span class="token punctuation">.</span>spam <span class="token operator">=</span> <span class="token number">3</span>                         <span class="token comment"># 此时I1新增自有属性spam 值为3 I2和C1的spam还都为24</span>\n\n<span class="token comment">#-- 类方法调用的两种方式</span>\n    instance<span class="token punctuation">.</span>method<span class="token punctuation">(</span>arg<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>\n    <span class="token keyword">class</span><span class="token punctuation">.</span>method<span class="token punctuation">(</span>instance<span class="token punctuation">,</span> arg<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 抽象超类的实现方法</span>\n    <span class="token comment"># (1)某个函数中调用未定义的函数 子类中定义该函数</span>\n        <span class="token keyword">def</span> <span class="token function">delegate</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>action<span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment"># 本类中不定义action函数 所以使用delegate函数时就会出错</span>\n    <span class="token comment"># (2)定义action函数 但是返回异常</span>\n        <span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token string">"action must be defined"</span><span class="token punctuation">)</span>\n    <span class="token comment"># (3)上述的两种方法还都可以定义实例对象 实际上可以利用@装饰器语法生成不能定义的抽象超类</span>\n        <span class="token keyword">from</span> abc <span class="token keyword">import</span> ABCMeta<span class="token punctuation">,</span> abstractmethod\n        <span class="token keyword">class</span> <span class="token class-name">Super</span><span class="token punctuation">(</span>metaclass <span class="token operator">=</span> ABCMeta<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            @abstractmethod\n            <span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>\n        x <span class="token operator">=</span> Super<span class="token punctuation">(</span><span class="token punctuation">)</span>                     <span class="token comment"># 返回 TypeError: Can\'t instantiate abstract class Super with abstract methods action</span>\n\n<span class="token comment">#-- # OOP和继承: "is-a"的关系</span>\n    <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">pass</span>\n    a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token builtin">isinstance</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> B<span class="token punctuation">)</span>                    <span class="token comment"># 返回True, A是B的子类 a也是B的一种</span>\n    <span class="token comment"># OOP和组合: "has-a"的关系</span>\n    <span class="token keyword">pass</span>\n    <span class="token comment"># OOP和委托: "包装"对象 在Python中委托通常是以"__getattr__"钩子方法实现的, 这个方法会拦截对不存在属性的读取</span>\n    <span class="token comment"># 包装类(或者称为代理类)可以使用__getattr__把任意读取转发给被包装的对象</span>\n    <span class="token keyword">class</span> <span class="token class-name">wrapper</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>wrapped <span class="token operator">=</span> <span class="token builtin">object</span>\n        <span class="token keyword">def</span> <span class="token function">__getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrname<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Trace: \'</span><span class="token punctuation">,</span> attrname<span class="token punctuation">)</span>\n            <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>wrapped<span class="token punctuation">,</span> attrname<span class="token punctuation">)</span>\n    <span class="token comment"># 注:这里使用getattr(X, N)内置函数以变量名字符串N从包装对象X中取出属性 类似于X.__dict__[N]</span>\n    x <span class="token operator">=</span> wrapper<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                         <span class="token comment"># 返回 "Trace: append" [1, 2, 3, 4]</span>\n    x <span class="token operator">=</span> wrapper<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">\'a\'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回 "Trace: keys" [\'a\', \'b\']</span>\n\n<span class="token comment">#-- 类的伪私有属性:使用__attr</span>\n    <span class="token keyword">class</span> <span class="token class-name">C1</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name          <span class="token comment"># 此时类的__name属性为伪私有属性 原理 它会自动变成self._C1__name = name</span>\n        <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'self.name = %s\'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>__name\n    I <span class="token operator">=</span> C1<span class="token punctuation">(</span><span class="token string">\'tom\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span>                            <span class="token comment"># 返回 self.name = tom</span>\n    I<span class="token punctuation">.</span>__name <span class="token operator">=</span> <span class="token string">\'jeey\'</span>                   <span class="token comment"># 这里无法访问 __name为伪私有属性</span>\n    I<span class="token punctuation">.</span>_C1__name <span class="token operator">=</span> <span class="token string">\'jeey\'</span>                <span class="token comment"># 这里可以修改成功 self.name = jeey</span>\n\n<span class="token comment">#-- 类方法是对象:无绑定类方法对象 / 绑定实例方法对象</span>\n    <span class="token keyword">class</span> <span class="token class-name">Spam</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">doit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">selfless</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>\n    obj <span class="token operator">=</span> Spam<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    x <span class="token operator">=</span> obj<span class="token punctuation">.</span>doit                        <span class="token comment"># 类的绑定方法对象 实例 + 函数</span>\n    x<span class="token punctuation">(</span><span class="token string">\'hello world\'</span><span class="token punctuation">)</span>\n    x <span class="token operator">=</span> Spam<span class="token punctuation">.</span>doit                       <span class="token comment"># 类的无绑定方法对象 类名 + 函数</span>\n    x<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'hello world\'</span><span class="token punctuation">)</span>\n    x <span class="token operator">=</span> Spam<span class="token punctuation">.</span>selfless                   <span class="token comment"># 类的无绑定方法函数 在3.0之前无效</span>\n    x<span class="token punctuation">(</span><span class="token string">\'hello world\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 获取对象信息: 属性和方法</span>\n    a <span class="token operator">=</span> MyObject<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token builtin">dir</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>                              <span class="token comment"># 使用dir函数</span>\n    <span class="token builtin">hasattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">\'x\'</span><span class="token punctuation">)</span>                     <span class="token comment"># 测试是否有x属性或方法 即a.x是否已经存在</span>\n    <span class="token builtin">setattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span>                 <span class="token comment"># 设置属性或方法 等同于a.y = 19</span>\n    <span class="token builtin">getattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">\'z\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>                  <span class="token comment"># 获取属性或方法 如果属性不存在 则返回默认值0</span>\n    <span class="token comment">#这里有个小技巧，setattr可以设置一个不能访问到的属性，即只能用getattr获取</span>\n    <span class="token builtin">setattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">"can\'t touch"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>      <span class="token comment"># 这里的属性名带有空格，不能直接访问</span>\n    <span class="token builtin">getattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">"can\'t touch"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment"># 但是可以用getattr获取</span>\n\n<span class="token comment">#-- 为类动态绑定属性或方法: MethodType方法</span>\n    <span class="token comment"># 一般创建了一个class的实例后, 可以给该实例绑定任何属性和方法, 这就是动态语言的灵活性</span>\n    <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">pass</span>\n    s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    s<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'Michael\'</span>                  <span class="token comment"># 动态给实例绑定一个属性</span>\n    <span class="token keyword">def</span> <span class="token function">set_age</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token comment"># 定义一个函数作为实例方法</span>\n        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age\n    <span class="token keyword">from</span> types <span class="token keyword">import</span> MethodType\n    s<span class="token punctuation">.</span>set_age <span class="token operator">=</span> MethodType<span class="token punctuation">(</span>set_age<span class="token punctuation">,</span> s<span class="token punctuation">)</span>  <span class="token comment"># 给实例绑定一个方法 类的其他实例不受此影响</span>\n    s<span class="token punctuation">.</span>set_age<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>                       <span class="token comment"># 调用实例方法</span>\n    Student<span class="token punctuation">.</span>set_age <span class="token operator">=</span> MethodType<span class="token punctuation">(</span>set_age<span class="token punctuation">,</span> Student<span class="token punctuation">)</span>    <span class="token comment"># 为类绑定一个方法 类的所有实例都拥有该方法</span>\n\n\n<span class="token triple-quoted-string string">"""类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题"""</span>\n\n<span class="token comment">#-- 多重继承: "混合类", 搜索方式"从下到上 从左到右 广度优先"</span>\n    <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">pass</span>\n\n<span class="token comment">#-- 类的继承和子类的初始化</span>\n    <span class="token comment"># 1.子类定义了__init__方法时，若未显示调用基类__init__方法，python不会帮你调用。</span>\n    <span class="token comment"># 2.子类未定义__init__方法时，python会自动帮你调用首个基类的__init__方法，注意是首个。</span>\n    <span class="token comment"># 3.子类显示调用基类的初始化函数：</span>\n    <span class="token keyword">class</span> <span class="token class-name">FooParent</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token string">\'I\\\'m the Parent.\'</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Parent:a=\'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>message <span class="token operator">+</span> <span class="token string">\' from Parent\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">class</span> <span class="token class-name">FooChild</span><span class="token punctuation">(</span>FooParent<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            FooParent<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">)</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Child:a=\'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            FooParent<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>message <span class="token operator">+</span> <span class="token string">\' from Child\'</span><span class="token punctuation">)</span>\n    fooChild <span class="token operator">=</span> FooChild<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>\n    fooChild<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token string">\'HelloWorld\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- #实例方法 / 静态方法 / 类方法</span>\n    <span class="token keyword">class</span> <span class="token class-name">Methods</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">imeth</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span>      <span class="token comment"># 实例方法：传入的是实例和数据，操作的是实例的属性</span>\n        <span class="token keyword">def</span> <span class="token function">smeth</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                  <span class="token comment"># 静态方法：只传入数据 不传入实例，操作的是类的属性而不是实例的属性</span>\n        <span class="token keyword">def</span> <span class="token function">cmeth</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> x<span class="token punctuation">)</span>        <span class="token comment"># 类方法：传入的是类对象和数据</span>\n        smeth <span class="token operator">=</span> <span class="token builtin">staticmethod</span><span class="token punctuation">(</span>smeth<span class="token punctuation">)</span>             <span class="token comment"># 调用内置函数，也可以使用@staticmethod</span>\n        cmeth <span class="token operator">=</span> <span class="token builtin">classmethod</span><span class="token punctuation">(</span>cmeth<span class="token punctuation">)</span>              <span class="token comment"># 调用内置函数，也可以使用@classmethod</span>\n    obj <span class="token operator">=</span> Methods<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    obj<span class="token punctuation">.</span>imeth<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                                <span class="token comment"># 实例方法调用 &lt;__main__.Methods object...> 1</span>\n    Methods<span class="token punctuation">.</span>imeth<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>                       <span class="token comment"># &lt;__main__.Methods object...> 2</span>\n    Methods<span class="token punctuation">.</span>smeth<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                            <span class="token comment"># 静态方法调用 3</span>\n    obj<span class="token punctuation">.</span>smeth<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                                <span class="token comment"># 这里可以使用实例进行调用</span>\n    Methods<span class="token punctuation">.</span>cmeth<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>                            <span class="token comment"># 类方法调用 &lt;class \'__main__.Methods\'> 5</span>\n    obj<span class="token punctuation">.</span>cmeth<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>                                <span class="token comment"># &lt;class \'__main__.Methods\'> 6</span>\n\n<span class="token comment">#-- 函数装饰器:是它后边的函数的运行时的声明 由@符号以及后边紧跟的"元函数"(metafunction)组成</span>\n        <span class="token decorator annotation punctuation">@staticmethod</span>\n        <span class="token keyword">def</span> <span class="token function">smeth</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n    <span class="token comment"># 等同于:</span>\n        <span class="token keyword">def</span> <span class="token function">smeth</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n        smeth <span class="token operator">=</span> <span class="token builtin">staticmethod</span><span class="token punctuation">(</span>smeth<span class="token punctuation">)</span>\n    <span class="token comment"># 同理</span>\n        <span class="token decorator annotation punctuation">@classmethod</span>\n        <span class="token keyword">def</span> <span class="token function">cmeth</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n    <span class="token comment"># 等同于</span>\n        <span class="token keyword">def</span> <span class="token function">cmeth</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n        cmeth <span class="token operator">=</span> <span class="token builtin">classmethod</span><span class="token punctuation">(</span>cmeth<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 类修饰器:是它后边的类的运行时的声明 由@符号以及后边紧跟的"元函数"(metafunction)组成</span>\n        <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>aClass<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n        @decorator\n        <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token comment"># 等同于:</span>\n        <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n        C <span class="token operator">=</span> decorator<span class="token punctuation">(</span>C<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 限制class属性: __slots__属性</span>\n    <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        __slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'age\'</span><span class="token punctuation">)</span>             <span class="token comment"># 限制Student及其实例只能拥有name和age属性</span>\n    <span class="token comment"># __slots__属性只对当前类起作用, 对其子类不起作用</span>\n    <span class="token comment"># __slots__属性能够节省内存</span>\n    <span class="token comment"># __slots__属性可以为列表list，或者元组tuple</span>\n\n<span class="token comment">#-- 类属性高级话题: @property</span>\n    <span class="token comment"># 假设定义了一个类:C，该类必须继承自object类，有一私有变量_x</span>\n    <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>__x <span class="token operator">=</span> <span class="token boolean">None</span>\n    <span class="token comment"># 第一种使用属性的方法</span>\n        <span class="token keyword">def</span> <span class="token function">getx</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>__x\n        <span class="token keyword">def</span> <span class="token function">setx</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>__x <span class="token operator">=</span> value\n        <span class="token keyword">def</span> <span class="token function">delx</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">del</span> self<span class="token punctuation">.</span>__x\n        x <span class="token operator">=</span> <span class="token builtin">property</span><span class="token punctuation">(</span>getx<span class="token punctuation">,</span> setx<span class="token punctuation">,</span> delx<span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n    <span class="token comment"># property函数原型为property(fget=None,fset=None,fdel=None,doc=None)</span>\n    <span class="token comment"># 使用</span>\n    c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    c<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">100</span>                         <span class="token comment"># 自动调用setx方法</span>\n    y <span class="token operator">=</span> c<span class="token punctuation">.</span>x                           <span class="token comment"># 自动调用getx方法</span>\n    <span class="token keyword">del</span> c<span class="token punctuation">.</span>x                           <span class="token comment"># 自动调用delx方法</span>\n    <span class="token comment"># 第二种方法使用属性的方法</span>\n        <span class="token decorator annotation punctuation">@property</span>\n        <span class="token keyword">def</span> <span class="token function">x</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>__x\n        @x<span class="token punctuation">.</span>setter\n        <span class="token keyword">def</span> <span class="token function">x</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n           self<span class="token punctuation">.</span>__x <span class="token operator">=</span> value\n        @x<span class="token punctuation">.</span>deleter\n        <span class="token keyword">def</span> <span class="token function">x</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n           <span class="token keyword">del</span> self<span class="token punctuation">.</span>__x\n    <span class="token comment"># 使用</span>\n    c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    c<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">100</span>                         <span class="token comment"># 自动调用setter方法</span>\n    y <span class="token operator">=</span> c<span class="token punctuation">.</span>x                           <span class="token comment"># 自动调用x方法</span>\n    <span class="token keyword">del</span> c<span class="token punctuation">.</span>x                           <span class="token comment"># 自动调用deleter方法</span>\n\n<span class="token comment">#-- 定制类: 重写类的方法</span>\n    <span class="token comment"># (1)__str__方法、__repr__方法: 定制类的输出字符串</span>\n    <span class="token comment"># (2)__iter__方法、next方法: 定制类的可迭代性</span>\n    <span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>     <span class="token comment"># 初始化两个计数器a，b</span>\n        <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self               <span class="token comment"># 实例本身就是迭代对象，故返回自己</span>\n        <span class="token keyword">def</span> <span class="token function">next</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> self<span class="token punctuation">.</span>b<span class="token punctuation">,</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b\n            <span class="token keyword">if</span> self<span class="token punctuation">.</span>a <span class="token operator">></span> <span class="token number">100000</span><span class="token punctuation">:</span>       <span class="token comment"># 退出循环的条件</span>\n                <span class="token keyword">raise</span> StopIteration<span class="token punctuation">(</span><span class="token punctuation">)</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>a             <span class="token comment"># 返回下一个值</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>                      <span class="token comment"># 使用</span>\n    <span class="token comment"># (3)__getitem__方法、__setitem__方法: 定制类的下标操作[] 或者切片操作slice</span>\n    <span class="token keyword">class</span> <span class="token class-name">Indexer</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token comment"># 定义getitem方法</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'getitem:\'</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>n<span class="token punctuation">]</span>\n        <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 定义setitem方法</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'setitem:key = {0}, value = {1}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>\n            self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value\n    test <span class="token operator">=</span> Indexer<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    test<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   test<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'3\'</span>              <span class="token comment"># 调用setitem方法</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                            <span class="token comment"># 调用getitem方法</span>\n    <span class="token comment"># (4)__getattr__方法: 定制类的属性操作</span>\n    <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>          <span class="token comment"># 定义当获取类的属性时的返回值</span>\n            <span class="token keyword">if</span> attr<span class="token operator">==</span><span class="token string">\'age\'</span><span class="token punctuation">:</span>\n                <span class="token keyword">return</span> <span class="token number">25</span>                     <span class="token comment"># 当获取age属性时返回25</span>\n        <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">\'object has no attribute: %s\'</span> <span class="token operator">%</span> attr<span class="token punctuation">)</span>\n        <span class="token comment"># 注意: 只有当属性不存在时 才会调用该方法 且该方法默认返回None 需要在函数最后引发异常</span>\n    s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    s<span class="token punctuation">.</span>age                                     <span class="token comment"># s中age属性不存在 故调用__getattr__方法 返回25</span>\n    <span class="token comment"># (5)__call__方法: 定制类的\'可调用\'性</span>\n    <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                   <span class="token comment"># 也可以带参数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Calling......\'</span><span class="token punctuation">)</span>\n    s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    s<span class="token punctuation">(</span><span class="token punctuation">)</span>                                       <span class="token comment"># s变成了可调用的 也可以带参数</span>\n    <span class="token builtin">callable</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>                               <span class="token comment"># 测试s的可调用性 返回True</span>\n    <span class="token comment">#    (6)__len__方法：求类的长度</span>\n    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 动态创建类type()</span>\n    <span class="token comment"># 一般创建类 需要在代码中提前定义</span>\n        <span class="token keyword">class</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'world\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello, %s.\'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span>\n        h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        h<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment"># Hello, world</span>\n        <span class="token builtin">type</span><span class="token punctuation">(</span>Hello<span class="token punctuation">)</span>                           <span class="token comment"># Hello是一个type类型 返回&lt;class \'type\'></span>\n        <span class="token builtin">type</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>                               <span class="token comment"># h是一个Hello类型 返回&lt;class \'Hello\'></span>\n    <span class="token comment"># 动态类型语言中 类可以动态创建 type函数可用于创建新类型</span>\n        <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'world\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>           <span class="token comment"># 先定义函数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello, %s.\'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span>\n        Hello <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'Hello\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>hello<span class="token operator">=</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 创建Hello类 type原型: type(name, bases, dict)</span>\n        h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 此时的h和上边的h一致</span>\n\n\n<span class="token triple-quoted-string string">"""异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关"""</span>\n\n<span class="token comment">#-- #捕获异常:</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">except</span><span class="token punctuation">:</span>                               <span class="token comment"># 捕获所有的异常 等同于except Exception:</span>\n        <span class="token keyword">except</span> name<span class="token punctuation">:</span>                          <span class="token comment"># 捕获指定的异常</span>\n        <span class="token keyword">except</span> name<span class="token punctuation">,</span> value<span class="token punctuation">:</span>                   <span class="token comment"># 捕获指定的异常和额外的数据(实例)</span>\n        <span class="token keyword">except</span> <span class="token punctuation">(</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">except</span> <span class="token punctuation">(</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span>\n        <span class="token keyword">except</span> name4 <span class="token keyword">as</span> X<span class="token punctuation">:</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>                                 <span class="token comment"># 如果没有发生异常</span>\n        <span class="token keyword">finally</span><span class="token punctuation">:</span>                              <span class="token comment"># 总会执行的部分</span>\n    <span class="token comment"># 引发异常: raise子句(raise IndexError)</span>\n        <span class="token keyword">raise</span> <span class="token operator">&lt;</span>instance<span class="token operator">></span>                      <span class="token comment"># raise instance of a class, raise IndexError()</span>\n        <span class="token keyword">raise</span> <span class="token operator">&lt;</span><span class="token keyword">class</span><span class="token operator">></span>                         <span class="token comment"># make and raise instance of a class, raise IndexError</span>\n        <span class="token keyword">raise</span>                                 <span class="token comment"># reraise the most recent exception</span>\n\n<span class="token comment">#-- Python3.x中的异常链: raise exception from otherException</span>\n    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> X<span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> IndexError<span class="token punctuation">(</span><span class="token string">\'Bad\'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> X\n\n<span class="token comment">#-- assert子句: assert &lt;test>, &lt;data></span>\n    <span class="token keyword">assert</span> x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">\'x must be negative\'</span>\n\n<span class="token comment">#-- with/as环境管理器:作为常见的try/finally用法模式的替代方案</span>\n    <span class="token keyword">with</span> expression <span class="token punctuation">[</span><span class="token keyword">as</span> variable<span class="token punctuation">]</span><span class="token punctuation">,</span> expression <span class="token punctuation">[</span><span class="token keyword">as</span> variable<span class="token punctuation">]</span><span class="token punctuation">:</span>\n    <span class="token comment"># 例子:</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> myfile<span class="token punctuation">:</span>\n            <span class="token keyword">for</span> line <span class="token keyword">in</span> myfile<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>\n    <span class="token comment"># 等同于:</span>\n        myfile <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            <span class="token keyword">for</span> line <span class="token keyword">in</span> myfile<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>\n        <span class="token keyword">finally</span><span class="token punctuation">:</span>\n            myfile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 用户自定义异常: class Bad(Exception):.....</span>\n    <span class="token triple-quoted-string string">"""\n    Exception超类 / except基类即可捕获到其所有子类\n    Exception超类有默认的打印消息和状态 当然也可以定制打印显示:\n    """</span>\n    <span class="token keyword">class</span> <span class="token class-name">MyBad</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'定制的打印消息\'</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        MyBad<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> MyBad <span class="token keyword">as</span> x<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 用户定制异常数据</span>\n    <span class="token keyword">class</span> <span class="token class-name">FormatError</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> line <span class="token punctuation">,</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>line <span class="token operator">=</span> line\n            self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">file</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> FormatError<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">\'test.py\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> FormatError <span class="token keyword">as</span> X<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Error at \'</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>line<span class="token punctuation">)</span>\n    <span class="token comment"># 用户定制异常行为(方法):以记录日志为例</span>\n    <span class="token keyword">class</span> <span class="token class-name">FormatError</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        logfile <span class="token operator">=</span> <span class="token string">\'formaterror.txt\'</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> line <span class="token punctuation">,</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>line <span class="token operator">=</span> line\n            self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">file</span>\n        <span class="token keyword">def</span> <span class="token function">logger</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>logfile<span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Error at \'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>line<span class="token punctuation">)</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> FormatError<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">\'test.py\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> FormatError <span class="token keyword">as</span> X<span class="token punctuation">:</span>\n        X<span class="token punctuation">.</span>logger<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 关于sys.exc_info:允许一个异常处理器获取对最近引发的异常的访问</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token keyword">except</span><span class="token punctuation">:</span>\n        <span class="token comment"># 此时sys.exc_info()返回一个元组(type, value, traceback)</span>\n        <span class="token comment"># type:正在处理的异常的异常类型</span>\n        <span class="token comment"># value:引发的异常的实例</span>\n        <span class="token comment"># traceback:堆栈信息</span>\n\n<span class="token comment">#-- 异常层次</span>\n    BaseException\n    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> SystemExit\n    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> KeyboardInterrupt\n    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> GeneratorExit\n    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> Exception\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> StopIteration\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> ArithmeticError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> AssertionError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> AttributeError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> BufferError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> EOFError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> ImportError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> LookupError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> MemoryError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> NameError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> OSError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> ReferenceError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> RuntimeError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> SyntaxError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> SystemError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> TypeError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> ValueError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> Warning\n\n\n<span class="token triple-quoted-string string">"""Unicode和字节字符串---Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串"""</span>\n\n<span class="token comment">#-- Python的字符串类型</span>\n    <span class="token triple-quoted-string string">"""Python2.x"""</span>\n    <span class="token comment"># 1.str表示8位文本和二进制数据</span>\n    <span class="token comment"># 2.unicode表示宽字符Unicode文本</span>\n    <span class="token triple-quoted-string string">"""Python3.x"""</span>\n    <span class="token comment"># 1.str表示Unicode文本（8位或者更宽）</span>\n    <span class="token comment"># 2.bytes表示不可变的二进制数据</span>\n    <span class="token comment"># 3.bytearray是一种可变的bytes类型</span>\n\n<span class="token comment">#-- 字符编码方法</span>\n    <span class="token triple-quoted-string string">"""ASCII"""</span>                   <span class="token comment"># 一个字节，只包含英文字符，0到127，共128个字符，利用函数可以进行字符和数字的相互转换</span>\n    <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span>                      <span class="token comment"># 字符a的ASCII码为97，所以这里返回97</span>\n    <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span>                       <span class="token comment"># 和上边的过程相反，返回字符\'a\'</span>\n    <span class="token triple-quoted-string string">"""Latin-1"""</span>                 <span class="token comment"># 一个字节，包含特殊字符，0到255，共256个字符，相当于对ASCII码的扩展</span>\n    <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">196</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回一个特殊字符：Ä</span>\n    <span class="token triple-quoted-string string">"""Unicode"""</span>                 <span class="token comment"># 宽字符，一个字符包含多个字节，一般用于亚洲的字符集，比如中文有好几万字</span>\n    <span class="token triple-quoted-string string">"""UTF-8"""</span>                   <span class="token comment"># 可变字节数，小于128的字符表示为单个字节，128到0X7FF之间的代码转换为两个字节，0X7FF以上的代码转换为3或4个字节</span>\n    <span class="token comment"># 注意：可以看出来，ASCII码是Latin-1和UTF-8的一个子集</span>\n    <span class="token comment"># 注意：utf-8是unicode的一种实现方式，unicode、gbk、gb2312是编码字符集</span>\n\n<span class="token comment">#-- 查看Python中的字符串编码名称，查看系统的编码</span>\n    <span class="token keyword">import</span> encodings\n    <span class="token builtin">help</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span>\n    <span class="token keyword">import</span> sys\n    sys<span class="token punctuation">.</span>platform                  <span class="token comment"># \'win64\'</span>\n    sys<span class="token punctuation">.</span>getdefaultencoding<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># \'utf-8\'</span>\n    sys<span class="token punctuation">.</span>getdefaultencoding<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># 返回当前系统平台的编码类型</span>\n    sys<span class="token punctuation">.</span>getsizeof<span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>         <span class="token comment"># 返回object占有的bytes的大小</span>\n\n<span class="token comment">#-- 源文件字符集编码声明: 添加注释来指定想要的编码形式 从而改变默认值 注释必须出现在脚本的第一行或者第二行</span>\n    <span class="token triple-quoted-string string">"""说明：其实这里只会检查#和coding:utf-8，其余的字符都是为了美观加上的"""</span>\n    <span class="token comment"># _*_ coding: utf-8 _*_</span>\n    <span class="token comment"># coding = utf-8</span>\n\n<span class="token comment">#-- #编码: 字符串 --> 原始字节       #解码: 原始字节 --> 字符串</span>\n\n<span class="token comment">#-- Python3.x中的字符串应用</span>\n    s <span class="token operator">=</span> <span class="token string">\'...\'</span>                     <span class="token comment"># 构建一个str对象，不可变对象</span>\n    b <span class="token operator">=</span> <span class="token string">b\'...\'</span>                    <span class="token comment"># 构建一个bytes对象，不可变对象</span>\n    s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                    <span class="token comment"># 返回(\'.\', 113)</span>\n    s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>                  <span class="token comment"># 返回(\'..\', b\'..\')</span>\n    B <span class="token operator">=</span> <span class="token triple-quoted-string string">B"""\n        xxxx\n        yyyy\n        """</span>\n    <span class="token comment"># B = b\'\\nxxxx\\nyyyy\\n\'</span>\n    <span class="token comment"># 编码，将str字符串转化为其raw bytes形式：</span>\n        <span class="token builtin">str</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding <span class="token operator">=</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">,</span> errors <span class="token operator">=</span> <span class="token string">\'strict\'</span><span class="token punctuation">)</span>\n        <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> encoding<span class="token punctuation">)</span>\n    <span class="token comment"># 编码例子：</span>\n        S <span class="token operator">=</span> <span class="token string">\'egg\'</span>\n        S<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token comment"># b\'egg\'</span>\n        <span class="token builtin">bytes</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'ascii\'</span><span class="token punctuation">)</span>  <span class="token comment"># b\'egg\'</span>\n    <span class="token comment"># 解码，将raw bytes字符串转化为str形式：</span>\n        <span class="token builtin">bytes</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding <span class="token operator">=</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">,</span> errors <span class="token operator">=</span> <span class="token string">\'strict\'</span><span class="token punctuation">)</span>\n        <span class="token builtin">str</span><span class="token punctuation">(</span>bytes_or_buffer<span class="token punctuation">[</span><span class="token punctuation">,</span> encoding<span class="token punctuation">[</span><span class="token punctuation">,</span> errors<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    <span class="token comment"># 解码例子：</span>\n        B <span class="token operator">=</span> <span class="token string">b\'spam\'</span>\n        B<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment"># \'spam\'</span>\n        <span class="token builtin">str</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span>                    <span class="token comment"># "b\'spam\'"，不带编码的str调用，结果为打印该bytes对象</span>\n        <span class="token builtin">str</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'ascii\'</span><span class="token punctuation">)</span><span class="token comment"># \'spam\'，带编码的str调用，结果为转化该bytes对象</span>\n\n<span class="token comment">#-- Python2.x的编码问题</span>\n    u <span class="token operator">=</span> <span class="token string">u\'汉\'</span>\n    <span class="token keyword">print</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>                 <span class="token comment"># u\'\\xba\\xba\'</span>\n    s <span class="token operator">=</span> u<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'UTF-8\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>                 <span class="token comment"># \'\\xc2\\xba\\xc2\\xba\'</span>\n    u2 <span class="token operator">=</span> s<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'UTF-8\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>u2<span class="token punctuation">)</span>                <span class="token comment"># u\'\\xba\\xba\'</span>\n    <span class="token comment"># 对unicode进行解码是错误的</span>\n    s2 <span class="token operator">=</span> u<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'UTF-8\'</span><span class="token punctuation">)</span>        <span class="token comment"># UnicodeEncodeError: \'ascii\' codec can\'t encode characters in position 0-1: ordinal not in range(128)</span>\n    <span class="token comment"># 同样，对str进行编码也是错误的</span>\n    u2 <span class="token operator">=</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'UTF-8\'</span><span class="token punctuation">)</span>        <span class="token comment"># UnicodeDecodeError: \'ascii\' codec can\'t decode byte 0xc2 in position 0: ordinal not in range(128)</span>\n\n<span class="token comment">#-- bytes对象</span>\n    B <span class="token operator">=</span> <span class="token string">b\'abc\'</span>\n    B <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">,</span> <span class="token string">\'ascii\'</span><span class="token punctuation">)</span>\n    B <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    B <span class="token operator">=</span> <span class="token string">\'abc\'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token comment"># bytes对象的方法调用基本和str类型一致 但:B[0]返回的是ASCII码值97, 而不是b\'a\'</span>\n\n<span class="token comment">#-- #文本文件: 根据Unicode编码来解释文件内容，要么是平台的默认编码，要么是指定的编码类型</span>\n    <span class="token comment"># 二进制文件：表示字节值的整数的一个序列 open(\'bin.txt\', \'rb\')</span>\n\n<span class="token comment">#-- Unicode文件</span>\n    s <span class="token operator">=</span> <span class="token string">\'A\\xc4B\\xe8C\'</span>             <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n    <span class="token comment">#手动编码</span>\n        l <span class="token operator">=</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'latin-1\'</span><span class="token punctuation">)</span>   <span class="token comment"># l = b\'A\\xc4B\\xe8C\'  len(l) = 5</span>\n        u <span class="token operator">=</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>     <span class="token comment"># u = b\'A\\xc3\\x84B\\xc3\\xa8C\'  len(u) = 7</span>\n    <span class="token comment">#文件输出编码</span>\n        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'latindata\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'latin-1\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n        l <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'latindata\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token comment"># l = b\'A\\xc4B\\xe8C\'  len(l) = 5</span>\n        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'uft8data\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n        u <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'uft8data\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment"># u = b\'A\\xc3\\x84B\\xc3\\xa8C\'  len(u) = 7</span>\n    <span class="token comment">#文件输入编码</span>\n        s <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'latindata\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'latin-1\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n        s <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'latindata\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'latin-1\'</span><span class="token punctuation">)</span>      <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n        s <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'utf8data\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n        s <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'utf8data\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>         <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n\n\n<span class="token triple-quoted-string string">"""其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他"""</span>\n\n<span class="token comment">#-- Python实现任意深度的赋值 例如a[0] = \'value1\'; a[1][2] = \'value2\'; a[3][4][5] = \'value3\'</span>\n    <span class="token keyword">class</span> <span class="token class-name">MyDict</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>                 <span class="token comment"># 该函数不做任何改动 这里只是为了输出</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'setitem:\'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> self<span class="token punctuation">)</span>\n            <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__setitem__<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>                       <span class="token comment"># 主要技巧在该函数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'getitem:\'</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> self<span class="token punctuation">)</span>                  <span class="token comment"># 输出信息</span>\n            <span class="token comment"># 基本思路: a[1][2]赋值时 需要先取出a[1] 然后给a[1]的[2]赋值</span>\n            <span class="token keyword">if</span> item <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">:</span>                           <span class="token comment"># 如果a[1]不存在 则需要新建一个dict 并使得a[1] = dict</span>\n                temp <span class="token operator">=</span> MyDict<span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># 新建的dict: temp</span>\n                <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__setitem__<span class="token punctuation">(</span>item<span class="token punctuation">,</span> temp<span class="token punctuation">)</span>            <span class="token comment"># 赋值a[1] = temp</span>\n                <span class="token keyword">return</span> temp                                <span class="token comment"># 返回temp 使得temp[2] = value有效</span>\n            <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span>item<span class="token punctuation">)</span>               <span class="token comment"># 如果a[1]存在 则直接返回a[1]</span>\n    <span class="token comment"># 例子:</span>\n        test <span class="token operator">=</span> MyDict<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        test<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'test\'</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        test<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'test1\'</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        test<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'test2\'</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- Python中的多维数组</span>\n    lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span>                                        <span class="token comment"># 扩展list，结果为[0, 0, 0]</span>\n    lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span>                                       <span class="token comment"># 多维数组，结果为[[], [], []]，但有问题，往下看</span>\n    lists<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                                     <span class="token comment"># 期望看到的结果[[3], [], []]，实际结果[[3], [3], [3]]，原因：list*n操作，是浅拷贝，如何避免？往下看</span>\n    lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>                         <span class="token comment"># 多维数组，结果为[[], [], []]</span>\n    lists<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                                     <span class="token comment"># 结果为[[3], [], []]</span>\n    lists<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>                                     <span class="token comment"># 结果为[[3], [6], []]</span>\n    lists<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>                                     <span class="token comment"># 结果为[[3], [6], [9]]</span>\n    lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>     <span class="token comment"># 3行4列，且每一个元素为[]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="版本二"><a href="#%E7%89%88%E6%9C%AC%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>版本二</h1>\n<h2 id="工具"><a href="#%E5%B7%A5%E5%85%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工具</h2>\n<h3 id="虚拟环境"><a href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>虚拟环境</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35579739816739877000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 安装\n\\$ pip install virtualenv\n\n# 创建环境\n\\$ virtualenv myproject\n\\$ source myproject/bin/activate\n\n# virtualenv 使用系统全局模块\n\\$ virtualenv --system-site-packages mycoolproject\n\n# 退出这个 virtualenv\n\\$ deactivate`, `35579739816739877000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 安装</span>\n$ pip <span class="token function">install</span> virtualenv\n\n<span class="token comment"># 创建环境</span>\n$ virtualenv myproject\n$ <span class="token builtin class-name">source</span> myproject/bin/activate\n\n<span class="token comment"># virtualenv 使用系统全局模块</span>\n$ virtualenv --system-site-packages mycoolproject\n\n<span class="token comment"># 退出这个 virtualenv</span>\n$ deactivate</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="对象自省"><a href="#%E5%AF%B9%E8%B1%A1%E8%87%AA%E7%9C%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对象自省</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35617555322624848000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`my_list = [1, 2, 3]\n# 列出一个对象所拥有的属性和方法\ndir(my_list)\n# 返回当前作用域的所有名字\ndir()\n\n# type 函数返回一个对象的类型\nprint(type(\'\')) # Output: <type \'str\'>\n\n# 函数返回任意不同种类对象的唯一 ID\nname = &quot;Yasoob&quot;\nprint(id(name)) # Output: 139972439030304\n\n# 查看一个对象的成员\nimport inspect\nprint(inspect.getmembers(str)) # Output: [(\'__add__\', <slot wrapper \'__add__\' of ... ...`, `35617555322624848000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">my_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token comment"># 列出一个对象所拥有的属性和方法</span>\n<span class="token builtin">dir</span><span class="token punctuation">(</span>my_list<span class="token punctuation">)</span>\n<span class="token comment"># 返回当前作用域的所有名字</span>\n<span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># type 函数返回一个对象的类型</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Output: &lt;type \'str\'></span>\n\n<span class="token comment"># 函数返回任意不同种类对象的唯一 ID</span>\nname <span class="token operator">=</span> <span class="token string">"Yasoob"</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Output: 139972439030304</span>\n\n<span class="token comment"># 查看一个对象的成员</span>\n<span class="token keyword">import</span> inspect\n<span class="token keyword">print</span><span class="token punctuation">(</span>inspect<span class="token punctuation">.</span>getmembers<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Output: [(\'__add__\', &lt;slot wrapper \'__add__\' of ... ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="语法"><a href="#%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>语法</h2>\n<h3 id="异常"><a href="#%E5%BC%82%E5%B8%B8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异常</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3614898505935881700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 正常例子\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept IOError as e:\n    print(\'An IOError occurred. {}\'.format(e.args[-1]))\n\n# 处理多个异常，有 3 种方法\n## 方法 1：\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept (IOError, EOFError) as e:\n    print(&quot;An error occurred. {}&quot;.format(e.args[-1]))\n##　方法 2：\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept EOFError as e:\n    print(&quot;An EOF error occurred.&quot;)\n    raise e\nexcept IOError as e:\n    print(&quot;An error occurred.&quot;)\n    raise e\n## 方法 3：\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept Exception:\n    # 打印一些异常日志，如果你想要的话\n    raise\n\n# finally 从句\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept IOError as e:\n    print(\'An IOError occurred. {}\'.format(e.args[-1]))\nfinally:\n    print(&quot;This would be printed whether or not an exception occurred!&quot;)\n# Output: An IOError occurred. No such file or directory\n# This would be printed whether or not an exception occurred!\n\n# try/else 从句\ntry:\n    print(\'I am sure no exception is going to occur!\')\nexcept Exception:\n    print(\'exception\')\nelse:\n    # 这里的代码只会在 try 语句里没有触发异常时运行,\n    # 但是这里的异常将 *不会* 被捕获\n    print(\'This would only run if no exception occurs. And an error here would NOT be caught.\')\nfinally:\n    print(\'This would be printed in every case.\')\n\n# Output: I am sure no exception is going to occur!\n# This would only run if no exception occurs. And an error here would NOT be caught.\n# This would be printed in every case.`, `3614898505935881700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 正常例子</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> IOError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'An IOError occurred. {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 处理多个异常，有 3 种方法</span>\n<span class="token comment">## 方法 1：</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> <span class="token punctuation">(</span>IOError<span class="token punctuation">,</span> EOFError<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"An error occurred. {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token comment">##　方法 2：</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> EOFError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"An EOF error occurred."</span><span class="token punctuation">)</span>\n    <span class="token keyword">raise</span> e\n<span class="token keyword">except</span> IOError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"An error occurred."</span><span class="token punctuation">)</span>\n    <span class="token keyword">raise</span> e\n<span class="token comment">## 方法 3：</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>\n    <span class="token comment"># 打印一些异常日志，如果你想要的话</span>\n    <span class="token keyword">raise</span>\n\n<span class="token comment"># finally 从句</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> IOError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'An IOError occurred. {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This would be printed whether or not an exception occurred!"</span><span class="token punctuation">)</span>\n<span class="token comment"># Output: An IOError occurred. No such file or directory</span>\n<span class="token comment"># This would be printed whether or not an exception occurred!</span>\n\n<span class="token comment"># try/else 从句</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'I am sure no exception is going to occur!\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'exception\'</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token comment"># 这里的代码只会在 try 语句里没有触发异常时运行,</span>\n    <span class="token comment"># 但是这里的异常将 *不会* 被捕获</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'This would only run if no exception occurs. And an error here would NOT be caught.\'</span><span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'This would be printed in every case.\'</span><span class="token punctuation">)</span>\n\n<span class="token comment"># Output: I am sure no exception is going to occur!</span>\n<span class="token comment"># This would only run if no exception occurs. And an error here would NOT be caught.</span>\n<span class="token comment"># This would be printed in every case.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="for---else"><a href="#for---else" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>For - Else</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44088599096758150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for n in range(2, 10):\n    for x in range(2, n):\n        if n % x == 0:\n            print(n, \'equals\', x, \'*\', n / x)\n            break\n    else: # 这个 else 从句会在循环正常结束时执行即循环没有遇到任何 break\n        # loop fell through without finding a factor\n        print(n, \'is a prime number\')`, `44088599096758150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> n <span class="token operator">%</span> x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token string">\'equals\'</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token string">\'*\'</span><span class="token punctuation">,</span> n <span class="token operator">/</span> x<span class="token punctuation">)</span>\n            <span class="token keyword">break</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># 这个 else 从句会在循环正常结束时执行即循环没有遇到任何 break</span>\n        <span class="token comment"># loop fell through without finding a factor</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token string">\'is a prime number\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="三元运算符"><a href="#%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>三元运算符</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1364557645661146400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 正常例子\nis_fat = True\nstate = &quot;fat&quot; if is_fat else &quot;not fat&quot;\n\n# 另一种用法，较少使用，会把 2 个条件都执行\nfat = True\nfitness = (&quot;skinny&quot;, &quot;fat&quot;)[fat]\nprint(&quot;Ali is&quot;, fitness)\n# 输出: Ali is fat`, `1364557645661146400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 正常例子</span>\nis_fat <span class="token operator">=</span> <span class="token boolean">True</span>\nstate <span class="token operator">=</span> <span class="token string">"fat"</span> <span class="token keyword">if</span> is_fat <span class="token keyword">else</span> <span class="token string">"not fat"</span>\n\n<span class="token comment"># 另一种用法，较少使用，会把 2 个条件都执行</span>\nfat <span class="token operator">=</span> <span class="token boolean">True</span>\nfitness <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"skinny"</span><span class="token punctuation">,</span> <span class="token string">"fat"</span><span class="token punctuation">)</span><span class="token punctuation">[</span>fat<span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ali is"</span><span class="token punctuation">,</span> fitness<span class="token punctuation">)</span>\n<span class="token comment"># 输出: Ali is fat</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="global"><a href="#global" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Global</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20265285367295705000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 首先，是没有使用 global 变量\ndef add(value1, value2):\n    result = value1 + value2\n\nadd(2, 4)\nprint(result)\n\n# Oh 糟了，我们遇到异常了。为什么会这样？\n# python 解释器报错说没有一个叫 result 的变量。\n# 这是因为 result 变量只能在创建它的函数内部才允许访问，除非它是全局的(global)。\nTraceback (most recent call last):\n  File &quot;&quot;, line 1, in\n    result\nNameError: name \'result\' is not defined\n\n# 现在我们运行相同的代码，不过是在将 result 变量设为 global 之后\ndef add(value1, value2):\n    global result\n    result = value1 + value2\n\nadd(2, 4)\nprint(result)\n6`, `20265285367295705000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 首先，是没有使用 global 变量</span>\n<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    result <span class="token operator">=</span> value1 <span class="token operator">+</span> value2\n\nadd<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token comment"># Oh 糟了，我们遇到异常了。为什么会这样？</span>\n<span class="token comment"># python 解释器报错说没有一个叫 result 的变量。</span>\n<span class="token comment"># 这是因为 result 变量只能在创建它的函数内部才允许访问，除非它是全局的(global)。</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">""</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span>\n    result\nNameError<span class="token punctuation">:</span> name <span class="token string">\'result\'</span> <span class="token keyword">is</span> <span class="token keyword">not</span> defined\n\n<span class="token comment"># 现在我们运行相同的代码，不过是在将 result 变量设为 global 之后</span>\n<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">global</span> result\n    result <span class="token operator">=</span> value1 <span class="token operator">+</span> value2\n\nadd<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n<span class="token number">6</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="return"><a href="#return" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Return</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98683628002805220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 方法 1：\ndef profile():\n    name = &quot;Danny&quot;\n    age = 30\n    return (name, age)\n\nprofile_data = profile()\nprint(profile_data[0])\n# Output: Danny\n\nprint(profile_data[1])\n# Output: 30\n\n# 方法二：\ndef profile():\n    name = &quot;Danny&quot;\n    age = 30\n    return name, age`, `98683628002805220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 方法 1：</span>\n<span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    name <span class="token operator">=</span> <span class="token string">"Danny"</span>\n    age <span class="token operator">=</span> <span class="token number">30</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>\n\nprofile_data <span class="token operator">=</span> profile<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>profile_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token comment"># Output: Danny</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>profile_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token comment"># Output: 30</span>\n\n<span class="token comment"># 方法二：</span>\n<span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    name <span class="token operator">=</span> <span class="token string">"Danny"</span>\n    age <span class="token operator">=</span> <span class="token number">30</span>\n    <span class="token keyword">return</span> name<span class="token punctuation">,</span> age</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="open-函数"><a href="#open-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>open 函数</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4363128475061040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 以下代码有问题\nf = open(\'photo.jpg\', \'r+\')\njpgdata = f.read()\nf.close()\n\n# 异常产生不会调用到 f.close()，需要包裹成 with 语句\n# 读取文件，传入 r；\n# 读取并写入文件，传入 r+；\n# 覆盖写入文件，传入 w；\n# 在文件末尾附加内容，传入 a；\nwith open(\'photo.jpg\', \'r+\') as f:\n    jpgdata = f.read()\n\n# 检测文件格式\nimport io\n# 二进制模式打开\nwith open(\'photo.jpg\', \'rb\') as inf:\n    jpgdata = inf.read()\n# 检测文件格式\nif jpgdata.startswith(b\'\\xff\\xd8\'):\n    text = u\'This is a JPEG file (%d bytes long)\\n\'\nelse:\n    text = u\'This is a random file (%d bytes long)\\n\'\n# io.open 兼容 python2.x 和 python3.x\nwith io.open(\'summary.txt\', \'w\', encoding=\'utf-8\') as outf:\n    outf.write(text % len(jpgdata))`, `4363128475061040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 以下代码有问题</span>\nf <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'photo.jpg\'</span><span class="token punctuation">,</span> <span class="token string">\'r+\'</span><span class="token punctuation">)</span>\njpgdata <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\nf<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 异常产生不会调用到 f.close()，需要包裹成 with 语句</span>\n<span class="token comment"># 读取文件，传入 r；</span>\n<span class="token comment"># 读取并写入文件，传入 r+；</span>\n<span class="token comment"># 覆盖写入文件，传入 w；</span>\n<span class="token comment"># 在文件末尾附加内容，传入 a；</span>\n<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'photo.jpg\'</span><span class="token punctuation">,</span> <span class="token string">\'r+\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n    jpgdata <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 检测文件格式</span>\n<span class="token keyword">import</span> io\n<span class="token comment"># 二进制模式打开</span>\n<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'photo.jpg\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> inf<span class="token punctuation">:</span>\n    jpgdata <span class="token operator">=</span> inf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 检测文件格式</span>\n<span class="token keyword">if</span> jpgdata<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b\'\\xff\\xd8\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    text <span class="token operator">=</span> <span class="token string">u\'This is a JPEG file (%d bytes long)\\n\'</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    text <span class="token operator">=</span> <span class="token string">u\'This is a random file (%d bytes long)\\n\'</span>\n<span class="token comment"># io.open 兼容 python2.x 和 python3.x</span>\n<span class="token keyword">with</span> io<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'summary.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> outf<span class="token punctuation">:</span>\n    outf<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>jpgdata<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="args-和-kwargs"><a href="#args-%E5%92%8C-kwargs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">*args</code> 和 <code class="language-text">**kwargs</code></h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97060848810432220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# *args\ndef test_var_args(f_arg, *argv):\n    print(&quot;first normal arg:&quot;, f_arg)\n    for arg in argv:\n        print(&quot;another arg through *argv:&quot;, arg)\n\ntest_var_args(\'yasoob\', \'python\', \'eggs\', \'test\')\n# Output:\n# first normal arg: yasoob\n# another arg through *argv: python\n# another arg through *argv: eggs\n# another arg through *argv: test\n\n## **kwargs\ndef greet_me(**kwargs):\n    for key, value in kwargs.items():\n        print(&quot;{0} == {1}&quot;.format(key, value))\ngreet_me(name=&quot;yasoob&quot;)\n# Output:\n# name == yasoob`, `97060848810432220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># *args</span>\n<span class="token keyword">def</span> <span class="token function">test_var_args</span><span class="token punctuation">(</span>f_arg<span class="token punctuation">,</span> <span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"first normal arg:"</span><span class="token punctuation">,</span> f_arg<span class="token punctuation">)</span>\n    <span class="token keyword">for</span> arg <span class="token keyword">in</span> argv<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"another arg through *argv:"</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>\n\ntest_var_args<span class="token punctuation">(</span><span class="token string">\'yasoob\'</span><span class="token punctuation">,</span> <span class="token string">\'python\'</span><span class="token punctuation">,</span> <span class="token string">\'eggs\'</span><span class="token punctuation">,</span> <span class="token string">\'test\'</span><span class="token punctuation">)</span>\n<span class="token comment"># Output:</span>\n<span class="token comment"># first normal arg: yasoob</span>\n<span class="token comment"># another arg through *argv: python</span>\n<span class="token comment"># another arg through *argv: eggs</span>\n<span class="token comment"># another arg through *argv: test</span>\n\n<span class="token comment">## **kwargs</span>\n<span class="token keyword">def</span> <span class="token function">greet_me</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{0} == {1}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>\ngreet_me<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"yasoob"</span><span class="token punctuation">)</span>\n<span class="token comment"># Output:</span>\n<span class="token comment"># name == yasoob</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="上下文管理器"><a href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>上下文管理器</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12815307814832112000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`with open(\'some_file\', \'w\') as opened_file:\n    opened_file.write(\'Hola!\')\n# 等价于\nfile = open(\'some_file\', \'w\')\ntry:\n    file.write(\'Hola!\')\nfinally:\n    file.close()\n\n# 实现上下文管理器\n# 1. with 语句先暂存了 File 类的 __exit__ 方法。\n# 2. 然后它调用 File 类的 __enter__ 方法。\n# 3. __enter__ 方法打开文件并返回给 with 语句。\n# 4. 打开的文件句柄被传递给 opened_file 参数。\n# 5. 我们使用 .write() 来写文件。\n# 6. with 语句调用之前暂存的 __exit__ 方法。\n# 7. __exit__ 方法关闭了文件。\nclass File(object):\n    def __init__(self, file_name, method):\n        self.file_obj = open(file_name, method)\n    def __enter__(self):\n        return self.file_obj\n    def __exit__(self, type, value, traceback):\n        self.file_obj.close()\n# 使用\nwith File(\'demo.txt\', \'w\') as opened_file:\n    opened_file.write(\'Hola!\')\n\n# 尝试下在 __exit__ 方法中处理异常\n# 1. 它把异常的 type，value 和 traceback 传递给 __exit__方法。\n# 2. 它让 __exit__ 方法来处理异常。\n# 3. 如果 __exit__ 返回的是 True，那么这个异常就被优雅地处理了。\n# 4. 如果 __exit__ 返回的是 True 以外的任何东西，那么这个异常将被 with 语句抛出。\nclass File(object):\n    def __init__(self, file_name, method):\n        self.file_obj = open(file_name, method)\n    def __enter__(self):\n        return self.file_obj\n    def __exit__(self, type, value, traceback):\n        print(&quot;Exception has been handled&quot;)\n        self.file_obj.close()\n        return True\nwith File(\'demo.txt\', \'w\') as opened_file:\n    opened_file.undefined_function()\n# Output: Exception has been handled\n\n# 基于生成器的实现\n# 1. Python 解释器遇到了 yield 关键字。因为这个缘故它创建了一个生成器而不是一个普通的函数。\n# 2. 因为这个装饰器，contextmanager 会被调用并传入函数名（open_file）作为参数。\n# 3. contextmanager 函数返回一个以 GeneratorContextManager 对象封装过的生成器。\n# 4. 这个 GeneratorContextManager 被赋值给 open_file 函数，我们实际上是在调用 GeneratorContextManager 对象。\nfrom contextlib import contextmanager\n\n@contextmanager\ndef open_file(name):\n    f = open(name, \'w\')\n    yield f\n    f.close()\n# 使用\nwith open_file(\'some_file\') as f:\n    f.write(\'hola!\')`, `12815307814832112000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'some_file\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> opened_file<span class="token punctuation">:</span>\n    opened_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Hola!\'</span><span class="token punctuation">)</span>\n<span class="token comment"># 等价于</span>\n<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'some_file\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Hola!\'</span><span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 实现上下文管理器</span>\n<span class="token comment"># 1. with 语句先暂存了 File 类的 __exit__ 方法。</span>\n<span class="token comment"># 2. 然后它调用 File 类的 __enter__ 方法。</span>\n<span class="token comment"># 3. __enter__ 方法打开文件并返回给 with 语句。</span>\n<span class="token comment"># 4. 打开的文件句柄被传递给 opened_file 参数。</span>\n<span class="token comment"># 5. 我们使用 .write() 来写文件。</span>\n<span class="token comment"># 6. with 语句调用之前暂存的 __exit__ 方法。</span>\n<span class="token comment"># 7. __exit__ 方法关闭了文件。</span>\n<span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> file_name<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>file_obj <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> method<span class="token punctuation">)</span>\n    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>file_obj\n    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>file_obj<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 使用</span>\n<span class="token keyword">with</span> File<span class="token punctuation">(</span><span class="token string">\'demo.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> opened_file<span class="token punctuation">:</span>\n    opened_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Hola!\'</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 尝试下在 __exit__ 方法中处理异常</span>\n<span class="token comment"># 1. 它把异常的 type，value 和 traceback 传递给 __exit__方法。</span>\n<span class="token comment"># 2. 它让 __exit__ 方法来处理异常。</span>\n<span class="token comment"># 3. 如果 __exit__ 返回的是 True，那么这个异常就被优雅地处理了。</span>\n<span class="token comment"># 4. 如果 __exit__ 返回的是 True 以外的任何东西，那么这个异常将被 with 语句抛出。</span>\n<span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> file_name<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>file_obj <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> method<span class="token punctuation">)</span>\n    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>file_obj\n    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Exception has been handled"</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>file_obj<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token boolean">True</span>\n<span class="token keyword">with</span> File<span class="token punctuation">(</span><span class="token string">\'demo.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> opened_file<span class="token punctuation">:</span>\n    opened_file<span class="token punctuation">.</span>undefined_function<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># Output: Exception has been handled</span>\n\n<span class="token comment"># 基于生成器的实现</span>\n<span class="token comment"># 1. Python 解释器遇到了 yield 关键字。因为这个缘故它创建了一个生成器而不是一个普通的函数。</span>\n<span class="token comment"># 2. 因为这个装饰器，contextmanager 会被调用并传入函数名（open_file）作为参数。</span>\n<span class="token comment"># 3. contextmanager 函数返回一个以 GeneratorContextManager 对象封装过的生成器。</span>\n<span class="token comment"># 4. 这个 GeneratorContextManager 被赋值给 open_file 函数，我们实际上是在调用 GeneratorContextManager 对象。</span>\n<span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager\n\n@contextmanager\n<span class="token keyword">def</span> <span class="token function">open_file</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> f\n    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 使用</span>\n<span class="token keyword">with</span> open_file<span class="token punctuation">(</span><span class="token string">\'some_file\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'hola!\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>// TODO <a href="https://py.eastlakeside.cn/book/FunctionalProgramming/README.html" target="_blank" rel="nofollow noreferrer noopener">https://py.eastlakeside.cn/book/FunctionalProgramming/README.html</a></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Python语法一览/index.md absPath of file >>> MarkdownRemark",timeToRead:28,frontmatter:{date:"2022-04-18 14:16:27",path:"/python-syntax-overview/",tags:"后端, python, 读书笔记",title:"Python语法一览",draft:null}},{excerpt:"背景资料 Python-100-Days Python 教程 因本人具有前端背景，以下内容只列举和 javascript 不同的地方 解释器 Python 的解释器很多，但使用最广泛的还是 CPython。如果要和 Java 或 .Net 平台交互，最好的办法不是用 Jython 或 IronPython，而是通过网络调用来交互，确保各程序之间的独立性。 直接运行 py 文件 一般是通过   运行，但是可以按照以下步骤在 Mac 和 Linux 上直接运行  然后，通过命令给 hello.py…",html:'<h1 id="背景资料"><a href="#%E8%83%8C%E6%99%AF%E8%B5%84%E6%96%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景资料</h1>\n<ul>\n<li><a href="https://github.com/jackfrued/Python-100-Days" target="_blank" rel="nofollow noreferrer noopener">Python-100-Days</a></li>\n<li><a href="https://www.liaoxuefeng.com/wiki/1016959663602400" target="_blank" rel="nofollow noreferrer noopener">Python 教程</a></li>\n</ul>\n<p>因本人具有前端背景，以下内容只列举和 javascript 不同的地方</p>\n<h1 id="解释器"><a href="#%E8%A7%A3%E9%87%8A%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解释器</h1>\n<p>Python 的解释器很多，但使用最广泛的还是 CPython。如果要和 Java 或 .Net 平台交互，最好的办法不是用 Jython 或 IronPython，而是通过网络调用来交互，确保各程序之间的独立性。</p>\n<h2 id="直接运行-py-文件"><a href="#%E7%9B%B4%E6%8E%A5%E8%BF%90%E8%A1%8C-py-%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直接运行 py 文件</h2>\n<p>一般是通过 <code class="language-text">python hello.py</code> 运行，但是可以按照以下步骤在 Mac 和 Linux 上直接运行 <code class="language-text">./hello.py</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83761425379727020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env python3\n\nprint(\'hello, world\')`, `83761425379727020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment">#!/usr/bin/env python3</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'hello, world\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后，通过命令给 hello.py 以执行权限，就可以直接运行</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58215633768263510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`chmod a+x hello.py`, `58215633768263510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">chmod</span> a+x hello.py</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h1 id="基础"><a href="#%E5%9F%BA%E7%A1%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基础</h1>\n<ul>\n<li>解释型动态语言，运行速度慢，代码安全性差（不能加密）</li>\n<li><code class="language-text">#</code> 开头的是注释，语句以 <code class="language-text">:</code> 结尾时，缩进的语句是为代码块，一般缩进 4 个空格</li>\n<li>大小写敏感</li>\n</ul>\n<h2 id="数据类型与变量"><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据类型与变量</h2>\n<h3 id="数据类型"><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据类型</h3>\n<ul>\n<li>\n<p>整数：允许在数字中间以 <code class="language-text">_</code> 分隔，没有大小限制，<code class="language-text">//</code> 称为地板除，即只保留整数部分</p>\n</li>\n<li>\n<p>浮点数：浮点数运算有四舍五入的误差，整数运算是精确的，没有大小限制，超过一定范围表示为 <code class="language-text">inf</code>（无限大）</p>\n</li>\n<li>\n<p>字符串：</p>\n<ul>\n<li>以 <code class="language-text">&#39;</code> 或 <code class="language-text">&quot;</code> 括起来的文本，转义字符 <code class="language-text">\\</code> 可以用来转义</li>\n<li>使用 <code class="language-text">r&#39;&#39;</code> 表示 <code class="language-text">&#39;&#39;</code> 内部的字符串默认不转义</li>\n<li>用 <code class="language-text">&#39;&#39;&#39;...&#39;&#39;&#39;</code> 表示多行内容，可以和上面的 <code class="language-text">r</code> 结合使用，即 <code class="language-text">r&#39;&#39;&#39;...&#39;&#39;&#39;</code></li>\n</ul>\n</li>\n<li>\n<p>布尔值：值为 <code class="language-text">True</code> 或 <code class="language-text">False</code>，运算符为 <code class="language-text">and</code>、<code class="language-text">or</code>、<code class="language-text">not</code></p>\n</li>\n<li>\n<p>空值：值为 <code class="language-text">None</code></p>\n</li>\n</ul>\n<h3 id="变量与常量"><a href="#%E5%8F%98%E9%87%8F%E4%B8%8E%E5%B8%B8%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量与常量</h3>\n<p>变量可以动态赋值，常量可以用全部大写的变量名表示，但没有任何机制可以保证不改变</p>\n<h2 id="字符串和编码"><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E7%BC%96%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字符串和编码</h2>\n<h3 id="字符编码"><a href="#%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字符编码</h3>\n<p>Unicode 把所有语言都统一到一套编码里，最常用的是 UCS-16 编码，用两个字节表示一个字符（如果要用到非常偏僻的字符，就需要 4 个字节）。现代操作系统和大多数编程语言都直接支持 Unicode。</p>\n<p>ASCII 编码和 Unicode 编码的区别：ASCII 编码是 1 个字节，而 Unicode 编码通常是 2 个字节。</p>\n<p>如果统一成 Unicode 编码，乱码问题从此消失了。但是，如果你写的文本基本上全部是英文的话，用 Unicode 编码比 ASCII 编码需要多一倍的存储空间，在存储和传输上就十分不划算。</p>\n<p>于是出现了把 Unicode 编码转化为“可变长编码”的 UTF-8 编码，如下表</p>\n<table>\n<thead>\n<tr>\n<th align="left">字符</th>\n<th align="left">ASCII</th>\n<th align="left">Unicode</th>\n<th align="left">UTF-8</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">A</td>\n<td align="left">01000001</td>\n<td align="left">00000000 01000001</td>\n<td align="left">01000001</td>\n</tr>\n<tr>\n<td align="left">中</td>\n<td align="left">x</td>\n<td align="left">01001110 00101101</td>\n<td align="left">11100100 10111000 10101101</td>\n</tr>\n</tbody>\n</table>\n<p>UTF-8 编码有一个额外的好处，就是 ASCII 编码实际上可以被看成是 UTF-8 编码的一部分，所以，大量只支持 ASCII 编码的历史遗留软件可以在 UTF-8 编码下继续工作。</p>\n<p>总结一下现在计算机系统通用的字符编码工作方式：</p>\n<p>在计算机内存中，统一使用 Unicode 编码，当需要保存到硬盘或者需要传输的时候，就转换为 UTF-8 编码。</p>\n<p>用记事本编辑的时候，从文件读取的 UTF-8 字符被转换为 Unicode 字符到内存里，编辑完成后，保存的时候再把 Unicode 转换为 UTF-8 保存到文件：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-04-03-18-12-23-cb32e16c63d13b9493f2f3f5dd74b01e-344e0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 307px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 90.55374592833876%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAACQklEQVQ4y42Ty5KiQBBF+f9f8BdcdK+McNmGC3yEYRjtiI+xbaFFXgUIBQw+5hQ147CbzkihrMrKvHnzYiRJej57Lj/PjyIRhpHyqOVhFIQhzoIA7UEQxnFinE7u8v19OBz+WC6v1+vj2yZEbJCv+qWsruv7/c6iLEvWHPOXdFJKisZxnOe53sR4p2lqgKe19Ti77mg0mk6ni8ViPB4PBoNer9fpdF5fX+bzuY7UlelXXa6vynRlypIyyzJKJUkcNy/P83hfLtntdqv/Gp0bRIsmIrmkrnv+/DxmeZ6k6QXLMhy0sihyKdkjC7ucUYCLxhMG1uSL2tgo1SAgHiwJIyEV+SIhqqoyiCiKUhNGhB8EdFGWVVEUj4Y/duiWcYBvtVq9vQ1Mc+Q4TkFl7nD80Rgc/NzvPw4H23Y83+cmXFCQIkJEu91uvV5vt1spc3oiu0GEEGI2m00mE9pjYZomEciAEQKbLPQMJ7bjnE4n1ATSs+cTDGEVBQEPks1mczgcSE/PNCZlwT5lKVI1hsZoCsDcJ6+CHSgNJFqJztcXT9Lxl8ptSakGfb9NJ7BrauBMAvf9gDWXSQd/T2dk6BFCdCQ79GsEQXA8HiEDkHwblCU9p1WFTqvyn4GaiVx54sAmksshl6EaVPv93rZt13XVnP5nSp6o7Klt3QzqIR20IRjLstA5cyav1syfsPs95TLVnxzoJyig3bJWMM+H0e12+/0+I2xThanvuZF1qkSX5dqVmKXUjUEEz2ZapaZNO5zxRfwGn2n3zQIgDBkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 04 03 18 12 23" title="" data-src="/static/2022-04-03-18-12-23-cb32e16c63d13b9493f2f3f5dd74b01e-344e0.png" data-srcset="/static/2022-04-03-18-12-23-cb32e16c63d13b9493f2f3f5dd74b01e-73b08.png 200w,\n/static/2022-04-03-18-12-23-cb32e16c63d13b9493f2f3f5dd74b01e-344e0.png 307w" data-sizes="(max-width: 307px) 100vw, 307px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>浏览网页的时候，服务器会把动态生成的 Unicode 内容转换为 UTF-8 再传输到浏览器：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-04-03-18-13-07-5f58825fa7ef45001ea13bc2dbf5dcda-7d4e5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 302px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.0794701986755%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAABoklEQVQ4y41T226CQBDl///B37AP9c14w1s0phhTEiONILDAAstVoYdF0brSODkZlmHOzhXJgbgu4HkUCi9vghBHwuNLUWaz2Xg8PhwOZVkWRVG+IXmeS/wax7IsXddd1/2fUNzkSiaO8xgtCALDMAghuIhSanCRZXmxWOx2u9sV5TO55iOF+Xy+2WygQej3+8PhsNPpdLsfsJzP5yZSRbZsG6fL5dLw27JtfGq3NMsk3/erdrteDd52CAVgNy3LoxSmK9w78FUSg4Rh6AcBNK48HnXGGF59P8jS7MlZalKtHzUTRpSUpmmcJDkXnOvu/CHfY3Kdptm3qk7lqaqq+/3+R9OU7XYwGMBIqd9O5imwKDqZpqZppmlibIiJLmBafA+9VnJ5jZyiVYxFqLqinU4oBGeERdmtNTeCkWCe0HEcI2DBRwqL6CkVgjTfoijCzjYViZ71bruPA6yBJDFum9goAWfRB82XbELEPylJkslkgvUcjUbYUEVRRJ9qPW3ivCSv1+vlcolftdf7XK1Wr8l8BN4T0PCQMa9qcQAFiD4g/gLi+gXiblyElAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 04 03 18 13 07" title="" data-src="/static/2022-04-03-18-13-07-5f58825fa7ef45001ea13bc2dbf5dcda-7d4e5.png" data-srcset="/static/2022-04-03-18-13-07-5f58825fa7ef45001ea13bc2dbf5dcda-8a177.png 200w,\n/static/2022-04-03-18-13-07-5f58825fa7ef45001ea13bc2dbf5dcda-7d4e5.png 302w" data-sizes="(max-width: 302px) 100vw, 302px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="python-的字符串"><a href="#python-%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Python 的字符串</h3>\n<p>对于单个字符的编码，Python 提供了 ord() 函数获取字符的整数表示，chr() 函数把编码转换为对应的字符：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28605265819623195000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> ord(\'A\')\n65\n>>> ord(\'中\')\n20013\n>>> chr(66)\n\'B\'\n>>> chr(25991)\n\'文\'`, `28605265819623195000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">\'A\'</span><span class="token punctuation">)</span>\n<span class="token number">65</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">\'中\'</span><span class="token punctuation">)</span>\n<span class="token number">20013</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">)</span>\n<span class="token string">\'B\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">25991</span><span class="token punctuation">)</span>\n<span class="token string">\'文\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果知道字符的整数编码，还可以用十六进制这么写 str：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80076236974365700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'\\u4e2d\\u6587\'\n\'中文\'`, `80076236974365700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'\\u4e2d\\u6587\'</span>\n<span class="token string">\'中文\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>两种写法完全是等价的。</p>\n<p>由于 Python 的字符串类型是 str，在内存中以 Unicode 表示，一个字符对应若干个字节。如果要在网络上传输，或者保存到磁盘上，就需要把 str 变为以字节为单位的 bytes。</p>\n<p>Python 对 bytes 类型的数据用带 b 前缀的单引号或双引号表示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35437714017643905000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x = b\'ABC\'`, `35437714017643905000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">x <span class="token operator">=</span> <span class="token string">b\'ABC\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>要注意区分 <code class="language-text">&#39;ABC&#39;</code> 和 <code class="language-text">b&#39;ABC&#39;</code>，前者是 str，后者虽然内容显示得和前者一样，但 bytes 的每个字符都只占用一个字节。</p>\n<p>以 Unicode 表示的 str 通过 <code class="language-text">encode()</code> 方法可以编码为指定的 bytes，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17579986027694883000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'ABC\'.encode(\'ascii\')\nb\'ABC\'\n>>> \'中文\'.encode(\'utf-8\')\nb\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'\n>>> \'中文\'.encode(\'ascii\')\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nUnicodeEncodeError: \'ascii\' codec can\'t encode characters in position 0-1: ordinal not in range(128)`, `17579986027694883000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'ABC\'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'ascii\'</span><span class="token punctuation">)</span>\n<span class="token string">b\'ABC\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'中文\'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>\n<span class="token string">b\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'中文\'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'ascii\'</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nUnicodeEncodeError<span class="token punctuation">:</span> <span class="token string">\'ascii\'</span> codec can\'t encode characters <span class="token keyword">in</span> position <span class="token number">0</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span> ordinal <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>纯英文的 str 可以用 ASCII 编码为 bytes，内容是一样的，含有中文的 str 可以用 UTF-8 编码为 bytes。含有中文的 str 无法用 ASCII 编码，因为中文编码的范围超过了 ASCII 编码的范围，Python 会报错。</p>\n<p>在 bytes 中，无法显示为 ASCII 字符的字节，用 <code class="language-text">\\x##</code> 显示。</p>\n<p>反过来，如果我们从网络或磁盘上读取了字节流，那么读到的数据就是 bytes。要把 bytes 变为 str，就需要用 <code class="language-text">decode()</code> 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29159371852421345000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> b\'ABC\'.decode(\'ascii\')\n\'ABC\'\n>>> b\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'.decode(\'utf-8\')\n\'中文\'`, `29159371852421345000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">b\'ABC\'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'ascii\'</span><span class="token punctuation">)</span>\n<span class="token string">\'ABC\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token string">b\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>\n<span class="token string">\'中文\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 bytes 中包含无法解码的字节，<code class="language-text">decode()</code> 方法会报错：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46972520566281270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> b\'\\xe4\\xb8\\xad\\xff\'.decode(\'utf-8\')\nTraceback (most recent call last):\n  ...\nUnicodeDecodeError: \'utf-8\' codec can\'t decode byte 0xff in position 3: invalid start byte`, `46972520566281270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">b\'\\xe4\\xb8\\xad\\xff\'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nUnicodeDecodeError<span class="token punctuation">:</span> <span class="token string">\'utf-8\'</span> codec can\'t decode byte <span class="token number">0xff</span> <span class="token keyword">in</span> position <span class="token number">3</span><span class="token punctuation">:</span> invalid start byte</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 bytes 中只有一小部分无效的字节，可以传入 <code class="language-text">errors=&#39;ignore&#39;</code> 忽略错误的字节：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42036947483029996000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> b\'\\xe4\\xb8\\xad\\xff\'.decode(\'utf-8\', errors=\'ignore\')\n\'中\'`, `42036947483029996000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">b\'\\xe4\\xb8\\xad\\xff\'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">\'ignore\'</span><span class="token punctuation">)</span>\n<span class="token string">\'中\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>要计算 str 包含多少个字符，可以用 <code class="language-text">len()</code> 函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18777401911591920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> len(\'ABC\')\n3\n>>> len(\'中文\')\n2`, `18777401911591920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">\'ABC\'</span><span class="token punctuation">)</span>\n<span class="token number">3</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">\'中文\'</span><span class="token punctuation">)</span>\n<span class="token number">2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">len()</code> 函数计算的是 str 的字符数，如果换成 bytes，<code class="language-text">len()</code> 函数就计算字节数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24291544935120355000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> len(b\'ABC\')\n3\n>>> len(b\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\')\n6\n>>> len(\'中文\'.encode(\'utf-8\'))\n6`, `24291544935120355000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">b\'ABC\'</span><span class="token punctuation">)</span>\n<span class="token number">3</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">b\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'</span><span class="token punctuation">)</span>\n<span class="token number">6</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">\'中文\'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token number">6</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可见，1 个中文字符经过 UTF-8 编码后通常会占用 3 个字节，而 1 个英文字符只占用 1 个字节。</p>\n<p>在操作字符串时，我们经常遇到 str 和 bytes 的互相转换。为了避免乱码问题，应当始终坚持使用 UTF-8 编码对 str 和 bytes 进行转换。</p>\n<p>由于 Python 源代码也是一个文本文件，所以，当你的源代码中包含中文的时候，在保存源代码时，就需要务必指定保存为 UTF-8 编码。当 Python 解释器读取源代码时，为了让它按 UTF-8 编码读取，我们通常在文件开头写上这两行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26407853211026457000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env python3\n# -*- coding: utf-8 -*-`, `26407853211026457000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment">#!/usr/bin/env python3</span>\n<span class="token comment"># -*- coding: utf-8 -*-</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>第一行注释是为了告诉 Linux/OS X 系统，这是一个 Python 可执行程序，Windows 系统会忽略这个注释；</p>\n<p>第二行注释是为了告诉 Python 解释器，按照 UTF-8 编码读取源代码，否则，你在源代码中写的中文输出可能会有乱码。</p>\n<p>申明了 UTF-8 编码并不意味着你的 .py 文件就是 UTF-8 编码的，必须并且要确保文本编辑器正在使用 UTF-8 without BOM 编码：</p>\n<p>如果 .py 文件本身使用 UTF-8 编码，并且也申明了 <code class="language-text"># -*- coding: utf-8 -*-</code>，打开命令提示符测试就可以正常显示中文：</p>\n<h3 id="格式化"><a href="#%E6%A0%BC%E5%BC%8F%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>格式化</h3>\n<p>最后一个常见的问题是如何输出格式化的字符串。我们经常会输出类似’亲爱的 xxx 你好！你 xx 月的话费是 xx，余额是 xx’之类的字符串，而 xxx 的内容都是根据变量变化的，所以，需要一种简便的格式化字符串的方式。</p>\n<p>在 Python 中，采用的格式化方式和 C 语言是一致的，用 % 实现，举例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79343209312554500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'Hello, %s\' % \'world\'\n\'Hello, world\'\n>>> \'Hi, %s, you have \\$%d.\' % (\'Michael\', 1000000)\n\'Hi, Michael, you have \\$1000000.\'`, `79343209312554500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'Hello, %s\'</span> <span class="token operator">%</span> <span class="token string">\'world\'</span>\n<span class="token string">\'Hello, world\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'Hi, %s, you have $%d.\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span>\n<span class="token string">\'Hi, Michael, you have $1000000.\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你可能猜到了，% 运算符就是用来格式化字符串的。在字符串内部，%s 表示用字符串替换，%d 表示用整数替换，有几个 %? 占位符，后面就跟几个变量或者值，顺序要对应好。如果只有一个 %?，括号可以省略。</p>\n<p>常见的占位符有：</p>\n<table>\n<thead>\n<tr>\n<th align="left">占位符</th>\n<th align="left">替换内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">%d</td>\n<td align="left">整数</td>\n</tr>\n<tr>\n<td align="left">%f</td>\n<td align="left">浮点数</td>\n</tr>\n<tr>\n<td align="left">%s</td>\n<td align="left">字符串</td>\n</tr>\n<tr>\n<td align="left">%x</td>\n<td align="left">十六进制整数</td>\n</tr>\n</tbody>\n</table>\n<p>其中，格式化整数和浮点数还可以指定是否补 0 和整数与小数的位数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96228196764755950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(\'%2d-%02d\' % (3, 1)) # 3-01\nprint(\'%.2f\' % 3.1415926) # 3.14`, `96228196764755950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%2d-%02d\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 3-01</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%.2f\'</span> <span class="token operator">%</span> <span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token comment"># 3.14</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果你不太确定应该用什么，%s 永远起作用，它会把任何数据类型转换为字符串：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83187397305692590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'Age: %s. Gender: %s\' % (25, True)\n\'Age: 25. Gender: True\'`, `83187397305692590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'Age: %s. Gender: %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token string">\'Age: 25. Gender: True\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>有些时候，字符串里面的 % 是一个普通字符怎么办？这个时候就需要转义，用 %% 来表示一个 %：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43832022282819530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'growth rate: %d %%\' % 7\n\'growth rate: 7 %\'`, `43832022282819530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'growth rate: %d %%\'</span> <span class="token operator">%</span> <span class="token number">7</span>\n<span class="token string">\'growth rate: 7 %\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h4 id="format"><a href="#format" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>format()</h4>\n<p>另一种格式化字符串的方法是使用字符串的 format() 方法，它会用传入的参数依次替换字符串内的占位符 <code class="language-text">{0}、{1}……</code>，不过这种方式写起来比 % 要麻烦得多：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57572059738426670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'Hello, {0}, 成绩提升了 {1:.1f}%\'.format(\'小明\', 17.125)\n\'Hello, 小明, 成绩提升了 17.1%\'`, `57572059738426670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'Hello, {0}, 成绩提升了 {1:.1f}%\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'小明\'</span><span class="token punctuation">,</span> <span class="token number">17.125</span><span class="token punctuation">)</span>\n<span class="token string">\'Hello, 小明, 成绩提升了 17.1%\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h4 id="f-string"><a href="#f-string" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>f-string</h4>\n<p>最后一种格式化字符串的方法是使用以 f 开头的字符串，称之为 f-string，它和普通字符串不同之处在于，字符串如果包含 {xxx}，就会以对应的变量替换：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78784780335416070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> r = 2.5\n>>> s = 3.14 * r ** 2\n>>> print(f\'The area of a circle with radius {r} is {s:.2f}\')\nThe area of a circle with radius 2.5 is 19.62`, `78784780335416070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> r <span class="token operator">=</span> <span class="token number">2.5</span>\n<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token number">3.14</span> <span class="token operator">*</span> r <span class="token operator">**</span> <span class="token number">2</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'The area of a circle with radius </span><span class="token interpolation"><span class="token punctuation">{</span>r<span class="token punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">\'</span></span><span class="token punctuation">)</span>\nThe area of a circle <span class="token keyword">with</span> radius <span class="token number">2.5</span> <span class="token keyword">is</span> <span class="token number">19.62</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上述代码中，{r} 被变量 r 的值替换，{s:.2f} 被变量 s 的值替换，并且 : 后面的 .2f 指定了格式化参数（即保留两位小数），因此，{s:.2f} 的替换结果是 19.62。</p>\n<h2 id="使用-list-和-tuple"><a href="#%E4%BD%BF%E7%94%A8-list-%E5%92%8C-tuple" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 list 和 tuple</h2>\n<h3 id="list"><a href="#list" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>list</h3>\n<p>Python 内置的一种数据类型是列表：list。list 是一种有序的集合，可以随时添加和删除其中的元素。</p>\n<p>比如，列出班里所有同学的名字，就可以用一个 list 表示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46508057281946490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates = [\'Michael\', \'Bob\', \'Tracy\']\n>>> classmates\n[\'Michael\', \'Bob\', \'Tracy\']`, `46508057281946490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates\n<span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>变量 classmates 就是一个 list。用 len() 函数可以获得 list 元素的个数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91520289349887250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> len(classmates)\n3`, `91520289349887250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span>classmates<span class="token punctuation">)</span>\n<span class="token number">3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>用索引来访问 list 中每一个位置的元素，记得索引是从 0 开始的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85581414849950370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates[0]\n\'Michael\'\n>>> classmates[1]\n\'Bob\'\n>>> classmates[2]\n\'Tracy\'\n>>> classmates[3]\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nIndexError: list index out of range`, `85581414849950370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\n<span class="token string">\'Michael\'</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token string">\'Bob\'</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token string">\'Tracy\'</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nIndexError<span class="token punctuation">:</span> <span class="token builtin">list</span> index out of <span class="token builtin">range</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当索引超出了范围时，Python 会报一个 IndexError 错误，所以，要确保索引不要越界，记得最后一个元素的索引是 <code class="language-text">len(classmates) - 1</code>。</p>\n<p>如果要取最后一个元素，除了计算索引位置外，还可以用 -1 做索引，直接获取最后一个元素：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4242481824887956000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates[-1]\n\'Tracy\'`, `4242481824887956000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token string">\'Tracy\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>以此类推，可以获取倒数第 2 个、倒数第 3 个：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88391443366913720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates[-2]\n\'Bob\'\n>>> classmates[-3]\n\'Michael\'\n>>> classmates[-4]\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nIndexError: list index out of range`, `88391443366913720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token string">\'Bob\'</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token string">\'Michael\'</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nIndexError<span class="token punctuation">:</span> <span class="token builtin">list</span> index out of <span class="token builtin">range</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然，倒数第 4 个就越界了。</p>\n<p>list 是一个可变的有序表，所以，可以往 list 中追加元素到末尾：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69782648841262130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates.append(\'Adam\')\n>>> classmates\n[\'Michael\', \'Bob\', \'Tracy\', \'Adam\']`, `69782648841262130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">\'Adam\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates\n<span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">,</span> <span class="token string">\'Adam\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>也可以把元素插入到指定的位置，比如索引号为 1 的位置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38360280193421950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates.insert(1, \'Jack\')\n>>> classmates\n[\'Michael\', \'Jack\', \'Bob\', \'Tracy\', \'Adam\']`, `38360280193421950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'Jack\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates\n<span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Jack\'</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">,</span> <span class="token string">\'Adam\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>要删除 list 末尾的元素，用 pop() 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34632093555545660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates.pop()\n\'Adam\'\n>>> classmates\n[\'Michael\', \'Jack\', \'Bob\', \'Tracy\']`, `34632093555545660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token string">\'Adam\'</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates\n<span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Jack\'</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要删除指定位置的元素，用 pop(i) 方法，其中 i 是索引位置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97739112651168600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates.pop(1)\n\'Jack\'\n>>> classmates\n[\'Michael\', \'Bob\', \'Tracy\']`, `97739112651168600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token string">\'Jack\'</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates\n<span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要把某个元素替换成别的元素，可以直接赋值给对应的索引位置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46456160327480300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates[1] = \'Sarah\'\n>>> classmates\n[\'Michael\', \'Sarah\', \'Tracy\']`, `46456160327480300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'Sarah\'</span>\n<span class="token operator">>></span><span class="token operator">></span> classmates\n<span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Sarah\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>list 里面的元素的数据类型也可以不同，比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75365290316274760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L = [\'Apple\', 123, True]`, `75365290316274760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Apple\'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>list 元素也可以是另一个 list，比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85757492880527980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = [\'python\', \'java\', [\'asp\', \'php\'], \'scheme\']\n>>> len(s)\n4`, `85757492880527980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'python\'</span><span class="token punctuation">,</span> <span class="token string">\'java\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'asp\'</span><span class="token punctuation">,</span> <span class="token string">\'php\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\'scheme\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token number">4</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>要注意 s 只有 4 个元素，其中 <code class="language-text">s[2]</code> 又是一个 list，如果拆开写就更容易理解了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9563148339184945000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> p = [\'asp\', \'php\']\n>>> s = [\'python\', \'java\', p, \'scheme\']`, `9563148339184945000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'asp\'</span><span class="token punctuation">,</span> <span class="token string">\'php\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'python\'</span><span class="token punctuation">,</span> <span class="token string">\'java\'</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token string">\'scheme\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>要拿到 <code class="language-text">&#39;php&#39;</code> 可以写 <code class="language-text">p[1]</code> 或者 <code class="language-text">s[2][1]</code>，因此 s 可以看成是一个二维数组，类似的还有三维、四维……数组，不过很少用到。</p>\n<p>如果一个 list 中一个元素也没有，就是一个空的 list，它的长度为 0：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11401925762673625000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L = []\n>>> len(L)\n0`, `11401925762673625000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>\n<span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="tuple"><a href="#tuple" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>tuple</h3>\n<p>另一种有序列表叫元组：tuple。tuple 和 list 非常类似，但是 tuple 一旦初始化就不能修改，比如同样是列出同学的名字：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35070935847320285000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> classmates = (\'Michael\', \'Bob\', \'Tracy\')`, `35070935847320285000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> classmates <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在，classmates 这个 tuple 不能变了，它也没有 append()，insert() 这样的方法。其他获取元素的方法和 list 是一样的，你可以正常地使用 <code class="language-text">classmates[0]</code>，<code class="language-text">classmates[-1]</code>，但不能赋值成另外的元素。</p>\n<p>不可变的 tuple 有什么意义？因为 tuple 不可变，所以代码更安全。如果可能，能用 tuple 代替 list 就尽量用 tuple。</p>\n<p>tuple 的陷阱：当你定义一个 tuple 时，在定义的时候，tuple 的元素就必须被确定下来，比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50601419687892510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> t = (1, 2)\n>>> t\n(1, 2)`, `50601419687892510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> t\n<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果要定义一个空的 tuple，可以写成 ()：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22410117879451152000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> t = ()\n>>> t\n()`, `22410117879451152000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> t\n<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但是，要定义一个只有 1 个元素的 tuple，如果你这么定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53142116328086140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> t = (1)\n>>> t\n1`, `53142116328086140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> t\n<span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>定义的不是 tuple，是 1 这个数，这是因为括号 () 既可以表示 tuple，又可以表示数学公式中的小括号，这就产生了歧义，因此，Python 规定，这种情况下，按小括号进行计算，计算结果自然是 1。</p>\n<p>所以，只有 1 个元素的 tuple 定义时必须加一个逗号 <code class="language-text">,</code>，来消除歧义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70885356182575410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> t = (1,)\n>>> t\n(1,)`, `70885356182575410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> t\n<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>Python 在显示只有 1 个元素的 tuple 时，也会加一个逗号 <code class="language-text">,</code>，以免你误解成数学计算意义上的括号。</p>\n<p>最后来看一个 “可变的” tuple：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52154783760982080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> t = (\'a\', \'b\', [\'A\', \'B\'])\n>>> t[2][0] = \'X\'\n>>> t[2][1] = \'Y\'\n>>> t\n(\'a\', \'b\', [\'X\', \'Y\'])`, `52154783760982080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'A\'</span><span class="token punctuation">,</span> <span class="token string">\'B\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'X\'</span>\n<span class="token operator">>></span><span class="token operator">></span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'Y\'</span>\n<span class="token operator">>></span><span class="token operator">></span> t\n<span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'X\'</span><span class="token punctuation">,</span> <span class="token string">\'Y\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>tuple 所谓的“不变”是说，tuple 的每个元素，指向永远不变。即指向 ‘a’，就不能改成指向 ‘b’，指向一个 list，就不能改成指向其他对象，但指向的这个 list 本身是可变的！</p>\n<h2 id="条件判断"><a href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>条件判断</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36720352810513334000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`age = 3\nif age >= 18:\n    print(\'adult\')\nelif age >= 6:\n    print(\'teenager\')\nelse:\n    print(\'kid\')`, `36720352810513334000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">age <span class="token operator">=</span> <span class="token number">3</span>\n<span class="token keyword">if</span> age <span class="token operator">>=</span> <span class="token number">18</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'adult\'</span><span class="token punctuation">)</span>\n<span class="token keyword">elif</span> age <span class="token operator">>=</span> <span class="token number">6</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'teenager\'</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'kid\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>if 判断条件还可以简写，比如写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70634607838677120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if x:\n    print(\'True\')`, `70634607838677120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">if</span> x<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'True\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>只要 x 是非零数值、非空字符串、非空 list 等，就判断为 True，否则为 False。</p>\n<h3 id="再议-input"><a href="#%E5%86%8D%E8%AE%AE-input" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>再议 input</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10514721430882656000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`birth = input(\'birth: \')\nif birth < 2000:\n    print(\'00前\')\nelse:\n    print(\'00后\')`, `10514721430882656000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">birth <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">\'birth: \'</span><span class="token punctuation">)</span>\n<span class="token keyword">if</span> birth <span class="token operator">&lt;</span> <span class="token number">2000</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'00前\'</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'00后\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>输入 1982，结果报错：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="592185408444612100"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Traceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nTypeError: unorderable types: str() > int()`, `592185408444612100`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Traceback (most recent call last):\n  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;\nTypeError: unorderable types: str() &gt; int()</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这是因为 input() 返回的数据类型是 str，str 不能直接和整数比较，必须先把 str 转换成整数。Python 提供了 int() 函数来完成这件事情：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51226155438721870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`s = input(\'birth: \')\nbirth = int(s)\nif birth < 2000:\n    print(\'00前\')\nelse:\n    print(\'00后\')`, `51226155438721870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">s <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">\'birth: \'</span><span class="token punctuation">)</span>\nbirth <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token keyword">if</span> birth <span class="token operator">&lt;</span> <span class="token number">2000</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'00前\'</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'00后\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>再次运行，就可以得到正确地结果。但是，如果输入 abc 呢？又会得到一个错误信息：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37835539986559350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Traceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nValueError: invalid literal for int() with base 10: \'abc\'`, `37835539986559350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nValueError<span class="token punctuation">:</span> invalid literal <span class="token keyword">for</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">with</span> base <span class="token number">10</span><span class="token punctuation">:</span> <span class="token string">\'abc\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>原来 int() 函数发现一个字符串并不是合法的数字时就会报错，程序就退出了。</p>\n<p>如何检查并捕获程序运行期的错误呢？后面的错误和调试会讲到。</p>\n<h2 id="循环"><a href="#%E5%BE%AA%E7%8E%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>循环</h2>\n<p>Python 的循环有两种，一种是 for…in 循环，依次把 list 或 tuple 中的每个元素迭代出来，看例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80982745173189950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`names = [\'Michael\', \'Bob\', \'Tracy\']\nfor name in names:\n    print(name)`, `80982745173189950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">]</span>\n<span class="token keyword">for</span> name <span class="token keyword">in</span> names<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>第二种循环是 while 循环，只要条件满足，就不断循环，条件不满足时退出循环。比如我们要计算 100 以内所有奇数之和，可以用 while 循环实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42380130154135600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`sum = 0\nn = 99\nwhile n > 0:\n    sum = sum + n\n    n = n - 2\nprint(sum)`, `42380130154135600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>\nn <span class="token operator">=</span> <span class="token number">99</span>\n<span class="token keyword">while</span> n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>\n    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">sum</span> <span class="token operator">+</span> n\n    n <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">2</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>break 提前结束循环，continue 提前结束本轮循环，并直接开始下一轮循环。</p>\n<h2 id="使用-dict-和-set"><a href="#%E4%BD%BF%E7%94%A8-dict-%E5%92%8C-set" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 dict 和 set</h2>\n<h3 id="dict"><a href="#dict" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>dict</h3>\n<p>Python 内置了字典：dict 的支持，dict 全称 dictionary，在其他语言中也称为 map，使用键-值（key-value）存储，具有极快的查找速度。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33063402937724183000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> d = {\'Michael\': 95, \'Bob\': 75, \'Tracy\': 85}\n>>> d[\'Michael\']\n95`, `33063402937724183000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'Michael\'</span><span class="token punctuation">:</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">:</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">:</span> <span class="token number">85</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> d<span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">]</span>\n<span class="token number">95</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果 key 不存在，dict 就会报错：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20268022208842605000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> d[\'Thomas\']\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nKeyError: \'Thomas\'`, `20268022208842605000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> d<span class="token punctuation">[</span><span class="token string">\'Thomas\'</span><span class="token punctuation">]</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nKeyError<span class="token punctuation">:</span> <span class="token string">\'Thomas\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要避免 key 不存在的错误，有两种办法，一是通过 in 判断 key 是否存在：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44464909362736415000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'Thomas\' in d\nFalse`, `44464909362736415000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'Thomas\'</span> <span class="token keyword">in</span> d\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>二是通过 dict 提供的 get() 方法，如果 key 不存在，可以返回 None，或者自己指定的 value：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45664081350902915000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> d.get(\'Thomas\')\n>>> d.get(\'Thomas\', -1)\n-1`, `45664081350902915000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> d<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'Thomas\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> d<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'Thomas\'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token operator">-</span><span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>注意：返回 None 的时候 Python 的交互环境不显示结果。</p>\n<p>要删除一个 key，用 pop(key) 方法，对应的 value 也会从 dict 中删除：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49019772190513300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> d.pop(\'Bob\')\n75\n>>> d\n{\'Michael\': 95, \'Tracy\': 85}`, `49019772190513300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> d<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">\'Bob\'</span><span class="token punctuation">)</span>\n<span class="token number">75</span>\n<span class="token operator">>></span><span class="token operator">></span> d\n<span class="token punctuation">{</span><span class="token string">\'Michael\'</span><span class="token punctuation">:</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">:</span> <span class="token number">85</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>请务必注意，dict 内部存放的顺序和 key 放入的顺序是没有关系的。</p>\n<p>和 list 比较，dict 有以下几个特点：</p>\n<ol>\n<li>查找和插入的速度极快，不会随着 key 的增加而变慢；</li>\n<li>需要占用大量的内存，内存浪费多。</li>\n</ol>\n<p>而 list 相反：</p>\n<ol>\n<li>查找和插入的时间随着元素的增加而增加；</li>\n<li>占用空间小，浪费内存很少。</li>\n</ol>\n<p>所以，dict 是用空间来换取时间的一种方法。</p>\n<p>dict 可以用在需要高速查找的很多地方，在 Python 代码中几乎无处不在，正确使用 dict 非常重要，需要牢记的第一条就是 dict 的 key 必须是不可变对象。</p>\n<p>这是因为 dict 根据 key 来计算 value 的存储位置，如果每次计算相同的 key 得出的结果不同，那 dict 内部就完全混乱了。这个通过 key 计算位置的算法称为哈希算法（Hash）。</p>\n<p>要保证 hash 的正确性，作为 key 的对象就不能变。在 Python 中，字符串、整数等都是不可变的，因此，可以放心地作为 key。而 list 是可变的，就不能作为 key：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22563872719986500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> key = [1, 2, 3]\n>>> d[key] = \'a list\'\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nTypeError: unhashable type: \'list\'`, `22563872719986500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> d<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'a list\'</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nTypeError<span class="token punctuation">:</span> unhashable <span class="token builtin">type</span><span class="token punctuation">:</span> <span class="token string">\'list\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="set"><a href="#set" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>set</h3>\n<p>set 和 dict 类似，也是一组 key 的集合，但不存储 value。由于 key 不能重复，所以，在 set 中，没有重复的 key。</p>\n<p>要创建一个 set，需要提供一个 list 作为输入集合：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39405188574009030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = set([1, 2, 3])\n>>> s\n{1, 2, 3}`, `39405188574009030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s\n<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>注意，传入的参数[1, 2, 3]是一个 list，而显示的{1, 2, 3}只是告诉你这个 set 内部有 1，2，3 这 3 个元素，显示的顺序也不表示 set 是有序的。。</p>\n<p>重复元素在 set 中自动被过滤：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83125727291732750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = set([1, 1, 2, 2, 3, 3])\n>>> s\n{1, 2, 3}`, `83125727291732750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s\n<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>通过 add(key) 方法可以添加元素到 set 中，可以重复添加，但不会有效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43294930537473260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s.add(4)\n>>> s\n{1, 2, 3, 4}\n>>> s.add(4)\n>>> s\n{1, 2, 3, 4}`, `43294930537473260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s\n<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s\n<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>通过 remove(key) 方法可以删除元素：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24234643266235770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s.remove(4)\n>>> s\n{1, 2, 3}`, `24234643266235770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s\n<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>set 可以看成数学意义上的无序和无重复元素的集合，因此，两个 set 可以做数学意义上的交集、并集等操作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89194707684895100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s1 = set([1, 2, 3])\n>>> s2 = set([2, 3, 4])\n>>> s1 & s2\n{2, 3}\n>>> s1 | s2\n{1, 2, 3, 4}`, `89194707684895100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s1 <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s2 <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s1 <span class="token operator">&amp;</span> s2\n<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> s1 <span class="token operator">|</span> s2\n<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>set 和 dict 的唯一区别仅在于没有存储对应的 value，但是，set 的原理和 dict 一样，所以，同样不可以放入可变对象，因为无法判断两个可变对象是否相等，也就无法保证 set 内部“不会有重复元素”。试试把 list 放入 set，看看是否会报错。</p>\n<h3 id="再议不可变对象"><a href="#%E5%86%8D%E8%AE%AE%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>再议不可变对象</h3>\n<p>上面我们讲了，str 是不变对象，而 list 是可变对象。</p>\n<p>对于可变对象，比如 list，对 list 进行操作，list 内部的内容是会变化的，比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10424789221867870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a = [\'c\', \'b\', \'a\']\n>>> a.sort()\n>>> a\n[\'a\', \'b\', \'c\']`, `10424789221867870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> a\n<span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而对于不可变对象，比如 str，对 str 进行操作呢：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83551461952606220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a = \'abc\'\n>>> a.replace(\'a\', \'A\')\n\'Abc\'\n>>> a\n\'abc\'`, `83551461952606220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token string">\'abc\'</span>\n<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'A\'</span><span class="token punctuation">)</span>\n<span class="token string">\'Abc\'</span>\n<span class="token operator">>></span><span class="token operator">></span> a\n<span class="token string">\'abc\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>虽然字符串有个 replace() 方法，也确实变出了 ‘Abc’，但变量 a 最后仍是 ‘abc’，应该怎么理解呢？</p>\n<p>我们先把代码改成下面这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62807618395241185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a = \'abc\'\n>>> b = a.replace(\'a\', \'A\')\n>>> b\n\'Abc\'\n>>> a\n\'abc\'`, `62807618395241185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token string">\'abc\'</span>\n<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> a<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'A\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> b\n<span class="token string">\'Abc\'</span>\n<span class="token operator">>></span><span class="token operator">></span> a\n<span class="token string">\'abc\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要始终牢记的是，a 是变量，而 ‘abc’ 才是字符串对象！有些时候，我们经常说，对象 a 的内容是 ‘abc’，但其实是指，a 本身是一个变量，它指向的对象的内容才是 ‘abc’</p>\n<p>当我们调用 a.replace(‘a’, ‘A’) 时，实际上调用方法 replace 是作用在字符串对象 ‘abc’ 上的，而这个方法虽然名字叫 replace，但却没有改变字符串 ‘abc’ 的内容。相反，replace 方法创建了一个新字符串 ‘Abc’ 并返回，如果我们用变量 b 指向该新字符串，就容易理解了，变量 a 仍指向原有的字符串 ‘abc’，但变量 b 却指向新字符串 ‘Abc’ 了</p>\n<p>所以，对于不变对象来说，调用对象自身的任意方法，也不会改变该对象自身的内容。相反，这些方法会创建新的对象并返回，这样，就保证了不可变对象本身永远是不可变的。</p>\n<h1 id="函数"><a href="#%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数</h1>\n<h2 id="调用函数"><a href="#%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用函数</h2>\n<p>Python 内置了很多有用的函数，我们可以直接调用</p>\n<p>可以直接从 Python 的官方网站查看<a href="http://docs.python.org/3/library/functions.html#abs" target="_blank" rel="nofollow noreferrer noopener">文档</a>，也可以在交互式命令行通过 help(abs) 查看 abs 函数的帮助信息</p>\n<h3 id="数据类型转换"><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据类型转换</h3>\n<p>Python 内置的常用函数还包括数据类型转换函数，比如 int() 函数可以把其他数据类型转换为整数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66720901339212470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> int(\'123\')\n123\n>>> int(12.34)\n12\n>>> float(\'12.34\')\n12.34\n>>> str(1.23)\n\'1.23\'\n>>> str(100)\n\'100\'\n>>> bool(1)\nTrue\n>>> bool(\'\')\nFalse`, `66720901339212470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">\'123\'</span><span class="token punctuation">)</span>\n<span class="token number">123</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">12.34</span><span class="token punctuation">)</span>\n<span class="token number">12</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'12.34\'</span><span class="token punctuation">)</span>\n<span class="token number">12.34</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">)</span>\n<span class="token string">\'1.23\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>\n<span class="token string">\'100\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span>\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>函数名其实就是指向一个函数对象的引用，完全可以把函数名赋给一个变量，相当于给这个函数起了一个“别名”：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99002321808597980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a = abs # 变量 a 指向 abs 函数\n>>> a(-1) # 所以也可以通过 a 调用 abs 函数\n1`, `99002321808597980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token builtin">abs</span> <span class="token comment"># 变量 a 指向 abs 函数</span>\n<span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 所以也可以通过 a 调用 abs 函数</span>\n<span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="定义函数"><a href="#%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>定义函数</h3>\n<p>在 Python 中，定义一个函数要使用 def 语句，依次写出函数名、括号、括号中的参数和冒号 :，然后，在缩进块中编写函数体，函数的返回值用 return 语句返回。</p>\n<p>我们以自定义一个求绝对值的 my_abs 函数为例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72018927832679020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def my_abs(x):\n    if x >= 0:\n        return x\n    else:\n        return -x\n\nprint(my_abs(-99))`, `72018927832679020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">my_abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> x <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> x\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token operator">-</span>x\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>my_abs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果没有 return 语句，函数执行完毕后也会返回结果，只是结果为 None。return None 可以简写为 return。</p>\n<h3 id="空函数"><a href="#%E7%A9%BA%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>空函数</h3>\n<p>如果想定义一个什么事也不做的空函数，可以用 pass 语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27894460154052370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def nop():\n    pass`, `27894460154052370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">nop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>pass 语句什么都不做，那有什么用？实际上 pass 可以用来作为占位符，比如现在还没想好怎么写函数的代码，就可以先放一个 pass，让代码能运行起来。</p>\n<p>pass 还可以用在其他语句里，比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69161404574169130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if age >= 18:\n    pass`, `69161404574169130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">if</span> age <span class="token operator">>=</span> <span class="token number">18</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>缺少了 pass，代码运行就会有语法错误。</p>\n<h3 id="参数检查"><a href="#%E5%8F%82%E6%95%B0%E6%A3%80%E6%9F%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参数检查</h3>\n<p>调用函数时，如果参数个数不对，Python 解释器会自动检查出来，并抛出 TypeError：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2541016040310251000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> my_abs(1, 2)\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nTypeError: my_abs() takes 1 positional argument but 2 were given`, `2541016040310251000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> my_abs<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nTypeError<span class="token punctuation">:</span> my_abs<span class="token punctuation">(</span><span class="token punctuation">)</span> takes <span class="token number">1</span> positional argument but <span class="token number">2</span> were given</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是如果参数类型不对，Python 解释器就无法帮我们检查。试试 my_abs 和内置函数 abs 的差别：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1095573123179627300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> my_abs(\'A\')\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\n  File &quot;<stdin>&quot;, line 2, in my_abs\nTypeError: unorderable types: str() >= int()\n>>> abs(\'A\')\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nTypeError: bad operand type for abs(): \'str\'`, `1095573123179627300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> my_abs<span class="token punctuation">(</span><span class="token string">\'A\'</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">in</span> my_abs\nTypeError<span class="token punctuation">:</span> unorderable types<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token string">\'A\'</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nTypeError<span class="token punctuation">:</span> bad operand <span class="token builtin">type</span> <span class="token keyword">for</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token string">\'str\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当传入了不恰当的参数时，内置函数 abs 会检查出参数错误，而我们定义的 my_abs 没有参数检查，会导致 if 语句出错，出错信息和 abs 不一样。所以，这个函数定义不够完善。</p>\n<p>让我们修改一下 my_abs 的定义，对参数类型做检查，只允许整数和浮点数类型的参数。数据类型检查可以用内置函数 isinstance() 实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34551474184674190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def my_abs(x):\n    if not isinstance(x, (int, float)):\n        raise TypeError(\'bad operand type\')\n    if x >= 0:\n        return x\n    else:\n        return -x`, `34551474184674190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">my_abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">\'bad operand type\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> x <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> x\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token operator">-</span>x</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>添加了参数检查后，如果传入错误的参数类型，函数就可以抛出一个错误：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75480382825136870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> my_abs(\'A\')\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\n  File &quot;<stdin>&quot;, line 3, in my_abs\nTypeError: bad operand type`, `75480382825136870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> my_abs<span class="token punctuation">(</span><span class="token string">\'A\'</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">in</span> my_abs\nTypeError<span class="token punctuation">:</span> bad operand <span class="token builtin">type</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>错误和异常处理将在后续讲到。</p>\n<h3 id="返回多个值"><a href="#%E8%BF%94%E5%9B%9E%E5%A4%9A%E4%B8%AA%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>返回多个值</h3>\n<p>函数可以返回多个值吗？答案是肯定的。</p>\n<p>比如在游戏中经常需要从一个点移动到另一个点，给出坐标、位移和角度，就可以计算出新的坐标：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29049093707758653000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import math\n\ndef move(x, y, step, angle=0):\n    nx = x + step * math.cos(angle)\n    ny = y - step * math.sin(angle)\n    return nx, ny`, `29049093707758653000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> math\n\n<span class="token keyword">def</span> <span class="token function">move</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> step<span class="token punctuation">,</span> angle<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    nx <span class="token operator">=</span> x <span class="token operator">+</span> step <span class="token operator">*</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>angle<span class="token punctuation">)</span>\n    ny <span class="token operator">=</span> y <span class="token operator">-</span> step <span class="token operator">*</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>angle<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> nx<span class="token punctuation">,</span> ny</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>import math 语句表示导入 math 包，并允许后续代码引用 math 包里的 sin、cos 等函数。</p>\n<p>然后，我们就可以同时获得返回值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5547982559750686000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> x, y = move(100, 100, 60, math.pi / 6)\n>>> print(x, y)\n151.96152422706632 70.0`, `5547982559750686000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> x<span class="token punctuation">,</span> y <span class="token operator">=</span> move<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n<span class="token number">151.96152422706632</span> <span class="token number">70.0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但其实这只是一种假象，Python 函数返回的仍然是单一值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73794651441012060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> r = move(100, 100, 60, math.pi / 6)\n>>> print(r)\n(151.96152422706632, 70.0)`, `73794651441012060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> r <span class="token operator">=</span> move<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token number">151.96152422706632</span><span class="token punctuation">,</span> <span class="token number">70.0</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>原来返回值是一个 tuple！但是，在语法上，返回一个 tuple 可以省略括号，而多个变量可以同时接收一个 tuple，按位置赋给对应的值，所以，Python 的函数返回多值其实就是返回一个 tuple，但写起来更方便。</p>\n<h2 id="函数的参数"><a href="#%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数的参数</h2>\n<h3 id="位置参数"><a href="#%E4%BD%8D%E7%BD%AE%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>位置参数</h3>\n<p>power(x, n)函数有两个参数：x 和 n，这两个参数都是位置参数，调用函数时，传入的两个值按照位置顺序依次赋给参数 x 和 n。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61030024976794200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def power(x, n):\n    s = 1\n    while n > 0:\n        n = n - 1\n        s = s * x\n    return s`, `61030024976794200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">power</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    s <span class="token operator">=</span> <span class="token number">1</span>\n    <span class="token keyword">while</span> n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>\n        n <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span>\n        s <span class="token operator">=</span> s <span class="token operator">*</span> x\n    <span class="token keyword">return</span> s</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="默认参数"><a href="#%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>默认参数</h3>\n<p>设置默认参数时，注意点如下：</p>\n<ol>\n<li>必选参数在前，默认参数在后，否则 Python 的解释器会报错（思考一下为什么默认参数不能放在必选参数前面）</li>\n<li>当函数有多个参数时，把变化大的参数放前面，变化小的参数放后面。变化小的参数就可以作为默认参数</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58958676018405590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def enroll(name, gender, age=6, city=\'Beijing\'):\n    print(\'name:\', name)\n    print(\'gender:\', gender)\n    print(\'age:\', age)\n    print(\'city:\', city)`, `58958676018405590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">enroll</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token string">\'Beijing\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'name:\'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'gender:\'</span><span class="token punctuation">,</span> gender<span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'age:\'</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'city:\'</span><span class="token punctuation">,</span> city<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有多个默认参数时，调用的时候，既可以按顺序提供默认参数，比如调用 <code class="language-text">enroll(&#39;Bob&#39;, &#39;M&#39;, 7)</code>，意思是，除了 name，gender 这两个参数外，最后 1 个参数应用在参数 age 上，city 参数由于没有提供，仍然使用默认值。</p>\n<p>也可以不按顺序提供部分默认参数。当不按顺序提供部分默认参数时，需要把参数名写上。比如调用 <code class="language-text">enroll(&#39;Adam&#39;, &#39;M&#39;, city=&#39;Tianjin&#39;)</code>，意思是，city 参数用传进去的值，其他默认参数继续使用默认值。</p>\n<p>默认参数很有用，但使用不当，也会掉坑里。默认参数有个最大的坑，演示如下：</p>\n<p>先定义一个函数，传入一个 list，添加一个 END 再返回：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60147268623499530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def add_end(L=[]):\n    L.append(\'END\')\n    return L`, `60147268623499530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">add_end</span><span class="token punctuation">(</span>L<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">\'END\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> L</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当你正常调用时，结果似乎不错：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17841112933392011000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> add_end([1, 2, 3])\n[1, 2, 3, \'END\']\n>>> add_end([\'x\', \'y\', \'z\'])\n[\'x\', \'y\', \'z\', \'END\']`, `17841112933392011000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> add_end<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'END\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> add_end<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'x\'</span><span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">,</span> <span class="token string">\'z\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'x\'</span><span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">,</span> <span class="token string">\'z\'</span><span class="token punctuation">,</span> <span class="token string">\'END\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当你使用默认参数调用时，一开始结果也是对的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17523737088399049000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> add_end()\n[\'END\']`, `17523737088399049000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> add_end<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'END\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是，再次调用 add_end() 时，结果就不对了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2965367527633477600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> add_end()\n[\'END\', \'END\']\n>>> add_end()\n[\'END\', \'END\', \'END\']`, `2965367527633477600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> add_end<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'END\'</span><span class="token punctuation">,</span> <span class="token string">\'END\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> add_end<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'END\'</span><span class="token punctuation">,</span> <span class="token string">\'END\'</span><span class="token punctuation">,</span> <span class="token string">\'END\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>原因解释如下：</p>\n<p>Python 函数在定义的时候，默认参数 L 的值就被计算出来了，即 []，因为默认参数 L 也是一个变量，它指向对象 []，每次调用该函数，如果改变了 L 的内容，则下次调用时，默认参数的内容就变了，不再是函数定义时的 [] 了。</p>\n<blockquote>\n<p>定义默认参数要牢记一点：默认参数必须指向不变对象！</p>\n</blockquote>\n<p>要修改上面的例子，我们可以用 None 这个不变对象来实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64064685002097410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def add_end(L=None):\n    if L is None:\n        L = []\n    L.append(\'END\')\n    return L`, `64064685002097410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">add_end</span><span class="token punctuation">(</span>L<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> L <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n        L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">\'END\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> L</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在，无论调用多少次，都不会有问题：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48881326606810100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> add_end()\n[\'END\']\n>>> add_end()\n[\'END\']`, `48881326606810100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> add_end<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'END\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> add_end<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'END\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为什么要设计 str、None 这样的不变对象呢？因为不变对象一旦创建，对象内部的数据就不能修改，这样就减少了由于修改数据导致的错误。此外，由于对象不变，多任务环境下同时读取对象不需要加锁，同时读一点问题都没有。我们在编写程序时，如果可以设计一个不变对象，那就尽量设计成不变对象。</p>\n<h3 id="可变参数"><a href="#%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可变参数</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55966034910639470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def calc(numbers):\n    sum = 0\n    for n in numbers:\n        sum = sum + n * n\n    return sum`, `55966034910639470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">calc</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>\n        <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">sum</span> <span class="token operator">+</span> n <span class="token operator">*</span> n\n    <span class="token keyword">return</span> <span class="token builtin">sum</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是调用的时候，需要先组装出一个 list 或 tuple：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50911376085355454000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> calc([1, 2, 3])\n14\n>>> calc((1, 3, 5, 7))\n84`, `50911376085355454000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> calc<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token number">14</span>\n<span class="token operator">>></span><span class="token operator">></span> calc<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token number">84</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果利用可变参数，调用函数的方式可以简化成这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35705954265053364000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> calc(1, 2, 3)\n14\n>>> calc(1, 3, 5, 7)\n84`, `35705954265053364000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> calc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n<span class="token number">14</span>\n<span class="token operator">>></span><span class="token operator">></span> calc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>\n<span class="token number">84</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所以，我们把函数的参数改为可变参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24573085742534873000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def calc(*numbers):\n    sum = 0\n    for n in numbers:\n        sum = sum + n * n\n    return sum`, `24573085742534873000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token operator">*</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>\n        <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">sum</span> <span class="token operator">+</span> n <span class="token operator">*</span> n\n    <span class="token keyword">return</span> <span class="token builtin">sum</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在函数内部，参数 numbers 接收到的是一个 tuple，因此，函数代码完全不变。但是，调用该函数时，可以传入任意个参数，包括 0 个参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72983308317927850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> calc(1, 2)\n5\n>>> calc()\n0`, `72983308317927850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> calc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token number">5</span>\n<span class="token operator">>></span><span class="token operator">></span> calc<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果已经有一个 list 或者 tuple，要调用一个可变参数怎么办？可以这样做：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46899807389668250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> nums = [1, 2, 3]\n>>> calc(nums[0], nums[1], nums[2])\n14`, `46899807389668250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> calc<span class="token punctuation">(</span>nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token number">14</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这种写法当然是可行的，问题是太繁琐，所以 Python 允许你在 list 或 tuple 前面加一个 * 号，把 list 或 tuple 的元素变成可变参数传进去：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16160028169637685000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> nums = [1, 2, 3]\n>>> calc(*nums)\n14`, `16160028169637685000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> calc<span class="token punctuation">(</span><span class="token operator">*</span>nums<span class="token punctuation">)</span>\n<span class="token number">14</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>*nums 表示把 nums 这个 list 的所有元素作为可变参数传进去。这种写法相当有用，而且很常见。</p>\n<h3 id="关键字参数"><a href="#%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关键字参数</h3>\n<p>可变参数允许你传入 0 个或任意个参数，这些可变参数在函数调用时自动组装为一个 tuple。而关键字参数允许你传入 0 个或任意个含参数名的参数，这些关键字参数在函数内部自动组装为一个 dict。请看示例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87708521703024410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def person(name, age, **kw):\n    print(\'name:\', name, \'age:\', age, \'other:\', kw)`, `87708521703024410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'name:\'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">\'age:\'</span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token string">\'other:\'</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>函数 person 除了必选参数 name 和 age 外，还接受关键字参数 kw。在调用该函数时，可以只传入必选参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83584429316550590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> person(\'Michael\', 30)\nname: Michael age: 30 other: {}`, `83584429316550590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> person<span class="token punctuation">(</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>\nname<span class="token punctuation">:</span> Michael age<span class="token punctuation">:</span> <span class="token number">30</span> other<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>也可以传入任意个数的关键字参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96807766073835570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> person(\'Bob\', 35, city=\'Beijing\')\nname: Bob age: 35 other: {\'city\': \'Beijing\'}\n>>> person(\'Adam\', 45, gender=\'M\', job=\'Engineer\')\nname: Adam age: 45 other: {\'gender\': \'M\', \'job\': \'Engineer\'}`, `96807766073835570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> person<span class="token punctuation">(</span><span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token string">\'Beijing\'</span><span class="token punctuation">)</span>\nname<span class="token punctuation">:</span> Bob age<span class="token punctuation">:</span> <span class="token number">35</span> other<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'city\'</span><span class="token punctuation">:</span> <span class="token string">\'Beijing\'</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> person<span class="token punctuation">(</span><span class="token string">\'Adam\'</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token string">\'M\'</span><span class="token punctuation">,</span> job<span class="token operator">=</span><span class="token string">\'Engineer\'</span><span class="token punctuation">)</span>\nname<span class="token punctuation">:</span> Adam age<span class="token punctuation">:</span> <span class="token number">45</span> other<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'gender\'</span><span class="token punctuation">:</span> <span class="token string">\'M\'</span><span class="token punctuation">,</span> <span class="token string">\'job\'</span><span class="token punctuation">:</span> <span class="token string">\'Engineer\'</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>关键字参数有什么用？它可以扩展函数的功能。比如，在 person 函数里，我们保证能接收到 name 和 age 这两个参数，但是，如果调用者愿意提供更多的参数，我们也能收到。试想你正在做一个用户注册的功能，除了用户名和年龄是必填项外，其他都是可选项，利用关键字参数来定义这个函数就能满足注册的需求。</p>\n<p>和可变参数类似，也可以先组装出一个 dict，然后，把该 dict 转换为关键字参数传进去：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57761305320733310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> extra = {\'city\': \'Beijing\', \'job\': \'Engineer\'}\n>>> person(\'Jack\', 24, city=extra[\'city\'], job=extra[\'job\'])\nname: Jack age: 24 other: {\'city\': \'Beijing\', \'job\': \'Engineer\'}`, `57761305320733310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> extra <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'city\'</span><span class="token punctuation">:</span> <span class="token string">\'Beijing\'</span><span class="token punctuation">,</span> <span class="token string">\'job\'</span><span class="token punctuation">:</span> <span class="token string">\'Engineer\'</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> person<span class="token punctuation">(</span><span class="token string">\'Jack\'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> city<span class="token operator">=</span>extra<span class="token punctuation">[</span><span class="token string">\'city\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> job<span class="token operator">=</span>extra<span class="token punctuation">[</span><span class="token string">\'job\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\nname<span class="token punctuation">:</span> Jack age<span class="token punctuation">:</span> <span class="token number">24</span> other<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'city\'</span><span class="token punctuation">:</span> <span class="token string">\'Beijing\'</span><span class="token punctuation">,</span> <span class="token string">\'job\'</span><span class="token punctuation">:</span> <span class="token string">\'Engineer\'</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当然，上面复杂的调用可以用简化的写法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92760484650798500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> extra = {\'city\': \'Beijing\', \'job\': \'Engineer\'}\n>>> person(\'Jack\', 24, **extra)\nname: Jack age: 24 other: {\'city\': \'Beijing\', \'job\': \'Engineer\'}`, `92760484650798500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> extra <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'city\'</span><span class="token punctuation">:</span> <span class="token string">\'Beijing\'</span><span class="token punctuation">,</span> <span class="token string">\'job\'</span><span class="token punctuation">:</span> <span class="token string">\'Engineer\'</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> person<span class="token punctuation">(</span><span class="token string">\'Jack\'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token operator">**</span>extra<span class="token punctuation">)</span>\nname<span class="token punctuation">:</span> Jack age<span class="token punctuation">:</span> <span class="token number">24</span> other<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">\'city\'</span><span class="token punctuation">:</span> <span class="token string">\'Beijing\'</span><span class="token punctuation">,</span> <span class="token string">\'job\'</span><span class="token punctuation">:</span> <span class="token string">\'Engineer\'</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">**extra</code> 表示把 extra 这个 dict 的所有 key-value 用关键字参数传入到函数的 <code class="language-text">**kw</code> 参数，kw 将获得一个 dict，注意 kw 获得的 dict 是 extra 的一份拷贝，对 kw 的改动不会影响到函数外的 extra。</p>\n<h3 id="命名关键字参数"><a href="#%E5%91%BD%E5%90%8D%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>命名关键字参数</h3>\n<p>对于关键字参数，函数的调用者可以传入任意不受限制的关键字参数。至于到底传入了哪些，就需要在函数内部通过 kw 检查。</p>\n<p>仍以 person() 函数为例，我们希望检查是否有 city 和 job 参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50539803102633930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def person(name, age, **kw):\n    if \'city\' in kw:\n        # 有 city 参数\n        pass\n    if \'job\' in kw:\n        # 有 job 参数\n        pass\n    print(\'name:\', name, \'age:\', age, \'other:\', kw)`, `50539803102633930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token string">\'city\'</span> <span class="token keyword">in</span> kw<span class="token punctuation">:</span>\n        <span class="token comment"># 有 city 参数</span>\n        <span class="token keyword">pass</span>\n    <span class="token keyword">if</span> <span class="token string">\'job\'</span> <span class="token keyword">in</span> kw<span class="token punctuation">:</span>\n        <span class="token comment"># 有 job 参数</span>\n        <span class="token keyword">pass</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'name:\'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">\'age:\'</span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token string">\'other:\'</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是调用者仍可以传入不受限制的关键字参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96873242692423700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> person(\'Jack\', 24, city=\'Beijing\', addr=\'Chaoyang\', zipcode=123456)`, `96873242692423700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> person<span class="token punctuation">(</span><span class="token string">\'Jack\'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token string">\'Beijing\'</span><span class="token punctuation">,</span> addr<span class="token operator">=</span><span class="token string">\'Chaoyang\'</span><span class="token punctuation">,</span> zipcode<span class="token operator">=</span><span class="token number">123456</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果要限制关键字参数的名字，就可以用命名关键字参数，例如，只接收 city 和 job 作为关键字参数。这种方式定义的函数如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57029604527466170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def person(name, age, *, city, job):\n    print(name, age, city, job)`, `57029604527466170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>和关键字参数 <code class="language-text">**kw</code> 不同，命名关键字参数需要一个特殊分隔符 <code class="language-text">*</code>，<code class="language-text">*</code> 后面的参数被视为命名关键字参数。</p>\n<p>调用方式如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28631451068959166000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> person(\'Jack\', 24, city=\'Beijing\', job=\'Engineer\')\nJack 24 Beijing Engineer`, `28631451068959166000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> person<span class="token punctuation">(</span><span class="token string">\'Jack\'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token string">\'Beijing\'</span><span class="token punctuation">,</span> job<span class="token operator">=</span><span class="token string">\'Engineer\'</span><span class="token punctuation">)</span>\nJack <span class="token number">24</span> Beijing Engineer</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果函数定义中已经有了一个可变参数，后面跟着的命名关键字参数就不再需要一个特殊分隔符 <code class="language-text">*</code> 了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52307530519914594000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def person(name, age, *args, city, job):\n    print(name, age, args, city, job)`, `52307530519914594000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> args<span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>命名关键字参数必须传入参数名，这和位置参数不同。如果没有传入参数名，调用将报错：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58420571345134805000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> person(\'Jack\', 24, \'Beijing\', \'Engineer\')\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nTypeError: person() missing 2 required keyword-only arguments: \'city\' and \'job\'`, `58420571345134805000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> person<span class="token punctuation">(</span><span class="token string">\'Jack\'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">\'Beijing\'</span><span class="token punctuation">,</span> <span class="token string">\'Engineer\'</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nTypeError<span class="token punctuation">:</span> person<span class="token punctuation">(</span><span class="token punctuation">)</span> missing <span class="token number">2</span> required keyword<span class="token operator">-</span>only arguments<span class="token punctuation">:</span> <span class="token string">\'city\'</span> <span class="token keyword">and</span> <span class="token string">\'job\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于调用时缺少参数名 city 和 job，Python 解释器把前两个参数视为位置参数，后两个参数传给 <code class="language-text">*args</code>，但缺少命名关键字参数导致报错。</p>\n<p>命名关键字参数可以有缺省值，从而简化调用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51001828738439080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def person(name, age, *, city=\'Beijing\', job):\n    print(name, age, city, job)`, `51001828738439080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token string">\'Beijing\'</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>由于命名关键字参数 city 具有默认值，调用时，可不传入 city 参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51519518720434455000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> person(\'Jack\', 24, job=\'Engineer\')\nJack 24 Beijing Engineer`, `51519518720434455000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> person<span class="token punctuation">(</span><span class="token string">\'Jack\'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> job<span class="token operator">=</span><span class="token string">\'Engineer\'</span><span class="token punctuation">)</span>\nJack <span class="token number">24</span> Beijing Engineer</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>使用命名关键字参数时，要特别注意，如果没有可变参数，就必须加一个 <code class="language-text">*</code> 作为特殊分隔符。如果缺少 <code class="language-text">*</code>，Python 解释器将无法识别位置参数和命名关键字参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84876098790658410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def person(name, age, city, job):\n    # 缺少 *，city 和 job 被视为位置参数\n    pass`, `84876098790658410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># 缺少 *，city 和 job 被视为位置参数</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="参数组合"><a href="#%E5%8F%82%E6%95%B0%E7%BB%84%E5%90%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参数组合</h3>\n<p>在 Python 中定义函数，可以用必选参数、默认参数、可变参数、关键字参数和命名关键字参数，这 5 种参数都可以组合使用。但是请注意，参数定义的顺序必须是：必选参数、默认参数、可变参数、命名关键字参数和关键字参数。</p>\n<p>比如定义一个函数，包含上述若干种参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81183201037887210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def f1(a, b, c=0, *args, **kw):\n    print(\'a =\', a, \'b =\', b, \'c =\', c, \'args =\', args, \'kw =\', kw)\n\ndef f2(a, b, c=0, *, d, **kw):\n    print(\'a =\', a, \'b =\', b, \'c =\', c, \'d =\', d, \'kw =\', kw)`, `81183201037887210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'a =\'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token string">\'b =\'</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token string">\'c =\'</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token string">\'args =\'</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token string">\'kw =\'</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">f2</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'a =\'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token string">\'b =\'</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token string">\'c =\'</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token string">\'d =\'</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token string">\'kw =\'</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在函数调用的时候，Python 解释器自动按照参数位置和参数名把对应的参数传进去。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73458191084903210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f1(1, 2)\na = 1 b = 2 c = 0 args = () kw = {}\n>>> f1(1, 2, c=3)\na = 1 b = 2 c = 3 args = () kw = {}\n>>> f1(1, 2, 3, \'a\', \'b\')\na = 1 b = 2 c = 3 args = (\'a\', \'b\') kw = {}\n>>> f1(1, 2, 3, \'a\', \'b\', x=99)\na = 1 b = 2 c = 3 args = (\'a\', \'b\') kw = {\'x\': 99}\n>>> f2(1, 2, d=99, ext=None)\na = 1 b = 2 c = 0 d = 99 kw = {\'ext\': None}`, `73458191084903210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\na <span class="token operator">=</span> <span class="token number">1</span> b <span class="token operator">=</span> <span class="token number">2</span> c <span class="token operator">=</span> <span class="token number">0</span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> kw <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>\na <span class="token operator">=</span> <span class="token number">1</span> b <span class="token operator">=</span> <span class="token number">2</span> c <span class="token operator">=</span> <span class="token number">3</span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> kw <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">)</span>\na <span class="token operator">=</span> <span class="token number">1</span> b <span class="token operator">=</span> <span class="token number">2</span> c <span class="token operator">=</span> <span class="token number">3</span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">)</span> kw <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">)</span>\na <span class="token operator">=</span> <span class="token number">1</span> b <span class="token operator">=</span> <span class="token number">2</span> c <span class="token operator">=</span> <span class="token number">3</span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">)</span> kw <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'x\'</span><span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> f2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">,</span> ext<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>\na <span class="token operator">=</span> <span class="token number">1</span> b <span class="token operator">=</span> <span class="token number">2</span> c <span class="token operator">=</span> <span class="token number">0</span> d <span class="token operator">=</span> <span class="token number">99</span> kw <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'ext\'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最神奇的是通过一个 tuple 和 dict，你也可以调用上述函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2222536667866936800"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> args = (1, 2, 3, 4)\n>>> kw = {\'d\': 99, \'x\': \'#\'}\n>>> f1(*args, **kw)\na = 1 b = 2 c = 3 args = (4,) kw = {\'d\': 99, \'x\': \'#\'}\n>>> args = (1, 2, 3)\n>>> kw = {\'d\': 88, \'x\': \'#\'}\n>>> f2(*args, **kw)\na = 1 b = 2 c = 3 d = 88 kw = {\'x\': \'#\'}`, `2222536667866936800`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> kw <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'d\'</span><span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">\'x\'</span><span class="token punctuation">:</span> <span class="token string">\'#\'</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>\na <span class="token operator">=</span> <span class="token number">1</span> b <span class="token operator">=</span> <span class="token number">2</span> c <span class="token operator">=</span> <span class="token number">3</span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">)</span> kw <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'d\'</span><span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">\'x\'</span><span class="token punctuation">:</span> <span class="token string">\'#\'</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> kw <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'d\'</span><span class="token punctuation">:</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token string">\'x\'</span><span class="token punctuation">:</span> <span class="token string">\'#\'</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> f2<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>\na <span class="token operator">=</span> <span class="token number">1</span> b <span class="token operator">=</span> <span class="token number">2</span> c <span class="token operator">=</span> <span class="token number">3</span> d <span class="token operator">=</span> <span class="token number">88</span> kw <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'x\'</span><span class="token punctuation">:</span> <span class="token string">\'#\'</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所以，对于任意函数，都可以通过类似 <code class="language-text">func(*args, **kw)</code> 的形式调用它，无论它的参数是如何定义的。</p>\n<blockquote>\n<p>虽然可以组合多达 5 种参数，但不要同时使用太多的组合，否则函数接口的可理解性很差。</p>\n</blockquote>\n<h3 id="小结"><a href="#%E5%B0%8F%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>Python 的函数具有非常灵活的参数形态，既可以实现简单的调用，又可以传入非常复杂的参数。</p>\n<p>默认参数一定要用不可变对象，如果是可变对象，程序运行时会有逻辑错误！</p>\n<p>要注意定义可变参数和关键字参数的语法：</p>\n<ul>\n<li><code class="language-text">*args</code> 是可变参数，args 接收的是一个 tuple；</li>\n<li><code class="language-text">**kw</code> 是关键字参数，kw 接收的是一个 dict。</li>\n</ul>\n<p>以及调用函数时如何传入可变参数和关键字参数的语法：</p>\n<ul>\n<li>可变参数既可以直接传入：<code class="language-text">func(1, 2, 3)</code>，又可以先组装 list 或 tuple，再通过 <code class="language-text">*args</code> 传入：<code class="language-text">func(*(1, 2, 3))</code>；</li>\n<li>关键字参数既可以直接传入：<code class="language-text">func(a=1, b=2)</code>，又可以先组装 dict，再通过 <code class="language-text">**kw</code> 传入：<code class="language-text">func(**{&#39;a&#39;: 1, &#39;b&#39;: 2})</code>。</li>\n</ul>\n<p>使用 <code class="language-text">*args</code> 和 <code class="language-text">**kw</code> 是 Python 的习惯写法，当然也可以用其他参数名，但最好使用习惯用法。</p>\n<p>命名的关键字参数是为了限制调用者可以传入的参数名，同时可以提供默认值。</p>\n<p>定义命名的关键字参数在没有可变参数的情况下不要忘了写分隔符 <code class="language-text">*</code>，否则定义的将是位置参数。</p>\n<h2 id="递归函数"><a href="#%E9%80%92%E5%BD%92%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>递归函数</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46556256022586260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def fact(n):\n    return fact_iter(n, 1)\n\ndef fact_iter(num, product):\n    if num == 1:\n        return product\n    return fact_iter(num - 1, num * product)`, `46556256022586260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">fact</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> fact_iter<span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">fact_iter</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> product<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> product\n    <span class="token keyword">return</span> fact_iter<span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> num <span class="token operator">*</span> product<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，<code class="language-text">return fact_iter(num - 1, num * product)</code> 仅返回递归函数本身，<code class="language-text">num - 1</code> 和 <code class="language-text">num * product</code> 在函数调用前就会被计算，不影响函数调用。</p>\n<p><code class="language-text">fact(5)</code> 对应的 <code class="language-text">fact_iter(5, 1)</code> 的调用如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1375002434431982300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`===> fact_iter(5, 1)\n===> fact_iter(4, 5)\n===> fact_iter(3, 20)\n===> fact_iter(2, 60)\n===> fact_iter(1, 120)\n===> 120`, `1375002434431982300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> fact_iter<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> fact_iter<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>\n<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> fact_iter<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>\n<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> fact_iter<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>\n<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> fact_iter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span>\n<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token number">120</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>尾递归调用时，如果做了优化，栈不会增长，因此，无论多少次调用也不会导致栈溢出。</p>\n<p>遗憾的是，大多数编程语言没有针对尾递归做优化，Python 解释器也没有做优化，所以，即使把上面的 fact(n) 函数改成尾递归方式，也会导致栈溢出。</p>\n<h3 id="小结-1"><a href="#%E5%B0%8F%E7%BB%93-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>使用递归函数的优点是逻辑简单清晰，缺点是过深的调用会导致栈溢出。</p>\n<p>针对尾递归优化的语言可以通过尾递归防止栈溢出。尾递归事实上和循环是等价的，没有循环语句的编程语言只能通过尾递归实现循环。</p>\n<p>Python 标准的解释器没有针对尾递归做优化，任何递归函数都存在栈溢出的问题。</p>\n<h1 id="高级特性"><a href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>高级特性</h1>\n<h2 id="切片"><a href="#%E5%88%87%E7%89%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>切片</h2>\n<p>取一个 list 或 tuple 的部分元素是非常常见的操作。比如，一个 list 如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70687292138417110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L = [\'Michael\', \'Sarah\', \'Tracy\', \'Bob\', \'Jack\']`, `70687292138417110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Sarah\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">,</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Jack\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>取前 3 个元素，应该怎么做？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45885410540721220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[0:3]\n[\'Michael\', \'Sarah\', \'Tracy\']`, `45885410540721220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Sarah\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果第一个索引是 0，还可以省略：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56050476741599680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[:3]\n[\'Michael\', \'Sarah\', \'Tracy\']`, `56050476741599680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'Sarah\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>也可以从索引 1 开始，取出 2 个元素出来：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43168900277843570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[1:3]\n[\'Sarah\', \'Tracy\']`, `43168900277843570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'Sarah\'</span><span class="token punctuation">,</span> <span class="token string">\'Tracy\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>类似的，既然 Python 支持 <code class="language-text">L[-1]</code> 取倒数第一个元素，那么它同样支持倒数切片，试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90347803593169630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[-2:]\n[\'Bob\', \'Jack\']\n>>> L[-2:-1]\n[\'Bob\']`, `90347803593169630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Jack\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'Bob\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>记住倒数第一个元素的索引是 -1。</p>\n<p>切片操作十分有用。我们先创建一个 0-99 的数列：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4162926418168311300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L = list(range(100))\n>>> L\n[0, 1, 2, 3, ..., 99]`, `4162926418168311300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> L\n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>可以通过切片轻松取出某一段数列。比如前 10 个数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18241954930418559000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[:10]\n[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]`, `18241954930418559000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>后 10 个数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85568717401137020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[-10:]\n[90, 91, 92, 93, 94, 95, 96, 97, 98, 99]`, `85568717401137020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>前 11-20 个数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99255254081231110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[10:20]\n[10, 11, 12, 13, 14, 15, 16, 17, 18, 19]`, `99255254081231110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>前 10 个数，每两个取一个：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46868080922895180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[:10:2]\n[0, 2, 4, 6, 8]`, `46868080922895180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>所有数，每 5 个取一个：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46388744803446700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[::5]\n[0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95]`, `46388744803446700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>甚至什么都不写，只写 <code class="language-text">[:]</code> 就可以原样复制一个 list：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82180514264424300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L[:]\n[0, 1, 2, 3, ..., 99]`, `82180514264424300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>tuple 也是一种 list，唯一区别是 tuple 不可变。因此，tuple 也可以用切片操作，只是操作的结果仍是 tuple：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1609179201813515300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> (0, 1, 2, 3, 4, 5)[:3]\n(0, 1, 2)`, `1609179201813515300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>字符串 ‘xxx’ 也可以看成是一种 list，每个元素就是一个字符。因此，字符串也可以用切片操作，只是操作结果仍是字符串：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9220542151321398000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'ABCDEFG\'[:3]\n\'ABC\'\n>>> \'ABCDEFG\'[::2]\n\'ACEG\'`, `9220542151321398000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'ABCDEFG\'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token string">\'ABC\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'ABCDEFG\'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token string">\'ACEG\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在很多编程语言中，针对字符串提供了很多各种截取函数（例如，substring），其实目的就是对字符串切片。Python 没有针对字符串的截取函数，只需要切片一个操作就可以完成，非常简单。</p>\n<h2 id="迭代"><a href="#%E8%BF%AD%E4%BB%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>迭代</h2>\n<p>Python 的 for 循环不仅可以用在 list 或 tuple 上，还可以作用在其他可迭代对象上。</p>\n<p>list 这种数据类型虽然有下标，但很多其他数据类型是没有下标的，但是，只要是可迭代对象，无论有无下标，都可以迭代，比如 dict 就可以迭代：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4792021795416068000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> d = {\'a\': 1, \'b\': 2, \'c\': 3}\n>>> for key in d:\n...     print(key)\n...\na\nc\nb`, `4792021795416068000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'a\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> key <span class="token keyword">in</span> d<span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\na\nc\nb</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为 dict 的存储不是按照 list 的方式顺序排列，所以，迭代出的结果顺序很可能不一样。</p>\n<p>默认情况下，dict 迭代的是 key。如果要迭代 value，可以用 <code class="language-text">for value in d.values()</code>，如果要同时迭代 key 和 value，可以用 <code class="language-text">for k, v in d.items()</code>。</p>\n<p>由于字符串也是可迭代对象，因此，也可以作用于 for 循环：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57860378544927695000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> for ch in \'ABC\':\n...     print(ch)\n...\nA\nB\nC`, `57860378544927695000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> ch <span class="token keyword">in</span> <span class="token string">\'ABC\'</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nA\nB\nC</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所以，当我们使用 for 循环时，只要作用于一个可迭代对象，for 循环就可以正常运行，而我们不太关心该对象究竟是 list 还是其他数据类型。</p>\n<p>那么，如何判断一个对象是可迭代对象呢？方法是通过 collections.abc 模块的 Iterable 类型判断：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70388112524983300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> from collections.abc import Iterable\n>>> isinstance(\'abc\', Iterable) # str 是否可迭代\nTrue\n>>> isinstance([1,2,3], Iterable) # list 是否可迭代\nTrue\n>>> isinstance(123, Iterable) # 整数是否可迭代\nFalse`, `70388112524983300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span> <span class="token comment"># str 是否可迭代</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span> <span class="token comment"># list 是否可迭代</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span> <span class="token comment"># 整数是否可迭代</span>\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后一个小问题，如果要对 list 实现类似 Java 那样的下标循环怎么办？Python 内置的 enumerate 函数可以把一个 list 变成索引-元素对，这样就可以在 for 循环中同时迭代索引和元素本身：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82631083492636660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> for i, value in enumerate([\'A\', \'B\', \'C\']):\n...     print(i, value)\n...\n0 A\n1 B\n2 C`, `82631083492636660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'A\'</span><span class="token punctuation">,</span> <span class="token string">\'B\'</span><span class="token punctuation">,</span> <span class="token string">\'C\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token number">0</span> A\n<span class="token number">1</span> B\n<span class="token number">2</span> C</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面的 for 循环里，同时引用了两个变量，在 Python 里是很常见的，比如下面的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29943936445298050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> for x, y in [(1, 1), (2, 4), (3, 9)]:\n...     print(x, y)\n...\n1 1\n2 4\n3 9`, `29943936445298050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token number">1</span> <span class="token number">1</span>\n<span class="token number">2</span> <span class="token number">4</span>\n<span class="token number">3</span> <span class="token number">9</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="小结-2"><a href="#%E5%B0%8F%E7%BB%93-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>任何可迭代对象都可以作用于 for 循环，包括我们自定义的数据类型，只要符合迭代条件，就可以使用 for 循环。</p>\n<h2 id="列表生成式"><a href="#%E5%88%97%E8%A1%A8%E7%94%9F%E6%88%90%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列表生成式</h2>\n<p>列表生成式即 List Comprehensions，是 Python 内置的非常简单却强大的可以用来创建 list 的生成式。</p>\n<p>举个例子，要生成 list <code class="language-text">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</code> 可以用 <code class="language-text">list(range(1, 11))</code>：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81143132830485330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> list(range(1, 11))\n[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]`, `81143132830485330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但如果要生成 <code class="language-text">[1x1, 2x2, 3x3, ..., 10x10]</code> 怎么做？方法一是循环：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91249503051936650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L = []\n>>> for x in range(1, 11):\n...    L.append(x * x)\n...\n>>> L\n[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]`, `91249503051936650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x <span class="token operator">*</span> x<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> L\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是循环太繁琐，而列表生成式则可以用一行语句代替循环生成上面的 list：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77145892634333500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> [x * x for x in range(1, 11)]\n[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]`, `77145892634333500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>写列表生成式时，把要生成的元素 <code class="language-text">x * x</code> 放到前面，后面跟 for 循环，就可以把 list 创建出来，十分有用，多写几次，很快就可以熟悉这种语法。</p>\n<p>for 循环后面还可以加上 if 判断，这样我们就可以筛选出仅偶数的平方：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79662055592411220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> [x * x for x in range(1, 11) if x % 2 == 0]\n[4, 16, 36, 64, 100]`, `79662055592411220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>还可以使用两层循环，可以生成全排列：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31632188479038636000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> [m + n for m in \'ABC\' for n in \'XYZ\']\n[\'AX\', \'AY\', \'AZ\', \'BX\', \'BY\', \'BZ\', \'CX\', \'CY\', \'CZ\']`, `31632188479038636000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>m <span class="token operator">+</span> n <span class="token keyword">for</span> m <span class="token keyword">in</span> <span class="token string">\'ABC\'</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token string">\'XYZ\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'AX\'</span><span class="token punctuation">,</span> <span class="token string">\'AY\'</span><span class="token punctuation">,</span> <span class="token string">\'AZ\'</span><span class="token punctuation">,</span> <span class="token string">\'BX\'</span><span class="token punctuation">,</span> <span class="token string">\'BY\'</span><span class="token punctuation">,</span> <span class="token string">\'BZ\'</span><span class="token punctuation">,</span> <span class="token string">\'CX\'</span><span class="token punctuation">,</span> <span class="token string">\'CY\'</span><span class="token punctuation">,</span> <span class="token string">\'CZ\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>三层和三层以上的循环就很少用到了。</p>\n<p>运用列表生成式，可以写出非常简洁的代码。例如，列出当前目录下的所有文件和目录名，可以通过一行代码实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32978222718926275000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import os # 导入 os 模块，模块的概念后面讲到\n>>> [d for d in os.listdir(\'.\')] # os.listdir 可以列出文件和目录\n[\'.emacs.d\', \'.ssh\', \'.Trash\', \'Adlm\', \'Applications\', \'Desktop\', \'Documents\', \'Downloads\', \'Library\', \'Movies\', \'Music\', \'Pictures\', \'Public\', \'VirtualBox VMs\', \'Workspace\', \'XCode\']`, `32978222718926275000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> os <span class="token comment"># 导入 os 模块，模块的概念后面讲到</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>d <span class="token keyword">for</span> d <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">\'.\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># os.listdir 可以列出文件和目录</span>\n<span class="token punctuation">[</span><span class="token string">\'.emacs.d\'</span><span class="token punctuation">,</span> <span class="token string">\'.ssh\'</span><span class="token punctuation">,</span> <span class="token string">\'.Trash\'</span><span class="token punctuation">,</span> <span class="token string">\'Adlm\'</span><span class="token punctuation">,</span> <span class="token string">\'Applications\'</span><span class="token punctuation">,</span> <span class="token string">\'Desktop\'</span><span class="token punctuation">,</span> <span class="token string">\'Documents\'</span><span class="token punctuation">,</span> <span class="token string">\'Downloads\'</span><span class="token punctuation">,</span> <span class="token string">\'Library\'</span><span class="token punctuation">,</span> <span class="token string">\'Movies\'</span><span class="token punctuation">,</span> <span class="token string">\'Music\'</span><span class="token punctuation">,</span> <span class="token string">\'Pictures\'</span><span class="token punctuation">,</span> <span class="token string">\'Public\'</span><span class="token punctuation">,</span> <span class="token string">\'VirtualBox VMs\'</span><span class="token punctuation">,</span> <span class="token string">\'Workspace\'</span><span class="token punctuation">,</span> <span class="token string">\'XCode\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>for 循环其实可以同时使用两个甚至多个变量，比如 dict 的 items() 可以同时迭代 key 和 value：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49596923230660050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> d = {\'x\': \'A\', \'y\': \'B\', \'z\': \'C\' }\n>>> for k, v in d.items():\n...     print(k, \'=\', v)\n...\ny = B\nx = A\nz = C`, `49596923230660050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'x\'</span><span class="token punctuation">:</span> <span class="token string">\'A\'</span><span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">:</span> <span class="token string">\'B\'</span><span class="token punctuation">,</span> <span class="token string">\'z\'</span><span class="token punctuation">:</span> <span class="token string">\'C\'</span> <span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">\'=\'</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\ny <span class="token operator">=</span> B\nx <span class="token operator">=</span> A\nz <span class="token operator">=</span> C</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因此，列表生成式也可以使用两个变量来生成 list：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40257593890187440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> d = {\'x\': \'A\', \'y\': \'B\', \'z\': \'C\' }\n>>> [k + \'=\' + v for k, v in d.items()]\n[\'y=B\', \'x=A\', \'z=C\']`, `40257593890187440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'x\'</span><span class="token punctuation">:</span> <span class="token string">\'A\'</span><span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">:</span> <span class="token string">\'B\'</span><span class="token punctuation">,</span> <span class="token string">\'z\'</span><span class="token punctuation">:</span> <span class="token string">\'C\'</span> <span class="token punctuation">}</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token string">\'=\'</span> <span class="token operator">+</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'y=B\'</span><span class="token punctuation">,</span> <span class="token string">\'x=A\'</span><span class="token punctuation">,</span> <span class="token string">\'z=C\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>最后把一个 list 中所有的字符串变成小写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78501011276938670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L = [\'Hello\', \'World\', \'IBM\', \'Apple\']\n>>> [s.lower() for s in L]\n[\'hello\', \'world\', \'ibm\', \'apple\']`, `78501011276938670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Hello\'</span><span class="token punctuation">,</span> <span class="token string">\'World\'</span><span class="token punctuation">,</span> <span class="token string">\'IBM\'</span><span class="token punctuation">,</span> <span class="token string">\'Apple\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>s<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> L<span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'hello\'</span><span class="token punctuation">,</span> <span class="token string">\'world\'</span><span class="token punctuation">,</span> <span class="token string">\'ibm\'</span><span class="token punctuation">,</span> <span class="token string">\'apple\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在一个列表生成式中，for 前面的 <code class="language-text">if ... else</code> 是表达式，而 for 后面的 if 是过滤条件，不能带 else。</p>\n<p>即以下 2 种形式是错误的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63270011418075600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> [x for x in range(1, 11) if x % 2 == 0 else 0]\n  File &quot;<stdin>&quot;, line 1\n    [x for x in range(1, 11) if x % 2 == 0 else 0]\n                                              ^\nSyntaxError: invalid syntax`, `63270011418075600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">]</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span>\n    <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">]</span>\n                                              <span class="token operator">^</span>\nSyntaxError<span class="token punctuation">:</span> invalid syntax</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68110756829705850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> [x if x % 2 == 0 for x in range(1, 11)]\n  File &quot;<stdin>&quot;, line 1\n    [x if x % 2 == 0 for x in range(1, 11)]\n                       ^\nSyntaxError: invalid syntax`, `68110756829705850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>x <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span>\n    <span class="token punctuation">[</span>x <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n                       <span class="token operator">^</span>\nSyntaxError<span class="token punctuation">:</span> invalid syntax</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="生成器"><a href="#%E7%94%9F%E6%88%90%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成器</h2>\n<p>在 Python 中一边循环一边计算的机制，称为生成器：generator。</p>\n<p>要创建一个 generator，有很多种方法。第一种方法很简单，只要把一个列表生成式的 [] 改成 ()，就创建了一个 generator：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39022193083288980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L = [x * x for x in range(10)]\n>>> L\n[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]\n>>> g = (x * x for x in range(10))\n>>> g\n<generator object <genexpr> at 0x1022ef630>`, `39022193083288980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> L\n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> g <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> g\n<span class="token operator">&lt;</span>generator <span class="token builtin">object</span> <span class="token operator">&lt;</span>genexpr<span class="token operator">></span> at <span class="token number">0x1022ef630</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>创建 L 和 g 的区别仅在于最外层的 [] 和 ()，L 是一个 list，而 g 是一个 generator。</p>\n<p>我们可以直接打印出 list 的每一个元素，但我们怎么打印出 generator 的每一个元素呢？</p>\n<p>如果要一个一个打印出来，可以通过 next() 函数获得 generator 的下一个返回值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91939557146304460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> next(g)\n0\n>>> next(g)\n1\n>>> next(g)\n4\n>>> next(g)\n9\n>>> next(g)\n16\n>>> next(g)\n25\n>>> next(g)\n36\n>>> next(g)\n49\n>>> next(g)\n64\n>>> next(g)\n81\n>>> next(g)\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nStopIteration`, `91939557146304460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">0</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">4</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">9</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">16</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">25</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">36</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">49</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">64</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token number">81</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nStopIteration</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们讲过，generator 保存的是算法，每次调用 next(g)，就计算出 g 的下一个元素的值，直到计算到最后一个元素，没有更多的元素时，抛出 StopIteration 的错误。</p>\n<p>当然，上面这种不断调用 next(g) 实在是太变态了，正确的方法是使用 for 循环，因为 generator 也是可迭代对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6536977474559480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> g = (x * x for x in range(10))\n>>> for n in g:\n...     print(n)\n...\n0\n1\n4\n9\n16\n25\n36\n49\n64\n81`, `6536977474559480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> g <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> n <span class="token keyword">in</span> g<span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token number">0</span>\n<span class="token number">1</span>\n<span class="token number">4</span>\n<span class="token number">9</span>\n<span class="token number">16</span>\n<span class="token number">25</span>\n<span class="token number">36</span>\n<span class="token number">49</span>\n<span class="token number">64</span>\n<span class="token number">81</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所以，我们创建了一个 generator 后，基本上永远不会调用 next()，而是通过 for 循环来迭代它，并且不需要关心 StopIteration 的错误。</p>\n<p>generator 非常强大。如果推算的算法比较复杂，用类似列表生成式的 for 循环无法实现的时候，还可以用函数来实现。</p>\n<p>比如，著名的斐波拉契数列（Fibonacci），除第一个和第二个数外，任意一个数都可由前两个数相加得到：</p>\n<p>1, 1, 2, 3, 5, 8, 13, 21, 34, …</p>\n<p>斐波拉契数列用列表生成式写不出来，但是，用函数把它打印出来却很容易：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98597634516467800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def fib(max):\n    n, a, b = 0, 0, 1\n    while n < max:\n        print(b)\n        a, b = b, a + b\n        n = n + 1\n    return \'done\'`, `98597634516467800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    n<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>\n    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token builtin">max</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>\n        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b\n        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span>\n    <span class="token keyword">return</span> <span class="token string">\'done\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意，赋值语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26992210317587583000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a, b = b, a + b`, `26992210317587583000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>相当于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86558514275897070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`t = (b, a + b) # t 是一个 tuple\na = t[0]\nb = t[1]`, `86558514275897070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">t <span class="token operator">=</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token comment"># t 是一个 tuple</span>\na <span class="token operator">=</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\nb <span class="token operator">=</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但不必显式写出临时变量 t 就可以赋值。</p>\n<p>上面的函数可以输出斐波那契数列的前 N 个数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83759464298726470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> fib(6)\n1\n1\n2\n3\n5\n8\n\'done\'`, `83759464298726470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> fib<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">2</span>\n<span class="token number">3</span>\n<span class="token number">5</span>\n<span class="token number">8</span>\n<span class="token string">\'done\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>仔细观察，可以看出，fib 函数实际上是定义了斐波拉契数列的推算规则，可以从第一个元素开始，推算出后续任意的元素，这种逻辑其实非常类似 generator。</p>\n<p>也就是说，上面的函数和 generator 仅一步之遥。要把 fib 函数变成 generator 函数，只需要把 print(b) 改为 yield b 就可以了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11140268746478266000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def fib(max):\n    n, a, b = 0, 0, 1\n    while n < max:\n        yield b\n        a, b = b, a + b\n        n = n + 1\n    return \'done\'`, `11140268746478266000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    n<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>\n    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token builtin">max</span><span class="token punctuation">:</span>\n        <span class="token keyword">yield</span> b\n        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b\n        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span>\n    <span class="token keyword">return</span> <span class="token string">\'done\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这就是定义 generator 的另一种方法。如果一个函数定义中包含 yield 关键字，那么这个函数就不再是一个普通函数，而是一个 generator 函数，调用一个 generator 函数将返回一个 generator：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19387270082955887000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = fib(6)\n>>> f\n<generator object fib at 0x104feaaa0>`, `19387270082955887000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> fib<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f\n<span class="token operator">&lt;</span>generator <span class="token builtin">object</span> fib at <span class="token number">0x104feaaa0</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这里，最难理解的就是 generator 函数和普通函数的执行流程不一样。普通函数是顺序执行，遇到 return 语句或者最后一行函数语句就返回。而变成 generator 的函数，在每次调用 next() 的时候执行，遇到 yield 语句返回，再次执行时从上次返回的 yield 语句处继续执行。</p>\n<p>举个简单的例子，定义一个 generator 函数，依次返回数字 1，3，5：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82283076686997320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def odd():\n    print(\'step 1\')\n    yield 1\n    print(\'step 2\')\n    yield(3)\n    print(\'step 3\')\n    yield(5)`, `82283076686997320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">odd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'step 1\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token number">1</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'step 2\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'step 3\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调用该 generator 函数时，首先要生成一个 generator 对象，然后用 next() 函数不断获得下一个返回值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51137076197675246000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> o = odd()\n>>> next(o)\nstep 1\n1\n>>> next(o)\nstep 2\n3\n>>> next(o)\nstep 3\n5\n>>> next(o)\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nStopIteration`, `51137076197675246000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> o <span class="token operator">=</span> odd<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>\nstep <span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>\nstep <span class="token number">2</span>\n<span class="token number">3</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>\nstep <span class="token number">3</span>\n<span class="token number">5</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nStopIteration</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，odd 不是普通函数，而是 generator 函数，在执行过程中，遇到 yield 就中断，下次又继续执行。执行 3 次 yield 后，已经没有 yield 可以执行了，所以，第 4 次调用 <code class="language-text">next(o)</code> 就报错。</p>\n<blockquote>\n<p>请务必注意：调用 generator 函数会创建一个 generator 对象，多次调用 generator 函数会创建多个相互独立的 generator。</p>\n</blockquote>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44509401904550720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> next(odd())\nstep 1\n1\n>>> next(odd())\nstep 1\n1\n>>> next(odd())\nstep 1\n1`, `44509401904550720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>odd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nstep <span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>odd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nstep <span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>odd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nstep <span class="token number">1</span>\n<span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>原因在于 odd() 会创建一个新的 generator 对象，上述代码实际上创建了 3 个完全独立的 generator，对 3 个 generator 分别调用 next() 当然每个都会返回第一个值。</p>\n<p>正确的写法是创建一个 generator 对象，然后不断对这一个 generator 对象调用 next()：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8272720606074846000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> g = odd()\n>>> next(g)\nstep 1\n1\n>>> next(g)\nstep 2\n3\n>>> next(g)\nstep 3\n5`, `8272720606074846000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> g <span class="token operator">=</span> odd<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\nstep <span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\nstep <span class="token number">2</span>\n<span class="token number">3</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\nstep <span class="token number">3</span>\n<span class="token number">5</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>回到 fib 的例子，我们在循环过程中不断调用 yield，就会不断中断。当然要给循环设置一个条件来退出循环，不然就会产生一个无限数列出来。</p>\n<p>同样的，把函数改成 generator 函数后，我们基本上从来不会用 next() 来获取下一个返回值，而是直接使用 for 循环来迭代：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48305514995483750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> for n in fib(6):\n...     print(n)\n...\n1\n1\n2\n3\n5\n8`, `48305514995483750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> n <span class="token keyword">in</span> fib<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">2</span>\n<span class="token number">3</span>\n<span class="token number">5</span>\n<span class="token number">8</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是用 for 循环调用 generator 时，发现拿不到 generator 的 return 语句的返回值。如果想要拿到返回值，必须捕获 StopIteration 错误，返回值包含在 StopIteration 的 value 中：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13713261005426047000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> g = fib(6)\n>>> while True:\n...     try:\n...         x = next(g)\n...         print(\'g:\', x)\n...     except StopIteration as e:\n...         print(\'Generator return value:\', e.value)\n...         break\n...\ng: 1\ng: 1\ng: 2\ng: 3\ng: 5\ng: 8\nGenerator return value: done`, `13713261005426047000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> g <span class="token operator">=</span> fib<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">try</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         x <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'g:\'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">except</span> StopIteration <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Generator return value:\'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">break</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\ng<span class="token punctuation">:</span> <span class="token number">1</span>\ng<span class="token punctuation">:</span> <span class="token number">1</span>\ng<span class="token punctuation">:</span> <span class="token number">2</span>\ng<span class="token punctuation">:</span> <span class="token number">3</span>\ng<span class="token punctuation">:</span> <span class="token number">5</span>\ng<span class="token punctuation">:</span> <span class="token number">8</span>\nGenerator <span class="token keyword">return</span> value<span class="token punctuation">:</span> done</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>关于如何捕获错误，后面的错误处理还会详细讲解。</p>\n<h3 id="小结-3"><a href="#%E5%B0%8F%E7%BB%93-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>generator 是非常强大的工具，在 Python 中，可以简单地把列表生成式改成 generator，也可以通过函数实现复杂逻辑的 generator。</p>\n<p>要理解 generator 的工作原理，它是在 for 循环的过程中不断计算出下一个元素，并在适当的条件结束 for 循环。对于函数改成的 generator 来说，遇到 return 语句或者执行到函数体最后一行语句，就是结束 generator 的指令，for 循环随之结束。</p>\n<p>请注意区分普通函数和 generator 函数，普通函数调用直接返回结果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45646097736968020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> r = abs(6)\n>>> r\n6`, `45646097736968020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> r <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> r\n<span class="token number">6</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>generator 函数的调用实际返回一个 generator 对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32947754887531500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> g = fib(6)\n>>> g\n<generator object fib at 0x1022ef948>`, `32947754887531500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> g <span class="token operator">=</span> fib<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> g\n<span class="token operator">&lt;</span>generator <span class="token builtin">object</span> fib at <span class="token number">0x1022ef948</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h2 id="迭代器"><a href="#%E8%BF%AD%E4%BB%A3%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>迭代器</h2>\n<p>我们已经知道，可以直接作用于 for 循环的数据类型有以下几种：</p>\n<p>一类是集合数据类型，如 list、tuple、dict、set、str 等；</p>\n<p>一类是 generator，包括生成器和带 yield 的 generator function。</p>\n<p>这些可以直接作用于 for 循环的对象统称为可迭代对象：Iterable。</p>\n<p>可以使用 isinstance() 判断一个对象是否是 Iterable 对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9615073029953081000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> from collections.abc import Iterable\n>>> isinstance([], Iterable)\nTrue\n>>> isinstance({}, Iterable)\nTrue\n>>> isinstance(\'abc\', Iterable)\nTrue\n>>> isinstance((x for x in range(10)), Iterable)\nTrue\n>>> isinstance(100, Iterable)\nFalse`, `9615073029953081000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span>\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而生成器不但可以作用于 for 循环，还可以被 next() 函数不断调用并返回下一个值，直到最后抛出 StopIteration 错误表示无法继续返回下一个值了。</p>\n<p>可以被 next() 函数调用并不断返回下一个值的对象称为迭代器：Iterator。</p>\n<p>可以使用 isinstance() 判断一个对象是否是 Iterator 对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82334757096022200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> from collections.abc import Iterator\n>>> isinstance((x for x in range(10)), Iterator)\nTrue\n>>> isinstance([], Iterator)\nFalse\n>>> isinstance({}, Iterator)\nFalse\n>>> isinstance(\'abc\', Iterator)\nFalse`, `82334757096022200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterator\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span>\n<span class="token boolean">False</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span>\n<span class="token boolean">False</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span>\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>生成器都是 Iterator 对象，但 list、dict、str 虽然是 Iterable，却不是 Iterator。</p>\n<p>把 list、dict、str 等 Iterable 变成 Iterator 可以使用 iter() 函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68049215305394090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance(iter([]), Iterator)\nTrue\n>>> isinstance(iter(\'abc\'), Iterator)\nTrue`, `68049215305394090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span>\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你可能会问，为什么 list、dict、str 等数据类型不是 Iterator？</p>\n<p>这是因为 Python 的 Iterator 对象表示的是一个数据流，Iterator 对象可以被 next() 函数调用并不断返回下一个数据，直到没有数据时抛出 StopIteration 错误。可以把这个数据流看做是一个有序序列，但我们却不能提前知道序列的长度，只能不断通过 next() 函数实现按需计算下一个数据，所以 Iterator 的计算是惰性的，只有在需要返回下一个数据时它才会计算。</p>\n<p>Iterator 甚至可以表示一个无限大的数据流，例如全体自然数。而使用 list 是永远不可能存储全体自然数的。</p>\n<h3 id="小结-4"><a href="#%E5%B0%8F%E7%BB%93-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>凡是可作用于 for 循环的对象都是 Iterable 类型；</p>\n<p>凡是可作用于 next() 函数的对象都是 Iterator 类型，它们表示一个惰性计算的序列；</p>\n<p>集合数据类型如 list、dict、str 等是 Iterable 但不是 Iterator，不过可以通过 iter() 函数获得一个 Iterator 对象。</p>\n<p>Python 的 for 循环本质上就是通过不断调用 next() 函数实现的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62582422991578210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for x in [1, 2, 3, 4, 5]:\n    pass`, `62582422991578210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>实际上完全等价于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29310866118058353000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 首先获得 Iterator 对象:\nit = iter([1, 2, 3, 4, 5])\n# 循环:\nwhile True:\n    try:\n        # 获得下一个值:\n        x = next(it)\n    except StopIteration:\n        # 遇到 StopIteration 就退出循环\n        break`, `29310866118058353000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 首先获得 Iterator 对象:</span>\nit <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token comment"># 循环:</span>\n<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token comment"># 获得下一个值:</span>\n        x <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>\n    <span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>\n        <span class="token comment"># 遇到 StopIteration 就退出循环</span>\n        <span class="token keyword">break</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="函数式编程"><a href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数式编程</h1>\n<h2 id="高阶函数"><a href="#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>高阶函数</h2>\n<h3 id="变量可以指向函数"><a href="#%E5%8F%98%E9%87%8F%E5%8F%AF%E4%BB%A5%E6%8C%87%E5%90%91%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量可以指向函数</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48863274885050290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = abs\n>>> f(-10)\n10`, `48863274885050290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> <span class="token builtin">abs</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span>\n<span class="token number">10</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="函数名也是变量"><a href="#%E5%87%BD%E6%95%B0%E5%90%8D%E4%B9%9F%E6%98%AF%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数名也是变量</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97920205766271600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> abs = 10\n>>> abs(-10)\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nTypeError: \'int\' object is not callable`, `97920205766271600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">abs</span> <span class="token operator">=</span> <span class="token number">10</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nTypeError<span class="token punctuation">:</span> <span class="token string">\'int\'</span> <span class="token builtin">object</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token builtin">callable</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>由于 abs 函数实际上是定义在 <code class="language-text">import builtins</code> 模块中的，所以要让修改 abs 变量的指向在其它模块也生效，要用 <code class="language-text">import builtins; builtins.abs = 10</code>。</p>\n</blockquote>\n<h3 id="传入函数"><a href="#%E4%BC%A0%E5%85%A5%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>传入函数</h3>\n<p>一个函数就可以接收另一个函数作为参数，这种函数就称之为高阶函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28270067975560350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def add(x, y, f):\n    return f(x) + f(y)\n\nprint(add(-5, 6, abs))`, `28270067975560350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> f<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> f<span class="token punctuation">(</span>y<span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token builtin">abs</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="map"><a href="#map" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>map</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11182052783356334000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> def f(x):\n...     return x * x\n...\n>>> r = map(f, [1, 2, 3, 4, 5, 6, 7, 8, 9])\n>>> list(r)\n[1, 4, 9, 16, 25, 36, 49, 64, 81]\n>>> list(map(str, [1, 2, 3, 4, 5, 6, 7, 8, 9]))\n[\'1\', \'2\', \'3\', \'4\', \'5\', \'6\', \'7\', \'8\', \'9\']`, `11182052783356334000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">return</span> x <span class="token operator">*</span> x\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> r <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'1\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">,</span> <span class="token string">\'3\'</span><span class="token punctuation">,</span> <span class="token string">\'4\'</span><span class="token punctuation">,</span> <span class="token string">\'5\'</span><span class="token punctuation">,</span> <span class="token string">\'6\'</span><span class="token punctuation">,</span> <span class="token string">\'7\'</span><span class="token punctuation">,</span> <span class="token string">\'8\'</span><span class="token punctuation">,</span> <span class="token string">\'9\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="reduce"><a href="#reduce" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>reduce</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77325604145366830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4)`, `77325604145366830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token builtin">reduce</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> x3<span class="token punctuation">,</span> x4<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> f<span class="token punctuation">(</span>f<span class="token punctuation">(</span>f<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">,</span> x3<span class="token punctuation">)</span><span class="token punctuation">,</span> x4<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35248013786881958000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from functools import reduce\n\nDIGITS = {\'0\': 0, \'1\': 1, \'2\': 2, \'3\': 3, \'4\': 4, \'5\': 5, \'6\': 6, \'7\': 7, \'8\': 8, \'9\': 9}\n\ndef str2int(s):\n    def fn(x, y):\n        return x * 10 + y\n    def char2num(s):\n        return DIGITS[s]\n    return reduce(fn, map(char2num, s))`, `35248013786881958000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>\n\nDIGITS <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'3\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'4\'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">\'5\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">\'6\'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">\'7\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">\'8\'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">\'9\'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">}</span>\n\n<span class="token keyword">def</span> <span class="token function">str2int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> y\n    <span class="token keyword">def</span> <span class="token function">char2num</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> DIGITS<span class="token punctuation">[</span>s<span class="token punctuation">]</span>\n    <span class="token keyword">return</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token builtin">map</span><span class="token punctuation">(</span>char2num<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还可以用 lambda 函数进一步简化成：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82922741593637390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from functools import reduce\n\nDIGITS = {\'0\': 0, \'1\': 1, \'2\': 2, \'3\': 3, \'4\': 4, \'5\': 5, \'6\': 6, \'7\': 7, \'8\': 8, \'9\': 9}\n\ndef char2num(s):\n    return DIGITS[s]\n\ndef str2int(s):\n    return reduce(lambda x, y: x * 10 + y, map(char2num, s))`, `82922741593637390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>\n\nDIGITS <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'3\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'4\'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">\'5\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">\'6\'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">\'7\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">\'8\'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">\'9\'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">}</span>\n\n<span class="token keyword">def</span> <span class="token function">char2num</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> DIGITS<span class="token punctuation">[</span>s<span class="token punctuation">]</span>\n\n<span class="token keyword">def</span> <span class="token function">str2int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> <span class="token builtin">map</span><span class="token punctuation">(</span>char2num<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="filter"><a href="#filter" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>filter</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51331389384578040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def is_odd(n):\n    return n % 2 == 1\n\nlist(filter(is_odd, [1, 2, 4, 5, 6, 9, 10, 15]))\n# 结果: [1, 5, 9, 15]`, `51331389384578040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">is_odd</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span>\n\n<span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span>is_odd<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token comment"># 结果: [1, 5, 9, 15]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意到 filter() 函数返回的是一个 Iterator，也就是一个惰性序列，所以要强迫 filter() 完成计算结果，需要用 list() 函数获得所有结果并返回 list。</p>\n<h4 id="用-filter-求素数"><a href="#%E7%94%A8-filter-%E6%B1%82%E7%B4%A0%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用 filter 求素数</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16533821766588353000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def _odd_iter():\n    n = 1\n    while True:\n        n = n + 2\n        yield n\n\ndef _not_divisible(n):\n    # def _can_be_devided(x):\n    #    return x % n > 0\n    return lambda x: x % n > 0\n\ndef primes():\n    yield 2\n    it = _odd_iter() # 初始序列\n    while True:\n        n = next(it) # 返回序列的第一个数\n        yield n\n        it = filter(_not_divisible(n), it) # 构造新序列\n\n# 打印 1000 以内的素数:\nfor n in primes():\n    if n < 1000:\n        print(n)\n    else:\n        break`, `16533821766588353000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">_odd_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    n <span class="token operator">=</span> <span class="token number">1</span>\n    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">2</span>\n        <span class="token keyword">yield</span> n\n\n<span class="token keyword">def</span> <span class="token function">_not_divisible</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># def _can_be_devided(x):</span>\n    <span class="token comment">#    return x % n > 0</span>\n    <span class="token keyword">return</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">%</span> n <span class="token operator">></span> <span class="token number">0</span>\n\n<span class="token keyword">def</span> <span class="token function">primes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">yield</span> <span class="token number">2</span>\n    it <span class="token operator">=</span> _odd_iter<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 初始序列</span>\n    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n        n <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token comment"># 返回序列的第一个数</span>\n        <span class="token keyword">yield</span> n\n        it <span class="token operator">=</span> <span class="token builtin">filter</span><span class="token punctuation">(</span>_not_divisible<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> it<span class="token punctuation">)</span> <span class="token comment"># 构造新序列</span>\n\n<span class="token comment"># 打印 1000 以内的素数:</span>\n<span class="token keyword">for</span> n <span class="token keyword">in</span> primes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">break</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="sort"><a href="#sort" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>sort</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7333484588733352000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> sorted([36, 5, -12, 9, -21])\n[-21, -12, 5, 9, 36]\n>>> sorted([36, 5, -12, 9, -21], key=abs) # 自定义排序\n[5, 9, -12, -21, 36]\n>>> sorted([\'bob\', \'about\', \'Zoo\', \'Credit\']) # 按照 ASCII 的大小比较\n[\'Credit\', \'Zoo\', \'about\', \'bob\']\n>>> sorted([\'bob\', \'about\', \'Zoo\', \'Credit\'], key=str.lower) # 忽略大小写的排序\n[\'about\', \'bob\', \'Credit\', \'Zoo\']\n>>> sorted([\'bob\', \'about\', \'Zoo\', \'Credit\'], key=str.lower, reverse=True) # 倒序\n[\'Zoo\', \'Credit\', \'bob\', \'about\']`, `7333484588733352000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">abs</span><span class="token punctuation">)</span> <span class="token comment"># 自定义排序</span>\n<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'bob\'</span><span class="token punctuation">,</span> <span class="token string">\'about\'</span><span class="token punctuation">,</span> <span class="token string">\'Zoo\'</span><span class="token punctuation">,</span> <span class="token string">\'Credit\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 按照 ASCII 的大小比较</span>\n<span class="token punctuation">[</span><span class="token string">\'Credit\'</span><span class="token punctuation">,</span> <span class="token string">\'Zoo\'</span><span class="token punctuation">,</span> <span class="token string">\'about\'</span><span class="token punctuation">,</span> <span class="token string">\'bob\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'bob\'</span><span class="token punctuation">,</span> <span class="token string">\'about\'</span><span class="token punctuation">,</span> <span class="token string">\'Zoo\'</span><span class="token punctuation">,</span> <span class="token string">\'Credit\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">)</span> <span class="token comment"># 忽略大小写的排序</span>\n<span class="token punctuation">[</span><span class="token string">\'about\'</span><span class="token punctuation">,</span> <span class="token string">\'bob\'</span><span class="token punctuation">,</span> <span class="token string">\'Credit\'</span><span class="token punctuation">,</span> <span class="token string">\'Zoo\'</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'bob\'</span><span class="token punctuation">,</span> <span class="token string">\'about\'</span><span class="token punctuation">,</span> <span class="token string">\'Zoo\'</span><span class="token punctuation">,</span> <span class="token string">\'Credit\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 倒序</span>\n<span class="token punctuation">[</span><span class="token string">\'Zoo\'</span><span class="token punctuation">,</span> <span class="token string">\'Credit\'</span><span class="token punctuation">,</span> <span class="token string">\'bob\'</span><span class="token punctuation">,</span> <span class="token string">\'about\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="返回函数"><a href="#%E8%BF%94%E5%9B%9E%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>返回函数</h2>\n<h3 id="函数作为返回值"><a href="#%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E8%BF%94%E5%9B%9E%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数作为返回值</h3>\n<p>高阶函数除了可以接受函数作为参数外，还可以把函数作为结果值返回。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7928786813763611000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def lazy_sum(*args):\n    def sum():\n        ax = 0\n        for n in args:\n            ax = ax + n\n        return ax\n    return sum\n\n>>> f = lazy_sum(1, 3, 5, 7, 9)\n>>> f\n<function lazy_sum.<locals>.sum at 0x101c6ed90>\n>>> f()\n25`, `7928786813763611000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">lazy_sum</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        ax <span class="token operator">=</span> <span class="token number">0</span>\n        <span class="token keyword">for</span> n <span class="token keyword">in</span> args<span class="token punctuation">:</span>\n            ax <span class="token operator">=</span> ax <span class="token operator">+</span> n\n        <span class="token keyword">return</span> ax\n    <span class="token keyword">return</span> <span class="token builtin">sum</span>\n\n<span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> lazy_sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f\n<span class="token operator">&lt;</span>function lazy_sum<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token builtin">locals</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token builtin">sum</span> at <span class="token number">0x101c6ed90</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>每次调用都会返回一个新的函数，即使传入相同的参数，f1() 和 f2() 的调用结果互不影响。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77235200523827890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f1 = lazy_sum(1, 3, 5, 7, 9)\n>>> f2 = lazy_sum(1, 3, 5, 7, 9)\n>>> f1==f2\nFalse`, `77235200523827890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f1 <span class="token operator">=</span> lazy_sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f2 <span class="token operator">=</span> lazy_sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f1<span class="token operator">==</span>f2\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="闭包"><a href="#%E9%97%AD%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>闭包</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45357677259555110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def count():\n    fs = []\n    for i in range(1, 4):\n        def f():\n             return i*i\n        fs.append(f)\n    return fs\n\nf1, f2, f3 = count()\n\n>>> f1()\n9\n>>> f2()\n9\n>>> f3()\n9`, `45357677259555110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    fs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n             <span class="token keyword">return</span> i<span class="token operator">*</span>i\n        fs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> fs\n\nf1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3 <span class="token operator">=</span> count<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">9</span>\n<span class="token operator">>></span><span class="token operator">></span> f2<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">9</span>\n<span class="token operator">>></span><span class="token operator">></span> f3<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">9</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>类似于 js，python 也有闭包，解决方式同 js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52084926920157870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def count():\n    def f(j):\n        def g():\n            return j*j\n        return g\n    fs = []\n    for i in range(1, 4):\n        fs.append(f(i)) # f(i) 立刻被执行，因此 i 的当前值被传入 f()\n    return fs\n\n>>> f1, f2, f3 = count()\n>>> f1()\n1\n>>> f2()\n4\n>>> f3()\n9`, `52084926920157870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> j<span class="token operator">*</span>j\n        <span class="token keyword">return</span> g\n    fs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        fs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># f(i) 立刻被执行，因此 i 的当前值被传入 f()</span>\n    <span class="token keyword">return</span> fs\n\n<span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3 <span class="token operator">=</span> count<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f1<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> f2<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">4</span>\n<span class="token operator">>></span><span class="token operator">></span> f3<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">9</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="nonlocal"><a href="#nonlocal" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>nonlocal</h3>\n<p>使用闭包，就是内层函数引用了外层函数的局部变量。如果只是读外层变量的值，我们会发现返回的闭包函数调用一切正常：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53090257733195555000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def inc():\n    x = 0\n    def fn():\n        # 仅读取 x 的值:\n        return x + 1\n    return fn\n\nf = inc()\nprint(f()) # 1\nprint(f()) # 1`, `53090257733195555000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    x <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token comment"># 仅读取 x 的值:</span>\n        <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span>\n    <span class="token keyword">return</span> fn\n\nf <span class="token operator">=</span> inc<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 1</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，如果对外层变量赋值，由于 Python 解释器会把 x 当作函数 fn() 的局部变量，它会报错：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87242473696004060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def inc():\n    x = 0\n    def fn():\n        # nonlocal x # 去掉注释可以正常运行\n        x = x + 1 # 不加 nonlocal，这里会报错，会被当成 fn 的局部变量\n        return x\n    return fn\n\nf = inc()\nprint(f()) # 1\nprint(f()) # 2`, `87242473696004060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    x <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token comment"># nonlocal x # 去掉注释可以正常运行</span>\n        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment"># 不加 nonlocal，这里会报错，会被当成 fn 的局部变量</span>\n        <span class="token keyword">return</span> x\n    <span class="token keyword">return</span> fn\n\nf <span class="token operator">=</span> inc<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 1</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>原因是 x 作为局部变量并没有初始化，直接计算 x+1 是不行的。但我们其实是想引用 inc() 函数内部的 x，所以需要在 fn() 函数内部加一个 nonlocal x 的声明。加上这个声明后，解释器把 fn() 的 x 看作外层函数的局部变量，它已经被初始化了，可以正确计算 x+1。</p>\n<h2 id="匿名函数"><a href="#%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>匿名函数</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32548856707732130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> list(map(lambda x: x * x, [1, 2, 3, 4, 5, 6, 7, 8, 9]))\n[1, 4, 9, 16, 25, 36, 49, 64, 81]`, `32548856707732130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>匿名函数类似于</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85880272407180590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def f(x):\n    return x * x`, `85880272407180590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> x <span class="token operator">*</span> x</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>匿名函数有个限制，就是只能有一个表达式，不用写 return，返回值就是该表达式的结果。</p>\n<p>用匿名函数有个好处，因为函数没有名字，不必担心函数名冲突。此外，匿名函数也是一个函数对象，也可以把匿名函数赋值给一个变量，再利用变量来调用该函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60281910350485710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = lambda x: x * x\n>>> f\n<function <lambda> at 0x101c6ef28>\n>>> f(5)\n25`, `60281910350485710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">*</span> x\n<span class="token operator">>></span><span class="token operator">></span> f\n<span class="token operator">&lt;</span>function <span class="token operator">&lt;</span><span class="token keyword">lambda</span><span class="token operator">></span> at <span class="token number">0x101c6ef28</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>\n<span class="token number">25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样，也可以把匿名函数作为返回值返回，比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48818460065799440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def build(x, y):\n    return lambda: x * x + y * y`, `48818460065799440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">build</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> x <span class="token operator">*</span> x <span class="token operator">+</span> y <span class="token operator">*</span> y</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="装饰器"><a href="#%E8%A3%85%E9%A5%B0%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>装饰器</h2>\n<p>由于函数也是一个对象，而且函数对象可以被赋值给变量，所以，通过变量也能调用该函数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42152672345410120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> def now():\n...     print(\'2015-3-25\')\n...\n>>> f = now\n>>> f()\n2015-3-25`, `42152672345410120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'2015-3-25\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> now\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">2015</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>函数对象有一个 <code class="language-text">__name__</code> 属性，可以拿到函数的名字：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13910218731734060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> now.__name__\n\'now\'\n>>> f.__name__\n\'now\'`, `13910218731734060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> now<span class="token punctuation">.</span>__name__\n<span class="token string">\'now\'</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>__name__\n<span class="token string">\'now\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>假设我们要增强 now() 函数的功能，比如，在函数调用前后自动打印日志，但又不希望修改 now() 函数的定义，这种在代码运行期间动态增加功能的方式，称之为“装饰器”（Decorator）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12921599803273830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def log(func):\n    def wrapper(*args, **kw):\n        print(\'call %s():\' % func.__name__)\n        return func(*args, **kw)\n    return wrapper`, `12921599803273830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'call %s():\'</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> wrapper</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>观察上面的 log，因为它是一个 decorator，所以接受一个函数作为参数，并返回一个函数。我们要借助 Python 的 @ 语法，把 decorator 置于函数的定义处：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87006150073026120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@log\ndef now():\n    print(\'2015-3-25\')`, `87006150073026120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token decorator annotation punctuation">@log</span>\n<span class="token keyword">def</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'2015-3-25\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>调用 now() 函数，不仅会运行 now() 函数本身，还会在运行 now() 函数前打印一行日志：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50532451114550340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> now()\ncall now():\n2015-3-25`, `50532451114550340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> now<span class="token punctuation">(</span><span class="token punctuation">)</span>\ncall now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token number">2015</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>把 @log 放到 now() 函数的定义处，相当于执行了语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56409228405909225000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`now = log(now)`, `56409228405909225000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">now <span class="token operator">=</span> log<span class="token punctuation">(</span>now<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果 decorator 本身需要传入参数，那就需要编写一个返回 decorator 的高阶函数，写出来会更复杂。比如，要自定义 log 的文本：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48749451890313970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def log(text):\n    def decorator(func):\n        def wrapper(*args, **kw):\n            print(\'%s %s():\' % (text, func.__name__))\n            return func(*args, **kw)\n        return wrapper\n    return decorator`, `48749451890313970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s %s():\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>text<span class="token punctuation">,</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> wrapper\n    <span class="token keyword">return</span> decorator</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个 3 层嵌套的 decorator 用法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38183886575994585000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@log(\'execute\')\ndef now():\n    print(\'2015-3-25\')\n\n>>> now()\nexecute now():\n2015-3-25`, `38183886575994585000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token decorator annotation punctuation">@log</span><span class="token punctuation">(</span><span class="token string">\'execute\'</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'2015-3-25\'</span><span class="token punctuation">)</span>\n\n<span class="token operator">>></span><span class="token operator">></span> now<span class="token punctuation">(</span><span class="token punctuation">)</span>\nexecute now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token number">2015</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>和两层嵌套的 decorator 相比，3 层嵌套的效果是这样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93880000169338420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> now = log(\'execute\')(now)`, `93880000169338420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> now <span class="token operator">=</span> log<span class="token punctuation">(</span><span class="token string">\'execute\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们来剖析上面的语句，首先执行 <code class="language-text">log(&#39;execute&#39;)</code>，返回的是 decorator 函数，再调用返回的函数，参数是 now 函数，返回值最终是 wrapper 函数。</p>\n<p>以上两种 decorator 的定义都没有问题，但还差最后一步。因为我们讲了函数也是对象，它有 <code class="language-text">__name__</code> 等属性，但你去看经过 decorator 装饰之后的函数，它们的 <code class="language-text">__name__</code> 已经从原来的 now 变成了 wrapper：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90647802137926880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> now.__name__\n\'wrapper\'`, `90647802137926880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> now<span class="token punctuation">.</span>__name__\n<span class="token string">\'wrapper\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>因为返回的那个 wrapper() 函数名字就是 wrapper，所以，需要把原始函数的 <code class="language-text">__name__</code> 等属性复制到 wrapper() 函数中，否则，有些依赖函数签名的代码执行就会出错。</p>\n<p>不需要编写 <code class="language-text">wrapper.__name__ = func.__name__</code> 这样的代码，Python 内置的 functools.wraps 就是干这个事的，所以，一个完整的 decorator 的写法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69869323941441650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import functools\n\ndef log(func):\n    @functools.wraps(func)\n    def wrapper(*args, **kw):\n        print(\'call %s():\' % func.__name__)\n        return func(*args, **kw)\n    return wrapper`, `69869323941441650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> functools\n\n<span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    @functools<span class="token punctuation">.</span>wraps<span class="token punctuation">(</span>func<span class="token punctuation">)</span>\n    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'call %s():\'</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> wrapper</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>或者针对带参数的 decorator：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17075727647444693000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import functools\n\ndef log(text):\n    def decorator(func):\n        @functools.wraps(func)\n        def wrapper(*args, **kw):\n            print(\'%s %s():\' % (text, func.__name__))\n            return func(*args, **kw)\n        return wrapper\n    return decorator`, `17075727647444693000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> functools\n\n<span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        @functools<span class="token punctuation">.</span>wraps<span class="token punctuation">(</span>func<span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s %s():\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>text<span class="token punctuation">,</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> wrapper\n    <span class="token keyword">return</span> decorator</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="偏函数"><a href="#%E5%81%8F%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>偏函数</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92290090559170410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import functools\n>>> int2 = functools.partial(int, base=2)\n>>> int2(\'1000000\')\n64\n>>> int2(\'1010101\')\n85`, `92290090559170410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> functools\n<span class="token operator">>></span><span class="token operator">></span> int2 <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> base<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> int2<span class="token punctuation">(</span><span class="token string">\'1000000\'</span><span class="token punctuation">)</span>\n<span class="token number">64</span>\n<span class="token operator">>></span><span class="token operator">></span> int2<span class="token punctuation">(</span><span class="token string">\'1010101\'</span><span class="token punctuation">)</span>\n<span class="token number">85</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所以，简单总结 functools.partial 的作用就是，把一个函数的某些参数给固定住（也就是设置默认值），返回一个新的函数，调用这个新函数会更简单。</p>\n<p>注意到上面的新的 int2 函数，仅仅是把 base 参数重新设定默认值为 2，但也可以在函数调用时传入其他值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56808302227412310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> int2(\'1000000\', base=10)\n1000000`, `56808302227412310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> int2<span class="token punctuation">(</span><span class="token string">\'1000000\'</span><span class="token punctuation">,</span> base<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>\n<span class="token number">1000000</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>最后，创建偏函数时，实际上可以接收函数对象、<code class="language-text">*args</code> 和 <code class="language-text">**kw</code> 这 3 个参数，当传入：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9667762268514490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`int2 = functools.partial(int, base=2)`, `9667762268514490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">int2 <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> base<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>实际上固定了 int() 函数的关键字参数 base，也就是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88065989022596220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`int2(\'10010\')`, `88065989022596220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">int2<span class="token punctuation">(</span><span class="token string">\'10010\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>相当于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99569344844806820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`kw = { \'base\': 2 }\nint(\'10010\', **kw)`, `99569344844806820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">kw <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">\'base\'</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>\n<span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">\'10010\'</span><span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h1 id="模块"><a href="#%E6%A8%A1%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块</h1>\n<p>使用模块有什么好处？</p>\n<p>最大的好处是大大提高了代码的可维护性。其次，编写代码不必从零开始。当一个模块编写完毕，就可以被其他地方引用。我们在编写程序的时候，也经常引用其他模块，包括 Python 内置的模块和来自第三方的模块。</p>\n<p>使用模块还可以避免函数名和变量名冲突。相同名字的函数和变量完全可以分别存在不同的模块中，因此，我们自己在编写模块时，不必考虑名字会与其他模块冲突。但是也要注意，尽量不要与内置函数名字冲突。点<a href="https://docs.python.org/3/library/functions.html#built-in-functions" target="_blank" rel="nofollow noreferrer noopener">这里</a>查看 Python 的所有内置函数。</p>\n<p>如果不同的人编写的模块名相同怎么办？为了避免模块名冲突，Python 又引入了按目录来组织模块的方法，称为包（Package）。</p>\n<p>举个例子，一个 abc.py 的文件就是一个名字叫 abc 的模块，一个 xyz.py 的文件就是一个名字叫 xyz 的模块。</p>\n<p>现在，假设我们的 abc 和 xyz 这两个模块名字与其他模块冲突了，于是我们可以通过包来组织模块，避免冲突。方法是选择一个顶层包名，比如 mycompany，按照如下目录存放：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72146790077136510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mycompany\n├─ __init__.py\n├─ abc.py\n└─ xyz.py`, `72146790077136510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">mycompany\n├─ __init__.py\n├─ abc.py\n└─ xyz.py</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>引入了包以后，只要顶层的包名不与别人冲突，那所有模块都不会与别人冲突。现在，abc.py 模块的名字就变成了 mycompany.abc，类似的，xyz.py 的模块名变成了 mycompany.xyz。</p>\n<p>请注意，每一个包目录下面都会有一个 <code class="language-text">__init__.py</code> 的文件，这个文件是必须存在的，否则，Python 就把这个目录当成普通目录，而不是一个包。<code class="language-text">__init__.py</code> 可以是空文件，也可以有 Python 代码，因为 <code class="language-text">__init__.py</code> 本身就是一个模块，而它的模块名就是 mycompany。</p>\n<p>类似的，可以有多级目录，组成多级层次的包结构。比如如下的目录结构：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9734122383885113000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mycompany\n ├─ web\n │  ├─ __init__.py\n │  ├─ utils.py\n │  └─ www.py\n ├─ __init__.py\n ├─ abc.py\n └─ utils.py`, `9734122383885113000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">mycompany\n ├─ web\n │  ├─ __init__.py\n │  ├─ utils.py\n │  └─ www.py\n ├─ __init__.py\n ├─ abc.py\n └─ utils.py</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>文件 www.py 的模块名就是 mycompany.web.www，两个文件 utils.py 的模块名分别是 mycompany.utils 和 mycompany.web.utils</p>\n<blockquote>\n<p>自己创建模块时要注意命名，不能和 Python 自带的模块名称冲突。例如，系统自带了 sys 模块，自己的模块就不可命名为 sys.py，否则将无法导入系统自带的 sys 模块。</p>\n</blockquote>\n<h2 id="使用模块"><a href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用模块</h2>\n<p>Python 本身就内置了很多非常有用的模块，只要安装完毕，这些模块就可以立刻使用。</p>\n<p>我们以内建的 sys 模块为例，编写一个 hello 的模块：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67461273794119926000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\n\' a test module \'\n\n__author__ = \'Michael Liao\'\n\nimport sys\n\ndef test():\n    args = sys.argv\n    if len(args)==1:\n        print(\'Hello, world!\')\n    elif len(args)==2:\n        print(\'Hello, %s!\' % args[1])\n    else:\n        print(\'Too many arguments!\')\n\nif __name__==\'__main__\':\n    test()`, `67461273794119926000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment">#!/usr/bin/env python3</span>\n<span class="token comment"># -*- coding: utf-8 -*-</span>\n\n<span class="token string">\' a test module \'</span>\n\n__author__ <span class="token operator">=</span> <span class="token string">\'Michael Liao\'</span>\n\n<span class="token keyword">import</span> sys\n\n<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    args <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv\n    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello, world!\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello, %s!\'</span> <span class="token operator">%</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Too many arguments!\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">\'__main__\'</span><span class="token punctuation">:</span>\n    test<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>第 1 行和第 2 行是标准注释，第 1 行注释可以让这个 hello.py 文件直接在 Unix/Linux/Mac 上运行，第 2 行注释表示 .py 文件本身使用标准 UTF-8 编码；</p>\n<p>第 4 行是一个字符串，表示模块的文档注释，任何模块代码的第一个字符串都被视为模块的文档注释；</p>\n<p>第 6 行使用 <code class="language-text">__author__</code> 变量把作者写进去，这样当你公开源代码后别人就可以瞻仰你的大名；</p>\n<p>以上就是 Python 模块的标准文件模板，当然也可以全部删掉不写，但是，按标准办事肯定没错。</p>\n<p>后面开始就是真正的代码部分。</p>\n<p>你可能注意到了，使用 sys 模块的第一步，就是导入该模块：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2802210300583030300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import sys`, `2802210300583030300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> sys</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>导入 sys 模块后，我们就有了变量 sys 指向该模块，利用 sys 这个变量，就可以访问 sys 模块的所有功能。</p>\n<p>sys 模块有一个 argv 变量，用 list 存储了命令行的所有参数。argv 至少有一个元素，因为第一个参数永远是该 .py 文件的名称，例如：</p>\n<p>运行 python3 hello.py 获得的 sys.argv 就是 <code class="language-text">[&#39;hello.py&#39;]</code>；</p>\n<p>运行 python3 hello.py Michael 获得的 sys.argv 就是 <code class="language-text">[&#39;hello.py&#39;, &#39;Michael&#39;]</code>。</p>\n<p>最后，注意到这两行代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36691570723555200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if __name__==\'__main__\':\n    test()`, `36691570723555200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">\'__main__\'</span><span class="token punctuation">:</span>\n    test<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>当我们在命令行运行 hello 模块文件时，Python 解释器把一个特殊变量 <code class="language-text">__name__</code> 置为 <code class="language-text">__main__</code>，而如果在其他地方导入该 hello 模块时，if 判断将失败，因此，这种 if 测试可以让一个模块通过命令行运行时执行一些额外的代码，最常见的就是运行测试。</p>\n<p>我们可以用命令行运行 hello.py 看看效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24038760179620610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python3 hello.py\nHello, world!\n\\$ python3 hello.py Michael\nHello, Michael!`, `24038760179620610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">$ python3 hello.py\nHello, world!\n$ python3 hello.py Michael\nHello, Michael!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果启动 Python 交互环境，再导入 hello 模块：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80651963508427370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python3\nPython 3.4.3 (v3.4.3:9b73f1c3e601, Feb 23 2015, 02:52:03)\n[GCC 4.2.1 (Apple Inc. build 5666) (dot 3)] on darwin\nType &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.\n>>> import hello\n>>>`, `80651963508427370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">$ python3\nPython 3.4.3 (v3.4.3:9b73f1c3e601, Feb 23 2015, 02:52:03)\n[GCC 4.2.1 (Apple Inc. build 5666) (dot 3)] on darwin\nType &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.\n&gt;&gt;&gt; import hello\n&gt;&gt;&gt;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>导入时，没有打印 Hello, word!，因为没有执行 test() 函数。</p>\n<p>调用 hello.test() 时，才能打印出 Hello, word!：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97839658804947270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> hello.test()\nHello, world!`, `97839658804947270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> hello<span class="token punctuation">.</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span>\nHello<span class="token punctuation">,</span> world!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="作用域"><a href="#%E4%BD%9C%E7%94%A8%E5%9F%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>作用域</h3>\n<p>在一个模块中，我们可能会定义很多函数和变量，但有的函数和变量我们希望给别人使用，有的函数和变量我们希望仅仅在模块内部使用。在 Python 中，是通过 <code class="language-text">_</code> 前缀来实现的。</p>\n<p>正常的函数和变量名是公开的（public），可以被直接引用，比如：abc，x123，PI 等；</p>\n<p>类似 <code class="language-text">__xxx__</code> 这样的变量是特殊变量，可以被直接引用，但是有特殊用途，比如上面的 <code class="language-text">__author__</code>，<code class="language-text">__name__</code> 就是特殊变量，hello 模块定义的文档注释也可以用特殊变量 <code class="language-text">__doc__</code> 访问，我们自己的变量一般不要用这种变量名；</p>\n<p>类似 <code class="language-text">_xxx</code> 和 <code class="language-text">__xxx</code> 这样的函数或变量就是非公开的（private），不应该被直接引用，比如 <code class="language-text">_abc</code>，<code class="language-text">__abc</code> 等；</p>\n<p>之所以我们说，private 函数和变量“不应该”被直接引用，而不是“不能”被直接引用，是因为 Python 并没有一种方法可以完全限制访问 private 函数或变量，但是，从编程习惯上不应该引用 private 函数或变量。</p>\n<p>private 函数或变量不应该被别人引用，那它们有什么用呢？请看例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27454804256135467000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def _private_1(name):\n    return \'Hello, %s\' % name\n\ndef _private_2(name):\n    return \'Hi, %s\' % name\n\ndef greeting(name):\n    if len(name) > 3:\n        return _private_1(name)\n    else:\n        return _private_2(name)`, `27454804256135467000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">_private_1</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token string">\'Hello, %s\'</span> <span class="token operator">%</span> name\n\n<span class="token keyword">def</span> <span class="token function">_private_2</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token string">\'Hi, %s\'</span> <span class="token operator">%</span> name\n\n<span class="token keyword">def</span> <span class="token function">greeting</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> _private_1<span class="token punctuation">(</span>name<span class="token punctuation">)</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> _private_2<span class="token punctuation">(</span>name<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们在模块里公开 greeting() 函数，而把内部逻辑用 private 函数隐藏起来了，这样，调用 greeting() 函数不用关心内部的 private 函数细节，这也是一种非常有用的代码封装和抽象的方法，即：</p>\n<p>外部不需要引用的函数全部定义成 private，只有外部需要引用的函数才定义为 public。</p>\n<h2 id="安装第三方模块"><a href="#%E5%AE%89%E8%A3%85%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装第三方模块</h2>\n<p>安装 Pillow 的命令就是</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94080062952476150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pip install Pillow`, `94080062952476150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">pip install Pillow</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="安装常用模块"><a href="#%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装常用模块</h3>\n<p>推荐直接使用 <a href="https://www.anaconda.com/products/distribution" target="_blank" rel="nofollow noreferrer noopener">Anaconda</a>，内置了许多非常有用的第三方库</p>\n<h3 id="模块搜索路径"><a href="#%E6%A8%A1%E5%9D%97%E6%90%9C%E7%B4%A2%E8%B7%AF%E5%BE%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块搜索路径</h3>\n<p>当我们试图加载一个模块时，Python 会在指定的路径下搜索对应的 .py 文件，如果找不到，就会报错：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91859142639257710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import mymodule\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nImportError: No module named mymodule`, `91859142639257710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">&gt;&gt;&gt; import mymodule\nTraceback (most recent call last):\n  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;\nImportError: No module named mymodule</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>默认情况下，Python 解释器会搜索当前目录、所有已安装的内置模块和第三方模块，搜索路径存放在 sys 模块的 path 变量中：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45163649420986970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import sys\n>>> sys.path\n[\'\', \'/Library/Frameworks/Python.framework/Versions/3.6/lib/python36.zip\', \'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6\', ..., \'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages\']`, `45163649420986970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys\n<span class="token operator">>></span><span class="token operator">></span> sys<span class="token punctuation">.</span>path\n<span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token string">\'/Library/Frameworks/Python.framework/Versions/3.6/lib/python36.zip\'</span><span class="token punctuation">,</span> <span class="token string">\'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6\'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token string">\'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果我们要添加自己的搜索目录，有两种方法：</p>\n<ol>\n<li>\n<p>直接修改 sys.path，添加要搜索的目录，但是运行结束后失效。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27258673582070346000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import sys\n>>> sys.path.append(\'/Users/michael/my_py_scripts\')`, `27258673582070346000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sys\n<span class="token operator">>></span><span class="token operator">></span> sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">\'/Users/michael/my_py_scripts\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>设置环境变量 PYTHONPATH，该环境变量的内容会被自动添加到模块搜索路径中。设置方式与设置 Path 环境变量类似。注意只需要添加你自己的搜索路径，Python 自己本身的搜索路径不受影响。</p>\n</li>\n</ol>\n<h1 id="面向对象编程"><a href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>面向对象编程</h1>\n<p>在 Python 中，所有数据类型都可以视为对象，当然也可以自定义对象。自定义的对象数据类型就是面向对象中的类（Class）的概念。</p>\n<p>我们以一个例子来说明面向过程和面向对象在程序流程上的不同之处。</p>\n<p>假设我们要处理学生的成绩表，为了表示一个学生的成绩，面向过程的程序可以用一个 dict 表示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15612773243667677000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`std1 = { \'name\': \'Michael\', \'score\': 98 }\nstd2 = { \'name\': \'Bob\', \'score\': 81 }`, `15612773243667677000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">std1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">\'name\'</span><span class="token punctuation">:</span> <span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token string">\'score\'</span><span class="token punctuation">:</span> <span class="token number">98</span> <span class="token punctuation">}</span>\nstd2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">\'name\'</span><span class="token punctuation">:</span> <span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token string">\'score\'</span><span class="token punctuation">:</span> <span class="token number">81</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>而处理学生成绩可以通过函数实现，比如打印学生的成绩：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87472796315958230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def print_score(std):\n    print(\'%s: %s\' % (std[\'name\'], std[\'score\']))`, `87472796315958230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s: %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>std<span class="token punctuation">[</span><span class="token string">\'name\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token punctuation">[</span><span class="token string">\'score\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果采用面向对象的程序设计思想，我们首选思考的不是程序的执行流程，而是 Student 这种数据类型应该被视为一个对象，这个对象拥有 name 和 score 这两个属性（Property）。如果要打印一个学生的成绩，首先必须创建出这个学生对应的对象，然后，给对象发一个 print_score 消息，让对象自己把自己的数据打印出来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79988934838992260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def __init__(self, name, score):\n        self.name = name\n        self.score = score\n\n    def print_score(self):\n        print(\'%s: %s\' % (self.name, self.score))`, `79988934838992260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score\n\n    <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s: %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>给对象发消息实际上就是调用对象对应的关联函数，我们称之为对象的方法（Method）。面向对象的程序写出来就像这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10009316238319354000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`bart = Student(\'Bart Simpson\', 59)\nlisa = Student(\'Lisa Simpson\', 87)\nbart.print_score()\nlisa.print_score()`, `10009316238319354000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">bart <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Bart Simpson\'</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span>\nlisa <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Lisa Simpson\'</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">)</span>\nbart<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span>\nlisa<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>数据封装、继承和多态是面向对象的三大特点</p>\n<h2 id="类和实例"><a href="#%E7%B1%BB%E5%92%8C%E5%AE%9E%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类和实例</h2>\n<p>在 Python 中，定义类是通过 class 关键字：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74880843429151000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    pass`, `74880843429151000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>class 后面紧接着是类名，即 Student，类名通常是大写开头的单词，紧接着是(object)，表示该类是从哪个类继承下来的，继承的概念我们后面再讲，通常，如果没有合适的继承类，就使用 object 类，这是所有类最终都会继承的类。</p>\n<p>定义好了 Student 类，就可以根据 Student 类创建出 Student 的实例，创建实例是通过 <code class="language-text">类名()</code> 实现的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50314529722975790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart = Student()\n>>> bart\n<__main__.Student object at 0x10a67a590>\n>>> Student\n<class \'__main__.Student\'>`, `50314529722975790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> bart\n<span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>Student <span class="token builtin">object</span> at <span class="token number">0x10a67a590</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> Student\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'__main__.Student\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，变量 bart 指向的就是一个 Student 的实例，后面的 0x10a67a590 是内存地址，每个 object 的地址都不一样，而 Student 本身则是一个类。</p>\n<p>可以自由地给一个实例变量绑定属性，比如，给实例 bart 绑定一个 name 属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63021744946649825000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart.name = \'Bart Simpson\'\n>>> bart.name\n\'Bart Simpson\'`, `63021744946649825000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'Bart Simpson\'</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>name\n<span class="token string">\'Bart Simpson\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>由于类可以起到模板的作用，因此，可以在创建实例的时候，把一些我们认为必须绑定的属性强制填写进去。通过定义一个特殊的 <code class="language-text">__init__</code> 方法，在创建实例的时候，就把 name，score 等属性绑上去：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41003855583818410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def __init__(self, name, score):\n        self.name = name\n        self.score = score`, `41003855583818410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>注意：特殊方法 <code class="language-text">__init__</code> 前后分别有两个下划线！！！</p>\n</blockquote>\n<p>注意到 <code class="language-text">__init__</code> 方法的第一个参数永远是 self，表示创建的实例本身，因此，在 <code class="language-text">__init__</code> 方法内部，就可以把各种属性绑定到 self，因为 self 就指向创建的实例本身。</p>\n<p>有了 <code class="language-text">__init__</code> 方法，在创建实例的时候，就不能传入空的参数了，必须传入与 <code class="language-text">__init__</code> 方法匹配的参数，但 self 不需要传，Python 解释器自己会把实例变量传进去：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48945280300402524000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart = Student(\'Bart Simpson\', 59)\n>>> bart.name\n\'Bart Simpson\'\n>>> bart.score\n59`, `48945280300402524000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Bart Simpson\'</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>name\n<span class="token string">\'Bart Simpson\'</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>score\n<span class="token number">59</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>和普通的函数相比，在类中定义的函数只有一点不同，就是第一个参数永远是实例变量 self，并且，调用时，不用传递该参数。除此之外，类的方法和普通函数没有什么区别，所以，你仍然可以用默认参数、可变参数、关键字参数和命名关键字参数。</p>\n<h3 id="数据封装"><a href="#%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据封装</h3>\n<p>面向对象编程的一个重要特点就是数据封装。在上面的 Student 类中，每个实例就拥有各自的 name 和 score 这些数据。我们可以通过函数来访问这些数据，比如打印一个学生的成绩：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83000412449318370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> def print_score(std):\n...     print(\'%s: %s\' % (std.name, std.score))\n...\n>>> print_score(bart)\nBart Simpson: 59`, `83000412449318370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s: %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>std<span class="token punctuation">.</span>name<span class="token punctuation">,</span> std<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> print_score<span class="token punctuation">(</span>bart<span class="token punctuation">)</span>\nBart Simpson<span class="token punctuation">:</span> <span class="token number">59</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，既然 Student 实例本身就拥有这些数据，要访问这些数据，就没有必要从外面的函数去访问，可以直接在 Student 类的内部定义访问数据的函数，这样，就把“数据”给封装起来了。这些封装数据的函数是和 Student 类本身是关联起来的，我们称之为类的方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37080097504911110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def __init__(self, name, score):\n        self.name = name\n        self.score = score\n\n    def print_score(self):\n        print(\'%s: %s\' % (self.name, self.score))`, `37080097504911110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score\n\n    <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s: %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要定义一个方法，除了第一个参数是 self 外，其他和普通函数一样。要调用一个方法，只需要在实例变量上直接调用，除了 self 不用传递，其他参数正常传入：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77172550693521500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart.print_score()\nBart Simpson: 59`, `77172550693521500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>print_score<span class="token punctuation">(</span><span class="token punctuation">)</span>\nBart Simpson<span class="token punctuation">:</span> <span class="token number">59</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这样一来，我们从外部看 Student 类，就只需要知道，创建实例需要给出 name 和 score，而如何打印，都是在 Student 类的内部定义的，这些数据和逻辑被“封装”起来了，调用很容易，但却不用知道内部实现的细节。</p>\n<p>封装的另一个好处是可以给 Student 类增加新的方法，比如 get_grade：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2110611098284520400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    ...\n\n    def get_grade(self):\n        if self.score >= 90:\n            return \'A\'\n        elif self.score >= 60:\n            return \'B\'\n        else:\n            return \'C\'`, `2110611098284520400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n\n    <span class="token keyword">def</span> <span class="token function">get_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> self<span class="token punctuation">.</span>score <span class="token operator">>=</span> <span class="token number">90</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'A\'</span>\n        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>score <span class="token operator">>=</span> <span class="token number">60</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'B\'</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'C\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样的，get_grade 方法可以直接在实例变量上调用，不需要知道内部实现细节：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45885416488390020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    def __init__(self, name, score):\n        self.name = name\n        self.score = score\n\n    def get_grade(self):\n        if self.score >= 90:\n            return \'A\'\n        elif self.score >= 60:\n            return \'B\'\n        else:\n            return \'C\'\n\nlisa = Student(\'Lisa\', 99)\nbart = Student(\'Bart\', 59)\nprint(lisa.name, lisa.get_grade()) # Lisa A\nprint(bart.name, bart.get_grade()) # Bart C`, `45885416488390020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score\n\n    <span class="token keyword">def</span> <span class="token function">get_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> self<span class="token punctuation">.</span>score <span class="token operator">>=</span> <span class="token number">90</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'A\'</span>\n        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>score <span class="token operator">>=</span> <span class="token number">60</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'B\'</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'C\'</span>\n\nlisa <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Lisa\'</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span>\nbart <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Bart\'</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>lisa<span class="token punctuation">.</span>name<span class="token punctuation">,</span> lisa<span class="token punctuation">.</span>get_grade<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Lisa A</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>bart<span class="token punctuation">.</span>name<span class="token punctuation">,</span> bart<span class="token punctuation">.</span>get_grade<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Bart C</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="小结-5"><a href="#%E5%B0%8F%E7%BB%93-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>类是创建实例的模板，而实例则是一个一个具体的对象，各个实例拥有的数据都互相独立，互不影响；</p>\n<p>方法就是与实例绑定的函数，和普通函数不同，方法可以直接访问实例的数据；</p>\n<p>通过在实例上调用方法，我们就直接操作了对象内部的数据，但无需知道方法内部的实现细节。</p>\n<p>和静态语言不同，Python 允许对实例变量绑定任何数据，也就是说，对于两个实例变量，虽然它们都是同一个类的不同实例，但拥有的变量名称都可能不同：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8101967504538266000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart = Student(\'Bart Simpson\', 59)\n>>> lisa = Student(\'Lisa Simpson\', 87)\n>>> bart.age = 8\n>>> bart.age\n8\n>>> lisa.age\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nAttributeError: \'Student\' object has no attribute \'age\'`, `8101967504538266000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Bart Simpson\'</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> lisa <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Lisa Simpson\'</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">8</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>age\n<span class="token number">8</span>\n<span class="token operator">>></span><span class="token operator">></span> lisa<span class="token punctuation">.</span>age\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'Student\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'age\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="访问限制"><a href="#%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>访问限制</h2>\n<p>在 Class 内部，可以有属性和方法，而外部代码可以通过直接调用实例变量的方法来操作数据，这样，就隐藏了内部的复杂逻辑。</p>\n<p>但是，从前面 Student 类的定义来看，外部代码还是可以自由地修改一个实例的 name、score 属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81083364098765470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart = Student(\'Bart Simpson\', 59)\n>>> bart.score\n59\n>>> bart.score = 99\n>>> bart.score\n99`, `81083364098765470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Bart Simpson\'</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>score\n<span class="token number">59</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">99</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>score\n<span class="token number">99</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果要让内部属性不被外部访问，可以把属性的名称前加上两个下划线 <code class="language-text">__</code>，在 Python 中，实例的变量名如果以 <code class="language-text">__</code> 开头，就变成了一个私有变量（private），只有内部可以访问，外部不能访问，所以，我们把 Student 类改一改：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53370506027104690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def __init__(self, name, score):\n        self.__name = name\n        self.__score = score\n\n    def print_score(self):\n        print(\'%s: %s\' % (self.__name, self.__score))`, `53370506027104690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>__score <span class="token operator">=</span> score\n\n    <span class="token keyword">def</span> <span class="token function">print_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s: %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>__score<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>改完后，对于外部代码来说，没什么变动，但是已经无法从外部访问 <code class="language-text">实例变量.__name</code> 和 <code class="language-text">实例变量.__score</code> 了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24240677335162597000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart = Student(\'Bart Simpson\', 59)\n>>> bart.__name\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nAttributeError: \'Student\' object has no attribute \'__name\'`, `24240677335162597000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Bart Simpson\'</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>__name\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'Student\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'__name\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样就确保了外部代码不能随意修改对象内部的状态，这样通过访问限制的保护，代码更加健壮。</p>\n<p>但是如果外部代码要获取 name 和 score 怎么办？可以给 Student 类增加 <code class="language-text">get_name</code> 和 <code class="language-text">get_score</code> 这样的方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2763976865242723300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    ...\n\n    def get_name(self):\n        return self.__name\n\n    def get_score(self):\n        return self.__score`, `2763976865242723300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n\n    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__name\n\n    <span class="token keyword">def</span> <span class="token function">get_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__score</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果又要允许外部代码修改 score 怎么办？可以再给 Student 类增加 set_score 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90804849598342510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    ...\n\n    def set_score(self, score):\n        self.__score = score`, `90804849598342510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n\n    <span class="token keyword">def</span> <span class="token function">set_score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>__score <span class="token operator">=</span> score</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你也许会问，原先那种直接通过 bart.score = 99 也可以修改啊，为什么要定义一个方法大费周折？因为在方法中，可以对参数做检查，避免传入无效的参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59493383436859040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    ...\n\n    def set_score(self, score):\n        if 0 <= score <= 100:\n            self.__score = score\n        else:\n            raise ValueError(\'bad score\')`, `59493383436859040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n\n    <span class="token keyword">def</span> <span class="token function">set_score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> score <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>__score <span class="token operator">=</span> score\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'bad score\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>需要注意的是，在 Python 中，变量名类似 <code class="language-text">__xxx__</code> 的，也就是以双下划线开头，并且以双下划线结尾的，是特殊变量，特殊变量是可以直接访问的，不是 private 变量，所以，不能用 <code class="language-text">__name__</code>、 <code class="language-text">__score__</code> 这样的变量名。</p>\n<p>有些时候，你会看到以一个下划线开头的实例变量名，比如 <code class="language-text">_name</code>，这样的实例变量外部是可以访问的，但是，按照约定俗成的规定，当你看到这样的变量时，意思就是，“虽然我可以被访问，但是，请把我视为私有变量，不要随意访问”。</p>\n<p>双下划线开头的实例变量是不是一定不能从外部访问呢？其实也不是。不能直接访问 <code class="language-text">__name</code> 是因为 Python 解释器对外把 <code class="language-text">__name</code> 变量改成了 <code class="language-text">_Student__name</code>，所以，仍然可以通过 <code class="language-text">_Student__name</code> 来访问 <code class="language-text">__name</code> 变量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59608224436635830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart._Student__name\n\'Bart Simpson\'`, `59608224436635830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>_Student__name\n<span class="token string">\'Bart Simpson\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是强烈建议你不要这么干，因为不同版本的 Python 解释器可能会把 <code class="language-text">__name</code> 改成不同的变量名。</p>\n<p>总的来说就是，Python 本身没有任何机制阻止你干坏事，一切全靠自觉。</p>\n<p>最后注意下面的这种错误写法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84538750292869790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart = Student(\'Bart Simpson\', 59)\n>>> bart.get_name()\n\'Bart Simpson\'\n>>> bart.__name = \'New Name\' # 设置 __name 变量！\n>>> bart.__name\n\'New Name\'`, `84538750292869790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Bart Simpson\'</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token string">\'Bart Simpson\'</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>__name <span class="token operator">=</span> <span class="token string">\'New Name\'</span> <span class="token comment"># 设置 __name 变量！</span>\n<span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>__name\n<span class="token string">\'New Name\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>表面上看，外部代码“成功”地设置了 <code class="language-text">__name</code> 变量，但实际上这个 <code class="language-text">__name</code> 变量和 class 内部的 <code class="language-text">__name</code> 变量不是一个变量！内部的 <code class="language-text">__name</code> 变量已经被 Python 解释器自动改成了 <code class="language-text">_Student__name</code>，而外部代码给 bart 新增了一个 <code class="language-text">__name</code> 变量。不信试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47444501168948180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> bart.get_name() # get_name() 内部返回 self.__name\n\'Bart Simpson\'`, `47444501168948180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> bart<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># get_name() 内部返回 self.__name</span>\n<span class="token string">\'Bart Simpson\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="继承和多态"><a href="#%E7%BB%A7%E6%89%BF%E5%92%8C%E5%A4%9A%E6%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>继承和多态</h2>\n<p>在 OOP 程序设计中，当我们定义一个 class 的时候，可以从某个现有的 class 继承，新的 class 称为子类（Subclass），而被继承的 class 称为基类、父类或超类（Base class、Super class）。</p>\n<p>比如，我们已经编写了一个名为 Animal 的 class，有一个 run() 方法可以直接打印：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88370522649788800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Animal(object):\n    def run(self):\n        print(\'Animal is running...\')`, `88370522649788800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Animal is running...\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当我们需要编写 Dog 和 Cat 类时，就可以直接从 Animal 类继承：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24447803990351090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Dog(Animal):\n    pass\n\nclass Cat(Animal):\n    pass`, `24447803990351090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于 Dog 来说，Animal 就是它的父类，对于 Animal 来说，Dog 就是它的子类。Cat 和 Dog 类似。</p>\n<p>继承有什么好处？最大的好处是子类获得了父类的全部功能。由于 Animial 实现了 run() 方法，因此，Dog 和 Cat 作为它的子类，什么事也没干，就自动拥有了 run() 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26271583762621330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dog = Dog()\ndog.run()\n\ncat = Cat()\ncat.run()`, `26271583762621330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">dog <span class="token operator">=</span> Dog<span class="token punctuation">(</span><span class="token punctuation">)</span>\ndog<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\ncat <span class="token operator">=</span> Cat<span class="token punctuation">(</span><span class="token punctuation">)</span>\ncat<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94056703111745650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Animal is running...\nAnimal is running...`, `94056703111745650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Animal is running...\nAnimal is running...</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>当然，也可以对子类增加一些方法，比如 Dog 类：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33123405627389380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Dog(Animal):\n\n    def run(self):\n        print(\'Dog is running...\')\n\n    def eat(self):\n        print(\'Eating meat...\')`, `33123405627389380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Dog is running...\'</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Eating meat...\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>继承的第二个好处需要我们对代码做一点改进。你看到了，无论是 Dog 还是 Cat，它们 run() 的时候，显示的都是 Animal is running…，符合逻辑的做法是分别显示 Dog is running… 和 Cat is running…，因此，对 Dog 和 Cat 类改进如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36127555880543506000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Dog(Animal):\n\n    def run(self):\n        print(\'Dog is running...\')\n\nclass Cat(Animal):\n\n    def run(self):\n        print(\'Cat is running...\')`, `36127555880543506000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Dog is running...\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Cat is running...\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>再次运行，结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="811348416938351100"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Dog is running...\nCat is running...`, `811348416938351100`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Dog is running...\nCat is running...</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>当子类和父类都存在相同的 run() 方法时，我们说，子类的 run() 覆盖了父类的 run()，在代码运行的时候，总是会调用子类的 run()。这样，我们就获得了继承的另一个好处：多态。</p>\n<p>要理解什么是多态，我们首先要对数据类型再作一点说明。当我们定义一个 class 的时候，我们实际上就定义了一种数据类型。我们定义的数据类型和 Python 自带的数据类型，比如 str、list、dict 没什么两样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10160166637539580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = list() # a 是 list 类型\nb = Animal() # b 是 Animal 类型\nc = Dog() # c 是 Dog 类型`, `10160166637539580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">a <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># a 是 list 类型</span>\nb <span class="token operator">=</span> Animal<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># b 是 Animal 类型</span>\nc <span class="token operator">=</span> Dog<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># c 是 Dog 类型</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>判断一个变量是否是某个类型可以用 isinstance() 判断：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48916368549936930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance(a, list)\nTrue\n>>> isinstance(b, Animal)\nTrue\n>>> isinstance(c, Dog)\nTrue`, `48916368549936930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span>\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看来 a、b、c 确实对应着 list、Animal、Dog 这 3 种类型。</p>\n<p>但是等等，试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51697276558750335000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance(c, Animal)\nTrue`, `51697276558750335000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span>\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>看来 c 不仅仅是 Dog，c 还是 Animal！</p>\n<p>不过仔细想想，这是有道理的，因为 Dog 是从 Animal 继承下来的，当我们创建了一个 Dog 的实例 c 时，我们认为 c 的数据类型是 Dog 没错，但 c 同时也是 Animal 也没错，Dog 本来就是 Animal 的一种！</p>\n<p>所以，在继承关系中，如果一个实例的数据类型是某个子类，那它的数据类型也可以被看做是父类。但是，反过来就不行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43264250723638020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> b = Animal()\n>>> isinstance(b, Dog)\nFalse`, `43264250723638020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> Animal<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span>\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>Dog 可以看成 Animal，但 Animal 不可以看成 Dog。</p>\n<p>要理解多态的好处，我们还需要再编写一个函数，这个函数接受一个 Animal 类型的变量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94497917011211530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def run_twice(animal):\n    animal.run()\n    animal.run()`, `94497917011211530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">run_twice</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    animal<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    animal<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当我们传入 Animal 的实例时，run_twice() 就打印出：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35058821883574720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> run_twice(Animal())\nAnimal is running...\nAnimal is running...`, `35058821883574720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> run_twice<span class="token punctuation">(</span>Animal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nAnimal <span class="token keyword">is</span> running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nAnimal <span class="token keyword">is</span> running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当我们传入 Dog 的实例时，run_twice() 就打印出：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20961182565521752000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> run_twice(Dog())\nDog is running...\nDog is running...`, `20961182565521752000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> run_twice<span class="token punctuation">(</span>Dog<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nDog <span class="token keyword">is</span> running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nDog <span class="token keyword">is</span> running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当我们传入 Cat 的实例时，run_twice() 就打印出：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7356063391511203000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> run_twice(Cat())\nCat is running...\nCat is running...`, `7356063391511203000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> run_twice<span class="token punctuation">(</span>Cat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nCat <span class="token keyword">is</span> running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nCat <span class="token keyword">is</span> running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>看上去没啥意思，但是仔细想想，现在，如果我们再定义一个 Tortoise 类型，也从 Animal 派生：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45911945793954456000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Tortoise(Animal):\n    def run(self):\n        print(\'Tortoise is running slowly...\')`, `45911945793954456000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Tortoise</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Tortoise is running slowly...\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当我们调用 run_twice() 时，传入 Tortoise 的实例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89522081639556350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> run_twice(Tortoise())\nTortoise is running slowly...\nTortoise is running slowly...`, `89522081639556350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> run_twice<span class="token punctuation">(</span>Tortoise<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nTortoise <span class="token keyword">is</span> running slowly<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nTortoise <span class="token keyword">is</span> running slowly<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>你会发现，新增一个 Animal 的子类，不必对 run_twice() 做任何修改，实际上，任何依赖 Animal 作为参数的函数或者方法都可以不加修改地正常运行，原因就在于多态。</p>\n<p>多态的好处就是，当我们需要传入 Dog、Cat、Tortoise…… 时，我们只需要接收 Animal 类型就可以了，因为 Dog、Cat、Tortoise…… 都是 Animal 类型，然后，按照 Animal 类型进行操作即可。由于 Animal 类型有 run() 方法，因此，传入的任意类型，只要是 Animal 类或者子类，就会自动调用实际类型的 run() 方法，这就是多态的意思：</p>\n<p>对于一个变量，我们只需要知道它是 Animal 类型，无需确切地知道它的子类型，就可以放心地调用 run() 方法，而具体调用的 run() 方法是作用在 Animal、Dog、Cat 还是 Tortoise 对象上，由运行时该对象的确切类型决定，这就是多态真正的威力：调用方只管调用，不管细节，而当我们新增一种 Animal 的子类时，只要确保 run() 方法编写正确，不用管原来的代码是如何调用的。这就是著名的“开闭”原则：</p>\n<ul>\n<li>对扩展开放：允许新增 Animal 子类；</li>\n<li>对修改封闭：不需要修改依赖 Animal 类型的 run_twice() 等函数。</li>\n</ul>\n<p>继承还可以一级一级地继承下来，就好比从爷爷到爸爸、再到儿子这样的关系。而任何类，最终都可以追溯到根类 object，这些继承关系看上去就像一颗倒着的树。</p>\n<h3 id="静态语言-vs-动态语言"><a href="#%E9%9D%99%E6%80%81%E8%AF%AD%E8%A8%80-vs-%E5%8A%A8%E6%80%81%E8%AF%AD%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>静态语言 vs 动态语言</h3>\n<p>对于静态语言（例如 Java）来说，如果需要传入 Animal 类型，则传入的对象必须是 Animal 类型或者它的子类，否则，将无法调用 run() 方法。</p>\n<p>对于 Python 这样的动态语言来说，则不一定需要传入 Animal 类型。我们只需要保证传入的对象有一个 run() 方法就可以了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63410625542666350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Timer(object):\n    def run(self):\n        print(\'Start...\')`, `63410625542666350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Timer</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Start...\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这就是动态语言的“鸭子类型”，它并不要求严格的继承体系，一个对象只要“看起来像鸭子，走起路来像鸭子”，那它就可以被看做是鸭子。</p>\n<p>Python 的 <code class="language-text">file-like object</code> 就是一种鸭子类型。对真正的文件对象，它有一个 read() 方法，返回其内容。但是，许多对象，只要有 read() 方法，都被视为“file-like object“。许多函数接收的参数就是 <code class="language-text">file-like object</code>，你不一定要传入真正的文件对象，完全可以传入任何实现了 read() 方法的对象。</p>\n<h3 id="小结-6"><a href="#%E5%B0%8F%E7%BB%93-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>继承可以把父类的所有功能都直接拿过来，这样就不必重零做起，子类只需要新增自己特有的方法，也可以把父类不适合的方法覆盖重写。</p>\n<p>动态语言的鸭子类型特点决定了继承不像静态语言那样是必须的。</p>\n<h2 id="获取对象信息"><a href="#%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E4%BF%A1%E6%81%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取对象信息</h2>\n<h3 id="使用-type"><a href="#%E4%BD%BF%E7%94%A8-type" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 type()</h3>\n<p>首先，我们来判断对象类型，使用 type() 函数：</p>\n<p>基本类型都可以用 type() 判断：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16529531230093330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> type(123)\n<class \'int\'>\n>>> type(\'str\')\n<class \'str\'>\n>>> type(None)\n<type(None) \'NoneType\'>`, `16529531230093330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'int\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'str\'</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'str\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token string">\'NoneType\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果一个变量指向函数或者类，也可以用 type() 判断：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19964085893038887000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> type(abs)\n<class \'builtin_function_or_method\'>\n>>> type(a)\n<class \'__main__.Animal\'>`, `19964085893038887000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'builtin_function_or_method\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'__main__.Animal\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是 type() 函数返回的是什么类型呢？它返回对应的 Class 类型。如果我们要在 if 语句中判断，就需要比较两个变量的 type 类型是否相同：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89751316568548160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> type(123)==type(456)\nTrue\n>>> type(123)==int\nTrue\n>>> type(\'abc\')==type(\'123\')\nTrue\n>>> type(\'abc\')==str\nTrue\n>>> type(\'abc\')==type(123)\nFalse`, `89751316568548160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">456</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">int</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'123\'</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">str</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>判断基本数据类型可以直接写 int，str 等，但如果要判断一个对象是否是函数怎么办？可以使用 types 模块中定义的常量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1052760102841832100"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import types\n>>> def fn():\n...     pass\n...\n>>> type(fn)==types.FunctionType\nTrue\n>>> type(abs)==types.BuiltinFunctionType\nTrue\n>>> type(lambda x: x)==types.LambdaType\nTrue\n>>> type((x for x in range(10)))==types.GeneratorType\nTrue`, `1052760102841832100`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> types\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token operator">==</span>types<span class="token punctuation">.</span>FunctionType\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">)</span><span class="token operator">==</span>types<span class="token punctuation">.</span>BuiltinFunctionType\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">)</span><span class="token operator">==</span>types<span class="token punctuation">.</span>LambdaType\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>types<span class="token punctuation">.</span>GeneratorType\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="使用-isinstance"><a href="#%E4%BD%BF%E7%94%A8-isinstance" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 isinstance()</h3>\n<p>对于 class 的继承关系来说，使用 type() 就很不方便。我们要判断 class 的类型，可以使用 isinstance() 函数。</p>\n<p>我们回顾上次的例子，如果继承关系是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99709535812725440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`object -> Animal -> Dog -> Husky`, `99709535812725440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">object -&gt; Animal -&gt; Dog -&gt; Husky</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>那么，isinstance() 就可以告诉我们，一个对象是否是某种类型。先创建 3 种类型的对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6469177068887633000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> a = Animal()\n>>> d = Dog()\n>>> h = Husky()`, `6469177068887633000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> Animal<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> Dog<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> h <span class="token operator">=</span> Husky<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后，判断：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36613077664328507000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance(h, Husky)\nTrue`, `36613077664328507000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> Husky<span class="token punctuation">)</span>\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>没有问题，因为 h 变量指向的就是 Husky 对象。</p>\n<p>再判断：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1977321653507768600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance(h, Dog)\nTrue`, `1977321653507768600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span>\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>h 虽然自身是 Husky 类型，但由于 Husky 是从 Dog 继承下来的，所以，h 也还是 Dog 类型。换句话说，isinstance() 判断的是一个对象是否是该类型本身，或者位于该类型的父继承链上。</p>\n<p>因此，我们可以确信，h 还是 Animal 类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97730694284575330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance(h, Animal)\nTrue`, `97730694284575330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span>\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>同理，实际类型是 Dog 的 d 也是 Animal 类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70008185528744680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance(d, Dog) and isinstance(d, Animal)\nTrue`, `70008185528744680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span>\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是，d 不是 Husky 类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56927977243320420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance(d, Husky)\nFalse`, `56927977243320420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> Husky<span class="token punctuation">)</span>\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>能用 type() 判断的基本类型也可以用 isinstance() 判断：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89024114452488000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance(\'a\', str)\nTrue\n>>> isinstance(123, int)\nTrue\n>>> isinstance(b\'a\', bytes)\nTrue`, `89024114452488000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token string">b\'a\'</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>并且还可以判断一个变量是否是某些类型中的一种，比如下面的代码就可以判断是否是 list 或者 tuple：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72606996981764450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> isinstance([1, 2, 3], (list, tuple))\nTrue\n>>> isinstance((1, 2, 3), (list, tuple))\nTrue`, `72606996981764450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>总是优先使用 isinstance() 判断类型，可以将指定类型及其子类“一网打尽”。</p>\n</blockquote>\n<h3 id="使用-dir"><a href="#%E4%BD%BF%E7%94%A8-dir" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 dir()</h3>\n<p>如果要获得一个对象的所有属性和方法，可以使用 dir() 函数，它返回一个包含字符串的 list，比如，获得一个 str 对象的所有属性和方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35939318052358550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> dir(\'ABC\')\n[\'__add__\', \'__class__\',..., \'__subclasshook__\', \'capitalize\', \'casefold\',..., \'zfill\']`, `35939318052358550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token string">\'ABC\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'__add__\'</span><span class="token punctuation">,</span> <span class="token string">\'__class__\'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token string">\'__subclasshook__\'</span><span class="token punctuation">,</span> <span class="token string">\'capitalize\'</span><span class="token punctuation">,</span> <span class="token string">\'casefold\'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token string">\'zfill\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>类似 <code class="language-text">__xxx__</code> 的属性和方法在 Python 中都是有特殊用途的，比如 <code class="language-text">__len__</code> 方法返回长度。在 Python 中，如果你调用 len() 函数试图获取一个对象的长度，实际上，在 len() 函数内部，它自动去调用该对象的 <code class="language-text">__len__()</code> 方法，所以，下面的代码是等价的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26082749919873516000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> len(\'ABC\')\n3\n>>> \'ABC\'.__len__()\n3`, `26082749919873516000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">\'ABC\'</span><span class="token punctuation">)</span>\n<span class="token number">3</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'ABC\'</span><span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们自己写的类，如果也想用 len(myObj) 的话，就自己写一个 <code class="language-text">__len__()</code> 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20728620385317732000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> class MyDog(object):\n...     def __len__(self):\n...         return 100\n...\n>>> dog = MyDog()\n>>> len(dog)\n100`, `20728620385317732000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">MyDog</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">return</span> <span class="token number">100</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> dog <span class="token operator">=</span> MyDog<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">len</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span>\n<span class="token number">100</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>剩下的都是普通属性或方法，比如 lower() 返回小写的字符串：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53659512710473310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'ABC\'.lower()\n\'abc\'`, `53659512710473310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'ABC\'</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token string">\'abc\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>仅仅把属性和方法列出来是不够的，配合 getattr()、setattr() 以及 hasattr()，我们可以直接操作一个对象的状态：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22380795072380023000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> class MyObject(object):\n...     def __init__(self):\n...         self.x = 9\n...     def power(self):\n...         return self.x * self.x\n...\n>>> obj = MyObject()`, `22380795072380023000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">9</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">power</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">return</span> self<span class="token punctuation">.</span>x <span class="token operator">*</span> self<span class="token punctuation">.</span>x\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> obj <span class="token operator">=</span> MyObject<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>紧接着，可以测试该对象的属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79011491768137480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> hasattr(obj, \'x\') # 有属性 \'x\' 吗？\nTrue\n>>> obj.x\n9\n>>> hasattr(obj, \'y\') # 有属性 \'y\' 吗？\nFalse\n>>> setattr(obj, \'y\', 19) # 设置一个属性 \'y\'\n>>> hasattr(obj, \'y\') # 有属性 \'y\' 吗？\nTrue\n>>> getattr(obj, \'y\') # 获取属性 \'y\'\n19\n>>> obj.y # 获取属性 \'y\'\n19`, `79011491768137480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'x\'</span><span class="token punctuation">)</span> <span class="token comment"># 有属性 \'x\' 吗？</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>x\n<span class="token number">9</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">)</span> <span class="token comment"># 有属性 \'y\' 吗？</span>\n<span class="token boolean">False</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">setattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token comment"># 设置一个属性 \'y\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">)</span> <span class="token comment"># 有属性 \'y\' 吗？</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">)</span> <span class="token comment"># 获取属性 \'y\'</span>\n<span class="token number">19</span>\n<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>y <span class="token comment"># 获取属性 \'y\'</span>\n<span class="token number">19</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果试图获取不存在的属性，会抛出 AttributeError 的错误：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1564186415878765600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> getattr(obj, \'z\') # 获取属性 \'z\'\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nAttributeError: \'MyObject\' object has no attribute \'z\'`, `1564186415878765600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'z\'</span><span class="token punctuation">)</span> <span class="token comment"># 获取属性 \'z\'</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'MyObject\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'z\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以传入一个 default 参数，如果属性不存在，就返回默认值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89245681944273270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> getattr(obj, \'z\', 404) # 获取属性 \'z\'，如果不存在，返回默认值 404\n404`, `89245681944273270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'z\'</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token comment"># 获取属性 \'z\'，如果不存在，返回默认值 404</span>\n<span class="token number">404</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>也可以获得对象的方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10777380654210011000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> hasattr(obj, \'power\') # 有属性 \'power\' 吗？\nTrue\n>>> getattr(obj, \'power\') # 获取属性 \'power\'\n<bound method MyObject.power of <__main__.MyObject object at 0x10077a6a0>>\n>>> fn = getattr(obj, \'power\') # 获取属性 \'power\' 并赋值到变量 fn\n>>> fn # fn 指向 obj.power\n<bound method MyObject.power of <__main__.MyObject object at 0x10077a6a0>>\n>>> fn() # 调用 fn() 与调用 obj.power() 是一样的\n81`, `10777380654210011000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'power\'</span><span class="token punctuation">)</span> <span class="token comment"># 有属性 \'power\' 吗？</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'power\'</span><span class="token punctuation">)</span> <span class="token comment"># 获取属性 \'power\'</span>\n<span class="token operator">&lt;</span>bound method MyObject<span class="token punctuation">.</span>power of <span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>MyObject <span class="token builtin">object</span> at <span class="token number">0x10077a6a0</span><span class="token operator">>></span>\n<span class="token operator">>></span><span class="token operator">></span> fn <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'power\'</span><span class="token punctuation">)</span> <span class="token comment"># 获取属性 \'power\' 并赋值到变量 fn</span>\n<span class="token operator">>></span><span class="token operator">></span> fn <span class="token comment"># fn 指向 obj.power</span>\n<span class="token operator">&lt;</span>bound method MyObject<span class="token punctuation">.</span>power of <span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>MyObject <span class="token builtin">object</span> at <span class="token number">0x10077a6a0</span><span class="token operator">>></span>\n<span class="token operator">>></span><span class="token operator">></span> fn<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 调用 fn() 与调用 obj.power() 是一样的</span>\n<span class="token number">81</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="小结-7"><a href="#%E5%B0%8F%E7%BB%93-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>通过内置的一系列函数，我们可以对任意一个 Python 对象进行剖析，拿到其内部的数据。要注意的是，只有在不知道对象信息的时候，我们才会去获取对象信息。如果可以直接写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="770165837192360300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`sum = obj.x + obj.y`, `770165837192360300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token builtin">sum</span> <span class="token operator">=</span> obj<span class="token punctuation">.</span>x <span class="token operator">+</span> obj<span class="token punctuation">.</span>y</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>就不要写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16301032782551284000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`sum = getattr(obj, \'x\') + getattr(obj, \'y\')`, `16301032782551284000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'x\'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>一个正确的用法的例子如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79208989410487350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def readImage(fp):\n    if hasattr(fp, \'read\'):\n        return readData(fp)\n    return None`, `79208989410487350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">readImage</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">\'read\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> readData<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token boolean">None</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>假设我们希望从文件流 fp 中读取图像，我们首先要判断该 fp 对象是否存在 read 方法，如果存在，则该对象是一个流，如果不存在，则无法读取。hasattr() 就派上了用场。</p>\n<p>请注意，在 Python 这类动态语言中，根据鸭子类型，有 read() 方法，不代表该 fp 对象就是一个文件流，它也可能是网络流，也可能是内存中的一个字节流，但只要 read() 方法返回的是有效的图像数据，就不影响读取图像的功能。</p>\n<h2 id="实例属性和类属性"><a href="#%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E5%92%8C%E7%B1%BB%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实例属性和类属性</h2>\n<p>由于 Python 是动态语言，根据类创建的实例可以任意绑定属性。</p>\n<p>给实例绑定属性的方法是通过实例变量，或者通过 self 变量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11458867765472713000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    def __init__(self, name):\n        self.name = name\n\ns = Student(\'Bob\')\ns.score = 90`, `11458867765472713000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n\ns <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Bob\'</span><span class="token punctuation">)</span>\ns<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">90</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，如果 Student 类本身需要绑定一个属性呢？可以直接在 class 中定义属性，这种属性是类属性，归 Student 类所有：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30992484234702890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    name = \'Student\'`, `30992484234702890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    name <span class="token operator">=</span> <span class="token string">\'Student\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>当我们定义了一个类属性后，这个属性虽然归类所有，但类的所有实例都可以访问到。来测试一下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51306286987240645000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> class Student(object):\n...     name = \'Student\'\n...\n>>> s = Student() # 创建实例 s\n>>> print(s.name) # 打印 name 属性，因为实例并没有 name 属性，所以会继续查找 class 的 name 属性\nStudent\n>>> print(Student.name) # 打印类的 name 属性\nStudent\n>>> s.name = \'Michael\' # 给实例绑定 name 属性\n>>> print(s.name) # 由于实例属性优先级比类属性高，因此，它会屏蔽掉类的 name 属性\nMichael\n>>> print(Student.name) # 但是类属性并未消失，用 Student.name 仍然可以访问\nStudent\n>>> del s.name # 如果删除实例的 name 属性\n>>> print(s.name) # 再次调用 s.name，由于实例的 name 属性没有找到，类的 name 属性就显示出来了\nStudent`, `51306286987240645000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     name <span class="token operator">=</span> <span class="token string">\'Student\'</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 创建实例 s</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment"># 打印 name 属性，因为实例并没有 name 属性，所以会继续查找 class 的 name 属性</span>\nStudent\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment"># 打印类的 name 属性</span>\nStudent\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'Michael\'</span> <span class="token comment"># 给实例绑定 name 属性</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment"># 由于实例属性优先级比类属性高，因此，它会屏蔽掉类的 name 属性</span>\nMichael\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment"># 但是类属性并未消失，用 Student.name 仍然可以访问</span>\nStudent\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">del</span> s<span class="token punctuation">.</span>name <span class="token comment"># 如果删除实例的 name 属性</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment"># 再次调用 s.name，由于实例的 name 属性没有找到，类的 name 属性就显示出来了</span>\nStudent</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从上面的例子可以看出，在编写程序的时候，千万不要对实例属性和类属性使用相同的名字，因为相同名称的实例属性将屏蔽掉类属性，但是当你删除实例属性后，再使用相同的名称，访问到的将是类属性。</p>\n<h3 id="小结-8"><a href="#%E5%B0%8F%E7%BB%93-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>实例属性属于各个实例所有，互不干扰；</p>\n<p>类属性属于类所有，所有实例共享一个属性；</p>\n<p>不要对实例属性和类属性使用相同的名字，否则将产生难以发现的错误。</p>\n<h1 id="面向对象高级编程"><a href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>面向对象高级编程</h1>\n<h2 id="使用-__slots__"><a href="#%E4%BD%BF%E7%94%A8-__slots__" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 <code class="language-text">__slots__</code></h2>\n<p>正常情况下，当我们定义了一个 class，创建了一个 class 的实例后，我们可以给该实例绑定任何属性和方法，这就是动态语言的灵活性。先定义 class：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43177148615035350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    pass`, `43177148615035350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然后，尝试给实例绑定一个属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73233465312634100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = Student()\n>>> s.name = \'Michael\' # 动态给实例绑定一个属性\n>>> print(s.name)\nMichael`, `73233465312634100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'Michael\'</span> <span class="token comment"># 动态给实例绑定一个属性</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>name<span class="token punctuation">)</span>\nMichael</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还可以尝试给实例绑定一个方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71366853824558785000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> def set_age(self, age): # 定义一个函数作为实例方法\n...     self.age = age\n...\n>>> from types import MethodType\n>>> s.set_age = MethodType(set_age, s) # 给实例绑定一个方法, 第二个参数作为 self 传入方法\n>>> s.set_age(25) # 调用实例方法\n>>> s.age # 测试结果\n25`, `71366853824558785000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">set_age</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 定义一个函数作为实例方法</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     self<span class="token punctuation">.</span>age <span class="token operator">=</span> age\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> types <span class="token keyword">import</span> MethodType\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>set_age <span class="token operator">=</span> MethodType<span class="token punctuation">(</span>set_age<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token comment"># 给实例绑定一个方法, 第二个参数作为 self 传入方法</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>set_age<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token comment"># 调用实例方法</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>age <span class="token comment"># 测试结果</span>\n<span class="token number">25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，给一个实例绑定的方法，对另一个实例是不起作用的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91400051843407430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s2 = Student() # 创建新的实例\n>>> s2.set_age(25) # 尝试调用方法\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nAttributeError: \'Student\' object has no attribute \'set_age\'`, `91400051843407430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s2 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 创建新的实例</span>\n<span class="token operator">>></span><span class="token operator">></span> s2<span class="token punctuation">.</span>set_age<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token comment"># 尝试调用方法</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'Student\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'set_age\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为了给所有实例都绑定方法，可以给 class 绑定方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16952168596391614000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> def set_score(self, score):\n...     self.score = score\n...\n>>> Student.set_score = set_score`, `16952168596391614000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">set_score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     self<span class="token punctuation">.</span>score <span class="token operator">=</span> score\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> Student<span class="token punctuation">.</span>set_score <span class="token operator">=</span> set_score</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>给 class 绑定方法后，所有实例均可调用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53147808325885280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s.set_score(100)\n>>> s.score\n100\n>>> s2.set_score(99)\n>>> s2.score\n99`, `53147808325885280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>set_score<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score\n<span class="token number">100</span>\n<span class="token operator">>></span><span class="token operator">></span> s2<span class="token punctuation">.</span>set_score<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s2<span class="token punctuation">.</span>score\n<span class="token number">99</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>通常情况下，上面的 set_score 方法可以直接定义在 class 中，但动态绑定允许我们在程序运行的过程中动态给 class 加上功能，这在静态语言中很难实现。</p>\n<h3 id="使用-__slots__-1"><a href="#%E4%BD%BF%E7%94%A8-__slots__-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 <code class="language-text">__slots__</code></h3>\n<p>但是，如果我们想要限制实例的属性怎么办？比如，只允许对 Student 实例添加 name 和 age 属性。</p>\n<p>为了达到限制的目的，Python 允许在定义 class 的时候，定义一个特殊的 <code class="language-text">__slots__</code> 变量，来限制该 class 实例能添加的属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60557600748626170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    __slots__ = (\'name\', \'age\') # 用 tuple 定义允许绑定的属性名称`, `60557600748626170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    __slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'age\'</span><span class="token punctuation">)</span> <span class="token comment"># 用 tuple 定义允许绑定的属性名称</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然后，我们试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41336480996774960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = Student() # 创建新的实例\n>>> s.name = \'Michael\' # 绑定属性 \'name\'\n>>> s.age = 25 # 绑定属性 \'age\'\n>>> s.score = 99 # 绑定属性 \'score\'\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nAttributeError: \'Student\' object has no attribute \'score\'`, `41336480996774960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 创建新的实例</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'Michael\'</span> <span class="token comment"># 绑定属性 \'name\'</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span> <span class="token comment"># 绑定属性 \'age\'</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">99</span> <span class="token comment"># 绑定属性 \'score\'</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'Student\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'score\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于 score 没有被放到 <code class="language-text">__slots__</code> 中，所以不能绑定 score 属性，试图绑定 score 将得到 AttributeError 的错误。</p>\n<p>使用 <code class="language-text">__slots__</code> 要注意，<code class="language-text">__slots__</code> 定义的属性仅对当前类实例起作用，对继承的子类是不起作用的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39703528293853995000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> class GraduateStudent(Student):\n...     pass\n...\n>>> g = GraduateStudent()\n>>> g.score = 9999`, `39703528293853995000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">GraduateStudent</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">pass</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> g <span class="token operator">=</span> GraduateStudent<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> g<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">9999</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>除非在子类中也定义 <code class="language-text">__slots__</code>，这样，子类实例允许定义的属性就是自身的 <code class="language-text">__slots__</code> 加上父类的 <code class="language-text">__slots__</code>。</p>\n<h2 id="使用-property"><a href="#%E4%BD%BF%E7%94%A8-property" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 @property</h2>\n<p>在绑定属性时，如果我们直接把属性暴露出去，虽然写起来很简单，但是，没办法检查参数，导致可以把成绩随便改：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60516945770068435000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`s = Student()\ns.score = 9999`, `60516945770068435000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\ns<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">9999</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这显然不合逻辑。为了限制 score 的范围，可以通过一个 <code class="language-text">set_score()</code> 方法来设置成绩，再通过一个 <code class="language-text">get_score()</code> 来获取成绩，这样，在 set_score() 方法里，就可以检查参数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3631840400360531000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def get_score(self):\n         return self._score\n\n    def set_score(self, value):\n        if not isinstance(value, int):\n            raise ValueError(\'score must be an integer!\')\n        if value < 0 or value > 100:\n            raise ValueError(\'score must between 0 ~ 100!\')\n        self._score = value`, `3631840400360531000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">get_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n         <span class="token keyword">return</span> self<span class="token punctuation">.</span>_score\n\n    <span class="token keyword">def</span> <span class="token function">set_score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'score must be an integer!\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> value <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">or</span> value <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'score must between 0 ~ 100!\'</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>_score <span class="token operator">=</span> value</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在，对任意的 Student 实例进行操作，就不能随心所欲地设置 score 了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76544661698798260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = Student()\n>>> s.set_score(60) # ok!\n>>> s.get_score()\n60\n>>> s.set_score(9999)\nTraceback (most recent call last):\n  ...\nValueError: score must between 0 ~ 100!`, `76544661698798260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>set_score<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token comment"># ok!</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>get_score<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">60</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>set_score<span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nValueError<span class="token punctuation">:</span> score must between <span class="token number">0</span> <span class="token operator">~</span> <span class="token number">100</span>!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，上面的调用方法又略显复杂，没有直接用属性这么直接简单。</p>\n<p>有没有既能检查参数，又可以用类似属性这样简单的方式来访问类的变量呢？对于追求完美的 Python 程序员来说，这是必须要做到的！</p>\n<p>还记得装饰器（decorator）可以给函数动态加上功能吗？对于类的方法，装饰器一样起作用。Python 内置的 @property 装饰器就是负责把一个方法变成属性调用的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55538211175960895000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    @property\n    def score(self):\n        return self._score\n\n    @score.setter\n    def score(self, value):\n        if not isinstance(value, int):\n            raise ValueError(\'score must be an integer!\')\n        if value < 0 or value > 100:\n            raise ValueError(\'score must between 0 ~ 100!\')\n        self._score = value`, `55538211175960895000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    @<span class="token builtin">property</span>\n    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_score\n\n    @score<span class="token punctuation">.</span>setter\n    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'score must be an integer!\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> value <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">or</span> value <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'score must between 0 ~ 100!\'</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>_score <span class="token operator">=</span> value</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>@property 的实现比较复杂，我们先考察如何使用。把一个 getter 方法变成属性，只需要加上 @property 就可以了，此时，@property 本身又创建了另一个装饰器 @score.setter，负责把一个 setter 方法变成属性赋值，于是，我们就拥有一个可控的属性操作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73927319568111350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = Student()\n>>> s.score = 60 # OK，实际转化为 s.set_score(60)\n>>> s.score # OK，实际转化为 s.get_score()\n60\n>>> s.score = 9999\nTraceback (most recent call last):\n  ...\nValueError: score must between 0 ~ 100!`, `73927319568111350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">60</span> <span class="token comment"># OK，实际转化为 s.set_score(60)</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score <span class="token comment"># OK，实际转化为 s.get_score()</span>\n<span class="token number">60</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">9999</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nValueError<span class="token punctuation">:</span> score must between <span class="token number">0</span> <span class="token operator">~</span> <span class="token number">100</span>!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意到这个神奇的 @property，我们在对实例属性操作的时候，就知道该属性很可能不是直接暴露的，而是通过 getter 和 setter 方法来实现的。</p>\n<p>还可以定义只读属性，只定义 getter 方法，不定义 setter 方法就是一个只读属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15879905821397400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    @property\n    def birth(self):\n        return self._birth\n\n    @birth.setter\n    def birth(self, value):\n        self._birth = value\n\n    @property\n    def age(self):\n        return 2015 - self._birth`, `15879905821397400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    @<span class="token builtin">property</span>\n    <span class="token keyword">def</span> <span class="token function">birth</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_birth\n\n    @birth<span class="token punctuation">.</span>setter\n    <span class="token keyword">def</span> <span class="token function">birth</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_birth <span class="token operator">=</span> value\n\n    @<span class="token builtin">property</span>\n    <span class="token keyword">def</span> <span class="token function">age</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token number">2015</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>_birth</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面的 birth 是可读写属性，而 age 就是一个只读属性，因为 age 可以根据 birth 和当前时间计算出来。</p>\n<p>要特别注意：属性的方法名不要和实例变量重名。例如，以下的代码是错误的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42072546643131850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    # 方法名称和实例变量均为 birth:\n    @property\n    def birth(self):\n        return self.birth`, `42072546643131850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token comment"># 方法名称和实例变量均为 birth:</span>\n    <span class="token decorator annotation punctuation">@property</span>\n    <span class="token keyword">def</span> <span class="token function">birth</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>birth</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是因为调用 s.birth 时，首先转换为方法调用，在执行 return self.birth 时，又视为访问 self 的属性，于是又转换为方法调用，造成无限递归，最终导致栈溢出报错 RecursionError。</p>\n<h3 id="小结-9"><a href="#%E5%B0%8F%E7%BB%93-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>@property 广泛应用在类的定义中，可以让调用者写出简短的代码，同时保证对参数进行必要的检查，这样，程序运行时就减少了出错的可能性。</p>\n<h2 id="多重继承"><a href="#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多重继承</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20689582456048350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Animal(object):\n    pass\n\n# 大类:\nclass Mammal(Animal):\n    pass\n\nclass Bird(Animal):\n    pass\n\n# 各种动物:\nclass Dog(Mammal):\n    pass\n\nclass Bat(Mammal):\n    pass\n\nclass Parrot(Bird):\n    pass\n\nclass Ostrich(Bird):\n    pass`, `20689582456048350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token comment"># 大类:</span>\n<span class="token keyword">class</span> <span class="token class-name">Mammal</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Bird</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token comment"># 各种动物:</span>\n<span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Mammal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Bat</span><span class="token punctuation">(</span>Mammal<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Parrot</span><span class="token punctuation">(</span>Bird<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Ostrich</span><span class="token punctuation">(</span>Bird<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在，我们要给动物再加上 Runnable 和 Flyable 的功能，只需要先定义好 Runnable 和 Flyable 的类：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15016920233900177000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Runnable(object):\n    def run(self):\n        print(\'Running...\')\n\nclass Flyable(object):\n    def fly(self):\n        print(\'Flying...\')`, `15016920233900177000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Running...\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Flyable</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">fly</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Flying...\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于需要 Runnable 功能的动物，就多继承一个 Runnable，例如 Dog：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91789769552044210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Dog(Mammal, Runnable):\n    pass`, `91789769552044210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Mammal<span class="token punctuation">,</span> Runnable<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>对于需要 Flyable 功能的动物，就多继承一个 Flyable，例如 Bat：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1155516525808764200"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Bat(Mammal, Flyable):\n    pass`, `1155516525808764200`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Bat</span><span class="token punctuation">(</span>Mammal<span class="token punctuation">,</span> Flyable<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>通过多重继承，一个子类就可以同时获得多个父类的所有功能。</p>\n<h3 id="mixin"><a href="#mixin" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MixIn</h3>\n<p>在设计类的继承关系时，通常，主线都是单一继承下来的，例如，Ostrich 继承自 Bird。但是，如果需要“混入”额外的功能，通过多重继承就可以实现，比如，让 Ostrich 除了继承自 Bird 外，再同时继承 Runnable。这种设计通常称之为 MixIn。</p>\n<p>为了更好地看出继承关系，我们把 Runnable 和 Flyable 改为 RunnableMixIn 和 FlyableMixIn。类似的，你还可以定义出肉食动物 CarnivorousMixIn 和植食动物 HerbivoresMixIn，让某个动物同时拥有好几个 MixIn：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90017571430217500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Dog(Mammal, RunnableMixIn, CarnivorousMixIn):\n    pass`, `90017571430217500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Mammal<span class="token punctuation">,</span> RunnableMixIn<span class="token punctuation">,</span> CarnivorousMixIn<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>MixIn 的目的就是给一个类增加多个功能，这样，在设计类的时候，我们优先考虑通过多重继承来组合多个 MixIn 的功能，而不是设计多层次的复杂的继承关系。</p>\n<p>Python 自带的很多库也使用了 MixIn。举个例子，Python 自带了 TCPServer 和 UDPServer 这两类网络服务，而要同时服务多个用户就必须使用多进程或多线程模型，这两种模型由 ForkingMixIn 和 ThreadingMixIn 提供。通过组合，我们就可以创造出合适的服务来。</p>\n<p>比如，编写一个多进程模式的 TCP 服务，定义如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54130072015120240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyTCPServer(TCPServer, ForkingMixIn):\n    pass`, `54130072015120240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyTCPServer</span><span class="token punctuation">(</span>TCPServer<span class="token punctuation">,</span> ForkingMixIn<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>编写一个多线程模式的 UDP 服务，定义如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5171592218201604000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyUDPServer(UDPServer, ThreadingMixIn):\n    pass`, `5171592218201604000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyUDPServer</span><span class="token punctuation">(</span>UDPServer<span class="token punctuation">,</span> ThreadingMixIn<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果你打算搞一个更先进的协程模型，可以编写一个 CoroutineMixIn：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85591110687498200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyTCPServer(TCPServer, CoroutineMixIn):\n    pass`, `85591110687498200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyTCPServer</span><span class="token punctuation">(</span>TCPServer<span class="token punctuation">,</span> CoroutineMixIn<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这样一来，我们不需要复杂而庞大的继承链，只要选择组合不同的类的功能，就可以快速构造出所需的子类。</p>\n<h3 id="小结-10"><a href="#%E5%B0%8F%E7%BB%93-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>由于 Python 允许使用多重继承，因此，MixIn 就是一种常见的设计。</p>\n<p>只允许单一继承的语言（如 Java）不能使用 MixIn 的设计。</p>\n<h2 id="定制类"><a href="#%E5%AE%9A%E5%88%B6%E7%B1%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>定制类</h2>\n<p>看到类似 <code class="language-text">__slots__</code> 这种形如 <code class="language-text">__xxx__</code> 的变量或者函数名就要注意，这些在 Python 中是有特殊用途的。</p>\n<p><code class="language-text">__slots__</code> 我们已经知道怎么用了，<code class="language-text">__len__()</code> 方法我们也知道是为了能让 class 作用于 len() 函数。</p>\n<p>除此之外，Python 的 class 中还有许多这样有特殊用途的函数，可以帮助我们定制类。</p>\n<h3 id="__str__"><a href="#__str__" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">__str__</code></h3>\n<p>我们先定义一个 Student 类，打印一个实例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85670853311697760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> class Student(object):\n...     def __init__(self, name):\n...         self.name = name\n...\n>>> print(Student(\'Michael\'))\n<__main__.Student object at 0x109afb190>`, `85670853311697760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>Student<span class="token punctuation">(</span><span class="token string">\'Michael\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>Student <span class="token builtin">object</span> at <span class="token number">0x109afb190</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>打印出一堆 <code class="language-text">&lt;__main__.Student object at 0x109afb190&gt;</code>，不好看。</p>\n<p>怎么才能打印得好看呢？只需要定义好 <code class="language-text">__str__()</code> 方法，返回一个好看的字符串就可以了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73441192756277670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> class Student(object):\n...     def __init__(self, name):\n...         self.name = name\n...     def __str__(self):\n...         return \'Student object (name: %s)\' % self.name\n...\n>>> print(Student(\'Michael\'))\nStudent object (name: Michael)`, `73441192756277670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">return</span> <span class="token string">\'Student object (name: %s)\'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>Student<span class="token punctuation">(</span><span class="token string">\'Michael\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nStudent <span class="token builtin">object</span> <span class="token punctuation">(</span>name<span class="token punctuation">:</span> Michael<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样打印出来的实例，不但好看，而且容易看出实例内部重要的数据。</p>\n<p>但是细心的朋友会发现直接敲变量不用 print，打印出来的实例还是不好看：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10943881105645060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = Student(\'Michael\')\n>>> s\n<__main__.Student object at 0x109afb310>`, `10943881105645060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Michael\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s\n<span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>Student <span class="token builtin">object</span> at <span class="token number">0x109afb310</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这是因为直接显示变量调用的不是 <code class="language-text">__str__()</code>，而是 <code class="language-text">__repr__()</code>，两者的区别是 <code class="language-text">__str__()</code> 返回用户看到的字符串，而 <code class="language-text">__repr__()</code> 返回程序开发者看到的字符串，也就是说，<code class="language-text">__repr__()</code> 是为调试服务的。</p>\n<p>解决办法是再定义一个 <code class="language-text">__repr__()</code>。但是通常 <code class="language-text">__str__()</code> 和 <code class="language-text">__repr__()</code> 代码都是一样的，所以，有个偷懒的写法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57327378600567940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    def __init__(self, name):\n        self.name = name\n    def __str__(self):\n        return \'Student object (name=%s)\' % self.name\n    __repr__ = __str__`, `57327378600567940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token string">\'Student object (name=%s)\'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name\n    __repr__ <span class="token operator">=</span> __str__</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="__iter__"><a href="#__iter__" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">__iter__</code></h3>\n<p>如果一个类想被用于 for … in 循环，类似 list 或 tuple 那样，就必须实现一个 <code class="language-text">__iter__()</code> 方法，该方法返回一个迭代对象，然后，Python 的 for 循环就会不断调用该迭代对象的 <code class="language-text">__next__()</code> 方法拿到循环的下一个值，直到遇到 StopIteration 错误时退出循环。</p>\n<p>我们以斐波那契数列为例，写一个 Fib 类，可以作用于 for 循环：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4696517202821893000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Fib(object):\n    def __init__(self):\n        self.a, self.b = 0, 1 # 初始化两个计数器 a，b\n\n    def __iter__(self):\n        return self # 实例本身就是迭代对象，故返回自己\n\n    def __next__(self):\n        self.a, self.b = self.b, self.a + self.b # 计算下一个值\n        if self.a > 100000: # 退出循环的条件\n            raise StopIteration()\n        return self.a # 返回下一个值`, `4696517202821893000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment"># 初始化两个计数器 a，b</span>\n\n    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self <span class="token comment"># 实例本身就是迭代对象，故返回自己</span>\n\n    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> self<span class="token punctuation">.</span>b<span class="token punctuation">,</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b <span class="token comment"># 计算下一个值</span>\n        <span class="token keyword">if</span> self<span class="token punctuation">.</span>a <span class="token operator">></span> <span class="token number">100000</span><span class="token punctuation">:</span> <span class="token comment"># 退出循环的条件</span>\n            <span class="token keyword">raise</span> StopIteration<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>a <span class="token comment"># 返回下一个值</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在，试试把 Fib 实例作用于 for 循环：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57280064821035760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> for n in Fib():\n...     print(n)\n...\n1\n1\n2\n3\n5\n...\n46368\n75025`, `57280064821035760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> n <span class="token keyword">in</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">2</span>\n<span class="token number">3</span>\n<span class="token number">5</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token number">46368</span>\n<span class="token number">75025</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="__getitem__"><a href="#__getitem__" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">__getitem__</code></h3>\n<p>Fib 实例虽然能作用于 for 循环，看起来和 list 有点像，但是，把它当成 list 来使用还是不行，比如，取第 5 个元素：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82464859929032080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> Fib()[5]\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nTypeError: \'Fib\' object does not support indexing`, `82464859929032080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nTypeError<span class="token punctuation">:</span> <span class="token string">\'Fib\'</span> <span class="token builtin">object</span> does <span class="token keyword">not</span> support indexing</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要表现得像 list 那样按照下标取出元素，需要实现 <code class="language-text">__getitem__()</code> 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30888224216905050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Fib(object):\n    def __getitem__(self, n):\n        a, b = 1, 1\n        for x in range(n):\n            a, b = b, a + b\n        return a`, `30888224216905050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>\n        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b\n        <span class="token keyword">return</span> a</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在，就可以按下标访问数列的任意一项了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15748600156540783000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = Fib()\n>>> f[0]\n1\n>>> f[1]\n1\n>>> f[2]\n2\n>>> f[3]\n3\n>>> f[10]\n89\n>>> f[100]\n573147844013817084101`, `15748600156540783000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\n<span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token number">2</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token number">3</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>\n<span class="token number">89</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span>\n<span class="token number">573147844013817084101</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是 list 有个神奇的切片方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91402303179076960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> list(range(100))[5:10]\n[5, 6, 7, 8, 9]`, `91402303179076960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>对于 Fib 却报错。原因是 <code class="language-text">__getitem__()</code> 传入的参数可能是一个 int，也可能是一个切片对象 slice，所以要做判断：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17244938723510116000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Fib(object):\n    def __getitem__(self, n):\n        if isinstance(n, int): # n 是索引\n            a, b = 1, 1\n            for x in range(n):\n                a, b = b, a + b\n            return a\n        if isinstance(n, slice): # n 是切片\n            start = n.start\n            stop = n.stop\n            if start is None:\n                start = 0\n            a, b = 1, 1\n            L = []\n            for x in range(stop):\n                if x >= start:\n                    L.append(a)\n                a, b = b, a + b\n            return L`, `17244938723510116000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># n 是索引</span>\n            a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>\n            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n                a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b\n            <span class="token keyword">return</span> a\n        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token builtin">slice</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># n 是切片</span>\n            start <span class="token operator">=</span> n<span class="token punctuation">.</span>start\n            stop <span class="token operator">=</span> n<span class="token punctuation">.</span>stop\n            <span class="token keyword">if</span> start <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n                start <span class="token operator">=</span> <span class="token number">0</span>\n            a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>\n            L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span><span class="token punctuation">:</span>\n                <span class="token keyword">if</span> x <span class="token operator">>=</span> start<span class="token punctuation">:</span>\n                    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a<span class="token punctuation">)</span>\n                a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b\n            <span class="token keyword">return</span> L</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在试试 Fib 的切片：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26052701676164450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = Fib()\n>>> f[0:5]\n[1, 1, 2, 3, 5]\n>>> f[:10]\n[1, 1, 2, 3, 5, 8, 13, 21, 34, 55]`, `26052701676164450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是没有对 step 参数作处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55114772760061580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f[:10:2]\n[1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89]`, `55114772760061580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>也没有对负数作处理，所以，要正确实现一个 <code class="language-text">__getitem__()</code> 还是有很多工作要做的。</p>\n<p>此外，如果把对象看成 dict，<code class="language-text">__getitem__()</code> 的参数也可能是一个可以作 key 的 object，例如 str。</p>\n<p>与之对应的是 <code class="language-text">__setitem__()</code> 方法，把对象视作 list 或 dict 来对集合赋值。最后，还有一个 <code class="language-text">__delitem__()</code> 方法，用于删除某个元素。</p>\n<p>总之，通过上面的方法，我们自己定义的类表现得和 Python 自带的 list、tuple、dict 没什么区别，这完全归功于动态语言的“鸭子类型”，不需要强制继承某个接口。</p>\n<h3 id="__getattr__"><a href="#__getattr__" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">__getattr__</code></h3>\n<p>正常情况下，当我们调用类的方法或属性时，如果不存在，就会报错。比如定义 Student 类：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29002821672751210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def __init__(self):\n        self.name = \'Michael\'`, `29002821672751210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'Michael\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调用 name 属性，没问题，但是，调用不存在的 score 属性，就有问题了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20639449000905000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = Student()\n>>> print(s.name)\nMichael\n>>> print(s.score)\nTraceback (most recent call last):\n  ...\nAttributeError: \'Student\' object has no attribute \'score\'`, `20639449000905000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>name<span class="token punctuation">)</span>\nMichael\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>score<span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'Student\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'score\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>错误信息很清楚地告诉我们，没有找到 score 这个 attribute。</p>\n<p>要避免这个错误，除了可以加上一个 score 属性外，Python 还有另一个机制，那就是写一个 <code class="language-text">__getattr__()</code> 方法，动态返回一个属性。修改如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47031957664580900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def __init__(self):\n        self.name = \'Michael\'\n\n    def __getattr__(self, attr):\n        if attr==\'score\':\n            return 99`, `47031957664580900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'Michael\'</span>\n\n    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> attr<span class="token operator">==</span><span class="token string">\'score\'</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token number">99</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当调用不存在的属性时，比如 score，Python 解释器会试图调用 <code class="language-text">__getattr__(self, &#39;score&#39;)</code> 来尝试获得属性，这样，我们就有机会返回 score 的值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25403012185000473000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def __init__(self):\n        self.name = \'Michael\'\n\n    def __getattr__(self, attr):\n        if attr==\'score\':\n            return 99`, `25403012185000473000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'Michael\'</span>\n\n    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> attr<span class="token operator">==</span><span class="token string">\'score\'</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token number">99</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当调用不存在的属性时，比如 score，Python 解释器会试图调用 <code class="language-text">__getattr__(self, &#39;score&#39;)</code> 来尝试获得属性，这样，我们就有机会返回 score 的值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56107279501712970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = Student()\n>>> s.name\n\'Michael\'\n>>> s.score\n99`, `56107279501712970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>name\n<span class="token string">\'Michael\'</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>score\n<span class="token number">99</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>返回函数也是完全可以的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39476044822284665000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def __getattr__(self, attr):\n        if attr==\'age\':\n            return lambda: 25`, `39476044822284665000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> attr<span class="token operator">==</span><span class="token string">\'age\'</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token number">25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只是调用方式要变为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61172596015457526000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s.age()\n25`, `61172596015457526000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">.</span>age<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token number">25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>注意，只有在没有找到属性的情况下，才调用 <code class="language-text">__getattr__</code>，已有的属性，比如 name，不会在 <code class="language-text">__getattr__</code> 中查找。</p>\n<p>此外，注意到任意调用如 s.abc 都会返回 None，这是因为我们定义的 <code class="language-text">__getattr__</code> 默认返回就是 None。要让 class 只响应特定的几个属性，我们就要按照约定，抛出 AttributeError 的错误：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76389714354609460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n\n    def __getattr__(self, attr):\n        if attr==\'age\':\n            return lambda: 25\n        raise AttributeError(\'\\\'Student\\\' object has no attribute \\\'%s\\\'\' % attr)`, `76389714354609460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> attr<span class="token operator">==</span><span class="token string">\'age\'</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token number">25</span>\n        <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">\'\\\'Student\\\' object has no attribute \\\'%s\\\'\'</span> <span class="token operator">%</span> attr<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这实际上可以把一个类的所有属性和方法调用全部动态化处理了，不需要任何特殊手段。</p>\n<p>这种完全动态调用的特性有什么实际作用呢？作用就是，可以针对完全动态的情况作调用。</p>\n<p>举个例子：</p>\n<p>现在很多网站都搞 REST API，比如新浪微博、豆瓣啥的，调用 API 的 URL 类似：</p>\n<ul>\n<li><code class="language-text">http://api.server/user/friends</code></li>\n<li><code class="language-text">http://api.server/user/timeline/list</code></li>\n</ul>\n<p>如果要写 SDK，给每个 URL 对应的 API 都写一个方法，那得累死，而且，API 一旦改动，SDK 也要改。</p>\n<p>利用完全动态的 <code class="language-text">__getattr__</code>，我们可以写出一个链式调用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17848174633278636000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Chain(object):\n\n    def __init__(self, path=\'\'):\n        self._path = path\n\n    def __getattr__(self, path):\n        return Chain(\'%s/%s\' % (self._path, path))\n\n    def __str__(self):\n        return self._path\n\n    __repr__ = __str__`, `17848174633278636000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token operator">=</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_path <span class="token operator">=</span> path\n\n    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">\'%s/%s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_path<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_path\n\n    __repr__ <span class="token operator">=</span> __str__</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22181687690537923000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> Chain().status.user.timeline.list\n\'/status/user/timeline/list\'`, `22181687690537923000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> Chain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>status<span class="token punctuation">.</span>user<span class="token punctuation">.</span>timeline<span class="token punctuation">.</span><span class="token builtin">list</span>\n<span class="token string">\'/status/user/timeline/list\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这样，无论 API 怎么变，SDK 都可以根据 URL 实现完全动态的调用，而且，不随 API 的增加而改变！</p>\n<p>还有些 REST API 会把参数放到 URL 中，比如 GitHub 的 API：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78537354067381010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`GET /users/:user/repos`, `78537354067381010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">GET /users/:user/repos</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>调用时，需要把 :user 替换为实际用户名。如果我们能写出这样的链式调用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65433565899325540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Chain().users(\'michael\').repos`, `65433565899325540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">Chain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>users<span class="token punctuation">(</span><span class="token string">\'michael\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repos</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>就可以非常方便地调用 API 了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42664498836289380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Chain(object):\n    def __init__(self, path=\'\'):\n       self.__path = path\n\n   def __getattr__(self, path):\n       return Chain(\'%s/%s\' % (self.__path, path))\n\n   def __call__(self, path):\n       return Chain(\'%s/%s\' % (self.__path, path))\n\n   def __str__(self):\n       return self.__path\n\n   __repr__ = __str__\n\nprint(Chain().users(\'michael\').repos) # /users/michael/repos`, `42664498836289380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token operator">=</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n       self<span class="token punctuation">.</span>__path <span class="token operator">=</span> path\n\n   <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n       <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">\'%s/%s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__path<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n   <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n       <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">\'%s/%s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__path<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n   <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n       <span class="token keyword">return</span> self<span class="token punctuation">.</span>__path\n\n   __repr__ <span class="token operator">=</span> __str__\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>Chain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>users<span class="token punctuation">(</span><span class="token string">\'michael\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repos<span class="token punctuation">)</span> <span class="token comment"># /users/michael/repos</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="__call__"><a href="#__call__" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">__call__</code></h3>\n<p>一个对象实例可以有自己的属性和方法，当我们调用实例方法时，我们用 instance.method() 来调用。能不能直接在实例本身上调用呢？在 Python 中，答案是肯定的。</p>\n<p>任何类，只需要定义一个 <code class="language-text">__call__()</code> 方法，就可以直接对实例进行调用。请看示例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38401187857266450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Student(object):\n    def __init__(self, name):\n        self.name = name\n\n    def __call__(self):\n        print(\'My name is %s.\' % self.name)`, `38401187857266450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n\n    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'My name is %s.\'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调用方式如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78606551564025760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> s = Student(\'Michael\')\n>>> s() # self 参数不要传入\nMy name is Michael.`, `78606551564025760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Michael\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> s<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># self 参数不要传入</span>\nMy name <span class="token keyword">is</span> Michael<span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">__call__()</code> 还可以定义参数。对实例进行直接调用就好比对一个函数进行调用一样，所以你完全可以把对象看成函数，把函数看成对象，因为这两者之间本来就没啥根本的区别。</p>\n<p>如果你把对象看成函数，那么函数本身其实也可以在运行期动态创建出来，因为类的实例都是运行期创建出来的，这么一来，我们就模糊了对象和函数的界限。</p>\n<p>那么，怎么判断一个变量是对象还是函数呢？其实，更多的时候，我们需要判断一个对象是否能被调用，能被调用的对象就是一个 Callable 对象，比如函数和我们上面定义的带有 <code class="language-text">__call__()</code> 的类实例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70161786947332350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> callable(Student())\nTrue\n>>> callable(max)\nTrue\n>>> callable([1, 2, 3])\nFalse\n>>> callable(None)\nFalse\n>>> callable(\'str\')\nFalse`, `70161786947332350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">callable</span><span class="token punctuation">(</span>Student<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">callable</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">)</span>\n<span class="token boolean">True</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">callable</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token boolean">False</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">callable</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>\n<span class="token boolean">False</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">callable</span><span class="token punctuation">(</span><span class="token string">\'str\'</span><span class="token punctuation">)</span>\n<span class="token boolean">False</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>通过 callable() 函数，我们就可以判断一个对象是否是“可调用”对象。</p>\n<h3 id="小结-11"><a href="#%E5%B0%8F%E7%BB%93-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>Python 的 class 允许定义许多定制方法，可以让我们非常方便地生成特定的类。</p>\n<h2 id="使用元类"><a href="#%E4%BD%BF%E7%94%A8%E5%85%83%E7%B1%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用元类</h2>\n<h3 id="type"><a href="#type" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>type()</h3>\n<p>动态语言和静态语言最大的不同，就是函数和类的定义，不是编译时定义的，而是运行时动态创建的。</p>\n<p>比方说我们要定义一个 Hello 的 class，就写一个 hello.py 模块：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76798101073698980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Hello(object):\n    def hello(self, name=\'world\'):\n        print(\'Hello, %s.\' % name)`, `76798101073698980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'world\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello, %s.\'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当 Python 解释器载入 hello 模块时，就会依次执行该模块的所有语句，执行结果就是动态创建出一个 Hello 的 class 对象，测试如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53443807859743410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> from hello import Hello\n>>> h = Hello()\n>>> h.hello()\nHello, world.\n>>> print(type(Hello))\n<class \'type\'>\n>>> print(type(h))\n<class \'hello.Hello\'>`, `53443807859743410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> hello <span class="token keyword">import</span> Hello\n<span class="token operator">>></span><span class="token operator">></span> h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> h<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span>\nHello<span class="token punctuation">,</span> world<span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Hello<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'type\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'hello.Hello\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>type() 函数可以查看一个类型或变量的类型，Hello 是一个 class，它的类型就是 type，而 h 是一个实例，它的类型就是 class Hello。</p>\n<p>我们说 class 的定义是运行时动态创建的，而创建 class 的方法就是使用 type() 函数。</p>\n<p>type() 函数既可以返回一个对象的类型，又可以创建出新的类型，比如，我们可以通过 type() 函数创建出 Hello 类，而无需通过 class Hello(object)… 的定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6501445617614410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> def fn(self, name=\'world\'): # 先定义函数\n...     print(\'Hello, %s.\' % name)\n...\n>>> Hello = type(\'Hello\', (object,), dict(hello=fn)) # 创建 Hello class\n>>> h = Hello()\n>>> h.hello()\nHello, world.\n>>> print(type(Hello))\n<class \'type\'>\n>>> print(type(h))\n<class \'__main__.Hello\'>`, `6501445617614410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'world\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 先定义函数</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello, %s.\'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> Hello <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'Hello\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>hello<span class="token operator">=</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 创建 Hello class</span>\n<span class="token operator">>></span><span class="token operator">></span> h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> h<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span>\nHello<span class="token punctuation">,</span> world<span class="token punctuation">.</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>Hello<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'type\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">\'__main__.Hello\'</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要创建一个 class 对象，type() 函数依次传入 3 个参数：</p>\n<ol>\n<li>class 的名称；</li>\n<li>继承的父类集合，注意 Python 支持多重继承，如果只有一个父类，别忘了 tuple 的单元素写法；</li>\n<li>class 的方法名称与函数绑定，这里我们把函数 fn 绑定到方法名 hello 上。</li>\n</ol>\n<p>通过 type() 函数创建的类和直接写 class 是完全一样的，因为 Python 解释器遇到 class 定义时，仅仅是扫描一下 class 定义的语法，然后调用 type() 函数创建出 class。</p>\n<p>正常情况下，我们都用 class Xxx… 来定义类，但是，type() 函数也允许我们动态创建出类来，也就是说，动态语言本身支持运行期动态创建类，这和静态语言有非常大的不同，要在静态语言运行期创建类，必须构造源代码字符串再调用编译器，或者借助一些工具生成字节码实现，本质上都是动态编译，会非常复杂。</p>\n<h3 id="metaclass"><a href="#metaclass" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>metaclass</h3>\n<p>除了使用 type() 动态创建类以外，要控制类的创建行为，还可以使用 metaclass。</p>\n<p>metaclass，直译为元类，简单的解释就是：</p>\n<p>当我们定义了类以后，就可以根据这个类创建出实例，所以先定义类，然后创建实例。</p>\n<p>但是如果我们想创建出类呢？那就必须根据 metaclass 创建出类，所以先定义 metaclass，然后创建类。</p>\n<p>连接起来就是：先定义 metaclass，就可以创建类，最后创建实例。</p>\n<p>所以，metaclass 允许你创建类或者修改类。换句话说，你可以把类看成是 metaclass 创建出来的“实例”。</p>\n<p>metaclass 是 Python 面向对象里最难理解，也是最难使用的魔术代码。正常情况下，你不会碰到需要使用 metaclass 的情况，所以，以下内容看不懂也没关系，因为基本上你不会用到。</p>\n<p>我们先看一个简单的例子，这个 metaclass 可以给我们自定义的 MyList 增加一个 add 方法：</p>\n<p>定义 ListMetaclass，按照默认习惯，metaclass 的类名总是以 Metaclass 结尾，以便清楚地表示这是一个 metaclass：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82557473794295730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# metaclass 是类的模板，所以必须从 \\`type\\` 类型派生：\nclass ListMetaclass(type):\n    def __new__(cls, name, bases, attrs):\n        attrs[\'add\'] = lambda self, value: self.append(value)\n        return type.__new__(cls, name, bases, attrs)`, `82557473794295730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># metaclass 是类的模板，所以必须从 `type` 类型派生：</span>\n<span class="token keyword">class</span> <span class="token class-name">ListMetaclass</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        attrs<span class="token punctuation">[</span><span class="token string">\'add\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">lambda</span> self<span class="token punctuation">,</span> value<span class="token punctuation">:</span> self<span class="token punctuation">.</span>append<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有了 ListMetaclass，我们在定义类的时候还要指示使用 ListMetaclass 来定制类，传入关键字参数 metaclass：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71715867863085520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyList(list, metaclass=ListMetaclass):\n    pass`, `71715867863085520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>ListMetaclass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>当我们传入关键字参数 metaclass 时，魔术就生效了，它指示 Python 解释器在创建 MyList 时，要通过 <code class="language-text">ListMetaclass.__new__()</code> 来创建，在此，我们可以修改类的定义，比如，加上新的方法，然后，返回修改后的定义。</p>\n<p><code class="language-text">__new__()</code> 方法接收到的参数依次是：</p>\n<ol>\n<li>当前准备创建的类的对象；</li>\n<li>类的名字；</li>\n<li>类继承的父类集合；</li>\n<li>类的方法集合。</li>\n</ol>\n<p>测试一下 MyList 是否可以调用 add() 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61431233112063070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L = MyList()\n>>> L.add(1)\n>> L\n[1]`, `61431233112063070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L <span class="token operator">=</span> MyList<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> L<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token operator">>></span> L\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而普通的 list 没有 add() 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43213802122079970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> L2 = list()\n>>> L2.add(1)\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nAttributeError: \'list\' object has no attribute \'add\'`, `43213802122079970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> L2 <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> L2<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nAttributeError<span class="token punctuation">:</span> <span class="token string">\'list\'</span> <span class="token builtin">object</span> has no attribute <span class="token string">\'add\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>动态修改有什么意义？直接在 MyList 定义中写上 add() 方法不是更简单吗？正常情况下，确实应该直接写，通过 metaclass 修改纯属变态。</p>\n<p>但是，总会遇到需要通过 metaclass 修改类定义的。ORM 就是一个典型的例子。</p>\n<p>ORM 全称 “Object Relational Mapping”，即对象-关系映射，就是把关系数据库的一行映射为一个对象，也就是一个类对应一个表，这样，写代码更简单，不用直接操作 SQL 语句。</p>\n<p>要编写一个 ORM 框架，所有的类都只能动态定义，因为只有使用者才能根据表的结构定义出对应的类来。</p>\n<p>让我们来尝试编写一个 ORM 框架。</p>\n<p>编写底层模块的第一步，就是先把调用接口写出来。比如，使用者如果使用这个 ORM 框架，想定义一个 User 类来操作对应的数据库表 User，我们期待他写出这样的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52049777056516250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class User(Model):\n    # 定义类的属性到列的映射：\n    id = IntegerField(\'id\')\n    name = StringField(\'username\')\n    email = StringField(\'email\')\n    password = StringField(\'password\')\n\n# 创建一个实例：\nu = User(id=12345, name=\'Michael\', email=\'test@orm.org\', password=\'my-pwd\')\n# 保存到数据库：\nu.save()`, `52049777056516250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># 定义类的属性到列的映射：</span>\n    <span class="token builtin">id</span> <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span><span class="token string">\'id\'</span><span class="token punctuation">)</span>\n    name <span class="token operator">=</span> StringField<span class="token punctuation">(</span><span class="token string">\'username\'</span><span class="token punctuation">)</span>\n    email <span class="token operator">=</span> StringField<span class="token punctuation">(</span><span class="token string">\'email\'</span><span class="token punctuation">)</span>\n    password <span class="token operator">=</span> StringField<span class="token punctuation">(</span><span class="token string">\'password\'</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 创建一个实例：</span>\nu <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">12345</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token string">\'test@orm.org\'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">\'my-pwd\'</span><span class="token punctuation">)</span>\n<span class="token comment"># 保存到数据库：</span>\nu<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，父类 Model 和属性类型 StringField、IntegerField 是由 ORM 框架提供的，剩下的魔术方法比如 save() 全部由父类 Model 自动完成。虽然 metaclass 的编写会比较复杂，但 ORM 的使用者用起来却异常简单。</p>\n<p>现在，我们就按上面的接口来实现该 ORM。</p>\n<p>首先来定义 Field 类，它负责保存数据库表的字段名和字段类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53617556956974236000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Field(object):\n\n    def __init__(self, name, column_type):\n        self.name = name\n        self.column_type = column_type\n\n    def __str__(self):\n        return \'<%s:%s>\' % (self.__class__.__name__, self.name)`, `53617556956974236000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Field</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> column_type<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>column_type <span class="token operator">=</span> column_type\n\n    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token string">\'&lt;%s:%s>\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 Field 的基础上，进一步定义各种类型的 Field，比如 StringField，IntegerField 等等：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64925841886406040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class StringField(Field):\n\n    def __init__(self, name):\n        super(StringField, self).__init__(name, \'varchar(100)\')\n\nclass IntegerField(Field):\n\n    def __init__(self, name):\n        super(IntegerField, self).__init__(name, \'bigint\')`, `64925841886406040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">StringField</span><span class="token punctuation">(</span>Field<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span>StringField<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">\'varchar(100)\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">class</span> <span class="token class-name">IntegerField</span><span class="token punctuation">(</span>Field<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span>IntegerField<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">\'bigint\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下一步，就是编写最复杂的 ModelMetaclass 了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7711792171274556000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ModelMetaclass(type):\n\n    def __new__(cls, name, bases, attrs):\n        if name==\'Model\':\n            return type.__new__(cls, name, bases, attrs)\n        print(\'Found model: %s\' % name)\n        mappings = dict()\n        for k, v in attrs.items():\n            if isinstance(v, Field):\n                print(\'Found mapping: %s ==> %s\' % (k, v))\n                mappings[k] = v\n        for k in mappings.keys():\n            attrs.pop(k)\n        attrs[\'__mappings__\'] = mappings # 保存属性和列的映射关系\n        attrs[\'__table__\'] = name # 假设表名和类名一致\n        return type.__new__(cls, name, bases, attrs)`, `7711792171274556000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">ModelMetaclass</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> name<span class="token operator">==</span><span class="token string">\'Model\'</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Found model: %s\'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span>\n        mappings <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> attrs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> Field<span class="token punctuation">)</span><span class="token punctuation">:</span>\n                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Found mapping: %s ==> %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>\n                mappings<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v\n        <span class="token keyword">for</span> k <span class="token keyword">in</span> mappings<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            attrs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>k<span class="token punctuation">)</span>\n        attrs<span class="token punctuation">[</span><span class="token string">\'__mappings__\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> mappings <span class="token comment"># 保存属性和列的映射关系</span>\n        attrs<span class="token punctuation">[</span><span class="token string">\'__table__\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> name <span class="token comment"># 假设表名和类名一致</span>\n        <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以及基类 Model：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56493605410050530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Model(dict, metaclass=ModelMetaclass):\n\n    def __init__(self, **kw):\n        super(Model, self).__init__(**kw)\n\n    def __getattr__(self, key):\n        try:\n            return self[key]\n        except KeyError:\n            raise AttributeError(r&quot;\'Model\' object has no attribute \'%s\'&quot; % key)\n\n    def __setattr__(self, key, value):\n        self[key] = value\n\n    def save(self):\n        fields = []\n        params = []\n        args = []\n        for k, v in self.__mappings__.items():\n            fields.append(v.name)\n            params.append(\'?\')\n            args.append(getattr(self, k, None))\n        sql = \'insert into %s (%s) values (%s)\' % (self.__table__, \',\'.join(fields), \',\'.join(params))\n        print(\'SQL: %s\' % sql)\n        print(\'ARGS: %s\' % str(args))`, `56493605410050530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>ModelMetaclass<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span>Model<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kw<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">[</span>key<span class="token punctuation">]</span>\n        <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">r"\'Model\' object has no attribute \'%s\'"</span> <span class="token operator">%</span> key<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">__setattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value\n\n    <span class="token keyword">def</span> <span class="token function">save</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> self<span class="token punctuation">.</span>__mappings__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            fields<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v<span class="token punctuation">.</span>name<span class="token punctuation">)</span>\n            params<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">\'?\'</span><span class="token punctuation">)</span>\n            args<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> k<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        sql <span class="token operator">=</span> <span class="token string">\'insert into %s (%s) values (%s)\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>__table__<span class="token punctuation">,</span> <span class="token string">\',\'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>fields<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\',\'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'SQL: %s\'</span> <span class="token operator">%</span> sql<span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'ARGS: %s\'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当用户定义一个 class User(Model) 时，Python 解释器首先在当前类 User 的定义中查找 metaclass，如果没有找到，就继续在父类 Model 中查找 metaclass，找到了，就使用 Model 中定义的 metaclass 的 ModelMetaclass 来创建 User 类，也就是说，metaclass 可以隐式地继承到子类，但子类自己却感觉不到。</p>\n<p>在 ModelMetaclass 中，一共做了几件事情：</p>\n<ol>\n<li>排除掉对 Model 类的修改；</li>\n<li>在当前类（比如 User）中查找定义的类的所有属性，如果找到一个 Field 属性，就把它保存到一个 <code class="language-text">__mappings__</code> 的 dict 中，同时从类属性中删除该 Field 属性，否则，容易造成运行时错误（实例的属性会遮盖类的同名属性）；</li>\n<li>把表名保存到 <code class="language-text">__table__</code> 中，这里简化为表名默认为类名。</li>\n</ol>\n<p>在 Model 类中，就可以定义各种操作数据库的方法，比如 save()，delete()，find()，update() 等等。</p>\n<p>我们实现了 save() 方法，把一个实例保存到数据库中。因为有表名，属性到字段的映射和属性值的集合，就可以构造出 INSERT 语句。</p>\n<p>编写代码试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29330196407373110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`u = User(id=12345, name=\'Michael\', email=\'test@orm.org\', password=\'my-pwd\')\nu.save()`, `29330196407373110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">u <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">12345</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'Michael\'</span><span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token string">\'test@orm.org\'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">\'my-pwd\'</span><span class="token punctuation">)</span>\nu<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>输出如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38675806295610670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Found model: User\nFound mapping: email ==> <StringField:email>\nFound mapping: password ==> <StringField:password>\nFound mapping: id ==> <IntegerField:uid>\nFound mapping: name ==> <StringField:username>\nSQL: insert into User (password,email,username,id) values (?,?,?,?)\nARGS: [\'my-pwd\', \'test@orm.org\', \'Michael\', 12345]`, `38675806295610670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">Found model<span class="token punctuation">:</span> User\nFound mapping<span class="token punctuation">:</span> email <span class="token operator">==</span><span class="token operator">></span> <span class="token operator">&lt;</span>StringField<span class="token punctuation">:</span>email<span class="token operator">></span>\nFound mapping<span class="token punctuation">:</span> password <span class="token operator">==</span><span class="token operator">></span> <span class="token operator">&lt;</span>StringField<span class="token punctuation">:</span>password<span class="token operator">></span>\nFound mapping<span class="token punctuation">:</span> <span class="token builtin">id</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token operator">&lt;</span>IntegerField<span class="token punctuation">:</span>uid<span class="token operator">></span>\nFound mapping<span class="token punctuation">:</span> name <span class="token operator">==</span><span class="token operator">></span> <span class="token operator">&lt;</span>StringField<span class="token punctuation">:</span>username<span class="token operator">></span>\nSQL<span class="token punctuation">:</span> insert into User <span class="token punctuation">(</span>password<span class="token punctuation">,</span>email<span class="token punctuation">,</span>username<span class="token punctuation">,</span><span class="token builtin">id</span><span class="token punctuation">)</span> values <span class="token punctuation">(</span>?<span class="token punctuation">,</span>?<span class="token punctuation">,</span>?<span class="token punctuation">,</span>?<span class="token punctuation">)</span>\nARGS<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'my-pwd\'</span><span class="token punctuation">,</span> <span class="token string">\'test@orm.org\'</span><span class="token punctuation">,</span> <span class="token string">\'Michael\'</span><span class="token punctuation">,</span> <span class="token number">12345</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，save() 方法已经打印出了可执行的 SQL 语句，以及参数列表，只需要真正连接到数据库，执行该 SQL 语句，就可以完成真正的功能。</p>\n<p>不到 100 行代码，我们就通过 metaclass 实现了一个精简的 ORM 框架，是不是非常简单？</p>\n<h3 id="小结-12"><a href="#%E5%B0%8F%E7%BB%93-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>metaclass 是 Python 中非常具有魔术性的对象，它可以改变类创建时的行为。这种强大的功能使用起来务必小心。</p>\n<h1 id="错误、调试和测试"><a href="#%E9%94%99%E8%AF%AF%E3%80%81%E8%B0%83%E8%AF%95%E5%92%8C%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>错误、调试和测试</h1>\n<h2 id="错误处理"><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>错误处理</h2>\n<h3 id="try"><a href="#try" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>try</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31897244406027104000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`try:\n    print(\'try...\')\n    r = 10 / 0\n    print(\'result:\', r)\nexcept ZeroDivisionError as e:\n    print(\'except:\', e)\nfinally:\n    print(\'finally...\')\nprint(\'END\')`, `31897244406027104000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'try...\'</span><span class="token punctuation">)</span>\n    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'result:\'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>\n<span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'except:\'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'finally...\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'END\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当我们认为某些代码可能会出错时，就可以用 try 来运行这段代码，如果执行出错，则后续代码不会继续执行，而是直接跳转至错误处理代码，即 except 语句块，执行完 except 后，如果有 finally 语句块，则执行 finally 语句块，至此，执行完毕。</p>\n<p>上面的代码在计算 10 / 0 时会产生一个除法运算错误：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21672722588947480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`try...\nexcept: division by zero\nfinally...\nEND`, `21672722588947480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token keyword">except</span><span class="token punctuation">:</span> division by zero\n<span class="token keyword">finally</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nEND</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从输出可以看到，当错误发生时，后续语句 <code class="language-text">print(&#39;result:&#39;, r)</code> 不会被执行，except 由于捕获到 ZeroDivisionError，因此被执行。最后，finally 语句被执行。然后，程序继续按照流程往下走。</p>\n<p>如果把除数 0 改成 2，则执行结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65055021831665250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`try...\nresult: 5\nfinally...\nEND`, `65055021831665250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nresult<span class="token punctuation">:</span> <span class="token number">5</span>\n<span class="token keyword">finally</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nEND</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于没有错误发生，所以 except 语句块不会被执行，但是 finally 如果有，则一定会被执行（可以没有 finally 语句）。</p>\n<p>你还可以猜测，错误应该有很多种类，如果发生了不同类型的错误，应该由不同的 except 语句块处理。没错，可以有多个 except 来捕获不同类型的错误：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37778473863919034000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`try:\n    print(\'try...\')\n    r = 10 / int(\'a\')\n    print(\'result:\', r)\nexcept ValueError as e:\n    print(\'ValueError:\', e)\nexcept ZeroDivisionError as e:\n    print(\'ZeroDivisionError:\', e)\nfinally:\n    print(\'finally...\')\nprint(\'END\')`, `37778473863919034000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'try...\'</span><span class="token punctuation">)</span>\n    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'result:\'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>\n<span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'ValueError:\'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>\n<span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'ZeroDivisionError:\'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'finally...\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'END\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>int() 函数可能会抛出 ValueError，所以我们用一个 except 捕获 ValueError，用另一个 except 捕获 ZeroDivisionError。</p>\n<p>此外，如果没有错误发生，可以在 except 语句块后面加一个 else，当没有错误发生时，会自动执行 else 语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66436708991949640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`try:\n    print(\'try...\')\n    r = 10 / int(\'2\')\n    print(\'result:\', r)\nexcept ValueError as e:\n    print(\'ValueError:\', e)\nexcept ZeroDivisionError as e:\n    print(\'ZeroDivisionError:\', e)\nelse:\n    print(\'no error!\')\nfinally:\n    print(\'finally...\')\nprint(\'END\')`, `66436708991949640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'try...\'</span><span class="token punctuation">)</span>\n    r <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">\'2\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'result:\'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>\n<span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'ValueError:\'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>\n<span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'ZeroDivisionError:\'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'no error!\'</span><span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'finally...\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'END\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Python 的错误其实也是 class，所有的错误类型都继承自 BaseException，所以在使用 except 时需要注意的是，它不但捕获该类型的错误，还把其子类也“一网打尽”。比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9636781461104781000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`try:\n    foo()\nexcept ValueError as e:\n    print(\'ValueError\')\nexcept UnicodeError as e:\n    print(\'UnicodeError\')`, `9636781461104781000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">try</span><span class="token punctuation">:</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'ValueError\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> UnicodeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'UnicodeError\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>第二个 except 永远也捕获不到 UnicodeError，因为 UnicodeError 是 ValueError 的子类，如果有，也被第一个 except 给捕获了。</p>\n<p>Python 所有的错误都是从 BaseException 类派生的，常见的错误类型和继承关系看<a href="https://docs.python.org/3/library/exceptions.html#exception-hierarchy" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<p>使用 try…except 捕获错误还有一个巨大的好处，就是可以跨越多层调用，比如函数 main() 调用 bar()，bar() 调用 foo()，结果 foo() 出错了，这时，只要 main() 捕获到了，就可以处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25758824863057605000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def foo(s):\n    return 10 / int(s)\n\ndef bar(s):\n    return foo(s) * 2\n\ndef main():\n    try:\n        bar(\'0\')\n    except Exception as e:\n        print(\'Error:\', e)\n    finally:\n        print(\'finally...\')`, `25758824863057605000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span>\n\n<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        bar<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Error:\'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>\n    <span class="token keyword">finally</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'finally...\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>也就是说，不需要在每个可能出错的地方去捕获错误，只要在合适的层次去捕获错误就可以了。这样一来，就大大减少了写 try…except…finally 的麻烦。</p>\n<h3 id="调用栈"><a href="#%E8%B0%83%E7%94%A8%E6%A0%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用栈</h3>\n<p>如果错误没有被捕获，它就会一直往上抛，最后被 Python 解释器捕获，打印一个错误信息，然后程序退出。来看看 err.py：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28791825650471047000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# err.py:\ndef foo(s):\n    return 10 / int(s)\n\ndef bar(s):\n    return foo(s) * 2\n\ndef main():\n    bar(\'0\')\n\nmain()`, `28791825650471047000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># err.py:</span>\n<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span>\n\n<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    bar<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span>\n\nmain<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行，结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70281910357728840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python3 err.py\nTraceback (most recent call last): # 错误的跟踪信息\n  File &quot;err.py&quot;, line 11, in <module> # 调用 main() 出错了，在代码文件 err.py 的第 11 行代码，但原因是第 9 行\n    main()\n  File &quot;err.py&quot;, line 9, in main # 调用 bar(\'0\') 出错了，在代码文件 err.py 的第 9 行代码，但原因是第 6 行\n    bar(\'0\')\n  File &quot;err.py&quot;, line 6, in bar # 原因是 return foo(s) * 2 这个语句出错了，但这还不是最终原因，继续往下看\n    return foo(s) * 2\n  File &quot;err.py&quot;, line 3, in foo # 原因是 return 10 / int(s) 这个语句出错了，这是错误产生的源头，因为下面打印了：ZeroDivisionError: division by zero\n    return 10 / int(s)\nZeroDivisionError: division by zero`, `70281910357728840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python3 err.py\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>: <span class="token comment"># 错误的跟踪信息</span>\n  File <span class="token string">"err.py"</span>, line <span class="token number">11</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span> <span class="token comment"># 调用 main() 出错了，在代码文件 err.py 的第 11 行代码，但原因是第 9 行</span>\n    main<span class="token punctuation">(</span><span class="token punctuation">)</span>\n  File <span class="token string">"err.py"</span>, line <span class="token number">9</span>, <span class="token keyword">in</span> main <span class="token comment"># 调用 bar(\'0\') 出错了，在代码文件 err.py 的第 9 行代码，但原因是第 6 行</span>\n    bar<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span>\n  File <span class="token string">"err.py"</span>, line <span class="token number">6</span>, <span class="token keyword">in</span> bar <span class="token comment"># 原因是 return foo(s) * 2 这个语句出错了，但这还不是最终原因，继续往下看</span>\n    <span class="token builtin class-name">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> * <span class="token number">2</span>\n  File <span class="token string">"err.py"</span>, line <span class="token number">3</span>, <span class="token keyword">in</span> foo <span class="token comment"># 原因是 return 10 / int(s) 这个语句出错了，这是错误产生的源头，因为下面打印了：ZeroDivisionError: division by zero</span>\n    <span class="token builtin class-name">return</span> <span class="token number">10</span> / int<span class="token punctuation">(</span>s<span class="token punctuation">)</span>\nZeroDivisionError: division by zero</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>出错并不可怕，可怕的是不知道哪里出错了。解读错误信息是定位错误的关键，如上面的代码注释</p>\n<h3 id="记录错误"><a href="#%E8%AE%B0%E5%BD%95%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>记录错误</h3>\n<p>如果不捕获错误，自然可以让 Python 解释器来打印出错误堆栈，但程序也被结束了。既然我们能捕获错误，就可以把错误堆栈打印出来，然后分析错误原因，同时，让程序继续执行下去。</p>\n<p>Python 内置的 logging 模块可以非常容易地记录错误信息：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75878457474125550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# err_logging.py\n\nimport logging\n\ndef foo(s):\n    return 10 / int(s)\n\ndef bar(s):\n    return foo(s) * 2\n\ndef main():\n    try:\n        bar(\'0\')\n    except Exception as e:\n        logging.exception(e)\n\nmain()\nprint(\'END\')`, `75878457474125550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># err_logging.py</span>\n\n<span class="token keyword">import</span> logging\n\n<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span>\n\n<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        bar<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n        logging<span class="token punctuation">.</span>exception<span class="token punctuation">(</span>e<span class="token punctuation">)</span>\n\nmain<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'END\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样是出错，但程序打印完错误信息后会继续执行，并正常退出：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21660808871590433000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python3 err_logging.py\nERROR:root:division by zero\nTraceback (most recent call last):\n  File &quot;err_logging.py&quot;, line 13, in main\n    bar(\'0\')\n  File &quot;err_logging.py&quot;, line 9, in bar\n    return foo(s) * 2\n  File &quot;err_logging.py&quot;, line 6, in foo\n    return 10 / int(s)\nZeroDivisionError: division by zero\nEND`, `21660808871590433000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python3 err_logging.py\nERROR:root:division by zero\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n  File <span class="token string">"err_logging.py"</span>, line <span class="token number">13</span>, <span class="token keyword">in</span> main\n    bar<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span>\n  File <span class="token string">"err_logging.py"</span>, line <span class="token number">9</span>, <span class="token keyword">in</span> bar\n    <span class="token builtin class-name">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> * <span class="token number">2</span>\n  File <span class="token string">"err_logging.py"</span>, line <span class="token number">6</span>, <span class="token keyword">in</span> foo\n    <span class="token builtin class-name">return</span> <span class="token number">10</span> / int<span class="token punctuation">(</span>s<span class="token punctuation">)</span>\nZeroDivisionError: division by zero\nEND</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>通过配置，logging 还可以把错误记录到日志文件里，方便事后排查。</p>\n<h3 id="抛出错误"><a href="#%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>抛出错误</h3>\n<p>因为错误是 class，捕获一个错误就是捕获到该 class 的一个实例。因此，错误并不是凭空产生的，而是有意创建并抛出的。Python 的内置函数会抛出很多类型的错误，我们自己编写的函数也可以抛出错误。</p>\n<p>如果要抛出错误，首先根据需要，可以定义一个错误的 class，选择好继承关系，然后，用 raise 语句抛出一个错误的实例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13747524366856511000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# err_raise.py\nclass FooError(ValueError):\n    pass\n\ndef foo(s):\n    n = int(s)\n    if n==0:\n        raise FooError(\'invalid value: %s\' % s)\n    return 10 / n\n\nfoo(\'0\')`, `13747524366856511000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># err_raise.py</span>\n<span class="token keyword">class</span> <span class="token class-name">FooError</span><span class="token punctuation">(</span>ValueError<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> FooError<span class="token punctuation">(</span><span class="token string">\'invalid value: %s\'</span> <span class="token operator">%</span> s<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n\n\nfoo<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行，可以最后跟踪到我们自己定义的错误：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35556633227838775000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python3 err_raise.py\nTraceback (most recent call last):\n  File &quot;err_throw.py&quot;, line 11, in <module>\n    foo(\'0\')\n  File &quot;err_throw.py&quot;, line 8, in foo\n    raise FooError(\'invalid value: %s\' % s)\n__main__.FooError: invalid value: 0`, `35556633227838775000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python3 err_raise.py\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n  File <span class="token string">"err_throw.py"</span>, line <span class="token number">11</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\n    foo<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span>\n  File <span class="token string">"err_throw.py"</span>, line <span class="token number">8</span>, <span class="token keyword">in</span> foo\n    raise FooError<span class="token punctuation">(</span><span class="token string">\'invalid value: %s\'</span> % s<span class="token punctuation">)</span>\n__main__.FooError: invalid value: <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只有在必要的时候才定义我们自己的错误类型。如果可以选择 Python 已有的内置的错误类型（比如 ValueError，TypeError），尽量使用 Python 内置的错误类型。</p>\n<p>最后，我们来看另一种错误处理的方式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52317795561621410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# err_reraise.py\ndef foo(s):\n    n = int(s)\n    if n==0:\n        raise ValueError(\'invalid value: %s\' % s)\n    return 10 / n\n\ndef bar():\n    try:\n        foo(\'0\')\n    except ValueError as e:\n        print(\'ValueError!\')\n        raise\n\nbar()`, `52317795561621410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># err_reraise.py</span>\n<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'invalid value: %s\'</span> <span class="token operator">%</span> s<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n\n\n<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        foo<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'ValueError!\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">raise</span>\n\nbar<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 bar() 函数中，我们明明已经捕获了错误，但是，打印一个 ValueError! 后，又把错误通过 raise 语句抛出去了，这不有病么？</p>\n<p>其实这种错误处理方式不但没病，而且相当常见。捕获错误目的只是记录一下，便于后续追踪。但是，由于当前函数不知道应该怎么处理该错误，所以，最恰当的方式是继续往上抛，让顶层调用者去处理。好比一个员工处理不了一个问题时，就把问题抛给他的老板，如果他的老板也处理不了，就一直往上抛，最终会抛给 CEO 去处理。</p>\n<p>raise 语句如果不带参数，就会把当前错误原样抛出。此外，在 except 中 raise 一个 Error，还可以把一种类型的错误转化成另一种类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53630240251597190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`try:\n    10 / 0\nexcept ZeroDivisionError:\n    raise ValueError(\'input error!\')`, `53630240251597190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span>\n<span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>\n    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">\'input error!\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只要是合理的转换逻辑就可以，但是，决不应该把一个 IOError 转换成毫不相干的 ValueError。</p>\n<h3 id="小结-13"><a href="#%E5%B0%8F%E7%BB%93-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>Python 内置的 try…except…finally 用来处理错误十分方便。出错时，会分析错误信息并定位错误发生的代码位置才是最关键的。</p>\n<p>程序也可以主动抛出错误，让调用者来处理相应的错误。但是，应该在文档中写清楚可能会抛出哪些错误，以及错误产生的原因。</p>\n<h2 id="调试"><a href="#%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调试</h2>\n<p>第一种方法简单直接粗暴有效，就是用 print() 把可能有问题的变量打印出来看看：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11583981957446787000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def foo(s):\n    n = int(s)\n    print(\'>>> n = %d\' % n)\n    return 10 / n\n\ndef main():\n    foo(\'0\')\n\nmain()`, `11583981957446787000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'>>> n = %d\'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n\n\n<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    foo<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span>\n\nmain<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行后在输出中查找打印的变量值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42708881747024855000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python err.py\n>>> n = 0\nTraceback (most recent call last):\n  ...\nZeroDivisionError: integer division or modulo by zero`, `42708881747024855000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python err.py\n<span class="token operator">>></span><span class="token operator">></span> n <span class="token operator">=</span> <span class="token number">0</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n  <span class="token punctuation">..</span>.\nZeroDivisionError: integer division or modulo by zero</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>用 print() 最大的坏处是将来还得删掉它，想想程序里到处都是 print()，运行结果也会包含很多垃圾信息。所以，我们又有第二种方法。</p>\n<h3 id="断言"><a href="#%E6%96%AD%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>断言</h3>\n<p>凡是用 print() 来辅助查看的地方，都可以用断言（assert）来替代：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98797001876281070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def foo(s):\n    n = int(s)\n    assert n != 0, \'n is zero!\'\n    return 10 / n\n\ndef main():\n    foo(\'0\')`, `98797001876281070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n    <span class="token keyword">assert</span> n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">\'n is zero!\'</span>\n    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n\n\n<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    foo<span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>assert 的意思是，表达式 n != 0 应该是 True，否则，根据程序运行的逻辑，后面的代码肯定会出错。</p>\n<p>如果断言失败，assert 语句本身就会抛出 AssertionError：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28159919849965440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python err.py\nTraceback (most recent call last):\n  ...\nAssertionError: n is zero!`, `28159919849965440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python err.py\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n  <span class="token punctuation">..</span>.\nAssertionError: n is zero<span class="token operator">!</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>程序中如果到处充斥着 assert，和 print() 相比也好不到哪去。不过，启动 Python 解释器时可以用 -O 参数来关闭 assert：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21489619526929650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python -O err.py\nTraceback (most recent call last):\n  ...\nZeroDivisionError: division by zero`, `21489619526929650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python -O err.py\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n  <span class="token punctuation">..</span>.\nZeroDivisionError: division by zero</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>注意：断言的开关“-O”是英文大写字母 O，不是数字 0。</p>\n</blockquote>\n<p>关闭后，你可以把所有的 assert 语句当成 pass 来看。</p>\n<h3 id="logging"><a href="#logging" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>logging</h3>\n<p>把 print() 替换为 logging 是第 3 种方式，和 assert 比，logging 不会抛出错误，而且可以输出到文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84649086599453100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import logging\n\ns = \'0\'\nn = int(s)\nlogging.info(\'n = %d\' % n)\nprint(10 / n)`, `84649086599453100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> logging\n\ns <span class="token operator">=</span> <span class="token string">\'0\'</span>\nn <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\nlogging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">\'n = %d\'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>logging.info() 就可以输出一段文本。运行，发现除了 ZeroDivisionError，没有任何信息。怎么回事？</p>\n<p>别急，在 import logging 之后添加一行配置再试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31488589290375590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import logging\nlogging.basicConfig(level=logging.INFO)`, `31488589290375590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> logging\nlogging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>看到输出了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23101238376389800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python err.py\nINFO:root:n = 0\nTraceback (most recent call last):\n  File &quot;err.py&quot;, line 8, in <module>\n    print(10 / n)\nZeroDivisionError: division by zero`, `23101238376389800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python err.py\nINFO:root:n <span class="token operator">=</span> <span class="token number">0</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n  File <span class="token string">"err.py"</span>, line <span class="token number">8</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\n    print<span class="token punctuation">(</span><span class="token number">10</span> / n<span class="token punctuation">)</span>\nZeroDivisionError: division by zero</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这就是 logging 的好处，它允许你指定记录信息的级别，有 debug，info，warning，error 等几个级别，当我们指定 level=INFO 时，logging.debug 就不起作用了。同理，指定 level=WARNING 后，debug 和 info 就不起作用了。这样一来，你可以放心地输出不同级别的信息，也不用删除，最后统一控制输出哪个级别的信息。</p>\n<p>logging 的另一个好处是通过简单的配置，一条语句可以同时输出到不同的地方，比如 console 和文件。</p>\n<h3 id="pdb"><a href="#pdb" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pdb</h3>\n<p>第 4 种方式是启动 Python 的调试器 pdb，让程序以单步方式运行，可以随时查看运行状态。我们先准备好程序：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48862003531826995000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# err.py\ns = \'0\'\nn = int(s)\nprint(10 / n)`, `48862003531826995000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># err.py</span>\ns <span class="token operator">=</span> <span class="token string">\'0\'</span>\nn <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后启动：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32445632918199950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python -m pdb err.py\n> /Users/michael/Github/learn-python3/samples/debug/err.py(2)<module>()\n-> s = \'0\'`, `32445632918199950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python -m pdb err.py\n<span class="token operator">></span> /Users/michael/Github/learn-python3/samples/debug/err.py<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>module<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n-<span class="token operator">></span> s <span class="token operator">=</span> <span class="token string">\'0\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>以参数 <code class="language-text">-m pdb</code> 启动后，pdb 定位到下一步要执行的代码 <code class="language-text">-&gt; s = &#39;0&#39;</code>。输入命令 l 来查看代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66648011356058000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(Pdb) l\n  1     # err.py\n  2  -> s = \'0\'\n  3     n = int(s)\n  4     print(10 / n)`, `66648011356058000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> l\n  <span class="token number">1</span>     <span class="token comment"># err.py</span>\n  <span class="token number">2</span>  <span class="token operator">-</span><span class="token operator">></span> s <span class="token operator">=</span> <span class="token string">\'0\'</span>\n  <span class="token number">3</span>     n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n  <span class="token number">4</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>输入命令 n 可以单步执行代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85501796438450320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(Pdb) n\n> /Users/michael/Github/learn-python3/samples/debug/err.py(3)<module>()\n-> n = int(s)\n(Pdb) n\n> /Users/michael/Github/learn-python3/samples/debug/err.py(4)<module>()\n-> print(10 / n)`, `85501796438450320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> n\n<span class="token operator">></span> /Users/michael/Github/learn-python3/samples/debug/err.py<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>module<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n-<span class="token operator">></span> n <span class="token operator">=</span> int<span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> n\n<span class="token operator">></span> /Users/michael/Github/learn-python3/samples/debug/err.py<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>module<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n-<span class="token operator">></span> print<span class="token punctuation">(</span><span class="token number">10</span> / n<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>任何时候都可以输入命令 p 变量名来查看变量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7233069864266594000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(Pdb) p s\n\'0\'\n(Pdb) p n\n0`, `7233069864266594000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> p s\n<span class="token string">\'0\'</span>\n<span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> p n\n<span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>输入命令 q 结束调试，退出程序：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96753838348890490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(Pdb) q`, `96753838348890490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> q</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这种通过 pdb 在命令行调试的方法理论上是万能的，但实在是太麻烦了，如果有一千行代码，要运行到第 999 行得敲多少命令啊。还好，我们还有另一种调试方法。</p>\n<h3 id="pdbset_trace"><a href="#pdbset_trace" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pdb.set_trace()</h3>\n<p>这个方法也是用 pdb，但是不需要单步执行，我们只需要 import pdb，然后，在可能出错的地方放一个 pdb.set_trace()，就可以设置一个断点：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63269022035242580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# err.py\nimport pdb\n\ns = \'0\'\nn = int(s)\npdb.set_trace() # 运行到这里会自动暂停\nprint(10 / n)`, `63269022035242580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># err.py</span>\n<span class="token keyword">import</span> pdb\n\ns <span class="token operator">=</span> <span class="token string">\'0\'</span>\nn <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\npdb<span class="token punctuation">.</span>set_trace<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 运行到这里会自动暂停</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行代码，程序会自动在 pdb.set_trace() 暂停并进入 pdb 调试环境，可以用命令 p 查看变量，或者用命令 c 继续运行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81636906830863350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python err.py\n> /Users/michael/Github/learn-python3/samples/debug/err.py(7)<module>()\n-> print(10 / n)\n(Pdb) p n\n0\n(Pdb) c\nTraceback (most recent call last):\n  File &quot;err.py&quot;, line 7, in <module>\n    print(10 / n)\nZeroDivisionError: division by zero`, `81636906830863350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python err.py\n<span class="token operator">></span> /Users/michael/Github/learn-python3/samples/debug/err.py<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>module<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n-<span class="token operator">></span> print<span class="token punctuation">(</span><span class="token number">10</span> / n<span class="token punctuation">)</span>\n<span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> p n\n<span class="token number">0</span>\n<span class="token punctuation">(</span>Pdb<span class="token punctuation">)</span> c\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n  File <span class="token string">"err.py"</span>, line <span class="token number">7</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\n    print<span class="token punctuation">(</span><span class="token number">10</span> / n<span class="token punctuation">)</span>\nZeroDivisionError: division by zero</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个方式比直接启动 pdb 单步调试效率要高很多，但也高不到哪去。</p>\n<h3 id="ide"><a href="#ide" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IDE</h3>\n<p>如果要比较爽地设置断点、单步执行，就需要一个支持调试功能的 IDE。</p>\n<h3 id="小结-14"><a href="#%E5%B0%8F%E7%BB%93-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>写程序最痛苦的事情莫过于调试，程序往往会以你意想不到的流程来运行，你期待执行的语句其实根本没有执行，这时候，就需要调试了。</p>\n<p>虽然用 IDE 调试起来比较方便，但是最后你会发现，logging 才是终极武器。</p>\n<h2 id="单元测试"><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>单元测试</h2>\n<h2 id="文档测试"><a href="#%E6%96%87%E6%A1%A3%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>文档测试</h2>\n<h1 id="io-编程"><a href="#io-%E7%BC%96%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IO 编程</h1>\n<p>注意，本章的 IO 编程都是同步模式，异步 IO 由于复杂度太高，后续涉及到服务器端程序开发时我们再讨论。</p>\n<h2 id="文件读写"><a href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>文件读写</h2>\n<p>读写文件是最常见的 IO 操作。Python 内置了读写文件的函数，用法和 C 是兼容的。</p>\n<h3 id="读文件"><a href="#%E8%AF%BB%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>读文件</h3>\n<p>要以读文件的模式打开一个文件对象，使用 Python 内置的 open() 函数，传入文件名和标示符：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55299060061750030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = open(\'/Users/michael/test.txt\', \'r\')`, `55299060061750030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'/Users/michael/test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>标示符 ‘r’ 表示读，这样，我们就成功地打开了一个文件。</p>\n<p>如果文件不存在，open() 函数就会抛出一个 IOError 的错误，并且给出错误码和详细的信息告诉你文件不存在：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91613116220872930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f=open(\'/Users/michael/notfound.txt\', \'r\')\nTraceback (most recent call last):\n  File &quot;<stdin>&quot;, line 1, in <module>\nFileNotFoundError: [Errno 2] No such file or directory: \'/Users/michael/notfound.txt\'`, `91613116220872930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> <span class="token assign-left variable">f</span><span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">\'/Users/michael/notfound.txt\'</span>, <span class="token string">\'r\'</span><span class="token punctuation">)</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n  File <span class="token string">"&lt;stdin>"</span>, line <span class="token number">1</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>\nFileNotFoundError: <span class="token punctuation">[</span>Errno <span class="token number">2</span><span class="token punctuation">]</span> No such <span class="token function">file</span> or directory: <span class="token string">\'/Users/michael/notfound.txt\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果文件打开成功，接下来，调用 read() 方法可以一次读取文件的全部内容，Python 把内容读到内存，用一个 str 对象表示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22587122131298963000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f.read()\n\'Hello, world!\'`, `22587122131298963000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token string">\'Hello, world!\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>最后一步是调用 close() 方法关闭文件。文件使用完毕后必须关闭，因为文件对象会占用操作系统的资源，并且操作系统同一时间能打开的文件数量也是有限的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32917898566582760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f.close()`, `32917898566582760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>由于文件读写时都有可能产生 IOError，一旦出错，后面的 f.close() 就不会调用。所以，为了保证无论是否出错都能正确地关闭文件，我们可以使用 try … finally 来实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15406205556766683000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`try:\n    f = open(\'/path/to/file\', \'r\')\n    print(f.read())\nfinally:\n    if f:\n        f.close()`, `15406205556766683000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">try</span><span class="token punctuation">:</span>\n    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'/path/to/file\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token keyword">if</span> f<span class="token punctuation">:</span>\n        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是每次都这么写实在太繁琐，所以，Python 引入了 with 语句来自动帮我们调用 close() 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67541732115838620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`with open(\'/path/to/file\', \'r\') as f:\n    print(f.read())`, `67541732115838620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'/path/to/file\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这和前面的 try … finally 是一样的，但是代码更加简洁，并且不必调用 f.close() 方法。</p>\n<p>调用 read() 会一次性读取文件的全部内容，如果文件有 10G，内存就爆了，所以，要保险起见，可以反复调用 read(size) 方法，每次最多读取 size 个字节的内容。另外，调用 readline() 可以每次读取一行内容，调用 readlines() 一次读取所有内容并按行返回 list。因此，要根据需要决定怎么调用。</p>\n<p>如果文件很小，read() 一次性读取最方便；如果不能确定文件大小，反复调用 read(size) 比较保险；如果是配置文件，调用 readlines() 最方便：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33700669545093186000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for line in f.readlines():\n    print(line.strip()) # 把末尾的 \'\\n\' 删掉`, `33700669545093186000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 把末尾的 \'\\n\' 删掉</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="file-like-object"><a href="#file-like-object" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>file-like Object</h3>\n<p>像 open() 函数返回的这种有个 read() 方法的对象，在 Python 中统称为 file-like Object。除了 file 外，还可以是内存的字节流，网络流，自定义流等等。file-like Object 不要求从特定类继承，只要写个 read() 方法就行。</p>\n<p>StringIO 就是在内存中创建的 file-like Object，常用作临时缓冲。</p>\n<h3 id="二进制文件"><a href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>二进制文件</h3>\n<p>前面讲的默认都是读取文本文件，并且是 UTF-8 编码的文本文件。要读取二进制文件，比如图片、视频等等，用 ‘rb’ 模式打开文件即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68699372008462850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = open(\'/Users/michael/test.jpg\', \'rb\')\n>>> f.read()\nb\'\\xff\\xd8\\xff\\xe1\\x00\\x18Exif\\x00\\x00...\' # 十六进制表示的字节`, `68699372008462850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'/Users/michael/test.jpg\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token string">b\'\\xff\\xd8\\xff\\xe1\\x00\\x18Exif\\x00\\x00...\'</span> <span class="token comment"># 十六进制表示的字节</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="字符编码-1"><a href="#%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字符编码</h3>\n<p>要读取非 UTF-8 编码的文本文件，需要给 open() 函数传入 encoding 参数，例如，读取 GBK 编码的文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73671169167614340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = open(\'/Users/michael/gbk.txt\', \'r\', encoding=\'gbk\')\n>>> f.read()\n\'测试\'`, `73671169167614340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'/Users/michael/gbk.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">\'gbk\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token string">\'测试\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>遇到有些编码不规范的文件，你可能会遇到 UnicodeDecodeError，因为在文本文件中可能夹杂了一些非法编码的字符。遇到这种情况，open() 函数还接收一个 errors 参数，表示如果遇到编码错误后如何处理。最简单的方式是直接忽略：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10187547765972015000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = open(\'/Users/michael/gbk.txt\', \'r\', encoding=\'gbk\', errors=\'ignore\')`, `10187547765972015000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'/Users/michael/gbk.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">\'gbk\'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">\'ignore\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="写文件"><a href="#%E5%86%99%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>写文件</h3>\n<p>写文件和读文件是一样的，唯一区别是调用 open() 函数时，传入标识符 ‘w’ 或者 ‘wb’ 表示写文本文件或写二进制文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93945070173543500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = open(\'/Users/michael/test.txt\', \'w\')\n>>> f.write(\'Hello, world!\')\n>>> f.close()`, `93945070173543500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'/Users/michael/test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Hello, world!\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>你可以反复调用 write() 来写入文件，但是务必要调用 f.close() 来关闭文件。当我们写文件时，操作系统往往不会立刻把数据写入磁盘，而是放到内存缓存起来，空闲的时候再慢慢写入。只有调用 close() 方法时，操作系统才保证把没有写入的数据全部写入磁盘。忘记调用 close() 的后果是数据可能只写了一部分到磁盘，剩下的丢失了。所以，还是用 with 语句来得保险：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47775404625834850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`with open(\'/Users/michael/test.txt\', \'w\') as f:\n    f.write(\'Hello, world!\')`, `47775404625834850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'/Users/michael/test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Hello, world!\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>要写入特定编码的文本文件，请给 open() 函数传入 encoding 参数，将字符串自动转换成指定编码。</p>\n<p>细心的童鞋会发现，以 ‘w’ 模式写入文件时，如果文件已存在，会直接覆盖（相当于删掉后新写入一个文件）。如果我们希望追加到文件末尾怎么办？可以传入 ‘a’ 以追加（append）模式写入。</p>\n<p>所有模式的定义及含义可以参考 Python 的官方<a href="https://docs.python.org/3/library/functions.html#open" target="_blank" rel="nofollow noreferrer noopener">文档</a>。</p>\n<h3 id="小结-15"><a href="#%E5%B0%8F%E7%BB%93-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>在 Python 中，文件读写是通过 open() 函数打开的文件对象完成的。使用 with 语句操作文件 IO 是个好习惯。</p>\n<h2 id="stringio-和-bytesio"><a href="#stringio-%E5%92%8C-bytesio" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>StringIO 和 BytesIO</h2>\n<h3 id="stringio"><a href="#stringio" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>StringIO</h3>\n<p>很多时候，数据读写不一定是文件，也可以在内存中读写。</p>\n<p>StringIO 顾名思义就是在内存中读写 str。</p>\n<p>要把 str 写入 StringIO，我们需要先创建一个 StringIO，然后，像文件一样写入即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77651187659370770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> from io import StringIO\n>>> f = StringIO()\n>>> f.write(\'hello\')\n5\n>>> f.write(\' \')\n1\n>>> f.write(\'world!\')\n6\n>>> print(f.getvalue())\nhello world!`, `77651187659370770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO\n<span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'hello\'</span><span class="token punctuation">)</span>\n<span class="token number">5</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span>\n<span class="token number">1</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'world!\'</span><span class="token punctuation">)</span>\n<span class="token number">6</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nhello world!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>getvalue() 方法用于获得写入后的 str。</p>\n<p>要读取 StringIO，可以用一个 str 初始化 StringIO，然后，像读文件一样读取：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51482310383821275000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> from io import StringIO\n>>> f = StringIO(\'Hello!\\nHi!\\nGoodbye!\')\n>>> while True:\n...     s = f.readline()\n...     if s == \'\':\n...         break\n...     print(s.strip())\n...\nHello!\nHi!\nGoodbye!`, `51482310383821275000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO\n<span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token string">\'Hello!\\nHi!\\nGoodbye!\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     s <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">if</span> s <span class="token operator">==</span> <span class="token string">\'\'</span><span class="token punctuation">:</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">break</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\nHello!\nHi!\nGoodbye!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="bytesio"><a href="#bytesio" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>BytesIO</h3>\n<p>StringIO 操作的只能是 str，如果要操作二进制数据，就需要使用 BytesIO。</p>\n<p>BytesIO 实现了在内存中读写 bytes，我们创建一个 BytesIO，然后写入一些 bytes：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99793071602893950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> from io import BytesIO\n>>> f = BytesIO()\n>>> f.write(\'中文\'.encode(\'utf-8\'))\n6\n>>> print(f.getvalue())\nb\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'`, `99793071602893950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO\n<span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'中文\'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token number">6</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token string">b\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>请注意，写入的不是 str，而是经过 UTF-8 编码的 bytes。</p>\n<p>和 StringIO 类似，可以用一个 bytes 初始化 BytesIO，然后，像读文件一样读取：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39411744657329775000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> from io import BytesIO\n>>> f = BytesIO(b\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\')\n>>> f.read()\nb\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'`, `39411744657329775000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO\n<span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token string">b\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token string">b\'\\xe4\\xb8\\xad\\xe6\\x96\\x87\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="小结-16"><a href="#%E5%B0%8F%E7%BB%93-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>StringIO 和 BytesIO 是在内存中操作 str 和 bytes 的方法，使得和读写文件具有一致的接口。</p>\n<h2 id="操作文件和目录"><a href="#%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>操作文件和目录</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95212431943296120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import os\n>>> os.name # 操作系统类型\n\'posix\'`, `95212431943296120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> os\n<span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>name <span class="token comment"># 操作系统类型</span>\n<span class="token string">\'posix\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果是 posix，说明系统是 Linux、Unix 或 Mac OS X，如果是 nt，就是 Windows 系统。</p>\n<p>要获取详细的系统信息，可以调用 uname() 函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19784979409772840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> os.uname()\nposix.uname_result(sysname=\'Darwin\', nodename=\'MichaelMacPro.local\', release=\'14.3.0\', version=\'Darwin Kernel Version 14.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5/RELEASE_X86_64\', machine=\'x86_64\')`, `19784979409772840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>uname<span class="token punctuation">(</span><span class="token punctuation">)</span>\nposix<span class="token punctuation">.</span>uname_result<span class="token punctuation">(</span>sysname<span class="token operator">=</span><span class="token string">\'Darwin\'</span><span class="token punctuation">,</span> nodename<span class="token operator">=</span><span class="token string">\'MichaelMacPro.local\'</span><span class="token punctuation">,</span> release<span class="token operator">=</span><span class="token string">\'14.3.0\'</span><span class="token punctuation">,</span> version<span class="token operator">=</span><span class="token string">\'Darwin Kernel Version 14.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5/RELEASE_X86_64\'</span><span class="token punctuation">,</span> machine<span class="token operator">=</span><span class="token string">\'x86_64\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>注意 uname() 函数在 Windows 上不提供，也就是说，os 模块的某些函数是跟操作系统相关的。</p>\n<h3 id="环境变量"><a href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>环境变量</h3>\n<p>在操作系统中定义的环境变量，全部保存在 os.environ 这个变量中，可以直接查看：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90734478279176980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> os.environ\nenviron({\'VERSIONER_PYTHON_PREFER_32_BIT\': \'no\', \'TERM_PROGRAM_VERSION\': \'326\', \'LOGNAME\': \'michael\', \'USER\': \'michael\', \'PATH\': \'/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/opt/X11/bin:/usr/local/mysql/bin\', ...})`, `90734478279176980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>environ\nenviron<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">\'VERSIONER_PYTHON_PREFER_32_BIT\'</span><span class="token punctuation">:</span> <span class="token string">\'no\'</span><span class="token punctuation">,</span> <span class="token string">\'TERM_PROGRAM_VERSION\'</span><span class="token punctuation">:</span> <span class="token string">\'326\'</span><span class="token punctuation">,</span> <span class="token string">\'LOGNAME\'</span><span class="token punctuation">:</span> <span class="token string">\'michael\'</span><span class="token punctuation">,</span> <span class="token string">\'USER\'</span><span class="token punctuation">:</span> <span class="token string">\'michael\'</span><span class="token punctuation">,</span> <span class="token string">\'PATH\'</span><span class="token punctuation">:</span> <span class="token string">\'/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/opt/X11/bin:/usr/local/mysql/bin\'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>要获取某个环境变量的值，可以调用 os.environ.get(‘key’)：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38357298416903740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> os.environ.get(\'PATH\')\n\'/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/opt/X11/bin:/usr/local/mysql/bin\'\n>>> os.environ.get(\'x\', \'default\')\n\'default\'`, `38357298416903740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'PATH\'</span><span class="token punctuation">)</span>\n<span class="token string">\'/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/opt/X11/bin:/usr/local/mysql/bin\'</span>\n<span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">\'x\'</span><span class="token punctuation">,</span> <span class="token string">\'default\'</span><span class="token punctuation">)</span>\n<span class="token string">\'default\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="操作文件和目录-1"><a href="#%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>操作文件和目录</h3>\n<p>操作文件和目录的函数一部分放在 os 模块中，一部分放在 os.path 模块中，这一点要注意一下。查看、创建和删除目录可以这么调用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76667040505391280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 查看当前目录的绝对路径:\n>>> os.path.abspath(\'.\')\n\'/Users/michael\'\n# 在某个目录下创建一个新目录，首先把新目录的完整路径表示出来:\n>>> os.path.join(\'/Users/michael\', \'testdir\')\n\'/Users/michael/testdir\'\n# 然后创建一个目录:\n>>> os.mkdir(\'/Users/michael/testdir\')\n# 删掉一个目录:\n>>> os.rmdir(\'/Users/michael/testdir\')`, `76667040505391280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 查看当前目录的绝对路径:</span>\n<span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">\'.\'</span><span class="token punctuation">)</span>\n<span class="token string">\'/Users/michael\'</span>\n<span class="token comment"># 在某个目录下创建一个新目录，首先把新目录的完整路径表示出来:</span>\n<span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">\'/Users/michael\'</span><span class="token punctuation">,</span> <span class="token string">\'testdir\'</span><span class="token punctuation">)</span>\n<span class="token string">\'/Users/michael/testdir\'</span>\n<span class="token comment"># 然后创建一个目录:</span>\n<span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">\'/Users/michael/testdir\'</span><span class="token punctuation">)</span>\n<span class="token comment"># 删掉一个目录:</span>\n<span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>rmdir<span class="token punctuation">(</span><span class="token string">\'/Users/michael/testdir\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>把两个路径合成一个时，不要直接拼字符串，而要通过 os.path.join() 函数，这样可以正确处理不同操作系统的路径分隔符。在 Linux/Unix/Mac 下，os.path.join() 返回这样的字符串：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46302901873203140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`part-1/part-2`, `46302901873203140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">part-1/part-2</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>而 Windows 下会返回这样的字符串：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5672308678123472000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`part-1\\part-2`, `5672308678123472000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">part-1\\part-2</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>同样的道理，要拆分路径时，也不要直接去拆字符串，而要通过 os.path.split() 函数，这样可以把一个路径拆分为两部分，后一部分总是最后级别的目录或文件名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17307142478048630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> os.path.split(\'/Users/michael/testdir/file.txt\')\n(\'/Users/michael/testdir\', \'file.txt\')`, `17307142478048630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">\'/Users/michael/testdir/file.txt\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token string">\'/Users/michael/testdir\'</span><span class="token punctuation">,</span> <span class="token string">\'file.txt\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>os.path.splitext() 可以直接让你得到文件扩展名，很多时候非常方便：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4996333455801794000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> os.path.splitext(\'/path/to/file.txt\')\n(\'/path/to/file\', \'.txt\')`, `4996333455801794000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span><span class="token string">\'/path/to/file.txt\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token string">\'/path/to/file\'</span><span class="token punctuation">,</span> <span class="token string">\'.txt\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这些合并、拆分路径的函数并不要求目录和文件要真实存在，它们只对字符串进行操作。</p>\n<p>文件操作使用下面的函数。假定当前目录下有一个 test.txt 文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63587131968583810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 对文件重命名:\n>>> os.rename(\'test.txt\', \'test.py\')\n# 删掉文件:\n>>> os.remove(\'test.py\')`, `63587131968583810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 对文件重命名:</span>\n<span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'test.py\'</span><span class="token punctuation">)</span>\n<span class="token comment"># 删掉文件:</span>\n<span class="token operator">>></span><span class="token operator">></span> os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">\'test.py\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是复制文件的函数居然在 os 模块中不存在！原因是复制文件并非由操作系统提供的系统调用。理论上讲，我们通过上一节的读写文件可以完成文件复制，只不过要多写很多代码。</p>\n<p>幸运的是 shutil 模块提供了 copyfile() 的函数，你还可以在 shutil 模块中找到很多实用函数，它们可以看做是 os 模块的补充。</p>\n<p>最后看看如何利用 Python 的特性来过滤文件。比如我们要列出当前目录下的所有目录，只需要一行代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62579893723487690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> [x for x in os.listdir(\'.\') if os.path.isdir(x)]\n[\'.lein\', \'.local\', \'.m2\', \'.npm\', \'.ssh\', \'.Trash\', \'.vim\', \'Applications\', \'Desktop\', ...]`, `62579893723487690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">\'.\'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'.lein\'</span><span class="token punctuation">,</span> <span class="token string">\'.local\'</span><span class="token punctuation">,</span> <span class="token string">\'.m2\'</span><span class="token punctuation">,</span> <span class="token string">\'.npm\'</span><span class="token punctuation">,</span> <span class="token string">\'.ssh\'</span><span class="token punctuation">,</span> <span class="token string">\'.Trash\'</span><span class="token punctuation">,</span> <span class="token string">\'.vim\'</span><span class="token punctuation">,</span> <span class="token string">\'Applications\'</span><span class="token punctuation">,</span> <span class="token string">\'Desktop\'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>要列出所有的 .py 文件，也只需一行代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55272608490455410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> [x for x in os.listdir(\'.\') if os.path.isfile(x) and os.path.splitext(x)[1]==\'.py\']\n[\'apis.py\', \'config.py\', \'models.py\', \'pymonitor.py\', \'test_db.py\', \'urls.py\', \'wsgiapp.py\']`, `55272608490455410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">\'.\'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">\'.py\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">[</span><span class="token string">\'apis.py\'</span><span class="token punctuation">,</span> <span class="token string">\'config.py\'</span><span class="token punctuation">,</span> <span class="token string">\'models.py\'</span><span class="token punctuation">,</span> <span class="token string">\'pymonitor.py\'</span><span class="token punctuation">,</span> <span class="token string">\'test_db.py\'</span><span class="token punctuation">,</span> <span class="token string">\'urls.py\'</span><span class="token punctuation">,</span> <span class="token string">\'wsgiapp.py\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>是不是非常简洁？</p>\n<h3 id="小结-17"><a href="#%E5%B0%8F%E7%BB%93-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>Python 的 os 模块封装了操作系统的目录和文件操作，要注意这些函数有的在 os 模块中，有的在 os.path 模块中。</p>\n<h2 id="序列化"><a href="#%E5%BA%8F%E5%88%97%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>序列化</h2>\n<p>在程序运行的过程中，所有的变量都是在内存中，比如，定义一个 dict：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16030905110386252000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`d = dict(name=\'Bob\', age=20, score=88)`, `16030905110386252000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">\'Bob\'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token number">88</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>可以随时修改变量，比如把 name 改成 ‘Bill’，但是一旦程序结束，变量所占用的内存就被操作系统全部回收。如果没有把修改后的 ‘Bill’ 存储到磁盘上，下次重新运行程序，变量又被初始化为 ‘Bob’。</p>\n<p>我们把变量从内存中变成可存储或传输的过程称之为序列化，在 Python 中叫 pickling，在其他语言中也被称之为 serialization，marshalling，flattening 等等，都是一个意思。</p>\n<p>序列化之后，就可以把序列化后的内容写入磁盘，或者通过网络传输到别的机器上。</p>\n<p>反过来，把变量内容从序列化的对象重新读到内存里称之为反序列化，即 unpickling。</p>\n<p>Python 提供了 pickle 模块来实现序列化。</p>\n<p>首先，我们尝试把一个对象序列化并写入文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57945239147129860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import pickle\n>>> d = dict(name=\'Bob\', age=20, score=88)\n>>> pickle.dumps(d)\nb\'\\x80\\x03}q\\x00(X\\x03\\x00\\x00\\x00ageq\\x01K\\x14X\\x05\\x00\\x00\\x00scoreq\\x02KXX\\x04\\x00\\x00\\x00nameq\\x03X\\x03\\x00\\x00\\x00Bobq\\x04u.\'`, `57945239147129860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pickle\n<span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">\'Bob\'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token number">88</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>\n<span class="token string">b\'\\x80\\x03}q\\x00(X\\x03\\x00\\x00\\x00ageq\\x01K\\x14X\\x05\\x00\\x00\\x00scoreq\\x02KXX\\x04\\x00\\x00\\x00nameq\\x03X\\x03\\x00\\x00\\x00Bobq\\x04u.\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>pickle.dumps() 方法把任意对象序列化成一个 bytes，然后，就可以把这个 bytes 写入文件。或者用另一个方法 pickle.dump() 直接把对象序列化后写入一个 file-like Object：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96653635010358950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = open(\'dump.txt\', \'wb\')\n>>> pickle.dump(d, f)\n>>> f.close()`, `96653635010358950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'dump.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'wb\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>d<span class="token punctuation">,</span> f<span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>看看写入的 dump.txt 文件，一堆乱七八糟的内容，这些都是 Python 保存的对象内部信息。</p>\n<p>当我们要把对象从磁盘读到内存时，可以先把内容读到一个 bytes，然后用 pickle.loads() 方法反序列化出对象，也可以直接用 pickle.load() 方法从一个 file-like Object 中直接反序列化出对象。我们打开另一个 Python 命令行来反序列化刚才保存的对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55137481060062730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> f = open(\'dump.txt\', \'rb\')\n>>> d = pickle.load(f)\n>>> f.close()\n>>> d\n{\'age\': 20, \'score\': 88, \'name\': \'Bob\'}`, `55137481060062730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'dump.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> d\n<span class="token punctuation">{</span><span class="token string">\'age\'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">\'score\'</span><span class="token punctuation">:</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token string">\'name\'</span><span class="token punctuation">:</span> <span class="token string">\'Bob\'</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>变量的内容又回来了！</p>\n<p>当然，这个变量和原来的变量是完全不相干的对象，它们只是内容相同而已。</p>\n<p>Pickle 的问题和所有其他编程语言特有的序列化问题一样，就是它只能用于 Python，并且可能不同版本的 Python 彼此都不兼容，因此，只能用 Pickle 保存那些不重要的数据，不能成功地反序列化也没关系。</p>\n<h3 id="json"><a href="#json" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JSON</h3>\n<p>如果我们要在不同的编程语言之间传递对象，就必须把对象序列化为标准格式，比如 XML，但更好的方法是序列化为 JSON，因为 JSON 表示出来就是一个字符串，可以被所有语言读取，也可以方便地存储到磁盘或者通过网络传输。JSON 不仅是标准格式，并且比 XML 更快，而且可以直接在 Web 页面中读取，非常方便。</p>\n<p>JSON 表示的对象就是标准的 JavaScript 语言的对象，JSON 和 Python 内置的数据类型对应如下：</p>\n<table>\n<thead>\n<tr>\n<th align="left">JSON 类型</th>\n<th align="left">Python 类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">{}</td>\n<td align="left">dict</td>\n</tr>\n<tr>\n<td align="left">[]</td>\n<td align="left">list</td>\n</tr>\n<tr>\n<td align="left">“string”</td>\n<td align="left">str</td>\n</tr>\n<tr>\n<td align="left">1234.56</td>\n<td align="left">int 或 float</td>\n</tr>\n<tr>\n<td align="left">true/false</td>\n<td align="left">True/False</td>\n</tr>\n<tr>\n<td align="left">null</td>\n<td align="left">None</td>\n</tr>\n</tbody>\n</table>\n<p>Python 内置的 json 模块提供了非常完善的 Python 对象到 JSON 格式的转换。我们先看看如何把 Python 对象变成一个 JSON：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98506326689470870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import json\n>>> d = dict(name=\'Bob\', age=20, score=88)\n>>> json.dumps(d)\n\'{&quot;age&quot;: 20, &quot;score&quot;: 88, &quot;name&quot;: &quot;Bob&quot;}\'`, `98506326689470870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> json\n<span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">\'Bob\'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token number">88</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>\n<span class="token string">\'{"age": 20, "score": 88, "name": "Bob"}\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>dumps() 方法返回一个 str，内容就是标准的 JSON。类似的，dump() 方法可以直接把 JSON 写入一个 file-like Object。</p>\n<p>要把 JSON 反序列化为 Python 对象，用 loads() 或者对应的 load() 方法，前者把 JSON 的字符串反序列化，后者从 file-like Object 中读取字符串并反序列化：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41692054523073920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> json_str = \'{&quot;age&quot;: 20, &quot;score&quot;: 88, &quot;name&quot;: &quot;Bob&quot;}\'\n>>> json.loads(json_str)\n{\'age\': 20, \'score\': 88, \'name\': \'Bob\'}`, `41692054523073920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> json_str <span class="token operator">=</span> <span class="token string">\'{"age": 20, "score": 88, "name": "Bob"}\'</span>\n<span class="token operator">>></span><span class="token operator">></span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>\n<span class="token punctuation">{</span><span class="token string">\'age\'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">\'score\'</span><span class="token punctuation">:</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token string">\'name\'</span><span class="token punctuation">:</span> <span class="token string">\'Bob\'</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>由于 JSON 标准规定 JSON 编码是 UTF-8，所以我们总是能正确地在 Python 的 str 与 JSON 的字符串之间转换。</p>\n<h3 id="json-进阶"><a href="#json-%E8%BF%9B%E9%98%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JSON 进阶</h3>\n<p>Python 的 dict 对象可以直接序列化为 JSON 的 {}，不过，很多时候，我们更喜欢用 class 表示对象，比如定义 Student 类，然后序列化：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83620545004777900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import json\n\nclass Student(object):\n    def __init__(self, name, age, score):\n        self.name = name\n        self.age = age\n        self.score = score\n\ns = Student(\'Bob\', 20, 88)\nprint(json.dumps(s))`, `83620545004777900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> json\n\n<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age\n        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score\n\ns <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">\'Bob\'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行代码，毫不留情地得到一个 TypeError：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40839171288684590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Traceback (most recent call last):\n  ...\nTypeError: <__main__.Student object at 0x10603cc50> is not JSON serializable`, `40839171288684590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:\n  <span class="token punctuation">..</span>.\nTypeError: <span class="token operator">&lt;</span>__main__.Student object at 0x10603cc5<span class="token operator"><span class="token file-descriptor important">0</span>></span> is not JSON serializable</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>错误的原因是 Student 对象不是一个可序列化为 JSON 的对象。</p>\n<p>如果连 class 的实例对象都无法序列化为 JSON，这肯定不合理！</p>\n<p>别急，我们仔细看看 dumps() 方法的参数列表，可以发现，除了第一个必须的 obj 参数外，dumps() 方法还提供了一大堆的可选<a href="https://docs.python.org/3/library/json.html#json.dumps" target="_blank" rel="nofollow noreferrer noopener">参数</a></p>\n<p>这些可选参数就是让我们来定制 JSON 序列化。前面的代码之所以无法把 Student 类实例序列化为 JSON，是因为默认情况下，dumps() 方法不知道如何将 Student 实例变为一个 JSON 的 {} 对象。</p>\n<p>可选参数 default 就是把任意一个对象变成一个可序列为 JSON 的对象，我们只需要为 Student 专门写一个转换函数，再把函数传进去即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75576826193591140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def student2dict(std):\n    return {\n        \'name\': std.name,\n        \'age\': std.age,\n        \'score\': std.score\n    }`, `75576826193591140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">student2dict</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n        <span class="token string">\'name\'</span><span class="token punctuation">:</span> std<span class="token punctuation">.</span>name<span class="token punctuation">,</span>\n        <span class="token string">\'age\'</span><span class="token punctuation">:</span> std<span class="token punctuation">.</span>age<span class="token punctuation">,</span>\n        <span class="token string">\'score\'</span><span class="token punctuation">:</span> std<span class="token punctuation">.</span>score\n    <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样，Student 实例首先被 student2dict() 函数转换成 dict，然后再被顺利序列化为 JSON：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71002395465765280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> print(json.dumps(s, default=student2dict))\n{&quot;age&quot;: 20, &quot;name&quot;: &quot;Bob&quot;, &quot;score&quot;: 88}`, `71002395465765280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>s<span class="token punctuation">,</span> default<span class="token operator">=</span>student2dict<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span><span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"score"</span><span class="token punctuation">:</span> <span class="token number">88</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>不过，下次如果遇到一个 Teacher 类的实例，照样无法序列化为 JSON。我们可以偷个懒，把任意 class 的实例变为 dict：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82514561622641460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print(json.dumps(s, default=lambda obj: obj.__dict__))`, `82514561622641460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>s<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token keyword">lambda</span> obj<span class="token punctuation">:</span> obj<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>因为通常 class 的实例都有一个 <code class="language-text">__dict__</code> 属性，它就是一个 dict，用来存储实例变量。也有少数例外，比如定义了 <code class="language-text">__slots__</code> 的 class。</p>\n<p>同样的道理，如果我们要把 JSON 反序列化为一个 Student 对象实例，loads() 方法首先转换出一个 dict 对象，然后，我们传入的 object_hook 函数负责把 dict 转换为 Student 实例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40971908312734960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def dict2student(d):\n    return Student(d[\'name\'], d[\'age\'], d[\'score\'])`, `40971908312734960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">dict2student</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> Student<span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">\'name\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token string">\'age\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token string">\'score\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>运行结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69808728968390566000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> json_str = \'{&quot;age&quot;: 20, &quot;score&quot;: 88, &quot;name&quot;: &quot;Bob&quot;}\'\n>>> print(json.loads(json_str, object_hook=dict2student))\n<__main__.Student object at 0x10cd3c190>`, `69808728968390566000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> json_str <span class="token operator">=</span> <span class="token string">\'{"age": 20, "score": 88, "name": "Bob"}\'</span>\n<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">,</span> object_hook<span class="token operator">=</span>dict2student<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>__main__<span class="token punctuation">.</span>Student <span class="token builtin">object</span> at <span class="token number">0x10cd3c190</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>打印出的是反序列化的 Student 实例对象。</p>\n<h3 id="小结-18"><a href="#%E5%B0%8F%E7%BB%93-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>Python 语言特定的序列化模块是 pickle，但如果要把序列化搞得更通用、更符合 Web 标准，就可以使用 json 模块。</p>\n<p>json 模块的 dumps() 和 loads() 函数是定义得非常好的接口的典范。当我们使用时，只需要传入一个必须的参数。但是，当默认的序列化或反序列机制不满足我们的要求时，我们又可以传入更多的参数来定制序列化或反序列化的规则，既做到了接口简单易用，又做到了充分的扩展性和灵活性。</p>\n<h1 id="进程和线程"><a href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>进程和线程</h1>\n<h2 id="多进程"><a href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多进程</h2>\n<p>要让 Python 程序实现多进程（multiprocessing），我们先了解操作系统的相关知识。</p>\n<p>Unix/Linux 操作系统提供了一个 fork() 系统调用，它非常特殊。普通的函数调用，调用一次，返回一次，但是 fork() 调用一次，返回两次，因为操作系统自动把当前进程（称为父进程）复制了一份（称为子进程），然后，分别在父进程和子进程内返回。</p>\n<p>子进程永远返回 0，而父进程返回子进程的 ID。这样做的理由是，一个父进程可以 fork 出很多子进程，所以，父进程要记下每个子进程的 ID，而子进程只需要调用 getppid() 就可以拿到父进程的 ID。</p>\n<p>Python 的 os 模块封装了常见的系统调用，其中就包括 fork，可以在 Python 程序中轻松创建子进程：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55463447861133380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import os\n\nprint(\'Process (%s) start...\' % os.getpid())\n# Only works on Unix/Linux/Mac:\npid = os.fork()\nif pid == 0:\n    print(\'I am child process (%s) and my parent is %s.\' % (os.getpid(), os.getppid()))\nelse:\n    print(\'I (%s) just created a child process (%s).\' % (os.getpid(), pid))`, `55463447861133380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> os\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Process (%s) start...\'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token comment"># Only works on Unix/Linux/Mac:</span>\npid <span class="token operator">=</span> os<span class="token punctuation">.</span>fork<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">if</span> pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'I am child process (%s) and my parent is %s.\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>getppid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'I (%s) just created a child process (%s).\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29355426731154990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Process (876) start...\nI (876) just created a child process (877).\nI am child process (877) and my parent is 876.`, `29355426731154990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Process <span class="token punctuation">(</span><span class="token number">876</span><span class="token punctuation">)</span> start<span class="token punctuation">..</span>.\nI <span class="token punctuation">(</span><span class="token number">876</span><span class="token punctuation">)</span> just created a child process <span class="token punctuation">(</span><span class="token number">877</span><span class="token punctuation">)</span>.\nI am child process <span class="token punctuation">(</span><span class="token number">877</span><span class="token punctuation">)</span> and my parent is <span class="token number">876</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>由于 Windows 没有 fork 调用，上面的代码在 Windows 上无法运行。</p>\n<p>有了 fork 调用，一个进程在接到新任务时就可以复制出一个子进程来处理新任务，常见的 Apache 服务器就是由父进程监听端口，每当有新的 http 请求时，就 fork 出子进程来处理新的 http 请求。</p>\n<h3 id="multiprocessing"><a href="#multiprocessing" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>multiprocessing</h3>\n<p>如果你打算编写多进程的服务程序，Unix/Linux 无疑是正确的选择。由于 Windows 没有 fork 调用，难道在 Windows 上无法用 Python 编写多进程的程序？</p>\n<p>由于 Python 是跨平台的，自然也应该提供一个跨平台的多进程支持。multiprocessing 模块就是跨平台版本的多进程模块。</p>\n<p>multiprocessing 模块提供了一个 Process 类来代表一个进程对象，下面的例子演示了启动一个子进程并等待其结束：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94875505788385890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from multiprocessing import Process\nimport os\n\n# 子进程要执行的代码\ndef run_proc(name):\n    print(\'Run child process %s (%s)...\' % (name, os.getpid()))\n\nif __name__==\'__main__\':\n    print(\'Parent process %s.\' % os.getpid())\n    p = Process(target=run_proc, args=(\'test\',))\n    print(\'Child process will start.\')\n    p.start()\n    p.join()\n    print(\'Child process end.\')`, `94875505788385890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process\n<span class="token keyword">import</span> os\n\n<span class="token comment"># 子进程要执行的代码</span>\n<span class="token keyword">def</span> <span class="token function">run_proc</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Run child process %s (%s)...\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">\'__main__\'</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Parent process %s.\'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    p <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>run_proc<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">\'test\'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Child process will start.\'</span><span class="token punctuation">)</span>\n    p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Child process end.\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30645089200281215000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Parent process 928.\nChild process will start.\nRun child process test (929)...\nProcess end.`, `30645089200281215000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Parent process <span class="token number">928</span>.\nChild process will start.\nRun child process <span class="token builtin class-name">test</span> <span class="token punctuation">(</span><span class="token number">929</span><span class="token punctuation">)</span><span class="token punctuation">..</span>.\nProcess end.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>创建子进程时，只需要传入一个执行函数和函数的参数，创建一个 Process 实例，用 start() 方法启动，这样创建进程比 fork() 还要简单。</p>\n<p>join() 方法可以等待子进程结束后再继续往下运行，通常用于进程间的同步。</p>\n<h3 id="pool"><a href="#pool" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pool</h3>\n<p>如果要启动大量的子进程，可以用进程池的方式批量创建子进程：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89319498081180290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from multiprocessing import Pool\nimport os, time, random\n\ndef long_time_task(name):\n    print(\'Run task %s (%s)...\' % (name, os.getpid()))\n    start = time.time()\n    time.sleep(random.random() * 3)\n    end = time.time()\n    print(\'Task %s runs %0.2f seconds.\' % (name, (end - start)))\n\nif __name__==\'__main__\':\n    print(\'Parent process %s.\' % os.getpid())\n    p = Pool(4)\n    for i in range(5):\n        p.apply_async(long_time_task, args=(i,))\n    print(\'Waiting for all subprocesses done...\')\n    p.close()\n    p.join()\n    print(\'All subprocesses done.\')`, `89319498081180290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool\n<span class="token keyword">import</span> os<span class="token punctuation">,</span> time<span class="token punctuation">,</span> random\n\n<span class="token keyword">def</span> <span class="token function">long_time_task</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Run task %s (%s)...\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span>\n    end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Task %s runs %0.2f seconds.\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">\'__main__\'</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Parent process %s.\'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    p <span class="token operator">=</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        p<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>long_time_task<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Waiting for all subprocesses done...\'</span><span class="token punctuation">)</span>\n    p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'All subprocesses done.\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30334397949538226000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Parent process 669.\nWaiting for all subprocesses done...\nRun task 0 (671)...\nRun task 1 (672)...\nRun task 2 (673)...\nRun task 3 (674)...\nTask 2 runs 0.14 seconds.\nRun task 4 (673)...\nTask 1 runs 0.27 seconds.\nTask 3 runs 0.86 seconds.\nTask 0 runs 1.41 seconds.\nTask 4 runs 1.91 seconds.\nAll subprocesses done.`, `30334397949538226000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Parent process <span class="token number">669</span>.\nWaiting <span class="token keyword">for</span> all subprocesses done<span class="token punctuation">..</span>.\nRun task <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">671</span><span class="token punctuation">)</span><span class="token punctuation">..</span>.\nRun task <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">672</span><span class="token punctuation">)</span><span class="token punctuation">..</span>.\nRun task <span class="token number">2</span> <span class="token punctuation">(</span><span class="token number">673</span><span class="token punctuation">)</span><span class="token punctuation">..</span>.\nRun task <span class="token number">3</span> <span class="token punctuation">(</span><span class="token number">674</span><span class="token punctuation">)</span><span class="token punctuation">..</span>.\nTask <span class="token number">2</span> runs <span class="token number">0.14</span> seconds.\nRun task <span class="token number">4</span> <span class="token punctuation">(</span><span class="token number">673</span><span class="token punctuation">)</span><span class="token punctuation">..</span>.\nTask <span class="token number">1</span> runs <span class="token number">0.27</span> seconds.\nTask <span class="token number">3</span> runs <span class="token number">0.86</span> seconds.\nTask <span class="token number">0</span> runs <span class="token number">1.41</span> seconds.\nTask <span class="token number">4</span> runs <span class="token number">1.91</span> seconds.\nAll subprocesses done.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>代码解读：</p>\n<p>对 Pool 对象调用 join() 方法会等待所有子进程执行完毕，调用 join() 之前必须先调用 close()，调用 close() 之后就不能继续添加新的 Process 了。</p>\n<p>请注意输出的结果，task 0，1，2，3 是立刻执行的，而 task 4 要等待前面某个 task 完成后才执行，这是因为 Pool 的默认大小在我的电脑上是 4，因此，最多同时执行 4 个进程。这是 Pool 有意设计的限制，并不是操作系统的限制。如果改成：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22072834662433706000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`p = Pool(5)`, `22072834662433706000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">p = Pool(5)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>就可以同时跑 5 个进程。</p>\n<p>由于 Pool 的默认大小是 CPU 的核数，如果你不幸拥有 8 核 CPU，你要提交至少 9 个子进程才能看到上面的等待效果。</p>\n<h3 id="子进程"><a href="#%E5%AD%90%E8%BF%9B%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>子进程</h3>\n<p>很多时候，子进程并不是自身，而是一个外部进程。我们创建了子进程后，还需要控制子进程的输入和输出。</p>\n<p>subprocess 模块可以让我们非常方便地启动一个子进程，然后控制其输入和输出。</p>\n<p>下面的例子演示了如何在 Python 代码中运行命令 nslookup www.python.org，这和命令行直接运行的效果是一样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11280642070805236000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import subprocess\n\nprint(\'\\$ nslookup www.python.org\')\nr = subprocess.call([\'nslookup\', \'www.python.org\'])\nprint(\'Exit code:\', r)`, `11280642070805236000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> subprocess\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'$ nslookup www.python.org\'</span><span class="token punctuation">)</span>\nr <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'nslookup\'</span><span class="token punctuation">,</span> <span class="token string">\'www.python.org\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Exit code:\'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行结果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32826117546093347000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ nslookup www.python.org\nServer:  192.168.19.4\nAddress: 192.168.19.4#53\n\nNon-authoritative answer:\nwww.python.org canonical name = python.map.fastly.net.\nName: python.map.fastly.net\nAddress: 199.27.79.223\n\nExit code: 0`, `32826117546093347000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">nslookup</span> www.python.org\nServer:  <span class="token number">192.168</span>.19.4\nAddress: <span class="token number">192.168</span>.19.4<span class="token comment">#53</span>\n\nNon-authoritative answer:\nwww.python.org canonical name <span class="token operator">=</span> python.map.fastly.net.\nName: python.map.fastly.net\nAddress: <span class="token number">199.27</span>.79.223\n\nExit code: <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果子进程还需要输入，则可以通过 communicate() 方法输入：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99932474243396800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import subprocess\n\nprint(\'\\$ nslookup\')\np = subprocess.Popen([\'nslookup\'], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)\noutput, err = p.communicate(b\'set q=mx\\npython.org\\nexit\\n\')\nprint(output.decode(\'utf-8\'))\nprint(\'Exit code:\', p.returncode)`, `99932474243396800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> subprocess\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'$ nslookup\'</span><span class="token punctuation">)</span>\np <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'nslookup\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stdin<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>\noutput<span class="token punctuation">,</span> err <span class="token operator">=</span> p<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token string">b\'set q=mx\\npython.org\\nexit\\n\'</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Exit code:\'</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>returncode<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面的代码相当于在命令行执行命令 nslookup，然后手动输入：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67078065592135710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`set q=mx\npython.org\nexit`, `67078065592135710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token builtin class-name">set</span> <span class="token assign-left variable">q</span><span class="token operator">=</span>mx\npython.org\n<span class="token builtin class-name">exit</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>运行结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32820330664264176000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ nslookup\nServer:  192.168.19.4\nAddress: 192.168.19.4#53\n\nNon-authoritative answer:\npython.org mail exchanger = 50 mail.python.org.\n\nAuthoritative answers can be found from:\nmail.python.org internet address = 82.94.164.166\nmail.python.org has AAAA address 2001:888:2000:d::a6\n\n\nExit code: 0`, `32820330664264176000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">nslookup</span>\nServer:  <span class="token number">192.168</span>.19.4\nAddress: <span class="token number">192.168</span>.19.4<span class="token comment">#53</span>\n\nNon-authoritative answer:\npython.org mail exchanger <span class="token operator">=</span> <span class="token number">50</span> mail.python.org.\n\nAuthoritative answers can be found from:\nmail.python.org internet address <span class="token operator">=</span> <span class="token number">82.94</span>.164.166\nmail.python.org has AAAA address <span class="token number">2001</span>:888:2000:d::a6\n\n\nExit code: <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="进程间通信"><a href="#%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>进程间通信</h3>\n<p>Process 之间肯定是需要通信的，操作系统提供了很多机制来实现进程间的通信。Python 的 multiprocessing 模块包装了底层的机制，提供了 Queue、Pipes 等多种方式来交换数据。</p>\n<p>我们以 Queue 为例，在父进程中创建两个子进程，一个往 Queue 里写数据，一个从 Queue 里读数据：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85581263091261080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`from multiprocessing import Process, Queue\nimport os, time, random\n\n# 写数据进程执行的代码:\ndef write(q):\n    print(\'Process to write: %s\' % os.getpid())\n    for value in [\'A\', \'B\', \'C\']:\n        print(\'Put %s to queue...\' % value)\n        q.put(value)\n        time.sleep(random.random())\n\n# 读数据进程执行的代码:\ndef read(q):\n    print(\'Process to read: %s\' % os.getpid())\n    while True:\n        value = q.get(True)\n        print(\'Get %s from queue.\' % value)\n\nif __name__==\'__main__\':\n    # 父进程创建 Queue，并传给各个子进程：\n    q = Queue()\n    pw = Process(target=write, args=(q,))\n    pr = Process(target=read, args=(q,))\n    # 启动子进程 pw，写入:\n    pw.start()\n    # 启动子进程 pr，读取:\n    pr.start()\n    # 等待 pw 结束:\n    pw.join()\n    # pr 进程里是死循环，无法等待其结束，只能强行终止:\n    pr.terminate()`, `85581263091261080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> Queue\n<span class="token keyword">import</span> os<span class="token punctuation">,</span> time<span class="token punctuation">,</span> random\n\n<span class="token comment"># 写数据进程执行的代码:</span>\n<span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Process to write: %s\'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">\'A\'</span><span class="token punctuation">,</span> <span class="token string">\'B\'</span><span class="token punctuation">,</span> <span class="token string">\'C\'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Put %s to queue...\'</span> <span class="token operator">%</span> value<span class="token punctuation">)</span>\n        q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 读数据进程执行的代码:</span>\n<span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Process to read: %s\'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n        value <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Get %s from queue.\'</span> <span class="token operator">%</span> value<span class="token punctuation">)</span>\n\n<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">\'__main__\'</span><span class="token punctuation">:</span>\n    <span class="token comment"># 父进程创建 Queue，并传给各个子进程：</span>\n    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    pw <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    pr <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token comment"># 启动子进程 pw，写入:</span>\n    pw<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token comment"># 启动子进程 pr，读取:</span>\n    pr<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token comment"># 等待 pw 结束:</span>\n    pw<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token comment"># pr 进程里是死循环，无法等待其结束，只能强行终止:</span>\n    pr<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80499592920536700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Process to write: 50563\nPut A to queue...\nProcess to read: 50564\nGet A from queue.\nPut B to queue...\nGet B from queue.\nPut C to queue...\nGet C from queue.`, `80499592920536700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Process to write: <span class="token number">50563</span>\nPut A to queue<span class="token punctuation">..</span>.\nProcess to read: <span class="token number">50564</span>\nGet A from queue.\nPut B to queue<span class="token punctuation">..</span>.\nGet B from queue.\nPut C to queue<span class="token punctuation">..</span>.\nGet C from queue.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 Unix/Linux 下，multiprocessing 模块封装了 fork() 调用，使我们不需要关注 fork() 的细节。由于 Windows 没有 fork 调用，因此，multiprocessing 需要“模拟”出 fork 的效果，父进程所有 Python 对象都必须通过 pickle 序列化再传到子进程去，所以，如果 multiprocessing 在 Windows 下调用失败了，要先考虑是不是 pickle 失败了。</p>\n<h3 id="小结-19"><a href="#%E5%B0%8F%E7%BB%93-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>在 Unix/Linux 下，可以使用 fork() 调用实现多进程。</p>\n<p>要实现跨平台的多进程，可以使用 multiprocessing 模块。</p>\n<p>进程间通信是通过 Queue、Pipes 等实现的。</p>\n<h2 id="多线程"><a href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多线程</h2>\n<p>多任务可以由多进程完成，也可以由一个进程内的多线程完成。</p>\n<p>由于线程是操作系统直接支持的执行单元，因此，高级语言通常都内置多线程的支持，Python 也不例外，并且，Python 的线程是真正的 Posix Thread，而不是模拟出来的线程。</p>\n<p>Python 的标准库提供了两个模块：<code class="language-text">_thread</code> 和 threading，<code class="language-text">_thread</code> 是低级模块，threading 是高级模块，对 <code class="language-text">_thread</code> 进行了封装。绝大多数情况下，我们只需要使用 threading 这个高级模块。</p>\n<p>启动一个线程就是把一个函数传入并创建 Thread 实例，然后调用 start() 开始执行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10094089380241523000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import time, threading\n\n# 新线程执行的代码:\ndef loop():\n    print(\'thread %s is running...\' % threading.current_thread().name)\n    n = 0\n    while n < 5:\n        n = n + 1\n        print(\'thread %s >>> %s\' % (threading.current_thread().name, n))\n        time.sleep(1)\n    print(\'thread %s ended.\' % threading.current_thread().name)\n\nprint(\'thread %s is running...\' % threading.current_thread().name)\nt = threading.Thread(target=loop, name=\'LoopThread\')\nt.start()\nt.join()\nprint(\'thread %s ended.\' % threading.current_thread().name)`, `10094089380241523000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> time<span class="token punctuation">,</span> threading\n\n<span class="token comment"># 新线程执行的代码:</span>\n<span class="token keyword">def</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'thread %s is running...\'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>\n    n <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>\n        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'thread %s >>> %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'thread %s ended.\'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'thread %s is running...\'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>\nt <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>loop<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'LoopThread\'</span><span class="token punctuation">)</span>\nt<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\nt<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'thread %s ended.\'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于任何进程默认就会启动一个线程，我们把该线程称为主线程，主线程又可以启动新的线程，Python 的 threading 模块有个 current_thread() 函数，它永远返回当前线程的实例。主线程实例的名字叫 MainThread，子线程的名字在创建时指定，我们用 LoopThread 命名子线程。名字仅仅在打印时用来显示，完全没有其他意义，如果不起名字 Python 就自动给线程命名为 Thread-1，Thread-2……</p>\n<h3 id="lock"><a href="#lock" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lock</h3>\n<p>多线程和多进程最大的不同在于，多进程中，同一个变量，各自有一份拷贝存在于每个进程中，互不影响，而多线程中，所有变量都由所有线程共享，所以，任何一个变量都可以被任何一个线程修改，因此，线程之间共享数据最大的危险在于多个线程同时改一个变量，把内容给改乱了。</p>\n<p>来看看多个线程同时操作一个变量怎么把内容给改乱了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81556862455584880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import time, threading\n\n# 假定这是你的银行存款:\nbalance = 0\n\ndef change_it(n):\n    # 先存后取，结果应该为 0:\n    global balance\n    balance = balance + n\n    balance = balance - n\n\ndef run_thread(n):\n    for i in range(2000000):\n        change_it(n)\n\nt1 = threading.Thread(target=run_thread, args=(5,))\nt2 = threading.Thread(target=run_thread, args=(8,))\nt1.start()\nt2.start()\nt1.join()\nt2.join()\nprint(balance)`, `81556862455584880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> time<span class="token punctuation">,</span> threading\n\n<span class="token comment"># 假定这是你的银行存款:</span>\nbalance <span class="token operator">=</span> <span class="token number">0</span>\n\n<span class="token keyword">def</span> <span class="token function">change_it</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># 先存后取，结果应该为 0:</span>\n    <span class="token keyword">global</span> balance\n    balance <span class="token operator">=</span> balance <span class="token operator">+</span> n\n    balance <span class="token operator">=</span> balance <span class="token operator">-</span> n\n\n<span class="token keyword">def</span> <span class="token function">run_thread</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        change_it<span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n\nt1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>run_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nt2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>run_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nt1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\nt2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\nt1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\nt2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>balance<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们定义了一个共享变量 balance，初始值为 0，并且启动两个线程，先存后取，理论上结果应该为 0，但是，由于线程的调度是由操作系统决定的，当 t1、t2 交替执行时，只要循环次数足够多，balance 的结果就不一定是 0 了。</p>\n<p>原因是因为高级语言的一条语句在 CPU 执行时是若干条语句，即使一个简单的计算：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93952897286671930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`balance = balance + n`, `93952897286671930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">balance <span class="token operator">=</span> balance <span class="token operator">+</span> n</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>也分两步：</p>\n<ol>\n<li>计算 balance + n，存入临时变量中；</li>\n<li>将临时变量的值赋给 balance。</li>\n</ol>\n<p>也就是可以看成：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77322704697187700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x = balance + n\nbalance = x`, `77322704697187700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">x <span class="token operator">=</span> balance <span class="token operator">+</span> n\nbalance <span class="token operator">=</span> x</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>由于 x 是局部变量，两个线程各自都有自己的 x，当代码正常执行时：</p>\n<p>初始值 balance = 0</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30240159796958265000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`t1: x1 = balance + 5 # x1 = 0 + 5 = 5\nt1: balance = x1     # balance = 5\nt1: x1 = balance - 5 # x1 = 5 - 5 = 0\nt1: balance = x1     # balance = 0\n\nt2: x2 = balance + 8 # x2 = 0 + 8 = 8\nt2: balance = x2     # balance = 8\nt2: x2 = balance - 8 # x2 = 8 - 8 = 0\nt2: balance = x2     # balance = 0\n\n结果 balance = 0`, `30240159796958265000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">t1: x1 = balance + 5 # x1 = 0 + 5 = 5\nt1: balance = x1     # balance = 5\nt1: x1 = balance - 5 # x1 = 5 - 5 = 0\nt1: balance = x1     # balance = 0\n\nt2: x2 = balance + 8 # x2 = 0 + 8 = 8\nt2: balance = x2     # balance = 8\nt2: x2 = balance - 8 # x2 = 8 - 8 = 0\nt2: balance = x2     # balance = 0\n\n结果 balance = 0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是 t1 和 t2 是交替运行的，如果操作系统以下面的顺序执行 t1、t2：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78525945346836350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`初始值 balance = 0\n\nt1: x1 = balance + 5  # x1 = 0 + 5 = 5\n\nt2: x2 = balance + 8  # x2 = 0 + 8 = 8\nt2: balance = x2      # balance = 8\n\nt1: balance = x1      # balance = 5\nt1: x1 = balance - 5  # x1 = 5 - 5 = 0\nt1: balance = x1      # balance = 0\n\nt2: x2 = balance - 8  # x2 = 0 - 8 = -8\nt2: balance = x2      # balance = -8\n\n结果 balance = -8`, `78525945346836350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">初始值 balance = 0\n\nt1: x1 = balance + 5  # x1 = 0 + 5 = 5\n\nt2: x2 = balance + 8  # x2 = 0 + 8 = 8\nt2: balance = x2      # balance = 8\n\nt1: balance = x1      # balance = 5\nt1: x1 = balance - 5  # x1 = 5 - 5 = 0\nt1: balance = x1      # balance = 0\n\nt2: x2 = balance - 8  # x2 = 0 - 8 = -8\nt2: balance = x2      # balance = -8\n\n结果 balance = -8</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>究其原因，是因为修改 balance 需要多条语句，而执行这几条语句时，线程可能中断，从而导致多个线程把同一个对象的内容改乱了。</p>\n<p>两个线程同时一存一取，就可能导致余额不对，你肯定不希望你的银行存款莫名其妙地变成了负数，所以，我们必须确保一个线程在修改 balance 的时候，别的线程一定不能改。</p>\n<p>如果我们要确保 balance 计算正确，就要给 <code class="language-text">change_it()</code> 上一把锁，当某个线程开始执行 <code class="language-text">change_it()</code> 时，我们说，该线程因为获得了锁，因此其他线程不能同时执行 <code class="language-text">change_it()</code>，只能等待，直到锁被释放后，获得该锁以后才能改。由于锁只有一个，无论多少线程，同一时刻最多只有一个线程持有该锁，所以，不会造成修改的冲突。创建一个锁就是通过 threading.Lock() 来实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26018491082881590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`balance = 0\nlock = threading.Lock()\n\ndef run_thread(n):\n    for i in range(100000):\n        # 先要获取锁:\n        lock.acquire()\n        try:\n            # 放心地改吧:\n            change_it(n)\n        finally:\n            # 改完了一定要释放锁:\n            lock.release()`, `26018491082881590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">balance <span class="token operator">=</span> <span class="token number">0</span>\nlock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">run_thread</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token comment"># 先要获取锁:</span>\n        lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            <span class="token comment"># 放心地改吧:</span>\n            change_it<span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n        <span class="token keyword">finally</span><span class="token punctuation">:</span>\n            <span class="token comment"># 改完了一定要释放锁:</span>\n            lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当多个线程同时执行 lock.acquire() 时，只有一个线程能成功地获取锁，然后继续执行代码，其他线程就继续等待直到获得锁为止。</p>\n<p>获得锁的线程用完后一定要释放锁，否则那些苦苦等待锁的线程将永远等待下去，成为死线程。所以我们用 try…finally 来确保锁一定会被释放。</p>\n<p>锁的好处就是确保了某段关键代码只能由一个线程从头到尾完整地执行，坏处当然也很多，首先是阻止了多线程并发执行，包含锁的某段代码实际上只能以单线程模式执行，效率就大大地下降了。其次，由于可以存在多个锁，不同的线程持有不同的锁，并试图获取对方持有的锁时，可能会造成死锁，导致多个线程全部挂起，既不能执行，也无法结束，只能靠操作系统强制终止。</p>\n<h3 id="多核-cpu"><a href="#%E5%A4%9A%E6%A0%B8-cpu" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多核 CPU</h3>\n<p>如果你不幸拥有一个多核 CPU，你肯定在想，多核应该可以同时执行多个线程。</p>\n<p>如果写一个死循环的话，会出现什么情况呢？</p>\n<p>打开 Mac OS X 的 Activity Monitor，或者 Windows 的 Task Manager，都可以监控某个进程的 CPU 使用率。</p>\n<p>我们可以监控到一个死循环线程会 100% 占用一个 CPU。</p>\n<p>如果有两个死循环线程，在多核 CPU 中，可以监控到会占用 200% 的 CPU，也就是占用两个 CPU 核心。</p>\n<p>要想把 N 核 CPU 的核心全部跑满，就必须启动 N 个死循环线程。</p>\n<p>试试用 Python 写个死循环：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45623838947002390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import threading, multiprocessing\n\ndef loop():\n    x = 0\n    while True:\n        x = x ^ 1\n\nfor i in range(multiprocessing.cpu_count()):\n    t = threading.Thread(target=loop)\n    t.start()`, `45623838947002390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> threading<span class="token punctuation">,</span> multiprocessing\n\n<span class="token keyword">def</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    x <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n        x <span class="token operator">=</span> x <span class="token operator">^</span> <span class="token number">1</span>\n\n<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>multiprocessing<span class="token punctuation">.</span>cpu_count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>loop<span class="token punctuation">)</span>\n    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>启动与 CPU 核心数量相同的 N 个线程，在 4 核 CPU 上可以监控到 CPU 占用率仅有 102%，也就是仅使用了一核。</p>\n<p>但是用 C、C++或 Java 来改写相同的死循环，直接可以把全部核心跑满，4 核就跑到 400%，8 核就跑到 800%，为什么 Python 不行呢？</p>\n<p>因为 Python 的线程虽然是真正的线程，但解释器执行代码时，有一个 GIL 锁：Global Interpreter Lock，任何 Python 线程执行前，必须先获得 GIL 锁，然后，每执行 100 条字节码，解释器就自动释放 GIL 锁，让别的线程有机会执行。这个 GIL 全局锁实际上把所有线程的执行代码都给上了锁，所以，多线程在 Python 中只能交替执行，即使 100 个线程跑在 100 核 CPU 上，也只能用到 1 个核。</p>\n<p>GIL 是 Python 解释器设计的历史遗留问题，通常我们用的解释器是官方实现的 CPython，要真正利用多核，除非重写一个不带 GIL 的解释器。</p>\n<p>所以，在 Python 中，可以使用多线程，但不要指望能有效利用多核。如果一定要通过多线程利用多核，那只能通过 C 扩展来实现，不过这样就失去了 Python 简单易用的特点。</p>\n<p>不过，也不用过于担心，Python 虽然不能利用多线程实现多核任务，但可以通过多进程实现多核任务。多个 Python 进程有各自独立的 GIL 锁，互不影响。</p>\n<h3 id="小结-20"><a href="#%E5%B0%8F%E7%BB%93-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>多线程编程，模型复杂，容易发生冲突，必须用锁加以隔离，同时，又要小心死锁的发生。</p>\n<p>Python 解释器由于设计时有 GIL 全局锁，导致了多线程无法利用多核。多线程的并发在 Python 中就是一个美丽的梦。</p>\n<h2 id="threadlocal"><a href="#threadlocal" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ThreadLocal</h2>\n<p>在多线程环境下，每个线程都有自己的数据。一个线程使用自己的局部变量比使用全局变量好，因为局部变量只有线程自己能看见，不会影响其他线程，而全局变量的修改必须加锁。</p>\n<p>但是局部变量也有问题，就是在函数调用的时候，传递起来很麻烦：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13649129125061087000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def process_student(name):\n    std = Student(name)\n    # std 是局部变量，但是每个函数都要用它，因此必须传进去：\n    do_task_1(std)\n    do_task_2(std)\n\ndef do_task_1(std):\n    do_subtask_1(std)\n    do_subtask_2(std)\n\ndef do_task_2(std):\n    do_subtask_2(std)\n    do_subtask_2(std)`, `13649129125061087000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">process_student</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    std <span class="token operator">=</span> Student<span class="token punctuation">(</span>name<span class="token punctuation">)</span>\n    <span class="token comment"># std 是局部变量，但是每个函数都要用它，因此必须传进去：</span>\n    do_task_1<span class="token punctuation">(</span>std<span class="token punctuation">)</span>\n    do_task_2<span class="token punctuation">(</span>std<span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">do_task_1</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    do_subtask_1<span class="token punctuation">(</span>std<span class="token punctuation">)</span>\n    do_subtask_2<span class="token punctuation">(</span>std<span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">do_task_2</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    do_subtask_2<span class="token punctuation">(</span>std<span class="token punctuation">)</span>\n    do_subtask_2<span class="token punctuation">(</span>std<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>每个函数一层一层调用都这么传参数那还得了？用全局变量？也不行，因为每个线程处理不同的 Student 对象，不能共享。</p>\n<p>如果用一个全局 dict 存放所有的 Student 对象，然后以 thread 自身作为 key 获得线程对应的 Student 对象如何？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21092217589091344000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`global_dict = {}\n\ndef std_thread(name):\n    std = Student(name)\n    # 把 std 放到全局变量 global_dict 中：\n    global_dict[threading.current_thread()] = std\n    do_task_1()\n    do_task_2()\n\ndef do_task_1():\n    # 不传入 std，而是根据当前线程查找：\n    std = global_dict[threading.current_thread()]\n    ...\n\ndef do_task_2():\n    # 任何函数都可以查找出当前线程的 std 变量：\n    std = global_dict[threading.current_thread()]\n    ...`, `21092217589091344000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">global_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">def</span> <span class="token function">std_thread</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    std <span class="token operator">=</span> Student<span class="token punctuation">(</span>name<span class="token punctuation">)</span>\n    <span class="token comment"># 把 std 放到全局变量 global_dict 中：</span>\n    global_dict<span class="token punctuation">[</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> std\n    do_task_1<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    do_task_2<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">do_task_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># 不传入 std，而是根据当前线程查找：</span>\n    std <span class="token operator">=</span> global_dict<span class="token punctuation">[</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n\n<span class="token keyword">def</span> <span class="token function">do_task_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># 任何函数都可以查找出当前线程的 std 变量：</span>\n    std <span class="token operator">=</span> global_dict<span class="token punctuation">[</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种方式理论上是可行的，它最大的优点是消除了 std 对象在每层函数中的传递问题，但是，每个函数获取 std 的代码有点丑。</p>\n<p>有没有更简单的方式？</p>\n<p>ThreadLocal 应运而生，不用查找 dict，ThreadLocal 帮你自动做这件事：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89999219966722080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import threading\n\n# 创建全局 ThreadLocal 对象:\nlocal_school = threading.local()\n\ndef process_student():\n    # 获取当前线程关联的 student:\n    std = local_school.student\n    print(\'Hello, %s (in %s)\' % (std, threading.current_thread().name))\n\ndef process_thread(name):\n    # 绑定 ThreadLocal 的 student:\n    local_school.student = name\n    process_student()\n\nt1 = threading.Thread(target=process_thread, args=(\'Alice\',), name=\'Thread-A\')\nt2 = threading.Thread(target=process_thread, args=(\'Bob\',), name=\'Thread-B\')\nt1.start()\nt2.start()\nt1.join()\nt2.join()`, `89999219966722080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> threading\n\n<span class="token comment"># 创建全局 ThreadLocal 对象:</span>\nlocal_school <span class="token operator">=</span> threading<span class="token punctuation">.</span>local<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">process_student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># 获取当前线程关联的 student:</span>\n    std <span class="token operator">=</span> local_school<span class="token punctuation">.</span>student\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello, %s (in %s)\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>std<span class="token punctuation">,</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">process_thread</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># 绑定 ThreadLocal 的 student:</span>\n    local_school<span class="token punctuation">.</span>student <span class="token operator">=</span> name\n    process_student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\nt1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>process_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">\'Alice\'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'Thread-A\'</span><span class="token punctuation">)</span>\nt2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>process_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">\'Bob\'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'Thread-B\'</span><span class="token punctuation">)</span>\nt1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\nt2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\nt1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>\nt2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行结果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58478741233366140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Hello, Alice (in Thread-A)\nHello, Bob (in Thread-B)`, `58478741233366140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Hello, Alice <span class="token punctuation">(</span>in Thread-A<span class="token punctuation">)</span>\nHello, Bob <span class="token punctuation">(</span>in Thread-B<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>全局变量 <code class="language-text">local_school</code> 就是一个 ThreadLocal 对象，每个 Thread 对它都可以读写 student 属性，但互不影响。你可以把 <code class="language-text">local_school</code> 看成全局变量，但每个属性如 <code class="language-text">local_school.student</code> 都是线程的局部变量，可以任意读写而互不干扰，也不用管理锁的问题，ThreadLocal 内部会处理。</p>\n<p>可以理解为全局变量 <code class="language-text">local_school</code> 是一个 dict，不但可以用 <code class="language-text">local_school.student</code>，还可以绑定其他变量，如 <code class="language-text">local_school.teacher</code> 等等。</p>\n<p>ThreadLocal 最常用的地方就是为每个线程绑定一个数据库连接，HTTP 请求，用户身份信息等，这样一个线程的所有调用到的处理函数都可以非常方便地访问这些资源。</p>\n<h3 id="小结-21"><a href="#%E5%B0%8F%E7%BB%93-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>一个 ThreadLocal 变量虽然是全局变量，但每个线程都只能读写自己线程的独立副本，互不干扰。ThreadLocal 解决了参数在一个线程中各个函数之间互相传递的问题。</p>\n<h2 id="进程-vs-线程"><a href="#%E8%BF%9B%E7%A8%8B-vs-%E7%BA%BF%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>进程 vs 线程</h2>\n<p>首先，要实现多任务，通常我们会设计 Master-Worker 模式，Master 负责分配任务，Worker 负责执行任务，因此，多任务环境下，通常是一个 Master，多个 Worker。</p>\n<ol>\n<li>如果用多进程实现 Master-Worker，主进程就是 Master，其他进程就是 Worker。</li>\n<li>如果用多线程实现 Master-Worker，主线程就是 Master，其他线程就是 Worker。</li>\n</ol>\n<p>多进程模式最大的优点就是稳定性高，因为一个子进程崩溃了，不会影响主进程和其他子进程。（当然主进程挂了所有进程就全挂了，但是 Master 进程只负责分配任务，挂掉的概率低）著名的 Apache 最早就是采用多进程模式。</p>\n<p>多进程模式的缺点是创建进程的代价大，在 Unix/Linux 系统下，用 fork 调用还行，在 Windows 下创建进程开销巨大。另外，操作系统能同时运行的进程数也是有限的，在内存和 CPU 的限制下，如果有几千个进程同时运行，操作系统连调度都会成问题。</p>\n<p>多线程模式通常比多进程快一点，但是也快不到哪去，而且，多线程模式致命的缺点就是任何一个线程挂掉都可能直接造成整个进程崩溃，因为所有线程共享进程的内存。在 Windows 上，如果一个线程执行的代码出了问题，你经常可以看到这样的提示：“该程序执行了非法操作，即将关闭”，其实往往是某个线程出了问题，但是操作系统会强制结束整个进程。</p>\n<p>在 Windows 下，多线程的效率比多进程要高，所以微软的 IIS 服务器默认采用多线程模式。由于多线程存在稳定性的问题，IIS 的稳定性就不如 Apache。为了缓解这个问题，IIS 和 Apache 现在又有多进程+多线程的混合模式，真是把问题越搞越复杂。</p>\n<h3 id="线程切换"><a href="#%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>线程切换</h3>\n<p>无论是多进程还是多线程，只要数量一多，效率肯定上不去，为什么呢？</p>\n<p>我们打个比方，假设你不幸正在准备中考，每天晚上需要做语文、数学、英语、物理、化学这 5 科的作业，每项作业耗时 1 小时。</p>\n<p>如果你先花 1 小时做语文作业，做完了，再花 1 小时做数学作业，这样，依次全部做完，一共花 5 小时，这种方式称为单任务模型，或者批处理任务模型。</p>\n<p>假设你打算切换到多任务模型，可以先做 1 分钟语文，再切换到数学作业，做 1 分钟，再切换到英语，以此类推，只要切换速度足够快，这种方式就和单核 CPU 执行多任务是一样的了，以幼儿园小朋友的眼光来看，你就正在同时写 5 科作业。</p>\n<p>但是，切换作业是有代价的，比如从语文切到数学，要先收拾桌子上的语文书本、钢笔（这叫保存现场），然后，打开数学课本、找出圆规直尺（这叫准备新环境），才能开始做数学作业。操作系统在切换进程或者线程时也是一样的，它需要先保存当前执行的现场环境（CPU 寄存器状态、内存页等），然后，把新任务的执行环境准备好（恢复上次的寄存器状态，切换内存页等），才能开始执行。这个切换过程虽然很快，但是也需要耗费时间。如果有几千个任务同时进行，操作系统可能就主要忙着切换任务，根本没有多少时间去执行任务了，这种情况最常见的就是硬盘狂响，点窗口无反应，系统处于假死状态。</p>\n<p>所以，多任务一旦多到一个限度，就会消耗掉系统所有的资源，结果效率急剧下降，所有任务都做不好。</p>\n<h3 id="计算密集型-vs-io-密集型"><a href="#%E8%AE%A1%E7%AE%97%E5%AF%86%E9%9B%86%E5%9E%8B-vs-io-%E5%AF%86%E9%9B%86%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>计算密集型 vs IO 密集型</h3>\n<p>是否采用多任务的第二个考虑是任务的类型。我们可以把任务分为计算密集型和 IO 密集型。</p>\n<p>计算密集型任务的特点是要进行大量的计算，消耗 CPU 资源，比如计算圆周率、对视频进行高清解码等等，全靠 CPU 的运算能力。这种计算密集型任务虽然也可以用多任务完成，但是任务越多，花在任务切换的时间就越多，CPU 执行任务的效率就越低，所以，要最高效地利用 CPU，计算密集型任务同时进行的数量应当等于 CPU 的核心数。</p>\n<p>计算密集型任务由于主要消耗 CPU 资源，因此，代码运行效率至关重要。Python 这样的脚本语言运行效率很低，完全不适合计算密集型任务。对于计算密集型任务，最好用 C 语言编写。</p>\n<p>第二种任务的类型是 IO 密集型，涉及到网络、磁盘 IO 的任务都是 IO 密集型任务，这类任务的特点是 CPU 消耗很少，任务的大部分时间都在等待 IO 操作完成（因为 IO 的速度远远低于 CPU 和内存的速度）。对于 IO 密集型任务，任务越多，CPU 效率越高，但也有一个限度。常见的大部分任务都是 IO 密集型任务，比如 Web 应用。</p>\n<p>IO 密集型任务执行期间，99% 的时间都花在 IO 上，花在 CPU 上的时间很少，因此，用运行速度极快的 C 语言替换用 Python 这样运行速度极低的脚本语言，完全无法提升运行效率。对于 IO 密集型任务，最合适的语言就是开发效率最高（代码量最少）的语言，脚本语言是首选，C 语言最差。</p>\n<h3 id="异步-io"><a href="#%E5%BC%82%E6%AD%A5-io" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步 IO</h3>\n<p>考虑到 CPU 和 IO 之间巨大的速度差异，一个任务在执行的过程中大部分时间都在等待 IO 操作，单进程单线程模型会导致别的任务无法并行执行，因此，我们才需要多进程模型或者多线程模型来支持多任务并发执行。</p>\n<p>现代操作系统对 IO 操作已经做了巨大的改进，最大的特点就是支持异步 IO。如果充分利用操作系统提供的异步 IO 支持，就可以用单进程单线程模型来执行多任务，这种全新的模型称为事件驱动模型，Nginx 就是支持异步 IO 的 Web 服务器，它在单核 CPU 上采用单进程模型就可以高效地支持多任务。在多核 CPU 上，可以运行多个进程（数量与 CPU 核心数相同），充分利用多核 CPU。由于系统总的进程数量十分有限，因此操作系统调度非常高效。用异步 IO 编程模型来实现多任务是一个主要的趋势。</p>\n<p>对应到 Python 语言，单线程的异步编程模型称为协程，有了协程的支持，就可以基于事件驱动编写高效的多任务程序。我们会在后面讨论如何编写协程。</p>\n<h2 id="分布式进程"><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E8%BF%9B%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分布式进程</h2>\n<p>在 Thread 和 Process 中，应当优选 Process，因为 Process 更稳定，而且，Process 可以分布到多台机器上，而 Thread 最多只能分布到同一台机器的多个 CPU 上。</p>\n<p>Python 的 multiprocessing 模块不但支持多进程，其中 managers 子模块还支持把多进程分布到多台机器上。一个服务进程可以作为调度者，将任务分布到其他多个进程中，依靠网络通信。由于 managers 模块封装很好，不必了解网络通信的细节，就可以很容易地编写分布式多进程程序。</p>\n<p>举个例子：如果我们已经有一个通过 Queue 通信的多进程程序在同一台机器上运行，现在，由于处理任务的进程任务繁重，希望把发送任务的进程和处理任务的进程分布到两台机器上。怎么用分布式进程实现？</p>\n<p>原有的 Queue 可以继续使用，但是，通过 managers 模块把 Queue 通过网络暴露出去，就可以让其他机器的进程访问 Queue 了。</p>\n<p>我们先看服务进程，服务进程负责启动 Queue，把 Queue 注册到网络上，然后往 Queue 里面写入任务：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15038948832969546000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# task_master.py\n\nimport random, time, queue\nfrom multiprocessing.managers import BaseManager\n\n# 发送任务的队列:\ntask_queue = queue.Queue()\n# 接收结果的队列:\nresult_queue = queue.Queue()\n\n# 从 BaseManager 继承的 QueueManager:\nclass QueueManager(BaseManager):\n    pass\n\n# 把两个 Queue 都注册到网络上, callable 参数关联了 Queue 对象:\nQueueManager.register(\'get_task_queue\', callable=lambda: task_queue)\nQueueManager.register(\'get_result_queue\', callable=lambda: result_queue)\n# 绑定端口 5000, 设置验证码 \'abc\':\nmanager = QueueManager(address=(\'\', 5000), authkey=b\'abc\')\n# 启动 Queue:\nmanager.start()\n\n# 获得通过网络访问的 Queue 对象:\ntask = manager.get_task_queue()\nresult = manager.get_result_queue()\n# 放几个任务进去:\nfor i in range(10):\n    n = random.randint(0, 10000)\n    print(\'Put task %d...\' % n)\n    task.put(n)\n# 从 result 队列读取结果:\nprint(\'Try get results...\')\nfor i in range(10):\n    r = result.get(timeout=10)\n    print(\'Result: %s\' % r)\n# 关闭:\nmanager.shutdown()\nprint(\'master exit.\')`, `15038948832969546000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># task_master.py</span>\n\n<span class="token keyword">import</span> random<span class="token punctuation">,</span> time<span class="token punctuation">,</span> queue\n<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager\n\n<span class="token comment"># 发送任务的队列:</span>\ntask_queue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 接收结果的队列:</span>\nresult_queue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 从 BaseManager 继承的 QueueManager:</span>\n<span class="token keyword">class</span> <span class="token class-name">QueueManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token comment"># 把两个 Queue 都注册到网络上, callable 参数关联了 Queue 对象:</span>\nQueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">\'get_task_queue\'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> task_queue<span class="token punctuation">)</span>\nQueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">\'get_result_queue\'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> result_queue<span class="token punctuation">)</span>\n<span class="token comment"># 绑定端口 5000, 设置验证码 \'abc\':</span>\nmanager <span class="token operator">=</span> QueueManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span><span class="token string">b\'abc\'</span><span class="token punctuation">)</span>\n<span class="token comment"># 启动 Queue:</span>\nmanager<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 获得通过网络访问的 Queue 对象:</span>\ntask <span class="token operator">=</span> manager<span class="token punctuation">.</span>get_task_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>\nresult <span class="token operator">=</span> manager<span class="token punctuation">.</span>get_result_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 放几个任务进去:</span>\n<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    n <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Put task %d...\'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>\n    task<span class="token punctuation">.</span>put<span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n<span class="token comment"># 从 result 队列读取结果:</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Try get results...\'</span><span class="token punctuation">)</span>\n<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    r <span class="token operator">=</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Result: %s\'</span> <span class="token operator">%</span> r<span class="token punctuation">)</span>\n<span class="token comment"># 关闭:</span>\nmanager<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'master exit.\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>请注意，当我们在一台机器上写多进程程序时，创建的 Queue 可以直接拿来用，但是，在分布式多进程环境下，添加任务到 Queue 不可以直接对原始的 <code class="language-text">task_queue</code> 进行操作，那样就绕过了 QueueManager 的封装，必须通过 <code class="language-text">manager.get_task_queue()</code> 获得的 Queue 接口添加。</p>\n<p>然后，在另一台机器上启动任务进程（本机上启动也可以）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93471007076249600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# task_worker.py\n\nimport time, sys, queue\nfrom multiprocessing.managers import BaseManager\n\n# 创建类似的 QueueManager:\nclass QueueManager(BaseManager):\n    pass\n\n# 由于这个 QueueManager 只从网络上获取 Queue，所以注册时只提供名字:\nQueueManager.register(\'get_task_queue\')\nQueueManager.register(\'get_result_queue\')\n\n# 连接到服务器，也就是运行 task_master.py 的机器:\nserver_addr = \'127.0.0.1\'\nprint(\'Connect to server %s...\' % server_addr)\n# 端口和验证码注意保持与 task_master.py 设置的完全一致:\nm = QueueManager(address=(server_addr, 5000), authkey=b\'abc\')\n# 从网络连接:\nm.connect()\n# 获取 Queue 的对象:\ntask = m.get_task_queue()\nresult = m.get_result_queue()\n# 从 task 队列取任务,并把结果写入 result 队列:\nfor i in range(10):\n    try:\n        n = task.get(timeout=1)\n        print(\'run task %d * %d...\' % (n, n))\n        r = \'%d * %d = %d\' % (n, n, n*n)\n        time.sleep(1)\n        result.put(r)\n    except Queue.Empty:\n        print(\'task queue is empty.\')\n# 处理结束:\nprint(\'worker exit.\')`, `93471007076249600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># task_worker.py</span>\n\n<span class="token keyword">import</span> time<span class="token punctuation">,</span> sys<span class="token punctuation">,</span> queue\n<span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager\n\n<span class="token comment"># 创建类似的 QueueManager:</span>\n<span class="token keyword">class</span> <span class="token class-name">QueueManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n<span class="token comment"># 由于这个 QueueManager 只从网络上获取 Queue，所以注册时只提供名字:</span>\nQueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">\'get_task_queue\'</span><span class="token punctuation">)</span>\nQueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">\'get_result_queue\'</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 连接到服务器，也就是运行 task_master.py 的机器:</span>\nserver_addr <span class="token operator">=</span> <span class="token string">\'127.0.0.1\'</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Connect to server %s...\'</span> <span class="token operator">%</span> server_addr<span class="token punctuation">)</span>\n<span class="token comment"># 端口和验证码注意保持与 task_master.py 设置的完全一致:</span>\nm <span class="token operator">=</span> QueueManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span><span class="token string">b\'abc\'</span><span class="token punctuation">)</span>\n<span class="token comment"># 从网络连接:</span>\nm<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 获取 Queue 的对象:</span>\ntask <span class="token operator">=</span> m<span class="token punctuation">.</span>get_task_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>\nresult <span class="token operator">=</span> m<span class="token punctuation">.</span>get_result_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 从 task 队列取任务,并把结果写入 result 队列:</span>\n<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        n <span class="token operator">=</span> task<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'run task %d * %d...\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        r <span class="token operator">=</span> <span class="token string">\'%d * %d = %d\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span> n<span class="token punctuation">,</span> n<span class="token operator">*</span>n<span class="token punctuation">)</span>\n        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n        result<span class="token punctuation">.</span>put<span class="token punctuation">(</span>r<span class="token punctuation">)</span>\n    <span class="token keyword">except</span> Queue<span class="token punctuation">.</span>Empty<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'task queue is empty.\'</span><span class="token punctuation">)</span>\n<span class="token comment"># 处理结束:</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'worker exit.\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>任务进程要通过网络连接到服务进程，所以要指定服务进程的 IP。</p>\n<p>现在，可以试试分布式进程的工作效果了。先启动 <code class="language-text">task_master.py</code> 服务进程：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11137018431946033000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python3 task_master.py\nPut task 3411...\nPut task 1605...\nPut task 1398...\nPut task 4729...\nPut task 5300...\nPut task 7471...\nPut task 68...\nPut task 4219...\nPut task 339...\nPut task 7866...\nTry get results...`, `11137018431946033000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python3 task_master.py\nPut task <span class="token number">3411</span><span class="token punctuation">..</span>.\nPut task <span class="token number">1605</span><span class="token punctuation">..</span>.\nPut task <span class="token number">1398</span><span class="token punctuation">..</span>.\nPut task <span class="token number">4729</span><span class="token punctuation">..</span>.\nPut task <span class="token number">5300</span><span class="token punctuation">..</span>.\nPut task <span class="token number">7471</span><span class="token punctuation">..</span>.\nPut task <span class="token number">68</span><span class="token punctuation">..</span>.\nPut task <span class="token number">4219</span><span class="token punctuation">..</span>.\nPut task <span class="token number">339</span><span class="token punctuation">..</span>.\nPut task <span class="token number">7866</span><span class="token punctuation">..</span>.\nTry get results<span class="token punctuation">..</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">task_master.py</code> 进程发送完任务后，开始等待 result 队列的结果。现在启动 <code class="language-text">task_worker.py</code> 进程：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40670302725161320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ python3 task_worker.py\nConnect to server 127.0.0.1...\nrun task 3411 * 3411...\nrun task 1605 * 1605...\nrun task 1398 * 1398...\nrun task 4729 * 4729...\nrun task 5300 * 5300...\nrun task 7471 * 7471...\nrun task 68 * 68...\nrun task 4219 * 4219...\nrun task 339 * 339...\nrun task 7866 * 7866...\nworker exit.`, `40670302725161320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ python3 task_worker.py\nConnect to server <span class="token number">127.0</span>.0.1<span class="token punctuation">..</span>.\nrun task <span class="token number">3411</span> * <span class="token number">3411</span><span class="token punctuation">..</span>.\nrun task <span class="token number">1605</span> * <span class="token number">1605</span><span class="token punctuation">..</span>.\nrun task <span class="token number">1398</span> * <span class="token number">1398</span><span class="token punctuation">..</span>.\nrun task <span class="token number">4729</span> * <span class="token number">4729</span><span class="token punctuation">..</span>.\nrun task <span class="token number">5300</span> * <span class="token number">5300</span><span class="token punctuation">..</span>.\nrun task <span class="token number">7471</span> * <span class="token number">7471</span><span class="token punctuation">..</span>.\nrun task <span class="token number">68</span> * <span class="token number">68</span><span class="token punctuation">..</span>.\nrun task <span class="token number">4219</span> * <span class="token number">4219</span><span class="token punctuation">..</span>.\nrun task <span class="token number">339</span> * <span class="token number">339</span><span class="token punctuation">..</span>.\nrun task <span class="token number">7866</span> * <span class="token number">7866</span><span class="token punctuation">..</span>.\nworker exit.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">task_worker.py</code> 进程结束，在 <code class="language-text">task_master.py</code> 进程中会继续打印出结果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4977682276020979000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Result: 3411 * 3411 = 11634921\nResult: 1605 * 1605 = 2576025\nResult: 1398 * 1398 = 1954404\nResult: 4729 * 4729 = 22363441\nResult: 5300 * 5300 = 28090000\nResult: 7471 * 7471 = 55815841\nResult: 68 * 68 = 4624\nResult: 4219 * 4219 = 17799961\nResult: 339 * 339 = 114921\nResult: 7866 * 7866 = 61873956`, `4977682276020979000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Result: <span class="token number">3411</span> * <span class="token number">3411</span> <span class="token operator">=</span> <span class="token number">11634921</span>\nResult: <span class="token number">1605</span> * <span class="token number">1605</span> <span class="token operator">=</span> <span class="token number">2576025</span>\nResult: <span class="token number">1398</span> * <span class="token number">1398</span> <span class="token operator">=</span> <span class="token number">1954404</span>\nResult: <span class="token number">4729</span> * <span class="token number">4729</span> <span class="token operator">=</span> <span class="token number">22363441</span>\nResult: <span class="token number">5300</span> * <span class="token number">5300</span> <span class="token operator">=</span> <span class="token number">28090000</span>\nResult: <span class="token number">7471</span> * <span class="token number">7471</span> <span class="token operator">=</span> <span class="token number">55815841</span>\nResult: <span class="token number">68</span> * <span class="token number">68</span> <span class="token operator">=</span> <span class="token number">4624</span>\nResult: <span class="token number">4219</span> * <span class="token number">4219</span> <span class="token operator">=</span> <span class="token number">17799961</span>\nResult: <span class="token number">339</span> * <span class="token number">339</span> <span class="token operator">=</span> <span class="token number">114921</span>\nResult: <span class="token number">7866</span> * <span class="token number">7866</span> <span class="token operator">=</span> <span class="token number">61873956</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个简单的 Master/Worker 模型有什么用？其实这就是一个简单但真正的分布式计算，把代码稍加改造，启动多个 worker，就可以把任务分布到几台甚至几十台机器上，比如把计算 n*n 的代码换成发送邮件，就实现了邮件队列的异步发送。</p>\n<p>Queue 对象存储在哪？注意到 <code class="language-text">task_worker.py</code> 中根本没有创建 Queue 的代码，所以，Queue 对象存储在 <code class="language-text">task_master.py</code> 进程中：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43299941274248544000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`                                             │\n┌─────────────────────────────────────────┐     ┌──────────────────────────────────────┐\n│task_master.py                           │  │  │task_worker.py                        │\n│                                         │     │                                      │\n│  task = manager.get_task_queue()        │  │  │  task = manager.get_task_queue()     │\n│  result = manager.get_result_queue()    │     │  result = manager.get_result_queue() │\n│              │                          │  │  │              │                       │\n│              │                          │     │              │                       │\n│              ▼                          │  │  │              │                       │\n│  ┌─────────────────────────────────┐    │     │              │                       │\n│  │QueueManager                     │    │  │  │              │                       │\n│  │ ┌────────────┐ ┌──────────────┐ │    │     │              │                       │\n│  │ │ task_queue │ │ result_queue │ │<───┼──┼──┼──────────────┘                       │\n│  │ └────────────┘ └──────────────┘ │    │     │                                      │\n│  └─────────────────────────────────┘    │  │  │                                      │\n└─────────────────────────────────────────┘     └──────────────────────────────────────┘\n                                             │\n\n                                          Network`, `43299941274248544000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">                                             │\n┌─────────────────────────────────────────┐     ┌──────────────────────────────────────┐\n│task_master.py                           │  │  │task_worker.py                        │\n│                                         │     │                                      │\n│  task = manager.get_task_queue()        │  │  │  task = manager.get_task_queue()     │\n│  result = manager.get_result_queue()    │     │  result = manager.get_result_queue() │\n│              │                          │  │  │              │                       │\n│              │                          │     │              │                       │\n│              ▼                          │  │  │              │                       │\n│  ┌─────────────────────────────────┐    │     │              │                       │\n│  │QueueManager                     │    │  │  │              │                       │\n│  │ ┌────────────┐ ┌──────────────┐ │    │     │              │                       │\n│  │ │ task_queue │ │ result_queue │ │&lt;───┼──┼──┼──────────────┘                       │\n│  │ └────────────┘ └──────────────┘ │    │     │                                      │\n│  └─────────────────────────────────┘    │  │  │                                      │\n└─────────────────────────────────────────┘     └──────────────────────────────────────┘\n                                             │\n\n                                          Network</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而 Queue 之所以能通过网络访问，就是通过 QueueManager 实现的。由于 QueueManager 管理的不止一个 Queue，所以，要给每个 Queue 的网络调用接口起个名字，比如 <code class="language-text">get_task_queue</code>。</p>\n<p>authkey 有什么用？这是为了保证两台机器正常通信，不被其他机器恶意干扰。如果 <code class="language-text">task_worker.py</code> 的 authkey 和 <code class="language-text">task_master.py</code> 的 authkey 不一致，肯定连接不上。</p>\n<h3 id="小结-22"><a href="#%E5%B0%8F%E7%BB%93-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>Python 的分布式进程接口简单，封装良好，适合需要把繁重任务分布到多台机器的环境下。</p>\n<p>注意 Queue 的作用是用来传递任务和接收结果，每个任务的描述数据量要尽量小。比如发送一个处理日志文件的任务，就不要发送几百兆的日志文件本身，而是发送日志文件存放的完整路径，由 Worker 进程再去共享的磁盘上读取文件。</p>\n<h1 id="正则表达式"><a href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>正则表达式</h1>\n<h2 id="re-模块"><a href="#re-%E6%A8%A1%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>re 模块</h2>\n<p>Python 提供 re 模块，包含所有正则表达式的功能。由于 Python 的字符串本身也用 \\ 转义，所以要特别注意：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68974069588239910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`s = \'ABC\\\\-001\' # Python 的字符串\n# 对应的正则表达式字符串变成：\n# \'ABC\\-001\'`, `68974069588239910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">s <span class="token operator">=</span> <span class="token string">\'ABC\\\\-001\'</span> <span class="token comment"># Python 的字符串</span>\n<span class="token comment"># 对应的正则表达式字符串变成：</span>\n<span class="token comment"># \'ABC\\-001\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>因此我们强烈建议使用 Python 的 r 前缀，就不用考虑转义的问题了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63403926917546110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`s = r\'ABC\\-001\' # Python 的字符串\n# 对应的正则表达式字符串不变：\n# \'ABC\\-001\'`, `63403926917546110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">s <span class="token operator">=</span> <span class="token string">r\'ABC\\-001\'</span> <span class="token comment"># Python 的字符串</span>\n<span class="token comment"># 对应的正则表达式字符串不变：</span>\n<span class="token comment"># \'ABC\\-001\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>先看看如何判断正则表达式是否匹配：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89147797972954810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import re\n>>> re.match(r\'^\\d{3}\\-\\d{3,8}\\$\', \'010-12345\')\n<_sre.SRE_Match object; span=(0, 9), match=\'010-12345\'>\n>>> re.match(r\'^\\d{3}\\-\\d{3,8}\\$\', \'010 12345\')\n>>>`, `89147797972954810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> re\n<span class="token operator">>></span><span class="token operator">></span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r\'^\\d{3}\\-\\d{3,8}$\'</span><span class="token punctuation">,</span> <span class="token string">\'010-12345\'</span><span class="token punctuation">)</span>\n<span class="token operator">&lt;</span>_sre<span class="token punctuation">.</span>SRE_Match <span class="token builtin">object</span><span class="token punctuation">;</span> span<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> match<span class="token operator">=</span><span class="token string">\'010-12345\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r\'^\\d{3}\\-\\d{3,8}$\'</span><span class="token punctuation">,</span> <span class="token string">\'010 12345\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>match() 方法判断是否匹配，如果匹配成功，返回一个 Match 对象，否则返回 None。常见的判断方法就是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98885074654117580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`test = \'用户输入的字符串\'\nif re.match(r\'正则表达式\', test):\n    print(\'ok\')\nelse:\n    print(\'failed\')`, `98885074654117580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">test <span class="token operator">=</span> <span class="token string">\'用户输入的字符串\'</span>\n<span class="token keyword">if</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r\'正则表达式\'</span><span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'ok\'</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'failed\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="切分字符串"><a href="#%E5%88%87%E5%88%86%E5%AD%97%E7%AC%A6%E4%B8%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>切分字符串</h3>\n<p>用正则表达式切分字符串比用固定的字符更灵活，请看正常的切分代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28619854274222002000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> \'a b   c\'.split(\' \')\n[\'a\', \'b\', \'\', \'\', \'c\']`, `28619854274222002000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">\'a b   c\'</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>嗯，无法识别连续的空格，用正则表达式试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87982446479028240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> re.split(r\'\\s+\', \'a b   c\')\n[\'a\', \'b\', \'c\']`, `87982446479028240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r\'\\s+\'</span><span class="token punctuation">,</span> <span class="token string">\'a b   c\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>无论多少个空格都可以正常分割。加入 <code class="language-text">,</code> 试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45059357475561640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> re.split(r\'[\\s\\,]+\', \'a,b, c  d\')\n[\'a\', \'b\', \'c\', \'d\']`, `45059357475561640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r\'[\\s\\,]+\'</span><span class="token punctuation">,</span> <span class="token string">\'a,b, c  d\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>再加入 <code class="language-text">;</code> 试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5231159824503129000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> re.split(r\'[\\s\\,\\;]+\', \'a,b;; c  d\')\n[\'a\', \'b\', \'c\', \'d\']`, `5231159824503129000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r\'[\\s\\,\\;]+\'</span><span class="token punctuation">,</span> <span class="token string">\'a,b;; c  d\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果用户输入了一组标签，下次记得用正则表达式来把不规范的输入转化成正确的数组。</p>\n<h3 id="分组"><a href="#%E5%88%86%E7%BB%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分组</h3>\n<p>除了简单地判断是否匹配之外，正则表达式还有提取子串的强大功能。用 () 表示的就是要提取的分组（Group）。比如：</p>\n<p><code class="language-text">^(\\d{3})-(\\d{3,8})$</code> 分别定义了两个组，可以直接从匹配的字符串中提取出区号和本地号码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88201471654751880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> m = re.match(r\'^(\\d{3})-(\\d{3,8})\\$\', \'010-12345\')\n>>> m\n<_sre.SRE_Match object; span=(0, 9), match=\'010-12345\'>\n>>> m.group(0)\n\'010-12345\'\n>>> m.group(1)\n\'010\'\n>>> m.group(2)\n\'12345\'`, `88201471654751880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> m <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r\'^(\\d{3})-(\\d{3,8})$\'</span><span class="token punctuation">,</span> <span class="token string">\'010-12345\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> m\n<span class="token operator">&lt;</span>_sre<span class="token punctuation">.</span>SRE_Match <span class="token builtin">object</span><span class="token punctuation">;</span> span<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> match<span class="token operator">=</span><span class="token string">\'010-12345\'</span><span class="token operator">></span>\n<span class="token operator">>></span><span class="token operator">></span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\n<span class="token string">\'010-12345\'</span>\n<span class="token operator">>></span><span class="token operator">></span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token string">\'010\'</span>\n<span class="token operator">>></span><span class="token operator">></span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token string">\'12345\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果正则表达式中定义了组，就可以在 Match 对象上用 group() 方法提取出子串来。</p>\n<p>注意到 group(0) 永远是与整个正则表达式相匹配的字符串，group(1)、group(2)…… 表示第 1、2、…… 个子串。</p>\n<p>提取子串非常有用。来看一个更凶残的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54976123970513190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> t = \'19:05:30\'\n>>> m = re.match(r\'^(0[0-9]|1[0-9]|2[0-3]|[0-9])\\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])\\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])\\$\', t)\n>>> m.groups()\n(\'19\', \'05\', \'30\')`, `54976123970513190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> t <span class="token operator">=</span> <span class="token string">\'19:05:30\'</span>\n<span class="token operator">>></span><span class="token operator">></span> m <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r\'^(0[0-9]|1[0-9]|2[0-3]|[0-9])\\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])\\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])$\'</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> m<span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token string">\'19\'</span><span class="token punctuation">,</span> <span class="token string">\'05\'</span><span class="token punctuation">,</span> <span class="token string">\'30\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个正则表达式可以直接识别合法的时间。但是有些时候，用正则表达式也无法做到完全验证，比如识别日期：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66015637260067450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\'^(0[1-9]|1[0-2]|[0-9])-(0[1-9]|1[0-9]|2[0-9]|3[0-1]|[0-9])\\$\'`, `66015637260067450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token string">\'^(0[1-9]|1[0-2]|[0-9])-(0[1-9]|1[0-9]|2[0-9]|3[0-1]|[0-9])$\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>对于 ‘2-30’，‘4-31’ 这样的非法日期，用正则还是识别不了，或者说写出来非常困难，这时就需要程序配合识别了。</p>\n<h3 id="贪婪匹配"><a href="#%E8%B4%AA%E5%A9%AA%E5%8C%B9%E9%85%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>贪婪匹配</h3>\n<p>最后需要特别指出的是，正则匹配默认是贪婪匹配，也就是匹配尽可能多的字符。举例如下，匹配出数字后面的 0：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29502602659176680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> re.match(r\'^(\\d+)(0*)\\$\', \'102300\').groups()\n(\'102300\', \'\')`, `29502602659176680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r\'^(\\d+)(0*)$\'</span><span class="token punctuation">,</span> <span class="token string">\'102300\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token string">\'102300\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>由于 <code class="language-text">\\d+</code> 采用贪婪匹配，直接把后面的 0 全部匹配了，结果 <code class="language-text">0*</code> 只能匹配空字符串了。</p>\n<p>必须让 <code class="language-text">\\d+</code> 采用非贪婪匹配（也就是尽可能少匹配），才能把后面的 0 匹配出来，加个 <code class="language-text">?</code> 就可以让 <code class="language-text">\\d+</code> 采用非贪婪匹配：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98372807805774410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> re.match(r\'^(\\d+?)(0*)\\$\', \'102300\').groups()\n(\'1023\', \'00\')`, `98372807805774410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r\'^(\\d+?)(0*)$\'</span><span class="token punctuation">,</span> <span class="token string">\'102300\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token string">\'1023\'</span><span class="token punctuation">,</span> <span class="token string">\'00\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="编译"><a href="#%E7%BC%96%E8%AF%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编译</h3>\n<p>当我们在 Python 中使用正则表达式时，re 模块内部会干两件事情：</p>\n<ol>\n<li>编译正则表达式，如果正则表达式的字符串本身不合法，会报错；</li>\n<li>用编译后的正则表达式去匹配字符串。</li>\n</ol>\n<p>如果一个正则表达式要重复使用几千次，出于效率的考虑，我们可以预编译该正则表达式，接下来重复使用时就不需要编译这个步骤了，直接匹配：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80540324467597570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`>>> import re\n# 编译:\n>>> re_telephone = re.compile(r\'^(\\d{3})-(\\d{3,8})\\$\')\n# 使用：\n>>> re_telephone.match(\'010-12345\').groups()\n(\'010\', \'12345\')\n>>> re_telephone.match(\'010-8086\').groups()\n(\'010\', \'8086\')`, `80540324467597570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> re\n<span class="token comment"># 编译:</span>\n<span class="token operator">>></span><span class="token operator">></span> re_telephone <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r\'^(\\d{3})-(\\d{3,8})$\'</span><span class="token punctuation">)</span>\n<span class="token comment"># 使用：</span>\n<span class="token operator">>></span><span class="token operator">></span> re_telephone<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">\'010-12345\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token string">\'010\'</span><span class="token punctuation">,</span> <span class="token string">\'12345\'</span><span class="token punctuation">)</span>\n<span class="token operator">>></span><span class="token operator">></span> re_telephone<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">\'010-8086\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token string">\'010\'</span><span class="token punctuation">,</span> <span class="token string">\'8086\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>编译后生成 Regular Expression 对象，由于该对象自己包含了正则表达式，所以调用对应的方法时不用给出正则字符串。</p>\n<h3 id="小结-23"><a href="#%E5%B0%8F%E7%BB%93-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>正则表达式非常强大，要在短短的一节里讲完是不可能的。要讲清楚正则的所有内容，可以写一本厚厚的书了。如果你经常遇到正则表达式的问题，你可能需要一本正则表达式的参考书。</p>\n<h1 id="virtualenv"><a href="#virtualenv" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>virtualenv</h1>\n<p>virtualenv 就是用来为一个应用创建一套“隔离”的 Python 运行环境。</p>\n<p>首先，我们用 pip 安装 virtualenv：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56670008707207460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ pip3 install virtualenv`, `56670008707207460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ pip3 <span class="token function">install</span> virtualenv</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后，假定我们要开发一个新的项目，需要一套独立的 Python 运行环境，可以这么做：</p>\n<p>第一步，创建目录：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38918392130663860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Mac:~ michael\\$ mkdir myproject\nMac:~ michael\\$ cd myproject/\nMac:myproject michael\\$`, `38918392130663860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Mac:~ michael$ <span class="token function">mkdir</span> myproject\nMac:~ michael$ <span class="token builtin class-name">cd</span> myproject/\nMac:myproject michael$</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>第二步，创建一个独立的 Python 运行环境，命名为 venv：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79248273420137780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Mac:myproject michael\\$ virtualenv --no-site-packages venv\nUsing base prefix \'/usr/local/.../Python.framework/Versions/3.4\'\nNew python executable in venv/bin/python3.4\nAlso creating executable in venv/bin/python\nInstalling setuptools, pip, wheel...done.`, `79248273420137780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Mac:myproject michael$ virtualenv --no-site-packages venv\nUsing base prefix <span class="token string">\'/usr/local/.../Python.framework/Versions/3.4\'</span>\nNew python executable <span class="token keyword">in</span> venv/bin/python3.4\nAlso creating executable <span class="token keyword">in</span> venv/bin/python\nInstalling setuptools, pip, wheel<span class="token punctuation">..</span>.done.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>命令 virtualenv 就可以创建一个独立的 Python 运行环境，我们还加上了参数 —no-site-packages，这样，已经安装到系统 Python 环境中的所有第三方包都不会复制过来，这样，我们就得到了一个不带任何第三方包的“干净”的 Python 运行环境。</p>\n<p>新建的 Python 环境被放到当前目录下的 venv 目录。有了 venv 这个 Python 环境，可以用 source 进入该环境：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8807077007858255000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Mac:myproject michael\\$ source venv/bin/activate\n(venv)Mac:myproject michael\\$`, `8807077007858255000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Mac:myproject michael$ <span class="token builtin class-name">source</span> venv/bin/activate\n<span class="token punctuation">(</span>venv<span class="token punctuation">)</span>Mac:myproject michael$</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>注意到命令提示符变了，有个 <code class="language-text">(venv)</code> 前缀，表示当前环境是一个名为 venv 的 Python 环境。</p>\n<p>下面正常安装各种第三方包，并运行 python 命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95135650276994470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(venv)Mac:myproject michael\\$ pip install jinja2\n...\nSuccessfully installed jinja2-2.7.3 markupsafe-0.23\n(venv)Mac:myproject michael\\$ python myapp.py\n...`, `95135650276994470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span>Mac:myproject michael$ pip <span class="token function">install</span> jinja2\n<span class="token punctuation">..</span>.\nSuccessfully installed jinja2-2.7.3 markupsafe-0.23\n<span class="token punctuation">(</span>venv<span class="token punctuation">)</span>Mac:myproject michael$ python myapp.py\n<span class="token punctuation">..</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 venv 环境下，用 pip 安装的包都被安装到 venv 这个环境下，系统 Python 环境不受任何影响。也就是说，venv 环境是专门针对 myproject 这个应用创建的。</p>\n<p>退出当前的 venv 环境，使用 deactivate 命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2898392322709209000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(venv)Mac:myproject michael\\$ deactivate\nMac:myproject michael\\$`, `2898392322709209000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span>Mac:myproject michael$ deactivate\nMac:myproject michael$</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>此时就回到了正常的环境，现在 pip 或 python 均是在系统 Python 环境下执行。</p>\n<p>完全可以针对每个应用创建独立的 Python 运行环境，这样就可以对每个应用的 Python 环境进行隔离。</p>\n<p>virtualenv 是如何创建“独立”的 Python 运行环境的呢？原理很简单，就是把系统 Python 复制一份到 virtualenv 的环境，用命令 <code class="language-text">source venv/bin/activate</code> 进入一个 virtualenv 环境时，virtualenv 会修改相关环境变量，让命令 python 和 pip 均指向当前的 virtualenv 环境。</p>\n<h2 id="小结-24"><a href="#%E5%B0%8F%E7%BB%93-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h2>\n<p>virtualenv 为应用提供了隔离的 Python 运行环境，解决了不同应用间多版本的冲突问题。</p>\n<h1 id="异步-io-1"><a href="#%E5%BC%82%E6%AD%A5-io-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步 IO</h1>\n<p>在 IO 编程一节中，我们已经知道，CPU 的速度远远快于磁盘、网络等 IO。在一个线程中，CPU 执行代码的速度极快，然而，一旦遇到 IO 操作，如读写文件、发送网络数据时，就需要等待 IO 操作完成，才能继续进行下一步操作。这种情况称为同步 IO。</p>\n<p>在 IO 操作的过程中，当前线程被挂起，而其他需要 CPU 执行的代码就无法被当前线程执行了。</p>\n<p>因为一个 IO 操作就阻塞了当前线程，导致其他代码无法执行，所以我们必须使用多线程或者多进程来并发执行代码，为多个用户服务。每个用户都会分配一个线程，如果遇到 IO 导致线程被挂起，其他用户的线程不受影响。</p>\n<p>多线程和多进程的模型虽然解决了并发问题，但是系统不能无上限地增加线程。由于系统切换线程的开销也很大，所以，一旦线程数量过多，CPU 的时间就花在线程切换上了，真正运行代码的时间就少了，结果导致性能严重下降。</p>\n<p>由于我们要解决的问题是 CPU 高速执行能力和 IO 设备的龟速严重不匹配，多线程和多进程只是解决这一问题的一种方法。</p>\n<p>另一种解决 IO 问题的方法是异步 IO。当代码需要执行一个耗时的 IO 操作时，它只发出 IO 指令，并不等待 IO 结果，然后就去执行其他代码了。一段时间后，当 IO 返回结果时，再通知 CPU 进行处理。</p>\n<p>可以想象如果按普通顺序写出的代码实际上是没法完成异步 IO 的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8670020497777586000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`do_some_code()\nf = open(\'/path/to/file\', \'r\')\nr = f.read() # <== 线程停在此处等待 IO 操作结果\n# IO 操作完成后线程才能继续执行:\ndo_some_code(r)`, `8670020497777586000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">do_some_code<span class="token punctuation">(</span><span class="token punctuation">)</span>\nf <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'/path/to/file\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">)</span>\nr <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># &lt;== 线程停在此处等待 IO 操作结果</span>\n<span class="token comment"># IO 操作完成后线程才能继续执行:</span>\ndo_some_code<span class="token punctuation">(</span>r<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所以，同步 IO 模型的代码是无法实现异步 IO 模型的。</p>\n<p>异步 IO 模型需要一个消息循环，在消息循环中，主线程不断地重复“读取消息-处理消息”这一过程：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41054890895845880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`loop = get_event_loop()\nwhile True:\n    event = loop.get_event()\n    process_event(event)`, `41054890895845880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">loop <span class="token operator">=</span> get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n    event <span class="token operator">=</span> loop<span class="token punctuation">.</span>get_event<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    process_event<span class="token punctuation">(</span>event<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>消息模型其实早在应用在桌面应用程序中了。一个 GUI 程序的主线程就负责不停地读取消息并处理消息。所有的键盘、鼠标等消息都被发送到 GUI 程序的消息队列中，然后由 GUI 程序的主线程处理。</p>\n<p>由于 GUI 线程处理键盘、鼠标等消息的速度非常快，所以用户感觉不到延迟。某些时候，GUI 线程在一个消息处理的过程中遇到问题导致一次消息处理时间过长，此时，用户会感觉到整个 GUI 程序停止响应了，敲键盘、点鼠标都没有反应。这种情况说明在消息模型中，处理一个消息必须非常迅速，否则，主线程将无法及时处理消息队列中的其他消息，导致程序看上去停止响应。</p>\n<p>消息模型是如何解决同步 IO 必须等待 IO 操作这一问题的呢？当遇到 IO 操作时，代码只负责发出 IO 请求，不等待 IO 结果，然后直接结束本轮消息处理，进入下一轮消息处理过程。当 IO 操作完成后，将收到一条“IO 完成”的消息，处理该消息时就可以直接获取 IO 操作结果。</p>\n<p>在“发出 IO 请求”到收到“IO 完成”的这段时间里，同步 IO 模型下，主线程只能挂起，但异步 IO 模型下，主线程并没有休息，而是在消息循环中继续处理其他消息。这样，在异步 IO 模型下，一个线程就可以同时处理多个 IO 请求，并且没有切换线程的操作。对于大多数 IO 密集型的应用程序，使用异步 IO 将大大提升系统的多任务处理能力。</p>\n<h2 id="协程"><a href="#%E5%8D%8F%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>协程</h2>\n<p>在学习异步 IO 模型前，我们先来了解协程。</p>\n<p>协程，又称微线程，纤程。英文名 Coroutine。</p>\n<p>协程的概念很早就提出来了，但直到最近几年才在某些语言（如 Lua）中得到广泛应用。</p>\n<p>子程序，或者称为函数，在所有语言中都是层级调用，比如 A 调用 B，B 在执行过程中又调用了 C，C 执行完毕返回，B 执行完毕返回，最后是 A 执行完毕。</p>\n<p>所以子程序调用是通过栈实现的，一个线程就是执行一个子程序。</p>\n<p>子程序调用总是一个入口，一次返回，调用顺序是明确的。而协程的调用和子程序不同。</p>\n<p>协程看上去也是子程序，但执行过程中，在子程序内部可中断，然后转而执行别的子程序，在适当的时候再返回来接着执行。</p>\n<p>注意，在一个子程序中中断，去执行其他子程序，不是函数调用，有点类似 CPU 的中断。比如子程序 A、B：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67977182343396336000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def A():\n    print(\'1\')\n    print(\'2\')\n    print(\'3\')\n\ndef B():\n    print(\'x\')\n    print(\'y\')\n    print(\'z\')`, `67977182343396336000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'1\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'2\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'3\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'x\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'y\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'z\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>假设由协程执行，在执行 A 的过程中，可以随时中断，去执行 B，B 也可能在执行过程中中断再去执行 A，结果可能是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91921790151326480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1\n2\nx\ny\n3\nz`, `91921790151326480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1\n2\nx\ny\n3\nz</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是在 A 中是没有调用 B 的，所以协程的调用比函数调用理解起来要难一些。</p>\n<p>看起来 A、B 的执行有点像多线程，但协程的特点在于是一个线程执行，那和多线程比，协程有何优势？</p>\n<ol>\n<li>最大的优势就是协程极高的执行效率。因为子程序切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，和多线程比，线程数量越多，协程的性能优势就越明显。</li>\n<li>第二大优势就是不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。</li>\n</ol>\n<p>因为协程是一个线程执行，那怎么利用多核 CPU 呢？最简单的方法是多进程+协程，既充分利用多核，又充分发挥协程的高效率，可获得极高的性能。</p>\n<p>Python 对协程的支持是通过 generator 实现的。</p>\n<p>在 generator 中，我们不但可以通过 for 循环来迭代，还可以不断调用 next() 函数获取由 yield 语句返回的下一个值。</p>\n<p>但是 Python 的 yield 不但可以返回一个值，它还可以接收调用者发出的参数。</p>\n<p>来看例子：</p>\n<p>传统的生产者-消费者模型是一个线程写消息，一个线程取消息，通过锁机制控制队列和等待，但一不小心就可能死锁。</p>\n<p>如果改用协程，生产者生产消息后，直接通过 yield 跳转到消费者开始执行，待消费者执行完毕后，切换回生产者继续生产，效率极高：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41885270411297300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def consumer():\n    r = \'\'\n    while True:\n        n = yield r\n        if not n:\n            return\n        print(\'[CONSUMER] Consuming %s...\' % n)\n        r = \'200 OK\'\n\ndef produce(c):\n    c.send(None)\n    n = 0\n    while n < 5:\n        n = n + 1\n        print(\'[PRODUCER] Producing %s...\' % n)\n        r = c.send(n)\n        print(\'[PRODUCER] Consumer return: %s\' % r)\n    c.close()\n\nc = consumer()\nproduce(c)`, `41885270411297300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    r <span class="token operator">=</span> <span class="token string">\'\'</span>\n    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n        n <span class="token operator">=</span> <span class="token keyword">yield</span> r\n        <span class="token keyword">if</span> <span class="token keyword">not</span> n<span class="token punctuation">:</span>\n            <span class="token keyword">return</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'[CONSUMER] Consuming %s...\'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>\n        r <span class="token operator">=</span> <span class="token string">\'200 OK\'</span>\n\n<span class="token keyword">def</span> <span class="token function">produce</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    c<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>\n    n <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>\n        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'[PRODUCER] Producing %s...\'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>\n        r <span class="token operator">=</span> c<span class="token punctuation">.</span>send<span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'[PRODUCER] Consumer return: %s\'</span> <span class="token operator">%</span> r<span class="token punctuation">)</span>\n    c<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\nc <span class="token operator">=</span> consumer<span class="token punctuation">(</span><span class="token punctuation">)</span>\nproduce<span class="token punctuation">(</span>c<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行结果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54789186058282600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[PRODUCER] Producing 1...\n[CONSUMER] Consuming 1...\n[PRODUCER] Consumer return: 200 OK\n[PRODUCER] Producing 2...\n[CONSUMER] Consuming 2...\n[PRODUCER] Consumer return: 200 OK\n[PRODUCER] Producing 3...\n[CONSUMER] Consuming 3...\n[PRODUCER] Consumer return: 200 OK\n[PRODUCER] Producing 4...\n[CONSUMER] Consuming 4...\n[PRODUCER] Consumer return: 200 OK\n[PRODUCER] Producing 5...\n[CONSUMER] Consuming 5...\n[PRODUCER] Consumer return: 200 OK`, `54789186058282600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Producing <span class="token number">1</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>CONSUMER<span class="token punctuation">]</span> Consuming <span class="token number">1</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Consumer return: <span class="token number">200</span> OK\n<span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Producing <span class="token number">2</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>CONSUMER<span class="token punctuation">]</span> Consuming <span class="token number">2</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Consumer return: <span class="token number">200</span> OK\n<span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Producing <span class="token number">3</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>CONSUMER<span class="token punctuation">]</span> Consuming <span class="token number">3</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Consumer return: <span class="token number">200</span> OK\n<span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Producing <span class="token number">4</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>CONSUMER<span class="token punctuation">]</span> Consuming <span class="token number">4</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Consumer return: <span class="token number">200</span> OK\n<span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Producing <span class="token number">5</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>CONSUMER<span class="token punctuation">]</span> Consuming <span class="token number">5</span><span class="token punctuation">..</span>.\n<span class="token punctuation">[</span>PRODUCER<span class="token punctuation">]</span> Consumer return: <span class="token number">200</span> OK</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意到 consumer 函数是一个 generator，把一个 consumer 传入 produce 后：</p>\n<ol>\n<li>首先调用 c.send(None) 启动生成器；</li>\n<li>然后，一旦生产了东西，通过 c.send(n) 切换到 consumer 执行；</li>\n<li>consumer 通过 yield 拿到消息处理，又通过 yield 把结果传回；</li>\n<li>produce 拿到 consumer 处理的结果，继续生产下一条消息；</li>\n<li>produce 决定不生产了，通过 c.close() 关闭 consumer，整个过程结束。</li>\n</ol>\n<p>整个流程无锁，由一个线程执行，produce 和 consumer 协作完成任务，所以称为“协程”，而非线程的抢占式多任务。</p>\n<p>最后套用 Donald Knuth 的一句话总结协程的特点：</p>\n<p>“子程序就是协程的一种特例。”</p>\n<h2 id="asyncio"><a href="#asyncio" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>asyncio</h2>\n<p>asyncio 是 Python 3.4 版本引入的标准库，直接内置了对异步 IO 的支持。</p>\n<p>asyncio 的编程模型就是一个消息循环。我们从 asyncio 模块中直接获取一个 EventLoop 的引用，然后把需要执行的协程扔到 EventLoop 中执行，就实现了异步 IO。</p>\n<p>用 asyncio 实现 Hello world 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8060719907818936000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import asyncio\n\n@asyncio.coroutine\ndef hello():\n    print(&quot;Hello world!&quot;)\n    # 异步调用 asyncio.sleep(1):\n    r = yield from asyncio.sleep(1)\n    print(&quot;Hello again!&quot;)\n\n# 获取 EventLoop:\nloop = asyncio.get_event_loop()\n# 执行 coroutine\nloop.run_until_complete(hello())\nloop.close()`, `8060719907818936000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> asyncio\n\n@asyncio<span class="token punctuation">.</span>coroutine\n<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span>\n    <span class="token comment"># 异步调用 asyncio.sleep(1):</span>\n    r <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">from</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello again!"</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 获取 EventLoop:</span>\nloop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 执行 coroutine</span>\nloop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nloop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">@asyncio.coroutine</code> 把一个 generator 标记为 coroutine 类型，然后，我们就把这个 coroutine 扔到 EventLoop 中执行。</p>\n<p>hello() 会首先打印出 Hello world!，然后，yield from 语法可以让我们方便地调用另一个 generator。由于 asyncio.sleep() 也是一个 coroutine，所以线程不会等待 asyncio.sleep()，而是直接中断并执行下一个消息循环。当 asyncio.sleep() 返回时，线程就可以从 yield from 拿到返回值（此处是 None），然后接着执行下一行语句。</p>\n<p>把 asyncio.sleep(1) 看成是一个耗时 1 秒的 IO 操作，在此期间，主线程并未等待，而是去执行 EventLoop 中其他可以执行的 coroutine 了，因此可以实现并发执行。</p>\n<p>我们用 Task 封装两个 coroutine 试试：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41769803883535020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import threading\nimport asyncio\n\n@asyncio.coroutine\ndef hello():\n    print(\'Hello world! (%s)\' % threading.currentThread())\n    yield from asyncio.sleep(1)\n    print(\'Hello again! (%s)\' % threading.currentThread())\n\nloop = asyncio.get_event_loop()\ntasks = [hello(), hello()]\nloop.run_until_complete(asyncio.wait(tasks))\nloop.close()`, `41769803883535020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> threading\n<span class="token keyword">import</span> asyncio\n\n@asyncio<span class="token punctuation">.</span>coroutine\n<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello world! (%s)\'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello again! (%s)\'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\nloop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>\ntasks <span class="token operator">=</span> <span class="token punctuation">[</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\nloop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span>\nloop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>观察执行过程：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99385291498680760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Hello world! (<_MainThread(MainThread, started 140735195337472)>)\nHello world! (<_MainThread(MainThread, started 140735195337472)>)\n(暂停约1秒)\nHello again! (<_MainThread(MainThread, started 140735195337472)>)\nHello again! (<_MainThread(MainThread, started 140735195337472)>)`, `99385291498680760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Hello world<span class="token operator">!</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread, started <span class="token number">140735195337472</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">)</span>\nHello world<span class="token operator">!</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread, started <span class="token number">140735195337472</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">)</span>\n<span class="token punctuation">(</span>暂停约1秒<span class="token punctuation">)</span>\nHello again<span class="token operator">!</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread, started <span class="token number">140735195337472</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">)</span>\nHello again<span class="token operator">!</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>_MainThread<span class="token punctuation">(</span>MainThread, started <span class="token number">140735195337472</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由打印的当前线程名称可以看出，两个 coroutine 是由同一个线程并发执行的。</p>\n<p>如果把 asyncio.sleep() 换成真正的 IO 操作，则多个 coroutine 就可以由一个线程并发执行。</p>\n<p>我们用 asyncio 的异步网络连接来获取 sina、sohu 和 163 的网站首页：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69430099598087300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import asyncio\n\n@asyncio.coroutine\ndef wget(host):\n    print(\'wget %s...\' % host)\n    connect = asyncio.open_connection(host, 80)\n    reader, writer = yield from connect\n    header = \'GET / HTTP/1.0\\r\\nHost: %s\\r\\n\\r\\n\' % host\n    writer.write(header.encode(\'utf-8\'))\n    yield from writer.drain()\n    while True:\n        line = yield from reader.readline()\n        if line == b\'\\r\\n\':\n            break\n        print(\'%s header > %s\' % (host, line.decode(\'utf-8\').rstrip()))\n    # Ignore the body, close the socket\n    writer.close()\n\nloop = asyncio.get_event_loop()\ntasks = [wget(host) for host in [\'www.sina.com.cn\', \'www.sohu.com\', \'www.163.com\']]\nloop.run_until_complete(asyncio.wait(tasks))\nloop.close()`, `69430099598087300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> asyncio\n\n@asyncio<span class="token punctuation">.</span>coroutine\n<span class="token keyword">def</span> <span class="token function">wget</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'wget %s...\'</span> <span class="token operator">%</span> host<span class="token punctuation">)</span>\n    connect <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>open_connection<span class="token punctuation">(</span>host<span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>\n    reader<span class="token punctuation">,</span> writer <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">from</span> connect\n    header <span class="token operator">=</span> <span class="token string">\'GET / HTTP/1.0\\r\\nHost: %s\\r\\n\\r\\n\'</span> <span class="token operator">%</span> host\n    writer<span class="token punctuation">.</span>write<span class="token punctuation">(</span>header<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> <span class="token keyword">from</span> writer<span class="token punctuation">.</span>drain<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n        line <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">from</span> reader<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> line <span class="token operator">==</span> <span class="token string">b\'\\r\\n\'</span><span class="token punctuation">:</span>\n            <span class="token keyword">break</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'%s header > %s\'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>host<span class="token punctuation">,</span> line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token comment"># Ignore the body, close the socket</span>\n    writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\nloop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>\ntasks <span class="token operator">=</span> <span class="token punctuation">[</span>wget<span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token keyword">for</span> host <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">\'www.sina.com.cn\'</span><span class="token punctuation">,</span> <span class="token string">\'www.sohu.com\'</span><span class="token punctuation">,</span> <span class="token string">\'www.163.com\'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\nloop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span>\nloop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行结果如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81992687126841440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`wget www.sohu.com...\nwget www.sina.com.cn...\nwget www.163.com...\n(等待一段时间)\n(打印出sohu的header)\nwww.sohu.com header > HTTP/1.1 200 OK\nwww.sohu.com header > Content-Type: text/html\n...\n(打印出sina的header)\nwww.sina.com.cn header > HTTP/1.1 200 OK\nwww.sina.com.cn header > Date: Wed, 20 May 2015 04:56:33 GMT\n...\n(打印出163的header)\nwww.163.com header > HTTP/1.0 302 Moved Temporarily\nwww.163.com header > Server: Cdn Cache Server V2.0\n...`, `81992687126841440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">wget</span> www.sohu.com<span class="token punctuation">..</span>.\n<span class="token function">wget</span> www.sina.com.cn<span class="token punctuation">..</span>.\n<span class="token function">wget</span> www.163.com<span class="token punctuation">..</span>.\n<span class="token punctuation">(</span>等待一段时间<span class="token punctuation">)</span>\n<span class="token punctuation">(</span>打印出sohu的header<span class="token punctuation">)</span>\nwww.sohu.com header <span class="token operator">></span> HTTP/1.1 <span class="token number">200</span> OK\nwww.sohu.com header <span class="token operator">></span> Content-Type: text/html\n<span class="token punctuation">..</span>.\n<span class="token punctuation">(</span>打印出sina的header<span class="token punctuation">)</span>\nwww.sina.com.cn header <span class="token operator">></span> HTTP/1.1 <span class="token number">200</span> OK\nwww.sina.com.cn header <span class="token operator">></span> Date: Wed, <span class="token number">20</span> May <span class="token number">2015</span> 04:56:33 GMT\n<span class="token punctuation">..</span>.\n<span class="token punctuation">(</span>打印出163的header<span class="token punctuation">)</span>\nwww.163.com header <span class="token operator">></span> HTTP/1.0 <span class="token number">302</span> Moved Temporarily\nwww.163.com header <span class="token operator">></span> Server: Cdn Cache Server V2.0\n<span class="token punctuation">..</span>.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可见 3 个连接由一个线程通过 coroutine 并发完成。</p>\n<h3 id="小结-25"><a href="#%E5%B0%8F%E7%BB%93-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>asyncio 提供了完善的异步 IO 支持；</p>\n<p>异步操作需要在 coroutine 中通过 yield from 完成；</p>\n<p>多个 coroutine 可以封装成一组 Task 然后并发执行。</p>\n<h2 id="async--await"><a href="#async--await" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>async / await</h2>\n<p>用 asyncio 提供的 <code class="language-text">@asyncio.coroutine</code> 可以把一个 generator 标记为 coroutine 类型，然后在 coroutine 内部用 yield from 调用另一个 coroutine 实现异步操作。</p>\n<p>为了简化并更好地标识异步 IO，从 Python 3.5 开始引入了新的语法 async 和 await，可以让 coroutine 的代码更简洁易读。</p>\n<p>请注意，async 和 await 是针对 coroutine 的新语法，要使用新的语法，只需要做两步简单的替换：</p>\n<ol>\n<li>把 <code class="language-text">@asyncio.coroutine</code> 替换为 async；</li>\n<li>把 yield from 替换为 await。</li>\n</ol>\n<p>让我们对比一下上一节的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70847414604555190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@asyncio.coroutine\ndef hello():\n    print(&quot;Hello world!&quot;)\n    r = yield from asyncio.sleep(1)\n    print(&quot;Hello again!&quot;)`, `70847414604555190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token decorator annotation punctuation">@asyncio<span class="token punctuation">.</span>coroutine</span>\n<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span>\n    r <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">from</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello again!"</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>用新语法重新编写如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60847542653924380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`async def hello():\n    print(&quot;Hello world!&quot;)\n    r = await asyncio.sleep(1)\n    print(&quot;Hello again!&quot;)`, `60847542653924380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span>\n    r <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello again!"</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>剩下的代码保持不变。</p>\n<h3 id="小结-26"><a href="#%E5%B0%8F%E7%BB%93-26" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h3>\n<p>Python 从 3.5 版本开始为 asyncio 提供了 async 和 await 的新语法；</p>\n<p>注意新语法只能用在 Python 3.5 以及后续版本，如果使用 3.4 版本，则仍需使用上一节的方案。</p>\n<h2 id="aiohttp"><a href="#aiohttp" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>aiohttp</h2>\n<p>asyncio 可以实现单线程并发 IO 操作。如果仅用在客户端，发挥的威力不大。如果把 asyncio 用在服务器端，例如 Web 服务器，由于 HTTP 连接就是 IO 操作，因此可以用单线程 + coroutine 实现多用户的高并发支持。</p>\n<p>asyncio 实现了 TCP、UDP、SSL 等协议，aiohttp 则是基于 asyncio 实现的 HTTP 框架。</p>\n<p>我们先安装 aiohttp：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14925339862966514000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pip install aiohttp`, `14925339862966514000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">pip <span class="token function">install</span> aiohttp</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后编写一个 HTTP 服务器，分别处理以下 URL：</p>\n<ul>\n<li><code class="language-text">/</code> - 首页返回 <code class="language-text">b&#39;&lt;h1&gt;Index&lt;/h1&gt;&#39;</code>；</li>\n<li><code class="language-text">/hello/{name}</code> - 根据 URL 参数返回文本 <code class="language-text">hello, %s!</code>。</li>\n</ul>\n<p>代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52159619463766200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import asyncio\n\nfrom aiohttp import web\n\nasync def index(request):\n    await asyncio.sleep(0.5)\n    return web.Response(body=b\'<h1>Index</h1>\')\n\nasync def hello(request):\n    await asyncio.sleep(0.5)\n    text = \'<h1>hello, %s!</h1>\' % request.match_info[\'name\']\n    return web.Response(body=text.encode(\'utf-8\'))\n\nasync def init(loop):\n    app = web.Application(loop=loop)\n    app.router.add_route(\'GET\', \'/\', index)\n    app.router.add_route(\'GET\', \'/hello/{name}\', hello)\n    srv = await loop.create_server(app.make_handler(), \'127.0.0.1\', 8000)\n    print(\'Server started at http://127.0.0.1:8000...\')\n    return srv\n\nloop = asyncio.get_event_loop()\nloop.run_until_complete(init(loop))\nloop.run_forever()`, `52159619463766200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">import</span> asyncio\n\n<span class="token keyword">from</span> aiohttp <span class="token keyword">import</span> web\n\n<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> web<span class="token punctuation">.</span>Response<span class="token punctuation">(</span>body<span class="token operator">=</span><span class="token string">b\'&lt;h1>Index&lt;/h1>\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>\n    text <span class="token operator">=</span> <span class="token string">\'&lt;h1>hello, %s!&lt;/h1>\'</span> <span class="token operator">%</span> request<span class="token punctuation">.</span>match_info<span class="token punctuation">[</span><span class="token string">\'name\'</span><span class="token punctuation">]</span>\n    <span class="token keyword">return</span> web<span class="token punctuation">.</span>Response<span class="token punctuation">(</span>body<span class="token operator">=</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    app <span class="token operator">=</span> web<span class="token punctuation">.</span>Application<span class="token punctuation">(</span>loop<span class="token operator">=</span>loop<span class="token punctuation">)</span>\n    app<span class="token punctuation">.</span>router<span class="token punctuation">.</span>add_route<span class="token punctuation">(</span><span class="token string">\'GET\'</span><span class="token punctuation">,</span> <span class="token string">\'/\'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span>\n    app<span class="token punctuation">.</span>router<span class="token punctuation">.</span>add_route<span class="token punctuation">(</span><span class="token string">\'GET\'</span><span class="token punctuation">,</span> <span class="token string">\'/hello/{name}\'</span><span class="token punctuation">,</span> hello<span class="token punctuation">)</span>\n    srv <span class="token operator">=</span> <span class="token keyword">await</span> loop<span class="token punctuation">.</span>create_server<span class="token punctuation">(</span>app<span class="token punctuation">.</span>make_handler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'127.0.0.1\'</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Server started at http://127.0.0.1:8000...\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> srv\n\nloop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>\nloop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>init<span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">)</span>\nloop<span class="token punctuation">.</span>run_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意 aiohttp 的初始化函数 init() 也是一个 coroutine，loop.create_server() 则利用 asyncio 创建 TCP 服务。</p>\n<p>// TODO Python 入门学习待完成</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Python入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:117,frontmatter:{date:"2022-04-02 16:40:55",path:"/python-introduce-learn/",tags:"后端, python, 读书笔记",title:"Python入门学习",draft:null}},{excerpt:"本章介绍 CSS 渐变、CSS 3D 变换、CSS 过渡和 CSS 动画这 4 部分内容，如果没有专门说明，相关 CSS 属性均是被 IE10+ 浏览器支持的。本章介绍的这些 CSS 属性都非常实用，且细节众多，读者需要反复阅读才能理解。 CSS 渐变 CSS 渐变是 CSS 世界中第一次真正意义上使用纯 CSS 代码创建的图像。它可以应用在任何需要使用图像的场景，因此非常常用，读者一定要牢记相关语法。如果 CSS 的学习有期末考试的话，那么 CSS…",html:'<p>本章介绍 CSS 渐变、CSS 3D 变换、CSS 过渡和 CSS 动画这 4 部分内容，如果没有专门说明，相关 CSS 属性均是被 IE10+ 浏览器支持的。本章介绍的这些 CSS 属性都非常实用，且细节众多，读者需要反复阅读才能理解。</p>\n<h1 id="css-渐变"><a href="#css-%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 渐变</h1>\n<p>CSS 渐变是 CSS 世界中第一次真正意义上使用纯 CSS 代码创建的图像。它可以应用在任何需要使用图像的场景，因此非常常用，读者一定要牢记相关语法。如果 CSS 的学习有期末考试的话，那么 CSS 渐变一定是必考内容。我们先从最简单的线性渐变学起。</p>\n<h2 id="深入了解-linear-gradient-线性渐变"><a href="#%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3-linear-gradient-%E7%BA%BF%E6%80%A7%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入了解 linear-gradient() 线性渐变</h2>\n<p>我们从最简单的表示自上而下、从白色到天蓝色的渐变的语法开始：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38692569633359675000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white, skyblue);`, `38692569633359675000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果渐变方向是自上而下的，就无须专门指定角度，所以在所有线性渐变语法中，to bottom 一定是多余的，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99221051758266700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* to bottom 是多余的 */\nlinear-gradient(to bottom, white, skyblue);`, `99221051758266700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* to bottom 是多余的 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>to bottom<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果是其他渐变方向，则需要专门指定。渐变的方向共有两种表示方法，一种是使用关键字 to 加方位值，另一种是直接使用角度值，示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18321073842250590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用关键字 to 表示渐变方向 */\nlinear-gradient(to right, white, skyblue);\nlinear-gradient(to right bottom, white, skyblue);\n/* 使用角度值表示渐变方向 */\nlinear-gradient(45deg, white, skyblue);\nlinear-gradient(0.25turn, white, skyblue);`, `18321073842250590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 使用关键字 to 表示渐变方向 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right bottom<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 使用角度值表示渐变方向 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>45deg<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>0.25turn<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>日常开发更多使用 <code class="language-text">to 方位值</code> 表示法，一方面是因为语义清晰，容易理解与记忆；另一方面是因为项目中的渐变效果要么是对角渐变，要么就是水平或垂直渐变，更适合使用 <code class="language-text">to 方位值</code> 表示法，这种方法实现的渐变不会受到元素的尺寸限制，适用性更广，也无须专门计算角度。例如，使用 CSS 渐变绘制两条对角线来表示没有数据的时候的占位效果，此时只有使用 <code class="language-text">to 方位值</code> 表示法才能适配任意尺寸，CSS 代码示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55574324329598850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img:not([src]) {\n   background-color: #eee;\n   background-image: linear-gradient(\n         to right bottom,\n         transparent calc(50% - 1px),\n         #ccc calc(50% - 1px),\n         #ccc,\n         transparent calc(50% + 1px)\n      ), linear-gradient(to top right, transparent calc(50% - 1px), #ccc calc(50% - 1px), #ccc, transparent calc(50% +\n                  1px));\n}`, `55574324329598850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img:not([src])</span> <span class="token punctuation">{</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>\n         to right bottom<span class="token punctuation">,</span>\n         transparent <span class="token function">calc</span><span class="token punctuation">(</span>50% - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span>\n         #ccc <span class="token function">calc</span><span class="token punctuation">(</span>50% - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span>\n         #ccc<span class="token punctuation">,</span>\n         transparent <span class="token function">calc</span><span class="token punctuation">(</span>50% + 1px<span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to top right<span class="token punctuation">,</span> transparent <span class="token function">calc</span><span class="token punctuation">(</span>50% - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span> #ccc <span class="token function">calc</span><span class="token punctuation">(</span>50% - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span> #ccc<span class="token punctuation">,</span> transparent <span class="token function">calc</span><span class="token punctuation">(</span>50% +\n                  1px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，无论元素的尺寸是多少，对角线都有符合预期的表现，如图 5-1 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-4767d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.995337995338%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAAvklEQVQY012QAQ6CMAxFd/9zGTLIFFGJAkG8gWwDDNsCljXWhh8Cf+1/a4Mwxlhrh2GwTHiEltY6hLAsC69TWGAISyR+EcJQ5GPAgxGUxt7uLg4Tj+QfxpyO4lvsYDj2fU8BwffcbcHhcRwxQ2aD41/ZHvjicBP1/sk5BzwMBE+rYUbM8+yivPeY81EhCgyMXdeVFxGBt8BeVTfP7jVNn1NeVFXTtt25uCYySzN1SKQ65pdbKVMlM3V/1JBH6gshScYDLjmCNQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 09 41 19" title="" data-src="/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-fee1c.png" data-srcset="/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-a67b7.png 200w,\n/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-0b187.png 400w,\n/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-fee1c.png 800w,\n/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-4767d.png 858w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/qgd68x?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>下面着重讲一讲不少人会比较困惑的角度值表示法。先看代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48269378977451320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   width: 300px;\n   height: 150px;\n   border: solid deepskyblue;\n   background-image: linear-gradient(45deg, skyblue, white);\n}`, `48269378977451320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>45deg<span class="token punctuation">,</span> skyblue<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>请问这段代码中的 45deg 表示的渐变起始方向是左上角、右上角、左下角还是右下角呢？正确答案是：45deg 表示的渐变的起始方向是左下角。上面代码对应的效果如图 5-2 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-54e16.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 599px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.93656093489148%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACNElEQVQoz13R7UvbQBwH8PzdezfGkL3YhrAHxybomJMpU1CpYzoFFXVuamub58e2adM2TXLJPeQuSZOdrWVjx4/jXtyH+/I9YckgNQvsO/FhJzl24VkP/vTQ9RA3fCyOiRamFqCdhHqQjUkGaI5YkWZFVU5MXAqvdPzVAFtWsuMktTb83kU/XHTSx+cDfDUiN37aDKgUUR0wO2FdlHkkH5GcsKIFS2FRw1+0aMOIt61410727z087qHTProY4F8jUvfTVpAqETUAc5LM5R7nkObNZCK81PCaGn7WweY//mDmPXT5n4+ZA7MuzMI0r8cT4bmCVuTgoxqtz/2e89efefhyQOaezrwNsxHOrkEhPJPRezFYViLu+fsP+bnvzPN7eJb/lvuQyhHVAOtBdhUVwoKE3jbH78SQ+1U1Wpv6LSue9wePpv1dePhqeN/fHe8vpE5Mz4NcWBDhmzt/qRUsS+GqEq6p0YYOtkywY8c1JznoJEcuPO2hSw/9HuJbnzTHqRykbZBecPyohR7fBE/q4dN68OwufCGCRRG8lsCSAj5o8YqefDLhug03HbTdRrtdXHPJgUdPhnR3kAsSKhvJhPcup5WEK/57Eqk0Wqnz4Wd9uhvsYRRUyqg0SSlU01XkuS5J436vZCwcDjum4fd7tqa5tm0osqkoXcsUG422YViqWmTZTAlFWZZVRVkmypo38lOWjcPI7Q/2vh3eNJqW02nJiqRoLVmVNd2wHUUz+GVOJlX1B/8wd5O68xLJAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 09 56 39" title="" data-src="/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-54e16.png" data-srcset="/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-e3250.png 200w,\n/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-a3cce.png 400w,\n/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-54e16.png 599w" data-sizes="(max-width: 599px) 100vw, 599px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这个问题回答错了不怪大家，因为 CSS 渐变中的角度值表示的方向和常见的各种设计软件中的渐变的角度值表示的方向不一样。</p>\n<p>假设有一个圆盘，圆盘有一个中心点，以这个中心点为起点创建一个指针，在各类设计软件（如 Adobe Photoshop 或者 Keynote）中，指针水平向右表示渐变角度是 0 度，逆时针旋转表示角度值递增，因此指针垂直朝上表示 90 度。图 5-3 所示的是 Adobe Photoshop 软件中渐变方位值和角度值之间的关系，可以看到垂直朝上是 90 度，朝右上方是 45 度，朝右下方是 −45 度。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-2936c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAA20lEQVQY042QjW6EIBCEff+nu/aEepxtAeGwxB9YQKuJ2jWXNE1q05vAssPmyxCy7YfWdcUKAJRSpbSU0n5YrXXf99uRst+w954QUlWVEMIYg03XdY/CzrnT00lIyTlHGPObpvme/p+Mz0bmnoy1bdtHk0MIjDFj6ro21lo8APwxPM/zNE0QwjCMKQ0J97g3MQ4x7Q5HEKL3gCvGNI6fIUSAgDbzENquZ+Wrvhmlb1xIpTUhxTuXWu83OS2ez+ScU1pcistVVupavhE0rMy2P7QsS05enPOHX3XXF8eIyRD+oetCAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 09 59 06" title="" data-src="/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-fee1c.png" data-srcset="/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-a67b7.png 200w,\n/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-0b187.png 400w,\n/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-fee1c.png 800w,\n/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-2936c.png 850w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>CSS 中有着截然不同的渐变角度和渐变方位关系，规范中对此有专门的描述：</p>\n<p>using angles</p>\n<p>For the purpose of this argument, “0deg” points upward, andpositive angles represent clockwise rotation, so “90deg” pointtoward the right.（在这个参数中，0deg 表示向上，顺时针旋转是正角度，所以 90deg 表示向右。）</p>\n<p>为了便于读者理解，我整理了一个常规渐变和 CSS 渐变角度方位关系对比表，参见表 5-1。</p>\n<table>\n<thead>\n<tr>\n<th align="left">角度</th>\n<th align="left">常规渐变</th>\n<th align="left">css 渐变</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">0 度</td>\n<td align="left">向右</td>\n<td align="left">向上</td>\n</tr>\n<tr>\n<td align="left">正角度</td>\n<td align="left">逆时针</td>\n<td align="left">顺时针</td>\n</tr>\n</tbody>\n</table>\n<p>借助图 5-2 所示的效果，我们可以把 CSS 渐变角度和方位关系标注一下，图 5-4 所示的箭头指向的位置就是 CSS 渐变中 45deg 渐变和 −45deg 渐变角度示意。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-08a1b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 657px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.404870624048705%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABsUlEQVQoz31SXXOaQBT1/z/1tU+d6UMb03bamJhJFdRojLIgEBAlRr4XlBCRhAJKZLcb86I26Zm9D7vnnnvvnLslvIvnZ+z76OmpyDJsmIkghgAg10UEeY5XK7yP0t5tvcZRhGUJ0RQeymm/l7IA8zymKGzb2DRfqr8rJr3X+V2H1b+fec3ubQdonX5YawTn9WiiE5ZM8Lb4lYgteHpyRdcAf1QdfKsq5ROPavvCcNbjcJahd8dGKF1lkL8pf7n4dfy7XmlWPnykP32V6atRraWeU/PpNIrj3f6HnSPd+nzUKP+4rFa6Zz8b9GlLajBKi5leMksIw8fHt8V4+7T6k7C1HtvkpLbA1bsCda31pWmbnYnjl5T/uf1a0p+jAUc8zwCTAYBFAYsiThL0r2HoAEWxQWgTBHg8jgGIGQZrWpGkBVEWRUECbWOLw1XtYpPnm/3FHn4S3TCD4CFN08UitGyHHAe6nje7vw/c2dy0HNf1omUEofewWBDWMO07TbcdaBhWSbyR575PxJbjqOpEkhWdKKAnD0e9PisNFfV2EoZL07QByzPsQBmpLMeP1QlJ+AuWiZX6dwgGQAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 10 49 50" title="" data-src="/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-08a1b.png" data-srcset="/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-45750.png 200w,\n/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-c4772.png 400w,\n/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-08a1b.png 657w" data-sizes="(max-width: 657px) 100vw, 657px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>从图 5-4 中可以明显看出，45deg 渐变的方向是自左下方而来、往右上方而去的，图 5-2 所示的渐变角度也就一目了然了。</p>\n<p>另外，如果渐变角度是 0deg，不建议简写成 0。例如，linear-gradient(0, skyblue, white) 这样的写法是不推荐的，因为 IE 浏览器和 Edge 浏览器会认为这是不合法的。</p>\n<h3 id="渐变的起点和终点"><a href="#%E6%B8%90%E5%8F%98%E7%9A%84%E8%B5%B7%E7%82%B9%E5%92%8C%E7%BB%88%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渐变的起点和终点</h3>\n<p>明白了 CSS 线性渐变的角度值对应的方位，再弄清楚线性渐变的起点和终点的位置，理解线性渐变渲染表现就不成问题了。下面举例说明。例如，想一下下面的 CSS 渐变中 skyblue 100px 200px 对应的起止位置在哪里：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63516231897486230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   width: 300px;\n   height: 150px;\n   border: solid deepskyblue;\n   background-image: linear-gradient(45deg, white 100px, skyblue 100px 200px, white 200px);\n}`, `63516231897486230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>45deg<span class="token punctuation">,</span> white 100px<span class="token punctuation">,</span> skyblue 100px 200px<span class="token punctuation">,</span> white 200px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个 100px 的起点位置不是从端点开始的，也不是从元素的某一条边开始的，而是沿着渐变角度所在直线的垂直线开始的，该垂直线就是图 5-5 所示的虚线。因此，最终的线性渐变效果如图 5-6 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-cb87a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 424px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 141.7452830188679%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAAsSAAALEgHS3X78AAAD9klEQVQ4y41UW3PbRBTWL+aB4dLSuiEpjd2E6fDA8AAP4JkGptALyTAhpEBpkzCpLcmW7fgi25JlR7Ys2ZJW1sWWpV12V7ITSpnpzjdnzkr77Tl7zrfLoNWAEMX/AUTYYoNms5k2nWInwl+jCC0W2DLoHQak/Mpx42SvgWwt7g+QICDTvCLPImgv0RrWEn8hjrmAFv6rG/aPB+Vyp6OOyHY4OISEHJN90c/DxWbZ/Lxm71St3aq1LVjfis4wgBpCqqpPXpe0ZYTz/qOr9UZjyoIMTHJCSArQkeJsFMY5dpzljBynb7H6L8M5nFqI59BySZfBwQJJQ03X8J6IWR+p6xPneBQ8OBTyP/z5MH+U33u+c9Q6PPg6DANSKrpM9qEXo4k+VlWVcV03XC4TckQ3f96fbZ0qD7jxzncv3su8v1n8fV8JYZwmqATIJesgcBzGcZyeouCgmIwzI0sg/FUPd18OvnqYv332zZ1C7aPTxhPJSkrTC5AXkXTTtG0A+ooiBTBO2o2HCQ6fZTOn+1vs5Y1XLz9+dZw57+3LM/xbmePIaf+Y5MAuAEd1ZbiIcR+A7onHe2Xt/KmKNnl7u+JuC+49wbrJTp4pXsVNIpPQTNo0hDQLlJXL2dAWf8v/LT2uWaOGOdCCOel5CC3afGNBtABX0mBQGKJSCUoycibDE/Fp/tHQOAkRlCati7HgzAENAt+qPIYcMgjwFjGNPwVAVbXrwowpVgOtqo7Sgr0x5vN5HMfvonlmHaHZaktyz7Jsz/d7Sr/RFEtCtSm2axeNVqvT7khC9aIldiu1ekRzvBYZQkWWx8NR4HmB749Ho54kd8S23JWajWa/p+DpRa1+2R/IkhxF8RUZLKG5RC6+OhDZEQFuKJ4uEPIoXAqfWg+SCwdozZkQoi87wYfF6S3evMGZN/kUHxSn3/d8eY6aLmz7SPSh6BG0PKLFFxbpNoP3qM/gQdfeKGi7vJHj9QRZbDm9MglSKa7rT23LIzpjcNNbPpk/6oCNon6/ZGzzBFneuMcZm6xeNHx6pQiNvEqUXF+Tmx6Z41vxUxd8SvlZSs5Re5fVOcpPLkYSuXEV2Uu/4hv7uEvi567zOQO/CmzC/z9ysjHmP6Hxc2/E53RWT/P/FzlJO6Z8LL5lDHH+dwq4Zlfnx5acn/LfcubrJcUC3pfAXXZ8f1V84nDGZ6zOU34zIYMwOrNiyYdt3EY3btNmtr247kRf1MEtzszw09sUGZ74n3DTv8bzEws6IX30A4hARIAF5MQEs0Rb2IdUXjBFojZAHSJPliu1RRFYtmPbQqmMVT01jFq1VnhdMCeT0aVaq1Qb9XpVqJS4EvbxL7bIdsTO6dn5P8Tl+Ewlt4qOAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 10 56 15" title="" data-src="/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-cb87a.png" data-srcset="/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-24421.png 200w,\n/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-e4320.png 400w,\n/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-cb87a.png 424w" data-sizes="(max-width: 424px) 100vw, 424px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果渐变断点中出现了百分比值，那么这个百分比值就是相对渐变的起点到终点的这段距离计算的。</p>\n<h3 id="关于渐变断点"><a href="#%E5%85%B3%E4%BA%8E%E6%B8%90%E5%8F%98%E6%96%AD%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于渐变断点</h3>\n<p><code class="language-text">&lt;color-stop-list&gt;</code> 数据类型也就是我们常说的渐变断点，包括众多你可能不知道的细节知识，这些细节知识对所有渐变类型均适用。</p>\n<ol>\n<li>\n<p>渐变断点至少有 2 个颜色值，因此下面这种写法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61488280461698210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nlinear-gradient(white);`, `61488280461698210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>断点语法中的颜色值和位置值的前后顺序是有要求的，位置值必须在颜色值的后面，因此下面这种写法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95314387472175530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nlinear-gradient(white, 50% skyblue);`, `95314387472175530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> 50% skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>需要使用下面这种写法才可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79112093859593490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nlinear-gradient(white, skyblue 50%);`, `79112093859593490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> skyblue 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>没有指定具体断点位置的时候，各个渐变颜色所形成的色块大小是自动等分的。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83510744707546530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(red, orange, yellow, green);`, `83510744707546530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>red<span class="token punctuation">,</span> orange<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，red、orange、yellow、green 这 4 种颜色形成了 3 个渐变色块，因此等同于下面的写法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75143167164772300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(red 0%, orange 33.33%, yellow 66.66%, green 100%);`, `75143167164772300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>red 0%<span class="token punctuation">,</span> orange 33.33%<span class="token punctuation">,</span> yellow 66.66%<span class="token punctuation">,</span> green 100%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>如果起点和终点的颜色与相邻断点的颜色值一样，则起点色值和终点色值是可以省略的。例如 25% ～ 75% 的渐变效果，不少人是这么写的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26178618825197630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white, white 25%, skyblue 75%, skyblue);`, `26178618825197630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> white 25%<span class="token punctuation">,</span> skyblue 75%<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其实前后两个色值可以不用写，直接用下面的 CSS 代码即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31788792354956220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white 25%, skyblue 75%);`, `31788792354956220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white 25%<span class="token punctuation">,</span> skyblue 75%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>渐变的断点位置可以是负数，也可以大于 100%。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71500333398042380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white -50%, skyblue, white 110%)`, `71500333398042380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white -50%<span class="token punctuation">,</span> skyblue<span class="token punctuation">,</span> white 110%<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>在同一个渐变中，不同类型的断点位置值是可以同时使用的。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84300548650094120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white 100px, skyblue 50%);`, `84300548650094120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white 100px<span class="token punctuation">,</span> skyblue 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时，如果渐变范围小于 200px，假设是 160px，则白色的位置（100px）反而会比天蓝色的位置（50% × 160px）靠后，不符合渐变逻辑，那么究竟该如何渲染呢？继续往下看。</p>\n</li>\n<li>\n<p>当存在多个渐变断点的时候，前面的渐变断点设置的位置值有时候比后面的渐变断点设置的位置值要大，这时后面的渐变断点位置值会按照前面的断点位置值计算。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62347906764933410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(skyblue 20px, white 0px, skyblue 40px);`, `62347906764933410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>skyblue 20px<span class="token punctuation">,</span> white 0px<span class="token punctuation">,</span> skyblue 40px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>会按照下面的语法渲染：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29182153579106562000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(skyblue 20px, white 20px, skyblue 40px);`, `29182153579106562000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>skyblue 20px<span class="token punctuation">,</span> white 20px<span class="token punctuation">,</span> skyblue 40px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>渐变断点还支持一次性设置两个位置值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67514980135114560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white 40%, skyblue 40% 60%, white 50%);`, `67514980135114560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white 40%<span class="token punctuation">,</span> skyblue 40% 60%<span class="token punctuation">,</span> white 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示 40%～ 60% 这个范围内的颜色都是天蓝色。需要注意的是，这个语法是新语法，IE 浏览器和 Edge 浏览器是不支持的，其他现代浏览器也刚支持没多久，因此，建议大家在生产环境中还是使用传统语法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74405364802586260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white 40%, skyblue 40%, skyblue 60%, white 50%);`, `74405364802586260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white 40%<span class="token punctuation">,</span> skyblue 40%<span class="token punctuation">,</span> skyblue 60%<span class="token punctuation">,</span> white 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>除渐变断点之外，我们还可以设置颜色的转换点位置，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93830598896961930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white, 70%, skyblue);`, `93830598896961930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> 70%<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示白色和天蓝色渐变的中心转换点位置在 70% 这里，上面代码的效果如图 5-7 所示。该方法可以用来模拟更符合真实世界的立体效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-11-29-57-4e609b95d9ce6db64b30af16525a8500-d9a94.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 386px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.76683937823834%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABUUlEQVQoz5WSTU/CQBCG968b5Wb8DyZelMSDNzRo8COhQOkHJSAQRCSBVJZ2t9122+3sukW9t5Mnb96ZvHOaQe2D6hFl1KcTKGQQqRToUrIqUquCKQP0FkguIMyBVobkwAQ4FNDLAVhWHHgRVEaHKS8sAugJA07yLRO7yuiwz0Q/ANTyi1XI52G2qMMyzJ73At1tc9tnAz8x6zD0WWuXoetN1l7T+6/ooRZrertJ0eUqbc6C5jysxc0suFoydDFLTof7ho3P7IOmodXCJWV71NLj/yE+ZvDJEJ9PY7Rg0iKFx6QXKzeSbgSjWI5i9aeRnsujlx4rW53RRt/pPQakjpUQwiMKOYdCZDHNIiKSuNSUcRrmLBIxTcNAsAh4kpDwdwsVoN9Tuc7IGDi7b8xS/rH6dMcTy/YeO6+ON+n2h13THNiO0Tf7tmu5455p6xX9pT8ENMCin8Y7YgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 11 29 57" title="" data-src="/static/2022-02-14-11-29-57-4e609b95d9ce6db64b30af16525a8500-d9a94.png" data-srcset="/static/2022-02-14-11-29-57-4e609b95d9ce6db64b30af16525a8500-300a8.png 200w,\n/static/2022-02-14-11-29-57-4e609b95d9ce6db64b30af16525a8500-d9a94.png 386w" data-sizes="(max-width: 386px) 100vw, 386px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>需要注意的是，IE 浏览器是不支持这个语法的，因此，在生产环境中要谨慎使用。</p>\n</li>\n<li>\n<p>如果不是高清显示器，则在 Chrome 浏览器中，不同颜色位于同一断点位置的时候，两个颜色连接处可能会有明显的锯齿。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20423316529732104000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(30deg, red 50%, skyblue 50%);`, `20423316529732104000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>30deg<span class="token punctuation">,</span> red 50%<span class="token punctuation">,</span> skyblue 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>  锯齿效果如图 5-8 所示。</p>\n<p>  <html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-d9352.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.585730724971235%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABvUlEQVQY02O4HBi9r6Ch5cqnuvt/2y6+a7/wru3SeyBqv/y+7vy7Q69/f/vxe9Kd7713f0y7+HrK5bfIiOGptuF/BobnGrorpqxsvPG96drXztMv2s++7Dj3quHE890f/v+/ce2yX+TUdSdq7v1tvvi+7fSL1rOvIYjhiZ4pUPM/JiYgecvBc/aaow23f7Ve+tB15mXDyed7wJr/sbP94uA4mlLYd/geULb93OuOs6+AJMMzIwuQZk7O/+xsQMYfbp4zyQWTj9xru/+n9fzb/R///7957R8X5z8GBqDsDynpAw39k88+77vyfsL5Vwy3NQ1/MjB8YWL6CiQZGL4zMgLVvRIQXZpdm7vm5NoHH96dOXNBXvusiMJZSdXLvBJXOYU3u4SXrruYcuYTw+Md+1+vWPNq1Xogerly3YuV656v2fRmyYrnM+fs2nlo74Vrxy9cmXzry9QHv6fe/znl4e+pj//OufZ+xt1vk5/+Z/iPG/z78/vrxw9fPn0EMrAqYPj35w8Q/f0Nkn788OH16zdfPn9x9vTZEydOXbx09dqNW+cvXj5x+vzx0+dOnbtw8+4DoLJff//9/vcfiABHuFfyBzNmFQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 11 37 08" title="" data-src="/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-fee1c.png" data-srcset="/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-a67b7.png 200w,\n/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-0b187.png 400w,\n/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-fee1c.png 800w,\n/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-d9352.png 869w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>  此时，可以在颜色连接处留 1px 的过渡区间，优化视觉表现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1498147687868911600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(30deg, red 50%, skyblue calc(50% + lpx));`, `1498147687868911600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>30deg<span class="token punctuation">,</span> red 50%<span class="token punctuation">,</span> skyblue <span class="token function">calc</span><span class="token punctuation">(</span>50% + lpx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>  优化后的效果如图 5-9 所示。</p>\n<p>  <html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-01cf0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.404352806414664%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABxklEQVQY03WLzWvTYBzHn3XIcINefNm8DAaibFePetL/w5MnX/CwXQYinW1ZaRFfdpgyU9jarXTKXthAZQcRqaNbmiZPkm6mraUM2zxJTJOshaZpnsdn4HU/vnz5wu/zAblHs3HZelHHcdFKwFZcsmgSkhUWWp+RR9rtbL768gQvHjvvReOdbNIsyuZSyaw7PUAAQNcnP75KzR115kqd2KE6z6IYp4XyzS3UJ39O7JtTX588jxb0Z4obZbUoi8IFfZ7TFcs9k/HgIO3q7XtM5ltIcSOiHWfV0IG6TeVmwx8do1/txtSn1+mI7ISP2jEWJYp6+b88PEKGhujwLw5z9x8ufC9Ha36EN3c1n8p49OoZEwjQbty5m13bS5Tst9D4bXcBBsANBHoAdAHwBgYoYY8ENx7MTK/vr1atdqUiT94SgtfglQl4aVy5EISXx5nHkae5Jmx5QE+mtVQWLWfQ8hpayTTS6zqzor5Z2Nv8ssNKB4VismQw5dMPis0ozlKlk1ScFN9k6m6tSwA577DfcayW+bfv9c5DAO55BBNDRZAXDVUTeTH3Y1+GEseLBV6AkiyIx0Uo/8yzh5zwq1qjjufjPqYS+Qex8FvHHbxAJQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 11 55 20" title="" data-src="/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-fee1c.png" data-srcset="/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-a67b7.png 200w,\n/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-0b187.png 400w,\n/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-fee1c.png 800w,\n/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-01cf0.png 873w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ol>\n<h3 id="渐变与动画"><a href="#%E6%B8%90%E5%8F%98%E4%B8%8E%E5%8A%A8%E7%94%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渐变与动画</h3>\n<p>CSS 渐变中虽然有很多数值，例如角度值、断点位置值等，但是很遗憾，CSS 渐变本质上是一个 <code class="language-text">&lt;image&gt;</code> 图像，因此无法使用 transition 属性实现过渡效果，也无法使用 animation 属性实现动画效果。虽然我们无法直接让渐变背景不停地旋转，但是有间接的方法可以实现 CSS 渐变的动画效果，这个在最后有介绍，这里就不展开了。</p>\n<h2 id="深入了解-radial-gradient-径向渐变"><a href="#%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3-radial-gradient-%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入了解 radial-gradient() 径向渐变</h2>\n<p>径向渐变指的是从一个中心点向四周扩散的渐变效果，光的扩散、波的扩散等都有径向渐变的特性。</p>\n<p>在 CSS 中，使用 radial-gradient() 函数表示径向渐变，其语法比较复杂，所以我就琢磨如何让大家比较容易地学习径向渐变的语法。最后我决定通过一个接一个的案例带领大家深入径向渐变的语法，因为每个案例都有对应的效果示意，更加直观，自然更加轻松易懂。</p>\n<p>学习这些案例还有一个好处，那就是非常实用。因为本节的径向渐变案例覆盖了几乎所有常见的径向渐变应用场景，所以如果大家在项目中需要使用径向渐变，但又记不清径向渐变的语法细节，就可以翻到本节，找个案例套用一下，就可以实现了。</p>\n<p>接下来介绍的这些案例，如果没有专门说明，径向渐变效果就都是作为 background-image 的属性值呈现的。</p>\n<h3 id="最简单的径向渐变语法"><a href="#%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最简单的径向渐变语法</h3>\n<p>先从最简单的径向渐变说起，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64052851453185020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   width: 300px;\n   height: 150px;\n   background-image: radial-gradient(white, deepskyblue);\n}`, `64052851453185020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-10 所示，是一个椭圆渐变效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-e07da.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 611px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.53846153846154%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACE0lEQVQoz02S2WsTURTG55/Rt7747oIPYooIBjesWKu2aFtxV0yfFKzg8qLg/iA+iPrsAiouILjEpM0ymcxkUtqYVMcmaRPNYmrn5zlTKw7fw3fvPd893z3fGNtNVkRZN87GJNtMdmXoz3LA5qDDoZxCyKCjm70ZLZAyKRbJ1jTGhiTLPrAyzvoEm9P0Wuy3VXPC5VReIeRwTq+Toy1pQglWxVXSncDos1g7xg6TgSzHXc5McrnAtSJ3prn7VSFElrJ5dpKTrl7dY6pEjBjDDptSDNpE8lyY4maJBx6Py7yq8m5O8brKkzIPPW5Pc7GgZUMO4RRDNsYxV9tKz3OTXC9p0Ysq0TpuE+8XXod8k1idl1UefedGidEp7d+T4UguEAv7Ky6q+HmFaA23xUyHcoeJ1pLYU1+jgfmdi+LhRQ8OkQm1fSto/rTCm1ne1xRvZ3lW0bby+EsFRiYY/md7X1ZHLwnJs0/n9eIrX/R5975xP4AQWV4tcn6KkbwqZewi2WsFUS3/qNOX0Ut0MnxJVSxJSJEAQo66am2PpTlL2eq4SrqTGJJtV5Q1Y4TG/XDKl+Httvx+a2HQ9ocCCBnI+n0ZOdKCUMKXnLo+EZafpP6b2Xlq8zThxwI/fUUbWkto/oeGTwNqgUSEBsHXbrdSieRcpVytVGc8L/Y5lrNsR2DbuawjxLYsM5kWYplmsyH34Pv+H7z+Q05S0SLhAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 19 56" title="" data-src="/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-e07da.png" data-srcset="/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-20936.png 200w,\n/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-da2be.png 400w,\n/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-e07da.png 611w" data-sizes="(max-width: 611px) 100vw, 611px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>从图 5-10 可以看出，径向渐变的方向是由中心往外部的，默认终止于元素的边框内边缘，如图 5-11 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-5e5c6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.49707602339181%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACOElEQVQoz1WS30tTYRzG/Qu67bLb7oNu7KbL8iKkiDCiCBMkg0iyEgqKKAKJIKgLTa1gGBb+CgdhZKXI3Fw7a3r8sbYz9Wxsc+qOOzubZ+/76d0mQV94Xr4vL+/D8zzfbwOq8q7klAZNCi1amWuazY1wgc6wRZe2S1dom9uqv6lZtGsFLmsO538LGoMwmBSKQVKR6pSShupl14XjfsGJGYuzAZvWxQqda5IHcXiyAU8VHqn+XhSuL7lcDDk0zVkc/VnidYpauRVFLESVECyl8Jx/jysRl+4YPF+HtynJ+BZMJPKMxnJ48zCUg1dpeLgJHQnlaCZLfyDMdi6rZFFDnbC0z6VggY41pcaQDCQl3qxAL8P3VYM3vf2Yi3/w+5bwzuq8n9Z5MbVMx5jO3Z4ViqEQ0udDfps+ICxXaAns0a4IH8clvaZkLCPw2RAJRPCPetHNXb6aNh9iBV4u73Ffd7gz/AvPoArSKSIyGWTcUIRSsFMWnPHbXFgocKtKaihrytY7Ze+zvsUXPcuQCr8vAz0mdKv3tmVB85TJyEo1REGlHiUNES3E9HyQwwMLHPkYpXGuyOl5Ra7tczWsJr4iaVuF1oiKRSvRHCxxctbi2A+LQzPwzDwYipD1KTu2zU7Bptdw6Ntw8ShVn9KCkc0i46bDZLLIpLI6mSoxoTCS2mdYKfVk6y4C+fraiNpUZD3D/6pSJm2oHSk7uAWLZDyGGY2SMgzS6wnSCYOtjQQ5BSql2hch5b/vfwGQpXOzYACRmQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 21 55" title="" data-src="/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-fee1c.png" data-srcset="/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-a67b7.png 200w,\n/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-0b187.png 400w,\n/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-fee1c.png 800w,\n/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-5e5c6.png 855w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>所有径向渐变语法都是围绕改变径向渐变的半径值、中心点坐标，以及渐变颜色的起点和终点位置展开的。</p>\n<h3 id="设置渐变半径的大小"><a href="#%E8%AE%BE%E7%BD%AE%E6%B8%90%E5%8F%98%E5%8D%8A%E5%BE%84%E7%9A%84%E5%A4%A7%E5%B0%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置渐变半径的大小</h3>\n<p>如果希望图 5-10 所示的径向渐变的水平半径只有 50px，垂直半径还是默认大小，则可以设置 50px 50% 作为第一个参数，渐变代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35046318724372627000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(50px 50%, white, deepskyblue);`, `35046318724372627000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>50px 50%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-12 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-e5c7b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 612px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.274509803921575%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABj0lEQVQoz42Ry0pCURSGt0d7gUgCu1MQlFFhiTWrYQVNoh4jSGjWrEHvUZPoDbpooJ68YupRM49moZWFlzQa6f5b+5hgkBD8HNZe6//W/jmbbccx4cWMH9MdmvLB7IMtiKUQzHT8PSXzuBcEsvkA2AWkK7BOOdDvgS0kYJPn9+hKM5/D4gdbCIqz3gmdJskJ5kSvCxsR2NOwq9iMwugS66S2h8zsEosEWjS4xfzIgUkvdtM4fsHJK/ZUEZV1GCQNXvgTpt209TCHUA23dRw9ivDS/2ErwQ+CjH0KePn/MMWmv01pT4s4K2JfxUygS2xrSLh7rqHXZLgWN/e7saXgICu0E4dJFk1D20NmQihd16cakbESxmoYYzfQObo81VqEG92crEMyH/QItYpRmc/6+ZxfFAPUb09JwzLvc/H1CFi9iQ+OShOVBqpN1IAqF52q1iw3RN0SjWrat3UkkJXfiwklViuXvj7rz/l8NBx+ymZzmTRJTaXeCoVM6p4KNZlMKspdXElEoqlE4i6mVErlb3+56yeZ8UKWAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 32 40" title="" data-src="/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-e5c7b.png" data-srcset="/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-ec56c.png 200w,\n/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-73c25.png 400w,\n/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-e5c7b.png 612w" data-sizes="(max-width: 612px) 100vw, 612px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果希望径向渐变的水平半径和垂直半径都是 50px，则无须设置为 50px 50px，直接设置为 50px，当作圆形径向渐变处理即可，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23708924971491040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(50px, white, deepskyblue);`, `23708924971491040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>50px<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-13 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-d67a7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 718px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.64623955431754%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQoz42QzUrDUBCF0+pGRV/AVdWNdmcRRMS1iDtfSFyJ7yGCP+BOaPPbNvGmSZMmupXa4MIqaosuXLQ5Tu5t2goKvXwZzsycQ2CkmzcsWlhmWPpN7nbA+FDYcgz+J+hJF21IMjIqpHEUXjUulNF8aLO6PHz1kqyzGjIplFmoYKuO/RAbLuaMZCJW2dTARPiSh8VIQI5tD8ctnLVx2MS6O1oNbX+ERZ0xcHCP61c8feP0GbsBpvUJwoIpDTseTlqgcxw9ojDhnweomC9js469AAUHs8b/4XO6dglZJT2sQOaoqUjnGQ4Js8PDxXesMORrCWucvJPoVcLmbSJisR3agi8ejuMYBH39PlUakaAG4vEVBh6M6bjX60kPzeij042iyA9Du+6bFlM0Q69YrucXS4qsVRvBneN5ZZPVHFer0N7WqWE1Ra/+AAaa0b6puhgxAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 34 24" title="" data-src="/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-d67a7.png" data-srcset="/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-8a0cc.png 200w,\n/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-ca50d.png 400w,\n/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-d67a7.png 718w" data-sizes="(max-width: 718px) 100vw, 718px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>但是要注意，水平半径和垂直半径合写的时候，只能是长度值，不能是百分比值，也就是说下面的语法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91059994808513430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nradial-gradient(50%, white, deepskyblue);`, `91059994808513430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>50%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果想要使用百分比值，就必须给出两个值。例如，下面的语法就是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34219746890580603000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nradial-gradient(50% 50%, white, deepskyblue);`, `34219746890580603000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>50% 50%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="设置渐变中心点的位置"><a href="#%E8%AE%BE%E7%BD%AE%E6%B8%90%E5%8F%98%E4%B8%AD%E5%BF%83%E7%82%B9%E7%9A%84%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置渐变中心点的位置</h3>\n<p>如果想要改变中心点的位置，我们可以使用 <code class="language-text">at &lt;position&gt;</code> 语法。<code class="language-text">&lt;position&gt;</code> 这个数据类型在 background-position 那里已经详细介绍过了，已经忘记的读者可以翻回去再看看。</p>\n<p>例如，如果想让渐变的中心点在左上角，则下面两种写法都是可以的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22248946816100810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(100px at 0 0, white, deepskyblue);\nradial-gradient(100px at left top, white, deepskyblue);`, `22248946816100810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>100px at 0 0<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>100px at left top<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>效果如图 5-14 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-e07da.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 611px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.374795417348615%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABT0lEQVQoz42Su0oDQRSGJxtFbCwEBSFGCxEFK1GxUyxM4eUZbG0kT+AL2Aj6GhZip8Y16m4WL8leErOXJEUSCGxitSaFMPM7u0VgEZOFj5+ZM/MNM4chXz/Ie7hq46yOYwspDYsKZnNI/s98DlMSDnQQ1cNNB5dNpB3saVhQMCKCPAxC4HmH9XeQ6zYumjit4aiM7TwSEgQRsYHE+en32ODyeQMntm/uqlhWMJ4FEYcg9OW0jZSKrTyWFEw8DTdD8qGOORkzEsaykcyQvPoW9ECMaobklVdfHn1EPDJ8M8lg8wOEP5X3PZbx5xEReN5ijV95p4DpF5aUkZAx6ydLSH8IF5Mym3xm+/yTdCl6wDfz8YJxny6HBRkMQku8TkEYpVpB67hux233PM8yzbJR+jRKRdWoORW31ao6Fccym/VG1XYMTS+qulU2bdOklP4CqE3jv719hP4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 41 50" title="" data-src="/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-e07da.png" data-srcset="/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-20936.png 200w,\n/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-da2be.png 400w,\n/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-e07da.png 611w" data-sizes="(max-width: 611px) 100vw, 611px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果想让渐变的中心点在距离右边缘和下边缘 100px 的位置，则可以使用下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98697959368702560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(100px at right 100px bottom 100px, white, deepskyblue);`, `98697959368702560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>100px at right 100px bottom 100px<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-042f3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.44607843137255%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABnklEQVQoz32Q30tTURzAT6skKuw9X7SXhJJC6B/orSCEwEfxpR9PEvhUIhUUvvQSQQ8RaaAPEgjik9nscgs1t8GYiWlC23S7d/dud2ObbnnXzqdzNhgG4eHzcL6c7+f744g/EnVms1xcpTfM1QZXwlyPcn+LsSQTNtMO7yyeJbi7ybUIczmtKFHUGvJbC7FAYBHR5DOdK/Sv8zzOjItR4IPL0zi31zn3lQnrX3lcyUFOGAQMjhm0mfRGdOc3aaIl8j6hIq9T3Nmka4WpzP9kZYoGxw0urzL4g5e7BPN8L/PR48UOAxt0LDFpHykrzi9xM8bwNq9S+lVVebDNjRinTd635OaHqVjtecrUAytOmpwx6QnRt8a9LYZ+6oFvrXEppNMmW2P7dWVLtZuYl4FPUhwmKNu/yAvLsvub7FqWZ00ZWJQqbTytlVpdirquQrjE8C9GEjxK8DCu0ZfG/XGSJ0lGm2FCp0X3taKaCsuy9vb2/WrlwHMruUzZsWpFT5YK1ZxbstO/Pbfs2FXP9Qu5StapFfN+0ctmMmnLdtzsX5/9qhG8oS7LAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 45 04" title="" data-src="/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-fee1c.png" data-srcset="/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-a67b7.png 200w,\n/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-0b187.png 400w,\n/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-fee1c.png 800w,\n/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-042f3.png 816w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="设置渐变终止点的位置"><a href="#%E8%AE%BE%E7%BD%AE%E6%B8%90%E5%8F%98%E7%BB%88%E6%AD%A2%E7%82%B9%E7%9A%84%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置渐变终止点的位置</h3>\n<p>如果渐变的中心点不在元素的中心位置，又希望渐变的结束位置在元素的某一侧边缘或某一个边角，那么渐变终止点该怎么设置呢？</p>\n<p>CSS 径向渐变语法中提供了专门的数据类型 <code class="language-text">&lt;extent-keyword&gt;</code>，该数据类型包含 4 个关键字，可以指定渐变终止点的位置，如表 5-2 所示。</p>\n<table>\n<thead>\n<tr>\n<th align="left">关键字</th>\n<th align="left">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">closest-side</td>\n<td align="left">渐变中心距离容器最近的边作为终止位置</td>\n</tr>\n<tr>\n<td align="left">closest-corner</td>\n<td align="left">渐变中心距离容器最近的角作为终止位置</td>\n</tr>\n<tr>\n<td align="left">farthest-side</td>\n<td align="left">渐变中心距离容器最远的边作为终止位置</td>\n</tr>\n<tr>\n<td align="left">farthest-corner</td>\n<td align="left">默认值，渐变中心距离容器最远的角作为终止位置</td>\n</tr>\n</tbody>\n</table>\n<p>各个关键字对应的位置如图 5-16 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-932f0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.18288393903869%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABtElEQVQoz41RTUsbURR9NLQIXXTnHyil2H9QXNid2G5EbFyEiv4AwV9QsumqhZS2dN+lP6AIGjRpKmT8mmjSiWPiJJmZTDITsJnR+cpk3unLhwmkGw8HLu/y7j33nktwBwoEdMhOSEOgIisH3OExf5YvXvgh1Q2j3W7btu26ruM4nucR9GsYPoo307/pcw5Ps5jhsCIgfuklckriTI2L7ptzxPZrDUWuVKuapqmqqus6uWYwLTjW+o5IfgYP90GSeJzGQg7fmsg08UvDdx2zJ4gW2DSU9mccgLA2DaMV/G2t7YpkO3iUBtnDkwwWC/hUtn6kpK0j47N0+4pHTOgtF9IxxmO/Fx2SpFNpRFKYSuHlKTaKQUKyv8jeZrHzgsNSfmjNWJk1YPYAYbwUkG0aSYLs9vhgD8+yYIJzPJgRLPOa/6948EbX/8qVF47stwKWzikTWcxjuYBVAe8ERP9gPocP1WHxCMT3fWadrChqtWJpcuDamPwzOuVkknS7XdM0Lcti1zOtm47fwb3R25kFw2jVtcatbdfrmlAUVZXFRk1WLsRS+UoqMZaly9IVo+O4GFwM+Ac9QAbA6pYnbAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 59 01" title="" data-src="/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-fee1c.png" data-srcset="/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-a67b7.png 200w,\n/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-0b187.png 400w,\n/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-fee1c.png 800w,\n/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-932f0.png 853w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>我们试一下，看看使用关键字 farthest-corner 的渲染效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82760059031640520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(farthest-corner circle at right 100px bottom 100px, white, deepskyblue);`, `82760059031640520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner circle at right 100px bottom 100px<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-17 所示，可以看到白色到深天蓝色的渐变一直过渡到左下角。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-284ba.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 653px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.949464012251156%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACSUlEQVQoz12RWWtTURSF75/wDyiKoL74qBbHBxEfhAqCKCgo6EMRH7QoCmJxqgPUFuxobbWCI1JxqoqK1jatTdvMSZvm3uTmZmim3jTpZM/nOcEHETabw4Fvr73W1g772D3OIR8ng9SGuaJzN0anxfM077N8z/PLxlXEM8t4EYfNlzxvMvSkeJpCq3KyapAtTva6kINOhbgUoSFGV5Leab7mcdoESkyU8ZUYmuFTjhdpWkw6LLRdY6x3IPt+D8cD1E5yXac5zpM0fTmGbYWlFsgtEp/HW6J/hrdZuhI8TFTgdf/BBi1xnqX5mGPEZmqOwhLzgvSiWmFghndZupM8SqLtrMCyV7s5FuDMJNd07knlFH1ZtWeoRGKBzCKmVJ6lv6A8P0jQLZW3j7LWwbZR9rk54uf0BHURGmNqq9cZvknPRfwlgiVFOiqeX07TaqlQta1OVg9SVQlMZl4T4uIUtwzaLCUu7UleriqxnwU+51SKPUkaTWVNkzmvHGDTiDrYAS8ngpz952DyHr0ZdbMPWTXo1TSPU7TFqTcUr20cZsUPNgyxeYQ94xys8NL55Qh3oir2ThlsUqnJ3m7RZHIzyvkwV3W0HU6xZlBIfalc7RZHfaImJM6FRV1E3DZEkyla46IjLu5bot0SzaZoiIl6Q1yYEjcMoWV+k1pSlV4iL8gvU1jGrlRxmVlBSVDmb5UqJT9tQVGgRcJhXTfsQmGuXHaNuULBiVjUNKNmJpNJJpIJK6HrUZfL43F7A4GQ3x/wev1et08+DCP6B+EeWEsrxRTzAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 12 01 04" title="" data-src="/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-284ba.png" data-srcset="/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-b5223.png 200w,\n/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-dce0f.png 400w,\n/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-284ba.png 653w" data-sizes="(max-width: 653px) 100vw, 653px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果图 5-17 看得不是很清晰，我们可以稍微改变下，将渐变转换点位置调整到接近渐变结束点的位置，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46062110110951694000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(farthest-corner circle at right 100px bottom 100px, white, 99%, deepskyblue);`, `46062110110951694000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner circle at right 100px bottom 100px<span class="token punctuation">,</span> white<span class="token punctuation">,</span> 99%<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时效果如图 5-18 所示，可以明显看到白色一直延伸到元素左下角位置，表明在这个例子中，farthest-corner 对应的位置就是左下角。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-c84fc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 685px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.78102189781022%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABGElEQVQoz5WRzU6DQBCAeVQfwMTwAHAUUoxXeuDkRSQSLn0B/6BdtJYgh1JaxFZ74G8hHpoWWIeiMTUhkS+7m9md+bKTXaqqKkKI67oMw0iSJIpivwVIQQHLso7jgFKWJQUTIoSQLMsQFEVBWmhSqqrqun4gm6apKMqvvG/nD02lpmmGYbTIu13bzf+Qt1uCMVmvu8mX12otDwbE98lm00VG6Pziqj7Ks84P5k6nR8cnp8IZ3+vxHMf/wB0iCAJN07Ztf8tVCT9dL595HkdxHEdAGIVhVG/SNEn3YIyTJIFUlmVNC2BR9w968LaC+tl8jp4mluXc3N4NR+PxxPIWvjtbBMv35erDfw08zzfNZ8t6GaJHGMYIfQGT5QwY8ayQ0gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 12 04 07" title="" data-src="/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-c84fc.png" data-srcset="/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-18514.png 200w,\n/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-82fbc.png 400w,\n/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-c84fc.png 685w" data-sizes="(max-width: 685px) 100vw, 685px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>上面的例子中出现了一个关键字 circle，它表示一个圆。与之对应的还有一个关键字 ellipse，它表示椭圆。由于径向渐变的默认形状就是椭圆，因此，没有任何一个场景必须要使用 ellipse 关键字。</p>\n<p>circle 关键字必须要出现的场景也不多，多用在需要使用 closest-side、closest-corner、farthest-side 或者 farthest-corner 关键字的场景。</p>\n<h3 id="径向渐变中的语法细节"><a href="#%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98%E4%B8%AD%E7%9A%84%E8%AF%AD%E6%B3%95%E7%BB%86%E8%8A%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>径向渐变中的语法细节</h3>\n<p>上面这些示例已经覆盖了常见的径向渐变的语法，是时候给出径向渐变的正式语法了，再看看是否还有遗漏的细节：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84169385102694020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(\n   [\n      [ circle || <length> ] [ at <position> ]?, | [ ellipse || [ <length> | <percentage> ]{2} ] [ at <position> ]?, | [ [circle | ellipse ] || [ extent-keyword ] ] [ at <position> ]?, | at <position>,\n   ]?\n   <color-stop-list> [ , <color-stop-list> ]+\n)`, `84169385102694020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">radial-gradient(\n   [\n      [ circle || &lt;length&gt; ] [ at &lt;position&gt; ]?, | [ ellipse || [ &lt;length&gt; | &lt;percentage&gt; ]{2} ] [ at &lt;position&gt; ]?, | [ [circle | ellipse ] || [ extent-keyword ] ] [ at &lt;position&gt; ]?, | at &lt;position&gt;,\n   ]?\n   &lt;color-stop-list&gt; [ , &lt;color-stop-list&gt; ]+\n)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面说明一下具体细节。</p>\n<ol>\n<li>\n<p>从 <code class="language-text">[ circle || &lt;length&gt; ]</code> 可以看出，如果只有 1 个值，或者出现了 circle 关键字，后面的值只能是长度值，不能是百分比值，因此下面的语法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15068820297348794000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nradial-gradient(circle 50%, white, deepskyblue);`, `15068820297348794000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle 50%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>circle 关键字和 ellipse 关键字在与半径值或者 <code class="language-text">&lt;extent-keyword&gt;</code> 一起使用的时候，前后顺序是没有要求的，也就是下面的语法都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79673188493143300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nradial-gradient(50px circle, white, deepskyblue);\nradial-gradient(circle farthest-side, white, deepskyblue);`, `79673188493143300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>50px circle<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle farthest-side<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但是 <code class="language-text">at &lt;position&gt;</code> 的位置是固定的，其一定是在半径值的后面、渐变断点的前面，否则语法就不合法。例如下面的语法都是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57388328557289415000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nradial-gradient(circle, white, deepskyblue, at center);\nradial-gradient(at 50%, farthest-side, white, deepskyblue);`, `57388328557289415000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">,</span> at center<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>at 50%<span class="token punctuation">,</span> farthest-side<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>最后，如果能一眼就看出下面这些径向渐变代码的效果都是一样的，说明对径向渐变语法的学习合格了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73054217421026620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(white, deepskyblue);\nradial-gradient(ellipse, white, deepskyblue);\nradial-gradient(farthest-corner, white, deepskyblue);\nradial-gradient(ellipse farthest-corner, white, deepskyblue);\nradial-gradient(at center, white, deepskyblue);\nradial-gradient(ellipse at center, white, deepskyblue);\nradial-gradient(farthest-corner at center, white, deepskyblue);\nradial-gradient(ellipse farthest-corner at center, white, deepskyblue);`, `73054217421026620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>ellipse<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>ellipse farthest-corner<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>at center<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>ellipse at center<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner at center<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>ellipse farthest-corner at center<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="径向渐变在实际开发中的应用举例"><a href="#%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98%E5%9C%A8%E5%AE%9E%E9%99%85%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>径向渐变在实际开发中的应用举例</h3>\n<p>在实际项目中，径向渐变除了用来实现元素本身的渐变效果，还被用来绘制各类圆形图案。例如，给按钮增加白色高光：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14328348277456814000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`button {\n   color: #fff;\n   background-color: #2a80eb;\n   background-image: radial-gradient(160% 100% at 50% 0%, hsla(0, 0%, 100%, 0.3) 50%, hsla(0, 0%, 100%, 0) 52%);\n}`, `14328348277456814000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #2a80eb<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>160% 100% at 50% 0%<span class="token punctuation">,</span> <span class="token function">hsla</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0%<span class="token punctuation">,</span> 100%<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span> 50%<span class="token punctuation">,</span> <span class="token function">hsla</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0%<span class="token punctuation">,</span> 100%<span class="token punctuation">,</span> 0<span class="token punctuation">)</span> 52%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-19 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-310ee.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 415px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.554216867469876%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACPUlEQVQoz61RS08TYRSd3+AWJD6iUSu48CeYuFI3xsSFCQUVX2gimypGLBQXgmKMhNQmFinFViwILa21jaMClYSYqDtUCNY+6LS0nXamFInmeO9MlOrKGCc5Od+95977ne+O0DpWRPuEArPv33HNq6AzoCCe+wahvl/GKaeMpkEZJyvQ9Cec61xZw8z9x+x5ROa/Qjg9JOO8u4BzDwtodhW0MzPHrDHO0pmbfsZanWu954Jb12cX1yActuZw3CHjBKFluID7kRL6Xqno9Cu4N1PC3Rcq7jxXMcBnUYWV4l6xBBvVXXwko3FARsODPA705iDOrULY3JrGHksGBnMaR/vzuBVW0R1S0OyWqVGFhXbcRjuyT5dwO6ygJ6TrXcEi9nctw9CeQS1h4yUJT96WIWy5ksZuSmwlPmjLoYF2coaeZaRb9/VkccSa115QT7GRLjzUl4PRkUcj7WxvRwbb2/T+TWRs/B0N3HaVHJJQS2BhBxXsMmc018ycr+vQXeykmB0ZiOssusZ5rmVj2sANLSnUXJZQbdLB1qsJVSadOVdVqZl+zzFqKM9zvO9p4PVAETdpJ4zuZ8z6jvj8V6DaG0FF+2FZ9TsE/OdPmPu4gMRSGivlMuLJFMqraygqJcQTKcISFqMxxIil9DKiXxKIxpKaJmWyv7TP0ThiSUkfaLM7IE6+RlZKYWb2DQrKCj58moc/EIZnZAyPPV5MBIIQX07DOejC8Mg4Rn1P4Rn1wjHkxtRkBD5/CGFxShv4AzhC7jPj+4nLAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 18 11 31 31" title="" data-src="/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-310ee.png" data-srcset="/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-b3bb4.png 200w,\n/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-9106d.png 400w,\n/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-310ee.png 415w" data-sizes="(max-width: 415px) 100vw, 415px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>径向渐变也可以让按钮背景呈现多彩的颜色融合效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92460900542367020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`button {\n   color: #fff;\n   background-color: #2a80eb;\n   background-image: radial-gradient(farthest-side at bottom left, rgba(255, 0, 255, 0.5), transparent), radial-gradient(farthest-corner\n            at bottom right, rgba(255, 255, 50, 0.5), transparent);\n}`, `92460900542367020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #2a80eb<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-side at bottom left<span class="token punctuation">,</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">,</span> transparent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner\n            at bottom right<span class="token punctuation">,</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 50<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">,</span> transparent<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-20 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-96dff.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 494px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.797570850202426%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACi0lEQVQoz02P+y/bYRTG/Wv7cSoRZNklwkwWlpjMxOI2lrjNxDATVS3Slky0WNa5VKpal9SwatFWVctci7Yo36rbZ1+SpTvJc54n5ySf97xxiOXZvySp0Y+kfpfExi2SmjdJbvGR0rrOozY3j9tdPJE7eaZYIVWxTFrHEmmddtI7baIvkqm04T08v0MRd9cszggP8jeJL/YhKfXwsMRFfNkKkgo78VVWJJ/mia+fRdI0Q0LzFAlfzSS2mEiRmsUH77KRWd9hDGhzCqS+8fHi3TqZRW6KGzyUflmjsMlBucxBscxOcYeVQtU8BSoL77W/KNBOkdE1Kl43Kl46zOKWPwZ0LAvkZnvJz/WQl+vi+8AeRsM+cqWXEcMWKu0qPwwbDE646dU7GJxxoTTNkaMc4PW3QV51a1na3o0B15YEyjO8VGZ5qMheRV7rRdOxgVLmRtPjRi5bpEtlR62x0tozjXLIgkJnpFTdR4mmlwKNGsfedgzoXRCoS/bR8HSdxjQ39c9XqHtpoy5ngdo8C7VFk3z8ME5N9Sg1n3VUt/RTreilWq2mqq+LsgEprn1fDHiwFqU7fQdVxibKLC9dOW463jqQF9ppL1tAVjlLW90U0iYjUqkeaacOaU8/Um0vrTolrWMKdkL/ffmuoie3CIEbzgPXXIj54lTU2S2R8A1C+IrI+TUR4QpBuESIREVdEImKuoxweRP9hyHO7/dzGj4TlwKCqJvba0InIYLHAQ6PDu7z2fkZgVCQQOCI4+OTe4XD4XsPBUPiXNwFg/j9B8SN6PXYlh04nat4fX84OgowYZ7GaDYzNKJn2jLHwm8b+nETup/DTE7NYJ60YDRNMjZuZkJ0g9GM1WpnzGDiL2SPhxzx3qYqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 18 11 43 35" title="" data-src="/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-96dff.png" data-srcset="/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-1a6e9.png 200w,\n/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-b9533.png 400w,\n/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-96dff.png 494w" data-sizes="(max-width: 494px) 100vw, 494px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>径向渐变还可以实现点击按钮的时候，出现一个圆形扩散的效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73629306798010010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`button {\n   color: #fff;\n   background-color: #2a80eb no-repeat center;\n   background-image: radial-gradient(\n      closest-side circle,\n      rgba(255, 70, 70, 0.9),\n      rgba(255, 70, 70, 0.9) 99%,\n      rgba(255, 70, 70, 0) 100%\n   );\n   background-size: 0% 0%;\n   transition: background-size 0.2s;\n}\n\nbutton:active {\n   background-size: 250% 250%;\n}`, `73629306798010010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #2a80eb no-repeat center<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>\n      closest-side circle<span class="token punctuation">,</span>\n      <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 0.9<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 0.9<span class="token punctuation">)</span> 99%<span class="token punctuation">,</span>\n      <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 0<span class="token punctuation">)</span> 100%\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">background-size</span><span class="token punctuation">:</span> 0% 0%<span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> background-size 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">button:active</span> <span class="token punctuation">{</span>\n   <span class="token property">background-size</span><span class="token punctuation">:</span> 250% 250%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-21 所示，这里为了方便示意，扩散的圆形使用了红色。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-08a78.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 574px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.09756097560976%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABvUlEQVQoz2P4jwf8+wci9+z5f+DA//Pn/5879//Wrf87d/6/efP/sWNAGYa/f///QaB///8CwT8o98+/P0Ald+78f/z4/6NHIMaXL/+vXv3/9u3/jx//f//O8B8/gFgOVPrgAdAwNEmGhce/Va7/1LD5c9WWH0tXXLsye+O6ZReqt34Hiaz7OPHwrx/HT/0/d/YfxCAIghnK4NT3VqjgOX/Fh9j4DfesfR5beTyy8iyMWMBX/l6k6LlO0+vnzz//B3rmHxZnMQTPeKdW/9qg6eX55lk/snLfVjR8zSl8O22Od/dz5brXDr1vXn76C3c+Fs0qta8t2l/da5/xs7b+xYy5z1q6vk6fEzrhmVLtG0f8mt0nvpUqfSFZ+7E4edUbe88HAdHHy2tbQidJ1H6UKXth1PrmxUeQZuzOnnnoa+6Kj8VrPuWs+bZyzvHrPQtWztiXv+ZL4epPeSs+tO/4/P0XOLCwxMM/SFT9wxNXQPQHmACQ3A1KCZDQfvP27eHjpx8+fv70xesvHz+dO3fh2LGTx0+ePXL89IUr10+eOXv4+MmjQJFTZ2/eun3y1JlTZ84eO3n64sXLl65cBwCbajIjgKZIKwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 18 11 46 57" title="" data-src="/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-08a78.png" data-srcset="/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-683d3.png 200w,\n/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-6bdc6.png 400w,\n/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-08a78.png 574w" data-sizes="(max-width: 574px) 100vw, 574px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/khz3c4?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>径向渐变还可以用来绘制各种波形效果，例如绘制优惠券边缘的波形效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31513553858197030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;radial-wave&quot;></div>\n<style>\n   .radial-wave {\n      width: 200px;\n      height: 100px;\n      background: linear-gradient(to top, transparent 10px, red 10px) no-repeat, radial-gradient(\n            20px 15px at left 50% bottom 10px,\n            red 10px,\n            transparent 11px\n         );\n      background-size: auto, 20px 10px;\n   }\n</style>`, `31513553858197030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radial-wave<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.radial-wave</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to top<span class="token punctuation">,</span> transparent 10px<span class="token punctuation">,</span> red 10px<span class="token punctuation">)</span> no-repeat<span class="token punctuation">,</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>\n            20px 15px at left 50% bottom 10px<span class="token punctuation">,</span>\n            red 10px<span class="token punctuation">,</span>\n            transparent 11px\n         <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">background-size</span><span class="token punctuation">:</span> auto<span class="token punctuation">,</span> 20px 10px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-22 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-18-11-51-10-8c5d54dfe2bbb5fea0f8c99f6f0775c0-58792.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 385px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.18181818181818%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABLklEQVQoz6VRy2rCUBANvtbuXPsEt4L/of6EH+Af6RcIUkqTam0MUdI8xKiJ0UQhqfhEslS50ztaSleVkmE4c84wh7ncYYBGrQa5HBSLUCg8SDqTyUCrha7rlcFSKgHDQDiM+HdGIoj1Oroul5u5UsFWNAqh0IOMxXCy0fhlLpcDbA5kDvTsQB9WrUIiAdksHiyVgnQaeTKJkh7mTihSns9DPA7N5vepCC2nE9nvyW4HxyNF5JRsNuRwQL7doqR476/XcD6ji5Db5p8gBP4TjKyNfN/3XM/zPqm2rLmiqIZpOfZqOjFUVbMXznikq+rQNGayrEjSx8yay4pm2UuGFyXX9fTxZOEsqVkQBy/s60Ad9vsS13l7eua4drfXE7jOe5cXKOUF0ZiaLNuWNf0Lc+PBGza3UXIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 18 11 51 10" title="" data-src="/static/2022-02-18-11-51-10-8c5d54dfe2bbb5fea0f8c99f6f0775c0-58792.png" data-srcset="/static/2022-02-18-11-51-10-8c5d54dfe2bbb5fea0f8c99f6f0775c0-f436a.png 200w,\n/static/2022-02-18-11-51-10-8c5d54dfe2bbb5fea0f8c99f6f0775c0-58792.png 385w" data-sizes="(max-width: 385px) 100vw, 385px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/8sn1v1?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>径向渐变可以实现的图形效果非常多，就不一一举例了。总而言之，要想将径向渐变用得出神入化，一定要牢牢掌握其语法。</p>\n<h2 id="了解-conic-gradient-锥形渐变"><a href="#%E4%BA%86%E8%A7%A3-conic-gradient-%E9%94%A5%E5%BD%A2%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 conic-gradient() 锥形渐变</h2>\n<p>锥形渐变是 CSS Images Module Level 4 规范中新定义的一种渐变，也很实用，但其兼容性不太好，IE 浏览器和 Edge 浏览器并不支持，因此只适合在移动端项目和中后台项目中使用。</p>\n<p>锥形渐变的语法比径向渐变要简单不少，正式语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81159964628078530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`conic-gradient([ from <angle> ]? [ at <position> ]?, <angular-color-stop-list>)`, `81159964628078530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">conic-gradient</span><span class="token punctuation">(</span>[ from &lt;angle> ]? [ at &lt;position> ]?<span class="token punctuation">,</span> &lt;angular-color-stop-list><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>可以看出锥形渐变由以下 3 部分组成：</p>\n<ul>\n<li>起始角度；</li>\n<li>中心位置；</li>\n<li>角渐变断点。</li>\n</ul>\n<p>其中起始角度和中心位置都是可以省略的，因此，最简单的锥形渐变用法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70005573994786110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   width: 300px;\n   height: 150px;\n   background-image: conic-gradient(white, deepskyblue);\n}`, `70005573994786110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-23 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-42e87.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.16917728852838%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACMUlEQVQozzWSSWhTURSG38KFK3cu1IU4oSI4YKWO4FyV4oCCIG7sRnSl4M6Vols3ohtRQa1IBWdxrNROSZo5L0l9ea1JQ5O0GdrmpelLS5vPc1/t5efyFv/3n/PuOdrRECfCNIU5HOJAkH0Bdvlp8LHWzacickoz5GfI1EjXSNoMTmFWMar8tdHEtMHDOjdrXKx0saKXpd0s6UJr58WIgjPTDNmYU/RXiU4SrhCqELCIT6Jt8dLgZauXzX1s6mO9h1UulvewqIPWEWbrpGwGqsqqL2A+C6+FLvB2Hzv97PAhH9skwstGD6tdLP7N8xEmZ1VBfYHpK+Mp4yrTWyZooTX62Rtgt8iv/rbRCZKUZT08zZG2ldst7gm6J+hy1CkaV1nanoB6p/1BdYsOBjkU5EiIY2HupfkxxreSun86al/QrzEVqgnWFFIS9/EwzRFO65yPctngTorHWdryvC3wscjnIl9KfC2pOJH0osmEmh3mpIOdi3IhRssfrpncTnF/mCc5Wkd5PcqbAu8KfCiqEUpQ1ziaVDujKwkmBS/GaennaoIbA9xKqs4fZhQvj/dKIvIqQhp5X6BDYGn4lFPzrP4fvtTPFYPrJjcHuZtS/INhHklElmc5XjopbaN8L6F1Os/YM4G7gtvCY+GvEqoSkdnaGDXMGoOyW7IqMww5SyY7I1PITaMxf+bm0qZZymbsipVKGImInjQMI6LHw5FEPG7EYkY0Fo/oxXxevPV6fR76B1EvTEObwQzwAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 15 53" title="" data-src="/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-fee1c.png" data-srcset="/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-a67b7.png 200w,\n/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-0b187.png 400w,\n/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-fee1c.png 800w,\n/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-42e87.png 863w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 5-23 所示的锥形渐变渲染的关键要素如图 5-24 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-1093f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 553px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.72694394213381%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACkUlEQVQoz6WSTWgTURDHcxAUPHpRsAcpeBGlQsUiimKL2F60VBQ86FUUBUVPvaqIIIIHixhr1WKLVsS0NmkbGk2zSbqbbLJp2jRJzUebbL42yWbz0TTZzt8kggevzmHe4837zX9m3tPgXyMQNVevh4xzWFqCx0OCAIZBINCK09+rGkMWWhFvE3gj4rWIVyKG1usvAspzPu4NhqVMJisrm/XtQrmaK5SzKqQa0jVUt1vw1WXsY3DAhv0M9jLYY1Z3DQs7dJLGiIkU1VVVELNmX8i/ScsVeIpwK2BlyteaNWhurOIwi2MOHOVwhMNBfaJ9odpmx84f9CWNOmG9BpMvYovnvGXwCjlLsJeRq7eUb/rRwaHLQZ08OhZKh+fzhxxot9FuM02kqajCWyRvhYzh9GKRFmVikxVuNZ6NpRAOa24HmrKneDrpRpeleNxa6nKi04226dRTy6pX3rIqsBYwE1MYdoUNJJl4kQmkpI0kxLjmbhAnnOhxUbeAM9bS2cXyOQEDXHVgyj+o57+GlZmUOitDt17Qr0nzeRhlGArNmTXLvr+G0y70uqlvBd1GsWc2csWHZyMm7fCM9juvm3NPcuHPOXzwpXTZ7WkJBglTGUputQY2GML5htQSLnlx2aP2m2LXl9VbfjwIbj+K0stIfTSLIY845AhN5qBL05SEbxm0YGjuBRsNo1dAn4ALXvTz1Ys/xWtC5U4QjbwPI/R4Of/EndSK9C6B0STGUk0fq7ZgvdT8GyMivU/QaILG0hiPbX0MSOPB7KdQXvcrY4jmrTLZZeIK5FSIb/gCyX+eCv9hTTidkSxWNrIeC0WiuYJiMltc7iXbooN18KzTZbOxnEOws06msXG6God2lgtHNxrgb0PMidryIbZRAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 16 27" title="" data-src="/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-1093f.png" data-srcset="/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-7baba.png 200w,\n/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-2a76e.png 400w,\n/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-1093f.png 553w" data-sizes="(max-width: 553px) 100vw, 553px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>我们可以改变起始角度和中心位置，让图 5-23 所示的锥形渐变效果发生变化，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79834063086125040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`conic-gradient(from 45deg at 25% 25%, white, deepskyblue);`, `79834063086125040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">conic-gradient</span><span class="token punctuation">(</span>from 45deg at 25% 25%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>渐变起始角度改成 45 度，中心点位置移动到了相对元素左上角 25% 的位置，效果如图 5-25 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-4c6f5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 607px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.94398682042834%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+klEQVQoz12SS2sTURiGZ+8f8VeIK8GNaxF0IbhrF4IuBBfqQkVESEWo4AWvoNCFBalQi7bE2quZJJ3JXFJzm9xnMplbkiY58/qdk+miwsPhHIb3+d5zGGnBwpyOeQPXNFxScU7GmQyyARjgTTjuBM6YYwu6go5AulHkgfNZnM3g9DZObeBFA2OGzhFaYzRHqI9gjVATVIlhQmUI6W4JFxVcUXFZxYUcT4ZTlMU3onyS0smj9KCCqxrmDFw3cb+MFQdbHq+thCiE0AbQIxgDmFFCcZBwOID0pIp5E7cOca+EVA0fWvjmIN3HroeMj1yAfMhFKrkiaAI9SozSUws3i6Dyj6p4ZuF9C1+6WO1hw8Vvjyv++JADYQlwMBNFwhVCWqzj9l88rIAq0P5tC0sdfLXxvYd1F7/62CaFzxWZILHM6pBIohe6U8LjKlIWntfxpoXPbT6cLr/Ww08XaVFhx8Oej/1jS1YgvWzwzhReqPHJr5v42ObDl0We+v+gK/T5K5Bi1mJ3ZqEwzUnV4kWLvWrE75rxp3a81GbLHbbSZas2W3Om6z2Wdtmmy7b6bKfP9jy27zF5NnnEMGSYAEdEzKF/K0ay/geO12mMSQyJdmHgK4rq2LZjO1EYaropyzlDNw/yCm1kOavphlrQdN3I5RXdMAsFPYoGFPwHc7SAhbiBX7sAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 18 45" title="" data-src="/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-4c6f5.png" data-srcset="/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-3bd24.png 200w,\n/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-52f0c.png 400w,\n/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-4c6f5.png 607w" data-sizes="(max-width: 607px) 100vw, 607px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>最后说一下角渐变断点，它的数据类型是 <code class="language-text">&lt;angular-color-stop-list&gt;</code>。角渐变断点与线性渐变和径向渐变的区别在于角渐变断点不支持长度值，支持的是角度值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5477512689142605000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`conic-gradient(white, deepskyblue 45deg, white)`, `5477512689142605000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue 45deg<span class="token punctuation">,</span> white<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-26 所示，可以明显看到 1 点钟方向的颜色最深。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-3e989.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 605px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.48760330578512%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACMUlEQVQoz32QSWhTURSG30ZFUSoOVKt1BMV5KIqCLsSN4kpUBBeCw8ZuxI0LCy5cuBHB6kIEJ6pViwMiKGqlthlt+jI1STOHmKYZ2qZNmra2ltzPe1+rSy8/l7M43/n/c7TwGK4RussERpF1bJyfv8hNUpxiSpCa4GmW+jD7dWqsLLOy0sZqG+vsrLejectYinSW0Edwj+AzRiTH6Z/kt6BnlOsJ9ujMakdrY3Y7czuYb6LKzEIzmgQ6hrEWsZfUCKeRQvLpCSYq/Chx3Mc8k4IXmBSw2MJSC9VGCq2rxLchvg/TPjwzRQJykdCYgp/lqDIxp4NFZpaYqbaw3EqNjRU2am1o0vDjIJ8LfCnwtUDrkJrVNoS5SHRc2Uqy1mhdJbe1s8bQWkOabHo/wIe/kvW7Ad708yrPnV6OeNmts83BZgebHGzsnNEGQ5oM/DrP2371t+R5kVNRH2VoTNOQ4FyQox4OutirU9fFzi62O9SsrQ62SLi1QHOOl3me52jK8jjDgz4ae7mZ5Gqci2FO+ZX/ITcHXOxzqsvX6ewyBmmfBnmY4UlW/ff7uNfL7ZQiG+JcjnI+qOBjXg67lf80LBfZISNIWN6mRQUWzTnRlBXKOS3upsStpLiRENfi4kpEXApVLgTF2R5xxl857RcnfeKEX91SEzCt6fev+P+rCCVNCNUfiyWisUS6L1Muj0bCEafb4/J4XR6fLxDs7vY7dXc4Eg8EQh63PxSOxhNJw0f8AdkrQWU/77/GAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 33 25" title="" data-src="/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-3e989.png" data-srcset="/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-4bd12.png 200w,\n/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-7acd9.png 400w,\n/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-3e989.png 605w" data-sizes="(max-width: 605px) 100vw, 605px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>需要注意的是，角渐变断点中设置的角度值是一个相对角度值，最终渲染的角度值是设置的角度值和起始角度累加的值，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39709530734708780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`conic-gradient(from 45deg, white, deepskyblue 45deg, white);`, `39709530734708780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">conic-gradient</span><span class="token punctuation">(</span>from 45deg<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue 45deg<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时 deepskyblue 实际渲染的坐标角度是 90deg（45deg + 45deg），效果如图 5-27 所示，可以明显看到 3 点钟方向的颜色最深。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-87f29.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 602px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.79401993355482%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACVElEQVQozzWSWUjUURTG/xU9hLRZtPlg0EJBFNVD1ItRj/UUFBSEUNBLGRQJlYWRlEUbRGVgi+2kD0JQtEgu48xok5rj/Gd1NkdnRscZTR3H0Zn7696R4ONwDvd+53znu1f7keBTjC9xvsZpSNA0gnEUyxjWcdyThKaITTOWYVownVWlPPqeoHaIt1G0uiFqIryL8iFK7SD1MT4P0xDHNIp1An+KWJpUlnQWz6SivY7wIMRVH2U+tI+DPA/zKsKbXAtZ1g8pIc0jdI8TTJHMKHLnGO+j3OvjkpfTLo7bKXagyelV/VQP8CzMizA1YaWnLseXCv/OMJHhW5zKIGfcHNM5aGX/H3Z3sLcLTWp+GOJxv8KTftXo6QDVYV5GkHYYRjnnUbe3W9jYRqGJNUZWtrLUQKEZTQ6828f9HKQqmd/p43aQGwHO97KpnflNCvMamdvInP/QfrK4Ba1qgMoAt4JK2M0AFX7KfWqxs26O6OzqYF0bq1rJN7DQQF4LCySaVbvlBrRHIa77qQhwza88vOyl1EOJixMODvVQ1MU2i+IXmFhhJL+VJQYWtZDXzGojmlQrTb+Sm1baqzaUZp50cDTnTVEnOyxK/FozBUbFX5bjSwlyeU26Ve4TEmVecdErLnhEiUuccmaL7eJwjzjQLfZ1ij2/xU6L2NouNreLDebserMoNIktv9DkG84IMpCGlPxGqHwGlczGdA5T/+MskkK9ogYE/QGf158YHp5MJmWu23Sn7uz1eHSbTe+x23W73WrzOl0Om8PtcDltdo/LGQ1HJPEfFI4/qBGYHG4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 36 35" title="" data-src="/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-87f29.png" data-srcset="/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-38577.png 200w,\n/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-26124.png 400w,\n/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-87f29.png 602w" data-sizes="(max-width: 602px) 100vw, 602px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由此可见，锥形渐变中颜色断点角度值和百分比值没有什么区别，两者可以互相转换。一个完整的旋转总共 360 度， 45deg 就等同于 12.5%，因此，下面两段 CSS 代码的效果是一模一样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66431709360340170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 下面两段语句效果一样 */\nconic-gradient(white, deepskyblue 45deg, white);\nconic-gradient(white, deepskyblue 12.5%, white);`, `66431709360340170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 下面两段语句效果一样 */</span>\n<span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue 45deg<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue 12.5%<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果作为渐变转换点，角度值和百分比值也可以互相转换。例如，下面的两条语句都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57714322462403730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nconic-gradient(white, 12.5%, deepskyblue);\n/* 合法 */\nconic-gradient(white, 45deg, deepskyblue);`, `57714322462403730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> 12.5%<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 合法 */</span>\n<span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> 45deg<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-28 所示。由于把渐变转换点移动到了 12.5% 的位置（原来是在 50% 位置处），因此渐变的后半部分颜色就比较深。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-58f3c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 627px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.96810207336522%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACPklEQVQoz02SWWgTURSGR5Raq6WIda+1uCGiID4I9kHRgvVBQa0WFyx1waXWKohFQbG4gD67IWpVBJcX8c0HaTIzma1Js9gkTZomJsU0tS3WB1+bfN47Igg/d869M99/7pxzlE8T1AdpjNAQYUeY7WG2hdkaYktQruHffJnk/RivR3lW4MkID/M8yHN/GM8kyuMRFA+VOhUa5RplKjNUpnlReijz8vknzwvczXE9w5U0l4ZoT0m1DPBuDEX4lassMplvUG0wz8dcH1U+ZmrM0fk4LlN1Zbma4XKaiykuuGod4IOAhfEslSUmC4x/vCH5Cl3CLwrcyUmsI0XbIGeTnE5yJsnROG9/uPBsjRqLxabM/1cLhYtPqjPN+RSnkpxMcNxVa4ITCZpjvBGw8K7UqLVYakoJF6FlFsstVjs0hGmK0hzncJwjrkTOYwPsi8oSKt0FqnTqbAnUukydxQqbNQ4beqkPsTPCnn75dVOMgzGZUxiJk5cCfjUqryeSrLRZZctAYGt7We9nU0DCon+7IuzuZ2+U/VEOxDgUk9tuAT8dYbpXVqvaLZgIxM/XmPIKqxzW+dkYYHOfdBFtF1MgxqHxqxyNR3nR41+0JGhLcW5Qru1uJzqGZEtFkTszXPvGjSw3s9zKcTsne35vmK6cHB6lVCpSKoErGbv6PxZvi+IEGbjbUnGK4pR4KD2qls4ODw5lxicmVMPy6oZmOo4/6NEt1Wc4geD3/Gg0nvQHQj2qTzNt0+716IY/GLKdvj/gnxVaLctVngAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 47 07" title="" data-src="/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-58f3c.png" data-srcset="/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-a8bea.png 200w,\n/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-f4947.png 400w,\n/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-58f3c.png 627w" data-sizes="(max-width: 627px) 100vw, 627px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="锥形渐变的应用举例"><a href="#%E9%94%A5%E5%BD%A2%E6%B8%90%E5%8F%98%E7%9A%84%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>锥形渐变的应用举例</h3>\n<p>用锥形渐变可以非常方便地实现饼状图效果，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74997343426967750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.pie {\n   width: 150px;\n   height: 150px;\n   border-radius: 50%;\n   background: conic-gradient(yellowgreen 40%, gold 0deg 75%, deepskyblue 0deg);\n}`, `74997343426967750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.pie</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>yellowgreen 40%<span class="token punctuation">,</span> gold 0deg 75%<span class="token punctuation">,</span> deepskyblue 0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-29 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-fee7b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 547px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.87751371115174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABx0lEQVQoz3WSz0tbQRDHV1MrRehZD1JoEVTqD7BSCh6K51Joe/NUvHvqpYfixYOHQkEwirGt2v+g9tZIEvvS5r3dvMUYzTMxETQ5iIrRxh/V/THu2wdWn2YYlu8y85md2V0E103q9ZDJsSK8XBYz2VG79LF8uqlD0peMrm6EjhZOoBNLFIbAgnhvvp7CzV9oX2E/rHlxO+yV5VI+pxyF2d2YqI+dD5OBOdoVJB3Tdm/5dMPH/4e5puf3AC1AICpRBGoi4gMemLXbQ/TpOG4xNkddWPJbYZee3Nptijpt8WyLkWs1nBHy5qv9OGT3BnHr97W3vsmvzKxL/tv9VEmjo8z9SqbhLHMvtdwYtJ98pj1B3DafHazatgfDcQxWETi14CDPfy49nKDPxvEjqzRWtW2vgOpJFl/JNJLOHeHUwVrgxKn/Rh7MLPUfn21Xb/vyyvk+FF+456/UyJVaJUq57mIlffOpfbDHC5DnUPkBO+9gewjKIRB7OsD9n4QxLrRJbVpyZcKt4boiGJeMMZXBdEQhKlMplLCsXL6Qz28cHP5dXy9EY/FoZNGyqUWSJsFJO5lImBYhSZpSetEwMaG/4n9S6VXjt3kBUOFpYksp+sAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 50 20" title="" data-src="/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-fee7b.png" data-srcset="/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-9b56f.png 200w,\n/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-18701.png 400w,\n/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-fee7b.png 547w" data-sizes="(max-width: 547px) 100vw, 547px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/b0kpx2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>其中，可能有人会以为代码部分的 <code class="language-text">gold 0deg 75%</code> 是什么新语法，其实不是的，这个语法在线性渐变那里介绍过（渐变断点第八个细节点），就是颜色值后面紧跟着的两个值表示颜色范围，另外这里 0deg 换成 0% 也是一样的效果，并非必须使用角度值。</p>\n<p>注意，重点来了！理论上，这里设置的数值应该是 40%，或者 144deg，而不是 0deg，那为何这里设置 0deg 效果也是正常的呢？至于原因，同样在线性渐变那里介绍过（渐变断点第七个细节点），后面的渐变断点位置值比前面的渐变断点位置值小的时候，后面的渐变断点的位置值会按照前面较大的渐变断点位置值渲染。于是 <code class="language-text">gold 0deg 75%</code> 这里的 0deg 就会使用 <code class="language-text">yellowgreen 40%</code> 中的 40% 位置值进行渲染，同理，<code class="language-text">deepskyblue 0deg</code> 实际是按照 <code class="language-text">deepskyblue 75%</code> 渲染的。也就是说，如果我们想要 A、B 两种渐变颜色界限分明，只要设置 B 颜色的起始位置值为 0% 就可以了，无须动脑子去计算，这算是一个 CSS 实用小技巧。</p>\n<p>图 5-30 所示是使用锥形渐变实现的基于色相和饱和度的取色盘，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29784171275578266000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.hs-wheel {\n   width: 150px;\n   height: 150px;\n   border-radius: 50%;\n   background: radial-gradient(closest-side, gray, transparent), conic-gradient(red, magenta, blue, aqua, lime, yellow, red);\n}`, `29784171275578266000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.hs-wheel</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>closest-side<span class="token punctuation">,</span> gray<span class="token punctuation">,</span> transparent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>red<span class="token punctuation">,</span> magenta<span class="token punctuation">,</span> blue<span class="token punctuation">,</span> aqua<span class="token punctuation">,</span> lime<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> red<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-94f8a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 546px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.172161172161175%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB2UlEQVQoz2P4jwb+/QOR39782dr3I9Xvh1fU75ol/+++RUghAQZUnX+B8n+/XfmyWv9ZMts9E+G7YjpPOCM/Ss/6s+UNSMHff7g0//sPkvry7bnpw82857rMDkfZHLYNOm3ReFdi1WfRu//uglX9xab53/8/QPLN3+UnX7GcPGu8a6nrypKQ5eE52z1nH7c8dpLj6aPK3yBlf3BrPvK7tPcR37Tj1tPWBff3ZPbmtU6NWDHd4XCf6J0Nnt/BPsOm+S9Y84rf5WGPeRKOW8WtDcycWZ5TNzUhYmW83aEIkbtdXj9AyvBo3v9vo/xrFtOLZk67Y4PW9oVMW+2att3S/qwM69MZLSBn/8HhbFBw/fn/y+V7KMsjK8ML1TYnVtpuOmbSek7A856i1ZfnT//jtBmu/9n/N24/ethf9XE9Ocx95hH7jBd6LV9P3/yHEVNgzf+QYv8vSMHfn///rPv7qPT3y8J3v+Y/+PseFFL///xFT1AMv3//+fsPAf7+/fvnLwiAHPEP7BqgcSAxkBRQHqjmz58/EJUMBw8devj46c2btz9/+XLz1u39+48eOHD05Jmzp86ePX7u3OkLl46dOnP81Okjx0+ePX8RyDhz7sLBI8cuXb4CFAAAneRYrMeAI+MAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 58 01" title="" data-src="/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-94f8a.png" data-srcset="/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-e2b97.png 200w,\n/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-db056.png 400w,\n/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-94f8a.png 546w" data-sizes="(max-width: 546px) 100vw, 546px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/o3i6ck?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>之前演示过使用 CSS 多背景实现灰白网格效果（棋盘效果），如果使用锥形渐变来实现，只需要一行 CSS 代码就足够了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36674372181232927000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.checkerboard {\n   width: 200px;\n   height: 160px;\n   background: conic-gradient(#eee 25%, white 0deg 50%, #eee 0deg 75%, white 0deg) 0 / 20px 20px;\n}`, `36674372181232927000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.checkerboard</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 160px<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>#eee 25%<span class="token punctuation">,</span> white 0deg 50%<span class="token punctuation">,</span> #eee 0deg 75%<span class="token punctuation">,</span> white 0deg<span class="token punctuation">)</span> 0 / 20px 20px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-31 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-f5f2a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 683px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.19472913616398%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAn0lEQVQoz8WRzQoCIQCEff9nqkOHsl01Xdq6WgQtVIfdg2n+bcJiPxoRdeg7iCMzDDigf8YYo5S6ZIRHrXViBokODiHE+RVSSu/9u3BoHnw5ofzT8P+avwn/9GHO2vtU2WbpVM45H7HWRtnHi7sxiIfTg6LEm+2ubTvOOSwwIQwhijGdzlC9WuNqCecIQsRYvW+a0XhSogXB7HA8EVpdAbgaQ+MtNlH1AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 13 42 29" title="" data-src="/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-f5f2a.png" data-srcset="/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-d96b4.png 200w,\n/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-b52f8.png 400w,\n/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-f5f2a.png 683w" data-sizes="(max-width: 683px) 100vw, 683px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/72su1v?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>最后一个例子，演示如何借助锥形渐变实现很实用的加载效果，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85038232636210450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.loading {\n   width: 100px;\n   height: 100px;\n   border-radius: 50%;\n   background: conic-gradient(deepskyblue, 30%, white);\n   --mask: radial-gradient(closest-side, transparent 75%, black 76%);\n   -webkit-mask-image: var(--mask);\n   mask-image: var(--mask);\n   animation: spin 1s linear infinite reverse;\n}\n\n@keyframes spin {\n   from {\n      transform: rotate(0deg);\n   }\n\n   to {\n      transform: rotate(360deg);\n   }\n}`, `85038232636210450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>deepskyblue<span class="token punctuation">,</span> 30%<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--mask</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>closest-side<span class="token punctuation">,</span> transparent 75%<span class="token punctuation">,</span> black 76%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">-webkit-mask-image</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--mask<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">mask-image</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--mask<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s linear infinite reverse<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-32 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-bb96f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 512px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.0234375%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABEUlEQVQoz42Qy07DMBBF88Xs+QSW/AUrFkioArWhL2hpUrWqAEF4lAJqRYkaV7GTOLFnsJ2oAYkonMXozniur2wLfwOm3lI8+sTjNU5ClIBVWD+bfO98gwcL7X+Nte4E/zDnAX6K+y8YZOWkR/AtKdu/zXmsvcE9T4sMUJq5yr9jtWZTZxQP34u78u3nSPtrzDsEYCKLVZLhDUUuq9+s9gCKe5UQAFSAn8KSwzxGJspYMBhRkbz7P4k1WFEUMxZxniqIZqsICKFhuDVNwrkQIk4SKSVjLAjULFQHymHde08P3uP6y18tVyenZ8PrUe9y0O5fDYZus2W3ul1nPBm5U1dVx73o9BsN2xlPm3Z7vvj4BjzmP2nrDPG7AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 23 09 54 56" title="" data-src="/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-bb96f.png" data-srcset="/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-7728b.png 200w,\n/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-23f96.png 400w,\n/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-bb96f.png 512w" data-sizes="(max-width: 512px) 100vw, 512px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>原理很简单，图 5-32 所示的其实就是一个锥形渐变，使用 CSS 遮罩属性只让外圈 25% 的范围显示，于是 loading 的圆环效果就出现了。如果想要小尺寸的 loading 效果，直接修改上述 CSS 代码中的 width 属性值和 height 属性值即可。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/scjz23?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>本例 CSS 代码中出现了 CSS 自定义属性（指 —mask）、CSS 遮罩属性 mask-image 和 CSS 动画属性 animation，它们都是非常实用的 CSS 属性，均会在本书的后面着重介绍，敬请期待。</p>\n<h2 id="重复渐变"><a href="#%E9%87%8D%E5%A4%8D%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重复渐变</h2>\n<p>线性渐变、径向渐变和锥形渐变都有对应的重复渐变函数，就是在各自的函数名前面添加 repeating- 前缀，示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51905871081800760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`repeating-linear-gradient(transparent, deepskyblue 40px);\nrepeating-radial-gradient(transparent, deepskyblue 40px);\nrepeating-conic-gradient(transparent, deepskyblue 40deg);`, `51905871081800760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>transparent<span class="token punctuation">,</span> deepskyblue 40px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">repeating-radial-gradient</span><span class="token punctuation">(</span>transparent<span class="token punctuation">,</span> deepskyblue 40px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">repeating-conic-gradient</span><span class="token punctuation">(</span>transparent<span class="token punctuation">,</span> deepskyblue 40deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>假设上面的语句是作为 background-image 应用在尺寸为 200px×100px 的元素上的，则最终的效果如图 5-33 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-0204f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 28.222996515679437%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABSUlEQVQY01WQSU8CQRCF+b8aDwSBiBGJUePNg3GJ8ejBuJw8Q1ATOMgiCDrADAjDbmQbMCj0Zw3DxUpeXnW9el3V7bpuw20HboTvhC9boE8g/AV7FTg24VRwIjioOH2DX7gS3pfzWR0Oq3AuHNDBtV5U+JfYKClWNcVjTxHtgVtqIUM0qW/pDtsLpIaKFQ12DMezLZpXeo9qcuGmTAlKEpQpIYGnCPG+4r6rWCuAT3RvWSDsLsFFXWHIC3bLCo/UA+Lxi+aT3F7GpVW7FHJltKJJwWiStxS9H4U5hWh7Sva1zLveJPf2wYM5QvsG1JzsGCL5BpmMQTxvolc7RPqyIRML+vJhoyFYgn8xh/GIRY/NzP7L1sDx2jy2FiXX3LEtYMfIGpNIpWl3utQaLcJPMRLZHPFkmthzSrQXkqkMrc7non+2hO2fKcUfAOKxBG1dREkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 23 13 37 26" title="" data-src="/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-fee1c.png" data-srcset="/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-a67b7.png 200w,\n/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-0b187.png 400w,\n/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-fee1c.png 800w,\n/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-0204f.png 861w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>无论是重复线性渐变、重复径向渐变还是重复锥形渐变，其语法和对应的非重复渐变语法是一模一样的，区别在渲染表现上，非重复渐变的起止颜色位置如果是 0% 和 100%，则可以省略，但是对于重复渐变，起止颜色位置需要明确定义。</p>\n<p>重复渐变就这么点内容，很多人会觉得重复渐变复杂难懂，这只是因为对基本的渐变特性了解还不够深入而已。</p>\n<p>重复渐变非常适合实现条纹效果。例如，使用 border-image 属性和重复线性渐变实现条纹边框效果，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5496115762584731000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.stripe-border {\n   width: 150px;\n   height: 200px;\n   border: 20px solid;\n   /* IE 旧语法 */\n   border-image: repeating-linear-gradient(135deg, deepskyblue, deepskyblue 6px, white 7px, white 12px) 20;\n   /* 新语法 */\n   border-image: repeating-linear-gradient(135deg, deepskyblue 0 6px, white 7px 12px) 20;\n}`, `5496115762584731000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.stripe-border</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> 20px solid<span class="token punctuation">;</span>\n   <span class="token comment">/* IE 旧语法 */</span>\n   <span class="token property">border-image</span><span class="token punctuation">:</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>135deg<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">,</span> deepskyblue 6px<span class="token punctuation">,</span> white 7px<span class="token punctuation">,</span> white 12px<span class="token punctuation">)</span> 20<span class="token punctuation">;</span>\n   <span class="token comment">/* 新语法 */</span>\n   <span class="token property">border-image</span><span class="token punctuation">:</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>135deg<span class="token punctuation">,</span> deepskyblue 0 6px<span class="token punctuation">,</span> white 7px 12px<span class="token punctuation">)</span> 20<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-34 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-23-13-40-53-7e002c52bce34fab59b4072d7aa3235e-d7cef.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 329px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 133.1306990881459%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsSAAALEgHS3X78AAACwUlEQVRIx61VWW8SURSe/+lW17o91j3GBxM17tr44hKNS3yxVksQyhIpIAMF0VrZaoEWKKWlWAqtbS3cz3O4MzA1JsLoTU7OmXvvfPN995w5VwGNSA24Pwc8L3X84yLwiOxFSfon8zJ+QOvPKH5K9pDmX5bkGs8tbAIKA75aBHbEgH0J4FgKOJAEjqSkcXyU/GGyQxQfnwL6k/KZ44Pa3lPTQL2hAb5bAnbFAXsFKNFXZtaB6R9Abl3GaYoLG0CWfJae8xtyndd4/l4BGPgGVLcMDJldYg2mxuUZ4FwaWNYBrcRwJzH8uio3bAmg2aXxuJkDTholj5SBPmIYrckNDfF3VsKw51YeOEGA339qgEMkeW+iw7DZJaAOemVWSm6foZ6USZOAd4jhADGs6YDDZZkUs5Jv5GTZtCW/0c4wbpLhVU1ym6GNJO8myV/q5gDvapJXdMDXi/KP+NwjoD6uaQyXdckWkryHGCZMSr5OZ3iWAFcbhsLmM/xkkuFgXhZ2u2yGNMlmz5CTcj5j+PW4Dlmy2SzfJoZn0oZfz/KPdchZPp021OEwSd5PgDEDQ9Gl6Vm+kDGUja0iJU/20G0aoqNkUGPYlvy2LDuvDtjrYMnb+uGIdoaBqpSdpEY7Ue/EXPDsOWk8n1qTnYmrgrv6JWqwF7PE8Pduw3cH1yODcxn1aZ7Zc3vr12I+b75TOOZ7hu8hQx0KfKgKki2oSQiMVgRlXbRYOyrsBX1QzvMee0UazzvJ25bke6EVgU06XKXZStX/McZSttWWwf+puLsoTyhWqwVWuxNTmVkUi0WMh6MolhZai6MuN0Lhj2RRRCITCASCsLtc8PpVjHkDcL8fg83hRiwWhxoMw2K1Q3G7HPD4VGRzBZTLZQRDEczNl1qA/AID8lwoFIXX54dfVaGOR+AjULfH29oTiycQUiNwujz4BbYw7woJkVSaAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 23 13 40 53" title="" data-src="/static/2022-02-23-13-40-53-7e002c52bce34fab59b4072d7aa3235e-d7cef.png" data-srcset="/static/2022-02-23-13-40-53-7e002c52bce34fab59b4072d7aa3235e-00827.png 200w,\n/static/2022-02-23-13-40-53-7e002c52bce34fab59b4072d7aa3235e-d7cef.png 329w" data-sizes="(max-width: 329px) 100vw, 329px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/3jntrm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="css-3d-变换"><a href="#css-3d-%E5%8F%98%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 3D 变换</h1>\n<p>在所有 3D 成像技术中，最容易学习且最容易上手的技术一定是 CSS 3D 变换技术，即使你不懂 JavaScript 也能实现 3D 效果。因此，不少优秀的设计师能使用 CSS 3D 变换实现很多酷酷的 3D 效果。</p>\n<h2 id="从常用的-3d-变换函数说起"><a href="#%E4%BB%8E%E5%B8%B8%E7%94%A8%E7%9A%84-3d-%E5%8F%98%E6%8D%A2%E5%87%BD%E6%95%B0%E8%AF%B4%E8%B5%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从常用的 3D 变换函数说起</h2>\n<p>CSS 位移变换函数包括 translateX()、translateY() 和 translateZ()，其中 translateX() 和 translateY() 属于 2D 变换，translateZ() 属于 3D 变换。此外，CSS 缩放变换函数包括 scaleX()、scaleY() 和 scaleZ()，其中 scaleX() 和 scaleY() 属于 2D 变换，scaleZ() 属于 3D 变换。</p>\n<p>于是，就有不少人想当然地认为 CSS 斜切变换函数也包括 skewX()、skewY() 和 skewZ()，其中 skewZ() 属于 3D 函数。这种想法是不正确的，事实上，CSS 斜切变换没有 3D 函数，也就是说 skewZ() 函数是不存在的，自然也不存在 skew3d() 函数，因此下面的写法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93827004724850820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\ntransform: skewZ(45deg);\ntransform: skew3d(0deg, 0deg, 45deg);`, `93827004724850820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skewZ</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew3d</span><span class="token punctuation">(</span>0deg<span class="token punctuation">,</span> 0deg<span class="token punctuation">,</span> 45deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>也有不少人想当然地认为 CSS 旋转变换函数包括 rotateX()、rotateY() 和 rotateZ()，其中 rotateX() 和 rotateY() 属于 2D 变换，rotateZ() 则属于 3D 变换。这种想法也是不正确的，这回倒不是不存在上面 3 种函数，而是 rotateX()、rotateY() 和 rotateZ() 均属于 3D 变换。</p>\n<p>加上各种变换的 3D 合法语法，可以得到下面这些属于 3D 变换的 CSS 函数（这些函数不区分大小写）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52318079781659030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`translateZ(0);\ntranslate3d(0, 0, 0);\nrotateX(0deg)\nrotateY(0deg)\nrotateZ(0deg);\nrotate3d(1, 1, 1, 45deg);\nscaleZ(1);\nscale3d(1, 1, 1);\nmatrix3d(\n   1, 0, 0, 0,\n   0, 1, 0, 0,\n   0, 0, 1, 0,\n   0, 0, 0, 1\n);`, `52318079781659030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">translateZ</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">rotateX</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span>\n<span class="token function">rotateY</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span>\n<span class="token function">rotateZ</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">rotate3d</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">scaleZ</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">scale3d</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">matrix3d</span><span class="token punctuation">(</span>\n   1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span>\n   0<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span>\n   0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span>\n   0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，matrix3d() 函数表示使用 3D 矩阵表示 3D 变换效果，共需要 16 个参数，由于过于复杂且使用概率较小，因此本书不做介绍。rotate3d() 函数的语法比较特别，这里专门讲一下。</p>\n<p>在展开介绍 rotate3d() 函数之前，我们有必要先了解一下 CSS 中的 3D 坐标。CSS 中的 3D 坐标如图 5-35 所示，横向为 x 轴，垂直为 y 轴，纵向为 z 轴，箭头所指的方向为偏移正值对应的方向。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-31-51-784e8a2f1deaffbff364497c123c6276-79f9e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 372px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 86.02150537634408%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsSAAALEgHS3X78AAABHklEQVQ4y6WSbUvDMBDH8/2/huBgojDEKXOzmwiKMK34RrY3a+fsmrTpUzJr21y9dejck7TbnyNcwv24P3ch+aosm37GcV5OZJkC4JGNTJCyOlxI2RTSdF/Y8xcW9oI5z5U6AM6yefNtsdA/sHeAbceBMAIh10IFIVAWF9oJZ5RugeUM4dymfhDIP4tcgSH+Ui4vsuq28XuAEIV7VXFgAOlgOB91aS3hWMrZ1M6riPw6EUJExTDWvMHG5n7sA9lVUaqzYYzN8XuSJC7n3PPwKQqjD2uKW4mEoJQxx7Upw/CDECscl1Pm4HUysUitfnpx2cLq/pOuv7wi/DYYdrRe/1kfGWbz6rp9022cN0/OGq22hqH17u4fHjvd26Pj+jegeuD0Y343bAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 31 51" title="" data-src="/static/2022-02-25-14-31-51-784e8a2f1deaffbff364497c123c6276-79f9e.png" data-srcset="/static/2022-02-25-14-31-51-784e8a2f1deaffbff364497c123c6276-bedfe.png 200w,\n/static/2022-02-25-14-31-51-784e8a2f1deaffbff364497c123c6276-79f9e.png 372w" data-sizes="(max-width: 372px) 100vw, 372px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>下面正式开始介绍 rotate3d() 函数，rotate3d() 函数的语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1927775873755877000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`rotate3d(x, y, z, angle);`, `1927775873755877000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">rotate3d</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> angle<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，参数 x、y、z 分别表示旋转向量的 x 轴、y 轴、z 轴的坐标。参数 angle 表示围绕该旋转向量旋转的角度值，如果为正，则顺时针方向旋转；如果为负，则逆时针方向旋转。有不少人看到“向量”就想起了大学时候被数学支配的恐惧，不过这里 3D 旋转的向量很简单，就是一条以坐标原点为起点，以坐标 (x, y, z) 为终点的直线，所谓 3D 旋转就是元素绕着这条直线旋转而已，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92518491763651800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: rotate3d(1, 1, 1, 45deg);`, `92518491763651800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate3d</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 45deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示元素绕着坐标 (0, 0, 0) 和坐标 (1, 1, 1) 连成的向量线旋转 45 度，图 5-36 中蓝色箭头所示即向量。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-58f3c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 627px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.355661881977674%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAAxklEQVQoz52R6wqCQBSEe/83K+2imWVBUdlFRNPdZN3bbFtCRAVa36/D2Z0zMNMzHwCgWWY60DPf1KYo/hfrsjRCGsHvh5pzHcWQEnkupUqPGZT+0VnK+pSUaZHvE8MYOFeE1Ix1c+Zc5xfUzJQFhIQQYExw3k1MCKoKGlCqJTCbBR40JVmYjVrrZ21vvC6/OCvo5kd7VQNnuNvH682WUNp3huOJH86jOD5Qej2fk3ARLaKV5wcDd2QHP7CPS3c0mQahN53dAAGNSchFxx9LAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 39 50" title="" data-src="/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-58f3c.png" data-srcset="/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-a8bea.png 200w,\n/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-f4947.png 400w,\n/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-58f3c.png 627w" data-sizes="(max-width: 627px) 100vw, 627px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果此时有一个正面印有数字 1、上下分别印有数字 5 和 6、左右分别印有数字 4 和 3 的立方体应用 rotate3d(1, 1, 1, 45deg)，那么它的 3D 旋转效果如图 5-37 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-cd472.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 557px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.707360861759426%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABsElEQVQoz2P4jwH+/fsLJLdu3X/48FogDyzy7z82wIChE0RMn3ElMSm/rs5j3rz6p09v49KPovnvX5CKidMv2dvMqa+LbWtLrKoKaWgI3bN3yY9fXzGNYEDTefvRe/3gHR7xXS2tIY31MbNm1bR2RBcXuqya24tP8x+w5gnLrkp6rnWtTI9uCqjrSl28qKmxKKw6xP/4ps1gC/5i0Qwx8duvP7YpO6Jtl/WndofUh0X3x3WW5dT7B3XGJ3x4/QqnzRA3X7v+ptZy8RabNfu9D8wKnpWTk1aVHFoVHrSmrw+kE9VaFGeDdP/993Tfg02RW/ak796ZuueA3uqtel3N7uG3z5/DdDNGVIEd9ePjjzNTz6x2XXVGesUTu/1P5l748+83UfEM0g824t2FV1/PvfmPI3lANf/58+f3799AJ/398+fnz18/geDHz2+fv/359/fXvz8/vv348eX7t+/ff/3+/eMnRBKo6heY/Yvh9t17t+/c/fTp881bd44eO3ng0JENm7aeOXthz96Du/bsP3Do8J59B9dv3LJz914gd8fuves3bt23/9DuvQeOHD8JAE8MZ0Rf7y6gAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 42 28" title="" data-src="/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-cd472.png" data-srcset="/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-8e829.png 200w,\n/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-2b773.png 400w,\n/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-cd472.png 557w" data-sizes="(max-width: 557px) 100vw, 557px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>按照我多年实践的经验，rotate3d() 函数很少会被用到，因为大多数的 3D 效果都是很简单的旋转效果，开发者往往使用更简单的 rotateX()、rotateY() 和 rotateZ() 函数。其中 rotateY() 函数是所有 3D 变换函数中最高频使用的函数之一，因此，本书就以 3D 旋转为切入点，带领大家快速进入 3D 变换的世界。</p>\n<p>3D 旋转变换有下面 3 个函数：</p>\n<ul>\n<li>rotateX(angle)；</li>\n<li>rotateY(angle)；</li>\n<li>rotateZ(angle)。</li>\n</ul>\n<p>它们分别表示绕着三维坐标的 x 轴、y 轴和 z 轴旋转。其中，rotateX() 函数的表现反映在现实世界中，就如体操运动员的单杠旋转；rotateY() 函数的表现反映在现实世界中，就如旋转木马围绕中心柱旋转；rotateZ() 函数的表现反映在现实世界中，就如正面观察摩天轮的旋转。</p>\n<p>使用简单的图形演示以上 3 个旋转函数，就有图 5-38 所示的效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-e2f03.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 42.19653179190751%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABgElEQVQY012QyU7DMBCG81xwoCyVoGURLQha4AgH6A0IAsqNwhMgUDkhUZYLbwHcWFr12BOljd3EcWITOw0OjNkEWCNZ+jz//J7fiN/+nDjWQHEetduxUpp8P2hOqV8+fu10NFHKCKWMoNX3obqMv0YR8KBet+YX7O0iPTySMOVDHjJmF3daQ0myW+pSCtBg19dkpUDMDbK65pgbkWVBn6jVUHoUT03j4RFZq2kbz3OKO2gkhWdm8fiEW9qLHMdwTysolcb5uU4ub2Wy4u5ei6tVNDqGZ3N4MiPqdSB+ufw8MIhzeZzJgt5Kpd29fQOtmyjRr0em0q2eXnZ5+SUG58kMGkqKT2fHsU0T2sADzOzlQrfZNOjVFatU/LMzdn7hnZwEN7d654fHNnxnccnZ3JJPTfURW0iIvbb+3JfogBIhvXP8k+fvVBmLGo23MPzPCeEHB6rV0gDShksKSV0qg0AKQSl9eQm6SnEoITzPZ5wzxqnn2bbt+owI6XIOEhC+A8SwiJXXBaTIAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 44 10" title="" data-src="/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-fee1c.png" data-srcset="/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-a67b7.png 200w,\n/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-0b187.png 400w,\n/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-fee1c.png 800w,\n/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-e2f03.png 865w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="必不可少的-perspective-属性"><a href="#%E5%BF%85%E4%B8%8D%E5%8F%AF%E5%B0%91%E7%9A%84-perspective-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>必不可少的 perspective 属性</h2>\n<p>perspective 的中文意思是透视、视角。perspective 属性的存在与否决定了你所看到的画面是二维的还是三维的，这不难理解，即没有透视，不成 3D。学美术或者学建筑的读者肯定接触过透视的一些东西。例如，图 5-39 所示的透视效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-2ab3c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 676px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.585798816568044%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABTUlEQVQoz32SS2+CQBSF+f8/pt24ctXEVqNp97aaVEERcHjNIAzvfmEC1qTpWQyXc8+ZOXfASpIkCIIwDOM4tm37fD73fS+l9H0/HkA3TVNIGMdxkhG0LB51XfcDiqLArEudqYzakGVZKqXqpnFdN89zQzZNE0XRg/l2u6GDhdRaG7KqKpOOFoIHM5HIQ6PUmiS8UhOPnh6A0724rMxiSLYQQsBYbdtiPp1OnuexPdlwEm+323ERURhut1slFeOgEQPQoySR1Y8oh3jX65VeXhSsmKVS3CKnocZGNDyTxeq6jsO7AdM8WZaJKDrYzvd+fwl8JSX3Mgkmi4VODZAjqCHTJHHm8+NsxpxG81tgcI99hzmBr/L81L8ueiHu5CP+MDfjFG1VNVq3dQ0D/jObkfg3lqv14Wi7F+/za/+yWC7eVpv3j/XmI03lJDP4AT+ycxi/gg87AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 46 31" title="" data-src="/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-2ab3c.png" data-srcset="/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-8739e.png 200w,\n/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-cfbeb.png 400w,\n/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-2ab3c.png 676w" data-sizes="(max-width: 676px) 100vw, 676px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>不过，CSS 3D 变换的透视点与图 5-39 所示的有所不同，CSS 3D 变换的透视点在显示器的前方。例如，显示器宽度是 1680px，浏览器中有一个 <code class="language-text">&lt;img&gt;</code> 元素设置了下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67487791473572730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   perspective: 2000px;\n}`, `67487791473572730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">perspective</span><span class="token punctuation">:</span> 2000px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这就意味着这张图片的 3D 视觉效果和本人在距离 1.2 个显示器宽度远的地方（1680×1.2≈2000）所看到的真实效果是一致的，如图 5-40 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-ca80e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 595px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.18487394957983%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABR0lEQVQoz51Sy26CQBTlS/kBv4IFWxJNDLFpeKw0bFzbQMKOlRsWAiURGQpYpi54xQiCvTKW0qZpY89iMnPunHsuZ6AuA7Rte/kVTdPAulo9bbdb2FCXe3A+n2GdzR6Wy+VVDG5NB9jkeU7K/SA9hmJRFDmO+3QmZYzx6XT601mUpMlkchWnaWoYhqqqnuclSVJVVd/OcZz1em2a5uFwIAwRy7I8nU6vYkVRxuMxwzCLxULX9TiO3zrAFJCK67qbzQYhBHpgoHtRFDzP38TgrGnafD6Hq1DOsqyu66oDCYJMS5jj8QjHxw7//GZJkliWvaVddwAfGGmY9jcQg7IsIerRaBSGIfXlYT5utD+B9IWMQEzTtCAId/wkpG8UhfAKlmVBilTP7vzAR0EU72GwJMG285xgDIxlOyh48XbIdlxv58f7117yDqAymrQSr8mdAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 48 02" title="" data-src="/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-ca80e.png" data-srcset="/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-54e17.png 200w,\n/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-1e5c4.png 400w,\n/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-ca80e.png 595w" data-sizes="(max-width: 595px) 100vw, 595px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="用-translatez-函数寻找透视位置"><a href="#%E7%94%A8-translatez-%E5%87%BD%E6%95%B0%E5%AF%BB%E6%89%BE%E9%80%8F%E8%A7%86%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用 translateZ() 函数寻找透视位置</h2>\n<p>如果说 rotateX()、rotateY() 和 rotateZ() 可以帮你理解三维坐标，那么 translateZ() 则可以帮你理解透视位置。我们都知道“近大远小”的道理，translateZ() 函数的功能就是控制元素在视觉上的远近距离。例如，如果我们设置容器元素的 perspective 属性值为 201px：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70104358510426420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   perspective: 201px;\n}`, `70104358510426420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">perspective</span><span class="token punctuation">:</span> 201px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>那么就会有以下几种情况。</p>\n<ul>\n<li>子元素设置的 translateZ() 函数值越小，则子元素的视觉大小越小，因为子元素在视觉上远去，我们眼睛看到的子元素的视觉尺寸就会变小。</li>\n<li>子元素设置的 translateZ() 函数值越大，该元素的视觉大小也会越大，因为元素在视觉上越近，看上去也就越大。</li>\n<li>当子元素设置的 translateZ() 函数值非常接近 201 像素，但是不超过 201 像素的时候（如 200 像素），该元素就会撑满整个屏幕（如果父元素没有类似 overflow: hidden 的限制的话）。因为这个时候，子元素正好移到了你的眼睛前面，看起来非常大，所谓“一叶障目，不见泰山”，就是这么回事。</li>\n<li>当子元素设置的 translateZ() 函数值再变大，即超过 201 像素的时候，就看不见该元素了——这很好理解，我们是看不见眼睛后面的东西的！</li>\n</ul>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/y25bfm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>拖动滑杆控制子元素的 translateZ() 函数值，大家会发现当值为 −100 的时候视觉尺寸最小；随着值慢慢变大（例如值为 40 的时候），子元素的视觉尺寸明显变大；等到值继续增加到 200 的时候，会发现子元素充满了整个屏幕；而值是 250 的时候，由于子元素已经在透视点之外，因此是看不见子元素的，子元素如消失一般。整个视觉变化过程如图 5-41 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-40f0e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 31.25734430082256%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAABTklEQVQY0xVPS0vDQBjML9P/YO3Bil7UXKx4UQT1TwiKVw8KHnposUIr6kFa8CQo9lChj7wfm5im2c1md7P7GS8DM8yD0XqvwyBOmJSkYAXnhMnBtzEy3RIgzzDrPuLb+/jm7u3kXHbaWbyYRIWblr3h13hqaJUrYNIjwiuUQ6XBwDX8aPDuu8hOC3JwmK3VcWOLb27ne7plhRMKs2VpM+ULpXkKiOUUV9dYlH4hQwDeasnVFdp/CiTQ07NS10WzyXSdHh2j4DcDwFJhCUkJmskhzij6mUZc2VQ6AMnH5+LiMh6NbSzwfjOv1fKNBlmvk51d10GBAsQkEhBw0BYClgowQCqrSiDqn/7XV5+FUM8vst2RD90KVa+PSV7pRKm0hKxaBoCCUsswcZYRgiMUoiAMPG8+m5mGZUXRHMUGiq04mXp+GCLTNF3H4ZxXwT/LhziANQ9NVQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 03 10" title="" data-src="/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-fee1c.png" data-srcset="/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-a67b7.png 200w,\n/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-0b187.png 400w,\n/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-fee1c.png 800w,\n/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-40f0e.png 851w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>此时，我们再换一个视角，从侧面观察 translateZ() 函数的作用原理，如图 5-42 所示，可以更清楚地明白为什么 translateZ() 函数值会影响元素的视觉尺寸。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-0f06a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 643px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 84.44790046656298%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB4UlEQVQ4y31S227aQBD1n/elD/mPPvWxD01VoabFSaAkKCqxDRsMLlGJr8RgfAHfdnPwBBe7Skcra3Z9zlzOjCTeNs45voZlPRjGA2OGYeR5fgqQCGHb9mKxME0zTVOilWWZFwX8D7athaEoiizPCdwmO44zm808zwMfL2EYIklZId6Pxze+D6dsMv+Sd7udpmlZltF1u93CJ/I7Rfn5+ChWq3K1EqYpLEs8P7+S6zDgF0XBK4uiqM58puu3hgFOCWYcC/SVZW0yCOiT/LSyDD1z/tE0p0lyEOIfRaVa1c1ms9/vi0qk9XoNFZIkicJwwhh+HWAIDSSdFhkiQbAgCDCS+Xyuqqqu63Ec46U1oUbmlmWVgYZCDoPwvJh0cl2xXIqnJxT2Jrm1JK7r7kDACB2nJMGOhUg1Dh1CMH5i1P+tqlrVbBApjGN6bMwZRSqKgmnlRwOINuzTaKR7HqHRf3acU6NsdNjaPrqOGHOrDaMcjcw1yPd9TAjFAwHlo8r2acomE8s0SULLstrkOjOYtB7w8cEB9M9yibiQA+8Id1qdxDkX/zUC8OaVXKnzrTudzua/F8E2uPt1r03YzfBOHbPvcvfzl86P7rV81etcdHuDoSz3e/2BfHl9/vUCTn8wfAHZ99CL5LAROwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 04 15" title="" data-src="/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-0f06a.png" data-srcset="/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-66246.png 200w,\n/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-2dbe7.png 400w,\n/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-0f06a.png 643w" data-sizes="(max-width: 643px) 100vw, 643px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="指定-perspective-透视点的两种写法"><a href="#%E6%8C%87%E5%AE%9A-perspective-%E9%80%8F%E8%A7%86%E7%82%B9%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%86%99%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>指定 perspective 透视点的两种写法</h2>\n<p>有两种书写形式可以指定元素的透视点，一种设置在舞台元素上，也就是设置在 3D 渲染元素的共同父元素上；第二种是设置在当前 3D 渲染元素上，与 transform 其他变换属性值写在一起，代码示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17665339887879571000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.stage {\n   perspective: 600px;\n}\n\n.box {\n   transform: rotateY(45deg);\n}`, `17665339887879571000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.stage</span> <span class="token punctuation">{</span>\n   <span class="token property">perspective</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.box</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>第二种：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22044059434416607000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.stage .box {\n   transform: perspective(600px) rotateY(45deg);\n}`, `22044059434416607000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.stage .box</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">perspective</span><span class="token punctuation">(</span>600px<span class="token punctuation">)</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/zjp7lo?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>看到的效果如图 5-43 所示，其中左侧的是 perspective 属性写法，右侧的是 perspective() 函数写法。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-08a78.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 574px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 65.33101045296168%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACGUlEQVQoz9WRW08TQRiG99d4UUMkLdsDtLulXLUJhmhCMCb+AO6JRLSJ8VIDKW1tVVroVjFB8QpqSjSGQ2lLW6yGmIJQD0tIiglkd9mdw87uOi1GEv+BX96rmXm+N3mGQRim0qX7D/Iv5qu5t18KmwfN5i9ZVhGCCELdsnYWF9+Hwx8FobG83FxbP97bOzs5RQgDABgItbHx3KXLD+3OiMMVcXvjHm/85q2XkgwwBNA0S1NTj222Zyw7w7Jpj2eO4+eDQeXoSEOIwRhO3MvbndP8wBOvP0nT444NDmUkCRKMkGVVYrEUy2YDAYHnaea8Xhrl8BAS0obv3M1390R8/ck+PkFhZ29s6LpwAUejMw6H4PdnOK4dny/D821Y1/97mOunthJ0BRV+bTgryVD/B+b5TMeZEAj8gXVqO7xid0b5gad9fLKXS3Sz08HBWUkCtBlTOB7/a5vWzrrdaZdLFkVEbQOgjt1esl155PHFuEAidDU1fCM7PpGTZQ1qGiDG5uRkoqsrRX+I9z8PhV6NjCyNjiqt1pmmMYToK+8ar998qm2Lu7stUTxRFGCZJj3XsW5allgs7iwsiOXycaNx+uOnJknEMAghGGPGuhj60jwfCLFOCEIIAKjTRZ1rwzR1YlDGNIxzgOkwliIrq+ul/YPvX/e/qaq6tlEsV7a3qrVCoVip1iuVWrVaXf2wUa9/Lpa3VE2zOj2/Ady1CXHMBZvtAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 10 21" title="" data-src="/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-08a78.png" data-srcset="/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-683d3.png 200w,\n/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-6bdc6.png 400w,\n/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-08a78.png 574w" data-sizes="(max-width: 574px) 100vw, 574px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>仔细对比图 5-43 左右两侧图形的效果，会发现虽然透视点设置的方法不一样，但是效果貌似是一样的。果真是这样吗？其实不然，图 5-43 左右两侧图形的效果之所以会一样，是因为舞台上只有一个元素，因此，两种书写形式的表现正好一样。如果舞台上有多个元素，那么两种书写形式的表现差异就会立刻显示出来，如图 5-44 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-7517b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 756px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.13756613756614%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAC90lEQVQozz2RWU8TURSA54/44BKUAhW6Ca0p0NKQSOQFTQhQi2BA1BgjCpFgiIpKjLKUglJQthZkadgKLZVVlhiIKEuhpaVM9wGm0zJ02qFF8PYB7tP9zjnfPefeCz19Pnjvfs+L0pFX5Zq+/lVZx2/h3c7SMtW7ijGdDrHZsNy87uKS4db2RZI8PDk5efP2R2HRkE6PHB8fQRlCOZVew4irvRzx6Va6TCyZi4yuYrIl58M+dPeuoCjBYteFUytvpDb7fAEg5xUozl14PzC4DvaQMLvzGqcugd/AYkty83sln+cZsbWJAimNJR5Uru/tebm8LyCVntnh9weB8PBxf8TVKtWoPiSLcr6H5KQG4NzJ6a4/lcE4fQNaNCSHzr2dLj+TKdTKYZUuJKdnyqIZNaw4MZ1ZVfBIUSOZjYyujOWIacwq5YjWieyz2LXUmI8ZWTKCIIGQm98TdqVCpQZjH0NjY7rx0ZXVjd1N8z7q9q38NauHl7V61GTDCTK460Q16jWt3uV0+QNH/0jvwfycYW3T5QscB4NByIvY1Q/yxgufTJUUu00mbMs4JMqcKCr8WfYSRxB4ZkaZLZwsfjZT/ppwe3TK4UFRFsBf1dXEwQG0t2X6xrneyGCKL17anphANzfrKZGNTFY9JQJZXgYRgFIGUxpD85jNGwpFXTilITpGnpzsdWGQC4blAkEbj9dIp1tmZ10Gw1cWqz0pqZnN3tNq4cnJEPJ4bQkJuNWq6+trYjBa4+N70tIItxvCYFjG57dyuQ1RUebpacxobKLTQSko2lldhaemAIJsC5u9b7EAuZFGa+FwulJvEhgGoSZTW2IiaNXC5doWFnbX16U0WrtAACLgCkaNRkqnA+xIScGdzrWuLjBgO58/IBIRHg/kx3Hb4iJqNHpdKPgJH4ZZFxZAE7/HA9CLIM4/S/tWK4njAHGrzb605AZZHA+99snpIklyG7agbo8/EIDtDrsTMRhN2xabA3VZEcSB7NjtTrPdcRgMnin/ARLJ/SPw8X9kAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 11 13" title="" data-src="/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-7517b.png" data-srcset="/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-0f6be.png 200w,\n/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-091cf.png 400w,\n/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-7517b.png 756w" data-sizes="(max-width: 756px) 100vw, 756px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 5-44 所示的效果其实不难理解。图 5-44 上面一排元素把整个舞台作为透视元素，也就是我们看到的每个子元素都共用同一个透视点，因此每一个子元素的视觉形状都不一样，这个效果比较符合现实世界的 3D 透视效果。例如视线前方有一排人，远处的人只能被看到侧脸，近处的人可以被看到正脸。而图 5-44 下面一排元素中的每个子元素都有一个自己独立的透视点，加上旋转的角度又是一样的，因此每个元素看上去也就一模一样了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/soqnjm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="理解-perspective-origin-属性"><a href="#%E7%90%86%E8%A7%A3-perspective-origin-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>理解 perspective-origin 属性</h2>\n<p>perspective-origin 属性很好理解，表示我们的眼睛相对 3D 变换元素的位置，你可以通过改变眼睛的位置来改变元素的 3D 渲染效果，原理如图 5-45 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-c7bf1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.5774647887324%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABT0lEQVQoz3VRSW6DQBDk//f8Im/g4iWHYGRWEQwBIwEGs+9rSJmxcBySPoxmurumuqqpMAwFQaiqapqmrzmm5xiGwbZtXddFUVQURZbltm1JiYqiSJKkPM/7vu+6bphjHEdywV9N01wuF8/zcKZpCjJ03sGEkDxwAQA1gif5vm33uh4kydIJDoKnplWgY2EGNeZ+2e3sMEQJeZzQiBF+M69/QaGr69ft1pvBpLMsS8j8m3lt2H6zCa7Xm4S+Bx7gZFZxA9d1Teb5DwxHkx+a4XZRFHcwbIzjGDYgS5Tigj7wwGrwYJdBEBAYzizLHpqxLcuykHIcByTYJMdxLMuqqoqk7/sMw/A8jyVLc9A0jZ2bpvmkGVTggZnDzLnscxxGJIlP+A4zQwXIH24bhqGoWprljuuqJ90wz7bjap+GKMqHI/9x0t7eD+yRM87WQvYNafp0Uo+8UZ0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 13 19" title="" data-src="/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-fee1c.png" data-srcset="/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-a67b7.png 200w,\n/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-0b187.png 400w,\n/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-fee1c.png 800w,\n/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-c7bf1.png 852w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>正式语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28882315520331137000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`perspective-origin: <position>;`, `28882315520331137000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">perspective-origin</span><span class="token punctuation">:</span> &lt;position><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>一看到 <code class="language-text">&lt;position&gt;</code> 数据类型，就应该赶快回想起 background-position 属性支持哪些值，也就知道了 perspective-origin 属性支持哪些值。例如，下面这些语句都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71497721690895385000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`perspective-origin: top left;\nperspective-origin: right 20px bottom 40%;\nperspective-origin: 50% 50%;\nperspective-origin: -200% 200%;\nperspective-origin: 20cm 100ch;`, `71497721690895385000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">perspective-origin</span><span class="token punctuation">:</span> top left<span class="token punctuation">;</span>\n<span class="token property">perspective-origin</span><span class="token punctuation">:</span> right 20px bottom 40%<span class="token punctuation">;</span>\n<span class="token property">perspective-origin</span><span class="token punctuation">:</span> 50% 50%<span class="token punctuation">;</span>\n<span class="token property">perspective-origin</span><span class="token punctuation">:</span> -200% 200%<span class="token punctuation">;</span>\n<span class="token property">perspective-origin</span><span class="token punctuation">:</span> 20cm 100ch<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>perspective-origin 属性初始值是 50% 50%，表示默认的透视点是舞台或元素的中心。但是有时候，需要让变换的元素不在舞台的中心，或让透视角度偏上或者偏下，此时就可以通过设置 perspective-origin 属性值实现。</p>\n<p>图 5-46 所示的就是一个立方体应用 perspective-origin: 25% 75% 声明后的透视效果图。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-f79be.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 567px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.4973544973545%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABfUlEQVQoz2P4jwT+/vkDJG8sWb/HNOKoW/phl9TDLilHXNIPWEac6WoHqfj3D1k9A4rm37+B5LUJ8w4zWJwR9jnJ4XSKy+W0oM8JZbEzNfF/idF8fe6iQzy256W9b4VV38rsPm6oetKT80xDGkHNIGdfX7TkAK/dfXXfF21Ln22Yc9yV55Qr75n6VAKa/0E0L1lyUcnovorpFV/fZxsmnXDjP+XKQ4TmPyBn31i69I2z9P9AyfsJBvfKg0/6ip524z3bmEbQZpDmK3PnP5WR+2OsfUdL8Zyu8Ak70cPmjMcrIQH2F7fmvyCD3924/Wrx9ver9r9fufftmt2v1+54uG7V07PHIUpwaiYVMPz48eMPCPz+B/bPPzD48+sXKOT/Ahm///358+vHj+/fvwMV/QKDnz+B6OevX78ZNm7afvP2nQsXL335+u3S1SsXL189dx5IXL9y7fq9+w+v37p58dLlAwcPb9+979ix4zv3Hti3/8D2HfuOnTi978BhAB1VKWCTQfmVAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 18 33" title="" data-src="/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-f79be.png" data-srcset="/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-5ae21.png 200w,\n/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-d9cbe.png 400w,\n/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-f79be.png 567w" data-sizes="(max-width: 567px) 100vw, 567px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="transform-style-preserve-3d-声明的含义"><a href="#transform-style-preserve-3d-%E5%A3%B0%E6%98%8E%E7%9A%84%E5%90%AB%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transform-style: preserve-3d 声明的含义</h2>\n<p>transform-style 支持两个关键字属性值，分别是 preserve-3d 和 flat，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10700329271976905000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform-style: preserve-3d;\ntransform-style: flat;`, `10700329271976905000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>\n<span class="token property">transform-style</span><span class="token punctuation">:</span> flat<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>先讲一下这一语法中的几个关键点。</p>\n<ul>\n<li>preserve-3d 表示应用 3D 变换的元素位于三维空间中，preserve-3d 属性值的渲染表现更符合真实世界的 3D 表现。</li>\n<li>flat 是默认值，表示应用 3D 变换的元素位于舞台或元素的平面中，其渲染表现类似“二向箔”，把三维空间压缩在舞台元素的二维空间中。</li>\n</ul>\n<p>我们通过一个例子直观地了解一下 preserve-3d 和 flat 这两个属性值的区别，HTML 和 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35517918622887800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<section class=&quot;stage preserve-3d&quot;>\n   <div class=&quot;box&quot;></div>\n</section>\n\n<section class=&quot;stage&quot;>\n   <div class=&quot;box&quot;></div>\n</section>\n\n<style>\n   .stage {\n      width: 150px;\n      height: 150px;\n      background-color: rgba(0, 191, 255, 0.75);\n      perspective: 600px;\n   }\n\n   .box {\n      height: 100%;\n      opacity: 0.75;\n      background-color: darkred;\n      transform: rotateY(45deg);\n   }\n\n   .preserve-3d {\n      transform-style: preserve-3d;\n   }\n</style>`, `35517918622887800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage preserve-3d<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.stage</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 191<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.75<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">perspective</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0.75<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> darkred<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.preserve-3d</span> <span class="token punctuation">{</span>\n      <span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>应用了 transform-style: preserve-3d 声明的 3D 变换元素有部分区域藏到了舞台元素的后面，因为此时整个舞台按照真实的三维空间渲染，自然看不到旋转到后面的图形区域，如图 5-47 左侧图形所示。默认情况下，元素无论怎么变换，其 3D 效果都会被渲染在舞台元素所在的二维平面之上，因此没有视觉上的穿透效果，如图 5-47 右侧图形所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-6f9e6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 692px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.312138728323696%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+klEQVQoz2P4DwS/fv2/ceP/lSv/bt74ffXK/4sX/9+5/f/2rf8PH/y/eeP/o0d/Llz4e/bs/4cP/z9+/P/h4/9Xr/7/9g2ojwGI//37///Pn1///088/qDDLWBOaHTL1NXZh5/lnnwz4+n/Da//NSYWTvMNnpdbOq+qderkJeVXvj3+CdIH1gzCf7/+/x+/+0GOoX2lqr57apvUvEsyS28l3/rf/uh/dEBGhbphga5VsaphnqmLya5XV9A0A92RsfdBkYlTg555YG6PxpJrWqvv5Nz+3/f4f1JwVp2eRYWFa5WxfalLsMPe19cwNafvfVBo4lSvaxaQ0622+KrGqjvZt//3Pv6fGJxVq2tebuZcaWhT6hhgh1UzyGZTZJvvkmLzvofFVh4N+hZgm69orLwNsTk5PK/e0LrC3KXKwLrM3td+D0zzv3///gKDG6w5Z/edPE2zBj2ziKIJRqtumm58WHTn/ySgsz3jazSNauw86xz9SqOy3Q+/v/EdqPkvyOb/0Oj6//rT1wdHjr68eu3V208v//x/+fffuz//gbHw4NyF5+cvfHjy9P2XH6//A8X//wYp/8/w5OnTt+/ef/v27ceP71+/fP729y8wwn/++PHlw/u3r15+/vD+xbNnbz98fPnuwxsg+erli6dPPr178+bN25cvXwEAENOz9kiP6XMAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 24 42" title="" data-src="/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-6f9e6.png" data-srcset="/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-2b38f.png 200w,\n/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-438f0.png 400w,\n/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-6f9e6.png 692w" data-sizes="(max-width: 692px) 100vw, 692px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/zgw557?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>需要注意的是，transform-style 属性需要用在 3D 变换元素的父元素上，也就是舞台元素上才有效果。</p>\n<h2 id="backface-visibility-属性的作用"><a href="#backface-visibility-%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BD%9C%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>backface-visibility 属性的作用</h2>\n<p>在 CSS 世界中，一个元素的背面表现为其正面图像的镜像，因此，当我们使用翻转效果使其背面展示在用户面前的时候，显示的是该元素正面图像的镜像。</p>\n<p>这一特性和现实中的 3D 效果并不一致，例如我们要实现扑克牌翻转的 3D 效果，很显然，扑克牌的背面一定是花纹，不可能是正面的牌号。因此，当我们对扑克牌进行翻转使其背面展示在用户面前的时候，显示扑克牌的正面镜像显然是不合理的。我们需要隐藏扑克牌元素的背面，至于扑克牌背面花纹的效果，我们可以使用其他元素进行模拟，然后让前后两个元素互相配合来实现 3D 扑克牌翻转效果。这个控制扑克牌的背面不显示的 CSS 属性就是 backface-visibility。</p>\n<p>backface-visibility 属性语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55621758900334300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`backface-visibility: hidden;\nbackface-visibility: visible;`, `55621758900334300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">backface-visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n<span class="token property">backface-visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>其中，visible 是默认值，也就是元素翻转时背面是可见的；如果 backface-visibility 的属性值是 hidden，则表示元素翻转时背面是不可见的。</p>\n<p>我们通过一个例子直观地了解一下 hidden 和 visible 这两个属性值的区别，HTML 和 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32199622670505402000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<section class=&quot;stage backface-hidden&quot;>\n   <div class=&quot;box&quot;></div>\n   <div class=&quot;box&quot;></div>\n</section>\n\n<section class=&quot;stage&quot;>\n   <div class=&quot;box&quot;></div>\n   <div class=&quot;box&quot;></div>\n</section>\n\n<style>\n   .stage {\n      width: 150px;\n      height: 150px;\n      border: 1px solid darkgray;\n      perspective: 600px;\n      transform-style: preserve-3d;\n   }\n\n   .box {\n      width: inherit;\n      height: inherit;\n      opacity: 0.75;\n      background-color: darkred;\n      transform: rotateY(225deg);\n   }\n\n   .box:first-child {\n      transform: rotateY(-45deg);\n      background-color: darkblue;\n      position: absolute;\n   }\n\n   .backface-hidden .box {\n      backface-visibility: hidden;\n   }\n</style>`, `32199622670505402000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage backface-hidden<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.stage</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid darkgray<span class="token punctuation">;</span>\n      <span class="token property">perspective</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>\n      <span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0.75<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> darkred<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>225deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.box:first-child</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>-45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> darkblue<span class="token punctuation">;</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.backface-hidden .box</span> <span class="token punctuation">{</span>\n      <span class="token property">backface-visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>设置了 backface-visibility: hidden 后，绕 y 轴旋转 225 度后元素被隐藏了，因为 rotateY 值在大于 180 度、小于 360 度的时候，我们看到的就是元素的背面了，如图 5-48 左侧所示；而 backface-visibility 属性值是 visible 的元素绕 y 轴旋转 225 度后依然清晰可见，效果如图 5-48 右侧所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-95b2a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 724px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABsklEQVQoz2P4DwGPHv27evX/00f/Hz34ffb8p/PXnu49/efO3b8PH3zZt/f3lUu/b9/5eur8s6OXfly88v/pE4gmBgj19+/ff///rFt/KzdvT1LKDg+vtcEhGz9/+/Xz04f5rv696mZFVjmW2v2uVrPuP3gPVP/v3z+E5j9//gLJqqrD2trzbG2XW1gs8fdf/+Xrrz/fPk0ycS1hkgri9pJhKbFS73rw8ANWzf+am4+bmS1xcVllY7MsMGADSPPXT1Mt3Cu45CNEApV4Km20e3Fp/t/UdMzEZLGzM4rmKebuFRzy4cIBStwVNlo9+Gw2N1/i6rra1haoeT3MZo9KLoVI0UAVXrw2V1QcUlGZDdRvaLjQy2sNRHO/vkM+g7APs4soQ4GJYtuDBxiagYH99+/vY8ceT558urn5aGbmrtTUHV++/vz5+ePamOSlgTETU3sSQpfFhKx8iGwzhMIEYOP+/f3z59+f32iCQL0Q/Qynz5y7ffveixcvHz16fPnKtes37jx6/PTWndvXb968cu3azTt3z56/dOr0OSA6efrMqdOnT5w6c+HS5avXbhw/cRoAN5zBJ/MzfR0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 02 14 02 45" title="" data-src="/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-95b2a.png" data-srcset="/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-9e4f1.png 200w,\n/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-4a316.png 400w,\n/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-95b2a.png 724w" data-sizes="(max-width: 724px) 100vw, 724px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/3ty0kq?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="值得学习的旋转木马案例"><a href="#%E5%80%BC%E5%BE%97%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%97%8B%E8%BD%AC%E6%9C%A8%E9%A9%AC%E6%A1%88%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>值得学习的旋转木马案例</h2>\n<p>这里举一个图片列表旋转木马效果案例，它可以用来替换常见的 2D 轮播效果，如果读者能弄明白这个例子，那么对 CSS 3D 变换的学习就算是合格了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/mnzyke?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>实现的效果如图 5-49 所示，点击任意图片可以看到图片列表的旋转木马效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-31a59.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.951105937136205%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAACQElEQVQoz12NW0gTcBSH/wnRW1FBRUUIoiBqKApmZXlhleEwyua84KUcoTPbJvM2LYvaKJpiypLykteZEuREtHxJKEKhhW7anGKmi64PiRk5YV/THoI+OPwOPzjfETp9I2pdDakXS5HKlLy1zfLd/pT5V/WMmfN5bkzB8ewuM4MGLNX5qJOjGW42MDT6miOpWWTkFXNZf5tSkwlzvwUhRBhiSzhiWzgBkSlYRy24hrUMVEYyUnuSCXMm0+ZcPg+V8aT4GIl+PjSqUtE+7EWE+HvvAhH+wd49kGDZKa8wSIGvRE3RnWZqWyz0dV3B9ULFRFsBXYVRvLx3noGbiYzWp9GqPErawe20FiWjqTMhFBI2SxLxiU1CXDiDpCIHkXGtCYP3m8rYib6hj1xtAt3GE4zVZjN4XUpDoQStPJIxUzqdqjjOBmylWXMaza0SRHQYPnmx+Bmk7KyMIV4mRZTrTTS2dFB9vwVzx2OSciXU6Y4zYkinvyoZZdJhSuQSesrSqcmKJT3Cn4qcOBTl8Yjd+9gUfoD9yj2IQ3sJTfB2Te3d9PZ00/KojYobRiyDQ7Qbr6KTn6TqUgYaRSYKuYxzMdEkREUQFRRAQW4WD8zNXuEOdsWE4KcOwlcdSnZZMQI8rLrdLC3/5MPHr/xedeNaWMRuszM1NYXT6WR2xsmkfQK7d6zWN7yfm+PH0jL2GQefvn1heekXHo+HdcTf+IfbvYpjeoaFRRcrKyu8czixjtuYX3Bt9OO2yY10r63xP+vSPzvOpo0x1mKvAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 02 14 12 33" title="" data-src="/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-fee1c.png" data-srcset="/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-a67b7.png 200w,\n/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-0b187.png 400w,\n/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-fee1c.png 800w,\n/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-31a59.png 859w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="实现原理"><a href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现原理</h3>\n<p>这个案例用到的 CSS 属性就是前面提到的几个常用 CSS 属性，包括透视、3D 变换和三维空间设置。</p>\n<p>首先，HTML 代码结构如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71815968300723300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`舞台\n   容器\n      图片\n      图片\n      图片\n      ......`, `71815968300723300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">舞台\n   容器\n      图片\n      图片\n      图片\n      ......</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>相关 HTML 代码是：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="83515424252157740000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<div class=&quot;stage&quot;>\n   <div id=&quot;container&quot; class=&quot;container&quot;>\n      <img class=&quot;piece&quot; data-src=&quot;1.jpg&quot; style=&quot;--index:0;&quot; />\n      <img class=&quot;piece&quot; src=&quot;2.jpg&quot; style=&quot;--index:1;&quot; />\n      <img class=&quot;piece&quot; src=&quot;3.jpg&quot; style=&quot;--index:2;&quot; />\n      <img class=&quot;piece&quot; src=&quot;4.jpg&quot; style=&quot;--index:3;&quot; />\n      <img class=&quot;piece&quot; src=&quot;5.jpg&quot; style=&quot;--index:4;&quot; />\n      <img class=&quot;piece&quot; src=&quot;6.jpg&quot; style=&quot;--index:5;&quot; />\n      <img class=&quot;piece&quot; src=&quot;7.jpg&quot; style=&quot;--index:6;&quot; />\n      <img class=&quot;piece&quot; src=&quot;8.jpg&quot; style=&quot;--index:7;&quot; />\n      <img class=&quot;piece&quot; src=&quot;9.jpg&quot; style=&quot;--index:8;&quot; />\n   </div>\n</div>`, `83515424252157740000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>2<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>3<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>5.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>4<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>5<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>7.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>6<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>7<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>9.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>8<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于舞台，需要为其设置视距，例如设置为 800px：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4927825190587453000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.stage {\n   perspective: 800px;\n}`, `4927825190587453000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.stage</span> <span class="token punctuation">{</span>\n   <span class="token property">perspective</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>对于容器，需要为其添加 3D 视图声明：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37521944022866970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   transform-style: preserve-3d;\n}`, `37521944022866970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后就是图片元素了，为了方便定位，我们让所有图片应用 position: absolute 声明，共用一个 3D 变换中心点。</p>\n<p>显然，图片旋转木马的运动方式需要应用的 3D 变换函数是 rotateY() 函数。因此，图片元素需要设置的 rotateY() 函数值就是 360 度除以图片数量后的计算值，这里有 9 张图片，则每张图片的旋转角度比前一张图片多 40 度（360 / 9 = 40）。如果需要兼容 IE 浏览器，我们可以这样书写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76873249485221130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img:nth-child(1) {\n   transform: rotateY(0deg);\n}\n\nimg:nth-child(2) {\n   transform: rotateY(40deg);\n}\n\nimg:nth-child(3) {\n   transform: rotateY(80deg);\n}\n\nimg:nth-child(4) {\n   transform: rotateY(120deg);\n}\n\nimg:nth-child(5) {\n   transform: rotateY(160deg);\n}\n\nimg:nth-child(6) {\n   transform: rotateY(200deg);\n}\n\nimg:nth-child(7) {\n   transform: rotateY(240deg);\n}\n\nimg:nth-child(8) {\n   transform: rotateY(280deg);\n}\n\nimg:nth-child(9) {\n   transform: rotateY(320deg);\n}`, `76873249485221130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img:nth-child(1)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(2)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>40deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(3)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>80deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(4)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>120deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(5)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>160deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(6)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>200deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(7)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>240deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(8)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>280deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(9)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>320deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果无须兼容 IE 浏览器，我们可以使用 CSS 自定义属性实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88071077642418810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   transform: rotateY(calc(var(--index) * 40deg));\n}`, `88071077642418810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--index<span class="token punctuation">)</span> * 40deg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>虽然 9 张图片的方位都不一样，但由于它们共用一个 3D 变换中心点，因此一定会挤成一团，如图 5-50 所示，图片挤成一团的效果显然不是我们需要的，我们需要拉开图片之间的距离。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-4fbc8.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 431px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 84.68677494199537%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAAETElEQVQ4y63T+1PUVRjHcWpyYrqhIjgTJF5Wd2VZBAQCg1UTRJFgKAgEQ/EGiRAjBGRIEQiiNpIiFw1QaxFIwcu6uwa73FwFtUYTjQQzLgvCAgpMeWGmd1+bafYf6PnhnJnznHnNOWfOxwyheoYGqVXqUDb1o7/1jPOKY1Tlp1FdlM9A+3EmH9/gQIWChF25VJUrSU8vYl/WXh5equT+2SK62xoYeWh8TmH2fKiqbyYjt4T8E79RVPOIzG0xBM4xY72rNUMtWzHcy+WFd1yYIZGzzisGV0kIMavWYDwUzC9JblzO3o6uvdUEKhv0fF+tEuY+zjWNUrQzjsjFlmSGOjLZnkZfZw5TA31wXRNMYXQ6W/xi2RUWxtVUVwqiHVBlxaO9qTeBlcpmCspqadTfR9XYS0lSOBvdrUj2FTHaGE1vewqvBPkiDw1EE5/I/pAYkpd7cSrOmZKMAMoSwlG36Uyguq6F4xVnuHatnavXfxLAMD7xnknC0lkYlCH0XI/n5XA/Vm8IwJAYTmlgKGlyVzqL13H1m0gOfuTPqSaNCTx7oYmS8hp+btNzXnMMReZWNrlYkOznwI0KL1pr32bKtmAiNvlwJ8gbucNSlro78W2sjENbpaSGrURRrzaB1SotB49U0NZYz5m6M5RlbmSjswU7fKSoSlxQlIt5KSkYN18P0lyWCOAyxFIZqyNsiYi1x89FSuHpShOYuucAMUlZ6LU1aLQKDqd8SLTzdNIDnCnb70jOURH2xwJwcHFlxUJfbOf7IhY7InafyhyZNYtm23Gg8jsTuD4pg+2pX6FTl3Pyh1xKPhWuJxNA/0Xs3ikl5YgV/sUSxBJ34hx8iFj4LitlDljYmCMSWSKZZUPuiVITmL73IDsz86ivy6JG+TkZ20IIktmSskJGfJyI0M8shX+4AP+5Mlocvdkn9SZ8ngTzGS8ye8E05tq8SXbpUROYnV9AVOwO8o4EUV0bRVzUKrb4eJC9NoDIKAn+ia9jHrQAT5kbp6VeHBUvYbOdCEu7KUgdp2M/5y3hWYpN4NcFhazftIUTVctQnPZhQ7gcT+lCVi/xQO5nw7J4c2bseoOZTh68b+/NByIPIt1kfBw1j4S181ksmkVe8WETeLKqmi+z00n8wpbdpWLeWyPFztoaJ8l8nLxeY/kGK17dPJNpEjFykSciKxkrvRdxKM+TnCRnIYrz2FtU+B/4NxMTf9JtMHCz6xJ3+66j1aqo//EiHXfu0Nyq4Y++Dn7t7OScTsft9g40ai1anRaD4Rbdv1+j+/49Ho2Nm074f5aZoX+AIeMwT54+xThsZHLyGWNjYwwMDtE/8ICBB4OMjAwLvREGh4yMj08I/XF6ew2MjI7S19f77z7j8DDDI6OYqTV16C+30dPTi7ahmb8eP6GrswtVXb2QcR26hhautLZxqeUKF9QXud1xl667XWiEdDULa+cvqNA26WkVDE1dA/8AlJahf5l2tPUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 02 14 29 42" title="" data-src="/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-4fbc8.png" data-srcset="/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-3b445.png 200w,\n/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-b6b36.png 400w,\n/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-4fbc8.png 431w" data-sizes="(max-width: 431px) 100vw, 431px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如何拉开距离呢？其实很简单。我们可以把 9 张图片想象成 9 个人，现在这 9 个人站在一起分别面朝不同的方位，这 9 个人是不是只要每个人向前走 4 ～ 5 步，彼此之间的距离就拉开了？不妨想象一下夜空中礼花绽开的场景。这里的向前走 4 ～ 5 步的行为，就相当于应用 translateZ() 函数的行为，当 translateZ() 函数值为正值的时候，元素会向其面对的方向走去。</p>\n<p>现在只剩下一个问题了：要向前走多远呢？这个距离是有计算公式的！这 9 张图片宽度均是 128px，因此就有图 5-51 所示的理想方位效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-284ba.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 653px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 83.46094946401224%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB40lEQVQ4y3WT3XLaMBCF/f6v1DSZppm2TOiQ0GlnyvQG0hCDjbFk4/hHMv2ktRRyUV2AvN6ze/acdXIOx1rbtq1SKsuyoii01l3XjeN4/v9J5I/U4/FYVdUwDMYYMH3fS/B0OrkMX2XsOmvMO3DTNHmemxAFHxvSHCIUkkdTlkPbvoHJOxwO/A7+XILBMAuPTCHZo9aGWSIYqnVdy4NkQ2EIJw4l5AE3VdWHeLLf7+kDRroBoMRms2EWP6k7lDvkuaOt1N/1+jUwT4QzAJGKQx/oXPYnoWRaGlTVmbhX1IGJvrkFwlqVprVS/mqjhFR0CSQT9wI5MMbKjeweJ2BRFEhqvFSCh1eplANDPkRo7sD4IZzdayak3GtrgwTEmV8Es1qPPk3iCVuFydFY1w0VkCDYTtJut5tKQ95fxNppSXBSBHeqwHAwQ+iAonFJrPc5Fp3Wk/7gqTIgWllar/6prkFOm+epWaW2T09iCpAkSk0T+Cut98/PeZbhAsgo+Dm0w/DVasUrVmsCy8yNP+vNZrvdcmkv1vjy40vTVF4lMWSNjbLJJazX5JlfRBw07z4M/h4elssfv7YvaaX11fWnxWL5e/Vndj+/uf3y4erm4/Xt4/Ln9/ni893Xb7P72WyudAXqH4BC288YhxSsAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 02 14 33 56" title="" data-src="/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-284ba.png" data-srcset="/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-b5223.png 200w,\n/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-dce0f.png 400w,\n/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-284ba.png 653w" data-sizes="(max-width: 653px) 100vw, 653px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 5-51 中使用红色标注的 r 就是图片需要设置的 translateZ() 函数的理想值，使用该值可以让所有图片无缝围在一起。</p>\n<p>r 的计算比较简单：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mo>=</mo><mn>6</mn><mn>4</mn><mi mathvariant="normal">/</mi><mi>t</mi><mi>a</mi><mi>n</mi><mo>(</mo><mn>2</mn><msup><mn>0</mn><mo>∘</mo></msup><mo>)</mo><mo>≈</mo><mn>1</mn><mn>7</mn><mn>5</mn><mi mathvariant="normal">.</mi><mn>8</mn></mrow><annotation encoding="application/x-tex">r = 64 / tan(20 ^ \\circ) \\approx 175.8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">6</span><span class="mord">4</span><span class="mord">/</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.674115em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">1</span><span class="mord">7</span><span class="mord">5</span><span class="mord">.</span><span class="mord">8</span></span></span></span></p>\n<p>为了好看，图片左右两边可以留点间距，例如 20px，最终得到需要使用的 translateZ() 函数值为 175.8 + 20 = 195.8。于是，最终图片元素设置的 transform 属性值是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32982215666589254000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: rotateY(calc(var(--index) * 40deg)) translateZ(195.839px);`, `32982215666589254000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--index<span class="token punctuation">)</span> * 40deg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">translateZ</span><span class="token punctuation">(</span>195.839px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>最后，要让图片旋转起来，只要让容器每次旋转 40 度就可以了，这个可以使用 CSS 动画完成，或者使用 JavaScript 设置也是可以的。理解了旋转木马 3D 效果实现原理，其他 3D 效果基本上就都可以轻松驾驭了。</p>\n<h2 id="3d-变换与-gpu-加速"><a href="#3d-%E5%8F%98%E6%8D%A2%E4%B8%8E-gpu-%E5%8A%A0%E9%80%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3D 变换与 GPU 加速</h2>\n<p>3D 变换除了用来实现 3D 效果，还经常被用来开启 GPU 加速，例如实现左位移 100px，下面两种写法都是有效的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42308414463771310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: translate(-100px, 0);\ntransform: translate3d(-100px, 0, 0);`, `42308414463771310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-100px<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-100px<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是，使用 translate3d() 函数的变换效果性能要更高，因为使用该函数会开启 GPU 加速。然后问题就来了，很多开发者一看到“性能更好”就激动了，遇到了元素变换效果就使用 3D 变换，甚至实现其他简单的图形表现时也会添加一段无关紧要的 CSS 3D 变换代码，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="963472358784289700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: translateZ(0);`, `963472358784289700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateZ</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这是一个很糟糕的做法，Web 网页是如此简单，2D 变换原本的性能就很高，根本就没有任何必要去开启 GPU 加速，没有遇到任何一个场景非得使用 3D 变换才不卡顿的。要知道，不必要的 GPU 加速会增加内存的使用，这会影响移动设备的电池寿命。因此，我直接就下结论了：单纯的 2D 变换请一定使用 2D 变换函数，没有任何理由需要使用 3D 变换函数，此时让 GPU 加速是一种糟糕的做法。</p>\n<h1 id="css-过渡"><a href="#css-%E8%BF%87%E6%B8%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 过渡</h1>\n<p>使用 transition 属性可以实现元素 A 状态到 B 状态的过渡效果，经常使用 :hover 伪类或者 :active 伪类触发。</p>\n<p>目前，我们已经无须给 transition 属性增加私有前缀了，无论是什么项目都不需要。IE 浏览器从 IE10 版本开始，就从未支持过 -ms- 私有前缀，完全没有任何需要添加 -ms- 私有前缀的理由。</p>\n<p>至于添加 -moz- 和 -webkit- 私有前缀也是很多年以前的事情了，目前已经无须再添加。即使有个别用户使用的是非常古老的浏览器也没有关系，因为 transition 是一个体验增强的 CSS 属性，即使浏览器不支持，也只会导致一些交互效果生硬一点，对页面功能没有任何影响。</p>\n<p>transition 是一个常用属性，相信基础的知识大家都比较了解，因此，接下来我只会介绍一些我认为读者可能不知道的关于 transition 属性的知识。</p>\n<h2 id="你可能不知道的-transition-属性知识"><a href="#%E4%BD%A0%E5%8F%AF%E8%83%BD%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84-transition-%E5%B1%9E%E6%80%A7%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>你可能不知道的 transition 属性知识</h2>\n<p>transition 属性是一个缩写属性，它是 transition-duration、transition-delay、transition-property、transition-timing-function 这 4 个 CSS 属性的缩写，每一个 CSS 属性的背后都有大家所不知道的细节。</p>\n<h3 id="transition-duration-属性"><a href="#transition-duration-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition-duration 属性</h3>\n<p>transition-duration 属性表示过渡时间，它的值可以是 0，但是不能是负值，其他就没什么好说的……真的是这样吗？请看下面这段 CSS 声明：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26218251657536373000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition: 1s 0.5s;`, `26218251657536373000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition</span><span class="token punctuation">:</span> 1s 0.5s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>很多开发者都知道，第一个时间值 1s 表示过渡时间，第二个时间值表示延时时间（transition-delay），这两个时间值的顺序是固定的，绝对不能调换，否则含义会颠倒过来。久而久之大家容易陷入一个误区，认为 transition 属性如果设置了两个时间值，其顺序必须是固定的，其实不然！有一种场景下 transition 属性的两个时间值的顺序是可以任意调换的。什么场景呢？就是其中一个时间值是负值的时候。例如，下面两句 CSS 声明都是合法的，且含义一模一样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86540835010107870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 效果一样 */\ntransition: 2s -1s;\ntransition: -1s 2s;`, `86540835010107870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 效果一样 */</span>\n<span class="token property">transition</span><span class="token punctuation">:</span> 2s -1s<span class="token punctuation">;</span>\n<span class="token property">transition</span><span class="token punctuation">:</span> -1s 2s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>原因就在于不起眼的“transition-duration 不能是负值”的特性，所以上面代码中的 −1s 只能是 transition-delay 的属性值，两个值就可以无序排列。</p>\n<h3 id="transition-delay-属性"><a href="#transition-delay-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition-delay 属性</h3>\n<p>transition-delay 属性用来指定延时过渡效果执行的时间，单位是 s（秒）或者 ms（毫秒），其值可以是负值，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96931128192022430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition-delay: 200ms;\ntransition-delay: 2s;\ntransition-delay: -0.5s;`, `96931128192022430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition-delay</span><span class="token punctuation">:</span> 200ms<span class="token punctuation">;</span>\n<span class="token property">transition-delay</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span>\n<span class="token property">transition-delay</span><span class="token punctuation">:</span> -0.5s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当 transition-delay 属性值为负值的时候，会带来一个很有意思的现象，那就是可以省略部分动画进程，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79702643250423150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   transform: translateX(0);\n   transition-duration: 1s;\n   transition-delay: -0.5s;\n}\n\n.example:hover {\n   transform: translateX(100px);\n}`, `79702643250423150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 1s<span class="token punctuation">;</span>\n   <span class="token property">transition-delay</span><span class="token punctuation">:</span> -0.5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.example:hover</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>100px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时当鼠标经过 .example 元素的时候，元素的 transform 位移位置不是从 0 开始，而是从靠近 50px 的位置开始的，且过渡效果执行的时间不是 1s，而是 0.5s，因为最终过渡执行的时间等于动画过程时间加动画延时时间，也就是 <code class="language-text">1s + (−0.5s) = 0.5s</code>。</p>\n<p>transition-delay 属性有一个隐蔽的但却很实在的作用，那就是可以提高用户的交互体验。例如，使用 :hover 伪类实现的浮层是一种很常见的交互效果，传统的效果都是鼠标指针一旦经过元素，浮层立即出现。这其实是有问题的，因为鼠标非常容易误触该交互效果。优秀的交互体验是会增加一定的延时判断的，也就是如果鼠标指针快速经过元素，会被认为是不小心经过，浮层就不会出现。</p>\n<p>想要实现这个交互效果，目前只能使用 transition-delay 属性，请看下面这个具体的案例：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="29518836903206756000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<a href class=&quot;target&quot;>显示图片</a> <img data-src=&quot;1.jpg&quot; />`, `29518836903206756000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>target<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>显示图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>当鼠标指针经过“显示图片”这个链接的时候，浮层图片在鼠标指针停留在元素上一定的时间后才会显示，使用的 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54248762873347610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.target + img {\n   transition-delay: 0.2s;\n   visibility: hidden;\n}\n\n.target:hover + img {\n   visibility: visible;\n}`, `54248762873347610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.target + img</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-delay</span><span class="token punctuation">:</span> 0.2s<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.target:hover + img</span> <span class="token punctuation">{</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时鼠标指针悬停在 <code class="language-text">显示图片</code> 上 200ms 之后浮层图片才会显示，效果如图 5-52 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-66417.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 441px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 72.56235827664399%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADcElEQVQ4y62Ta0zbVRiHm0F0cTG2UC6lt3+bjLmJyfhiom5LjB80qItDTdRs8bKNiYuMjOEHXUxWndAGMhZx0SDoZJNYRwU67KjAuI2bTq4rA9aWi20ZMAbIACnt459CTEbwmyd5c07ec35Pfu8555UEg0FWhn/xHotzd5n/a5rFe9MEl2aZm5mgq6uXxtZuevoGxdxMaG9udprZmWnx7F2WlxZD+hXOSkgCAX8o0Ws5xoU0DfnvP471VALu4p24ihMZPBdPW1Eq9pw36MyN50ZeInmv7CBrbwInk5TYSvJD+sDy8iowuAYcKHuX8hNbKMlQUmOIw/mNmltfqxj4QsUfp5WYU2IpTVNw6Fk5T2llpO+KYd/2cPLPZIf0y8v++4FO62HsJ2VUntLRZNTS/5WOvrMCPUaBrmwBS5qat5+MRR8TycPSCNSKaOSbw8k1mVaB/nUOR64cptkgpdogUGvQcF2E3soXGBChDoMW+zE1P72sovE1DW8lxCCXR7FJsomsz42rb7ARsMMko/OMns48LT0iqP87AU+FDo84N2dq+D5JxQ8vqCh+TklyvILo8DBO/xdwpeS2bBkdX+pxFIjOftTR/akWx8cCo3k6OlK12JLV1L2uoeZVDcan1WgeCsOQvXqH/vV3eLPskFiqlFZR3HtR4MZHAu0xamzbRFdvqkLuCvYoqd2n5uKLKg7siSNCFkau0bj2KOscdpoPUvXJI7QX6ulOE0veoqFIquTAzjje2a7gGWUUu4Uo3kuM5aVHo9krAuM1D2AymjYG9v6cQtO5SLo/3Erfg3qqY7VUHhEwH9FRsENNujqOJ/QKnt+qZJdWwe7HlCikm8nJytkYOFi1n5bPwuiJjMahisScLMWcKmWyUE5LegS/fRDB1aOy0NqaIqXioJzzSRI6zmetfWz//Z1y21FEv+Uow2czmbJl0FCYTsuFdGbbTuC0HGe0PIMxMXzlx/FYMhi9lMnNb1P587rt304JBAJI+J+HxOv1Mb+wwMTkBP6lv8Wmn8HlcjE0NITT6WJszMf4+G18Xi8+nw+3282dyUkxN47X4wmduTM1hUfkuIeGkdRebWB4ZJTW9t+Zn19gaHiESpudy79UUWIupa6+ifrGZixll7nW3EZpmZXq2noar7VwxV7DJUsFdQ1N/FpTh1XU/ANuEnjd33+l7wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 15 29 22" title="" data-src="/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-66417.png" data-srcset="/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-d16fa.png 200w,\n/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-9fd5a.png 400w,\n/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-66417.png 441w" data-sizes="(max-width: 441px) 100vw, 441px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/hnvu1d?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="transition-property-属性"><a href="#transition-property-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition-property 属性</h3>\n<p>transition-property 属性用来设置应用过渡效果的 CSS 属性，其初始值是 all，表示默认所有 CSS 属性都应用过渡效果。</p>\n<p>不知道“初始值是 all”有没有让你意识到什么。我已经记不清有多少次见到过下面的 CSS 代码了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69613774480798550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition: all 0.2s;`, `69613774480798550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition</span><span class="token punctuation">:</span> all 0.2s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>上面这段 CSS 代码的语法和功能都没有问题，表示所有 CSS 属性都执行 0.2s 的过渡效果，那问题在哪里呢？问题就在于其中的 all 完全是多余的，直接写成下面的 CSS 代码就可以了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65860587370557090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition: 0.2s;`, `65860587370557090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition</span><span class="token punctuation">:</span> 0.2s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>也就是我们只需要指定过渡时间就可以了。</p>\n<p>不过不是所有 CSS 属性都支持过渡效果，例如 display 属性就不支持过渡效果，而且，不支持也就罢了，有时候还会“搞破坏”。例如设置了 transition 过渡效果的元素应用 display: none 时，过渡效果会被瞬间中断，导致 transitionend 事件不会被触发。</p>\n<p>因此，如果希望元素有过渡效果，同时可以隐藏，请使用 visibility 属性，visibility 属性在 CSS Transition 过渡效果中很实用，后面会专门对此进行介绍。</p>\n<p>transition-property 支持任意 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型值，不需要是合法的 CSS 属性名称，例如下面语句也是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30700817993931874000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\ntransition-property: 笑脸-©;`, `30700817993931874000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token property">transition-property</span><span class="token punctuation">:</span> 笑脸-©<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是该属性不支持以数字或引号开头的数据类型，关于 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型的深入介绍参见之后章节。</p>\n<p>最后，我们可以同时设置多个参与过渡效果的 CSS 属性，使用逗号分隔，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25839542183360730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition-property: color, background-color, opacity, transform;`, `25839542183360730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition-property</span><span class="token punctuation">:</span> color<span class="token punctuation">,</span> background-color<span class="token punctuation">,</span> opacity<span class="token punctuation">,</span> transform<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>下面讲一下属性值列表的长度不同时的样式计算规则。用一句话概括就是“有缺则补，多之则除”。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98190080667873760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   transition-property: opacity, left, top;\n   transition-duration: 3s, 5s;\n}\n\ndiv {\n   transition-property: opacity, left, top, height;\n   transition-duration: 3s, 5s;\n}`, `98190080667873760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> height<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62701238585467360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   transition-property: opacity, left, top;\n   transition-duration: 3s, 5s, 3s;\n}\n\ndiv {\n   transition-property: opacity, left, top, height;\n   transition-duration: 3s, 5s, 3s, 5s;\n}`, `62701238585467360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">,</span> 3s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> height<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">,</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 transition-property 的属性值列表长度过短，则其他过渡属性多余的列表值会被忽略。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48507701005822026000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   transition-property: opacity, left;\n   transition-duration: 3s, 5s, 2s, 1s;\n}`, `48507701005822026000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">,</span> 2s<span class="token punctuation">,</span> 1s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77400996505572570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   transition-property: opacity, left;\n   transition-duration: 3s, 5s;\n}`, `77400996505572570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>子属性支持逗号分隔，自然 transition 缩写属性也支持逗号分隔多个独立的过渡效果设置。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6910643085554957000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   transition: opacity 0.2s, transform 0.5s;\n}`, `6910643085554957000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> opacity 0.2s<span class="token punctuation">,</span> transform 0.5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="transition-timing-function-属性"><a href="#transition-timing-function-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition-timing-function 属性</h3>\n<p>transition-timing-function 属性通过设置过渡时间函数来影响过渡效果的过渡速率，transition-timing-function 属性和 animation-timing-function 支持的属性值类型一致，总共分为三大类。</p>\n<ul>\n<li>线性运动类型：使用 linear 表示。</li>\n<li>三次贝塞尔时间函数类型：ease、ease-in、ease-out、ease-in-out 等关键字和 cubic-bezier() 函数。</li>\n<li>步进时间函数类型：step-start、step-start 等关键字和 steps() 函数。</li>\n</ul>\n<p>transition-timing-function 属性平常用得很少，因为默认值 ease 就可以应付几乎所有场景了。</p>\n<p>例如我写了 10 多年 CSS 代码，在 CSS Transition 过渡效果中从未使用过线性运动类型和步进时间函数类型（对天发誓一次都没有用过），不过我倒是在 CSS 动画效果中经常用到它们，因此这部分内容会在 5.4 节深入介绍。至于贝塞尔时间函数类型，则偶尔会在 CSS Transition 过渡效果中用到，因此，可以在这里详细介绍一下。</p>\n<h2 id="了解三次贝塞尔时间函数类型"><a href="#%E4%BA%86%E8%A7%A3%E4%B8%89%E6%AC%A1%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解三次贝塞尔时间函数类型</h2>\n<p>“贝塞尔”源于著名的法国工程师 Pierre Bézier 的名字，Pierre Bézier 最杰出的贡献是发明了贝塞尔曲线，奠定了计算机矢量图形学的基础，因为有了贝塞尔曲线之后，无论是直线或曲线都能在数学上予以描述。</p>\n<p>三次贝塞尔时间函数类型写作 <code class="language-text">&lt;cubic-bezier-timing-function&gt;</code>，其正式语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6111136151841779000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<cubic-bezier-timing-function> = ease | ease-in | ease-out | ease-in-out | cubic-bezier(<number>, <number>, <number>, <number>)`, `6111136151841779000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css">&lt;cubic-bezier-timing-function> = ease | ease-in | ease-out | ease-in-out | <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>&lt;number><span class="token punctuation">,</span> &lt;number><span class="token punctuation">,</span> &lt;number><span class="token punctuation">,</span> &lt;number><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，ease、ease-in、ease-out、ease-in-out 这几个关键字是计算机领域通用的运动函数关键字，其贝塞尔函数值是固定的，在其他图形语言中也是适用的，具体分析如下。</p>\n<ul>\n<li>\n<p>ease：等同于 cubic-bezier(0.25, 0.1, 0.25, 1.0)，是 transition-timing-function 属性的默认值，表示过渡的时候先加速再减速。该时间函数曲线如图 5-53 所示，横坐标是时间，纵坐标是进程，曲线越陡速率越快，曲线越缓速率越慢。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-1857e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 448px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 83.92857142857143%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABv0lEQVQ4y51Sa0/CMBTl//8NozEmM8IY88Ujg4kiMSQMmZion4TSbcDeK9vwuAaismniydbc297Tc3rb0maLNE3jJEGgr9yDyRtz3aVtr1arKIqWy6Wu6+12u9frua67o5R2UZIktm2zMDQd99W0PMdBCqamadVqtdFovGTwfT+f7DhOGIZRGMUMm4SbdNPpdBRF8TwPBXw1ydzlK/sZ4A2pqqrdbhdLmCGEgIxgvV7nk8FhjAVBgHQ8HrdaLc60LAviLLMTx3GhbTBRAQuiKIKG1DRNMHF4xL8pc2OI4XY4HCKglMIOtgsy/EGGN1yMLMso5W6hGW6ByULboCHo9/uDwQCCuGSutgP2yldGHb/YmlSbE4LSr5qFynhbGNEYLI80raUquErf84M95JyZk2HSoPRUKtObCTsZ+SkL9viFZMyey+fqbdebLdzHdz8KIP4DP8+cZuAJxNHtz+alaVKAXfG3hv0DpemM4IMfapjYlbcUDmczQuZzahj4MWIVGV74dEoWi4VhWJSaJbEqX9cVlN7dP4CsPz3Xm0pbvb24vD6rSFLtoiJfCeXKZV1pNpVTQTw8Ek4E4Vgon5WlDyJRwvVhonrbAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 13 36" title="" data-src="/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-1857e.png" data-srcset="/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-15195.png 200w,\n/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-82e6d.png 400w,\n/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-1857e.png 448w" data-sizes="(max-width: 448px) 100vw, 448px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>ease-in：等同于 cubic-bezier(0.42, 0, 1.0, 1.0)，表示过渡速度刚开始慢，然后过渡速度逐渐加快。单词 in 表示进入的意思，非常符合先慢后快，例如剑插入剑鞘，线穿进针里，都是先慢慢瞄准，再快速进入的。该时间函数曲线如图 5-54 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-7ace1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 483px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 76.39751552795032%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABTElEQVQoz41Qf0/CMBTk+38ZEv+AZTMoIGUVMIvBsSEmrsA0bBNRxmQ/PWwGNVnFW9I1r3fv7r1aUSLP8zRNCzmSJFm4L4nAqYniMAx3Vdhut+g7Go36us6ZFWLwvqoQx/FqtWo0GriIWc6LUUSiVqvlOI5oWxE7+g0+iGEYlFIQ0EvqLIq5J6Z1XVdV1f1+jyLOf8UGdfMDRVHW6zVWjcqZmbknTghwapqGUbMs42uXOqM3fPAMEr9gSZZl4enYUeqMZ8/z+JLeNxt4WqaJ+nERfzlD7Ps+qHA7pGVMVJ4RY2bGWL1eV5rNpf/6eT/fXTxERRKFu6NYGhtA4yAIcMmKPH4Ls8VHzruWKA5fWYD49CABVn3KVvL4v9bu9MzJ47PDprMn5BuPTXs6my9d2572CL3uEqLftok+GAyHd0af0Eut3bkhOh1cdfVvymlbGaVQRUwAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 18 42" title="" data-src="/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-7ace1.png" data-srcset="/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-7e8e5.png 200w,\n/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-0f3db.png 400w,\n/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-7ace1.png 483w" data-sizes="(max-width: 483px) 100vw, 483px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>ease-out：等同于 cubic-bezier(0, 0, 0.58, 1.0)，表示过渡刚开始速度快，然后速度逐渐变慢。单词 out 表示移出的意思，非常符合先快后慢，例如拔剑是先快后慢。该时间函数曲线如图 5-55 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-28759.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 500px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABc0lEQVQoz41SaW+CQBT0//+LfmzStJVqLJdS75K2pvaiar+QBnBVLkXktCNEQi90Asvj7U5m3ttX2uYQhmEWR3GMtSprdyqJvc3DYNBoNEzTRDJOtoBSnuwkWO/hrFaO55HZnOc4URRlWfY8L3/+GxkE13U3CRBHUTQnhKFpRVGQATNv7V9yyiSE1Go1WF3BguMgf4CcAiKWZTEMo+v6crlMmcgHQXCAnNpmWVZV1UwTjg6QcQJHEfT7fUmS0v6lzHQtsg0dlDoajbrd7q7bCTNDERkbtmWjPTRNG4aR+ndzKLLt+761XvF1fjKZhFGY3dlRysCjcNu+aYEJ/+tfQBU/lfejtsVXPxHNTxLEoe/5f6JIOT+3x6CkaVPbXuJBVVEYuUmtGBJoo22z+cIyMS/2QjcME7/zhb6L8Nq2XSpT1eHT65v0rmhTtLoutIfPL+Pxh3g/aLW7VOWaYXiOFSoVrtfrcELzkro6PSufX1DNTu8L9G1XAoeUOgoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 19 34" title="" data-src="/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-28759.png" data-srcset="/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-6ac48.png 200w,\n/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-4b8bf.png 400w,\n/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-28759.png 500w" data-sizes="(max-width: 500px) 100vw, 500px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>ease-in-out：等同于 cubic-bezier(0.42, 0, 0.58, 1.0)，表示过渡刚开始速度慢，然后速度逐渐加快，最后再变慢。该时间函数曲线如图 5-56 所示。ease-in-out 是一个对称曲线，因此非常适合用在钟摆运动中。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-8163f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 537px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.45996275605214%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABT0lEQVQoz42Si2qDMBSGff83kmy4KvVSpWvHhsiQWsvGYDpdovUe99dUcWO0/VFIDuc7txypn4lz3rYtH9R2HSzqR2Qc3vu6etxsVFUty1K4CX9pDoNkjBUzZXmOKNvt1jCMKIq6IeKkv3CWZeUowEjieZ6u61VV1XV9HRY5j8cjgDiOCSEiIoxX4KlswHBVFCUMQ9hxvRXO8xwF+76PVmEX5K0wikSpsizjiuKn+V2C4Qdv5GmaBjkxKpF2GuElOE1TSik8gAHmHRdV3ApDrutiTnjhsqmLsdv/y57WBcJLmqZ5R8hnEievb7nsFW0157EwfNgwoV+ZxczO4eq2p1V/UVIcf6EZBD9hI4+BDXiTpGly+tHNN6UMH2PZeKYSIUoQhC+uR1mGg2U7u2C/2x98f7d5erbt9ULTrZVj6I7jrFe2pWjL+wdNWxoLdfkDOFchEq0BVhgAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 20 28" title="" data-src="/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-8163f.png" data-srcset="/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-e0dce.png 200w,\n/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-184d7.png 400w,\n/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-8163f.png 537w" data-sizes="(max-width: 537px) 100vw, 537px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ul>\n<h3 id="cubic-bezier-函数"><a href="#cubic-bezier-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cubic-bezier() 函数</h3>\n<p>贝塞尔曲线种类很多，包括线性贝塞尔曲线、二次方贝塞尔曲线、三次方贝塞尔曲线、四次方贝塞尔曲线、五次方贝塞尔曲线等。cubic-bezier() 函数是三次方贝塞尔曲线函数。所有三次方贝塞尔曲线都是由起点、终点和两个控制点组成，在 SVG 或者 Canvas 中，三次方贝塞尔曲线的所有控制点都是不固定的。但是在 CSS 的 cubic-bezier() 函数中，起点和终点的坐标是固定的，分别是 (0, 0) 和 (1, 1)，因此，cubic-bezier() 函数支持的参数值只有 4 个，代表了两个控制点的坐标，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30048761607805810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cubic-bezier(x1, y1, x2, y2);`, `30048761607805810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">cubic-bezier</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中坐标 (x1, y1) 表示控制点 1 的坐标，坐标 (x2, y2) 表示控制点 2 的坐标。</p>\n<p>例如 ease 关键字对应的贝塞尔曲线函数 cubic-bezier(0.25, 0.1, 0.25, 1.0) 的曲线图就是根据 (0.25, 0.1) 和 (0.25, 1.0) 这两个控制点坐标生成的，如图 5-57 所示。</p>\n<p>有一个网站（cubic-bezier）专门用来调试 CSS 的贝塞尔曲线函数值，图 5-57 所示的曲线图就是使用这个网站生成的。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-8682f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 556px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 67.62589928057554%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABlklEQVQoz42S+0/CMBDH+f//I3/wkel0AntJphAC2gFOwOlgfazb2vodiw+iAS/X5nK9T+96vY6BaN3sjBnLMv2+GQxMFJn53Ewme6dQKU1dm0/pfFkKXs7es03vacbSVOR5miR3g4HneevXVzMe6zA0cWwo/brxG67rmgnBpExzKqtqMp3edruEkMVikef5Ll6bfdmHGROcG6VIHLuuW5Yl57woivpHqYdgKWWWZY7jgISBnIBhH4GVUpRS7EEQJElCdwISyY/DyIzQNH3zXI/RnCKnEHhFA6PJh2GQqDl6uJ/Ej1IpUZatcinLA29um8gZWy5fHMsWZCVncfGyLFYrqEjTarM5VrY2ttsfhcOiNxX2pfB9EYZQPhqV+N6/4fb3CMFgZb1e9fxcNxfpZm9Va/UL07v1CaOw9dpkWTOD/5YO5qL9XlxfaY0Obbd5I5QyzjGtm+2WY/I4h1KEMo5zeOHsDIdjMpszymaEuF7geuHZhXVp31g3jusHMC4su+/5J6fn1tX1tXPr+2FwFzlONxqOPwBExh/GtYqV3AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 30 38" title="" data-src="/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-8682f.png" data-srcset="/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-7747b.png 200w,\n/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-f30a5.png 400w,\n/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-8682f.png 556w" data-sizes="(max-width: 556px) 100vw, 556px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在初期的时候，cubic-bezier() 函数值的取值范围是 0 ～ 1，如果超过 1 会被认为是不合法的，不过现在浏览器早已放开了这个限制，因此，我们可以使用 cubic-bezier() 函数实现回弹效果。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89864956295476970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.target {\n   transition: 1s cubic-bezier(0.16, 0.67, 0.28, 1.46);\n}\n\n.target.run {\n   transform: translateX(200px);\n}`, `89864956295476970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.target</span> <span class="token punctuation">{</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> 1s <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.16<span class="token punctuation">,</span> 0.67<span class="token punctuation">,</span> 0.28<span class="token punctuation">,</span> 1.46<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.target.run</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>200px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>.target 元素的运动轨迹如图 5-58 所示，元素会运动到超出 200px 的位置，然后回到 200px 的位置，形成回弹效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-715c5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 658px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.99088145896657%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABL0lEQVQoz42RuU7DQBCG/QrQ8Ez08ABI1KkjngKJAhqoIDQIahqEoCMREjQkXjvEweeydhJfi7MXXid2HCQM/zSrmf+bQ6uIUjwPISZxGJGvuFAURRhjx3EghNLAuViXUqKywKyZ37qanTwyISghtJT4RSXMJEz0T3OzjXZOq0zZmTfCCxMmWXdMgFySGoG/fxke3i8b5Txh9Y4/4foWcwCtrQO0e7aCeePkpa+AeUbnfY/a0wWTXL/A7WN8+1a/SBF/qrDGnZ650U46PZmh7B8wkSZ8p6K9i/TmlQUJT7K1tXmDiPyk6PzJUFrh0YO8hbCqmL8aJxen8QkmzyZHcZVZTdb0oeN5EKE0xaZt+0HgOnl4eU7T3wcq+HBcGE4t1wW5dTjqD1QVaCNjDID+De/1dAyxYZ6HAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 33 28" title="" data-src="/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-715c5.png" data-srcset="/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-c456f.png 200w,\n/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-60786.png 400w,\n/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-715c5.png 658w" data-sizes="(max-width: 658px) 100vw, 658px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>最后，附上其他一些非 CSS 标准，但也属于常用缓动类型的贝塞尔曲线值，为了方便调用，这里使用了 CSS 自定义属性表示，具体如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39942422733116410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`:root {\n   --ease-in-quad: cubic-bezier(0.55, 0.085, 0.68, 0.53);\n   --ease-in-cubic: cubic-bezier(0.55, 0.055, 0.675, 0.19);\n   --ease-in-quart: cubic-bezier(0.895, 0.03, 0.685, 0.22);\n   --ease-in-quint: cubic-bezier(0.755, 0.05, 0.855, 0.06);\n   --ease-in-expo: cubic-bezier(0.95, 0.05, 0.795, 0.035);\n   --ease-in-circ: cubic-bezier(0.6, 0.04, 0.98, 0.335);\n   --ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94);\n   --ease-out-cubic: cubic-bezier(0.215, 0.61, 0.355, 1);\n   --ease-out-quart: cubic-bezier(0.165, 0.84, 0.44, 1);\n   --ease-out-quint: cubic-bezier(0.23, 1, 0.32, 1);\n   --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);\n   --ease-out-circ: cubic-bezier(0.075, 0.82, 0.165, 1);\n   --ease-in-out-quad: cubic-bezier(0.455, 0.03, 0.515, 0.955);\n   --ease-in-out-cubic: cubic-bezier(0.645, 0.045, 0.355, 1);\n   --ease-in-out-quart: cubic-bezier(0.77, 0, 0.175, 1);\n   --ease-in-out-quint: cubic-bezier(0.86, 0, 0.07, 1);\n   --ease-in-out-expo: cubic-bezier(1, 0, 0, 1);\n   --ease-in-out-circ: cubic-bezier(0.785, 0.135, 0.15, 0.86);\n}`, `39942422733116410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">:root</span> <span class="token punctuation">{</span>\n   <span class="token property">--ease-in-quad</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.55<span class="token punctuation">,</span> 0.085<span class="token punctuation">,</span> 0.68<span class="token punctuation">,</span> 0.53<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-cubic</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.55<span class="token punctuation">,</span> 0.055<span class="token punctuation">,</span> 0.675<span class="token punctuation">,</span> 0.19<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-quart</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.895<span class="token punctuation">,</span> 0.03<span class="token punctuation">,</span> 0.685<span class="token punctuation">,</span> 0.22<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-quint</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.755<span class="token punctuation">,</span> 0.05<span class="token punctuation">,</span> 0.855<span class="token punctuation">,</span> 0.06<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-expo</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.95<span class="token punctuation">,</span> 0.05<span class="token punctuation">,</span> 0.795<span class="token punctuation">,</span> 0.035<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-circ</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.6<span class="token punctuation">,</span> 0.04<span class="token punctuation">,</span> 0.98<span class="token punctuation">,</span> 0.335<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-quad</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.25<span class="token punctuation">,</span> 0.46<span class="token punctuation">,</span> 0.45<span class="token punctuation">,</span> 0.94<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-cubic</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.215<span class="token punctuation">,</span> 0.61<span class="token punctuation">,</span> 0.355<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-quart</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.165<span class="token punctuation">,</span> 0.84<span class="token punctuation">,</span> 0.44<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-quint</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.23<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0.32<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-expo</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.19<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0.22<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-circ</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.075<span class="token punctuation">,</span> 0.82<span class="token punctuation">,</span> 0.165<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-quad</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.455<span class="token punctuation">,</span> 0.03<span class="token punctuation">,</span> 0.515<span class="token punctuation">,</span> 0.955<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-cubic</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.645<span class="token punctuation">,</span> 0.045<span class="token punctuation">,</span> 0.355<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-quart</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.77<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.175<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-quint</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.86<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.07<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-expo</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-circ</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.785<span class="token punctuation">,</span> 0.135<span class="token punctuation">,</span> 0.15<span class="token punctuation">,</span> 0.86<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="transition-与-visibility-属性的应用指南"><a href="#transition-%E4%B8%8E-visibility-%E5%B1%9E%E6%80%A7%E7%9A%84%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition 与 visibility 属性的应用指南</h2>\n<p>如果希望元素在出现和隐藏时有淡入淡出或者移入移出效果，则建议使用 visibility 属性对元素进行隐藏与控制。原因很简单，因为 visibility 属性是支持 CSS 过渡效果和 CSS 动画效果的。</p>\n<p>这里举一个移动端经常使用的底部 Popup 浮层的案例，实现遮罩层淡入淡出，底部内容移入移出的效果，HTML 代码结构如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67959149675409040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;popup&quot;>\n   <div class=&quot;content&quot;>底部浮层</div>\n</div>`, `67959149675409040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>popup<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>底部浮层<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>淡入淡出效果是使用 opacity 属性实现的，但是 opacity: 0 仅仅是在视觉上让浮层元素不可见，浮层元素依然覆盖在页面上，影响正常的交互，因此，需要使用其他方法来真正隐藏浮层元素。由于 display: none 不支持过渡效果，因此只能使用 visibility: hidden 声明来实现，核心 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86344964974438990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.popup {\n   position: fixed;\n   left: 0;\n   right: 0;\n   bottom: 0;\n   top: 0;\n   background: rgba(0, 0, 0, 0.5);\n   overflow: hidden;\n   /* 显隐控制关键 css 代码 */\n   opacity: 0;\n   visibility: hidden;\n   transition: opacity 0.2s, visibility 0.2s;\n}\n\n.content {\n   /* 底部浮层移入移出控制关键 css 代码 */\n   transform: translateY(100%);\n   transition: transform 0.2s;\n}\n\n/* 通过切换 “active” 类名实现交互效果 */\n.popup.active {\n   transition-property: opacity;\n   opacity: 1;\n   visibility: visible;\n}\n\n.active > .content {\n   transform: translateY(0%);\n}`, `86344964974438990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.popup</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token comment">/* 显隐控制关键 css 代码 */</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> opacity 0.2s<span class="token punctuation">,</span> visibility 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.content</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* 底部浮层移入移出控制关键 css 代码 */</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>100%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> transform 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* 通过切换 “active” 类名实现交互效果 */</span>\n<span class="token selector">.popup.active</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">;</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.active > .content</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>0%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>淡入淡出和移入移出没什么好讲的，就是属性的变化，这里比较有意思的是 visibility 对元素显隐的控制。根据定义，当过渡时间函数的值在 0 ～ 1 的时候，visibility 的计算值是 visible，也就是显示；如果时间函数大于 1 或者小于 0，则 visibility 属性的计算值由设置的起止点值决定，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36966473497007194000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.popup {\n   visibility: hidden;\n   transition: visibility 2s cubic-bezier(0.25, 0.5, 0, -1);\n}\n\n.popup.active {\n   visibility: visible;\n}`, `36966473497007194000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.popup</span> <span class="token punctuation">{</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> visibility 2s <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.25<span class="token punctuation">,</span> 0.5<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> -1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.popup.active</span> <span class="token punctuation">{</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，.popup 元素会出现先显示，再隐藏，再显示的过渡效果。因为 <code class="language-text">cubic-bezier(0.25, 0.5, 0, -1)</code> 时间函数曲线的一部分在时间轴的下方，这段时间内会按照设置的过渡效果的起始状态，也就是 visibility: hidden 渲染，如图 5-59 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-f1168.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 796px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.321608040201%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAtUlEQVQY05WQXwuCMBTF/f6fKMjSlLQ5zELKIp+KiaDsIaOx/y2rl5hkh8HutvO7h11HD0hKSSklhDRNM+Rxhh6ElOR6r+saY2yOSqlR8Mt36zp0KiuEGOd/J0vO8eVM21bbMn/AT54xTYgWYiysepmCCcF67HOhv35uaqffLF25UmZmRtaJvJMBhMWxRKja5jvfC92ZP50vwmiVJGm4jPbFIYhBFIN0nQFoFsw2uesFxjZxvQfAJ87Z028zJwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 17 47 20" title="" data-src="/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-f1168.png" data-srcset="/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-ad772.png 200w,\n/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-4f4c3.png 400w,\n/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-f1168.png 796w" data-sizes="(max-width: 796px) 100vw, 796px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由于在实际开发中时间函数的值小于 0 的情况很罕见，因此，我们可以认定 visibility 属性的过渡效果是显示的时候立即显示，隐藏的时候遵循 transition-duration 设置的时间延时隐藏。于是理论上，我们只需要一行 transition 属性代码就可以实现想要的效果，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23897782064412690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.popup {\n   opacity: 0;\n   visibility: hidden;\n   /* transition 如下设置即可 */\n   transition: opacity 0.2s, visibility 0.2s;\n}\n\n.popup.active {\n   opacity: 1;\n   visibility: visible;\n}`, `23897782064412690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.popup</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token comment">/* transition 如下设置即可 */</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> opacity 0.2s<span class="token punctuation">,</span> visibility 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.popup.active</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，不知道是浏览器故意为之还是其他什么原因，在过去的 Chrome 浏览器和现在的 Firefox 浏览器中，通过类名增减触发 transition 过渡效果的时候，元素是在 transition-duration 设置的时间结束的时候才突然显示，而通过 :hover 伪类触发的过渡行为则没有此问题。</p>\n<p>因此，在实际开发的时候，为了安全考虑，需要在触发结束状态的 CSS 代码那里重置下 transition-property 值，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49815104877918070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.popup.active {\n   /* visibility 属性不参与过渡效果，因此元素会立即显示 */\n   transition-property: opacity;\n   opacity: 1;\n   visibility: visible;\n}`, `49815104877918070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.popup.active</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* visibility 属性不参与过渡效果，因此元素会立即显示 */</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">;</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>点击演示页面中心的按钮即可体验，效果如图 5-60 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-effe6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 421px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 85.03562945368171%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB5klEQVQ4y5WQ3WvTUBjG87cJ3viBiOiFsgt10AvbtN1Jcprs5CRFUObUKW4mYVQG4tQEBFH2gZu2xLUUhsPhzZq7ki4fqwPXSZNiMw8pjurFUn8cXs457/vwPOdQR0NEUUTqu6WPd6aVmdln9x+Xph7O33tUuj31dOHFm+OBY6jhQ7/fJ/XBk9LpC2MXr6bOXxk/e3n8zKXrp85dm5i8Gw8kiReeL95I3cqzfI7h86yQBfBmKjM9MzuSs67rEEKMMcMwAACERAgLiqIkiAc9wzB4nkcIZTKZdDpN9oIgaJo2kvPiy1d0No+QPIkkFC8AuLk5ZdTYYALIskySY1GSJJmYq2qycxSLjVyO46DAQshBHkCGztKaqo3obNA0+TBZFLGIkYgxy7KqqiaJ455uGCwHi8WiFEPy/8eH6a91Js/IUvxmjIm+UCgkOw96ruM2vjWshrXT2CFYlkVqs9lMEP9DGIZBEJwwQJGog6dGMYPww/z6s4n+hlyc5JwIZdv2ruP1ej3H9YKwRxw6ncNutxsE4Y+Dg13HJcv329/b+67ne96e3Wq5/p7n+XbLoZZXV8pmzbZby6trncOf++32h/XK1va2uVGtb26WKxvkvmJWv2x9Nat183Pt7ful9U+VWrW+slb+DYziYXDRq6yqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 17 54 04" title="" data-src="/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-effe6.png" data-srcset="/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-94cd7.png 200w,\n/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-851bf.png 400w,\n/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-effe6.png 421w" data-sizes="(max-width: 421px) 100vw, 421px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/821nfn?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="css-动画"><a href="#css-%E5%8A%A8%E7%94%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 动画</h1>\n<p>本节深入介绍 CSS 动画相关知识，知识量较大，但都很重要，相信大家一定可以学到很多东西。</p>\n<p>先从常用的淡出动画效果说起：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79440599301011210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.fade-in {\n   animation: fadeIn 0.25s;\n}\n\n@keyframes fadeIn {\n   from {\n      opacity: 0;\n   }\n\n   to {\n      opacity: 1;\n   }\n}`, `79440599301011210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.fade-in</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.25s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面逐一分析上述代码中的项。</p>\n<ul>\n<li>fadeIn 是开发者自己定义的动画名称，命名限制不多，具体命名规则在下面有介绍。</li>\n<li>.25s 是 0.25s 的简写，表示动画执行的时间。</li>\n<li>animation 是调用自定义动画规则的 CSS 属性。</li>\n<li>@keyframes 规则用来定义动画的关键帧。</li>\n</ul>\n<p>一个 CSS 动画效果要想出现，动画名称、动画时间、animation 属性和 @keyframes 规则是必不可少的基本单元。CSS 动画自然还包括其他特性，例如动画次数、动画顺序的控制等，但是这些特性不是必需的，因此，单从入门和上手这个角度看，CSS 动画算是简单的。但是，上手简单并不代表 CSS 动画是简单的，随着本节学习内容的逐渐深入，你一定会发现 CSS 动画可以做的事情远远超出了你的想象。下面就先从最基本的 animation 属性说起。</p>\n<h2 id="初识-animation-属性"><a href="#%E5%88%9D%E8%AF%86-animation-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>初识 animation 属性</h2>\n<p>animation 属性是多个 CSS 属性的缩写，这些属性包括 animation-name、animation-duration、animation-timing-function、animation-delay、animation-iteration-count、animation-direction、animation-fill-mode 和 animation-play-state。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7807763411967161000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* animation: name | duration | timing-function | delay | iteration-count | direction | fill-mode | play-state */\nanimation: fadeIn 3s ease-in 1s 2 reverse both paused;`, `7807763411967161000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* animation: name | duration | timing-function | delay | iteration-count | direction | fill-mode | play-state */</span>\n<span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 3s ease-in 1s 2 reverse both paused<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>animation 属性支持同时应用多个动画规则，例如实现元素淡出和右侧划入同时进行的动画效果。正确做法是分隔设置，而不是设置在一个动画规则中，也就是不推荐使用下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71309571788107596000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: fadeInSlideInRight 0.2s;\n}\n\n@keyframes fadeInSlideInRight {\n   from {\n      opacity: 0;\n      transform: translateX(100%);\n   }\n\n   to {\n      opacity: 1;\n      transform: translateX(0%);\n   }\n}`, `71309571788107596000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeInSlideInRight 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeInSlideInRight</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>100%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而是推荐将代码分隔成多个独立的动画规则，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19465094324127530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: fadeIn 0.2s, slideInRight 0.2s;\n}\n\n@keyframes fadeIn {\n   from {\n      opacity: 0;\n   }\n\n   to {\n      opacity: 1;\n   }\n}\n\n@keyframes slideInRight {\n   from {\n      transform: translateX(100%);\n   }\n\n   to {\n      transform: translateX(0%);\n   }\n}`, `19465094324127530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.2s<span class="token punctuation">,</span> slideInRight 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> slideInRight</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>100%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样做的好处在于我们自定义的动画规则可以在其他场合重复利用，例如希望弹框在出现的时候有淡出动画效果，并且我们无须再额外定义淡出动画规则，直接复用即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89278239359530020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dialog {\n   animation: fadeIn 0.2s;\n}`, `89278239359530020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">dialog</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h2 id="keyframes-规则的语法和特性"><a href="#keyframes-%E8%A7%84%E5%88%99%E7%9A%84%E8%AF%AD%E6%B3%95%E5%92%8C%E7%89%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>@keyframes 规则的语法和特性</h2>\n<p>首先 @keyframes 的后面有个“s”，因为动画效果不可能只有 1 个关键帧。@keyframes 规则的语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92507371072424440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes <keyframes-name> {\n   <keyframe-block-list>\n}`, `92507371072424440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> &lt;keyframes-name></span> <span class="token punctuation">{</span>\n   &lt;keyframe-block-list>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>其中 <code class="language-text">&lt;keyframe-block-list&gt;</code> 指的是定义的关键帧列表，每个关键帧由关键帧选择器和对应的 CSS 样式组成。</p>\n<p>关键帧选择器用来指定当前关键帧在整个动画过程中的位置，其支持 from、to 这两个关键字和百分比值。from 关键字等同于 0%，to 关键字等同于 100%。</p>\n<p>也就是说，下面两段 CSS 代码的作用是一样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79889405953675660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes fadeIn {\n   from {\n      opacity: 0;\n   }\n\n   to {\n      opacity: 1;\n   }\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `79889405953675660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面讲一下 @keyframes 规则中你可能不知道的一些特性。</p>\n<h3 id="起止关键帧可以不设置"><a href="#%E8%B5%B7%E6%AD%A2%E5%85%B3%E9%94%AE%E5%B8%A7%E5%8F%AF%E4%BB%A5%E4%B8%8D%E8%AE%BE%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>起止关键帧可以不设置</h3>\n<p>例如定义淡出效果，可以这样设置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36729961726985884000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes fadeInBy {\n   100% {\n      opacity: 1;\n   }\n}`, `36729961726985884000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> fadeInBy</span> <span class="token punctuation">{</span>\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时动画初始状态的透明度就是当前元素的透明度，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68619014246614850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n}\n\n.element.active {\n   animation: fadeInBy 0.2s;\n}`, `68619014246614850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.element.active</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeInBy 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>.element 元素在匹配 .active 类名之后会有透明度从 0.5（初始状态的透明度）变化到透明度 1 的效果。</p>\n<p>但是，这种做法在实际开发的时候并不常见，因为通常会使用更加方便快捷的 transition 属性实现类似的效果。</p>\n<h3 id="关键帧列表可以合并"><a href="#%E5%85%B3%E9%94%AE%E5%B8%A7%E5%88%97%E8%A1%A8%E5%8F%AF%E4%BB%A5%E5%90%88%E5%B9%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关键帧列表可以合并</h3>\n<p>如果关键帧对应的 CSS 样式是一样的，则可以合并在一起书写，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65505932613111730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes blink {\n   0%,\n   50%,\n   100% {\n      opacity: 0;\n   }\n\n   25%,\n   75% {\n      opacity: 1;\n   }\n}`, `65505932613111730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> blink</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%,\n   50%,\n   100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">25%,\n   75%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="不同的关键帧选择器是无序的"><a href="#%E4%B8%8D%E5%90%8C%E7%9A%84%E5%85%B3%E9%94%AE%E5%B8%A7%E9%80%89%E6%8B%A9%E5%99%A8%E6%98%AF%E6%97%A0%E5%BA%8F%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不同的关键帧选择器是无序的</h3>\n<p>虽然动画的执行是有顺序的，从 0% 到 100%，但是在代码层面，不同的关键帧选择器是不分先后顺序的。例如，下面两段 CSS 的效果是一样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3863228154824294400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}\n\n@keyframes fadeIn {\n   100% {\n      opacity: 1;\n   }\n\n   0% {\n      opacity: 0;\n   }\n}`, `3863228154824294400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="重复定义的关键帧不是完全被覆盖的"><a href="#%E9%87%8D%E5%A4%8D%E5%AE%9A%E4%B9%89%E7%9A%84%E5%85%B3%E9%94%AE%E5%B8%A7%E4%B8%8D%E6%98%AF%E5%AE%8C%E5%85%A8%E8%A2%AB%E8%A6%86%E7%9B%96%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重复定义的关键帧不是完全被覆盖的</h3>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50229261986267720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes identifier {\n   50% {\n      top: 30px;\n      left: 20px;\n   }\n\n   50% {\n      top: 10px;\n   }\n}`, `50229261986267720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> identifier</span> <span class="token punctuation">{</span>\n   <span class="token selector">50%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">50%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最终在 50% 这一帧用来动画的 CSS 样式是 top: 10px 和 left: 20px。也就是说，如果关键帧重复定义，则不同的 CSS 样式是累加的，而相同的 CSS 样式是后面的样式覆盖前面的样式，和普通的 CSS 选择器的样式计算规则一致。</p>\n<h3 id="关键帧中的样式可以不连续"><a href="#%E5%85%B3%E9%94%AE%E5%B8%A7%E4%B8%AD%E7%9A%84%E6%A0%B7%E5%BC%8F%E5%8F%AF%E4%BB%A5%E4%B8%8D%E8%BF%9E%E7%BB%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关键帧中的样式可以不连续</h3>\n<p>前后关键帧的 CSS 属性无须保持一致，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91226750959738160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes identifier {\n   0% {\n      top: 0;\n      left: 0;\n   }\n\n   30% {\n      top: 50px;\n   }\n\n   60%,\n   90% {\n      left: 50px;\n   }\n\n   100% {\n      top: 100px;\n      left: 100%;\n   }\n}`, `91226750959738160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> identifier</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">30%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">60%,\n   90%</span> <span class="token punctuation">{</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里，top 属性应用动画的帧是 0%、30% 和 100%，left 属性应用动画的帧是 0%、60%、90% 和 100%。</p>\n<h3 id="important-无效"><a href="#important-%E6%97%A0%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>!important 无效</h3>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36133804078874810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes identifier {\n   0% {\n      top: 30px;\n      /* 无效 */\n      left: 20px !important;\n   }\n\n   100% {\n      top: 10px;\n   }\n}`, `36133804078874810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> identifier</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n      <span class="token comment">/* 无效 */</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 20px <span class="token important">!important</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中 left: 20px 这句 CSS 声明是没有任何效果的。其实，根本就没有必要在 @keyframes 规则语句中使用 !important 提高权重，因为当 CSS 动画执行的时候，关键帧中定义的 CSS 优先级就是最高的。</p>\n<h3 id="优先级最高"><a href="#%E4%BC%98%E5%85%88%E7%BA%A7%E6%9C%80%E9%AB%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优先级最高</h3>\n<p>请看下面这个例子：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="44559133104269130000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<img data-src=&quot;1.jpg&quot; style=&quot;opacity: 0.5;&quot; />\n<style>\n   img {\n      animation: fadeIn 1s;\n   }\n\n   @keyframes fadeIn {\n      0% {\n         opacity: 0;\n      }\n\n      100% {\n         opacity: 1;\n      }\n   }\n</style>`, `44559133104269130000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">img</span> <span class="token punctuation">{</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n      <span class="token selector">0%</span> <span class="token punctuation">{</span>\n         <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token selector">100%</span> <span class="token punctuation">{</span>\n         <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">&lt;img&gt;</code> 元素出现了透明度从 0 到 1 的动画效果，这就表明 @keyframes 规则中的 CSS 优先级要比 style 属性设置的 CSS 属性的优先级要高。接下来我们更进一步，使用 CSS 世界中优先级最高的 !important 语法：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="21585246608437813000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<img data-src=&quot;1.jpg&quot; style=&quot;opacity: 0.5!important&quot; />`, `21585246608437813000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token important">!important</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>结果是 Chrome 浏览器、IE 浏览器、Edge 浏览器和 Safari 浏览器均出现了透明度动画效果，只有 Firefox 浏览器中的 <code class="language-text">&lt;img&gt;</code> 元素一直保持 0.5 的透明度。这表明在 Firefox 浏览器中，@keyframes 规则中的 CSS 优先级大于 style 设置的 CSS 属性，小于 !important 语法中的 CSS 属性，而其他所有浏览器 @keyframes 规则中的 CSS 优先级最高。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/0dpt35?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>根据以往的经验，规范中没有定义到的特性会随着浏览器版本的升级而进行调整，因此说不定过几年 Firefox 浏览器也会把 @keyframes 规则中的 CSS 优先级调至最高。</p>\n<p>@keyframes 规则优先级最高的这个特性为重置页面中第三方 JavaScript 设置的内联样式提供了一种新的思路。不过，此方法也有局限，就是不支持动画的 CSS 属性是无法重置的，例如我们无法在 @keyframes 规则中设置 display: block 去重置 display: none，因此对于 Adblock 这类去广告插件还是无解。</p>\n<h2 id="动画命名与-custom-ident-数据类型"><a href="#%E5%8A%A8%E7%94%BB%E5%91%BD%E5%90%8D%E4%B8%8E-custom-ident-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动画命名与 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型</h2>\n<p>按照规范，动画的名称可以是下面两种数据类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85428344978245070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<custom-ident> | <string>`, `85428344978245070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css">&lt;custom-ident> | &lt;string></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，<code class="language-text">&lt;string&gt;</code> 数据类型表示需要带引号的字符串，例如，下面 CSS 代码中的 <code class="language-text">&#39;...&#39;</code> 和 <code class="language-text">&#39;Microsoft Yahei&#39;</code> 就是 <code class="language-text">&lt;string&gt;</code> 数据类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86148205711849340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`content: \'...\';\nfont-family: \'Microsoft Yahei\';`, `86148205711849340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'...\'</span><span class="token punctuation">;</span>\n<span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'Microsoft Yahei\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>因此，理论上 CSS 动画也是支持使用引号命名的动画效果的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46125823395610980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: \'hello world\' 2s;\n}\n\n@keyframes \'hello world\' {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `46125823395610980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> <span class="token string">\'hello world\'</span> 2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> <span class="token string">\'hello world\'</span></span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际测试下来，仅 Firefox 浏览器支持 <code class="language-text">&lt;string&gt;</code> 数据类型的 CSS 动画名称，Chrome 浏览器和 IE 浏览器均认为这是不合法的语法。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/20bshq?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>因此，我们的注意力还是放在兼容性更好的 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型上。CSS 中可以自定义的名称均是 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型，例如 counter-reset 和 counter-increment 属性中自定义的计数器，CSS 网格布局中对行和列的命名等。故 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型是一学百用的。</p>\n<h3 id="custom-ident-数据类型语法"><a href="#custom-ident-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">&lt;custom-ident&gt;</code> 数据类型语法</h3>\n<p><code class="language-text">&lt;custom-ident&gt;</code> 数据类型的语法和 CSS 的标识符（例如，CSS 属性就属于 CSS 标识符）很相似，区别就在于 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型是区分大小写的。<code class="language-text">&lt;custom-ident&gt;</code> 数据类型可以由下面这些字符进行组合：</p>\n<ul>\n<li>任意字母（a ～ z 或 A ～ Z）；</li>\n<li>数字（0 ～ 9）；</li>\n<li>短横线（-）；</li>\n<li>下划线（_）；</li>\n<li>转义字符（使用反斜杠 \\ 转义）；</li>\n<li>Unicode 字符（反斜杠 \\ 后面跟十六进制数字）。</li>\n</ul>\n<p>由于 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型区分大小写，因此 id1、Id1、ID1 和 iD1 是不同的名称。而一些看起来差异很大的名称却是相同的，例如，☺ 和 \\263a 其实是相同的，因此，下面 CSS 代码中的 CSS 动画是可以执行的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16895061068773298000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: ☺ 2s;\n}\n\n@keyframes \\263a {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `16895061068773298000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> ☺ 2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> \\263a</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面通过案例说一说 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型的合法性。</p>\n<ol>\n<li>\n<p>不能是 CSS 属性本身支持的关键字，例如 animation 属性支持关键字 none，也支持全局关键字 unset、initial 和 inherit。因此，在 CSS 动画中，不能把动画名称定义为 none、unset、initial 或 inherit。</p>\n</li>\n<li>\n<p>不能以十进制数字开头。例如，下面的名称就是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58213935473794834000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\n2333fadeIn`, `58213935473794834000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 不合法 */</span>\n<span class="token number">2333</span>fadeIn</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>可以使用短横线作为开头，但是短横线后面不能是十进制数字，也就是说，下面的名称是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57232641081660420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\n-fadeIn;`, `57232641081660420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 合法 */</span>\n<span class="token operator">-</span>fadeIn<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>而下面这个名称就不合法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39493949386472640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\n-2333fadeIn`, `39493949386472640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 不合法 */</span>\n<span class="token operator">-</span><span class="token number">2333</span>fadeIn</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>除短横线和下划线之外的英文标点字符（包括空格）都需要转义。例如，下面的名称是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68775407782759570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nexample\\.png\nhello\\ world`, `68775407782759570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 合法 */</span>\nexample\\<span class="token punctuation">.</span>png\nhello\\ world</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>而下面这个名称就不合法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60091165346721900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nexample.png\nhello world`, `60091165346721900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 不合法 */</span>\nexample<span class="token punctuation">.</span>png\nhello world</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>连续短横线开头的名称在 MDN 文档中被认为是不合法的，但是根据我的测试，除了 IE 浏览器不支持，其他浏览器都认为连续短横线的动画名称是合法的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30792753434000163000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 除 IE 浏览器外均合法，即使和 CSS 自定义属性名称一致 */\n.element {\n  --fadeIn: 2;\n  animation: --fadeIn 2s;\n}\n\n@keyframes --fadeIn {\n  0% {\n     opacity: 0;\n  }\n\n  100% {\n     opacity: 1;\n  }\n}`, `30792753434000163000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 除 IE 浏览器外均合法，即使和 CSS 自定义属性名称一致 */</span>\n<span class="token selector">.element</span> <span class="token punctuation">{</span>\n  <span class="token property">--fadeIn</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n  <span class="token property">animation</span><span class="token punctuation">:</span> --fadeIn 2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> --fadeIn</span> <span class="token punctuation">{</span>\n  <span class="token selector">0%</span> <span class="token punctuation">{</span>\n     <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">100%</span> <span class="token punctuation">{</span>\n     <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因此，我认为连续短横线开头的名称是合法的。</p>\n</li>\n<li>\n<p>如果是 Unicode 编码转义字符，记得在后面添加一个空格，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93109026670906200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\n\\233 haha`, `93109026670906200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n\\233 haha</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h2 id="负延时与即时播放效果"><a href="#%E8%B4%9F%E5%BB%B6%E6%97%B6%E4%B8%8E%E5%8D%B3%E6%97%B6%E6%92%AD%E6%94%BE%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>负延时与即时播放效果</h2>\n<p>animation-delay 可以让动画延时播放，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66559506118324265000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation-delay: 300ms;`, `66559506118324265000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation-delay</span><span class="token punctuation">:</span> 300ms<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示动画延时 300ms 播放。</p>\n<p>需要注意的是，如果动画是无限循环的，设置的延时不会跟着循环，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80649865389831030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.loading {\n   animation: spin 1s infinite;\n   animation-delay: 300ms;\n}\n\n@keyframes spin {\n   0% {\n      transform: rotate(0deg);\n   }\n\n   100% {\n      transform: rotate(360deg);\n   }\n}`, `80649865389831030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s infinite<span class="token punctuation">;</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> 300ms<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时 .loading 元素会在延时 300ms 后不断旋转，而不是在延时 300ms 后旋转一圈，再在延时 300ms 后旋转一圈，不断循环。</p>\n<p>想要实现每次动画循环都有延时效果，常用的方法是在自定义动画关键帧处进行设置，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="211788708856874850"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.loading {\n   animation: spin 1s infinite;\n}\n\n@keyframes spin {\n   0%,\n   30% {\n      transform: rotate(0deg);\n   }\n\n   100% {\n      transform: rotate(360deg);\n   }\n}`, `211788708856874850`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%,\n   30%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>animation-delay 属性比较经典的应用就是通过设置负值让动画即时播放，播放的位置为动画中间的某一阶段。</p>\n<p>举一个音频波形动画的案例，实现图 5-61 所示的效果，可以用来表示音频文件处于加载态或者播放态。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-45fc4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 522px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.4176245210728%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB70lEQVQoz42S304TQRTGJ9ELJRETrgg+gRpCBK6Ib8FLkJiIBjXRxHtfwIRwwYXSSiu2UhBITKGsQem2JoSi2BZKiOXfbrHtzG63hd1+znEr2NCanmwmc/bM75w5Zz7mVCHth4mbUaRKWBcI5XBmMmhX0cyYT4PKCWaL2LHwKI3bUQqUHZw2x2RJmZTd+oLhJLIVsCWCn2yhN0bh/jgCOvYreJmty/JvQtYTw4M0suUa/HgLd2J0oi0CzyGCGi4vwnBw4sByCHC7mNLwLAPWrWK4EXxdweQRQjraFEhqcINC0tYErfeS6FCaw+0K3hxhWseVZXLvfiVAdsHCNNfnGdz43AJ8dZkqD8QxtIn8KUUPKni6ja6V1iqfVPFiF+P7dGHLpvV+Cp0S7lEbD+zaH3g2R1lM53zOri4SBhaO/z7Vz7On2kZfvFZ5dI/OfTdrwMVXZ0NJjO0hY9XgkRRkOmmfCnSdhsy5SNysawYuRUhn3kM8TNdJornMwNyYYWOlAGHX9Vb9D+fCF0XXujFN0zkXtm2bJct2HLnhnBc5LxSLRS5MsyQ/LoR0hTDkv1/5vGEa0i2XK8zj9YfDkfXEt+iqyo3ScU5/5fG9C868DUzPzM5/WPgYXlKCobkJr1/ufFPvA8HQqhp77fUnNjZ/A5chSyDyMFyYAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 00 29 19" title="" data-src="/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-45fc4.png" data-srcset="/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-31b3a.png 200w,\n/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-60bb2.png 400w,\n/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-45fc4.png 522w" data-sizes="(max-width: 522px) 100vw, 522px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>音频波形由一个一个的矩形组成，每一个矩形都会有垂直缩放的动画效果。想要形成此起彼伏的波形运动效果，最好的方法就是给每一个矩形的动画设置延时，例如（这里使用 4 个矩形示意）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79615931017524580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;loading&quot;>\n   <i></i>\n   <i></i>\n   <i></i>\n   <i></i>\n</div>\n<style>\n   .loading i {\n      display: inline-block;\n      border-left: 2px solid deepskyblue;\n      height: 2px;\n      animation: scaleUp 4s linear infinite alternate;\n      margin: 0 1px;\n   }\n\n   .loading i:nth-child(2) {\n      animation-delay: 1s;\n   }\n\n   .loading i:nth-child(3) {\n      animation-delay: 2s;\n   }\n\n   .loading i:nth-child(4) {\n      animation-delay: 3s;\n   }\n\n   @keyframes scaleUp {\n      to {\n         transform: scaleY(10);\n      }\n   }\n</style>`, `79615931017524580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.loading i</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n      <span class="token property">border-left</span><span class="token punctuation">:</span> 2px solid deepskyblue<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> scaleUp 4s linear infinite alternate<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0 1px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.loading i:nth-child(2)</span> <span class="token punctuation">{</span>\n      <span class="token property">animation-delay</span><span class="token punctuation">:</span> 1s<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.loading i:nth-child(3)</span> <span class="token punctuation">{</span>\n      <span class="token property">animation-delay</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.loading i:nth-child(4)</span> <span class="token punctuation">{</span>\n      <span class="token property">animation-delay</span><span class="token punctuation">:</span> 3s<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@keyframes</span> scaleUp</span> <span class="token punctuation">{</span>\n      <span class="token selector">to</span> <span class="token punctuation">{</span>\n         <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>10<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然而，真正运行的时候却发现一个比较严重的问题，由于设置了延时，动画开始执行的时候，后面的矩形都是默认的高度，如图 5-62 所示。这显然不符合预期，矩形的初始高度应该参差不齐才对。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-ba470.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 649px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 67.64252696456087%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABjklEQVQoz42Se0vCUBTA/d4RQR+k/jGhxAiiUvOBEBVWVKAOndbS3O5ed8tlbvfZvXO+yKzL4XDO2f3tvG6KcyaFUc457msEGEhpkuFAaNRRUKuB1DYBQ6y90GCEX3tCs3EQPT9S10otw8S2iG3Kex4kgzc8HAgREepD6nvsMxAGw4ihCPVUAp0ZnMj8iN9Jl7oO7qpxYPlrclZhmT/WlEjS8yaVsqgzhunPmynG2GrypAVR+aRcFKWuIWeSWhNlNLq+CqsV+uFvICU8inDckHTYdGzA8La3ULMhSVk/+xXOKbYEGF/MLPziDuAUb8iZwMeKYwTRTq0fEnrUcg4a1oSy3VtThZN4xhvhbMv2Q7z3ZCJKq5p/+eKHhOw/gsFH+Dec70LZWlL2bMnTzTIaTyEx5vYCZuu2/88jVsXFa9O0/ij4hJ4fhhHB2IHQMIBuAMuyx+OxrgMATMd1hWua9grsQTedyaq913r93nE9XX/PnZyeXRRLldrd/YPS7uTz5XTm8LxQur65vSiU5vA3ysgiwQEEb/oAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 00 35 12" title="" data-src="/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-ba470.png" data-srcset="/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-47540.png 200w,\n/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-ee316.png 400w,\n/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-ba470.png 649w" data-sizes="(max-width: 649px) 100vw, 649px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>要解决这个问题其实很简单，只要把延时的时间全部换成负数即可，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70204321659641950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.negative i:nth-child(2) {\n   animation-delay: -1s;\n}\n\n.negative i:nth-child(3) {\n   animation-delay: -2s;\n}\n\n.negative i:nth-child(4) {\n   animation-delay: -3s;\n}`, `70204321659641950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.negative i:nth-child(2)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -1s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.negative i:nth-child(3)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.negative i:nth-child(4)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -3s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样既保留了各个元素动画的时间差，又实现了动画效果的立即播放，且不会带来各个矩形初始状态尺寸相同的问题。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/q6crqc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="准确理解-animation-delay-负值"><a href="#%E5%87%86%E7%A1%AE%E7%90%86%E8%A7%A3-animation-delay-%E8%B4%9F%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>准确理解 animation-delay 负值</h3>\n<p>提个问题，下面代码的透明度变化是 0.75→1 还是 0.25→1？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17485076825557156000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`element {\n   animation: fadeIn 1s linear -0.25s;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `17485076825557156000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s linear -0.25s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>相信很多人都会搞错，因为容易受 JavaScript 中 splice() 或者 slice() 函数负值的作用误导。</p>\n<p>在很多语言中，负值表示序列的序号前移，或者时间线往前，于是，很多人就认为 animation-delay: -.25s 就是在整个播放时间线上往前移动 0.25s，因此透明度变化应该是 0.75→1。但实际上并不是这样，其实透明度变化是 0.25→1。</p>\n<p>以上变化其实不难理解，关键点就是理解何为“延时”，例如 animation-delay: 0.25s 表示动画在 0.25s 之后从 0% 开始播放，那 animation-delay: -0.25s 显然就表示在 0.25s 之前就已经从 0% 开始播放，即动画真正播放的时候动画已经执行了 0.25s，因此，我们可见的变化就是 0.25→1 这段过程。</p>\n<h2 id="reverse-和-alternate-关键字的区别和应用"><a href="#reverse-%E5%92%8C-alternate-%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>reverse 和 alternate 关键字的区别和应用</h2>\n<p>animation-direction 属性可以用来控制动画的方向，其本质上是通过控制 @keyframes 规则中定义的动画关键帧执行的方向来实现的。该属性语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59566347373247020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation-direction: normal; /* 初始值 */\nanimation-direction: reverse;\nanimation-direction: alternate;\nanimation-direction: alternate-reverse;`, `59566347373247020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation-direction</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span> <span class="token comment">/* 初始值 */</span>\n<span class="token property">animation-direction</span><span class="token punctuation">:</span> reverse<span class="token punctuation">;</span>\n<span class="token property">animation-direction</span><span class="token punctuation">:</span> alternate<span class="token punctuation">;</span>\n<span class="token property">animation-direction</span><span class="token punctuation">:</span> alternate-reverse<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，reverse 和 alternate 这两个关键字都有“相反”的意思，不同之处在于，reverse 关键字是让每一轮动画执行的方向相反，而 alternate 关键字是让下一轮动画的执行方向和上一轮动画的执行方向相反。</p>\n<p>举个例子，实现一个常见的淡入淡出动画效果，这里设置动画播放 2 次：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58336033229692630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   /* fadeIn 动画执行 2 次 */\n   animation: fadeIn 1s 2;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `58336033229692630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* fadeIn 动画执行 2 次 */</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s 2<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>先讲一下这一语法中的几个关键点。</p>\n<ul>\n<li>animation-direction 属性值如果是 normal，那么动画执行的方向是 0%→100%、0%→100%，每一轮的动画方向都是正常的。</li>\n<li>animation-direction 属性值如果是 reverse，那么动画执行的方向是 100%→0%、100%→0%，每一轮的动画方向都是相反的。</li>\n<li>animation-direction 属性值如果是 alternate，那么动画执行的方向是 0%→100%、100%→0%，每 2n + 1 轮的动画方向是相反的。</li>\n<li>animation-direction 属性值如果是 alternate-reverse，那么动画执行的方向是 100%→0%，0%→100%，每 2n 轮的动画方向是相反的。</li>\n</ul>\n<p>由此可见，reverse 和 alternate 关键字的区别是让动画反向播放的轮数不同。从效果表现来看，alternate 关键字的动画效果表现为来回交替播放，这也是为什么 alternate 关键字要被命名为 “alternate”（交替的、来回的）。</p>\n<h3 id="reverse-关键字的应用场景"><a href="#reverse-%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>reverse 关键字的应用场景</h3>\n<p>我有个朋友以前做过一件很傻的事情，就是在一个项目中，有的图形需要顺时针旋转，有的图形需要逆时针旋转（类似图 5-32 所示使用锥形渐变实现的加载图形），于是，我这个朋友就定义了两个旋转动画：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15821536810324787000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes spin {\n   from {\n      transform: rotate(0deg);\n   }\n\n   to {\n      transform: rotate(360deg);\n   }\n}\n\n@keyframes spin2 {\n   from {\n      transform: rotate(360deg);\n   }\n\n   to {\n      transform: rotate(0deg);\n   }\n}`, `15821536810324787000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin2</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2038697212265172500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.turntable {\n   animation: spin 5s 5;\n}\n\n.loading {\n   animation: spin2 1s infinite;\n}`, `2038697212265172500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.turntable</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 5s 5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin2 1s infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这就是 CSS 动画相关知识不扎实的体现，虽然效果是正常的，但代码实在烦琐。其实无须再额外定义一个逆时针动画，直接使用 reverse 关键字即可，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60861542571528405000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.turntable {\n   animation: spin 5s 5;\n}\n\n.loading {\n   animation: spin 1s reverse infinite;\n}\n\n@keyframes spin {\n   from {\n      transform: rotate(0deg);\n   }\n\n   to {\n      transform: rotate(360deg);\n   }\n}`, `60861542571528405000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.turntable</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 5s 5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s reverse infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="alternate-关键字的应用场景"><a href="#alternate-%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>alternate 关键字的应用场景</h3>\n<p>先看反例，实现一个钟摆运动。有一些对 CSS 动画不太熟悉的开发者会通过自定义动画关键帧来实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66303588827126010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.clock-pendulum {\n   transform-origin: top;\n   animation: pendulum 2s infinite;\n}\n\n@keyframes pendulum {\n   0%,\n   100% {\n      transform: rotate(10deg);\n   }\n\n   50% {\n      transform: rotate(-10deg);\n   }\n}`, `66303588827126010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.clock-pendulum</span> <span class="token punctuation">{</span>\n   <span class="token property">transform-origin</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> pendulum 2s infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> pendulum</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%,\n   100%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">50%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>乍一看好像效果还行，其实是有问题的，除了代码烦琐且需要额外计算之外，最大的问题在于运动效果并不准确，因为此时一个动画周期是 10deg→−10deg→10deg。对于钟摆运动，元素两次到达 0deg 的位置时运动速度最快，但是目前的 CSS 时间函数是无法同时指定两处加速点的，因此，上面这种自以为是的用法是无论如何也不可能实现真实的钟摆运动的。</p>\n<p>唯一且最佳的实现方法就是使用 alternate 关键字，同时使用 ease-in-out 作为时间函数，要知道钟摆运动是使用 ease-in-out 时间函数最具代表性的案例。代码示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74242662973438380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.clock-pendulum {\n   transform-origin: top;\n   animation: pendulum 1s infinite alternate ease-in-out;\n}\n\n@keyframes pendulum {\n   0% {\n      transform: rotate(-10deg);\n   }\n\n   100% {\n      transform: rotate(10deg);\n   }\n}`, `74242662973438380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.clock-pendulum</span> <span class="token punctuation">{</span>\n   <span class="token property">transform-origin</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> pendulum 1s infinite alternate ease-in-out<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> pendulum</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/k93e74?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>不过，凡事无绝对，有些动画需要通过在动画帧中自定义实现，而无法通过 alternate 关键字实现。那么，什么类型的动画无法通过 alternate 关键字实现呢？就是那种来回时间不一致的动画，典型代表就是“呼吸动画”，人的呼吸是吸气快，呼气慢，时间为 3 ～ 7s。这一类模拟人体呼吸节奏的动画都是通过调整 @keyframes 自定义关键帧中间状态的时间来实现的。例如，下面 opacity: 1 的状态就不在 50% 的位置，而是在 70% 的位置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14905898692297236000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.breath {\n   animation: breath 7s infinite;\n}\n\n@keyframes breath {\n   0%,\n   100% {\n      opacity: 0;\n   }\n\n   70% {\n      opacity: 1;\n   }\n}`, `14905898692297236000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.breath</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> breath 7s infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> breath</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%,\n   100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">70%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="关于-alternate-reverse"><a href="#%E5%85%B3%E4%BA%8E-alternate-reverse" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 alternate-reverse</h3>\n<p>alternate-reverse 关键字的作用是让动画第一次反向播放，然后不断来回播放。</p>\n<p>alternate-reverse 关键字不能写作 reverse-alternate，这样写是不合法的。至于为何将“alternate”写在“reverse”的前面，可能是按照首字母排序的吧。</p>\n<h2 id="动画播放次数可以是小数"><a href="#%E5%8A%A8%E7%94%BB%E6%92%AD%E6%94%BE%E6%AC%A1%E6%95%B0%E5%8F%AF%E4%BB%A5%E6%98%AF%E5%B0%8F%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动画播放次数可以是小数</h2>\n<p>动画播放的次数是可以任意指定的，很多人并不知道。我们可以使用 animation-iteration-count 属性任意指定动画播放的次数，甚至是小数。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71589413961075384000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: fadeIn 1s linear both;\n   animation-iteration-count: 1.5;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `71589413961075384000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s linear both<span class="token punctuation">;</span>\n   <span class="token property">animation-iteration-count</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>动画播放的进度为 0%→100%、0%→50%，也就是在第二轮播放的时候，播放到一半就会停止，此时元素的透明度是 0.5。</p>\n<p>大家千万不要误认为 animation-iteration-count 的属性值不能为小数，该属性对小数也是可以精确解析的，这一点和 z-index 属性不一样。对比两个属性的正式语法就可以看出差别了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90830440567247980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation-iteration-count: infinite | <number>\nz-index: auto | <integer>`, `90830440567247980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation-iteration-count</span><span class="token punctuation">:</span> infinite | &lt;number>\n<span class="token property">z-index</span><span class="token punctuation">:</span> auto | &lt;integer></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>animation-iteration-count 支持的是 <code class="language-text">&lt;number&gt;</code> 数值类型，而 z-index 支持的是 <code class="language-text">&lt;integer&gt;</code> 整数类型。animation-iteration-count 的中文意思是“动画—迭代—数目”，初始值是 1，表示动画播放 1 次就结束了。</p>\n<h3 id="小数值的作用"><a href="#%E5%B0%8F%E6%95%B0%E5%80%BC%E7%9A%84%E4%BD%9C%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小数值的作用</h3>\n<p>小数值的应用场景虽然不多，但是一旦用起来，会让人非常愉悦，因为这非常体现 CSS 技术。例如，淡出效果的 CSS 关键帧代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53518934334256690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `53518934334256690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>页面中有些元素处于禁用态，透明度只有 40%，此时，使用完整的 fadeIn 动画就不合适（因为动画帧中的样式优先级太高，会覆盖 40% 透明度）。于是不少人会重新定义一个禁用元素的淡出动画：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46987210041175210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes disableFadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 0.4;\n   }\n}`, `46987210041175210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> disableFadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0.4<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其实大可不必，还是使用 fadeIn 动画，只要把播放次数调整为小数即可。对于 ease 时间函数，透明度提高到 40% 只需要 25% 的完整动画时间，因此，我们只需要播放 0.25 次即可，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70988168303816020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.visible {\n   animation: fadeIn 0.25s both;\n}\n\n.visible:disabled {\n   animation: fadeIn 1s 0.25 both;\n}`, `70988168303816020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.visible</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.25s both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.visible:disabled</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s 0.25 both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>HTML 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81855999000823990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<input value=&quot;可用&quot; /> <input value=&quot;禁用&quot; disabled />`, `81855999000823990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>可用<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>禁用<span class="token punctuation">"</span></span> <span class="token attr-name">disabled</span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-63 所示，可以看到禁用态输入框的透明度只有 40%。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-115a3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.68039950062422%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCElEQVQoz5WR4U6DMBSFef83MuuAwjLn0F+LoCbKMrOQuWJChQKlBQ90LhnJUE9uSG/v+Wg5WF3Xaa055+WgqqrKScEAMxCAloGFEGEYEkKiKDI73XWBv4DxyiRJ4jhmjGGnbdt/wEVR4AlGKYVZPSljPsEQmKaRTS+J5W+lDGWZS+Y5L4q/Vp5n5rvOcLbfv+922+PxUFW4Fxfi61rhpDHM2CFNP7LscwL7gS9PLktR12VdIyr8STEqTEftCZZSIjqle0nZSJNan9+Q3tD3BqXNAKPeNjTWjLhPzy+vb1vG0rlDXW9hO97cdqm/JDZ1qI+Ff7vebB49f7kK7ld3wc3MWQcPDl18A7zcdP98JCaXAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 01 20 27" title="" data-src="/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-fee1c.png" data-srcset="/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-a67b7.png 200w,\n/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-0b187.png 400w,\n/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-fee1c.png 800w,\n/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-115a3.png 801w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/s60jty?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果只希望使用淡出动画的后半截，则使用 animation-iteration-count 小数值的方法就不管用了。</p>\n<p>此时可以使用 animation-delay 负属性值实现我们想要的效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25872822741611356000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.visible-second-half {\n   animation: fadeIn 1s -0.25s;\n}`, `25872822741611356000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.visible-second-half</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s -0.25s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果只希望使用淡出动画的中间部分，可以同时使用 animation-iteration-count 小数值和 animation-delay 负时间值。例如，选取中间 50% 的时间区域：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98413520714886450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.visible-middle-part {\n   animation: fadeIn 1s -0.25s 0.75;\n}`, `98413520714886450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.visible-middle-part</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s -0.25s 0.75<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="关于-infinite"><a href="#%E5%85%B3%E4%BA%8E-infinite" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 infinite</h3>\n<p>关键字属性值 infinite 表示无限，作用是让动画一刻不停地无限播放，钟摆运动或者 loading 旋转就属于这样的动画。</p>\n<h3 id="关于值范围"><a href="#%E5%85%B3%E4%BA%8E%E5%80%BC%E8%8C%83%E5%9B%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于值范围</h3>\n<p>animation-iteration-count 的属性值不能是负数，否则会被认为不合法，但是可以是 0，表示动画一次也不播放。因此，如果想要重置 animation 属性，可以使用 animation: 0，比使用 animation: none 的代码少。</p>\n<h2 id="forwards-和-backwards-属性值究竟是什么意思"><a href="#forwards-%E5%92%8C-backwards-%E5%B1%9E%E6%80%A7%E5%80%BC%E7%A9%B6%E7%AB%9F%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>forwards 和 backwards 属性值究竟是什么意思</h2>\n<p>animation-fill-mode 属性的字面意思是“动画填充模式”，主要用来定义动画在执行时间之外应用的值。</p>\n<p>animation-fill-mode 属性的语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19210857073546617000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation-fill-mode: none; /* 默认值 */\nanimation-fill-mode: forwards;\nanimation-fill-mode: backwards;\nanimation-fill-mode: both;`, `19210857073546617000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token comment">/* 默认值 */</span>\n<span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> forwards<span class="token punctuation">;</span>\n<span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> backwards<span class="token punctuation">;</span>\n<span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中 none 是默认值，表示动画开始之前和动画结束之后不会对元素应用 @keyframes 规则中定义的任何样式。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49721589523519010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n   animation: fadeIn 2s 1s;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `49721589523519010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时的 .element 元素的透明度变化过程如下。</p>\n<ol>\n<li>透明度 0.5 保持 1s。</li>\n<li>透明度从 0.5 突变到 0，然后透明度从 0 逐渐过渡到 1，过程持续 2s。</li>\n<li>透明度从 1 突变到 0.5，并保持不变。</li>\n</ol>\n<p>实际上，这里的 .element 元素的透明度无论设置为多少，都会有透明度突变的糟糕体验，这显然不是我们想要的，因此需要使用 animation-fill-mode 属性优化动画效果。但 forwards 和 backwards 这两个关键字属性值不太好理解，下面详细讲解一下。</p>\n<h3 id="forwards-和-backwards-的含义"><a href="#forwards-%E5%92%8C-backwards-%E7%9A%84%E5%90%AB%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>forwards 和 backwards 的含义</h3>\n<p>forwards 是“前进”的意思，表示动画结束后（什么时候结束由 animation-iteration-count 属性决定），元素将应用当前动画结束时的属性值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74607987011530420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n   animation: fadeIn 2s 1s forwards;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `74607987011530420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s forwards<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时的 .element 元素在动画结束之后会使用 100% 这一帧的透明度属性值，因此透明度变化过程如下。</p>\n<ol>\n<li>透明度 0.5 保持 1s。</li>\n<li>透明度从 0.5 突变到 0，然后透明度从 0 逐渐过渡到 1，过程持续 2s。</li>\n<li>透明度一直保持为 1（forwards 的作用）。</li>\n</ol>\n<p>backwards 是“后退”的意思，表示在动画开始之前，元素将应用当前动画第一轮播放的第一帧的属性值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53816172113180525000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n   animation: fadeIn 2s 1s backwards;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `53816172113180525000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s backwards<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时的 .element 元素在动画开始执行之前会使用 0% 这一帧的透明度属性值，因此透明度变化过程如下。</p>\n<ol>\n<li>透明度为 0 并保持 1s 不变（backwards 的作用）。</li>\n<li>透明度由 0 逐渐过渡到 1，过程持续 2s。</li>\n<li>透明度从 1 突变到 0.5，并保持不变。</li>\n</ol>\n<p>有人可能会奇怪，forwards 语义包含“前”，为什么应用的却是最后一帧样式？而 backwards 语义包含“后”，为什么应用的却是第一帧样式？</p>\n<p>这是因为这里的 forwards 指动画向前，backwards 指动画向后。如果把时间画在一把尺子上，则动画所经过的时间就是这把尺子的一部分，如图 5-64 红色部分所示，可以看到，动画向前的方向是动画的结束位置；动画向后的方向是动画的开始位置。也就是说 forwards 表示动画的结束，backwards 表示动画的开始。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-8abf3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 20.242214532871973%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvElEQVQI122OwQqCQBRF/f8fKFE3LrQvEHXjDxS0U4iiTEhy9L2ZeTNjFE4a1Kpzt+fAdeyP18uWpa1r+3zav7StrapF++IgIgDgMuwZ64oC8hzSdEgS2GwgiiBJhjSFLLvned918PGXBNERUnIhFCmtNXFOcUzrlfF95XsUBDoIlOdp39OuS2GohTDjSERzIomcaZrmA1LS8XRmHWPG3MbHGfmph9aYRqqaiwMbDqy/Cnmpm+1uD8jnZA7fUSPYT9c++0UAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 01 37 50" title="" data-src="/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-fee1c.png" data-srcset="/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-a67b7.png 200w,\n/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-0b187.png 400w,\n/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-fee1c.png 800w,\n/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-8abf3.png 1156w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>因此，forwards 的“前进”指的是最后一帧继续前进的样式，backwards 的“后退”指的是第一帧还要后退的样式。</p>\n<h3 id="forwards-和-backwards-的细节"><a href="#forwards-%E5%92%8C-backwards-%E7%9A%84%E7%BB%86%E8%8A%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>forwards 和 backwards 的细节</h3>\n<p>由于动画的最后一帧是由 animation-direction 和 animation-iteration-count 属性共同决定的，因此 forwards 有时候对应的是 @keyframes 规则中的 to 或 100% 对应的帧，有时候对应的是 @keyframes 规则中的 from 或 0% 对应的帧，具体对应细节如下表。</p>\n<table>\n<thead>\n<tr>\n<th align="left">animation-direction</th>\n<th align="left">animation-iteration-count</th>\n<th align="left">最后一个关键帧</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">normal</td>\n<td align="left">奇数或偶数（不包括 0）</td>\n<td align="left">100% 或 to</td>\n</tr>\n<tr>\n<td align="left">reverse</td>\n<td align="left">奇数或偶数（不包括 0）</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">alternate</td>\n<td align="left">正偶数</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">alternate</td>\n<td align="left">奇数</td>\n<td align="left">100% 或 to</td>\n</tr>\n<tr>\n<td align="left">alternate-reverse</td>\n<td align="left">正偶数</td>\n<td align="left">100% 或 to</td>\n</tr>\n<tr>\n<td align="left">alternate-reverse</td>\n<td align="left">奇数</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">normal 或 alternate</td>\n<td align="left">0</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">reverse 或 alternate-reverse</td>\n<td align="left">0</td>\n<td align="left">100% 或 to</td>\n</tr>\n</tbody>\n</table>\n<p>而 backwards 只取决于 animation-direction 的属性值，因为 backwards 设置的是动画第一次播放的第一帧的状态，与 animation-iteration-count 次数没有任何关系，具体对应细节如下表所示。</p>\n<table>\n<thead>\n<tr>\n<th align="left">animation-direction</th>\n<th align="left">第一个关键帧</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">normal 或 alternate</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">reverse 或 alternate-reverse</td>\n<td align="left">100% 或 to</td>\n</tr>\n</tbody>\n</table>\n<p>可以看出，其实 animation-iteration-count 的属性值为 0 的时候，forwards 等同于 backwards。</p>\n<h3 id="记不住-forwards-和-backwards-怎么办"><a href="#%E8%AE%B0%E4%B8%8D%E4%BD%8F-forwards-%E5%92%8C-backwards-%E6%80%8E%E4%B9%88%E5%8A%9E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>记不住 forwards 和 backwards 怎么办</h3>\n<p>一个知识点往往需要反复阅读与实践才能记忆深刻，所以如果不常写 CSS 代码，则一段时间后记不清应该使用 forwards 还是 backwards 是很正常的，这个时候干脆就使用 both 关键字代替。</p>\n<p>animation-fill-mode: both 可以让元素的动画在延时等待时保持第一帧的样式，在动画结束后保持最后一帧的样式，适用于绝大多数的开发场景。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39033193490084090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n   animation: fadeIn 2s 1s both;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `39033193490084090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时的 .element 元素的透明度变化过程如下。</p>\n<ol>\n<li>透明度为 0 并保持 1s 不变（等同于 backwards 的作用）。</li>\n<li>透明度从 0 逐渐过渡到 1，时间持续 2s。</li>\n<li>透明度保持为 1 不变（等同于 forwards 的作用）。</li>\n</ol>\n<p>可以看到元素的透明度变化过程很流畅、很自然。</p>\n<p>还有一点小小的建议，依赖 CSS 动画保持元素的显隐状态有功能上的风险，例如动画如果没执行，元素就永远显示不出来。因此，常规的 CSS 语句里的元素样式也要同步变化，例如下面的元素显示是通过添加类名 .active 触发的，此时需要同时设置 opacity: 1，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12390821860392798000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0;\n}\n\n.element.active {\n   opacity: 1;\n   animation: fadeIn 2s 1s both;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `12390821860392798000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.element.active</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="如何暂停和重启-css-动画"><a href="#%E5%A6%82%E4%BD%95%E6%9A%82%E5%81%9C%E5%92%8C%E9%87%8D%E5%90%AF-css-%E5%8A%A8%E7%94%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何暂停和重启 CSS 动画</h2>\n<p>CSS 动画是可以暂停的。</p>\n<p>使用 animation-play-state 属性可以控制 CSS 动画的播放和暂停，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78506293563569320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 播放 */\nanimation-play-state: running;\n/* 暂停 */\nanimation-play-state: paused;`, `78506293563569320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 播放 */</span>\n<span class="token property">animation-play-state</span><span class="token punctuation">:</span> running<span class="token punctuation">;</span>\n<span class="token comment">/* 暂停 */</span>\n<span class="token property">animation-play-state</span><span class="token punctuation">:</span> paused<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只要设置 animation-play-state 的属性值为 paused 就可以让一个正在播放的 CSS 动画暂停。举个例子，使用 CSS Sprites 背景图和 animation 属性实现一个可暂停的动图效果，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24622328271384530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.love {\n   width: 100px;\n   height: 100px;\n   background: url(heart-animation.png) no-repeat;\n   background-size: 2900%;\n   animation: heart-burst steps(28) 0.8s infinite both;\n}\n\n.stop {\n   animation-play-state: paused;\n}\n\n@keyframes heart-burst {\n   0% {\n      background-position: 0%;\n   }\n\n   100% {\n      background-position: 100%;\n   }\n}`, `24622328271384530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.love</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>heart-animation.png<span class="token punctuation">)</span></span> no-repeat<span class="token punctuation">;</span>\n   <span class="token property">background-size</span><span class="token punctuation">:</span> 2900%<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> heart-burst <span class="token function">steps</span><span class="token punctuation">(</span>28<span class="token punctuation">)</span> 0.8s infinite both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.stop</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-play-state</span><span class="token punctuation">:</span> paused<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> heart-burst</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">background-position</span><span class="token punctuation">:</span> 0%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">background-position</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/r7bnpv?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>点击演示页面中间区域的按钮，会给 .love 元素添加类名 .stop，此时就会看到类似 GIF 动图的“心花怒放”效果动画瞬间被暂停了，如图 5-65 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-b25dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 42.78892072588347%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA5ElEQVQoz41RQW7CMBDk+Uh9A1I59AEceAQqNKRBtQ1pQQQIJZQYm4CJvZtuyA1U1SN7NSN5tKNxq3oAOkCHDaNb/Y3WvRPr1/tub/v0jFjipYBcwiHH89nDDI7W/bz003aHJCgFWYZFgWX5v/m2HOiUTWIAl+1oesUGAGstuQnuRkBKtNbLrJQy5jKffwkhzPV60hqM8S1MHqXSKv6MoyjSJ02yqdC3bUpO0zoHDcOqLuHhR2pzslofcvnBeBBGSbKazuLNJt2m34vFkggX07cgHLyOxuGEccH4bDgKhqTeJ4zxX+3TCXRNtmfQAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 07 20" title="" data-src="/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-fee1c.png" data-srcset="/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-a67b7.png 200w,\n/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-0b187.png 400w,\n/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-fee1c.png 800w,\n/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-b25dc.png 1047w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>相比传统的 GIF 动图，这种使用 animation 实现的动图效果，支持无损 PNG，图像质量更高，而且可以随时播放和暂停。</p>\n<p>配合 animation-delay 负值，动画暂停可以让元素停留在动画的任一时段，我们可以利用这一特性解决一些 CSS 难题。例如，希望设置 50% 透明度的 deepskyblue 色值就可以这样处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9567438310734610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`p {\n   animation: opacityColor 1s -0.5s linear paused;\n}\n\n@keyframes opacityColor {\n   0% {\n      color: transparent;\n   }\n\n   100% {\n      color: deepskyblue;\n   }\n}`, `9567438310734610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> opacityColor 1s -0.5s linear paused<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> opacityColor</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时 <code class="language-text">&lt;p&gt;</code> 元素的 color 色值就是 50% 透明度的 deepskyblue。</p>\n<h3 id="css-动画重启"><a href="#css-%E5%8A%A8%E7%94%BB%E9%87%8D%E5%90%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 动画重启</h3>\n<p>这里顺便讲一下如何重启 CSS 动画，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15446669677255897000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;element active&quot;></div>\n<style>\n   .element.active {\n      animation: fadeIn 2s 1s both;\n   }\n\n   @keyframes fadeIn {\n      0% {\n         opacity: 0;\n      }\n\n      100% {\n         opacity: 1;\n      }\n   }\n</style>`, `15446669677255897000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>element active<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.element.active</span> <span class="token punctuation">{</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s both<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n      <span class="token selector">0%</span> <span class="token punctuation">{</span>\n         <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token selector">100%</span> <span class="token punctuation">{</span>\n         <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>想要 CSS 动画重新执行一遍，可以使用下面的 JavaScript 代码（假设 .element 元素的 DOM 对象是 ele）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7581877942588266000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ele.classList.remove(\'active\');\nele.offsetWidth; // 触发重绘\nele.classlist.add(\'active\');`, `7581877942588266000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">ele<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nele<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span> <span class="token comment">// 触发重绘</span>\nele<span class="token punctuation">.</span>classlist<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果不是重新执行动画，而是让已经暂停的动画继续播放，则设置 animation-play-state 属性值为 running 即可。</p>\n<h2 id="深入理解-steps-函数"><a href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-steps-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入理解 steps() 函数</h2>\n<p>animation-timing-function 的属性值由 cubic-bezier() 函数和 steps() 函数组成。steps() 函数可以让动画效果不连续，就像楼梯，与之相对应的 cubic-bezier() 函数则更像是平滑的无障碍坡道，如图 5-66 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-9ce72.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.25816023738873%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABlUlEQVQoz2P4DwN///4Fklu3bk6ICZk/u3fDygV7tm3YvHH1/r1bD+3fdOb4zgf3rvxHBQxw1p8/f4Dk+nWrbe3NK4uzd06bWFmcl5uX0dfRvHT6pGlTeo8c2gNS9+8fFs0Qmzdt2hAdGrShq6O9uiK/MHdiX9u22dMWT+1raKiaN282TpshmjdsWB8XElhZkJeSkdze0bh3zvSlk3oam6tKS/NnzJpGQPOxE8dDI0JTU+KbW6p3TJuwatqEhpbqlubawpKiKVMnEdB88ODBzOzM1vaGg0vnL53QVddQXltTVl1XXViU39VeT0Dz0WPHMnKzZnQ0r5rUX1lbUVtbVlldUdtQm54a09XeQEDz/gMHcgvyq6vK8gqyS8sKyspLCouL8nIzE+LDe/u6cGr+B46Djx8/PXz48Nmzpw8e3H/06OHjx48eAFn37t2/f//Fi+fomi9evnLn7r13794/ffb8zt3712/cOn/x8rXrN69cvf7t2/fnL189e/4ShF68vHX77olTZ27eunP6zLnjJ8+cO3cRALZt3KSTTzUAAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 18 09" title="" data-src="/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-fee1c.png" data-srcset="/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-a67b7.png 200w,\n/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-0b187.png 400w,\n/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-fee1c.png 800w,\n/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-9ce72.png 1011w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>cubic-bezier() 函数在 5.3.2 节已经详细介绍过，这里专门深入介绍 steps() 函数及其相对应的关键字。</p>\n<p>学习 steps() 函数有一定的难度，主要是容易分不清楚 start 和 end。</p>\n<p>常见的 steps() 函数用法示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37642078683663426000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`steps(5, end);\nsteps(2, start);`, `37642078683663426000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">steps</span><span class="token punctuation">(</span>5<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">steps</span><span class="token punctuation">(</span>2<span class="token punctuation">,</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>语法表示就是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95112253462450780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`steps(number, position);`, `95112253462450780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">steps</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>先讲一下这一语法中的几个关键点。</p>\n<ul>\n<li>\n<p>number 指数值，且是整数值，这个很好理解，表示把动画分成了多少段。假设有如下 @keyframes 规则，定义了一段从 0 ～ 100px 的位移：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96822456941047550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes move {\n  0% {\n     left: 0;\n  }\n\n  100% {\n     left: 100px;\n  }\n}`, `96822456941047550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> move</span> <span class="token punctuation">{</span>\n  <span class="token selector">0%</span> <span class="token punctuation">{</span>\n     <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">100%</span> <span class="token punctuation">{</span>\n     <span class="token property">left</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同时 number 参数的值是 5，则相当于把这段移动的距离分成了 5 段，如图 5-67 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-5fff1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.2644098810613%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAyUlEQVQY042Oy26DMBBF/f8f1SwqkQVSHjXCxI9CU8mIRDwNeGwyUKddZtOzOrr3jjRkW1f/wPfkdu9h2zalzUE2C66I61G1UpsQVi3s03tjfPCTamjeBUFEUtf19fr9wRSXnwmlXObJJb9wTinNRMFVcT6fQsVEkTLG0jSTX5nIpRDhnkRRJARHXKy18zwDWO/+dPYOHMA0TRascxDS4I9lUUrudm9xHBOttTHP3/7POI5VVZVlSV67rusD/hcAGAbTtG3fD6/LH4FYGOiMhabRAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 25 07" title="" data-src="/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-fee1c.png" data-srcset="/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-a67b7.png 200w,\n/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-0b187.png 400w,\n/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-fee1c.png 800w,\n/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-5fff1.png 1093w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>position 指关键字属性值，是可选参数，表示动画跳跃执行是在时间段的开始还是结束。其支持众多关键字值，这里先了解一下传统的 start 和 end 关键字。</p>\n</li>\n<li>\n<p>start 表示在时间段的开头处跳跃。</p>\n</li>\n<li>\n<p>end 表示在时间段的结束处跳跃，是默认值。</p>\n</li>\n</ul>\n<h3 id="深入理解-start-和-end-关键字"><a href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-start-%E5%92%8C-end-%E5%85%B3%E9%94%AE%E5%AD%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入理解 start 和 end 关键字</h3>\n<p>steps() 函数本质上是一个阶跃函数，阶跃函数是一种特殊的连续时间函数，可以实现从 0 突变到 1 的过程。图 5-68 所示的 steps(1, start)、steps(1, end)、steps(3, start)、steps(3, end) 就是阶跃函数。</p>\n<p>通过分析图 5-68 所示内容，我们可以得到对 start 和 end 关键字的进一步解释。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-a3fce.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 515px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 129.51456310679612%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAAsSAAALEgHS3X78AAAC5UlEQVQ4y51U23LTMBDV/38KQ6fD8MQAbSlPMKQlGSCXNnVsJ77JN8mWL/IlHFuOmzalD+xoZFnao909uysiy/xmbplu4oXCDbpBw8yw+WIT7vf7tm0x+75fVdX+IG0/r82Y4GPRRORSVnUph1GUdV7WI5hzXhTF/qn4cd6BWVo2Tbt/SRQ4z3G3fHaUCEkopZ7P/gWGpGlqWVZZls/3M0kYi2nAXwHDrOd5p24nAOMTJ0X9qtvFS25z0YPBcw6KajBa1epTVQqm5pglERNV3YJLNWMEIAy36jvqB2EcRbvdbrvdxnEMPzEPWWnr1YO92EQ0yrYuu9s4TiBsP9W2IYGppmmUJ1EUKQw2xyBxit8h/kxQz1VrKUuifIOA9ul0mvQyao+Rw/28KOaLBbwD/+pqMkTPuaZpuq4DiWMhxClzjuNABxHBQVjqwPBKsXJwsq2aFluyao42m9NEgDkCB4IgGK8IWD7546G2f6+DkW3YUUXSDtKB51pIFE9jkFXdcFE+yzOiOK0wnvaEhREYbk03RSchB0hJD3sEZ1kGblVQGNMVhdrWTQjo8VwHaqjViBdNH/CxBcYYiDy4PfRTIbsUk7atZ0tLt5nhcJHJMbBjtoCH5ayoZ3edTTS/OlL9LArZyKo9rfChtousqSV0bNqlEJqPYMdPGE9QPUpQA8i26gQFtr1Yt+KQFw5lZZFDBwroNpJlwqFRKjLVeqgEhIciRdmo69EpKH4nyNBGLo1R/uAPeOSIHHuItwoYLBDnk0frQAF8ggF1hJkcqlyapjmZTHDfaesrChnjs9nMMAzogMIuZnWAOG3bBgwuUd9HDArT9NL2KxSi47pRH1EYho+N8X+CN4zf3P7UDRPvwXyxgh1K/fWDtlje3a+1+WKJBXbCrtcZzFq2s9no09mvIIwIfs7O3/+Y3C5X9x8+XuD5Ngzz4uoa68+X1zh68/b808XV5Zev2Pn2fTK5mUL57dk7baP/BR8Z1439FXj8AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 38 46" title="" data-src="/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-a3fce.png" data-srcset="/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-96d1c.png 200w,\n/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-2b9d0.png 400w,\n/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-a3fce.png 515w" data-sizes="(max-width: 515px) 100vw, 515px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>start：表示直接开始，也就是时间段才开始，就已经执行了一个距离段。动画执行的 5 个分段点是下面这 5 个，起始点被忽略，因为时间一开始直接就到了第二个点，如图 5-69 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-0f56a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.142857142857146%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABkklEQVQoz42SS2/aUBCF/c+ziiJlk+zaVdWKVSlNG3YNpHlBSpQ44BCitHJBMcYvAjbEsjE2/uqHrApUVTnS1b0687gzZ0YgQbxapRdhv0/YbhN3u8xPTnAmk4yP45jXQigSpiGLwQBPkgjEW4zTUyxNy5xWqT1J+pojFI8UwXSKKoroUgez0yYIgrXfVxvVbNadJSwMiulShM8jsPy/jpq9YOYn6aIQN4hRpwuWQZhFGrMl4/kSXuZ5y77vYTszGg8m3eMLuqUPiOc3tO6G3Fc+0zuscv1oICXc7ft3dM5atHoaYvmA3qePXD+MuKpfcVcqoV9eIsiyzK+fjzzPbKRKhaOdHXq1I7RBn7P9fb7v7aEqT8jHdb5tbyN+/cJYH/Hj7Rvqu7s8/Za5r9c43NriplxGaDabqKqaaxBF2IpCmNwp3GQoM00vBMIZDpNWc2F828HRc5uS8LVqlYtGI9ewmOT/Jf83NldqbcpRUplhmjiJpp7n4bouk8mU0UjDMExM08IaP2NZ44xPuTCM1lbrDyqOo2UckIbjAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 43 15" title="" data-src="/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-fee1c.png" data-srcset="/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-a67b7.png 200w,\n/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-0b187.png 400w,\n/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-fee1c.png 800w,\n/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-0f56a.png 1050w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>end：表示戛然而止，也就是时间段一结束，当前动画执行就停止。于是，动画执行的 5 个分段点是下面这 5 个，结束点被忽略，因为在要执行结束点的时候已经没时间了，如图 5-70 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-7ea00.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.527001862197395%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQY05VQTW+CQBTcv+zNePTipT2aeGwTj5peGntr0QLWD0SMBZHyIYjIYi1EqARYtiv04KlJ3+lldmbezAKc5xhjdDql0ykWxZBlfU0jSF7gfw/ACJXiaD6PJ1M4ZOFKuoizrGTkhFAaEb+CfCUmIMZReHYWS6go1lw4Hr7Ko99xGicXizRDUZxmBUqQ6JyUuYAvCPvxhJEOlhMcWVpbb0daaDCjzzdmKMKFaHuvffVdpWXfnC0hQ89kT9D97JIrB+Nm86nRUGV5RVGdSoVtty0XPt/cPtbriiiuKapbq7H3dzvHoVuth2pV4jjDNHmeRwiBl06n3+2SKmkcuxwXeB7JE+52riSRcEkB+hASwsm2HZ4ncXVd7/V6g8EAoKLzf4d0TpIE/K7FB5imtd+7YRgGfrDZWMqHalpbw9hYW5ss5NW27WuLHyn9tg0e7JJuAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 44 26" title="" data-src="/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-fee1c.png" data-srcset="/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-a67b7.png 200w,\n/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-0b187.png 400w,\n/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-fee1c.png 800w,\n/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-7ea00.png 1074w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ul>\n<p>然而，上述的分析是站在函数的角度和时间的角度进行的，虽然仔细琢磨一下也能理解，但是由于这并不符合人的主观视角和实际感知，一段时间后，认知就会发生混乱。</p>\n<p>混乱的原因在于认知失调。steps(5) 是把动画时间段分成 5 段，对这个点的认识应该都没有问题，关键是对 steps(5, start) 的认识，看到这里是 start，几乎所有人的第一反应就是动画应用的样式是对应时间段开始的样式，不然怎么叫作“start”呢？可现实真是残酷，steps(5, start) 应用的样式不是 5 个时间段的 start 样式，而是 5 个时间段的 end 样式，例如 left: 0 到 left: 100px 的位移，最终元素表现出来的位移是 20px、40px、60px、80px 和 100px。</p>\n<p>steps(5, end) 也是反直觉的表现，其应用的是 5 个时间段的 start 样式，而不是字面上的 end 样式，例如 left: 0 到 left: 100px 的位移，最终元素表现出来的位移是 0px、20px、40px、60px 和 80px。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/e2u1f2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>大家可以看到，以 20px 为一个分段，start 的位置在分段的结束处，而 end 的位置在分段的开始处，图 5-71 所示的就是执行 5 次 step() 的位置示意图。</p>\n<p>因此，为了避免认知混乱，当需要用到 steps() 函数的时候，无须思考过于抽象的阶跃函数及其准确含义，只需要记住符合直觉认知的这么一句话：“一切都是反的。start 不是开始，而是结束；end 不是结束，而是开始。”</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-88b8f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 25.99653379549394%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA8UlEQVQY0xWNy26DMBRE+f/P6iKbKmqTGBqH8LLxA1/7Gr8g2ZVoNmd0RpqqF+p0IS29M86lFF+/5PpHpRBi5j+3+kSoUopzXhPyXdNOaDnzGyHtg54HWZlYqPbBY0jpveVGobC+5FRyXhzW+sMx5YiuN56vec/JIUaPV5MqZnDontM0OWcluJq2M5vAWkR3bihnzB0CTPNo7wNLqweAvns23biArQi+1hC996+SWdjuJpSw5lK2km9L1Bhe+75vRflIIL0POpJCa9PkS+WMAbDHQGtjDXxewEqlHXrQ2oLthvGoUirBuZBqGCfGxXIoA/8odg9ryNF7WwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 53 41" title="" data-src="/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-fee1c.png" data-srcset="/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-a67b7.png 200w,\n/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-0b187.png 400w,\n/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-fee1c.png 800w,\n/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-88b8f.png 1154w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这样，至少使用 start 和 end 关键字的时候不会犯错，至于相反的原因，可以参考图 5-68 所示的 steps() 阶跃函数慢慢理解。</p>\n<h2 id="animation-fill-mode-属性与-steps-函数同时设置会怎样"><a href="#animation-fill-mode-%E5%B1%9E%E6%80%A7%E4%B8%8E-steps-%E5%87%BD%E6%95%B0%E5%90%8C%E6%97%B6%E8%AE%BE%E7%BD%AE%E4%BC%9A%E6%80%8E%E6%A0%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>animation-fill-mode 属性与 steps() 函数同时设置会怎样</h2>\n<p>animation-fill-mode 属性和 steps() 函数同时使用，可能会影响元素的断点表现。例如，下面这个语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85779772408417880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation: move 5s forwards steps(5, end);`, `85779772408417880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation</span><span class="token punctuation">:</span> move 5s forwards <span class="token function">steps</span><span class="token punctuation">(</span>5<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>forwards 关键字会使动画停留在动画关键帧最后一帧的状态。于是，图 5-72 所示的 6 个分段点都会执行，整个动画停止在第六个分段点上，也就是由于设置了 animation-fill-mode，因此虽然将时间分成了 5 段，但是视觉表现上却是元素总共移动了 6 个位置。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-cc2b6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.03639672429482%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABZklEQVQY052OO2+CYBiF+cNOLg7MTl3axNXNxEabxhibNrSk9X5Hrip8gAqiIoKAUBDFfsaka5Oe4eRJzjl5X+Typ+IY2mm/DwgiGo0ikjwRxK7RcFcrJD6fbzH0X45vfNueTtexZXrE0K/Xg9rXhSa1ZtOUZQQG5zjWLT84XkuufzQP4XUXX0wncLwjxDA6rw13M19slQVDjqfY5yT/CNvICse3DNsCjsKJ2tvLmJlRsj17x2cfOL1wp/xKKZckatqSXHVI2/0uoxwmQBdyORtexlIpPJNRdJ2rVJ6TSRLDNHVZvbt7TacXmgZ6vUoi0S4W16ZZe7gvoyhgWaHTKaEoXSgglXx+2G7DP799T1cUz/PD6OhYlm1ZYRgGQWAsl45th1Hk6PoaAAg8zz9ls81qFYkv/xeiqkuWmxjGbjIVOt0+zwOGHfOCJEryfK5QNFutNwUgUjQHYUBQgigRI6rbG2z07Q+enqsnBd9BEwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 57 11" title="" data-src="/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-fee1c.png" data-srcset="/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-a67b7.png 200w,\n/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-0b187.png 400w,\n/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-fee1c.png 800w,\n/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-cc2b6.png 1099w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这显然不是我们想要的，怎么处理呢？可以减少分段个数和减小动画运动的跨度，调整如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19633205962790744000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes move {\n   0% {\n      left: 0;\n   }\n\n   100% {\n      left: 80px;\n   }\n}`, `19633205962790744000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> move</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>也就是将终点从 100px 改成 80px，同时将 CSS 调用改成：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89721565648955770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation: move 5s forwards steps(4, end);`, `89721565648955770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation</span><span class="token punctuation">:</span> move 5s forwards <span class="token function">steps</span><span class="token punctuation">(</span>4<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>也就是将原来的 steps(5, end) 改成 steps(4, end)，最后将 100% 这一帧交给 forwards。</p>\n<h3 id="step-start-和-step-end-关键字"><a href="#step-start-%E5%92%8C-step-end-%E5%85%B3%E9%94%AE%E5%AD%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>step-start 和 step-end 关键字</h3>\n<p>step-start 和 step-end 是 steps() 函数的简化关键字，注意，是 step-*，step 后面没有 s。step-start 等同于 steps(1, start)，表示“一步到位”；step-end 等同于 steps(1, end) 或者 steps(1)，表示“延时到位”。</p>\n<p>之所以专门设置两个关键字 step-start 和 step-end，不是因为这两个关键字常用，而是因为这两个关键字实用。它们可以让动画按照设定的关键帧步进变化，特别适合非等分的步进场景。例如实现一个打点动画，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45663091428338110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`正在加载中<dot>...</dot>\n<style>\n   dot {\n      display: inline-block;\n      height: 1em;\n      line-height: 1;\n      vertical-align: -0.25em;\n      overflow: hidden;\n   }\n\n   dot::before {\n      display: block;\n      content: \'...\\A..\\A.\';\n      white-space: pre-wrap;\n      animation: dot 3s infinite step-start both;\n   }\n\n   @keyframes dot {\n      33% {\n         transform: translateY(-2em);\n      }\n\n      66% {\n         transform: translateY(-1em);\n      }\n   }\n</style>`, `45663091428338110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html">正在加载中<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dot</span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dot</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">dot</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 1em<span class="token punctuation">;</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> -0.25em<span class="token punctuation">;</span>\n      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">dot::before</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>\n      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'...\\A..\\A.\'</span><span class="token punctuation">;</span>\n      <span class="token property">white-space</span><span class="token punctuation">:</span> pre-wrap<span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> dot 3s infinite step-start both<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@keyframes</span> dot</span> <span class="token punctuation">{</span>\n      <span class="token selector">33%</span> <span class="token punctuation">{</span>\n         <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-2em<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token selector">66%</span> <span class="token punctuation">{</span>\n         <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-1em<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-73 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-72de5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 648px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 29.32098765432099%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAvElEQVQY06WNyw6CMBBF+/9/Y2JiovGBmggiArIDFGl4a3nUIrJosWBwY3TjWUwmN+fOgOYLpCSe55mmWWD8zQGfEWOsLZMbhNCyrV9lSinreTX7cvvZtq0sz985d2k7abdT0PwB8P3gitLqXmV5we8VBSakrKoH7kAoDcIwimPuoDRLkiROLmcXIoSCMALjyUxWNG6cHLeua1XTZVk5Ou5e1XXdkGRlOhe4I0o7nojidrneDIajg2EshNUTRClT3M2oYDwAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 16 05 40" title="" data-src="/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-72de5.png" data-srcset="/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-bb436.png 200w,\n/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-c5634.png 400w,\n/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-72de5.png 648w" data-sizes="(max-width: 648px) 100vw, 648px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/vxnscm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>在这个例子中，如果你想通过在 @keyframes 规则中设置好 0% 和 100% 的位置，再使用 steps(2) 或 steps(3) 进行位置划分实现这个效果，你会发现位置总是对不上。其实完全不用这么麻烦的，手动设置好断点的位置，然后使用一个 step-start 关键字就搞定了，无须计算，无须微调，就算把 33% 改成 50% 功能也是正常的，只是打点速度不均匀而已，定位字符点绝对没问题。</p>\n<p>这就是 step-start 和 step-end 关键字的精妙作用，可以让任意自定义的 CSS 关键帧步进呈现，很实用。</p>\n<h3 id="新的-jump-start、jump-end、jump-none-和-jump-both-关键字"><a href="#%E6%96%B0%E7%9A%84-jump-start%E3%80%81jump-end%E3%80%81jump-none-%E5%92%8C-jump-both-%E5%85%B3%E9%94%AE%E5%AD%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新的 jump-start、jump-end、jump-none 和 jump-both 关键字</h3>\n<p>从 2019 年开始，Chrome 浏览器和 Firefox 浏览器开始陆续支持 jump- 开头的用在 steps() 函数中的关键字。下面先介绍一下 jump-start、jump-end、jump-none 和 jump-both 关键字的含义。</p>\n<ul>\n<li>jump-start：动画开始时就发生跳跃，和 start 关键字的表现一样。</li>\n<li>jump-end：动画结束时发生跳跃，和 end 关键字的表现一样。</li>\n<li>jump-none：动画开始时和结束时都不发生跳跃，然后中间部分等分跳跃。</li>\n<li>jump-both：动画开始时和结束时都发生跳跃。</li>\n</ul>\n<p>假设时间函数分为 3 段，则 jump-start、jump-end、jump-none 和 jump-both 关键字对应的阶跃函数如图 5-74 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-925e2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.33098591549296%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABNklEQVQoz4VSa0/DMAzc//9rCCEQaGMgrR1sGQ15N4nzanGXfWBlbFYURU7Odzl7MZ5HSimEALHsaW99woz3fphi5BpyGX4/XszAzjkhzbeEmHKthZlSBq7AuDh7PAeHmAjViESucmT0HqhwqodxHG6AY0y9dUJwKRXqxwyTtmNKSuGsm9RfAVflSiljdMkn5VprzgUA3GDOOZeCmpHQV8NiSvXKQyrXDUsxor0xDcaG+mcAX0pBq7Hcueo/YPC+763QIcSTZtNbhDE179Ml5pSldhASmo2BGcqtMrXV/4PrHTJSbsihY4xVh1AIZ6zrOmPMrMQFt3HGYgjTYB0bi/zTzAGgHXPmx6dn2lHG+GbTttvP3Y5M52a72xNCDrg3zZYcvlavb+v1e9t+4FouV3f3Dy/L1Q851bzNEzwzewAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 16 12 40" title="" data-src="/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-fee1c.png" data-srcset="/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-a67b7.png 200w,\n/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-0b187.png 400w,\n/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-fee1c.png 800w,\n/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-925e2.png 1136w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>目前 jump-开头的这几个关键字的兼容性还不太好，在生产环境中还无法使用，就不进一步展开讲解了。</p>\n<h3 id="标签嵌套与动画实现的小技巧"><a href="#%E6%A0%87%E7%AD%BE%E5%B5%8C%E5%A5%97%E4%B8%8E%E5%8A%A8%E7%94%BB%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>标签嵌套与动画实现的小技巧</h3>\n<p>遇到某些属性被占用，或者动画场景复杂的情况，可以试试使用标签嵌套来实现。例如，某个悬浮提示框的居中定位是使用 transform 属性实现的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14099140641835172000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.toast {\n   position: absolute;\n   left: 50%;\n   top: 50%;\n   transform: translate(-50%, -50%);\n}`, `14099140641835172000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.toast</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同时希望提示框出现的时候有放大的动画效果，也就是应用下面的 CSS 动画：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98214765969845750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes scaleUp {\n   from {\n      transform: scale(0);\n   }\n\n   to {\n      transform: scale(1);\n   }\n}`, `98214765969845750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> scaleUp</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>很显然，此时 transform 属性冲突了，怎么办？很简单，使用标签进行嵌套就好了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80426419545685640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;toast&quot;>\n   <div class-=&quot;content&quot;>提示内容</div>\n</div>\n<style>\n   .toast {\n      position: absolute;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n   }\n\n   .content {\n      color: #fff;\n      background-color: rgba(0, 0, 0, 0.75);\n      animation: scaleUp 300ms;\n   }\n</style>`, `80426419545685640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toast<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class-</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提示内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.toast</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.content</span> <span class="token punctuation">{</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.75<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> scaleUp 300ms<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样，我们还可以通过元素嵌套，分别应用动画实现更复杂的动画效果，典型的例子就是动画时间函数分解实现抛物线运动效果。</p>\n<p>在页面中点击“加入购物车”按钮，就会看到有商品以抛物线运动的方式飞向购物车，效果如图 5-75 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-4032d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.43205574912892%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABRklEQVQoz2N4Ep70PC3/WVbJU8/gh9v3n7z26Ne37/+B4N8/IPr39y+IgNLogOFxRcPd7kmv6lpfJeXc3LJ369GrP758Bep9+vTVsvWHP3/8AjbnH5jA0Pzn9+8fP3/+//kLpOLfX4htQA2fPny+duPBr+8/gOyjp66dv3QXyADa/x8JMPzHD0B2/j99/taV6w9I0/zvHyoHgojV/Pfv39+/gQjI+P7l67rNRx/cewrU//fX73+//wAFCTkbyeLLj958/PEHxMZv898/IEVnpkxf4OS+2C9olU/gWp/ALQEh630DVwPZ/sHLHd0uzp3PgMMekOlPjx0/PX3mqbnzL86Zd3n2vIuz5kLQpdnzzk2Z/uzkKQa40ufPXzx69PjTp0+v37y5c/f+9Ru3rt+9d+/588ev3zx49frei5cPX73+9fs3sh0AEv4jrIsjQ3wAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 16 19 46" title="" data-src="/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-fee1c.png" data-srcset="/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-a67b7.png 200w,\n/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-0b187.png 400w,\n/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-fee1c.png 800w,\n/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-4032d.png 1148w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/kqn6xv?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>假设飞出去的元素的 HTML 代码结构如下：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="53326686587461910000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<div class=&quot;fly-item&quot;>\n   <img data-src=&quot;./book.jpg&quot; />\n</div>`, `53326686587461910000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fly-item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./book.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>实现抛物线效果的关键 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6417927729483352000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.fly-item,\n.fly-item > img {\n   position: absolute;\n   transition: transform 0.5s;\n}\n\n.fly-item {\n   transition-timing-function: linear;\n}\n\n.fly-item > img {\n   transition-timing-function: cubic-bezier(0.55, 0, 0.85, 0.36);\n}`, `6417927729483352000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.fly-item,\n.fly-item > img</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> transform 0.5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.fly-item</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-timing-function</span><span class="token punctuation">:</span> linear<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.fly-item > img</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-timing-function</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.55<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.85<span class="token punctuation">,</span> 0.36<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，父元素 .fly-item 只负责横向线性运动，子元素 <code class="language-text">&lt;img&gt;</code> 只负责纵向运动，只不过纵向运动是先慢后快的。</p>\n<p>将纵向运动和横向运动合并，就产生了抛物线运动的视觉效果。大家可以想象一下扔铅球，铅球水平飞行的速度其实近似匀速，但是受到重力的影响，铅球下落的速度是越来越快的，于是抛物线效果就产生了。</p>\n<p>类似的通过标签嵌套实现动画效果的例子还有很多，在这里就不一一列举了，重要的是思路和意识，希望大家遇到类似场景时能够想到这样的小技巧。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/CSS新世界更强的视觉表现/index.md absPath of file >>> MarkdownRemark",timeToRead:61,frontmatter:{date:"2022-02-13 00:55:25",path:"/css-new-world-stronger-visual-performance/",tags:"前端, CSS, CSS新世界, 读书笔记",title:"CSS新世界更强的视觉表现",draft:null}},{excerpt:"随着显示器的不断升级，人们对 Web 产品的视觉效果的要求也越来越高，如半透明、圆角、阴影等效果。于是，这些细致的样式表现就率先加入了 CSS 新世界中。本章将介绍这些 CSS 新属性的细节知识，并且这些 CSS 属性都非常实用，值得读者反复阅读、深入学习。 透明度控制属性 opacity opacity 属性可以让元素表现为半透明，属性计算值范围是 0 ～ 1，初始值是 1.0，没有继承性。大多数开发者对 opacity 属性的认识就只有这些，实际上 opacity…",html:'<p>随着显示器的不断升级，人们对 Web 产品的视觉效果的要求也越来越高，如半透明、圆角、阴影等效果。于是，这些细致的样式表现就率先加入了 CSS 新世界中。本章将介绍这些 CSS 新属性的细节知识，并且这些 CSS 属性都非常实用，值得读者反复阅读、深入学习。</p>\n<h1 id="透明度控制属性-opacity"><a href="#%E9%80%8F%E6%98%8E%E5%BA%A6%E6%8E%A7%E5%88%B6%E5%B1%9E%E6%80%A7-opacity" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>透明度控制属性 opacity</h1>\n<p>opacity 属性可以让元素表现为半透明，属性计算值范围是 0 ～ 1，初始值是 1.0，没有继承性。大多数开发者对 opacity 属性的认识就只有这些，实际上 opacity 属性还有很多细节知识。</p>\n<p>例如，在所有支持 CSS 过渡和动画的 CSS 属性中，opacity 属性是性能最高的，因此很多动画效果都可以使用 opacity 属性进行性能优化。例如盒阴影动画效果很耗性能，就可以使用伪元素在元素底部创建一个盒阴影，然后使用 opacity 属性控制这个伪元素的显示与隐藏，性能会因此提高很多，具体参见 box-shadow 相关的介绍。</p>\n<p>又如，opacity 属性值不为 1 的元素会创建一个层叠上下文，层叠顺序会变高。因此，如果你希望某个 DOM 顺序在前的元素覆盖后面的元素，可以试试设置 opacity: 0.99。</p>\n<p>下面讲解一些细节。</p>\n<h2 id="opacity-属性的叠加计算规则"><a href="#opacity-%E5%B1%9E%E6%80%A7%E7%9A%84%E5%8F%A0%E5%8A%A0%E8%AE%A1%E7%AE%97%E8%A7%84%E5%88%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>opacity 属性的叠加计算规则</h2>\n<p>由于 opacity 属性没有继承性，因此父、子元素同时设置半透明时，半透明效果是叠加的。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83156142737833980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.father {\n   opacity: .5:\n}\n\n.son {\n   opacity: .5;\n}`, `83156142737833980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.father</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> .5<span class="token punctuation">:</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.son</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> .5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，子元素的视觉透明度不是 0.5，而是一个叠加计算的值，即 0.25，没错，就是 0.5×0.5 的计算值。下面这个例子可以证明这一点：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86941187210211300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;father opacity1&quot;>\n   <p class=&quot;son&quot;></p>\n</div>\n<div class=&quot;father opacity2&quot;>\n   <p class=&quot;son&quot;></p>\n</div>\n<style>\n   .father {\n      width: 120px;\n   }\n\n   .son {\n      height: 120px;\n      background: deepskyblue;\n   }\n\n   .opacity1,\n   .opacity1 .son {\n      opacity: 0.5;\n   }\n\n   .opacity2 {\n      opacity: 0.25;\n   }\n</style>`, `86941187210211300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>father opacity1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>son<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>father opacity2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>son<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.father</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 120px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.son</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 120px<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.opacity1,\n   .opacity1 .son</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.opacity2</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0.25<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>两个 <code class="language-text">&lt;p&gt;</code> 元素呈现的色值是一模一样的，如图 4-1 所示，这表明父、子元素同时为半透明时，最终的透明度值就是两者的乘积。</p>\n<p>CSS 中半透明颜色和非透明颜色的叠加算法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59420329285861384000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`r = foreground.r * alpha + background.r * (1.0 - alpha);\ng = foreground.g * alpha + background.g * (1.0 - alpha);\nb = foreground.b * alpha + background.b * (1.0 - alpha);`, `59420329285861384000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">r <span class="token operator">=</span> foreground<span class="token punctuation">.</span>r <span class="token operator">*</span> alpha <span class="token operator">+</span> background<span class="token punctuation">.</span>r <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> alpha<span class="token punctuation">)</span><span class="token punctuation">;</span>\ng <span class="token operator">=</span> foreground<span class="token punctuation">.</span>g <span class="token operator">*</span> alpha <span class="token operator">+</span> background<span class="token punctuation">.</span>g <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> alpha<span class="token punctuation">)</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> foreground<span class="token punctuation">.</span>b <span class="token operator">*</span> alpha <span class="token operator">+</span> background<span class="token punctuation">.</span>b <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> alpha<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>例如，deepskyblue 的 RGB 值是 rgb(0, 191, 255)，白色的 RGB 值是 rgb(255, 255, 255)，因此 25% deepskyblue 色值和白色的混合值就是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59146283459251040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`r = 0 * 0.25 + 255 * (1.0 - 0.25) = 191.25 ≈ 191;\ng = 191 * 0.25 + 255 * (1.0 - 0.25) = 239;\nb = 255 * 0.25 + 255 * (1.0 - 0.25) = 255;`, `59146283459251040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">r <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">*</span> <span class="token number">0.25</span> <span class="token operator">+</span> <span class="token number">255</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> <span class="token number">0.25</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">191.25</span> ≈ <span class="token number">191</span><span class="token punctuation">;</span>\ng <span class="token operator">=</span> <span class="token number">191</span> <span class="token operator">*</span> <span class="token number">0.25</span> <span class="token operator">+</span> <span class="token number">255</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> <span class="token number">0.25</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">239</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">*</span> <span class="token number">0.25</span> <span class="token operator">+</span> <span class="token number">255</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> <span class="token number">0.25</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>于是，最终呈现的颜色就是 rgb(191, 239, 255)，这和图 4-1 所示的色值完全一致，详见图 4-2 所示的取色结果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-19-14-40-49-433b3ad2da27226b0b4c60f78dcf7fd0-b1313.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 488px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 152.04918032786884%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEb0lEQVQ4y52Uy4/bVBSHg8SGIjH8Ax22VIItEuxhy6LTQhfsZlepgNghdTUIUQo7xAaBkCpQWxVaEubdSTKZxInznEwS52k7cfx+v+0kdi43mcwD0FSUn66O7j2+3z3nXNsnAv6l6dxSPji0QNUGtA8uUuQiuG6DbQXsKKDhnDn/K1yzwZYy4/8PDLOFwesOYEbPn3bXBRkdIDrouc8feVazCnZUgD077elcC3I6DWfz6ZE13ZSn28q0Yc+W4XShMFzYZ0W2QiAHQApmkwtrnkwCVdU8358EQRiGlm0bpqkbhmUYpq45puFYULY1F/SpmmZalqKqcH9EVtRHj6PVo7pt267r5QulVBpBsvl44uBJdOOP2GZ0fesgk83m8vFkanN790l0PYsWYutbmqZHYAGTyeS0ZigYH9pgrvF4PBqNgnmh5xOGWUJP5HifO5fjONB6nndsj+Uu5DWbTSSTyeVyKIrC9eLCHNsZuV4QBsdHTuYKgwmAnmkIX0A4mX0oq6urry4tLV++/NrycrvdXsC268iWqUpSp1GXBR5eia6p7aGUa7N75W40VUEwukabH3/62ZU33nzr7XfgwHHiJHKvL371fWnI/Y5Wkd6Q43kI9xkeI2ikdBTbTTbwYYdkHiPln9Hm/UP8Hooppr2A/UNWe//XNE5naCfV5QcUpeu6KAoCzw36ZLNRFwVe5thEl4kb04wLEsrI8MYL2Cq7zY8c4cZV8MKLzutXcggiSJIkir1e7yCdiScSxVKJZ5m9Vn9bHCc1sMO5ujdawETZvXvDEb77tv3ue+ytW12COIZpmq5Wq8ViEVYocmy8PdiVg5QBngq+cQpX6t4HN3Vn6jd4gXM9mLOmaTzPsyxbKBSSySRJkjxD77aoDSnY08Em759FrkjeStLoNWocTVMkybBsp9NRFAXC8AiOY03T0hSlilOEHdAj0DN8xz+FPf26USNbHYIk250OJwjtTltVVYqi+v0+3usJoqhIYrZLFfTgyAEFxbfOInvta8ZtfsCSg363ibEU1e32FFkeQJQk4eXzomho6k6L2lTDhAk2uXNpt7zK5/o1ZijSpQIVjwvZLJ/Py77PyTIt8PAImeclht5v9v8k1W3G2pPGunsCq16lbHzYHwr0QYpotTj4i6KoEYsZ9TpdKJD7+3KxyKT2kd2D9Rq1zbk7nHcGe1LZSK6QjDBMpxqHVZJl1WJRR1GNJHuVygDHVdMkCeKAlrMhKAOA+IE5Ck5gHDO++aQviHQ8TqTTDIZp2axsGJChGKY/oGD98C38+Ch6+4dfvrz329pP93lZXcCmYUpDlqLpOzH8wUZNJwb8UKJVlxVkksAHEFYUQRCur1yNRCKvXHpp6eVLTQw7+bZ9X1bhTyV1WAXnVVE3BFUXJEWSZIjJsgwfwR704OHDtbUv7nwNdRd6ZvBx3/h78zu3Pqd/+CEYSeynYd8a0ozn+Q2sBZsZ1mzDUatjcJ7O5AqlSqlS3X2aSKWzSBaFnWwvsY/mi0gu/xdsJUnv+kgzaQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 19 14 40 49" title="" data-src="/static/2022-01-19-14-40-49-433b3ad2da27226b0b4c60f78dcf7fd0-b1313.png" data-srcset="/static/2022-01-19-14-40-49-433b3ad2da27226b0b4c60f78dcf7fd0-152e1.png 200w,\n/static/2022-01-19-14-40-49-433b3ad2da27226b0b4c60f78dcf7fd0-4a935.png 400w,\n/static/2022-01-19-14-40-49-433b3ad2da27226b0b4c60f78dcf7fd0-b1313.png 488w" data-sizes="(max-width: 488px) 100vw, 488px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="opacity-属性的边界特性与应用"><a href="#opacity-%E5%B1%9E%E6%80%A7%E7%9A%84%E8%BE%B9%E7%95%8C%E7%89%B9%E6%80%A7%E4%B8%8E%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>opacity 属性的边界特性与应用</h2>\n<p>opacity 属性有一个实用的边界特性，即 opacity 属性设置的数值大小如果超出 0 ～ 1 的范围限制，最终的计算值是边界值，如下所示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19221319689897865000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   opacity: -999; /* 解析为 0，完全透明 */\n   opacity: -1; /* 解析为 0，完全透明 */\n   opacity: 2; /* 解析为 1，完全不透明 */\n   opacity: 999; /* 解析为 1，完全不透明 */\n}`, `19221319689897865000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> -999<span class="token punctuation">;</span> <span class="token comment">/* 解析为 0，完全透明 */</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> -1<span class="token punctuation">;</span> <span class="token comment">/* 解析为 0，完全透明 */</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span> <span class="token comment">/* 解析为 1，完全不透明 */</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 999<span class="token punctuation">;</span> <span class="token comment">/* 解析为 1，完全不透明 */</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>不仅 opacity 属性有边界特性，RGBA 颜色或者 HSLA 颜色中任意一个颜色通道数值都有边界特性，如下所示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51990665234554266000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   color: hsl(0, 0%, -100%); /* 解析为 hsl(0, 0%, 0%)，黑色 */\n   color: hsl(0, 0%, 200%); /* 解析为 hsl(0, 0%, 100%)，白色 */\n}`, `51990665234554266000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0%<span class="token punctuation">,</span> -100%<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 解析为 hsl(0, 0%, 0%)，黑色 */</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0%<span class="token punctuation">,</span> 200%<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 解析为 hsl(0, 0%, 100%)，白色 */</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种边界特性配合 CSS 变量可以在 CSS 中实现类似于 if…else 的逻辑判断，可以用在元素显隐或者色值变化的场景。</p>\n<h3 id="自动配色按钮"><a href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E8%89%B2%E6%8C%89%E9%92%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自动配色按钮</h3>\n<p>借助透明度和颜色的边界特性可以实现这样一个效果：如果按钮背景颜色比较浅，则按钮的文字颜色自动变成黑色，同时显示边框；如果按钮的背景颜色比较深，则按钮的文字颜色自动变成白色。CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53404233697258815000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`:root {\n   /* 定义 RGB 变量 */\n   --red: 44;\n   --green: 135;\n   --blue: 255;\n   /**\n   * 使用 sRGB Luma 方法计算灰度（可以看成亮度），算法为：\n   * lightness = (red * 0.2126 + green * 0.7152 + blue * 0.0722) / 255\n   */\n   --lightness: calc((var(--red) * 0.2126 + var(--green) * 0.7152 + var(--blue) * 0.0722) / 255);\n}\n\n.button {\n   /* 固定样式 */\n   border: 0.2em solid;\n   /* 按钮背景色就是基本背景色 */\n   background: rgb(var(--red), var(--green), var(--blue));\n   /**\n   * --lightness 亮度和 0.5 对比\n   * 大于，则正数，和 -999999% 相乘，会得到一个巨大负数，浏览器会按照边界 0% 渲染，也就是亮度为 0，于是颜色是黑色；\n   * 小于，则和 -999999% 相乘，会得到一个巨大的正数，以最大合法值 100% 渲染，于是颜色是白色；\n   */\n   color: hsl(0, 0%, calc((var(--lightness) - 0.5) * -999999%));\n   /**\n   * 深色颜色加一点浅一点颜色的阴影\n   */\n   text-shadow: 1px 1px rgba(calc(var(--red) + 50), calc(var(--green) + 50), calc(var(--blue) + 50), calc((\n                  var(--lightness) - 0.5\n               ) * 9999));\n   /**\n   * 确定边框透明度。\n   * 如果亮度比 0.8 大，在说明按钮背景色比较淡，我们出现一个深色边框；\n   * 如果亮度比较小，说明按钮背景色较深，没有必要出现边框。\n     此时，计算后为负值，透明度小于 0 的时候，浏览器会按照 0 渲染，因此边框透明。\n   */\n   /* 设置边框相关样式 */\n   border-color: rgba(\n      calc(var(--red) - 50),\n      calc(var(--green) - 50),\n      calc(var(--blue) - 50),\n      calc((var(--lightness) - 0.8) * 100)\n   );\n}`, `53404233697258815000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">:root</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* 定义 RGB 变量 */</span>\n   <span class="token property">--red</span><span class="token punctuation">:</span> 44<span class="token punctuation">;</span>\n   <span class="token property">--green</span><span class="token punctuation">:</span> 135<span class="token punctuation">;</span>\n   <span class="token property">--blue</span><span class="token punctuation">:</span> 255<span class="token punctuation">;</span>\n   <span class="token comment">/**\n   * 使用 sRGB Luma 方法计算灰度（可以看成亮度），算法为：\n   * lightness = (red * 0.2126 + green * 0.7152 + blue * 0.0722) / 255\n   */</span>\n   <span class="token property">--lightness</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--red<span class="token punctuation">)</span> * 0.2126 + <span class="token function">var</span><span class="token punctuation">(</span>--green<span class="token punctuation">)</span> * 0.7152 + <span class="token function">var</span><span class="token punctuation">(</span>--blue<span class="token punctuation">)</span> * 0.0722<span class="token punctuation">)</span> / 255<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.button</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* 固定样式 */</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> 0.2em solid<span class="token punctuation">;</span>\n   <span class="token comment">/* 按钮背景色就是基本背景色 */</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--red<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">var</span><span class="token punctuation">(</span>--green<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">var</span><span class="token punctuation">(</span>--blue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">/**\n   * --lightness 亮度和 0.5 对比\n   * 大于，则正数，和 -999999% 相乘，会得到一个巨大负数，浏览器会按照边界 0% 渲染，也就是亮度为 0，于是颜色是黑色；\n   * 小于，则和 -999999% 相乘，会得到一个巨大的正数，以最大合法值 100% 渲染，于是颜色是白色；\n   */</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0%<span class="token punctuation">,</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--lightness<span class="token punctuation">)</span> - 0.5<span class="token punctuation">)</span> * -999999%<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">/**\n   * 深色颜色加一点浅一点颜色的阴影\n   */</span>\n   <span class="token property">text-shadow</span><span class="token punctuation">:</span> 1px 1px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--red<span class="token punctuation">)</span> + 50<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--green<span class="token punctuation">)</span> + 50<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--blue<span class="token punctuation">)</span> + 50<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>\n                  <span class="token function">var</span><span class="token punctuation">(</span>--lightness<span class="token punctuation">)</span> - 0.5\n               <span class="token punctuation">)</span> * 9999<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">/**\n   * 确定边框透明度。\n   * 如果亮度比 0.8 大，在说明按钮背景色比较淡，我们出现一个深色边框；\n   * 如果亮度比较小，说明按钮背景色较深，没有必要出现边框。\n     此时，计算后为负值，透明度小于 0 的时候，浏览器会按照 0 渲染，因此边框透明。\n   */</span>\n   <span class="token comment">/* 设置边框相关样式 */</span>\n   <span class="token property">border-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>\n      <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--red<span class="token punctuation">)</span> - 50<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--green<span class="token punctuation">)</span> - 50<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--blue<span class="token punctuation">)</span> - 50<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token function">calc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--lightness<span class="token punctuation">)</span> - 0.8<span class="token punctuation">)</span> * 100<span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时 .button 按钮的文字颜色、文字阴影和边框颜色都是由 —red、—green、—blue 这 3 个变量决定的，而且前景颜色、背景颜色和边框颜色是自动适配的。</p>\n<p>图 4-3 所示的是使用不同的 R、G、B 色值后的按钮效果，可以看到深色背景的按钮的文字颜色是白色（图 4-3 左图）；浅色背景的按钮的文字颜色是黑色，还有浅色的投影（图 4-3 中图）；当背景颜色足够浅的时候，边框也出现了（图 4-3 右图）。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-19-15-34-44-1133ba8dd0bd3844a26b16b415712ca8-932f0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.09378663540446%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABpElEQVQY0z2QS47TUBBFvQM2A6tgyjYYIJBYBGwggFqISYtWTxiBxEdECqY70I6/cRK37bjT9rMTx4l/eX5+n+J5QqlGR/dWXV0F9glUW6j2gEtoc+hPQBmgCBJ/gE0B9W6AcqI1uHM4HsBbQZYCxsqlDh/+wMeZuJjBWxWcVKp4PCmCL7k/JXKDa1EOEO7i3A1TJy7m82CRVVnHlUev4eEreHIGj0fw4CW8UaVMjEdw8WL37un0/TPj8jkJfknIfu74+SoffVXPVPM8aPR9r0xDKn9eBew6ZGOPbQoqzVlIXYO5JtM0gZbssCXSjUpspp2B+pt7ktQ4r1ul77Eei7zqeyoVhOCWc4777i/i40hoiElYtxUIgTExY3G1Fr9DnpXs1NRK2eCJzz9ZXN/0cUHKquGMVk038elnhy4Scp93ZVkJzqsGqyH9vqLfluyHxxtpbk5ksRWLlNupMJE8j0Hwrmf+AW734GRgpDLPEJtQuj6CFDuIW0g07UkZ+hFiKDNaJ5uoKI66YXu3/ky7cWzLW7qmrpmWo5uW7cxty0pR8t/yD1bUrfGWRPi2AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 19 15 34 44" title="" data-src="/static/2022-01-19-15-34-44-1133ba8dd0bd3844a26b16b415712ca8-fee1c.png" data-srcset="/static/2022-01-19-15-34-44-1133ba8dd0bd3844a26b16b415712ca8-a67b7.png 200w,\n/static/2022-01-19-15-34-44-1133ba8dd0bd3844a26b16b415712ca8-0b187.png 400w,\n/static/2022-01-19-15-34-44-1133ba8dd0bd3844a26b16b415712ca8-fee1c.png 800w,\n/static/2022-01-19-15-34-44-1133ba8dd0bd3844a26b16b415712ca8-932f0.png 853w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>原理其实很简单，有了 R、G、B 色值我们就可以计算出亮度 —lightness。</p>\n<ul>\n<li>这里 color 属性使用的是 HSL 颜色，L 的值是 0%，即黑色；如果 L 的值是 100%，则是白色。L 色值的计算公式是 <code class="language-text">var((--lightness) - 0.5) * -999999%</code>。如果亮度大于 0.5，则是一个正数和 -999999% 相乘，最后计算结果是一个巨大的负数，这时会按照 L 色值的最小边界 0% 渲染，于是文字颜色就是黑色；如果亮度小于 0.5，则是一个负数和 -999999% 相乘，最后结果就是一个很大的正数，这时会按照 L 色值的最大边界 100% 渲染，于是文字颜色就是白色。</li>\n<li>我们重点关注 text-shadow 属性的 <code class="language-text">(var(--lightness) - 0.5) * 9999</code> 这个计算。如果亮度大于 0.5，则最终的计算值极大概率大于 1，因此透明度就是 1，文字投影会显示；如果亮度小于 0.5，则最终的计算值一定是负数，此时会按照透明度的边界值 0 来渲染，于是文字投影就不会显示。这就实现了背景颜色亮度比较高时显示更强的文字投影效果。</li>\n<li>border-color 边框颜色的出现和 text-shadow 的出现类似，只不过边框颜色比背景颜色更深。边框颜色是在亮度大于 0.8 的时候显示，这样，按钮在白色页面中也不会显得刺眼。</li>\n</ul>\n<p>本案例中使用亮度 0.5 和亮度 0.8 作为判断点，不过这不一定是最佳判断点，在实际开发的时候大家可以根据自己的需求进行调整。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/3sco9i?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="静态饼图"><a href="#%E9%9D%99%E6%80%81%E9%A5%BC%E5%9B%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>静态饼图</h3>\n<p>这个案例将展示如何利用 opacity 属性的边界特性控制元素的显示与隐藏。图 4-4 所示的就是利用 opacity 属性的边界特性实现的静态饼状图效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-19-15-57-44-95e922b38b7b8b5223abb074500e8a41-5e5c6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.83040935672514%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABjElEQVQY0z2Qu24TQRSGRwKkyIgmT4F4ChoaJEoKIqWjAImegpCKHokij0ERiaRInNiRkEwo4hBC4ux6N8G52Z7rmvVlZs/8zK4Rpziab858c84M6w+GN2lM4wxVcMF7adfKoa/QGJ3EkRN9eAroZlMen4wHV0CJDGS/DNyny7Cu6r5oa7t6DmFL2RKlI7ua+mhcYjTBhx7eJWgZVLIevjnKXxxMMMvzmbOaf04N28CzH5g68kb8vJFsyz9sIZ3g0TewLarVqdbAwQhspET9KutxmRutTBbk9d8Zq+N+E69P/VJ7+jHKH+x5tovnR1ho4F4DtaZn21g+BuNCjJSUQhiT/clzwbmQ8vG+XdzD2xhsE3d2EMyFXawkZWY7uNsI/fE+AdNKBV8qZa31RFLrqeKta73W887j6WFoUvZ5eVo+8lUHYaiAT9rIHBgRBa0oCvwLb50riOYwIXw12M8wZ/L4nqGpyv3qw/5LVY67SZj7+rb/qxOdxd3jk875WeciiodChWpB81PlLWH1F+kqnEPHR0adAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 19 15 57 44" title="" data-src="/static/2022-01-19-15-57-44-95e922b38b7b8b5223abb074500e8a41-fee1c.png" data-srcset="/static/2022-01-19-15-57-44-95e922b38b7b8b5223abb074500e8a41-a67b7.png 200w,\n/static/2022-01-19-15-57-44-95e922b38b7b8b5223abb074500e8a41-0b187.png 400w,\n/static/2022-01-19-15-57-44-95e922b38b7b8b5223abb074500e8a41-fee1c.png 800w,\n/static/2022-01-19-15-57-44-95e922b38b7b8b5223abb074500e8a41-5e5c6.png 855w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>饼状图的比例通过 CSS 变量 —percent 控制，HTML 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83143975563288500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<h4>10% 大小</h4>\n<div class=&quot;pie-simple&quot; style=&quot;--percent: 10;&quot;>\n   <div class=&quot;pie-left&quot;></div>\n   <div class=&quot;pie-right&quot;></div>\n</div>\n<h4>40% 大小</h4>\n<div class=&quot;pie-simple&quot; style=&quot;--percent: 40;&quot;>\n   <div class=&quot;pie-left&quot;></div>\n   <div class=&quot;pie-right&quot;></div>\n</div>`, `83143975563288500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">></span></span>10% 大小<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pie-simple<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--percent</span><span class="token punctuation">:</span> 10<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pie-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pie-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">></span></span>40% 大小<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pie-simple<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--percent</span><span class="token punctuation">:</span> 40<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pie-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pie-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19588325419967357000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.pie-simple {\n   width: 128px;\n   height: 128px;\n   background-color: #eee;\n   border-radius: 50%;\n   overflow: hidden;\n}\n\n.pie-left,\n.pie-right {\n   width: 50%;\n   height: 100%;\n   float: left;\n   position: relative;\n   overflow: hidden;\n}\n\n.pie-left::before,\n.pie-right::before,\n.pie-right::after {\n   content: \'\';\n   position: absolute;\n   width: 100%;\n   height: 100%;\n   background-color: deepskyblue;\n}\n\n.pie-left::before {\n   left: 100%;\n   transform-origin: left;\n   transform: rotate(calc(3.6deg * (var(--percent) - 50)));\n   /* 比例小于或等于 50% 的时候左半圆隐藏 */\n   opacity: calc(99999 * (var(--percent) - 50));\n}\n\n.pie-right::before {\n   right: 100%;\n   transform-origin: right;\n   transform: rotate(calc(3.6deg * var(--percent)));\n}\n\n.pie-right::after {\n   /* 比例大于 50% 的时候左半圆一直显示 */\n   opacity: calc(99999 * (var(--percent) - 50));\n}`, `19588325419967357000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css{33, 44}"\n              >\n                <span class="gatsby-code-button-language">css{33, 44}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.pie-simple</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 128px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 128px<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.pie-left,</span>\n<span class="token selector">.pie-right</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n   <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.pie-left::before,</span>\n<span class="token selector">.pie-right::before,</span>\n<span class="token selector">.pie-right::after</span> <span class="token punctuation">{</span>\n   <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.pie-left::before</span> <span class="token punctuation">{</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token property">transform-origin</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>3.6deg * <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--percent<span class="token punctuation">)</span> - 50<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">/* 比例小于或等于 50% 的时候左半圆隐藏 */</span>\n<span class="gatsby-highlight-code-line">   <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>99999 * <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--percent<span class="token punctuation">)</span> - 50<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">}</span>\n\n<span class="token selector">.pie-right::before</span> <span class="token punctuation">{</span>\n   <span class="token property">right</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token property">transform-origin</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>3.6deg * <span class="token function">var</span><span class="token punctuation">(</span>--percent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.pie-right::after</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* 比例大于 50% 的时候左半圆一直显示 */</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>99999 * <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--percent<span class="token punctuation">)</span> - 50<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实现原理如下所述。</p>\n<p>左右两个矩形区域拼接，且左右两个矩形中都有一个会跟着旋转的半圆，由 .pie-left::before 和 .pie-right::before 这两个 ::before 伪元素创建，我们可以称它们为“左半圆”和“右半圆”。右边的矩形里面还藏了一个不会旋转的撑满整个矩形的半圆，我们可以称它为“右覆盖圆”，由 .pie-right::after 创建。</p>\n<ol>\n<li>左半圆和右半圆一直处于旋转状态。</li>\n<li>比例不大于 50% 时候，左半圆隐藏，右半圆显示，因此只能看到右半圆旋转。</li>\n<li>比例大于 50% 时候，左半圆显示，于是可以看到左半圆旋转，同时右覆盖圆显示，挡住后面的右半圆。此时可以看到右侧完整的静止半圆和左侧旋转的左半圆。</li>\n</ol>\n<p>可以看出，我们除了要控制左右半圆的旋转，还需要控制左半圆和右覆盖圆的显隐，这个效果非常巧妙地利用了 opacity 属性的边界特性来实现，关键 CSS 代码见上面代码的高亮行。</p>\n<p>假设 —percent 的值是 40，也就是 40% 范围的饼状图，将 40 代入 <code class="language-text">99999 * (var(--percent) - 50)</code> 计算可以得到 -999990 的结果，opacity: -999990 等同于 opacity: 0，也就是饼状图百分比不足 50% 的时候，左半圆和右覆盖圆是隐藏的，只有右半圆在旋转。假设 —percent 的值是 80，可以发现最终的 opacity 计算值远大于 1，此时会按照 opacity: 1 渲染，也就是饼状图百分比大于 50% 的时候，左半圆和右覆盖圆是显示的。于是，我们就实现了一个基于 CSS 变量自动绘制的饼状图效果了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/3imbjk?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="深入了解圆角属性-border-radius"><a href="#%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3%E5%9C%86%E8%A7%92%E5%B1%9E%E6%80%A7-border-radius" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入了解圆角属性 border-radius</h1>\n<p>border-radius 属性是一个典型的符合“二八原则”的 CSS 属性，也就是说要想深入了解 border-radius 属性，需要花费额外 80% 的学习精力，但是用这一部分精力所学到的知识只能用在 20% 的场景中。</p>\n<p>在日常开发中，我们使用 border-radius 属性的场景无非下面两类。</p>\n<ol>\n<li>\n<p>为按钮、输入框等控件，或者为背景色块增加小圆角，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40108703873613290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`input,\nbutton {\n  border-radius: 4px;\n}`, `40108703873613290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">input,\nbutton</span> <span class="token punctuation">{</span>\n  <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>将用户头像变成圆形：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90273121746492500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.user-avatar {\n  border-radius: 50%;\n}`, `90273121746492500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.user-avatar</span> <span class="token punctuation">{</span>\n  <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>上面两类场景就满足了日常 80% 与圆角相关的开发需求了，那么到此结束了吗？显然没有，如果继续深入了解 border-radius 属性，你会发现 border-radius 属性远没有你想的那么简单，它可以呈现的效果也绝对超出你的预期。</p>\n<h2 id="了解-border-radius-属性的语法"><a href="#%E4%BA%86%E8%A7%A3-border-radius-%E5%B1%9E%E6%80%A7%E7%9A%84%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 border-radius 属性的语法</h2>\n<p>我们平时使用的 border-radius 属性其实是一种缩写，它是 border-top-left-radius、border-top-right-radius、border-bottom-left-radius 和 border-bottom-right-radius 这 4 个属性的缩写。这 4 个属性的圆角位置如图 4-5 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-10-34-32-4012fa665ded792dae6be62e1f4ab61d-51e2b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.43619489559165%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABOElEQVQoz4VS20rDQBBdoaD4LX6A4oPv6jfou7/jq/+hSIvU19pqkxITWmztxRar6SVrgrnMcWYDpVGwh8PsZuacHXayCmmKLBPyhjmZIFiAQQSzgFKJkzF8v6AkUlgDq/AdXnX0UROnTRzntHFi0es7n0gZCiiYE2lGZw7UNUoVqLJwi+MtaoGUUtpkvnBJVbB7j+2qcKcKdYf6QmobzTjnzjcolf92/tcsd6b4sh3u1XDYwH7dsIGDB3r50FzMfpt5ejzYPDJ42tOpbDIzZJmRicMBtDZ5ozRUcF1hrwfPg+Og28VgILQsUef54RCdDlotjEawbfT7YvE8tTom7xzH8Ww2T+I4+go/fQF/aq3nnEwS0XDMX8H6fyZjXi6XrtcOo2j0Nq4/PjGdZ6/b67ccNwiClSzHD9b3Izn4ZLazAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 10 34 32" title="" data-src="/static/2022-01-21-10-34-32-4012fa665ded792dae6be62e1f4ab61d-fee1c.png" data-srcset="/static/2022-01-21-10-34-32-4012fa665ded792dae6be62e1f4ab61d-a67b7.png 200w,\n/static/2022-01-21-10-34-32-4012fa665ded792dae6be62e1f4ab61d-0b187.png 400w,\n/static/2022-01-21-10-34-32-4012fa665ded792dae6be62e1f4ab61d-fee1c.png 800w,\n/static/2022-01-21-10-34-32-4012fa665ded792dae6be62e1f4ab61d-51e2b.png 862w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这 4 个属性很好理解，因为属性名称就暴露了一切，例如 border-top-left-radius 显然就是用来设置左上角圆角大小的。不过，虽然它们好理解，但是不好记忆，一段时间后就会不记得到底是 border-top-left-radius 还是 border-left-top-radius。我是使用这种方法让自己记住的：圆角属性的方位顺序和中文表述是相反的。例如中文我们都是说左上角、右上角，或者左下角、右下角，顺序是先左右再上下，但是，CSS 圆角属性却是先上下再左右，例如 border-top-left-radius 先是 top 再是 left，又如 border-bottom-right-radius 先是 bottom 再是 right。</p>\n<h3 id="1-～-4-个值表示的方位"><a href="#1-%EF%BD%9E-4-%E4%B8%AA%E5%80%BC%E8%A1%A8%E7%A4%BA%E7%9A%84%E6%96%B9%E4%BD%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1 ～ 4 个值表示的方位</h3>\n<p>border-radius 属性支持 1 ～ 4 个值，分别表示不同的角。</p>\n<ol>\n<li>\n<p>如果只有 1 个值，则表示圆角效果作用在全部 4 个角，效果如图 4-6 所示，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54458471449242075000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-radius: 10px;`, `54458471449242075000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-10-43-24-182c26c7d19d365dc80c8cc1dc4fbf18-927fb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 439px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.66970387243736%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABWElEQVQoz7WRy07CQBSGp6ALE2NQfAPj0rhxYVxofA6XPotv4oIoEcI9KKWlqGhQ4jUukSqXlrY0bSXt4Bw7g4mkhKUnX04m0/+ff+YUAatvQvtRE9auYfMWNqbwN9drcPAKmClZAzRp3q4DKkKYB1QKwvn9AhZF6LhMP23ea1DFnABcOUioDIiHqAQ9d0byLjOHBUDlIBwzL/+Xeb9BnzcvQkgIMj5xtQqKN8O8cwfoHMIsJADHprhUge7kwAirsfnwzZ8WiUokIkGkQiZZqZAFkWzViUX/la+n9Zs8riGBdw9kD1ouRWZrGVM+MP1kjv7uTJPbna6m6V/DIcZ4hLFt6D6eY7mO5QwMS9cGfdXsq4aiOIZhm+Znu9NTVMu2FbWPYidnvCA9Pr0MTFPVdLFaS2YKzZZ8//AcO03mi6VcsZRI545j8XgiXSjyiVQ2nS1cXt2kMvkf2fgMaKwo6VEAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 10 43 24" title="" data-src="/static/2022-01-21-10-43-24-182c26c7d19d365dc80c8cc1dc4fbf18-927fb.png" data-srcset="/static/2022-01-21-10-43-24-182c26c7d19d365dc80c8cc1dc4fbf18-8b407.png 200w,\n/static/2022-01-21-10-43-24-182c26c7d19d365dc80c8cc1dc4fbf18-c4ab1.png 400w,\n/static/2022-01-21-10-43-24-182c26c7d19d365dc80c8cc1dc4fbf18-927fb.png 439w" data-sizes="(max-width: 439px) 100vw, 439px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>如果有 2 个值，则第一个值作用于左上角和右下角，第二个值作用于右上角和左下角，效果如图 4-7 所示，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="839714726377427300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-radius: 10px 50%;`, `839714726377427300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 10px 50%<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-10-44-47-d984055486bfe7ef61c0d3f5041f9ee6-bb574.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 410px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.243902439024396%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABdUlEQVQoz6WRy07CUBCGT0Xj0oWP4TOY6MK1z+DCRBcuTXwDd25c+BYauQQopS2KRDEiN2kLrUQosKigQa4JPeOcEgsKrJz8PTmd/N8/6ZQAAAVW9SHs5mAzBdvPsPWjnTTsKXBRg8YQXKdbBJ+R0ws1gfDARYFMSwAuAiQCa7dwVgVYBIcRFsEjw9JveRwtiSz6xGBOm87CLQZzEpB5GvdXJVC6E34CCw6Mo8giXmYf4nsHFyFujDmA9RjjV+T581kzCv4/sPtybrLdcAKbvzwjDMVo3yzs/oZLCzaSwIksBVc9LQzFnQWmYdupMWxTPOhgRMUWPS3TI40eqCgbz0PV3lfpsU6tIZopOpEi8I8iyceUYZRbH5/t9lev38/lC7V6481sZAtaOq8oJSOnFp+yL8lUJlPQ9HIlnc0XS0ZJf0UnufIG5Ju4ZTW7vV6n0wmGBU3TK1UzxIt4v0s8hPjotS+IigiSFIt7/cF44j6VzvCC9A3PA0Oh/8Lw6gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 10 44 47" title="" data-src="/static/2022-01-21-10-44-47-d984055486bfe7ef61c0d3f5041f9ee6-bb574.png" data-srcset="/static/2022-01-21-10-44-47-d984055486bfe7ef61c0d3f5041f9ee6-0fa18.png 200w,\n/static/2022-01-21-10-44-47-d984055486bfe7ef61c0d3f5041f9ee6-c3228.png 400w,\n/static/2022-01-21-10-44-47-d984055486bfe7ef61c0d3f5041f9ee6-bb574.png 410w" data-sizes="(max-width: 410px) 100vw, 410px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>如果有 3 个值，则第一个值作用于左上角，第二个值作用于右上角和左下角，第三个值作用于右下角，效果如图 4-8 所示，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77642170577898060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-radius: 10px 50% 30px;`, `77642170577898060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 10px 50% 30px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-10-45-58-f82522cee97c277573ca87abee3f78ce-0208c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 493px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.50304259634888%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAB0ElEQVQoz5WS3Y7SQBTHC34kemOi8QW8MXFfYF/CS9/FW9c770y88AEMTyDQQvmoJWzKQpfNBnVTga1LlqVFWmixsWXO3xmQRtS98OSfmcnM+Z2PmZHg+5BlNJtwne+AH9M8we/6QdgYnylOEEUIQzDGdyQsl6w/QNccTuaPWrin0QMd97d62MATA896yF1RzN0/9qhYRC6HyWQNA6t17LoHSYVU/UsVZMriaN+ENV0iCtkiQBxvYSYq0j0SrrU/lanhRl1IKmGvBW/1q4WdzJqHf8Kpbq35tyOkiICZyMwMj2WrlK1fC4vkZTzvCyxJ4U0NIcNjQ/R2W0P2OljdwCxZMRAJGEGwGo1gD5Tz+V2dh6dMVbje3BUPKil4fbFbNiwLlQorFNC3TmM8PaE7mmiPF5kqy0eZ9tpwzi9hdpht8weXaGvra+fdi5v/HNK7Mb2y6WBAB0N6OaQXA3pzwcYJ8NVm+TwpCjmOhNSI8J8mue40CMKQ/zPGPN+fzxeLIHBnnuv5znQ2dqaXE3c6E2vnmzfj5xuPIOSgVFJrrbbZ+3QWRVG7c3zUOba+9Aty+YPe1BuH+WLpfUGpaQ21UlerWqNpHBpHHbPbPTmVS5WfqHR49OVIWW4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 10 45 58" title="" data-src="/static/2022-01-21-10-45-58-f82522cee97c277573ca87abee3f78ce-0208c.png" data-srcset="/static/2022-01-21-10-45-58-f82522cee97c277573ca87abee3f78ce-1777c.png 200w,\n/static/2022-01-21-10-45-58-f82522cee97c277573ca87abee3f78ce-1db89.png 400w,\n/static/2022-01-21-10-45-58-f82522cee97c277573ca87abee3f78ce-0208c.png 493w" data-sizes="(max-width: 493px) 100vw, 493px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>如果有 4 个值，则 4 个值按照顺时针方向依次作用于左上角、右上角、右下角和左下角，效果如图 4-9 所示。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13481478390081160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-radius: 10px 50% 30px 0;`, `13481478390081160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 10px 50% 30px 0<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-10-46-58-3a26dcc1c79db52df7973fabfdaa17e4-6a9ea.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 413px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.35351089588377%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABU0lEQVQoz6WQ30pCQRDG14SkR+m+q7qMgvCiuo5eJOhFQoIwK8MiQkw9HjUSIojS1ArRPR419aCZN5lBZ79mPeQfsotq+C0MM9+3s7MMgICMNxPr95i5xtwNZr+gfDmNDY5EG2ZPZomtYHTMXoF34IiCRWBTwYahigIWxVIKpa5Umt/NhQ6mzqXIHsPEEPa4hBIWxvQVau+D+SNmR89sI904JqkbwiaX4g/xSzPNpxVW03+abJlXfjKP3bmPfLaCtSz6loE5/wqHKn9F/u04rPpRY2hnIYQpZFrtCucd5pNikUiJheQot8KZEl6DlFJvBcM/guXyhVK58txqtV7adBnXioZhNJrNet3QNL1Sqep6ifNigWu6Xn6qGZRoRZ261GK7e4f+QCiTfaAqmU/9Z4oae8zlI2p8y7VDrUBQcXu8JHNtu4Nhdd/rOz7xXyQuPQe+T128OFCJm6fAAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 10 46 58" title="" data-src="/static/2022-01-21-10-46-58-3a26dcc1c79db52df7973fabfdaa17e4-6a9ea.png" data-srcset="/static/2022-01-21-10-46-58-3a26dcc1c79db52df7973fabfdaa17e4-7efe1.png 200w,\n/static/2022-01-21-10-46-58-3a26dcc1c79db52df7973fabfdaa17e4-33ab6.png 400w,\n/static/2022-01-21-10-46-58-3a26dcc1c79db52df7973fabfdaa17e4-6a9ea.png 413w" data-sizes="(max-width: 413px) 100vw, 413px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ol>\n<h3 id="水平半径和垂直半径"><a href="#%E6%B0%B4%E5%B9%B3%E5%8D%8A%E5%BE%84%E5%92%8C%E5%9E%82%E7%9B%B4%E5%8D%8A%E5%BE%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>水平半径和垂直半径</h3>\n<p>还有很多人不知道我们平时使用的圆角值也是一种缩写。例如，下面 CSS 代码中的 10px 就是一种缩写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99411294900332150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-top-left-radius: 10px;`, `99411294900332150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>它等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88531696557925190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-top-left-radius: 10px 10px;`, `88531696557925190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> 10px 10px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，第一个值表示水平半径，第二个值表示垂直半径。又如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9707974829696030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-top-left-radius: 30px 60px;`, `9707974829696030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> 30px 60px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示左上角的圆角是由水平半径（短半轴）为 30px、垂直半径（长半轴）为 60px 的椭圆产生的，效果如图 4-10 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-10-50-09-819cfc082534c96396cfd8f0ebf6649d-35f69.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 736px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.1141304347826%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABX0lEQVQoz52Q7UoCQRSGx7SgO4h+RF1Ut1DkBfSnWwm6hv6prdpWlCKKIoQfi+z3mpv7Ua6rNc7bzAqxBfajwzNnzgzzvucwBPU6Oh20WrBtNJtQFLTb4kbX0WiwWo36Ae316Y1EDZN2u1SWqWlRgK4YgevC8zCdIo7hOAhDQRRxL2aaCDwsZlhGmDqIZ4jeRLGIkATBhmB8aeo4eD/XcDpg+RHOlIQR8kOc9HAx+iVm7Fu54hv9OO5QUkC2BFJiRGRBhucC9u42dF4lJr05dmVkqti+RS4FP5Iqjp42iGkivnZBJGwlT9NwO1LBweOf4itbiLP/FDsgZezIQp8ml9gdrsdmqX9a159JvrRAiixb5v0ZHyHJgowkPm//YUPntZm9RNFHOfhBJRRIAe59EN6qNxgapuX5wcR9VTXdsh3LcjTDnNj2/MVauGNPG8XuODDV0NL05+5E6buGyt2/AMMJLhFUP7ZtAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 10 50 09" title="" data-src="/static/2022-01-21-10-50-09-819cfc082534c96396cfd8f0ebf6649d-35f69.png" data-srcset="/static/2022-01-21-10-50-09-819cfc082534c96396cfd8f0ebf6649d-0149d.png 200w,\n/static/2022-01-21-10-50-09-819cfc082534c96396cfd8f0ebf6649d-cfc3c.png 400w,\n/static/2022-01-21-10-50-09-819cfc082534c96396cfd8f0ebf6649d-35f69.png 736w" data-sizes="(max-width: 736px) 100vw, 736px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果是 border-radius 属性，则水平半径和垂直半径不是通过空格进行区分，而是通过斜杠区分。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80600853123795680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-radius: 30px / 60px;`, `80600853123795680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 30px / 60px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示 4 个角落的圆角的水平半径都是 30px，垂直半径都是 60px，效果如图 4-11 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-10-53-04-b5ecb8d9b72f859c262b92b4563c0679-94f8a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 546px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.238095238095234%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABM0lEQVQoz4WQz07CQBDGV6vxXfRkfAnvJsab3jz7Al788wjePXnxASQgBVQiVWwLrSWICBojakxMS/8A237OFrQkGJ39MpnZfL+d7DB8RxRnL8S6hXkFS9dYjEXFgoI1EzZPbMNgPxWPrw9fwFKQsmCniUSbwsFzYvsd3rDAMpjNYVpORC1drhr/wSsGWBoSueVEUgwv68IQ/gFv1QU8l8dMLhG1BG/WJiZHUTQOFz6Fj/iptMhDDeuTj5GNDnkJZGPLG23y+B3bD9hrY7eNnRb2n0R79IbJYLbjeJ4fBD3O+WBAiYP36WuI4oJmBC49G/Z7ruuGYdjturZti+w4TM6fGabV6bz6vl+/u9er5pVWabQe1eptWTNqjWZZN0o3umZaJaWs6tWL4mUmm1e1SuG8+AWKZ8mQgy7uzQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 10 53 04" title="" data-src="/static/2022-01-21-10-53-04-b5ecb8d9b72f859c262b92b4563c0679-94f8a.png" data-srcset="/static/2022-01-21-10-53-04-b5ecb8d9b72f859c262b92b4563c0679-e2b97.png 200w,\n/static/2022-01-21-10-53-04-b5ecb8d9b72f859c262b92b4563c0679-db056.png 400w,\n/static/2022-01-21-10-53-04-b5ecb8d9b72f859c262b92b4563c0679-94f8a.png 546w" data-sizes="(max-width: 546px) 100vw, 546px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>斜杠前后都支持 1 ～ 4 个长度值。因此，下面的语法都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71065950678966020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 左上 右上+左下 右下 / 左上 右上+左下 右下 */\nborder-radius: 10px 5px 2em / 20px 25px 30%;\n/* 左上+右下 右上+左下 / 左上 右上 右下 左下 */\nborder-radius: 10px 5% / 20px 25em 30px 35em;`, `71065950678966020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 左上 右上+左下 右下 / 左上 右上+左下 右下 */</span>\n<span class="token property">border-radius</span><span class="token punctuation">:</span> 10px 5px 2em / 20px 25px 30%<span class="token punctuation">;</span>\n<span class="token comment">/* 左上+右下 右上+左下 / 左上 右上 右下 左下 */</span>\n<span class="token property">border-radius</span><span class="token punctuation">:</span> 10px 5% / 20px 25em 30px 35em<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在了解了语法，那这里的水平半径和垂直半径究竟是如何作用才让边角产生圆角效果的呢？这个问题就是接下来要深入探讨的。</p>\n<h2 id="弄懂圆角效果是如何产生的"><a href="#%E5%BC%84%E6%87%82%E5%9C%86%E8%A7%92%E6%95%88%E6%9E%9C%E6%98%AF%E5%A6%82%E4%BD%95%E4%BA%A7%E7%94%9F%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>弄懂圆角效果是如何产生的</h2>\n<p>虽然我们口头上都称 border-radius 为圆角属性，实际上 border-radius 属性的字面意思不是“圆角”，而是“边界半径”，也就是圆角效果来自以这个半径值绘制的圆或以半轴值绘制的椭圆。例如，图 4-10 所示左上角的圆角效果是由水平半径为 30px、垂直半径为 60px 的椭圆产生的，原理如图 4-12 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-11-01-58-c20ad2e25de4863b60db5ec05b56c5ee-b2e17.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 623px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.20385232744783%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQoz42Ry07CUBCGJxFCoi5c+waGBzDRF3FpiPENXLt1Q/A5jCaasMBW5BKjICoGpS23ciltKQjtIQERacdDoYbgJfyZTM5k5jszmQGck2EgId1ev6T3SgMs9qeW76H2MV8Ls4FlO6WmbgZr7hMZwiN3DD0xXI4jhHE/N06b1h/wyE74c124IF5W915qnugYc0UQGPTxC8A7N0041TfCZIttrERNuEYX/YJFn/AvPEkc3MrbTGstMoQgWYqNSTo5XOGesEjnRHs9PlyNfMJ5h85MMRf1IdzlFuh8JhqHwsBfeA/wJCBjQMJjCY+qyHS+l+rAlq3ptidvc4T6GxpttEznCJZzClpjB7YAf8gpRHOGs/AXQSL5UJeVhtbqElKpSoViUWu2RLFMrS6rWY5XFDWXL4jlytPjcyqZTmde7+5TmcxLlhO+AN1kE3E7MJPsAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 11 01 58" title="" data-src="/static/2022-01-21-11-01-58-c20ad2e25de4863b60db5ec05b56c5ee-b2e17.png" data-srcset="/static/2022-01-21-11-01-58-c20ad2e25de4863b60db5ec05b56c5ee-5d0dd.png 200w,\n/static/2022-01-21-11-01-58-c20ad2e25de4863b60db5ec05b56c5ee-d9bec.png 400w,\n/static/2022-01-21-11-01-58-c20ad2e25de4863b60db5ec05b56c5ee-b2e17.png 623w" data-sizes="(max-width: 623px) 100vw, 623px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果进一步放大半径值，例如设置垂直半径大小和元素等高，也就是 100% 高度值，如下所示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69907609993401156000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-top-left-radius: 30px 100%;`, `69907609993401156000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> 30px 100%<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果和原理此时如图 4-13 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-11-03-23-321bdedfb19d81e53056658d08d5f48e-3086a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 656px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 70.42682926829268%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABx0lEQVQoz5WQXU8TQRSGZ0s0DXdoTFCjF1gkKvcmJHpRL/wNhJ9gws/g75Aa2wTplyksW7et5aKUtmz5sFRxKfu9lm47r2dqIVqD6MmbycnM+7xnZhiA5Qbuy3isIDIUNQ9kRMtw+3SIAHiTPYwkvkVUOuVkmFXwUMbrbTDVhpQGS49WUojWJGa2YAQCjrd9KWaHYx32vscunUnMKWArB2DruJGFlBlpIgOWwiMFpoD58rYjvbVvx8/Ca144C3ZheJoHW6qImJsfMJEdiYIonu5mDeGo4rF37ovU6WLyYCFnEUxmMsx/BFsoiphQRkT+VGgYTNd2BvTi3vxGl+DJhMMSjpTml4YnNDn6CVM53NvE9IWop53nBe4T69ivNuxnKXc2495ZM6dlYbi7iVs5vCyB0cM6Ac5+F+2YAafB6HZ3t/Lx1Zj29dQ03c4vBnoUw98rCBxdb7Xbve8+PHfskHH6kyskinNYlmgGA24YY4brJpPJskTQ+Tl8f3zytTA8D/2+IIn/b5hIwxARf9Q/wFcXq9cblWpN13XH9bRmc6+hHbe/NOqa1tw/+tyq7FRPTvSdaq1W31MLpUKpnC8UZUVVi+Wj1vEPOiS+a8Pq7NsAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 11 03 23" title="" data-src="/static/2022-01-21-11-03-23-321bdedfb19d81e53056658d08d5f48e-3086a.png" data-srcset="/static/2022-01-21-11-03-23-321bdedfb19d81e53056658d08d5f48e-a142c.png 200w,\n/static/2022-01-21-11-03-23-321bdedfb19d81e53056658d08d5f48e-201ef.png 400w,\n/static/2022-01-21-11-03-23-321bdedfb19d81e53056658d08d5f48e-3086a.png 656w" data-sizes="(max-width: 656px) 100vw, 656px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="重叠曲线的渲染机制"><a href="#%E9%87%8D%E5%8F%A0%E6%9B%B2%E7%BA%BF%E7%9A%84%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重叠曲线的渲染机制</h3>\n<p>左上角和左下角的垂直半径都是 100%，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23425027734838366000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-top-left-radius: 30px 100%;\nborder-bottom-left-radius: 30px 100%;`, `23425027734838366000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> 30px 100%<span class="token punctuation">;</span>\n<span class="token property">border-bottom-left-radius</span><span class="token punctuation">:</span> 30px 100%<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>显然，元素的高度并不足以放下两个半轴为 100% 尺寸的椭圆，如果我们对这种场景不加以约束，则曲线一定会发生重叠，而且曲线的交叉点一定不是平滑的，最后得到的绝对不会是我们想看到的效果。</p>\n<p>因此，CSS 规范对圆角曲线重叠这一问题做了额外的渲染设定，具体算法如下：设置 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo>(</mo><msub><mi>L</mi><mi>h</mi></msub><mi mathvariant="normal">/</mi><msub><mi>S</mi><mi>h</mi></msub><mo separator="true">,</mo><msub><mi>L</mi><mi>v</mi></msub><mi mathvariant="normal">/</mi><msub><mi>S</mi><mi>v</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">f = min(L_h/S_h, L_v/S_v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mpunct">,</span><span class="mord rule" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mclose">)</span></span></span></span>，其中 S 是半径之和，L 是元素宽高，下标 h 和 v 表示方向，f 是计算值，简称“f 计算值”。CSS 圆角曲线的渲染规则很简单，如果 f 计算值小于 1，则所有圆角半径都乘以 f。</p>\n<p>回到这里的例子，左上角和左下角的垂直半径都是 100%，水平半径都是 30px，因此 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo>(</mo><msub><mi>L</mi><mi>h</mi></msub><mi mathvariant="normal">/</mi><msub><mi>S</mi><mi>h</mi></msub><mo separator="true">,</mo><msub><mi>L</mi><mi>v</mi></msub><mi mathvariant="normal">/</mi><msub><mi>S</mi><mi>v</mi></msub><mo>)</mo><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo>(</mo><mn>1</mn><mn>5</mn><mn>0</mn><mi mathvariant="normal">/</mi><mn>6</mn><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mn>0</mn><mn>0</mn><mi mathvariant="normal">/</mi><mn>2</mn><mn>0</mn><mn>0</mn><mo>)</mo><mo>=</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">f = min(L_h/S_h, L_v/S_v) = min(150/60, 100/200) = 0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mpunct">,</span><span class="mord rule" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mclose">)</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">5</span><span class="mord">0</span><span class="mord">/</span><span class="mord">6</span><span class="mord">0</span><span class="mpunct">,</span><span class="mord rule" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">/</span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">)</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span></span>，f 计算值是 0.5，小于 1，所有圆角值都要乘以 0.5，因此：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78715804038809490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-top-left-radius: 30px 100%;\nborder-bottom-left-radius: 30px 100%;`, `78715804038809490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> 30px 100%<span class="token punctuation">;</span>\n<span class="token property">border-bottom-left-radius</span><span class="token punctuation">:</span> 30px 100%<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>实际上，这等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34327570778478300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-top-left-radius: 15px 50%;\nborder-bottom-left-radius: 15px 50%;`, `34327570778478300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> 15px 50%<span class="token punctuation">;</span>\n<span class="token property">border-bottom-left-radius</span><span class="token punctuation">:</span> 15px 50%<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>此时会有图 4-14 所示的效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-11-06-33-0cb1152cce445a55983cbaa4b4abb530-6bfa8.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 44.80369515011547%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABfUlEQVQoz4WRS0tCQRTHRyvaiVBZYA9w2aJFILSraNOuVX2CPkDQxwj6AH6FFoVJSuZV896rYVpWGkoR4vPaAzW8d3zdfzM+Ktp0+DHMnPn/zznMEEcB5hAWwpiVB8zJsIiwX+O1BRbH6Xeb+2Mxou/JykzvlmmsMreQ1TiIF0Y/iDDAyNYLWCWUubm7JdfI6adJaG2EG8QPw7eMWVil/s4wZIRlfbxDpQ206LLUJB667Xo5dN2unRVJgAl0VmUsADLPzH6MstQQnhXA8pUOoDXsoQbxaPvO5JFT3nFnSZAJdGMA40GQlSjIOYw+3q0P33thFVHiY3c2QzVyUjcJzfWIysceyvj8B1mMBzAtYVIcwF7LdImlKCq9B3M8qRZBtYU7u9KbWcRUTzMhcgtp68jTH3JUz1M9R1Gkervb5a0lseD2leuaqtHfSgbR8V9Uq1BK6BX6E9zchwWlzWQqnS+US4pyFY3F4gl2TGaebx4zibvU/UOqoWn894aWLwD+lYNo2xONAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 11 06 33" title="" data-src="/static/2022-01-21-11-06-33-0cb1152cce445a55983cbaa4b4abb530-fee1c.png" data-srcset="/static/2022-01-21-11-06-33-0cb1152cce445a55983cbaa4b4abb530-a67b7.png 200w,\n/static/2022-01-21-11-06-33-0cb1152cce445a55983cbaa4b4abb530-0b187.png 400w,\n/static/2022-01-21-11-06-33-0cb1152cce445a55983cbaa4b4abb530-fee1c.png 800w,\n/static/2022-01-21-11-06-33-0cb1152cce445a55983cbaa4b4abb530-6bfa8.png 866w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>明白了重叠曲线的渲染机制，一些常见却不太理解的现象也就明白了。</p>\n<p>如果元素的高度和宽度是一样的，例如都是 150px，则下面两段 CSS 声明的效果是一样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93933539567940110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-radius: 100%;\nborder-radius: 150px;`, `93933539567940110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n<span class="token property">border-radius</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是，如果元素的高度和宽度是不一样的，例如宽度是 150px，高度是 100px，则下面两段 CSS 声明的效果就不一样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80025622619882180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-radius: 100%;\nborder-radius: 150px;`, `80025622619882180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n<span class="token property">border-radius</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>效果如图 4-15 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-11-27-24-d5a3dcf3a56645a8affb3022e5155326-244cb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.51162790697674%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABlklEQVQoz1VQTU/UQBh+2yB3roa/YUz8Ddz8E0T0TLyamJgYr5xc45WLibelfLQEBUUXdrs1CLsL7lfbnbZpl/1ghZ33caYIgclzmOczkyEcHspqFZUyhI8jFwf7CLrseWyto1zmeoMrLiolhG2cHqP0DX9qqP3G7h5cl1j0kEZpEBVbww+uWK32jtsJRufopzwYcpZxLHbr4v3JoOAlhXKvUBGlToY4VEUC8LaLuT2QA8MBbcPcwcIvNC9xfRYbWjRskH2TcfCyqS161wKtwdzUnpHD3GKlPNrX9ucIZCkFpn0Lpi3QOuwU9PgHFJlx8mH7/8TsNmgT3hCvzkAb91wFTTfwpgl6cQIqan6LB44efvgFE4mPvn6X2rrrzuSBTwLUv8JTTy2xYWnJsJgsnv/KVsIA96/4yU+mIpu5rqAva7zgghnE+a98H+B1C0s1LJ9hNcZQavHaGkmsBHhWw/NGjjoKIS7ygC5PpZykMS4G07/jyyyZ9hMRBoEQ7U7XD4Xf7Yx7/iQR4ygYReE4CqdZLKVUxX/OOZ9zZ+R38AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 11 27 24" title="" data-src="/static/2022-01-21-11-27-24-d5a3dcf3a56645a8affb3022e5155326-fee1c.png" data-srcset="/static/2022-01-21-11-27-24-d5a3dcf3a56645a8affb3022e5155326-a67b7.png 200w,\n/static/2022-01-21-11-27-24-d5a3dcf3a56645a8affb3022e5155326-0b187.png 400w,\n/static/2022-01-21-11-27-24-d5a3dcf3a56645a8affb3022e5155326-fee1c.png 800w,\n/static/2022-01-21-11-27-24-d5a3dcf3a56645a8affb3022e5155326-244cb.png 860w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>为什么会不一样呢？很多人百思不得其解。其实，简单套用一下重叠曲线的算法，一切就豁然开朗了：</p>\n<ul>\n<li>\n<p>border-radius: 100% 的 f 计算值是 0.5，因此，最终的圆角半径都要乘以 0.5，等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68961522863041980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-radius: 75px / 50px;`, `68961522863041980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 75px / 50px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>border-radius: 150px 水平方向的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi mathvariant="normal">/</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">L/S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit">L</span><span class="mord">/</span><span class="mord mathit" style="margin-right:0.05764em;">S</span></span></span></span> 的计算值是 0.5，而垂直方向的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mi mathvariant="normal">/</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">L/S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit">L</span><span class="mord">/</span><span class="mord mathit" style="margin-right:0.05764em;">S</span></span></span></span> 计算值是 100/300，也就是 0.3333，于是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo>(</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo separator="true">,</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>3</mn><mn>3</mn><mn>3</mn><mn>3</mn><mo>)</mo><mo>=</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>3</mn><mn>3</mn><mn>3</mn><mn>3</mn></mrow><annotation encoding="application/x-tex">f = min(0.5, 0.3333) = 0.3333</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mpunct">,</span><span class="mord rule" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">3</span><span class="mord">3</span><span class="mord">3</span><span class="mord">3</span><span class="mclose">)</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">3</span><span class="mord">3</span><span class="mord">3</span><span class="mord">3</span></span></span></span>，也就是所有圆角半径（都是 150px）都要乘以 0.3333，等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63679376520809460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-radius: 50px;`, `63679376520809460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-radius</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n</ul>\n<h2 id="border-radius-属性渲染-border-边框的细节"><a href="#border-radius-%E5%B1%9E%E6%80%A7%E6%B8%B2%E6%9F%93-border-%E8%BE%B9%E6%A1%86%E7%9A%84%E7%BB%86%E8%8A%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>border-radius 属性渲染 border 边框的细节</h2>\n<p>如果元素设置了 border 边框，则圆角半径会被分成内半径和外半径，如图 4-16 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-11-36-53-e7d3fa44bb968986528c935c093e7aad-a4730.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 357px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.187675070028%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAAB0ElEQVQoz6WRTVPTQBjHlwMH6wyDHnUc/UIynD2gM74c/Qqe/CRevPDeYYAaoDMlbEJLtUM3SVPSDAJKk2zavLQDye7jplUrULj4PzyHZ/+/ff7PLoKrYlwUbrTDjxX3/c7puz36aj+cPYTnNZgjEKeZh/8xoxsk+4y9+6sRktjEDqACv7fs55Z99AWmiuAnt8CMZ03j1JueD9EnmCiw3GacK/LJXXi6Rh9uRI8wBAkfDw/7H6o+2uZojb+eD0jL0858rQckYvoJbfSH0UYawdk67PIN9pAE01Kv3ur2Q4COB0kKIhSlcEP/xB6Ut5iK9R4UmfXTF+Ql7YhLU8ZSj6Z3wHyw80u1i1bCKRmsmEOaDB8COh2IoqHpjskwW2OTi/TZZmj1hI9ncBCA58E4XYdnauJ74PF6cPzdAeqydhvi+NrAcbEH9QUBtA1PMNj90Y23wmJVxkS67FyUbgrnF9y9YMmg91e/PVeF4D+EymW18u3QpdR1HPPIFq2249i23Whadc0gdY3oBiG6rplGs2k2jzTD1I2Grhvlg68on19aWF0neuP87IdSroroptWSZXlXUUuyLElbJaxuFKR9papWDzDGW8WSolbwnrKwlP8FEv/16I3SWjQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 11 36 53" title="" data-src="/static/2022-01-21-11-36-53-e7d3fa44bb968986528c935c093e7aad-a4730.png" data-srcset="/static/2022-01-21-11-36-53-e7d3fa44bb968986528c935c093e7aad-11629.png 200w,\n/static/2022-01-21-11-36-53-e7d3fa44bb968986528c935c093e7aad-a4730.png 357w" data-sizes="(max-width: 357px) 100vw, 357px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>其中直线为外半径，圆心到内部虚线圆的距离为内半径。</p>\n<ol>\n<li>\n<p>padding 边缘的圆角大小为设置的 border-radius 大小减去边框的厚度，如果结果为负，则内半径为 0。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4968228163130250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.radius {\n  width: 100px;\n  height: 100px;\n  border-top: 40px solid deepskyblue;\n  border-left: 40px solid deepskyblue;\n  border-radius: 40px 0 0;\n}`, `4968228163130250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.radius</span> <span class="token punctuation">{</span>\n  <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n  <span class="token property">border-top</span><span class="token punctuation">:</span> 40px solid deepskyblue<span class="token punctuation">;</span>\n  <span class="token property">border-left</span><span class="token punctuation">:</span> 40px solid deepskyblue<span class="token punctuation">;</span>\n  <span class="token property">border-radius</span><span class="token punctuation">:</span> 40px 0 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>圆角半径大小和边框的大小均是 40px，此时内半径大小为 0，因此，padding 边缘是直角，没有弧度。最终效果如图 4-17 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-11-42-49-eb8c40ba9ae45306117ec2594cb418ec-66417.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 441px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 75.51020408163265%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAABpUlEQVQoz5WSy0rDQBSG040P4ErwBcSFunErio/hA3hduVbqShCfwgdQLIiovWhoLNqW2oooqZeoaG3FNmmTSVOTmd+ZltqLFPXn53CYOd+czJlIAK4JZq4xksBop8cSGI5jOg2H8iowdEtSbQyeQjqCLwKp02IlhAEFdi94ThVknwxfGFKwwz4eD9Evg/SCJy8ghYXHE2z99nNVg/+B+XnU2JqGlQe2+Qy3i2OsEZtwEMtZirjsFnKt7d/UguezwKfj3GvuW951PbdiuqbllnTPtGCacBx4Hspl2DZyORCCQqEFL6riMI8ysX1zg0AAmQzicSgKLi8Ri+H9HdEokklsbSGdxs5OG5xtwlyc56XVKiwLlYqIjeaGIdbzeVHw8fEDZn+9sLjzVBNe+obbR9qV86ThBjyRqr/qIRbUTvgvnWdV8ScOnWPjSXzx/2Ba78ZN8W9J35lhGLpe9qhHCHFqNUqZRQh3hcu0bLuq63qxWCJ8zu0wqw9AlpXtwL72+HSbvas6teeX14Ng6DiqhMKRk2gsFDlRTs92d/dSmSteTOsv+gUbABvf/lKAQAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 11 42 49" title="" data-src="/static/2022-01-21-11-42-49-eb8c40ba9ae45306117ec2594cb418ec-66417.png" data-srcset="/static/2022-01-21-11-42-49-eb8c40ba9ae45306117ec2594cb418ec-d16fa.png 200w,\n/static/2022-01-21-11-42-49-eb8c40ba9ae45306117ec2594cb418ec-9fd5a.png 400w,\n/static/2022-01-21-11-42-49-eb8c40ba9ae45306117ec2594cb418ec-66417.png 441w" data-sizes="(max-width: 441px) 100vw, 441px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>此特性在边框颜色透明的场景下依旧适用。另外，当内半径大于 0 的时候边框会和 padding box 重叠，此时文字内容可能会出现在边框之上。</p>\n</li>\n<li>\n<p>如果相邻两侧边框的厚度不同，则圆角大小将在较厚和较薄边界之间显示平滑过渡。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33512597374393647000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.radius {\n  width: 100px;\n  height: 100px;\n  border-top: 40px solid deepskyblue;\n  border-left: 20px solid deepskyblue;\n  border-radius: 40px 0 0 / 60px 0 0;\n}`, `33512597374393647000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.radius</span> <span class="token punctuation">{</span>\n  <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n  <span class="token property">border-top</span><span class="token punctuation">:</span> 40px solid deepskyblue<span class="token punctuation">;</span>\n  <span class="token property">border-left</span><span class="token punctuation">:</span> 20px solid deepskyblue<span class="token punctuation">;</span>\n  <span class="token property">border-radius</span><span class="token punctuation">:</span> 40px 0 0 / 60px 0 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最终效果如图 4-18 所示。可以明显看出在圆角位置处，边框的厚度在 20px ～ 40px 范围内变化的时候是平滑的，是流畅的。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-11-45-59-33c88d6e7db25096b633cd514adb590f-ae33f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 391px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 63.68286445012787%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABi0lEQVQoz6WRO0/CUBTHi4mjn8PdOOjkI24YEuPEoi4ORCdWBxM+gaMfwcWFSJDyCOWhEWyhpfI0oaVITAQaCvKwvfd4C8aAAjHxn9yTnMfvnnvOpWBSCGNi8/nS6fmFnVZsyd5mGjY4sAnQ+DAL8FgxNU7iIfmudVYOnAtbh4s+3eLWLN4BRcNSCKr90e0zYN0wiL32BKm1vdUT1zZr7CQH1lhrPQ27AtTndzYQIvbs8mrZ4eqWJTAMs1RrAcYwTZOwWYOd0dr+Qwf0no7NQbCq4smG0+HRPA5Ws6Z00yWn34d2G2aI+r3qY65jj6tfsKqa/F/g4bPBngWyJGirqNmc03Y6fJTDNpGMqyNdH33gTBghPC4SUvpY6qLhr2OMfuTxt0sSFPxDVIqIF9/qjYryIskKCZVlOc1nWJZnOS7FC2nhSRSzvJDJ5PKSJHMpIVcoFoolkqMYhvH6gkrtVa5Us7kigR9ZjonE/XQ4EAp7vLeh6F2x8BxhYoFwjOcz7htv/D6ReORof+gTTvbKAxDYeakAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 11 45 59" title="" data-src="/static/2022-01-21-11-45-59-33c88d6e7db25096b633cd514adb590f-ae33f.png" data-srcset="/static/2022-01-21-11-45-59-33c88d6e7db25096b633cd514adb590f-12493.png 200w,\n/static/2022-01-21-11-45-59-33c88d6e7db25096b633cd514adb590f-ae33f.png 391w" data-sizes="(max-width: 391px) 100vw, 391px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>我们可以利用这一特性实现图 4-24 所示的带尾巴的小尖角效果。</p>\n</li>\n<li>\n<p>圆角边框的连接线和直角边框连接线位置一致，但是角度会有所不同。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82323248529792960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.radius {\n  width: 100px;\n  height: 100px;\n  border-top: 40px solid deepskyblue;\n  border-left: 20px solid deeppink;\n  border-right: 20px solid deeppink;\n  border-radius: 40px 0 0 / 60px 0 0;\n}`, `82323248529792960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.radius</span> <span class="token punctuation">{</span>\n  <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n  <span class="token property">border-top</span><span class="token punctuation">:</span> 40px solid deepskyblue<span class="token punctuation">;</span>\n  <span class="token property">border-left</span><span class="token punctuation">:</span> 20px solid deeppink<span class="token punctuation">;</span>\n  <span class="token property">border-right</span><span class="token punctuation">:</span> 20px solid deeppink<span class="token punctuation">;</span>\n  <span class="token property">border-radius</span><span class="token punctuation">:</span> 40px 0 0 / 60px 0 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最终效果如图 4-19 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-12-03-30-b8d7441dc49542cd30fef2ba1da17a63-96dff.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 494px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 68.21862348178138%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABnUlEQVQoz6WRyy8DcRDH9+DfkAgHJwmJXgji7upYEfEP+DMEJweiNwlxUyHarUdafaAe0TY2yu623a7Hbh+0QVp252u3q+pR0cRkMjO/38wnM/P7MfguRATCL5LLoVj8ODG1hKahUKjieKVPqlPZuBEEyLJV8AMGdEWBLMUeMRRB1xFsx+g+Nm3nKfp9ZSWqfgK/wsalbrjz+Igzw+ygyU0MC0ObXMQEMD5xBuelWaBR3bFJMyybWB9Y7T7D2AXsHEY4sscxGtX5jkVs8L/Dr2YKsyd6u6P0or/vZk35UKKWebhE/AFPhalv2dqiwpo0FcrUtoDNP+HpMHqWas9gdS6U0NoIPBNGbz24oc6Th7At1oGb57AhfIep+nFUgckRoeG1ClUVIy6WaXCFvJIZa7qFGJbBP4S5urxS1Vw2m8/fPzw/P/GiIKYkSZLFZFIQEneKIiZSyZSUTKfl6+ubW5Wv5FU1k5LSDOv2cBe8LN+k5dtsRnGxnl1vMOALsVvb3r1AMHTo9x/4A6Fd757PZ/ijTfcWx3ExLu4P7r8B44EAu06SagEAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 12 03 30" title="" data-src="/static/2022-01-21-12-03-30-b8d7441dc49542cd30fef2ba1da17a63-96dff.png" data-srcset="/static/2022-01-21-12-03-30-b8d7441dc49542cd30fef2ba1da17a63-1a6e9.png 200w,\n/static/2022-01-21-12-03-30-b8d7441dc49542cd30fef2ba1da17a63-b9533.png 400w,\n/static/2022-01-21-12-03-30-b8d7441dc49542cd30fef2ba1da17a63-96dff.png 494w" data-sizes="(max-width: 494px) 100vw, 494px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ol>\n<p>下面是其他一些细节。</p>\n<ol>\n<li>border-radius 不支持负值。</li>\n<li>圆角以外的区域不可点击，无法响应 click 事件。</li>\n<li>border-radius 没有继承性，因此父元素设置了 border-radius，子元素依然是直角效果。我们可以通过给父元素设置 overflow: hidden 让子元素视觉上表现为圆角。</li>\n<li>border-radius 属性支持 transition 过渡效果，也支持 animation 动画效果，因此在图形表现领域，border-radius 属性会非常给力。</li>\n<li>border-radius 属性也是可以应用于 display 的计算值为 table、inline-table 或者 table-cell 的元素上的，但是有一个前提，那就是表格元素的 border-collapse 属性值需要是 separate（separate 是 border-collapse 属性的默认值），如果 border-collapse 属性值是 collapse，那么是没有圆角效果的。</li>\n</ol>\n<h2 id="border-radius-属性的高级应用技巧"><a href="#border-radius-%E5%B1%9E%E6%80%A7%E7%9A%84%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8%E6%8A%80%E5%B7%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>border-radius 属性的高级应用技巧</h2>\n<p>border-radius 在实际开发中的高级应用主要在两方面，一个是增强原本的圆角效果，另外一个就是绘制各类图形效果。</p>\n<h3 id="border-radius-与不规则圆角头像"><a href="#border-radius-%E4%B8%8E%E4%B8%8D%E8%A7%84%E5%88%99%E5%9C%86%E8%A7%92%E5%A4%B4%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>border-radius 与不规则圆角头像</h3>\n<p>我们平时给头像设置的圆角效果都是规则的圆，其实还可以使用百分比值设置不同的水平半径和垂直半径，实现不规则的圆角效果，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3606946547240452600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.avatar {\n   border-radius: 70% 30% 30% 70% / 60% 40% 60% 40%;\n}`, `3606946547240452600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.avatar</span> <span class="token punctuation">{</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 70% 30% 30% 70% / 60% 40% 60% 40%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-20 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-12-06-58-a1d1f4767e4ab3935878987881ca1966-6a9ea.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 413px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.77481840193705%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABy0lEQVQoz2P4jwX8A+Lf3788PLHu7f6Kvd2xx1fNhAjCSChgwND4F0h8e3z06kzb1amCTcG8lopc/oqMmxZOAIr//fsHp+Z/YJ1fHx2/1qV4sV50dYZ8rrmUuYIEFxe3kY7Oly9fwWr+YdUMFb23MvDOAqGHc1T25Mhu8ZdZ6C5tJiUkIST2+PETsOV/sWkGW/vz463rCxWv18k/n6xwNkNuc4DMwXC5JlNxdVnpp89f4LQZ4ubvb69ecBJfKyg/xUem01FqjqP0Ml/ZUDMBF2eLb1+/4XY2RPjP/wth8Y1G7Plqkta8Eiaykg5KsqqSrE01BSDJP7gD7D9Y+88fn94cqj1TqLE+RHBOpPC0QL6uEIUHt66CffYXRfM/MIBbDOKAVXx9c/fDpVXv97W/2lrx9e5hSDz9QwUM/4kDyF5F2Pz06bNXr9/+/PnzzZu3v3///vr167MXL1+8fvXy5Yvnz54/efzo+fPnX79+efv23fPnL969f//k6bN37z+8fff20ZOnDGvWrt2+e/+jx0+OnTjz6dPnly9fHj52YvO2HXv27F29dtvqNZu2b9996PCRnTt3b9yy48ChI+s2bdm//+D+A0c2bd8NALliS9LyObrEAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 12 06 58" title="" data-src="/static/2022-01-21-12-06-58-a1d1f4767e4ab3935878987881ca1966-6a9ea.png" data-srcset="/static/2022-01-21-12-06-58-a1d1f4767e4ab3935878987881ca1966-7efe1.png 200w,\n/static/2022-01-21-12-06-58-a1d1f4767e4ab3935878987881ca1966-33ab6.png 400w,\n/static/2022-01-21-12-06-58-a1d1f4767e4ab3935878987881ca1966-6a9ea.png 413w" data-sizes="(max-width: 413px) 100vw, 413px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>再配点标题和描述，一个非常有设计感的布局效果就出来了，如图 4-21 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-12-07-17-bd09296a3626be6a0dc583623c998bac-2cb88.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.115207373271886%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACO0lEQVQoz12RTWgTQRTH9+TBQ1VskFJThQgRD9J7oYgU7KVe7EnowYNo8QN6lF6KFDwoQhBrUz8So7ENpihN22STxmTTrCQ1pVZtmjSbnU02u5uvxmbTbSRJ57lbQcHHjx+PYf5vhhkChAjwFM6FQKJBDINIa/Ch/8lSkI+BQGPkbiE/5CPqCtHKBFH4TTJoQ/S0RNsE6mXWP6XE5yDrB86ngQ7MB8uB8ejji9bbZ0b7jSxpApEi9rOUvOHa+eGSYs7KmlNen5W/zjZTHuCWsBrL+DVnqcLcrbUxnWWofeCc7tjhQ5d7uzHyE/tcQFq2CKFX0rJVCr8WQpbKqmN7RbvFz1VHOWpXNt176y+Sls6c9ZTvRtfHAf1V43FDp1788l4Ls96JNDmRnDcxnqdqmPU+U5tCxJ6nrRsfHsrfFyvLI2vX2+P3DIFremqwa6rvRO95Q/nbHNFCgdSCCXkn1cM5nxn5zMWoXZ21tfgk43++NW8SYzPK9IO3bW13jR1XTncMd5/sO3tkaLBHfQWiyQbyn21oyVxamanEHGLYVozYWe9kPTHfYMhGytNMk8AE084R703jowvto5d0d3qOhu3jkKcJnAngtLvFLO6n3Zj1NFMLatNIuIDzAksCIjFLYuQBKdjcfFen7tdcw8qnMciov0ASUBNBzkHtDwIoouZd8QDhn2Uedgt4rwxKCStFXOXVFAEHhbHmnaqMeLH+q1EobSdSbDzBZHNSiuVYxCcZjmEzVbn2d7NavwH7U8n5m0/yIgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 12 07 17" title="" data-src="/static/2022-01-21-12-07-17-bd09296a3626be6a0dc583623c998bac-fee1c.png" data-srcset="/static/2022-01-21-12-07-17-bd09296a3626be6a0dc583623c998bac-a67b7.png 200w,\n/static/2022-01-21-12-07-17-bd09296a3626be6a0dc583623c998bac-0b187.png 400w,\n/static/2022-01-21-12-07-17-bd09296a3626be6a0dc583623c998bac-fee1c.png 800w,\n/static/2022-01-21-12-07-17-bd09296a3626be6a0dc583623c998bac-2cb88.png 868w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/67hxng?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果是很多个头像，我们还可以利用“蝉原则”（质数）实现随机圆角效果。</p>\n<p>一种方法是直接指定圆角大小，IE9+ 浏览器均提供支持，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70025556930686420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.avatar {\n   border-radius: 87% 91% 98% 100%;\n}\n\n.avatar:nth-child(2n + 1) {\n   border-radius: 59% 52% 56% 59%;\n}\n\n.avatar:nth-child(3n + 2) {\n   border-radius: 84% 94% 83% 72%;\n}\n\n.avatar:nth-child(5n + 3) {\n   border-radius: 73% 100% 82% 100%;\n}\n\n.avatar:nth-child(7n + 5) {\n   border-radius: 93% 90% 85% 78%;\n}\n\n.avatar:nth-child(11n + 7):hover {\n   border-radius: 58% 98% 78% 83%;\n}`, `70025556930686420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.avatar</span> <span class="token punctuation">{</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 87% 91% 98% 100%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(2n + 1)</span> <span class="token punctuation">{</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 59% 52% 56% 59%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(3n + 2)</span> <span class="token punctuation">{</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 84% 94% 83% 72%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(5n + 3)</span> <span class="token punctuation">{</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 73% 100% 82% 100%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(7n + 5)</span> <span class="token punctuation">{</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 93% 90% 85% 78%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(11n + 7):hover</span> <span class="token punctuation">{</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 58% 98% 78% 83%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另外一种方法是选取圆角动画中的某一帧，这可以借助 animation-delay 负值技术实现，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84292437905004380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.avatar {\n   border-radius: 50%;\n   animation: morph 6s paused linear;\n}\n\n@keyframes morph {\n   0% {\n      border-radius: 40% 60% 60% 40% / 60% 30% 70% 40%;\n   }\n   100% {\n      border-radius: 40% 60%;\n   }\n}\n\n.avatar:nth-child(2n + 1) {\n   animation-delay: -1s;\n}\n\n.avatar:nth-child(3n + 2) {\n   animation-delay: -2s;\n}\n\n.avatar:nth-child(5n + 3) {\n   animation-delay: -3s;\n}\n\n.avatar:nth-child(7n + 5) {\n   animation-delay: -4s;\n}\n\n.avatar:nth-child(11n + 7) {\n   animation-delay: -5s;\n}`, `84292437905004380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.avatar</span> <span class="token punctuation">{</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> morph 6s paused linear<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> morph</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">border-radius</span><span class="token punctuation">:</span> 40% 60% 60% 40% / 60% 30% 70% 40%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">border-radius</span><span class="token punctuation">:</span> 40% 60%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(2n + 1)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -1s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(3n + 2)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(5n + 3)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -3s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(7n + 5)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -4s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.avatar:nth-child(11n + 7)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最终可以实现图 4-22 所示的随机不规则圆角头像效果，支持任意数量的头像。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-13-34-00-c37ec2b2e458e595b41724ddfe8d9712-8d399.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 516px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 80.81395348837209%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAADwElEQVQozx2Te2xTVRzH7x/+o4KJcVF8ECsKYiTxT/8gMRIxmDLFRwQMTGEgBDWEwJSGocGxMW1hQ9jGsq6Qbd14BCfQB7tdSx+3a9d27S197Lbrc23Xrl3btbf3tre3vfd4u39Ocj4539/J+X5yIACAeTH3xw1F2z8KsdqboRiOVFlgy1XVCQJJke5ijWwwgDNgxqOYVl54rBoL5lc4Armz5MDQmKRD2HG2d9/3l1ovy4t1MJejJqxB1B9zBuNoeFm/hFcBkCN37ML10b9eeHR83e4dW4c0FsgQWgoYpkJuJ4b5tGrDpavj03FCYgn1ycwPrBhs9837w3osYS8ysn7+fM/LUem7RsHbAx8+u//rz6HZcBjQhdUlj8ugUIyJhaIraL5y6rZp/8WRvgc66ROL1eWH54KmFD4zsd0n2ug5w0NO8ox7NvQc2gmpUFvAKLPI/lUOiwfbO7olD0kAbjoSh3omD3SN/CK6NS7XaCP5DAAqyQnbW8+LtvGOvPd6y8ZnukTdUJQojw52jpxuuXz0QFfvSKBAc00slOrXrfEW8ZPtgmHBf6ZYheUg5ordav1Ce/610S9fPd3WOr9CQhxNlkjYaoTtjjRZA4Cps42jSxXmbrBwbyFXrDe2zBpMlcuWkNUZQctMrdE2xQKsuBgomoK4w1dMFRqQ5VZThlZHSvJA0Z6t0mvJYrV+L0zfCICJOFAt11IUC7nTwWjkd3b1YmXxfDb891zcTAFgydKWSEFmWRxQevv1i4oYwYUnE7TQhY+FcHmyZMVLCE5Berswgez0W37IWPfkZps9hm/MmYx9hc3myslVOpimzN5lqT2FESwci/mS3mjOhxN+wCx48QQ0rPr1Zn+TeGiz8fG2yYdbpXfegWMLjiyw+RJS2HZ1XME/1v7R8QuaJGGYVXl10ohuMAxfeTr+mxJRQrfRqW/bnjsnfEUk4Ql61p+S7FqmWXWMEAwrdv3UuZl/DHpxy/t7TyYB6P7zzPW9vL7DWzr56w5/2qR+6oI4q+cmrzWf3bSvvelg7w5l0M09L1sDB6/dfXP3jxs+/u6Nr35WYTEOjk4jJ/ibjnzy0mfNH4jhqUbbLGDrAKDpjCqExclyo+u1bjndxmjmvjOUJBrmWabxObzpvHzOia0U1ggLcQJJEufsArbhuFqlKhWqTFXL3CBOJstUCIIgy/U6Q5IkQ9PcbO46gigxXJhlGQNiRN2eeZ8/v1oIhcJKWO3y+ExWmx4xaXWmKVhjNM2iTqdGixiMZrXW4EBdOv1Mhar+D1Pc1JMdSydCAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 13 34 00" title="" data-src="/static/2022-01-21-13-34-00-c37ec2b2e458e595b41724ddfe8d9712-8d399.png" data-srcset="/static/2022-01-21-13-34-00-c37ec2b2e458e595b41724ddfe8d9712-8ba40.png 200w,\n/static/2022-01-21-13-34-00-c37ec2b2e458e595b41724ddfe8d9712-7e253.png 400w,\n/static/2022-01-21-13-34-00-c37ec2b2e458e595b41724ddfe8d9712-8d399.png 516w" data-sizes="(max-width: 516px) 100vw, 516px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/svq56c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/t0zrfn?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="border-radius-图形绘制技巧"><a href="#border-radius-%E5%9B%BE%E5%BD%A2%E7%BB%98%E5%88%B6%E6%8A%80%E5%B7%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>border-radius 图形绘制技巧</h3>\n<p>一句话，只要是带圆弧的图形效果，border-radius 属性都能绘制出来，前提是对 border-radius 属性有足够深入的了解。想要出神入化地绘制图形，离不开人的创造力，下面先来介绍几个常用的图形效果，其他效果可以在此基础上延伸。</p>\n<p>下面两个例子纯属抛砖引玉。</p>\n<ol>\n<li>\n<p>绘制 1/4 圆作为角标，用来显示序号，关键 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65253978971839180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border-bottom-right-radius: 100%;`, `65253978971839180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border-bottom-right-radius</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 4-23 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-13-41-25-aeebe3572be99eeadd9931be663c915f-a9af0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.770114942528735%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAA6ElEQVQoz5VRzc6CMBDk0XyD7+y76fk76ktwMIoYgiagVaGoiIqk2gitu1gk/kQvddJ0N212ZyZj/NmiTWUJ4lIU/MyllFdtGP9bnO+zKJi7Y9ey7FzIUhtGlsujwBJBbXr/QA0YDQtaSnZ+ztgpPRySJElTVVMt5vCCjDFKA8dxBv2BaZr2cEQI0RruxLLHqg6w/Fl208VueMo21POniwXxPF9IZR61mMUViiJXLsMKwSaOAfFBXpeXls/hKlaA9yd4xAgA9Q11953z0x7cV0TRmkYrzvlut59MvOUy9Kez+yGrdfzBfwP5IkIqEUwKDQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 13 41 25" title="" data-src="/static/2022-01-21-13-41-25-aeebe3572be99eeadd9931be663c915f-fee1c.png" data-srcset="/static/2022-01-21-13-41-25-aeebe3572be99eeadd9931be663c915f-a67b7.png 200w,\n/static/2022-01-21-13-41-25-aeebe3572be99eeadd9931be663c915f-0b187.png 400w,\n/static/2022-01-21-13-41-25-aeebe3572be99eeadd9931be663c915f-fee1c.png 800w,\n/static/2022-01-21-13-41-25-aeebe3572be99eeadd9931be663c915f-a9af0.png 870w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>例如，border 边框应用 border-radius 属性时，可以使用平滑特性实现带尖角的对话框小尾巴效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70667408623546970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.corner-tail {\n  width: 15px;\n  height: 10px;\n  border-top: 10px solid deepskyblue;\n  border-top-left-radius: 80%;\n}`, `70667408623546970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.corner-tail</span> <span class="token punctuation">{</span>\n  <span class="token property">width</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n  <span class="token property">border-top</span><span class="token punctuation">:</span> 10px solid deepskyblue<span class="token punctuation">;</span>\n  <span class="token property">border-top-left-radius</span><span class="token punctuation">:</span> 80%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-24 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-21-13-43-57-b43cba24c0b62a7ef884ba4c80a30983-244cb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.906976744186046%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAABB0lEQVQY002LX0vCYBjF36B/9g266CIIqmVWRBFEF4FFGH2E6HN2Ua2psXebtZWbm7i5UMO03Gt13WnPHCn8eDjnPOewggVJw46OdQ6Jk97UyWY1bHAK6apYS0Rc2NbolUsmTNJxYiJvYkvDroE9A6cmrlycWTioUOmwgqUHZHWyR4+4dHBu4eIZOQ62rOL4CfsGpmXM3Y+ZnxAzcmozCQsKJbMy2GIZqxwrKqbuwEbcpuI/Gb8moLH1jesBbiKUhijHfKUoAkpEtyh+R7ooUuJmnJQE2KDX7QSNn8/+MProBIF4f+u3W92w6dvV0HN9x67bL691r+m6oecFNadhV/2a02u3APwB1q8CWXBAZ/AAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 21 13 43 57" title="" data-src="/static/2022-01-21-13-43-57-b43cba24c0b62a7ef884ba4c80a30983-fee1c.png" data-srcset="/static/2022-01-21-13-43-57-b43cba24c0b62a7ef884ba4c80a30983-a67b7.png 200w,\n/static/2022-01-21-13-43-57-b43cba24c0b62a7ef884ba4c80a30983-0b187.png 400w,\n/static/2022-01-21-13-43-57-b43cba24c0b62a7ef884ba4c80a30983-fee1c.png 800w,\n/static/2022-01-21-13-43-57-b43cba24c0b62a7ef884ba4c80a30983-244cb.png 860w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/0ctmlz?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n</li>\n</ol>\n<h1 id="box-shadow-盒阴影"><a href="#box-shadow-%E7%9B%92%E9%98%B4%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>box-shadow 盒阴影</h1>\n<p>box-shadow 盒阴影也是非常实用的 CSS 属性，可以给元素设置阴影效果，让视觉表现更富有层次。例如，为固定定位的头部元素设置方向朝下的阴影效果可以让页面层次更清晰：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54962631626742000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header {\n   background-color: #fff;\n   position: fixed;\n   left: 0;\n   right: 0;\n   top: 0;\n   box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n}`, `54962631626742000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">header</span> <span class="token punctuation">{</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px 4px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，<code class="language-text">box-shadow: 0 2px 4px rgba(0, 0, 0, .2)</code> 这段 CSS 声明包含 box-shadow 属性最常使用的几个值，0 表示水平偏移，2px 表示垂直偏移，4px 是模糊大小，<code class="language-text">rgba(0, 0, 0, .2)</code> 则是投影的颜色。</p>\n<p>常规的投影效果使用上面几个值就可以了，偏移+模糊+颜色，例如 filter 属性中的 drop-shadow 投影滤镜就是上面几个部件组成的。</p>\n<p>无论是盒阴影还是投影效果，其光源都默认在页面的左上角。因此水平偏移的值如果是正数则表示投影偏右，如果是负数则表示投影偏左，垂直偏移也是类似效果。这种偏移方位与文档流的方向没有任何关系，例如我们设置文档流是从右往左（direction: rtl），正数偏移值依然表示投影偏右下，不会有任何变化。</p>\n<p>本书不会在 box-shadow 属性的常规用法上多费笔墨，主要介绍你可能不知道的其他的一些应用。</p>\n<h2 id="inset-关键字与内阴影"><a href="#inset-%E5%85%B3%E9%94%AE%E5%AD%97%E4%B8%8E%E5%86%85%E9%98%B4%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>inset 关键字与内阴影</h2>\n<p>box-shadow 属性支持 inset 关键字，表示阴影朝向元素内部。先看一个简单的内外阴影对比案例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81677480368834820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.inset {\n   width: 180px;\n   height: 100px;\n   background-color: deepskyblue;\n   box-shadow: inset 2px 2px 4px rgba(0, 0, 0, 0.5);\n}\n\n.normal {\n   width: 180px;\n   height: 100px;\n   background-color: deepskyblue;\n   box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);\n}`, `81677480368834820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.inset</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 180px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 2px 2px 4px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.normal</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 180px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 2px 2px 4px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-25 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-12-47-36-ff359cacb80d11f92c340d5601573f83-925e2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.61971830985916%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABK0lEQVQY023OUU7CQBAG4CnFA5j44gNqlMQXwhE8gOdUiRohGhFb2lIkERMPIdoipS3Qwlpt6c64JVp8cPNlkt2df2fhSHd29HlZDw70MHdohJutmebGNz5t9bD8hPv9tXKfbz/S8XMEpXYIHZI6KGquaBIo1PDwdISgkiwOjbWCgaBTpctgTwtEd6GDUvbEj40sjNce1hyENskm/b2VxSSDqg8Mdlfh/yZn4TMR1kjukmSuyWbWXO0xKKkz8QdJ56BjrijqHa+7/GSYQjOR1QQUYZlRl4VsyytGAKaXNH1sragzUqZ0P0EtoNspuQnZn/zcihp2VF+5sj4uX9nFYFF7WSjWHOh38TSNfCdlISZROHxjI8tzHHswiMbvbGQzZxhP3Ngfp/FXHvkGv4MmYkYZhdIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 12 47 36" title="" data-src="/static/2022-01-22-12-47-36-ff359cacb80d11f92c340d5601573f83-fee1c.png" data-srcset="/static/2022-01-22-12-47-36-ff359cacb80d11f92c340d5601573f83-a67b7.png 200w,\n/static/2022-01-22-12-47-36-ff359cacb80d11f92c340d5601573f83-0b187.png 400w,\n/static/2022-01-22-12-47-36-ff359cacb80d11f92c340d5601573f83-fee1c.png 800w,\n/static/2022-01-22-12-47-36-ff359cacb80d11f92c340d5601573f83-925e2.png 1136w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>从图 4-25 中可以看出以下两点。</p>\n<ol>\n<li>box-shadow 内阴影效果适合实现内嵌效果，表现更低一层级的视觉效果。</li>\n<li>box-shadow 内阴影的水平和垂直偏移方向和外阴影一致，都是左上角光源。</li>\n</ol>\n<p>然而，根据我多年的实践经验，内阴影更常见的使用场景并不是视觉层级表现，而是辅助图形效果。</p>\n<h3 id="模拟边框"><a href="#%E6%A8%A1%E6%8B%9F%E8%BE%B9%E6%A1%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模拟边框</h3>\n<p>在 border 边框被占用，或者不方便使用 border 属性的情况下，我们可以借助 box-shadow 内阴影来模拟边框效果。</p>\n<p>例如，一套按钮组件，深色背景按钮无边框，浅色背景按钮需要有边框，这就带来了一点小麻烦。因为 border 会影响元素的尺寸，为了保证所有按钮尺寸一致的同时代码被高度复用，很多人会给深色背景按钮设置透明边框。其实还有更好的做法，那就是使用 box-shadow 内阴影模拟边框，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50999870725881590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<button class=&quot;normal&quot;>正常</button>\n<button class=&quot;primary&quot;>主要</button>\n<button class=&quot;warning&quot;>警示</button>\n<style>\n   button {\n      height: 40px;\n      border: 0;\n      border-radius: 4px;\n   }\n\n   .normal {\n      background-color: #fff;\n      /* 模拟边框 */\n      box-shadow: inset 1px 0 #a2a9b6, inset -1px 0 #a2a9b6, inset 0 1px #a2a9b6, inset 0 -1px #a2a9b6;\n   }\n\n   .primary {\n      color: #fff;\n      background-color: #2a80eb;\n   }\n\n   .warning {\n      color: #fff;\n      background-color: #eb4646;\n   }\n</style>`, `50999870725881590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>normal<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>正常<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>主要<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>警示<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">button</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.normal</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n      <span class="token comment">/* 模拟边框 */</span>\n      <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 1px 0 #a2a9b6<span class="token punctuation">,</span> inset -1px 0 #a2a9b6<span class="token punctuation">,</span> inset 0 1px #a2a9b6<span class="token punctuation">,</span> inset 0 -1px #a2a9b6<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.primary</span> <span class="token punctuation">{</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #2a80eb<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.warning</span> <span class="token punctuation">{</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #eb4646<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-26 所示，有边框按钮和无边框按钮的尺寸完全一致。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-12-53-32-8972208661cdd9faecb257afd02096a6-e9aba.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.26940231935772%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABYklEQVQY052RPU/CUBSG+zd0MW4uDiaSoE6EwKAEle4u+g8QCSZqSAxGE+PC5k/AxVVdDX4E6YDUEIQWFWjvLdCP2Pb23l5viYmuevLk5F3OOe85h6OeR/8bHG00qOME0vf/XIxrz1gUMaXEwx4mPiH6J/kYkZ4e0B0FAMsnuk4U5RtVDbKmcbaLbNsxLIthO4j67v7lcOYAhgowdASXTuBsHqyfm8peXovHAM/DVAomkzCRGGxscGz6APbL5durm+uxb7JdGk5m1eiZlr4w0iV9eleJF41uOgcXwsPMjnl6PNjaBNEo68IhD1umCSA0TMNBzD7KlIYTWXXuELCx8wUwlevHinpQvBgGq2saz4OVZRCJQJ7nXBdhTIjvszzeGUsQ30v4sUPuJPzAhIzrCiVyxxME96mKKhUkCAGiyP2+XvO1JXXeHNuCPfmlVpWadeW9LTfFVkOst2XmbfyTn6d8Af4TmDu4eDM6AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 12 53 32" title="" data-src="/static/2022-01-22-12-53-32-8972208661cdd9faecb257afd02096a6-fee1c.png" data-srcset="/static/2022-01-22-12-53-32-8972208661cdd9faecb257afd02096a6-a67b7.png 200w,\n/static/2022-01-22-12-53-32-8972208661cdd9faecb257afd02096a6-0b187.png 400w,\n/static/2022-01-22-12-53-32-8972208661cdd9faecb257afd02096a6-fee1c.png 800w,\n/static/2022-01-22-12-53-32-8972208661cdd9faecb257afd02096a6-e9aba.png 1121w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/6usjz1?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="颜色覆盖"><a href="#%E9%A2%9C%E8%89%B2%E8%A6%86%E7%9B%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>颜色覆盖</h3>\n<p>box-shadow 内阴影有一个实用特性，那就是生成的阴影会位于文字内容的下面，背景颜色的上面。于是我们可以使用 box-shadow 属性在元素上面再覆盖一层颜色，这种做法在不少场景下非常有用。</p>\n<p>在 Chrome 浏览器中，输入框在自动填充的时候会自带背景颜色，一般是黄色或者浅蓝色，我们可以使用 box-shadow 内阴影创建白色颜色层对其进行覆盖，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58442128804108260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`input:-webkit-autofill {\n   -webkit-box-shadow: inset 0 0 0 1000px #fff;\n   background-color: transparent;\n}`, `58442128804108260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">input:-webkit-autofill</span> <span class="token punctuation">{</span>\n   <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> inset 0 0 0 1000px #fff<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>又如，按钮在被按下的时候其背景色要深一点，这用来给用户提供操作反馈。使用 box-shadow 内阴影，只用一行代码便可以搞定所有按钮，无须一个一个专门进行颜色设置，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1637815557541633000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`button:active {\n   box-shadow: inset 0 0 0 999px rgba(0, 0, 0, 0.1);\n}`, `1637815557541633000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">button:active</span> <span class="token punctuation">{</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 0 0 999px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-27 所示，在中间按钮被按下的时候背景颜色明显加深了。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-20-54-13-b4b8534da823b8bcaee35b3c97ecf17e-a9bb1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 30.39301310043668%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABSUlEQVQY02P4/OXrz5+/vn3/8e37dyD5/++vi/c/WtZft2m8YVF/3bbphm3DNcuOBxdmrvoSGvg6KvptZOTbiIg3ISEfSkoYfvz49f//v3t3bu3YvfPOvQf///8/deu9TM4F9ZLLkZPvVax4bFR5WbL09on22V+szN4kpXzubn+flvLKwf5dXBzD12/f//758+rlyxcvX37+/BWo+fSt91LZF5QLL1s1XLdquKFRcE6+4tbx9jmfrcxe+vi+jYp87ev70sbmbWwsyGags//8+fvn77+fv34DOe8//9x96cPOSx+2nn+37eKnrScfLdpx6f3dJ78OH/x++PCPAwd/HDny8/DhXxcuMPwnBP7++f39y0esUiia79178PDR4y9fvl65duP02UuXrlwHMi5fuX77zv1Ll69evXr9/t37QGX//vz5//cvEAEAk7cf39J/vaoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 20 54 13" title="" data-src="/static/2022-01-22-20-54-13-b4b8534da823b8bcaee35b3c97ecf17e-fee1c.png" data-srcset="/static/2022-01-22-20-54-13-b4b8534da823b8bcaee35b3c97ecf17e-a67b7.png 200w,\n/static/2022-01-22-20-54-13-b4b8534da823b8bcaee35b3c97ecf17e-0b187.png 400w,\n/static/2022-01-22-20-54-13-b4b8534da823b8bcaee35b3c97ecf17e-fee1c.png 800w,\n/static/2022-01-22-20-54-13-b4b8534da823b8bcaee35b3c97ecf17e-a9bb1.png 1145w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>box-shadow 内阴影颜色覆盖也是有局限的，其对于部分替换元素是无效的，例如 <code class="language-text">&lt;img&gt;</code> 元素：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31311549081622192000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 无效 */\nimg:active {\n   box-shadow: inset 0 0 0 999px rgba(0, 0, 0, 0.1);\n}`, `31311549081622192000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 无效 */</span>\n<span class="token selector">img:active</span> <span class="token punctuation">{</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 0 0 999px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为替换元素的内容在盒阴影之上。此时可以使用 outline 属性进行模拟，假设图片尺寸是 75px×100px，则可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6659617618527335000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img:active {\n   outline: 50px solid rgba(0, 0, 0, 0.1);\n   outline-offset: -50px;\n}`, `6659617618527335000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img:active</span> <span class="token punctuation">{</span>\n   <span class="token property">outline</span><span class="token punctuation">:</span> 50px solid <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">outline-offset</span><span class="token punctuation">:</span> -50px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="不要忽略第四个长度值"><a href="#%E4%B8%8D%E8%A6%81%E5%BF%BD%E7%95%A5%E7%AC%AC%E5%9B%9B%E4%B8%AA%E9%95%BF%E5%BA%A6%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不要忽略第四个长度值</h2>\n<p>box-shadow 属性支持 2 ～ 4 个长度值，前两个长度值是固定的，表示水平偏移和垂直偏移，第三个长度值表示模糊半径，还有第四个长度值，表示扩展半径。“扩展”这一特性并不符合现实世界对投影的认知，因此在模拟真实世界投影效果的时候是用不到的，用得少自然知道的人就少。</p>\n<p>不过扩展半径在某些时候还是很有用的，扩展半径主要用在以下两个场景：一是轮廓模拟，二是实现单侧阴影。</p>\n<h3 id="轮廓模拟"><a href="#%E8%BD%AE%E5%BB%93%E6%A8%A1%E6%8B%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>轮廓模拟</h3>\n<p>理论上，按钮的轮廓可以借助第四个长度值，即扩展半径来实现，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43756278529607885000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.normal {\n   background-color: #fff;\n   /* 模拟轮廓 */\n   box-shadow: inset 0 0 0 1px #a2a9b6;\n}`, `43756278529607885000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.normal</span> <span class="token punctuation">{</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n   <span class="token comment">/* 模拟轮廓 */</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 0 0 1px #a2a9b6<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用扩展半径模拟轮廓的代码量要比实现 4 个方向分别投影的代码量小很多。但是很遗憾，在有圆角的情况下，使用扩展半径的方法在 IE 浏览器中的渲染是有问题的，4 个圆角阴影会重叠，如图 4-28 所示，这不符合我们的预期。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-00-44-67651d52d6ec9ab6c8d7cdac7f1b0bf8-7c3d8.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.502202643171806%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABkUlEQVQY041QTUsCYRjca9A/6E90iYIoMDp2sAyMoEO3qNCSymunDuGtwIigU106VKfAiKCQlDR1XfXV/EBzlzR3XTfNdd+Pp9fOHhqGYS4zz/AIgBBIEjw8QCIB8TgUi6AoEAxCqdTn8zOk03B/D4MgQKEAigyRCOTzkM1CtQqy3K/7qEC53K/j7U9PgPGgcChEu10KwAAoY9xQ+C8Eqmqdpt6zcM/sUUpN0wJq+h+NhZPm8lnTeaqtnKmO807wOmx5NrWtbd3t1j0e3eVq+/0CD/AkrxHFRCAQaBnf3G9cqMPu2uRhY/2yNeP7Gtozrg5vzPHRunNJ93rVxcXa2Ji2tiYQQrpdk6ssK+Vypf1j8uG7V9qItz7tU+eOtYmD+sj+9+3RnTk7VZt3qKurDbu9brM1d3YExliPn8aEMeC0MKEEfxosKZNE1YpWcFIh0icztDbkcxghnEr1FSGiKAIfibLvCOUaDbVQLEWjsZdQRBLFjBTLZZL5rJQSY+Lba0wUQ8l0WErH3wtG5wf+HvwLf7uWZJIX26QAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 00 44" title="" data-src="/static/2022-01-22-21-00-44-67651d52d6ec9ab6c8d7cdac7f1b0bf8-fee1c.png" data-srcset="/static/2022-01-22-21-00-44-67651d52d6ec9ab6c8d7cdac7f1b0bf8-a67b7.png 200w,\n/static/2022-01-22-21-00-44-67651d52d6ec9ab6c8d7cdac7f1b0bf8-0b187.png 400w,\n/static/2022-01-22-21-00-44-67651d52d6ec9ab6c8d7cdac7f1b0bf8-fee1c.png 800w,\n/static/2022-01-22-21-00-44-67651d52d6ec9ab6c8d7cdac7f1b0bf8-7c3d8.png 1135w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>因此，扩展半径多用来模拟大范围的色块效果，例如新手引导的蒙层效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36404252190909858000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.guide {\n   box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75);\n   border-radius: 50%;\n}`, `36404252190909858000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.guide</span> <span class="token punctuation">{</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 0 9999px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.75<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>相比 outline 属性，使用 box-shadow 属性实现蒙层效果出现的 bug 要更少（Firefox 浏览器的 outline 轮廓有些小问题），同时还支持圆角，是最佳的实现方法，效果如图 4-29 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-03-32-e6b715653d7f35ed758671954d10c0ee-180cb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 780px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.61538461538461%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAC5UlEQVQoz2WP+0/SURjGv/+IbaYNEBG+XFVu3hCVi0MXJKZB2byVc5ZbF+1is1YOf9C0WF5QAZVQYJkKEjdDRQUDNOOiglqZ9QcoLetMa3Pr2ee8532fPe92DlQurcrK5bHy+Pzii9KqxhvN7S2yAZlc3zkw/UJp7laaOxXTMrnufpui4a5MUnmTX1QKwjlsvlAshYipTAqTX9fU1am09+p8ysnAsGlDDTCGlFMh0I+YNsGot0c1M6F+g69j0FZ7u4PC4KKxZKi2sbXPsKaz7yys7utsm5POyNTc1rRzy+yKGmzhee8X1+rXCceGL7Tv/vRt1BQEMb1jt0fvL6+8BTU+eK42RbSWzXn/3rgl9HZ2QzMTsCxtT89FjPORGVfUtryrt4Ydnl3L4rZqct21ujdu3VIZI5UNrRAtM49fUvtUPvnatK4xRwyzn8ErxqxRrWVr2BQ2OKITzp1xW3TMuq217Wgt0VHjx8fdb7jCKjyFCTGyOXHxyHNJMJnBKSypkV5/VH/vZVOb+kn3RHufubVr4mGH/s4zVX1zt+RaC09UTaIVJCLhM2dRpPQsiFVQiCGkw2Q6BiYjk2EAGktEJMP5PAG/SIhKIWJgChpLQqUQEGgcAo1NxpFxJFoKIY2WkQvl5PGQGCIGn4ohpGHgVCyRiiWmU5msTBYnGU+ByVSYTDsBT6EDTnqwTM9kQ4Lz4gxWAZsjyMrlcgVCehY7J58vEksY2fn5vGIciUpMZRD+A+xn5BRAkorqkrLLpeVXROJLkoqqC6XSMunVypq6PK5AVCqJS0AlJuESUFhA4iniEeCXNGhEo5X39PcPKgGvehWKQZVqeBSYg0r1wJBaMaQCzjHKf6iA2QfOiAaKxWJHQL+Ojn7/1dEpHcZih4egxH4eC1ygPzg4AGkwQkvLng9efyAY2v/+IxgMB0LhQCC4suLz+la9/rXZ93OzzgWbw+lZ8fr8a26P1znveme1L7ndi8ueP++zpEQoNNUtAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 03 32" title="" data-src="/static/2022-01-22-21-03-32-e6b715653d7f35ed758671954d10c0ee-180cb.png" data-srcset="/static/2022-01-22-21-03-32-e6b715653d7f35ed758671954d10c0ee-b84dc.png 200w,\n/static/2022-01-22-21-03-32-e6b715653d7f35ed758671954d10c0ee-8d9eb.png 400w,\n/static/2022-01-22-21-03-32-e6b715653d7f35ed758671954d10c0ee-180cb.png 780w" data-sizes="(max-width: 780px) 100vw, 780px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/mrno29?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="单侧阴影"><a href="#%E5%8D%95%E4%BE%A7%E9%98%B4%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>单侧阴影</h3>\n<p>扩展半径还支持负值，可以用来实现单侧阴影效果。理论上，实现单侧阴影效果只要设置一侧阴影的偏移大小为 0 即可，但是，如果模糊半径设置得较大，就会看到有部分阴影显示在左右两侧了，并不是单侧阴影效果，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87581015417930550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header {\n   width: 150px;\n   padding: 10px;\n   background-color: white;\n   box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);\n}`, `87581015417930550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">header</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px 5px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-30 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-12-07-1a524a88300069f334bc59a21acd1f5a-381aa.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.33994823123383%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA/ElEQVQY032Q627DIAyF8/7PNU3KSNmqpWo1tWquTShgMLmoWm5zyTptf/bJgmPL5gBB27YWkQKtpTD/43sorHM0EaBzWkoQQjsnAbr2jvM0TdP9ou97mpLWgjFQ1wBwHyZljkcbRZAkypgwDBljnPO6rpdlmed5edDdbopzjGNzPoPWAblrOgnRpOk1yyohiqKoqirPcyGEf803pKVS6nQyZIvonRGpognEq1JlWdLk5XKhlXTxFypqa8lMe4JhGD49JKZpJGbPNE3rnUmu25qOj34i+HlVmmT7w4dUwN+2zyGLdwdK+euWbfhLxJ+oFPGQbd7j3TCO6xd8AYyGhKgARdLtAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 12 07" title="" data-src="/static/2022-01-22-21-12-07-1a524a88300069f334bc59a21acd1f5a-fee1c.png" data-srcset="/static/2022-01-22-21-12-07-1a524a88300069f334bc59a21acd1f5a-a67b7.png 200w,\n/static/2022-01-22-21-12-07-1a524a88300069f334bc59a21acd1f5a-0b187.png 400w,\n/static/2022-01-22-21-12-07-1a524a88300069f334bc59a21acd1f5a-fee1c.png 800w,\n/static/2022-01-22-21-12-07-1a524a88300069f334bc59a21acd1f5a-381aa.png 1159w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>此时可以设置扩展半径为负值，让阴影只在一侧显示，相关代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5684014649999502000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header {\n   box-shadow: 0 7px 5px -5px rgba(0, 0, 0, 0.5);\n}`, `5684014649999502000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">header</span> <span class="token punctuation">{</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 7px 5px -5px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-31 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-16-08-645340ca46e72466b3e3449e8460beab-1dace.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 770px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.14285714285714%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvUlEQVQY052PYQuCMBCG/f8/bDZFs00rqSQwtylObQaKmnXM/FD6qYfBju197jjjpen7vppRSj00UFQLyrKE8GQZ09V1XVEUUkqlieM4SRJ4GcfxqYGiaRqpgfC6XNc155wQEoYhtAANvmDUMAwgT5kVWc6AnKapEIIxdpuBRlmWgZzn+Yq8XO/+zc/OsMhH/g8DbawounIm2rY9nS/YdmhwoP7eD46EBsi0XI+62x22XYQwthyP+Ca2IQDnDU1UilHXGIBIAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 16 08" title="" data-src="/static/2022-01-22-21-16-08-645340ca46e72466b3e3449e8460beab-1dace.png" data-srcset="/static/2022-01-22-21-16-08-645340ca46e72466b3e3449e8460beab-f7e89.png 200w,\n/static/2022-01-22-21-16-08-645340ca46e72466b3e3449e8460beab-20ec6.png 400w,\n/static/2022-01-22-21-16-08-645340ca46e72466b3e3449e8460beab-1dace.png 770w" data-sizes="(max-width: 770px) 100vw, 770px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="多阴影特性与图形绘制"><a href="#%E5%A4%9A%E9%98%B4%E5%BD%B1%E7%89%B9%E6%80%A7%E4%B8%8E%E5%9B%BE%E5%BD%A2%E7%BB%98%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多阴影特性与图形绘制</h2>\n<p>box-shadow 属性支持无限多个阴影效果不断累加，因此理论上 box-shadow 属性可以实现任意图形效果，我们只需要设置 1px×1px 的元素，然后不断投影。当然，我们在实际开发中不会这么使用，因为没必要，性能也很糟糕。但是，box-shadow 属性的多阴影特性确实让 box-shadow 属性在图形绘制领域大放光彩。</p>\n<h3 id="多边框和渐变边框效果"><a href="#%E5%A4%9A%E8%BE%B9%E6%A1%86%E5%92%8C%E6%B8%90%E5%8F%98%E8%BE%B9%E6%A1%86%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多边框和渐变边框效果</h3>\n<p>我们可以使用 box-shadow 属性模拟多边框效果，该属性也支持圆角效果，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81648822370737650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.multi-border {\n   height: 100px;\n   border-radius: 10px;\n   background-color: deepskyblue;\n   box-shadow: 0 0 0 4px #fff, 0 0 0 8px deeppink, 0 0 0 12px yellow, 0 0 0 16px purple;\n}`, `81648822370737650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.multi-border</span> <span class="token punctuation">{</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 0 4px #fff<span class="token punctuation">,</span> 0 0 0 8px deeppink<span class="token punctuation">,</span> 0 0 0 12px yellow<span class="token punctuation">,</span> 0 0 0 16px purple<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-32 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-21-50-f04bb8012b844704d03738b38fcf5d89-7bb57.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.81437125748503%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABZUlEQVQoz5WR3UvCUBjGj3ZV9E9F1G0QkXTXbX9GZKFpobIgEIoio6iLIsKo6dzmps0JIVP70iWaKSI5Nz/AeU7nGF0v4cfDe97zPufh5YDSxaXqdBbcnoJr+1+4Peqms3x7BxECKcqzIPdnE635pDZnBZ6ZedRWEpqyu6EVyuDq7BRICNAmiCJLbFgj5qSIxONgS8qCm9CJTUL2iGlnkCUTDH5iOI3NB/stOY/NIZIcMQG+sMI2Mk9h8yE250iyffxk4Tf5+jw03s60SZKPgt94Z3lna1VsLImfDrG6bAWeWUx+rTEVxbXeLlVBJRyuB7w1KlDfw/hrlK9G+f/wjTp+rARSjMYob5XlyT9DiLpdgq7Ddhv2+wiDj70eKXQDGQY0DNTpkCZWQ0dGBw0hHAwG4O31vagWm80Gw7F8nM+/PKsfaibzpORySjZ7/0BzQpwXBJbnUuk0y7HRWIxmGCkl80LiB3wJw+hmk6arAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 21 50" title="" data-src="/static/2022-01-22-21-21-50-f04bb8012b844704d03738b38fcf5d89-fee1c.png" data-srcset="/static/2022-01-22-21-21-50-f04bb8012b844704d03738b38fcf5d89-a67b7.png 200w,\n/static/2022-01-22-21-21-50-f04bb8012b844704d03738b38fcf5d89-0b187.png 400w,\n/static/2022-01-22-21-21-50-f04bb8012b844704d03738b38fcf5d89-fee1c.png 800w,\n/static/2022-01-22-21-21-50-f04bb8012b844704d03738b38fcf5d89-7bb57.png 835w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果我们多边框的过渡颜色足够细腻，我们还可以使用 box-shadow 属性实现由内往外但并不是径向渐变的渐变效果，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75487017804878170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.gradient-border {\n   height: 100px;\n   border-radius: 10px;\n   background-color: deepskyblue;\n   box-shadow: 0 0 0 1px #07b9fb, 0 0 0 2px #17aef4, 0 0 0 3px #27a4ee, 0 0 0 4px #3799e7, 0 0 0 5px #478ee0, 0 0 0 6px\n         #5784d9, 0 0 0 7px #6779d3, 0 0 0 8px #776ecc, 0 0 0 9px #8764c5, 0 0 0 10px #9759be, 0 0 0 11px #a74eb8, 0 0 0\n         12px #b744b1, 0 0 0 13px #c739aa, 0 0 0 14px #d72ea3, 0 0 0 15px #e7249d, 0 0 0 16px #f71996;\n}`, `75487017804878170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.gradient-border</span> <span class="token punctuation">{</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 0 1px #07b9fb<span class="token punctuation">,</span> 0 0 0 2px #17aef4<span class="token punctuation">,</span> 0 0 0 3px #27a4ee<span class="token punctuation">,</span> 0 0 0 4px #3799e7<span class="token punctuation">,</span> 0 0 0 5px #478ee0<span class="token punctuation">,</span> 0 0 0 6px\n         #5784d9<span class="token punctuation">,</span> 0 0 0 7px #6779d3<span class="token punctuation">,</span> 0 0 0 8px #776ecc<span class="token punctuation">,</span> 0 0 0 9px #8764c5<span class="token punctuation">,</span> 0 0 0 10px #9759be<span class="token punctuation">,</span> 0 0 0 11px #a74eb8<span class="token punctuation">,</span> 0 0 0\n         12px #b744b1<span class="token punctuation">,</span> 0 0 0 13px #c739aa<span class="token punctuation">,</span> 0 0 0 14px #d72ea3<span class="token punctuation">,</span> 0 0 0 15px #e7249d<span class="token punctuation">,</span> 0 0 0 16px #f71996<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-33 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-29-16-67df68f6993b2f54d8e9dbb881aa41f5-d9352.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.97813578826237%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABI0lEQVQoz51RTU+DQBDd1vTf6sUe8IBQtUD1oMYf4cV48aiHYmJCRaBQCxWtJcGWD7UlWmm92HFYY2JPECdvN7OT9zIvbwkAjM68o9VWo6rtrd/kYreqHa61/NM+Cgm8fx4wOjn/Kl0CkfOR0S4WDcaAyYzgETgLpytNKBUA0pDMbnchnGZiadMiTSjjtAB+aNzWLUQoTv4j5lEc080i30EnFWopFxVqm9uxqe23+T5jYGBludhmOQtM3DBgjIEBeCd9iTV5yanV7ZqwjPqfhva86Ais+XB8T78KawHwMoNgClFK8ZHdcfr7XB6GKbzOgRZRVd33h1GSDJ9jWVUdbxBMxo+jJ9f3B2FwZeh6zzHuekq7rdu26bqKaSqmZXW616r2DZMpm8V4zXGVAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 29 16" title="" data-src="/static/2022-01-22-21-29-16-67df68f6993b2f54d8e9dbb881aa41f5-fee1c.png" data-srcset="/static/2022-01-22-21-29-16-67df68f6993b2f54d8e9dbb881aa41f5-a67b7.png 200w,\n/static/2022-01-22-21-29-16-67df68f6993b2f54d8e9dbb881aa41f5-0b187.png 400w,\n/static/2022-01-22-21-29-16-67df68f6993b2f54d8e9dbb881aa41f5-fee1c.png 800w,\n/static/2022-01-22-21-29-16-67df68f6993b2f54d8e9dbb881aa41f5-d9352.png 869w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="加载效果"><a href="#%E5%8A%A0%E8%BD%BD%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>加载效果</h3>\n<p>box-shadow 属性可以实现多种 CSS 加载效果，例如下面这个经典的旋转加载效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89469576723050560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.loading {\n   width: 4px;\n   height: 4px;\n   border-radius: 100%;\n   color: rgba(0, 0, 0, 0.4);\n   box-shadow: 0 -10px rgba(0, 0, 0, 0.9), 10px 0px, 0 10px, -10px 0 rgba(0, 0, 0, 0.7), -7px -7px rgba(0, 0, 0, 0.8), 7px -7px\n         rgba(0, 0, 0, 1), 7px 7px, -7px 7px;\n   animation: spin 1s steps(8) infinite;\n}\n\n@keyframes spin {\n   0% {\n      transform: rotate(0deg);\n   }\n\n   100% {\n      transform: rotate (360deg);\n   }\n}`, `89469576723050560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.4<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 -10px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.9<span class="token punctuation">)</span><span class="token punctuation">,</span> 10px 0px<span class="token punctuation">,</span> 0 10px<span class="token punctuation">,</span> -10px 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.7<span class="token punctuation">)</span><span class="token punctuation">,</span> -7px -7px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token punctuation">,</span> 7px -7px\n         <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">,</span> 7px 7px<span class="token punctuation">,</span> -7px 7px<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s <span class="token function">steps</span><span class="token punctuation">(</span>8<span class="token punctuation">)</span> infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> rotate <span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-34 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-38-34-7b82468e9ca34fa21fd7c19b0afa98c1-115a3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.952559300873915%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA20lEQVQY05VP226CQBTk/3+B7yBRqkuoijVCwFCi0JaEVIQAb8Dustw6vjSaqK3zcDJzsrMzRxqvMQwDZpqmruvKspxlGWNsvAPpptk0TcMwuq6Loqgoit/9H2aAUqooCpzgbdv6vt/3/RPJ6BwEAUiSJHmeP1c7jmMEhmEIc1mW/zVf/oPO40NIQohGCATWuJUySFzbNNiJtutBqqrmZ90wzik7A8+gMaWPz6/9weeML1brF6JZlvN9PHne3rF3797hbWOqM2KsN/piOddepyrR9OVEJVvLnhH9B/Ikx+N31ynuAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 38 34" title="" data-src="/static/2022-01-22-21-38-34-7b82468e9ca34fa21fd7c19b0afa98c1-fee1c.png" data-srcset="/static/2022-01-22-21-38-34-7b82468e9ca34fa21fd7c19b0afa98c1-a67b7.png 200w,\n/static/2022-01-22-21-38-34-7b82468e9ca34fa21fd7c19b0afa98c1-0b187.png 400w,\n/static/2022-01-22-21-38-34-7b82468e9ca34fa21fd7c19b0afa98c1-fee1c.png 800w,\n/static/2022-01-22-21-38-34-7b82468e9ca34fa21fd7c19b0afa98c1-115a3.png 801w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="云朵效果"><a href="#%E4%BA%91%E6%9C%B5%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>云朵效果</h3>\n<p>使用 box-shadow 属性实现云朵效果的代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42473921137545560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.cloud {\n   width: 60px;\n   height: 50px;\n   color: white;\n   background-color: currentcolor;\n   border-radius: 50%;\n   box-shadow: 100px 0px 0 -10px, 40px 0px, 70px 15px, 30px 20px 0 -10px, 70px -15px, 30px -30px;\n}`, `42473921137545560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.cloud</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> currentcolor<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 100px 0px 0 -10px<span class="token punctuation">,</span> 40px 0px<span class="token punctuation">,</span> 70px 15px<span class="token punctuation">,</span> 30px 20px 0 -10px<span class="token punctuation">,</span> 70px -15px<span class="token punctuation">,</span> 30px -30px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-35 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-44-49-7a0b6846e00f745a6d253c0e78327980-fee1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.375%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABiElEQVQoz4WQTUsCURSGr6HWKmgTQZu+aN8faFnUIuhL+gdlyxaB1rZVQdto1aq/UH5MM36kFqKpY6noZIZFJC0igmpm3u65OolQdHnncO8573PuPcMAbGvoi2A0gaF4WwPnGIxhJIHhzvxYAr0R7NY4B8a/tSKYH3YZ7MySRKb+KFhASGqXHNzmg7diwe4iORwKbDK6ZGq0U6XawwfcJUym0KOAiRI3OBUyeLVO2G45VvJ4+aKaCRgmbfbvyUB9ZbrjF7g7RHFTvOfTJNI0CRY4jh6J/AfeKFNWbxLW4qeD+h/wegksCGcINoUeP5eFp4LSO9Q3vOpk2qu15upSyMb3Wz/w6g3YCewStSCdCol/Pp7ARFIkA62qQyKzp2zBh3VMZ+DKY0klLatwqZjPYSGH2SxmMlhU2+K2qQyOnwRs6LoYSsjQSe1Jm8uAadCRIiiaumlwTmf+gFyuaNrt3XOjISnhcCRWKJW1ai2dzqj5gnpd8PmlcDTOFY1dpK9yPPqC8mUyxTPfBvv07QugxyIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 44 49" title="" data-src="/static/2022-01-22-21-44-49-7a0b6846e00f745a6d253c0e78327980-fee1c.png" data-srcset="/static/2022-01-22-21-44-49-7a0b6846e00f745a6d253c0e78327980-a67b7.png 200w,\n/static/2022-01-22-21-44-49-7a0b6846e00f745a6d253c0e78327980-0b187.png 400w,\n/static/2022-01-22-21-44-49-7a0b6846e00f745a6d253c0e78327980-fee1c.png 800w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>实现原理很简单，就是使用 box-shadow 属性克隆多个圆，然后让圆不断交错重叠。</p>\n<h3 id="3d-投影效果"><a href="#3d-%E6%8A%95%E5%BD%B1%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3D 投影效果</h3>\n<p>给按钮设置一个 3D 投影效果，按下按钮的时候按钮的位置发生偏移，同时投影高度降低，这可以实现非常有立体感的按钮效果，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79911336355520990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.shadow-3d-button {\n   width: 100px;\n   height: 36px;\n   border: 1px solid #a0b3d6;\n   background-color: #f0f3f9;\n   box-shadow: 1px 1px #afc4ea, 2px 2px #afc4ea, 3px 3px #afc4ea;\n}\n\n.shadow-3d-button:active {\n   transform: translate(1px, 1px);\n   box-shadow: 1px 1px #afc4ea, 2px 2px #afc4ea;\n}`, `79911336355520990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.shadow-3d-button</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #a0b3d6<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #f0f3f9<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 1px 1px #afc4ea<span class="token punctuation">,</span> 2px 2px #afc4ea<span class="token punctuation">,</span> 3px 3px #afc4ea<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.shadow-3d-button:active</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>1px<span class="token punctuation">,</span> 1px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 1px 1px #afc4ea<span class="token punctuation">,</span> 2px 2px #afc4ea<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-36 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-50-48-9c5375e4e972b2fae5cfa49818978dcc-7f274.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 35.344827586206904%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABU0lEQVQoz3WQ0W7aQBBF+f/viPqWSrz0uRIFEqdpUhq7LXEokBAMi/F6vfbagDkdE4gSVR3pakazu2fuTguJ/X7fJFRS8LjIiFY586OUrg6K0y3LtWOu7KG/iHNGM8PzquDEaNR6C1ynTh6WGFuR2g3aOMKHKb/DCbcDn/HTkqzYobMSW2xkeM7wMfs/MBagShyJKUmyDUqltD+2OW9/4uzsA9d+iClqYu1kYMU0soQz+x54Kk4OtXmZ3sjYkvlcsVxpptNnIqWlvyXLK1y5ZaZy7p+yf4H1ERjFBTfDNT8eEgbhi+5GRpQSTCz+HyNn+iB/pPGC+NVh/fbLp6iFa12NDD/IbY652osrcSburOyw2WNzz7odu5p30er3PYLgF9FiyfA+pNPt4fsB4/GEQLIf/OTy0qPbu+DbzS1XV1/5Prij86WLJ3XvwuNzp6mvpdfnL4DZD0ZGTVeuAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 50 48" title="" data-src="/static/2022-01-22-21-50-48-9c5375e4e972b2fae5cfa49818978dcc-fee1c.png" data-srcset="/static/2022-01-22-21-50-48-9c5375e4e972b2fae5cfa49818978dcc-a67b7.png 200w,\n/static/2022-01-22-21-50-48-9c5375e4e972b2fae5cfa49818978dcc-0b187.png 400w,\n/static/2022-01-22-21-50-48-9c5375e4e972b2fae5cfa49818978dcc-fee1c.png 800w,\n/static/2022-01-22-21-50-48-9c5375e4e972b2fae5cfa49818978dcc-7f274.png 928w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/e3j333?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="box-shadow-动画与性能优化"><a href="#box-shadow-%E5%8A%A8%E7%94%BB%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>box-shadow 动画与性能优化</h2>\n<p>在日常开发中，对 box-shadow 属性的使用没有什么限制，不用担心相对较大的性能开销。个别元素应用 box-shadow 动画也没问题，毕竟抛开数量谈性能是没有意义的。但是，如果页面本身比较复杂，应用渐变、半透明、盒阴影、滤镜等特性的元素很多，则此时 box-shadow 动画所带来的性能开销就会很大，实现的动画效果帧率不足 60f/s，GPU 加速疯狂运转，手机电量迅速减少。这时可以使用一些小技巧优化一下。</p>\n<p>例如，有一个盒阴影过渡效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19546582265904820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.normal {\n   transition: all 0.5s;\n   box-shadow: 0 8px 12px rgba(0, 0, 0, 0.5);\n}\n\n.normal:hover {\n   box-shadow: 0 16px 24px rgba(0, 0, 0, 0.7);\n}`, `19546582265904820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.normal</span> <span class="token punctuation">{</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> all 0.5s<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 8px 12px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.normal:hover</span> <span class="token punctuation">{</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 16px 24px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.7<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在鼠标经过盒的时候会伴随大量的样式重计算和 GPU 加速，此时，我们可以使用伪元素创建盒阴影，然后在鼠标经过盒的时候改变盒阴影的透明度，以此进行优化，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52713314863636000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.optimize::before,\n.optimize::after {\n   content: \'\';\n   transition: opacity 0.6s;\n}\n\n.optimize::before {\n   box-shadow: 0 8px 12px rgba(0, 0, 0, 0.5);\n}\n\n.optimize::after {\n   opacity: 0;\n   box-shadow: 0 16px 24px rgba(0, 0, 0, 0.7);\n}\n\n.optimize:hover::before {\n   opacity: 0;\n}\n\n.optimize:hover::after {\n   opacity: 1;\n}`, `52713314863636000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.optimize::before,\n.optimize::after</span> <span class="token punctuation">{</span>\n   <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> opacity 0.6s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.optimize::before</span> <span class="token punctuation">{</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 8px 12px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.optimize::after</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 16px 24px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.7<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.optimize:hover::before</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.optimize:hover::after</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>图 4-37 所示是优化前后的一些性能指标，从左往右共 4 段动画区间，分别代表正常实现鼠标经过、正常实现鼠标移开、优化实现鼠标经过和优化实现鼠标移开触发的 transition 过渡效果，可以看到正常实现的盒阴影动画的样式重计算和 GPU 开销明显更大（左方块内的栅格数量更多）。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-22-21-58-03-e80491a2393850e14a704e94f013a90c-11cd2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.467419635099915%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACHklEQVQozx2SSW7cMBBF+/67HMDLHCFANgaMbAI4MQzbceTulq1WS+KkgaMocU7FBS6KH3z8xSoeCkTOxm6TWlvEzh/tFbNRbe89OTftZaBMrk2HQL8MhHLz0Q6Qd2Sa5Hr4hMu6WbtbITmhWCgRc1jEgjHicvHRTctIKFr47Pw+ThRTpLR0wR3ANqe0ud0FL5XAeJCK5xKlFggNXCypxGUZMRkADsmPE0N40EaGFD6dS9ndvlo7cdEjrFcDCpey68FZ5ZLZNIPOlQw5YEoRIWazcNGhaJ2VnugMlc3Vealqe7m6oefHmr/VfiB53/VHq86XMOCIiTw3a93GafYBnBGK135AlJIeVceWUvAxxvUEd4yRpiHHary02roFWqJMT9kilAaDDeDgs1Qz15wxecWTcsa6mIte/aycJOOOsaaTi9DUuPkklLMu6a6Dvh6KMaVpvDFj3031kRvh4wZvXne1RuP4mBkNfAIlpRBTSClC/v3u5ubuy6Hse2bMSgHw3HzIbYs55VJs2H0pQYpIsOcLKC6FkGPMec/+9sfX25dvh7JtZWSr4sGuW/eu5n6bSNFmm4mGHLVFcE96KDDJJSmRJM+SF8pKyofPCne77955x4WfF8tGWHIYZI80fDAIQmU/iK4HUcMsEbJCAPgfvrbX06nWWsMwL91Qneq3unl8/vP0Wr28Vve/H+4fn55fq5+/Hh5hf67/ns5wEsB/aEydLRmx9j0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 22 21 58 03" title="" data-src="/static/2022-01-22-21-58-03-e80491a2393850e14a704e94f013a90c-fee1c.png" data-srcset="/static/2022-01-22-21-58-03-e80491a2393850e14a704e94f013a90c-a67b7.png 200w,\n/static/2022-01-22-21-58-03-e80491a2393850e14a704e94f013a90c-0b187.png 400w,\n/static/2022-01-22-21-58-03-e80491a2393850e14a704e94f013a90c-fee1c.png 800w,\n/static/2022-01-22-21-58-03-e80491a2393850e14a704e94f013a90c-11cd2.png 1151w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/klb7hc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="css-2d-变换"><a href="#css-2d-%E5%8F%98%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 2D 变换</h1>\n<p>本节主要介绍 2D 变换，3D 变换会在之后详细讲解。</p>\n<p>首先说一下私有前缀，现在已经不是 10 年前了，没有任何理由需要给 transform 属性添加 -moz- 和 -o- 私有前缀。如果是需要兼容 IE 浏览器的传统 Web 产品，则需要加上 -ms- 私有前缀，但不需要加上 -webkit- 私有前缀，示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91074115738878500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.pc {\n   -ms-transform: none;\n   transform: none;\n}`, `91074115738878500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.pc</span> <span class="token punctuation">{</span>\n   <span class="token property">-ms-transform</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果是移动端项目，考虑到还有不到 4% 的 Android 4.4 操作系统用户，因此还需要加 -webkit- 私有前缀，但不需要加 -ms- 私有前缀。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99620036904515810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.mobile {\n   -webkit-transform: none;\n   transform: none;\n}`, `99620036904515810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.mobile</span> <span class="token punctuation">{</span>\n   <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>transform 属性相关特性和细节非常多，想要理解本节内容需要反复阅读。</p>\n<h2 id="从基本的变换方法说起"><a href="#%E4%BB%8E%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%8F%98%E6%8D%A2%E6%96%B9%E6%B3%95%E8%AF%B4%E8%B5%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从基本的变换方法说起</h2>\n<p>2D 变换常用的变换方法包括位移、旋转、缩放和斜切，示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47901983231737290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 位移 */\ntransform: translate(0, 0);\n/* 旋转 */\ntransform: rotate(0deg);\n/* 缩放 */\ntransform: scale(1);\n/* 斜切 */\ntransform: skew(0deg);`, `47901983231737290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 位移 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 旋转 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 缩放 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 斜切 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们先逐个快速了解一下各个变换方法的基本特性。</p>\n<h3 id="translate-位移"><a href="#translate-%E4%BD%8D%E7%A7%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>translate() 位移</h3>\n<p>以自身坐标为基准，进行水平方向或垂直方向的位移，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38654459752342520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 往右偏移 10px，往下偏移 20px */\ntransform: translate(10px, 20px);\n/* 往右偏移 10px */\ntransform: translateX(10px);\n/* 往下偏移 20px */\ntransform: translateY(20px);`, `38654459752342520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 往右偏移 10px，往下偏移 20px */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>10px<span class="token punctuation">,</span> 20px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 往右偏移 10px */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>10px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 往下偏移 20px */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>20px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，translate() 函数中的第二个值可以省略，省略后表示垂直方向的偏移大小是 0。因此，translate(10px) 等同于 translate(10px, 0)，也等同于 translateX(10px)。大家千万不要被 scale() 函数的语法给误导，translate(10px) 不是 translate(10px, 10px) 的简写。</p>\n<p>位移的方向和文档流的顺序没有任何关系，也就是即使祖先元素设置 direction: rtl，translateX(10px) 依然表示往右偏移。</p>\n<p>位移变换最不可替代的特性就是设定百分比偏移值，因为 CSS 世界中就没有几个属性的百分比值是相对于自身尺寸计算的，示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25715263232059660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 往左偏移自身宽度的一半，往上偏移自身高度的一半 */\ntransform: translate(-50%, -50%);`, `25715263232059660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 往左偏移自身宽度的一半，往上偏移自身高度的一半 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>百分比值相对于自身计算的这个特性非常适合用来实现高宽不固定元素的水平垂直居中效果，例如，弹框元素想要居中定位，可以使用下面的 CSS 语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48364169700671120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.dialog {\n   position: absolute;\n   left: 50%;\n   top: 50%;\n   transform: translate(-50%, -50%);\n}`, `48364169700671120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.dialog</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然而对于绝对定位元素，如果可以，请尽量避免使用 transform 属性进行位置偏移，应改用 margin 属性进行偏移定位，这样就可以把 transform 属性预留出来，方便实现各种 animation 动画效果。例如，我们希望元素出现的时候有一个缩放动画效果，但是如果偏移是使用 transform 属性实现的，那么这个动画执行的时候元素的定位就会出现问题。</p>\n<h3 id="rotate-旋转"><a href="#rotate-%E6%97%8B%E8%BD%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rotate() 旋转</h3>\n<p>例如，将图片旋转 45 度：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92713740649267660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   transform: rotate(45deg);\n}`, `92713740649267660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-38 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-17-39-41-83d4f62cdcc1d4f1fa5a4fb82fc232be-e269b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 634px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 68.61198738170347%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACAElEQVQoz2P4jwn+/QMSf368u71/8o9vn8EC//5jAwxYdf7/++POxqSlmSy7Z6b9//cLIY5P87+/IPzr+8NNCUcbBXY2KZ/pEXq+O/Xv7x///v399/cPHs0gs//++XVxXcKRbv4L04E6FW5PU7nRK3hvdeqf3z+Bjv/39y9WzWBX/ftzc0v04WbBC70qd6Yr3p6jeHem4vk25fWZ/I82pP358xvN/UiawYIPN1Rd0xM9q6K0XVHudLT8k3lK+7Llcxxkokw41zUl/frxDTn8UJwNEb2zvGlTrNB0X4Uyfeld0XLbguXabaTFRSUClRkObpwP9tofrAEG1Pz315//r042ns8XDZORzjGSOhEp32Enx8/GXlSQDwkzrDbD9AOD5d//Vztql8fyualKp9nJGEuwZKZlgkRR45wBayIBaf/3/+Puujmh/CoSbHn52X/+gkXRQvsf1KdQI2EkNFYfrSnf2pH1/Tco+v/8+fMPBiAqGf7jBX9+/4IGD9YU9vLV67dv3337/v3du/dAw4Dcd+/fA9lAxosXLz+8f/fs+fNPnz5/+Pjx5ctXb96+ffP23dNnzz9+/PTq9RuGLdt27j945NHjp8dPnv79+8/mrTsOHTm278Ch7Tv37N138Oz5i2vXbz5z9vzhoye2bt+9/+DhHbv3rl678ey5C5u27AAA3pzFgwD3GnwAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 17 39 41" title="" data-src="/static/2022-01-23-17-39-41-83d4f62cdcc1d4f1fa5a4fb82fc232be-e269b.png" data-srcset="/static/2022-01-23-17-39-41-83d4f62cdcc1d4f1fa5a4fb82fc232be-3a8bb.png 200w,\n/static/2022-01-23-17-39-41-83d4f62cdcc1d4f1fa5a4fb82fc232be-a4958.png 400w,\n/static/2022-01-23-17-39-41-83d4f62cdcc1d4f1fa5a4fb82fc232be-e269b.png 634w" data-sizes="(max-width: 634px) 100vw, 634px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由此可见，正值是顺时针旋转。</p>\n<p>这里顺便详细介绍一下角度单位，CSS 中的角度单位包括下表所示的 4 个单位。</p>\n<table>\n<thead>\n<tr>\n<th align="left">单位</th>\n<th align="left">含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">deg</td>\n<td align="left">degrees，表示角度</td>\n</tr>\n<tr>\n<td align="left">grad</td>\n<td align="left">grads，表示百分度</td>\n</tr>\n<tr>\n<td align="left">rad</td>\n<td align="left">radians，表示弧度</td>\n</tr>\n<tr>\n<td align="left">turn</td>\n<td align="left">turns，表示圈数</td>\n</tr>\n</tbody>\n</table>\n<p>下面分别介绍一下这 4 个单位。</p>\n<ul>\n<li>\n<p>角度（deg）：角度范围为 0 ～ 360 度，角度为负值可以理解为逆时针旋转。例如，−45deg 可以理解为逆时针旋转 45 度。</p>\n</li>\n<li>\n<p>百分度（grad）：一个梯度，或者说一个百分度表示 1/400 个整圆。因此 100grad 相当于 90deg，它和 deg 单位一样支持负值，负值可以理解为逆时针方向旋转。</p>\n</li>\n<li>\n<p>弧度（rad）：1 弧度等于 180/π 度，或者大致等于 57.3 度。1.5708rad 相当于 100grad 或是 90deg，如图 4-39 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-17-43-25-32d0b1fbe11a1295fa7a94212f56d33d-e31b0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 709px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 63.18758815232722%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABXElEQVQoz4WR6WrCQBSF8/7vIYWgqZpYwWAJgZiVtin9k2haNIorZnOZBBN76oDU/RCGy8x859y5YfYXKooC62Aw0DSNEFIctL8m5nIrDMPlcmnbdqlU0nXdNM3dbvcApvYgJ5MJTZZleTwedzodVVWPF24mI2E6neZ5TmFJkrrdLgrAcLnkmbOGh8Mh3gkX13V5nnccR1EUURTb7fYDGLFgFovFfD73PK/VahmGYVkWSEEQ4jg+40/gNE2B0Xq9XmNsx3qz2dxLpgeAgyBAkSQJNQI5Go0wiAcDoxZoHjyaBwMLrFmWXf9VxanoqNGk7/s9zwNMM/PD0f9rWJn9DR2N7oghW4KcLSFpmoVhFIRRslrhi2OkrqAAW/FfhVPs4AkYXxRFaZYxmma+f3z+9P3ZbFatCVW++SrJbKVa5ur1xoumW2yZazTFCld7YjlZUW37y7De2PJz77v/C1xg3nWQySq5AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 17 43 25" title="" data-src="/static/2022-01-23-17-43-25-32d0b1fbe11a1295fa7a94212f56d33d-e31b0.png" data-srcset="/static/2022-01-23-17-43-25-32d0b1fbe11a1295fa7a94212f56d33d-ae213.png 200w,\n/static/2022-01-23-17-43-25-32d0b1fbe11a1295fa7a94212f56d33d-0d4a3.png 400w,\n/static/2022-01-23-17-43-25-32d0b1fbe11a1295fa7a94212f56d33d-e31b0.png 709w" data-sizes="(max-width: 709px) 100vw, 709px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>圈数（turn）：这个很好理解，1 圈表示 360 度，平时体操或跳水中出现的“后空翻 720 度”，也就是后空翻两圈的意思。于是有等式 1turn=360deg、2turn=720deg 等。</p>\n</li>\n</ul>\n<p>下面的 CSS 代码均表示顺时针旋转 45 度：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91455704407099920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: rotate(45deg);\ntransform: rotate(50gard);\ntransform: rotate(0.7854rad);\ntransform: rotate(0.25turn);`, `91455704407099920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>50gard<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0.7854rad<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0.25turn<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在实际开发的时候，我们只需要使用 deg 单位就好了，没必要“炫技”使用其他角度单位。那么什么时候使用 grad 或者 rad 这些 CSS 单位呢？这些单位一般用在动态计算的场景（例如 JavaScript 计算运动轨迹或者根据坐标计算角度的时候，使用弧度更方便）。</p>\n<h3 id="scale-缩放"><a href="#scale-%E7%BC%A9%E6%94%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>scale() 缩放</h3>\n<p>缩放变换也支持 x 和 y 两个方向，因此，下面的语法都属于 2D 变换的语法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12682296645183121000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 水平放大 2 倍，垂直缩小 1 / 2 */\ntransform: scale(2, 0.5);\n/* 水平放大 2 倍 */\ntransform: scaleX(2);\n/* 垂直缩小 1 / 2 */\ntransform: scaleY(0.5);`, `12682296645183121000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 水平放大 2 倍，垂直缩小 1 / 2 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>2<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 水平放大 2 倍 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleX</span><span class="token punctuation">(</span>2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 垂直缩小 1 / 2 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>0.5<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>图 4-40 所示就是图片元素应用 scale(2, .5) 变换后的效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-17-52-12-2289211069dd30b647bfb3b10302660e-b9e7f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.95138888888889%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABuUlEQVQY00WMX0hTcRiGz3UwqVzCznbOWY266NICK+Zsa6dU6kKN0aV3CYFB4k2BIaab1c2iXcwwpC7ECOwiwooIxDJsU8Y5Ozsryc2FpaZbovS/px8U9MLL8z0ffJ/07HqAh7Fj3O8LCgax7oRZvKdTHNMpjOrMj+jkhsKk42Em+kI8joZ4dDXEjfMNnGv1c/akn54zAaLtAToj9UgzMSdT/TLPe11MDrhIxWXMpJv8sJt3Q24WBYs3hcdkprpcJJp2kdRrGPA7uVBbTaN3O/udDvbtdFC1zYH0YtDFq7iXVFLDSGhY/V6sDi/pVpWJIwrjpxUedCiMRTzcavZwuU7mdtDDqJjvNnq44pdpq63hgM9J1Y5q8TChMhPdSybiI3vIh3HQx9O63YzUazzp3MO46HCb8KMa146rdDcp9JzQGGzRuNSs0qUrXGwRPKXSflhB2loz2Fww+Gqa/CzZ/KrkWFkyRS34noNvNnzOQkVwMw9lsVu3/3rZ5vequPkgbpcMvpQMJP7lY7lC2shRKC2zXt5gzrCx8kVmjbcsf9pgcnqWl69NCu9XyGTnmU6ZwjPMmW/4wf/8AXDQQUC3lj0FAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 17 52 12" title="" data-src="/static/2022-01-23-17-52-12-2289211069dd30b647bfb3b10302660e-fee1c.png" data-srcset="/static/2022-01-23-17-52-12-2289211069dd30b647bfb3b10302660e-a67b7.png 200w,\n/static/2022-01-23-17-52-12-2289211069dd30b647bfb3b10302660e-0b187.png 400w,\n/static/2022-01-23-17-52-12-2289211069dd30b647bfb3b10302660e-fee1c.png 800w,\n/static/2022-01-23-17-52-12-2289211069dd30b647bfb3b10302660e-b9e7f.png 1152w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>缩放变换不支持百分比值，仅支持数值，因此 scale(200%, 50%) 是无效的。</p>\n<p>缩放变换支持负值。如果我们想要实现元素的水平翻转效果，可以设置 transform: scaleX(-1)；想要实现元素的垂直翻转效果，可以设置 transform: scaleY(-1)。如果水平缩放和垂直缩放的大小一样，我们可以只使用一个值，例如，transform: scale(2) 表示将元素水平方向和垂直方向的尺寸放大到现有尺寸的 2 倍。</p>\n<h3 id="skew-斜切"><a href="#skew-%E6%96%9C%E5%88%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>skew() 斜切</h3>\n<p>斜切变换也支持 x 和 y 两个方向，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84751028881549640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 水平切斜 10 度，垂直切斜 20 度 */\ntransform: skew(10deg, 20deg);\n/* 水平切斜 10 度 */\ntransform: skewX(10deg);\n/* 垂直切斜 20 度 */\ntransform: skewY(20deg);`, `84751028881549640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 水平切斜 10 度，垂直切斜 20 度 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>10deg<span class="token punctuation">,</span> 20deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 水平切斜 10 度 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skewX</span><span class="token punctuation">(</span>10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 垂直切斜 20 度 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skewY</span><span class="token punctuation">(</span>20deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所有包含 X 和 Y 字符的变换函数都不区分大小写，例如 skewX(10deg) 写作 skewx(10deg) 是合法的，translateX(10px) 写作 translatex(10px) 也是合法的，不过我们约定俗成字符 X 和 Y 都是大写。skew(10deg) 可以看成 skew(10deg, 0) 的简写，效果等同于 skewX(10deg)。</p>\n<p>图 4-41 所示的是图片元素分别应用 skewX (10deg) 和 skewY(20deg) 变换后的效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-17-56-47-e664251a22a70068c532535f9694e96b-83017.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.15573053368329%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACpElEQVQoz42TWUhUYRTH5yGoIFHDHKZhNCd7maBESWixIMk2WiTapIeCeikqDMoeIopcSh2VEEklJCNKg+zFFkUsGTXLbEzH6Y4zo+OCmlku4zJ65/66c28L9NSBP5z7ff/zu4fvfJ+GySmYmISxHzA9q+RSIB8ahtFRpNkZAjEzPsg3VxtSTz8MjsHAENLIMH6HgOR2I9ntIAhofB43c24n/n4X4sgAoscpF7hYcDlYEOxIM14FOO6q5UmqjsbCfXjbS5kf7VHW8QfkR/L5wOtF01CcTOX19biebMRZFk9zdjwV1zaQuttE9vn9+BbmlTpvXz31t3S8zdDiLArHmrcOe+U5xoVXzE1PKx5JlkZ4dpLqtCA+mQ105+t5c0VH6pYwTCuWYdRr6etVO5noqaPNrKc114hQvJqO2waKU4I5HBvM1T0mPluqFZ9mpMXM+8wQrIVr6H1kxFNopOHEKsp2GogJX05NTa1iHBHqaJB/apM9DnMUwyVGXp+O4kyMgeBFGgpzMlTgV1sVFrMW+/1omhOjqEiOpGR3BM8PGkmKXkpR8T0V6KimMT0IW6KBl7ooyg9EUn0sgncpRraFLSYjK1cFTgx1YCnQ8TlOS1V0OOlbwziqD+GgKYw4vYYbaRfUKc948JScpX3TWp6mhJKVEEryynAytxvZu2YJObk5KlD0TyGUH6L7eCINd3bQ+zCJrrwkrAW7sNxMoLX0snLYv2PaO8hg2wOGHh+h8lQkFzcHY9JqyDf/6lCZjiTJRX78kqhIvQuiKvlb2ZfkfVH8Aw44+N6Ft+kuLy7FYnlUoAID5j8z/+/4xyzOIk6N/gWqUEm+6N243T1Mya9HcHTT0Wnji+CQc6ey3tTcQofNTqeslg8f+WRtx2q14ptXOw9wfgLIWLXov79nQQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 17 56 47" title="" data-src="/static/2022-01-23-17-56-47-e664251a22a70068c532535f9694e96b-fee1c.png" data-srcset="/static/2022-01-23-17-56-47-e664251a22a70068c532535f9694e96b-a67b7.png 200w,\n/static/2022-01-23-17-56-47-e664251a22a70068c532535f9694e96b-0b187.png 400w,\n/static/2022-01-23-17-56-47-e664251a22a70068c532535f9694e96b-fee1c.png 800w,\n/static/2022-01-23-17-56-47-e664251a22a70068c532535f9694e96b-83017.png 1143w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>旋转是 360 度一个轮回，斜切则是 180 度一个轮回。元素处于 90 度或者 270 度斜切的时候是看不见的，因为此时元素的尺寸在理论上是无限的。对浏览器而言，尺寸不可能是无限的，因为没办法表现出来！于是这种情况下的尺寸为 0，所以元素在 90 度或者 270 度斜切的时候是不会影响祖先元素的滚动状态的。如果读者对这句话不理解，把 skewY() 函数的角度调成 89 度或者 271 度就知道什么意思了。skew() 函数支持所有角度单位值。</p>\n<p>斜切变换在图形绘制的时候非常有用，这是一个被低估的变换特性。举个例子，使用 CSS 实现图 4-42 所示的导航效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-17-59-22-4c4ca03ace2d02a768c3db4b01e9041b-66f68.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 15.91304347826087%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAApklEQVQI113KSQ6CMBhAYS7jAVx5AY/lxhOYeA43xo0HcGlijIlxYCglDE1LW6ClQAu/bvXlWz6vsnCX7kRs2IxygEtpz8y+63F55LMdne/Z4sBeGccI+2HMuKRM+AEKQiQr5RkH1EyJmkQ/tQ6kg9KCGGD7HFbXbn3rNo++MlbrVtaN0kbptuTiy3S9B7/laUryXCtFcCSLhGeYYhSjOIhQUZC/+QMSsqNYBZtVggAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 17 59 22" title="" data-src="/static/2022-01-23-17-59-22-4c4ca03ace2d02a768c3db4b01e9041b-fee1c.png" data-srcset="/static/2022-01-23-17-59-22-4c4ca03ace2d02a768c3db4b01e9041b-a67b7.png 200w,\n/static/2022-01-23-17-59-22-4c4ca03ace2d02a768c3db4b01e9041b-0b187.png 400w,\n/static/2022-01-23-17-59-22-4c4ca03ace2d02a768c3db4b01e9041b-fee1c.png 800w,\n/static/2022-01-23-17-59-22-4c4ca03ace2d02a768c3db4b01e9041b-66f68.png 1150w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>有些人会使用 clip-path 属性以剪裁方式实现这个效果，有些人会使用 border 属性以模拟边框方式实现这个效果，其实，完全不需要这么复杂，使用斜切变换就可以轻松实现这个效果。</p>\n<p>首先按照正常的方块布局进行排版，让每一个导航元素由上下两个矩形盒子组成，使用 skew() 函数斜切一下效果就出来了，连定位都不需要，这是最佳实现方式，没有之一。实现原理如图 4-43 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-18-00-07-218c4ed3eb755f40a65e614cb65f714f-11cd2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.75238922675934%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABT0lEQVQY021Qy07CUBRs9E+MUROFBEmMH+DOxIV+kRuNxkRdsHBl3AOhwgIfAQ1SEBVoAS0SqQSpUG4pr9IH7a3n4kJjnMxi7szJ5J5DYcf5TYBlY6NWdwQBv1Uxz+Nej7j4O/wBvKnNWHcphJbPZW9Yng+i2KcBwXoULQYkL408wZaHRpm2Cab/Xd/ODfcL6h6ngki2TOqsMjooqkclQgj47hjmoh/GLjcE57ik7rDD+KTxhB9Rh41pnzjlE0GsBBC1cd2dCyJXSHbT8owfXYlkbuumPxtS3GHFFekt0MplQwfztKKtRjprFwoQBLRTrDxmWmZaIrxrmh3dNiyc5OqpbDX1LDLMy0O5qdtkZ9P+uzbl/AtLd8aagy1HGxDxH8jBoA4ISjNMtlAShJoktYvlSoF/jSeYTI5NP+Y5rhi/TaTvn7J5tj8YTG5PfvEFzlVlZ7cZKxgAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 18 00 07" title="" data-src="/static/2022-01-23-18-00-07-218c4ed3eb755f40a65e614cb65f714f-fee1c.png" data-srcset="/static/2022-01-23-18-00-07-218c4ed3eb755f40a65e614cb65f714f-a67b7.png 200w,\n/static/2022-01-23-18-00-07-218c4ed3eb755f40a65e614cb65f714f-0b187.png 400w,\n/static/2022-01-23-18-00-07-218c4ed3eb755f40a65e614cb65f714f-fee1c.png 800w,\n/static/2022-01-23-18-00-07-218c4ed3eb755f40a65e614cb65f714f-11cd2.png 1151w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="transform-属性的若干细节特性"><a href="#transform-%E5%B1%9E%E6%80%A7%E7%9A%84%E8%8B%A5%E5%B9%B2%E7%BB%86%E8%8A%82%E7%89%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transform 属性的若干细节特性</h2>\n<p>这里介绍的 transform 特征对于 2D 变换和 3D 变换均适用。</p>\n<h3 id="盒模型尺寸不会变化"><a href="#%E7%9B%92%E6%A8%A1%E5%9E%8B%E5%B0%BA%E5%AF%B8%E4%B8%8D%E4%BC%9A%E5%8F%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>盒模型尺寸不会变化</h3>\n<p>页面中的元素无论应用什么 transform 属性值，该元素盒模型的尺寸和位置都不会有任何变化。例如，页面中有一个 <code class="language-text">&lt;img&gt;</code> 元素，尺寸是 128px×96px，则无论应用什么 transform 属性值，这个 <code class="language-text">&lt;img&gt;</code> 元素的尺寸依然是 128px×96px，位置依然是原来的位置。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92807305730830700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   transfrom: translateX(-9999px);\n}`, `92807305730830700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">transfrom</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-9999px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>图片原来的位置会变成一片空白，图片在视觉上已经不知道偏移到何处了。这和 position: relative 相对定位偏移的行为有些类似。又如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60557537966786820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   transfrom: scale(2);\n}`, `60557537966786820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">transfrom</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>虽然图片的视觉尺寸放大了 2 倍，但是，并不会推开旁边的元素，只会在视觉上重叠与覆盖。</p>\n<p>元素尺寸和位置不会变化的特性让人又爱又恨，爱的是可以放心使用 transform 实现各类交互效果，恨的是有时候我们又希望位置可以发生变化。例如，我们希望一个元素往上移动自身高度的 50%，同时后面的元素也跟着一起位移，这在目前的 CSS 世界中，是没有有效的实现方法的，需要借助 JavaScript 计算实现。原因在于相对自身尺寸偏移的特性只有 translate 位移才有，但是 translate 位移无法影响其他元素的布局；可以影响其他元素布局的 margin 负值定位虽然也支持百分比值，但这个百分比值却是相对宽度计算的。于是，这就形成了一个死结。</p>\n<p>但需要注意的是，元素应用 transform 变换后还是可能因为某些间接的原因影响排版，主要是在触发滚动条的显示与隐藏的情况下影响容器的可用尺寸（Windows 操作系统中的滚动条默认占据一定的宽度和高度）。且看下面这个具有代表性的案例：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="69971788195534450000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<p><img data-src=&quot;./1.jpg&quot; /></p>\n<style>\n   img {\n      width: 100%;\n   }\n\n   p {\n      width: 128px;\n      border: solid deepskyblue;\n      overflow: auto;\n   }\n</style>`, `69971788195534450000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">img</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">p</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 128px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n      <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>很显然，此时 <code class="language-text">&lt;img&gt;</code> 元素的宽度是 128px，但是，如果 <code class="language-text">&lt;img&gt;</code> 元素旋转一下，则 <code class="language-text">&lt;img&gt;</code> 元素尺寸就会发生变化，尺寸瞬间变小了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51937667404025880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   width: 100%;\n   transform: rotate(45deg);\n}`, `51937667404025880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>例如，在 Windows 10 操作系统下的 Chrome 浏览器中，<code class="language-text">&lt;img&gt;</code> 元素的宽度变成了 111px，如图 4-44 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-18-09-20-8864b6936c7c6d9a2d741e1f4f5afad5-2ddf5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.134048257372655%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACS0lEQVQoz22RS08TYRSG+wuMwYXRhTEqG1ds/AeujIlx78KNe/0DbkDlaq8gVIzGW4EFGIwLW000lF64TAsYS2mnN0pLaTstvdGWto/ftKSG6ElO3nknmWfec44Gmpwu1bf+umaj7eqVQ1IuCwGbmZTzPblVC2nXB5SVj2RFq77omUUjV8F3kGYzsYcvs09QeH8JQpUmTUFqNjrA43KOjH0C2TpA8uco5XUTpXUj5TUTFclEzq2j6JhA81WaZ226F7uhF4/hMvFlLTUBcO1mKKhhRUJV6qUcebeZuKTFvfQE39og8tYYu9taIj49yq9xCs5JNIuP7+C5e5ZA/1X8zy/x6l4PTssAP3xRiidANWFNBTqnkD2jvP4yiHFOx/RnA2+tU3xaEmDxo8LyCzRLC7PYbp3n2Y2L2B9c42FfDzf7ruAKxjoJG8ddoOKYIiQN88b6ktGFRUbmLPS/m2Hm2zgJzxh5uwAG1c1HLGhvX+BR3znuXz/D0MBTIsUa+eNWN6E6ckGMHNvQsewZZsU7hEsaYnVjGLd3hP0NIyV1ZGu8iBTcw/Z9Af20GfP8IjspBVv4oDtys32UPBmRUPHqyW2No2yayHiNbc2L/WUlA3mHSBgtN5BzJWTxdaIO6QZEi3XRtVNXrhWzFByTHNp1Qo1iXwJg17dV7UO7gYpTXJl/qsX/qiV2Wc1EqGcj1IRW0+FOq88n/igd6gCPqlW2/QGyWYXkfgrf9g4+4cORGDsBmYBoVX/7hYbEOzlKbC9FOJYgEk+SPFC6Uf4AmDuwR06JGnQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 18 09 20" title="" data-src="/static/2022-01-23-18-09-20-8864b6936c7c6d9a2d741e1f4f5afad5-fee1c.png" data-srcset="/static/2022-01-23-18-09-20-8864b6936c7c6d9a2d741e1f4f5afad5-a67b7.png 200w,\n/static/2022-01-23-18-09-20-8864b6936c7c6d9a2d741e1f4f5afad5-0b187.png 400w,\n/static/2022-01-23-18-09-20-8864b6936c7c6d9a2d741e1f4f5afad5-fee1c.png 800w,\n/static/2022-01-23-18-09-20-8864b6936c7c6d9a2d741e1f4f5afad5-2ddf5.png 1119w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>之所以是这样的结果，是因为 <code class="language-text">&lt;img&gt;</code> 元素旋转导致 <code class="language-text">&lt;p&gt;</code> 元素出现滚动条，滚动条占据了 17px 的宽度，进而导致 width: 100% 的 <code class="language-text">&lt;img&gt;</code> 元素的宽度变成了 111px。</p>\n<h3 id="内联元素无效"><a href="#%E5%86%85%E8%81%94%E5%85%83%E7%B4%A0%E6%97%A0%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内联元素无效</h3>\n<p>内联元素（不包括替换元素）是无法应用 transform 变换的，且不支持所有变换特性。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82615637660178300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<span>不能变换</span>\n<style>\n   span {\n      transform: translateX(99px);\n   }\n</style>`, `82615637660178300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>不能变换<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">span</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>99px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时 <code class="language-text">&lt;span&gt;</code> 元素是不会有位移效果的。但有两种方法可以实现位移效果，一种是给元素增加块状特性，例如设置 display 属性值为 inline-block，如下所示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98282834321142760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`span {\n   display: inline-block;\n   transform: translateX(99px);\n}`, `98282834321142760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">span</span> <span class="token punctuation">{</span>\n   <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>99px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有一种方法是改用相对定位：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94630506765425340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`span {\n   position: relative;\n   left: 99px;\n}`, `94630506765425340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">span</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 99px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="锯齿或虚化的问题"><a href="#%E9%94%AF%E9%BD%BF%E6%88%96%E8%99%9A%E5%8C%96%E7%9A%84%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>锯齿或虚化的问题</h3>\n<p>在应用旋转或者斜切变换的时候，元素边缘会表现出明显的锯齿，文字会明显虚化。这个现象主要出现在桌面端浏览器上，而且这个问题是没有办法避免的，因为显示器的密度跟不上。</p>\n<p>目前大部分桌面显示器还都是 1 倍屏，显示的最小单元是 1px× 1px，你可以理解为显示器屏幕是由一个个 1px×1px 大小的格子组成的。如果像素点旋转 45 度，那么这个正方形像素点的端点和边必然就会穿过其他的格子，如图 4-45 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-18-17-30-637eb3adcbecea4e4bccde40a86ac823-fac45.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.57744733581164%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACEklEQVQoz2P4Dwb//v0DknN2Hc2etqxk7prSeWuL5qwumbO6dP7aknlrS+etyZ6+bOPJi0A1f//++w8DDMiaqxdusCxsc6vq86id4FLZm9A7P33S4uQJ8yM6ZgLR8oOnwJr/YtfcsGyTY3mXb+Mk/8Ypno1T/OonhdX1BzZN9Wuc7FzZO3f3UaCaP7g0N67Y6lzdH9A81bdzTmRpa3lAdGhtn3fHLP+mKU5VfXPwa25YttmxvNunaWpUaWuDm3+PuX1lQHRwda9P4xSg+JxdR/Bprl+6yaGsy6tpanFYUpelY5OjV4+VY1pSgWfzNKD47J2HCdjsVNHt2zQlsGFSpX9Ur5ldQUyGL9AXjZMdKwjZ3Lh8i3NVr3/TZN/2mYE1vemJ+X7N03xbpwNFnKp6Cfi5cSnQ5h6/hskBTVN8Gid7NE/zAwX1FKCIY0UPTpv/gjWXL1hrmtcCdDkwYoCedCjtdKrscazsdSrvNslrmbplP1DN7z9//sEAis0Hr95ZuO/E8kNnVhw+AyQhDAgbKH7+/hO4SqjNP3/9+vHjJ9AxX758/fnjx+9fP4Ho7+/fQPaP79+B5C+I4M+fX798/fbt2+cvXz59+gxkvH33juHW7Tt37tz9+vXb6TPnrly7cfDQsSPHTp4+d/74qbO79x04dOT44aPHz128fOL0OSD7zNkLJ0+dPXr85IVLl/fsOwgA+AVLvn0YycQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 18 17 30" title="" data-src="/static/2022-01-23-18-17-30-637eb3adcbecea4e4bccde40a86ac823-fee1c.png" data-srcset="/static/2022-01-23-18-17-30-637eb3adcbecea4e4bccde40a86ac823-a67b7.png 200w,\n/static/2022-01-23-18-17-30-637eb3adcbecea4e4bccde40a86ac823-0b187.png 400w,\n/static/2022-01-23-18-17-30-637eb3adcbecea4e4bccde40a86ac823-fee1c.png 800w,\n/static/2022-01-23-18-17-30-637eb3adcbecea4e4bccde40a86ac823-fac45.png 807w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>于是，有一个问题出现了，显示器没有能力显示小于 1px×1px 的图形，于是，要么裁剪像素点（锯齿），要么使用算法进行边缘模糊计算（虚化）。因此，要想解决 transform 变换锯齿和虚化的问题，只要把我们的显示器换掉就可以了。换成一个高清屏，类似 iMac 那种 5K 显示屏，这个现象就没了。因为这类屏幕密度足够高，0.2px×0.2px 的元素都可以细腻渲染。</p>\n<h3 id="不同顺序不同效果"><a href="#%E4%B8%8D%E5%90%8C%E9%A1%BA%E5%BA%8F%E4%B8%8D%E5%90%8C%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不同顺序不同效果</h3>\n<p>我们可以一次性应用多个不同的变换函数，但需要注意的是，即使变换内容一样，如果顺序不同，最终的效果也会不一样，例如：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="64306356844733006000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<p><img data-src=&quot;1.jpg&quot; class=&quot;transform-1&quot; /></p>\n<p><img src=&quot;1.jpg&quot; class=&quot;transform-2&quot; /></p>\n<style>\n   p {\n      width: fit-content;\n      border: solid deepskyblue;\n   }\n\n   .transform-1 {\n      transform: translateX(40px) scale(0.75);\n   }\n\n   .transform-2 {\n      transform: scale(0.75) translateX(40px);\n   }\n</style>`, `64306356844733006000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>transform-1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>transform-2<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">p</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> fit-content<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.transform-1</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>40px<span class="token punctuation">)</span> <span class="token function">scale</span><span class="token punctuation">(</span>0.75<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.transform-2</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0.75<span class="token punctuation">)</span> <span class="token function">translateX</span><span class="token punctuation">(</span>40px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果两张图片的位置表现出了明显的不一致，如图 4-46 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-18-21-57-44f9afaa391badce65fe406da32b9807-a3a80.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.42857142857144%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABXElEQVQoz5WRS0sCYRSG3UUbWwRBP6JFi9q2jtbtWwUtWkQLN+1aRS0D/0O4sCtBQUKWzpgTozZJXlPTMQu66eRtnma8RNlg+ML7ceA738N7vmOjR7retnFyV9bJ1UCOhYiEDzj17hGNSJ0+veVe2ayApppG8aA1WnX8aIXoph3n7DCOxYV2X7M5ODBbaQMz+w7O5sfYmBlle21pcGC3L1HRKdQNoPpIPKYQTiu8P2UHH7n7h0kNUuUGSj5LopQhkL7no6J9A63Uf+Qq1LRXfM4pbrbGWZ4ewe1yte4b9bp1wm70nzbTmcBC1Xz5grI+weGcndXJIY7dO7+AvbYEdh0vQ6laIy6coJzv4vG4eS7m2hN0lvIHSB99Gn5rgsHFDFvjf9kEMUgylSafL6CqRS59It4LP2JAQvCL3CrGduUQV4KIFAxSUFUSySRCIIj5VrqW8QkBQpEb5FCEL13N7sl6M4T/AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 18 21 57" title="" data-src="/static/2022-01-23-18-21-57-44f9afaa391badce65fe406da32b9807-fee1c.png" data-srcset="/static/2022-01-23-18-21-57-44f9afaa391badce65fe406da32b9807-a67b7.png 200w,\n/static/2022-01-23-18-21-57-44f9afaa391badce65fe406da32b9807-0b187.png 400w,\n/static/2022-01-23-18-21-57-44f9afaa391badce65fe406da32b9807-fee1c.png 800w,\n/static/2022-01-23-18-21-57-44f9afaa391badce65fe406da32b9807-a3a80.png 875w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>下面一张图片实际偏移大小是 30px，因为先缩小到了原大小的 75%。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/mw9kwb?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="clipclip-path-前置剪裁"><a href="#clipclip-path-%E5%89%8D%E7%BD%AE%E5%89%AA%E8%A3%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>clip/clip-path 前置剪裁</h3>\n<p>一个元素应用 transform 变换之后，同时再应用 clip 或者 clip-path 等属性，此时很多人会误认为剪裁的是应用变换之后的图形，实际上不是的，剪裁的还是变换之前的图形，也就是先剪裁再变换。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46662208694895320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   width: 128px;\n   height: 96px;\n   transform: scale(2);\n   clip-path: circle(48px at 64px 48px);\n}`, `46662208694895320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 128px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 96px<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">clip-path</span><span class="token punctuation">:</span> <span class="token function">circle</span><span class="token punctuation">(</span>48px at 64px 48px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果是先执行 transform 再执行 clip-path，则最终剪裁的圆的半径应该还是 circle() 函数中的 48px，即最终剪裁的圆的直径是 96px；如果是先执行 clip-path 再执行 transform，则最终剪裁的圆的直径应该是 192px，在各个浏览器中实际渲染的结果都是直径为 192px 的圆，如图 4-47 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-18-26-52-0f95dd36302213b7a369710d91edd7df-e1c08.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.810238305383926%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACQUlEQVQoz5WS7W/ScBDH+3f6xsT3vlAJmiXOLEYGdFAo0JX2xxiCRl2mc+4Jo9kGTJ5KKTDYgFU2Hn4rDEfpA2Mb7eyW6CvfeLncJZf75HuXO0TpiqowGF9IY1XWJpOb/zGkUD+LFzrJWn+v3EpyhQzHZfePKlAuwxHblE/FS6NJ1zRdu77RrvXJ1V/Xri+RFa5Pxnr+rxXXm4gzMG/x+p47CBP+wbXV8G3DFC8a8KjHN78TMEbLTHiYDcnM67sYRjZK5/ROEwtFPEHSGwzgIPACAw+e4Q+xTyDRZRpDA1ZhFcZstR2LkEUHRUwsufosJiV9yMa+5FvLOCjSvRgg3gEiBGYx2mqnTS9pdPUw31QMWOlUB4z7W8IW+WL7vO3aTHsOWKeSIg1Y9q7s4uF5T2TBMw+IBYA6gA0FszYaXebyrdEdXDtLz6398KEf39uX3uJrkUJ2Tk4SxthDYpN1B0nXTGDaTJst1KMZavoV9dQC8K0j9uSPcg4/rODFIlYqYsUSdlLClYwfWS/8AnvQa1+yPvZOofSTKeq+mbxnck/5o2Cvl/15t3PnYBC3KwwmZ5xSxqEyTjE1JyXcyGq+T8UFEG1YyGX3IuXw+q04QMPRQAwS2zDN38IXoqDUd+V6XK7FpFpMqcfVo/iITyA96ap1PhZUTVD1dq/fEU67otwf35ypGhxORlf67Z3/9SFGETGSpml8vQbbrZGiwA48bhw3eP6wUu7CTrVaZfMFrljK5bkcy2WZXIbJtdrtW1jXfwNecw86HzDFCgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 18 26 52" title="" data-src="/static/2022-01-23-18-26-52-0f95dd36302213b7a369710d91edd7df-fee1c.png" data-srcset="/static/2022-01-23-18-26-52-0f95dd36302213b7a369710d91edd7df-a67b7.png 200w,\n/static/2022-01-23-18-26-52-0f95dd36302213b7a369710d91edd7df-0b187.png 400w,\n/static/2022-01-23-18-26-52-0f95dd36302213b7a369710d91edd7df-fee1c.png 800w,\n/static/2022-01-23-18-26-52-0f95dd36302213b7a369710d91edd7df-e1c08.png 1133w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由此可以证明，transform 和 clip-path 同时用的时候，是先执行 clip-path 剪裁，另外一个剪裁属性 clip 也是类似的。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/yngl2i?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="动画性能优秀"><a href="#%E5%8A%A8%E7%94%BB%E6%80%A7%E8%83%BD%E4%BC%98%E7%A7%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动画性能优秀</h3>\n<p>CSS 高性能动画三要素指的是绝对定位、opacity 属性和 transform 属性。因此，同样的动画效果，优先使用 transform 属性实现。例如，元素移动动画应使用 transform 属性，而不是 margin 属性。</p>\n<h2 id="元素应用-transform-属性后的变化"><a href="#%E5%85%83%E7%B4%A0%E5%BA%94%E7%94%A8-transform-%E5%B1%9E%E6%80%A7%E5%90%8E%E7%9A%84%E5%8F%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>元素应用 transform 属性后的变化</h2>\n<p>元素应用 transform 属性后还会带来很多看不见的特性变化。</p>\n<h3 id="创建层叠上下文"><a href="#%E5%88%9B%E5%BB%BA%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建层叠上下文</h3>\n<p>和 opacity 属性值不是 1 的元素类似，如果元素的 transform 属性值不是 none，则会创建一个新的层叠上下文。这一特性常被用在下面两个场景中。</p>\n<ol>\n<li>覆盖其他元素。</li>\n<li>限制 z-index: -1 的层级表现。</li>\n</ol>\n<p>在默认情况下，多个 <code class="language-text">&lt;img&gt;</code> 元素相互重叠的时候，一定是 DOM 位置偏后的 <code class="language-text">&lt;img&gt;</code> 元素覆盖 DOM 位置靠前的元素，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78528561898333830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img + img {\n   margin-left: -60px;\n}`, `78528561898333830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img + img</span> <span class="token punctuation">{</span>\n   <span class="token property">margin-left</span><span class="token punctuation">:</span> -60px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 4-48 所示，可以看到 DOM 位置靠后的图片覆盖了 DOM 位置靠前的图片。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-18-31-53-f8f0784ce6fd40427d59cf7051c9a7fd-88b8f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.733102253032925%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAC3ElEQVQozx2Sf0jUZxzHv3/1R2j3a6d33/t+7/k6ImhOt90NL4p+0aBfi1ghsancRfTHRINFYEzTVaKZeauui9xZYJn2QycM1nTK4pqSw2vmzzotVmuB2s5K+6FQvXrqgTcf+Lzez5vP5+FRuk6sJVKYzqWST7l7zss/DV5unfQS/eEz+o956D/h5dyeTzj9XSaDES/3Gz9nTNbr5R56qjyMSB7MzuDw1gyKsz9G6Q17ad5jp61MZewnnXhYY6RGo223SkV2CrUFDtol+7nIybBkY6c0bh/ViBarnNnu4KulNhY7zeR4bCxZaEEZiPhoL1XpPOhm4EeD20GDoQpBdK+bkpVOGvM1uqsEV0p1YkeEDJO8UtBbJghtdbHL4+Aj1UaSyYLdbEOJ1/vorVL5S17qqxbcbTB4IPX3fjetmzX69rnpOyboOeQmJj3xOsGDiwbxGsEvuRqdW3SCK1QyUm18sMCKMlgnA4MuhmqlqdFgsFTwb43BaLHg100a1+WkN0KCfql4k5zusODOQempMujcpnNFBnZI5WekYrXKlXvCWUQrndw8azC8U/B7kkZklYvQJhdBn0rbLp1r1Tq9dW5Gyg26nTr16S7CW1xUL1O5tM7FqfUqG312hFxd+TPko6tWZzD3Q2LzDI5nucn36GSbnaRZUjiap9MTkU/wfRoDpjSaFgkKl+vssKsstqawJs3JUuEgKzMVuyMVJdaQTmx7MsOKlRaviaslFvp2W2hda6Lyi2RaiszcqLAwNN9Ch26m9VsTwwes/LbBxPH1yRz5cgFla5IoWp1EfmYyyp1rBYyW55AIBrga+oab53OZ6ghw/4KfJ5cDPGz3M3raz2RZgKEzefwRzmU6GuDeRT+J5gBTzX7Gm/z8V58n/+3XKMgz8+oNidk55l7Ds5evefTkJZOPnzM+9YJJqcTMLBMvnr2vT5/PMSF744kZJh5LLr3/T88xPfvmXRRvATwp4u0wMOlGAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 18 31 53" title="" data-src="/static/2022-01-23-18-31-53-f8f0784ce6fd40427d59cf7051c9a7fd-fee1c.png" data-srcset="/static/2022-01-23-18-31-53-f8f0784ce6fd40427d59cf7051c9a7fd-a67b7.png 200w,\n/static/2022-01-23-18-31-53-f8f0784ce6fd40427d59cf7051c9a7fd-0b187.png 400w,\n/static/2022-01-23-18-31-53-f8f0784ce6fd40427d59cf7051c9a7fd-fee1c.png 800w,\n/static/2022-01-23-18-31-53-f8f0784ce6fd40427d59cf7051c9a7fd-88b8f.png 1154w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>但是，如果我们给 DOM 位置靠前的图片设置 transform 属性，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90832578906563260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img:first-child {\n   transform: scale(1);\n}`, `90832578906563260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img:first-child</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>则此时 DOM 位置靠前的图片会覆盖 DOM 位置靠后的图片，如图 4-49 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-18-33-34-eb04c107fbf19a21c215aa4ab3b643ba-88b8f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.64644714038128%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACbUlEQVQozwFiAp39AMSVR5ttK6p8Md6kNOCkNNiWM8GAMdSUM8aFMohPLYZSLZ1yL+arNdqaNMiFMsiJMteVM49VLoxULn1WLQDMlTSsdBW5gBvbmh3alh3WjR23cRqPWxc6KxI6IRFPKxNvThbmoB7Wjx3CexueYhhSOhQpGRBbMhM5JRIA0pw3un4avYQf05Ag2I4g1YUgwHYfhkYaZS8YHBYTBggRXEAY5Zkh0oYgzH8glVQccTQZLhsUDxASFRAUANqiN8yJG8mKIM+MH92kIOOlIc6AH69THbxRHXEzGBQKEVg7F+elIeCnIdmOILFcHLxRHY0+Gi0YExQOEwDUnDfMjhvUmSHZpyHUfh/jjSDbeyC1UR29Vh6xTRw8FxRXTBfklSHagR/kiSC9Vx23Ux28Ux1qLRcSEhIAyJY2wYca0KQg1mgguwwdnEAblE4bkTwas04chkYZLSwUYjQY0yMenykbl1Mcjj0arEkcmkobTDgVIBsTAMOTOcWZHtNcJMwHIZM4IGszH1MQGikYGEYiGzokGSUvGFcLG7UoIWo+H2MVGyoTF0MiGzogGTcvGBYaGADNpi3NYxDWABSuNhHAfxPRdROwSBGMTA+NTRB9RA5yPw5+Lw+3aBLVhRS5TRGUSxCNThGARg95RA5tMQ8A3cNw2ohe7JBjwpRe0aZf7btj4Khi7axj7K1j5aVh5aNixo9fwZhf8MBj36hi6qxi7Kxi5qdh46Fh0ZNdAP////P5+O/3+Pr7/fT3++zw9+vv9ejt9Oju9evx+Ojt9O3y9/L1+eru9eru9Ovw9+rw9+zy+fL1+P///870CcIW0UkUAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 18 33 34" title="" data-src="/static/2022-01-23-18-33-34-eb04c107fbf19a21c215aa4ab3b643ba-fee1c.png" data-srcset="/static/2022-01-23-18-33-34-eb04c107fbf19a21c215aa4ab3b643ba-a67b7.png 200w,\n/static/2022-01-23-18-33-34-eb04c107fbf19a21c215aa4ab3b643ba-0b187.png 400w,\n/static/2022-01-23-18-33-34-eb04c107fbf19a21c215aa4ab3b643ba-fee1c.png 800w,\n/static/2022-01-23-18-33-34-eb04c107fbf19a21c215aa4ab3b643ba-88b8f.png 1154w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/76wcb0?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>这就是我们实现鼠标悬停图片放大效果的时候无须指定层级的原因。</p>\n<p>我们再看一个使用 transform 属性限制 z-index: -1 层级位置的案例，有一个模拟纸张投影的效果，HTML 代码结构如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13047766704976493000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;container&quot;>\n   <div class=&quot;page&quot;></div>\n</div>`, `13047766704976493000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>其中，容器元素设置了让效果更突出的深灰色背景，纸张元素使用 ::before 和 ::after 伪元素创建了模拟卷角投影的效果，由于投影效果需要放在纸张元素后面，因此 z-index 设为了负值，如下所示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82809679280432840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   background-color: #666;\n}\n\n.page {\n   width: 300px;\n   height: 200px;\n   background-color: #f4f39e;\n   box-shadow: 0 2px 10px 1px rgba(0, 0, 0, 0.2);\n   border-bottom-right-radius: 50% 10px;\n   position: relative;\n}\n\n.page::before {\n   transform: skew(-15deg) rotate(-5deg);\n   left: 15px;\n   bottom: 10px;\n   box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);\n}\n\n.page::after {\n   transform: skew(15deg) rotate(8deg);\n   right: 15px;\n   bottom: 25px;\n   box-shadow: 8px 8px 10px rgba(0, 0, 0, 0.4);\n}\n\n.page:before,\n.page:after {\n   content: \'\';\n   width: 90%;\n   height: 30%;\n   position: absolute;\n   z-index: -1;\n}`, `82809679280432840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.page</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #f4f39e<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 2px 10px 1px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">border-bottom-right-radius</span><span class="token punctuation">:</span> 50% 10px<span class="token punctuation">;</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.page::before</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>-15deg<span class="token punctuation">)</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-5deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>\n   <span class="token property">bottom</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 8px 16px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.page::after</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>15deg<span class="token punctuation">)</span> <span class="token function">rotate</span><span class="token punctuation">(</span>8deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">right</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>\n   <span class="token property">bottom</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 8px 8px 10px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.4<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.page:before,\n.page:after</span> <span class="token punctuation">{</span>\n   <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 90%<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 30%<span class="token punctuation">;</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token property">z-index</span><span class="token punctuation">:</span> -1<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，::before 和 ::after 伪元素创建的投影效果不见了，如图 4-50 所示</p>\n<p>原因就在于，z-index: -1 是定位在第一个层叠上下文祖先元素的背景层上的，而网页在默认状态下的层叠上下文元素就是 <code class="language-text">&lt;html&gt;</code> 根元素，也就是伪元素创建的阴影效果其实是在页面根元素的上面、在 .container 元素的下面，而 .container 元素设置了背景颜色，挡住了伪元素，因此阴影效果在视觉上不可见。</p>\n<p>要想解决这个问题很简单，把 .container 元素作为层叠上下文元素即可，实现这个操作的方法很多，比较合适的方法就是设置一个无关紧要的 transform 属性值。例如我就喜欢设置 scale(1)，因为拼写更快：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97138407190792850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   transform: scale(1);\n}`, `97138407190792850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>此时的结果如图 4-51 所示，可以看到纸张底部两个角落均出现了明显的卷角投影效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-23-18-47-23-c320a32781f72cbe1bfda81125b54cd1-4c90f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.414001728608476%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABlklEQVQoz6WRW0sCURDH93Mq6Oa6umVG6+4hK3PN1YzqwYegEHWj6FsUVLa6lwdfKixTSNOHLoa7Xshro5kaQQT9+R8OM8yPmTkH8/l8LpcLIcQwrNuNolE+Hg/8tCAEIhE/Quy0MJqmLRYLSZIzMwTDzL5VIvVaTNeiNX1iCJuNWLm0Z7NZCcI6FsYwDFx2u50gSMQ63irRek3QtXhNnxjCZkMol/YpykaStrH+B8PoAFMU9XcYOo1geC0cx61WAsct7O9wGWByvPMAXhmK4zjGxSLkqLzCCwladQCMrVVjABcedj2ry+FweGdne3trCz4I83q9/FABPujx0NCn2zlqvR+2W9/c7x+/vkTWPCt+P0/Ti7Cs0+nE4BgMBqPROEvNcdzS+dm6lNoYWQrJ0mYqGUpcBE9P+AOBXXDOw8Amk8lsNsOyWDqdVhRFVVVlqGQyJYpiUkwNcgokVVlWJUkRL6VEQpJlsKx+CetPqdPpFoolTdNbrfbVdebuPn+TyWZz+dtsrlgsFYqPT88vUNbr9T7rPwA3gLBUTTqyxgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 23 18 47 23" title="" data-src="/static/2022-01-23-18-47-23-c320a32781f72cbe1bfda81125b54cd1-fee1c.png" data-srcset="/static/2022-01-23-18-47-23-c320a32781f72cbe1bfda81125b54cd1-a67b7.png 200w,\n/static/2022-01-23-18-47-23-c320a32781f72cbe1bfda81125b54cd1-0b187.png 400w,\n/static/2022-01-23-18-47-23-c320a32781f72cbe1bfda81125b54cd1-fee1c.png 800w,\n/static/2022-01-23-18-47-23-c320a32781f72cbe1bfda81125b54cd1-4c90f.png 1157w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/45ytkg?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="固定定位失效"><a href="#%E5%9B%BA%E5%AE%9A%E5%AE%9A%E4%BD%8D%E5%A4%B1%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>固定定位失效</h3>\n<p>想要实现固定定位效果，可以应用 position: fixed 声明。大部分情况下，最终的样式表现是符合预期的，但是，如果父元素设置了 transform 变换，则固定定位效果就会失效，样式表现就会类似于绝对定位。例如：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="86384173795120510000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<p>\n   <img data-src=&quot;./1.jpg&quot; />\n</p>\n<p class=&quot;transform&quot;>\n   <img src=&quot;./1.jpg&quot; />\n</p>\n<style>\n   img {\n      position: fixed;\n   }\n\n   .transform {\n      transform: scale(1);\n   }\n</style>`, `86384173795120510000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>transform<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">img</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.transform</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果页面滚动的时候，第一张图片纹丝不动，第二张图片跟着页面滚动，这说明第二张图片的固定定位效果失效了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/bcp7k3?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>此特性表现不包括 IE 浏览器。</p>\n<p>另外，顺便提一下，filter 滤镜也会让子元素的固定定位效果失效。那么，问题来了，如何让变换效果和固定定位同时有效呢？之前有人问过我这样一个问题：产品的要求是既要有动画又要固定定位，有什么方法可以使两者共存呢？解决方法就是使用嵌套，外层元素负责固定定位，内层元素负责实现动画。</p>\n<h3 id="改变-overflow-对绝对定位元素的限制"><a href="#%E6%94%B9%E5%8F%98-overflow-%E5%AF%B9%E7%BB%9D%E5%AF%B9%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E7%9A%84%E9%99%90%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>改变 overflow 对绝对定位元素的限制</h3>\n<p>下面这句话源自 CSS2.1 规范：</p>\n<blockquote>\n<p>如果绝对定位元素含有 overflow 属性值不为 visible 的祖先元素，同时，该祖先元素以及到该绝对定位元素之间的任何嵌套元素都没有 position: static 的声明，则 overflow 对该 absolute 元素不起作用。</p>\n</blockquote>\n<p>现在这个规范已经不准确了，因为现在不仅 position 属性值不为 static 的元素可以影响绝对定位在 overflow 元素中的表现，transform 属性值不为 none 的元素也可以影响绝对定位在 overflow 元素中的表现。例如：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="44965118009443295000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<p>\n   <img data-src=&quot;1.jpg&quot; />\n</p>\n<p class=&quot;transform&quot;>\n   <img src=&quot;1.jpg&quot; />\n</p>\n<style>\n   p {\n      border: solid deepskyblue;\n      width: 150px;\n      height: 150px;\n      overflow: hidden;\n   }\n\n   img {\n      position: absolute;\n   }\n\n   .transform {\n      transform: scale(1);\n   }\n</style>`, `44965118009443295000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>transform<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">p</span> <span class="token punctuation">{</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">img</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.transform</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>第一个 <code class="language-text">&lt;img&gt;</code> 元素没有被 overflow: hidden 隐藏，第二个 <code class="language-text">&lt;img&gt;</code> 元素被 overflow: hidden 隐藏了（因为设置了 transform 变换），如图 4-52 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-26-09-42-50-23836a7b8df9a756ce51930dc7933bd7-f2909.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 768px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.286458333333336%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABwklEQVQoz2P4Dwb//v4BkocPLZnfYnd2VeCBGb6zGn3LQy1P7d0AFP/7589/bIABSv/9DSQu7e/aV8F2e6bMtQ6JLldxGWaGGVMmA8V/37v3/8GD/7du/f/3D6fmCwf7T08VvtqsfjBf6WC0aoom95QJYM137vwH6r979//fvzg1Hz/QciKEYZemQI0WZ5Iat404w/zZU4Dif37/xuvsfyAjb93dd6Gr7Mji+gtb6k+sqD85LfnZhQNgyb/4NP8De+bmgxv7Tqy7dWf7lYubrl7f+x3swX//cQIUZx/b0bYym+HqJPHD5dy1YSqPPn6Dmgu0GUj++4dP89XDfae6BO7MVbvbIb012eT124//P3z4d+XK/zdv/j95AkKfPuHUfPpAz9kGnhMuCt0mQvVuuq/fvP//9es/YAwBAwwY1UCEFtr/IACs+dSJSYfdpbaE6yxOVOxMsn757QfIWIiC/xCHowCYzeBw+fT1w4sX919+fPT5y6PvX5/9+U8AMJw9d/Huvftv3r69e//+jRu3Hjx6cu7c5ZOnLl68fOPSxcv37j24fuP29Rs3r16/ceXq9bPnLpy+cPHY8RMXL10+ceIUAO2ZZxH4inK+AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 26 09 42 50" title="" data-src="/static/2022-01-26-09-42-50-23836a7b8df9a756ce51930dc7933bd7-f2909.png" data-srcset="/static/2022-01-26-09-42-50-23836a7b8df9a756ce51930dc7933bd7-60902.png 200w,\n/static/2022-01-26-09-42-50-23836a7b8df9a756ce51930dc7933bd7-48de7.png 400w,\n/static/2022-01-26-09-42-50-23836a7b8df9a756ce51930dc7933bd7-f2909.png 768w" data-sizes="(max-width: 768px) 100vw, 768px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/g1zgyi?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="改变绝对定位元素的包含块"><a href="#%E6%94%B9%E5%8F%98%E7%BB%9D%E5%AF%B9%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E7%9A%84%E5%8C%85%E5%90%AB%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>改变绝对定位元素的包含块</h3>\n<p>过去绝对定位元素的包含块是第一个 position 属性值不为 static 的祖先元素，现在 transform 属性值不为 none 的元素也可以作为绝对定位元素的包含块。例如：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="73592529958378996000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<p>\n   <img data-src=&quot;1.jpg&quot; />\n</p>\n<style>\n   p {\n      border: solid deepskyblue;\n      width: 150px;\n      height: 150px;\n      transform: scale(1);\n   }\n\n   img {\n      width: 100%;\n      position: absolute;\n   }\n</style>`, `73592529958378996000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">p</span> <span class="token punctuation">{</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">img</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">&lt;img&gt;</code> 元素的宽度是 150px，因为此时的 100% 宽度是相对于父元素 <code class="language-text">&lt;p&gt;</code> 计算的，如图 4-53 所示。但是，如果父元素 <code class="language-text">&lt;p&gt;</code> 没有设置 <code class="language-text">transform: scale(1)</code>，则图片的宽度就不一定是 150px 了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/4mjvuh?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="深入了解矩阵函数-matrix"><a href="#%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3%E7%9F%A9%E9%98%B5%E5%87%BD%E6%95%B0-matrix" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入了解矩阵函数 matrix()</h3>\n<p>transform 变换还支持矩阵函数 matrix()。无论是位移、旋转、缩放还是斜切，其变换的本质都是应用矩阵函数 matrix() 进行矩阵变换。所谓矩阵变换，就是套用矩阵公式，把原先的坐标点转换成另外一个坐标点的过程。其语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20506607226718265000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: matrix(a, b, c, d, e, f);`, `20506607226718265000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">matrix</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>可以看到总共有 6 个参数（a ～ f），参数数量多是多了点，但是，只要你认真学习，就会发现，矩阵真的很难！所以，这里只介绍 2D 变换中的矩阵变换，关于 3D 变换中的矩阵变换大家可以参考更专业的资料。</p>\n<p>matrix() 函数的 6 个参数对应的矩阵如图 4-54 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-26-09-54-03-007c5ca66430691594e5685517f86a84-f690e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 487px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.71868583162218%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABV0lEQVQoz4VQ3WuCcBTtr+6h13oo+qT36E/oxaHOOTfNzGUsmy3KFkFFlEREWmtq7dDdRhvFLnLxnN859ytyPEUQBMjFYjEajeLncDggh2G43++P35FKpeLxOPHERM7NyWSy2+0KguA4DqBt271ej2qxLGsYRjqd/in915zJZMhADVer1Xg8JoFlWXjK5XJXzdlsFiJFUdbrNeB0OuU4joY0TXMymfzTGWMPh0Pf9wHn8/loNCL1crmczWZY+6o5n8/DXCgUBoMBIMMwpVKJ1JIkoRZGu2CmVolEAltVKpXFYgFYr9d5nidBs9ksl8uxWOyCmTBOIoriF3PGU6iq2ul0fpld18Nt/VMQ9eH72AIQT/g8b7vbvSPjckEYbrc7cBvXBRsR7x8bRqtv2337zXM3xnO71WqblmW+vIq3EsPeyZr+IFeZG17TG5quKzVNrukcL8jq0ydfPxhGX7i7LgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 26 09 54 03" title="" data-src="/static/2022-01-26-09-54-03-007c5ca66430691594e5685517f86a84-f690e.png" data-srcset="/static/2022-01-26-09-54-03-007c5ca66430691594e5685517f86a84-28e07.png 200w,\n/static/2022-01-26-09-54-03-007c5ca66430691594e5685517f86a84-e077b.png 400w,\n/static/2022-01-26-09-54-03-007c5ca66430691594e5685517f86a84-f690e.png 487w" data-sizes="(max-width: 487px) 100vw, 487px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>注意书写方向是从上到下的。</p>\n<p>大家可以把矩阵想象成古代的士兵方阵，若要让其发生变化，就要让其与另外一个士兵方阵对战，即使这是一个小方阵。这个变化过程可以用图 4-55 所示的转换公式表现。</p>\n<p>图 4-55 所示的 x 和 y 表示转换元素的所有坐标变量，后面的 ax + cy + e 和 bx + dy + f 就是转换之后的新的坐标，这个新的坐标是如何计算得来的呢？</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-26-09-56-24-b97e34a1f48fa04a1773c011406e5edd-a9af0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 28.39080459770115%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAABHUlEQVQY0z2Py26CYBCFef83YKvEaAIs2BhkhQkxkbRAkUuAWKBcbLkZtKAi0BObMIvJ/POf+WYOUZbl8/k8n8/jOBqGQVFUEAQsy3qeN5vN0CRJ0jTNx+PRti3ERVHc73cU8/mcOJ1O+AjDcBgGx3HW6zUQiqLUdQ0E8nK5RCfP8ziOIfB9P4qiJEl4nidc173dbvv9HvuzLNtsNrZt73Y7QGmahpTjOLDwrKrqcDioqorlgEqSRMiyfL1eRVHs+x7nMQxjWZYgCECsVisQkaHDjsvlkqbpdruFRxSLxYLoug7GcDMy2DgMLmAY9fF4RFPTtKZpUAA0vqJ/ha7rxP/YNJ9nxYdu/DbNZxC+Kdq7on3/ZKZl++HXpJniD0xaPAIZki+3AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 26 09 56 24" title="" data-src="/static/2022-01-26-09-56-24-b97e34a1f48fa04a1773c011406e5edd-fee1c.png" data-srcset="/static/2022-01-26-09-56-24-b97e34a1f48fa04a1773c011406e5edd-a67b7.png 200w,\n/static/2022-01-26-09-56-24-b97e34a1f48fa04a1773c011406e5edd-0b187.png 400w,\n/static/2022-01-26-09-56-24-b97e34a1f48fa04a1773c011406e5edd-fee1c.png 800w,\n/static/2022-01-26-09-56-24-b97e34a1f48fa04a1773c011406e5edd-a9af0.png 870w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这就是大学线性代数的知识了，其实挺简单的。3×3 矩阵每一行的第一个值与后面 1×3 矩阵的第一个值相乘，3×3 矩阵每一行的第二个值与 1×3 矩阵的第二个值相乘，3×3 矩阵每一行的第三个值与 1×3 矩阵的第三个值相乘，然后将 3 个乘积结果相加，如图 4-56 所示。其中，ax + cy + e 表示变换后的水平坐标，bx + dy + f 表示变换后的垂直坐标。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-01-26-09-57-39-6df95ed6d33c81c42097fd00efb1fcae-d9352.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.963176064441885%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABV0lEQVQY0z1Oy07CUBTs/7n2B1yS6Nq4cWFI1IgJG8GFCQkLNiKoRNGimAK22FIqryvQFvqkpbSg2NJCAW9iwsnJ5DxmJoMcZ3fr9MPgIjLt1xgmHI+dWcZ3MLoffNwLR07W6/XdbYogcG/uee5sOv0ZDnU4ue7sJYciR9cBunhDBQIag9F0KJOOCoJ2eXV4HtqKJaKu46LPWYoix5apawNZlgAAI0PXdY2mK0iP5V3XqzTq88XCsibYW54VhadImNnZTiUTqqLkX3MU+aGqymRsKrJcJnBoBJtju8hnteI4v0QJ8/2FJAqZ+zTPC6nkKU0cxGMhGBtFs2QZZ7ttKLBtGy8VzNHQMkfFAoZADWSsViuI8Ndpt33fh1QYk2U78AhaLcMwNhxYy6UPkec45H+HyRmmJkqK7cwaTVCt1pkaaH11mwDwfZHleoIgFQvEO06qqr4x+gNJwi8QaZ+V2gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 01 26 09 57 39" title="" data-src="/static/2022-01-26-09-57-39-6df95ed6d33c81c42097fd00efb1fcae-fee1c.png" data-srcset="/static/2022-01-26-09-57-39-6df95ed6d33c81c42097fd00efb1fcae-a67b7.png 200w,\n/static/2022-01-26-09-57-39-6df95ed6d33c81c42097fd00efb1fcae-0b187.png 400w,\n/static/2022-01-26-09-57-39-6df95ed6d33c81c42097fd00efb1fcae-fee1c.png 800w,\n/static/2022-01-26-09-57-39-6df95ed6d33c81c42097fd00efb1fcae-d9352.png 869w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>我们通过一个简单的例子来快速了解一下，假设矩阵参数如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34793223401411867000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: matrix(1, 0, 0, 1, 30, 30); /* a=1, b=0, c=0, d=1, e=30, f=30 */`, `34793223401411867000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">matrix</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 30<span class="token punctuation">,</span> 30<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* a=1, b=0, c=0, d=1, e=30, f=30 */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们随便选取一个点坐标，例如(0, 0)，即 x=0, y=0。于是，矩阵计算后的 x 坐标就是 ax + xy + e = 1 × 0 + 0 × 0 + 30 = 30。矩阵计算后的 y 坐标就是 bx + dy + f = 0 × 0 + 1 × 0 + 30 = 30。</p>\n<p>也就是点坐标从 (0, 0) 变成了 (30, 30)。请读者好好想象一下，原来 (0, 0) 的位置，经过矩阵变换后就移到了 (30, 30) 的位置，是不是等同于往右方和下方各偏移了 30px？如果我们再选取其他坐标点进行计算，就会发现计算后的坐标相比原坐标同样是往右方和下方各偏移了 30px。实际上 transform: matrix(1, 0, 0, 1, 30, 30) 等同于 transform: translate(30px, 30px)。</p>\n<p>注意，translate()、rotate() 等函数都是需要单位的，而 matrix() 函数中的参数的单位是省略的。</p>\n<h4 id="位移：translate-函数"><a href="#%E4%BD%8D%E7%A7%BB%EF%BC%9Atranslate-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>位移：translate() 函数</h4>\n<p>位移变换函数 translate(x, y) 中的 x 和 y 分别对应 matrix() 函数中的 e 和 f 两个参数，语法示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84903386919757450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: matrix(a, b, c, d, 水平偏移距离, 垂直偏移距离);`, `84903386919757450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">matrix</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> 水平偏移距离<span class="token punctuation">,</span> 垂直偏移距离<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们只要关心最后 2 个参数就可以了，至于前面 4 个参数，它们和位移变化没有关系。</p>\n<h4 id="缩放：scale-函数"><a href="#%E7%BC%A9%E6%94%BE%EF%BC%9Ascale-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缩放：scale() 函数</h4>\n<p>偏移变换只需要关心最后 2 个参数，缩放变换同样也只需要关心 2 个参数，那么是哪两个呢？</p>\n<p>下面的 CSS 声明是位移变换使用的矩阵变换值，其中两个数值为 1 的参数就是与缩放变换计算相关的参数，因为缩放默认大小就是 1：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11515415779258964000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: matrix(1, 0, 0, 1, 30, 30); /* a=1, b=0, c=0, d=1, e=30, f=30 */`, `11515415779258964000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">matrix</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 30<span class="token punctuation">,</span> 30<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* a=1, b=0, c=0, d=1, e=30, f=30 */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中参数 a 表示 x 轴缩放大小，参数 d 表示 y 轴缩放大小。</p>\n<p>我们套用矩阵计算公式计算下就明白了，假设原始坐标是 (x, y)，缩放比例是 s，则：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81002848757182580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x\' = ax + cy + e = sx + 0y + 0 = sx\ny\' = bx + dy + f = 0x + sy + 0 = sy`, `81002848757182580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x&#39; = ax + cy + e = sx + 0y + 0 = sx\ny&#39; = bx + dy + f = 0x + sy + 0 = sy</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>可以看到最终的坐标就是原始坐标按缩放比例缩放的结果，表明参数 a 和参数 d 确实是和缩放相关的矩阵参数。我们不妨测试一下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91978505582395060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   transform: matrix(3, 0, 0, 1, 0, 0);\n}`, `91978505582395060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">matrix</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>其中参数 a 是 3，参数 d 是 1，这表示水平 x 轴放大 3 倍，垂直 y 轴的大小是原来的 1 倍（相等），最终的效果如图 4-57 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-09-13-40-42-6369af540e99930be19907237a0f0e8a-e2f03.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 33.179190751445084%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABtklEQVQY0wGrAVT+ALJ8KKd3Kp5xKa18KtacLuCkL9+iLt2dLtmWLtKOLsSBLbBzK7yCLLGBLIBZJ2I+JWtAJoVPJ3xPJl1DJQDFhhq9ghy5fxu9gRzMih3VkB7Zlh7amR7Ykh7TiB3Lfx2kZBqFRhdzOBZeLRQ1HBIXERAgFhAhFBESDREAz5AezY4hzo8g0Zgg1KAh1p8h2JAh24Qg45ch4pUh3YYhymofsE4dzVsgwFYew1YegDoaSyIVKhgTDhATAMCJIcWUJMybJNWNJNhmJdRCJcMsI54cIY8+IYpIIYg0IG0zHmAsHX82H4dBH3Y5HmM3HUc7GyklGREWGADGlhfLfBvTPBrTGRfPJhipLxWYShPDhhi3cxajTBWoQBWHRxJ0RRKDRxSITBR1QhJzQhN/TRVyQxRiMBMA7+O67si69L67+dbA+OS93dK75NS9/+6//+zB++XA++K//+a//+K//+K//+XA/uLA99i7+dm69Na679C5AP7///////b3+M3V3Ovw9+zw8tbb49TZ5cbO2MjO2M/V3tLZ49Tb5M7U387T38/X4PT39/////7//////4i0159I8EPAAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 09 13 40 42" title="" data-src="/static/2022-02-09-13-40-42-6369af540e99930be19907237a0f0e8a-fee1c.png" data-srcset="/static/2022-02-09-13-40-42-6369af540e99930be19907237a0f0e8a-a67b7.png 200w,\n/static/2022-02-09-13-40-42-6369af540e99930be19907237a0f0e8a-0b187.png 400w,\n/static/2022-02-09-13-40-42-6369af540e99930be19907237a0f0e8a-fee1c.png 800w,\n/static/2022-02-09-13-40-42-6369af540e99930be19907237a0f0e8a-e2f03.png 865w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>可以看到图片水平拉伸了 3 倍。</p>\n<h4 id="旋转：rotate-函数"><a href="#%E6%97%8B%E8%BD%AC%EF%BC%9Arotate-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>旋转：rotate() 函数</h4>\n<p>旋转要比位移和缩放难一些，需要用到三角函数的知识。</p>\n<p>假设旋转角度为 θ，则矩阵计算方法和参数如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1215362159835686700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`matrix(cosθ, sinθ, -sinθ, cosθ, 0, 0)`, `1215362159835686700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">matrix</span><span class="token punctuation">(</span>cosθ<span class="token punctuation">,</span> sinθ<span class="token punctuation">,</span> -sinθ<span class="token punctuation">,</span> cosθ<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>结合矩阵公式，就有：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98156978795686800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x\' = xcosθ - ysinθ + 0 = xcosθ - ysinθ\ny\' = xsinθ + ycosθ + 0 = xsinθ + ycosθ`, `98156978795686800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x&#39; = xcosθ - ysinθ + 0 = xcosθ - ysinθ\ny&#39; = xsinθ + ycosθ + 0 = xsinθ + ycosθ</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>假设原坐标是 (100, 100)，旋转角度为 60 度，则有：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67138758614109315000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x\' = 100 * 0.5 - 100 * 0.866025 = -36.6025\ny\' = 100 * 0.866025 + 100 * 0.5 = 136.6025`, `67138758614109315000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x&#39; = 100 * 0.5 - 100 * 0.866025 = -36.6025\ny&#39; = 100 * 0.866025 + 100 * 0.5 = 136.6025</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>用坐标图表示就是图 4-58 所示的 A 点 (100, 100) 变换到了 B 点 (−36.6025, 136.6025)。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-09-13-48-05-1d43642dfe968cda67678561d82fd64c-ad786.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 457px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 109.62800875273521%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACyUlEQVQ4y51TaVPaYBDmr/d7O5VKuMIRKnJDIoxMWxVFCUcg5FBLqW0dHatc4chFhAS6Cc7QOsqH7uy8s9l3n2efdzNrW240QRA0TXvt1rYBuVgsFEXeULAGz+eGqDxKf7koa73BWFZn0r95w1iswdABzh+3QzTDYFkuuGc6luUxgkNTdTPI8qtkgOBCOV4YqyvUGnx1K3hSzQDOQoUvw7jjNVes+h4rOKMVT7Lux1m/lQeKwcvgZDNgdqMduyVPgoJSwJtECQqJkBAAxSvgG7OzP9N07Jp1AYK3wBU/zq0YkUh5E9ibMtWiaRqqoQ7AzigAIAYuDrSAEHj/GrywDD6+W52talOe6abg+orI5ErTTgssjKcLQ1dV1SZJkqKo2lTh23fbYXILO3bFqzAkYHHFa3ZvHt4PgsFBFMzPHa/87ozEyXg4Gj0fGFQ8tSW4QIq2u/JvttLvAkfB7Lkv3QQK7PWBMU6YEEwL57wZNpljiyRXJFk820Bx3pumn7/5GRhNNUAwjBol+ChO5w6axCET2+dCO2eY74svRQf3+Ff/c5DgXImaK3wWipDBWNURheGzbpzD3PsRTx7NnkPBi+ChN83AHfxJX6aZ+JDGPPv2COlNUq5oGSU4DGewWDVkyp6uwYYF/nY9sIcpZ7yBxOqORNMdriAfS2+x0+0ohSRoJNZA4jSyW0N3yP5I+buzuSJjSbv82W/9Gljeb13cfL0esK271rX1aSUh077qTMfixn3W9eV8Bpyq+sI+LzQNFn35JBsW1LJVoINPNX020w1DlhVIQqDr1mmYBqTG4yPgbcv/Nuisz2f39w+yOp2IoihJkByNRsPhWBgOe/1Bt9vr9nqruNPt9gfCZCJ2e/2HTlfXdZsqTzJE7qJ9xbDcZaut63Oq3iielMkyVSiW8p8ODo6OS+Xq58MTCApnJMOwFEUfFU5lZfoH6wdogALDRiUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 09 13 48 05" title="" data-src="/static/2022-02-09-13-48-05-1d43642dfe968cda67678561d82fd64c-ad786.png" data-srcset="/static/2022-02-09-13-48-05-1d43642dfe968cda67678561d82fd64c-aaeb0.png 200w,\n/static/2022-02-09-13-48-05-1d43642dfe968cda67678561d82fd64c-4d187.png 400w,\n/static/2022-02-09-13-48-05-1d43642dfe968cda67678561d82fd64c-ad786.png 457w" data-sizes="(max-width: 457px) 100vw, 457px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>因此，元素旋转 60 度也可以使用下面的矩阵函数表示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="428918682960532900"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: matrix(0.5, 0.866025, -0.866025, 0.5, 0, 0);\n/* 等同于 */\ntransform: rotate(60deg);`, `428918682960532900`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">matrix</span><span class="token punctuation">(</span>0.5<span class="token punctuation">,</span> 0.866025<span class="token punctuation">,</span> -0.866025<span class="token punctuation">,</span> 0.5<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 等同于 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>60deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h4 id="斜切：skew-函数"><a href="#%E6%96%9C%E5%88%87%EF%BC%9Askew-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>斜切：skew() 函数</h4>\n<p>斜切用到了三角函数 tan，对应的是 b 和 c 两个参数，需要注意的是 b 参数表示的是 y 轴的斜切，而后面的参数 c 才是 x 轴的斜切。计算公式如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35915314859249570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`matrix(1, tan(θy), tan(θx), 1, 0, 0);`, `35915314859249570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">matrix</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> <span class="token function">tan</span><span class="token punctuation">(</span>θy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">tan</span><span class="token punctuation">(</span>θx<span class="token punctuation">)</span><span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>假设原坐标是 (x, y)，则套用矩阵公式后的坐标计算结果为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5071958454127667000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x\' = x + ytan(θx) + 0 = x + ytan(θx)\ny\' = xtan(θy) + y + 0 = xtan(θy) + y`, `5071958454127667000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x&#39; = x + ytan(θx) + 0 = x + ytan(θx)\ny&#39; = xtan(θy) + y + 0 = xtan(θy) + y</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h4 id="汇总说明"><a href="#%E6%B1%87%E6%80%BB%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>汇总说明</h4>\n<p>通过上面的分析，我们可以得到下面的结论：</p>\n<ul>\n<li>位移变换使用的是矩阵参数 e 和 f；</li>\n<li>缩放变换使用的是矩阵参数 a 和 d；</li>\n<li>旋转变换使用的是矩阵参数 a、b、c 和 d；</li>\n<li>斜切变换使用的是矩阵参数 b 和 c。</li>\n</ul>\n<p>仔细查看上面的结论，不难发现同时使用不同的变换就会有参数冲突的问题，假如想要同时使用旋转变换和缩放变换，各个参数值该如何使用矩阵表示呢？使用空格分开表示即可，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72250270298865200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: matrix(0.5, 0.866, -0.866, 0.5, 0, 0) matrix(3, 0, 0, 1, 0, 0);`, `72250270298865200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">matrix</span><span class="token punctuation">(</span>0.5<span class="token punctuation">,</span> 0.866<span class="token punctuation">,</span> -0.866<span class="token punctuation">,</span> 0.5<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span> <span class="token function">matrix</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>可以看到，使用 matrix() 函数表示实在太麻烦了，参数很多，还要计算和记忆。因此日常开发中我们使用的都是更加语义化的快捷函数，例如上面的矩阵表示实际上可以写作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64708912700623400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: rotate(60deg) scale(3, 1);`, `64708912700623400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>60deg<span class="token punctuation">)</span> <span class="token function">scale</span><span class="token punctuation">(</span>3<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但是，这并不表示 matrix()函数一无是处，举两个应用场景例子。</p>\n<ol>\n<li>\n<p>跨语言的图形变换处理。矩阵的计算是各个语言通用的，在跨语言、跨设备处理的时候，matrix() 函数就很有用。例如，在 Web 中呈现医学影像的图形，后台数据库存储的往往就是矩阵变换坐标，此时有了 matrix() 函数，就可以直接呈现了。</p>\n</li>\n<li>\n<p>前面提到运行 <code class="language-text">transform: scale(.75) translateX(40px)</code> 最后元素的水平偏移大小是 30px，这让不少开发者“踩了坑”，如果使用 matrix() 函数表示，就不会有这样的问题出现了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4109312707264090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: matrix(0.75, 0, 0, 0.75, 40, 0);`, `4109312707264090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">matrix</span><span class="token punctuation">(</span>0.75<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.75<span class="token punctuation">,</span> 40<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n</ol>\n<h4 id="3d-矩阵变换"><a href="#3d-%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3D 矩阵变换</h4>\n<p>最后，关于 3D 矩阵变换再多说一两句。3D 矩阵变换不再是 3×3，而是 4×4，其计算方式和 2D 变换一致，只是上升了 1 个维度，计算复杂度增加了。这里简单示意下 3D 缩放效果的矩阵计算公式，如图 4-59 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-09-14-01-41-f710f92ea825c9a5b44323b11de710d8-acb24.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 399px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.902255639097746%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABsElEQVQoz6WRSWvCUBSF/Z1u/BPu6kZwJygibkRBNyqtGG1JnGglQtHGGCM4VdOsnBaiGZ5xQE2PvEKplG7qQr7cd889d3BcLhfbtnVdd7lc1WrVsqzD4YCIIAjr9RrQarUWiwVgOBzyPO90OieTCT7P57ODiqfTaSKRGAwGDMMcj0dE/H6/oiiAcDjc6/UA8Xi83+9nMpl2u/1DPJvNotEoQBRFQgj0q9WKVoHzcrkEQKNpGjw6nc6tOBaLAYLBIFiW5WKxuNvtaKTb7QKQgBZSqZQkSb87o/x2u4VnvV5HC4hgcloFPePpL+dQKKSqKiAQCCCIJeVyOdM0qTNaSKfTt87z+ZyK4UxTKSADAoyKyHg8RnIymcRQt9uGJ8Dn89FLeL3e0WhEIzgboFaroUokEvne9ul0AuG8dx5Po9EwDINOiNvSg2PVeKU5WJjb7UabX2L7Hz8HrAi5rhf/+/0BU2wtC7zZaKZJTEI0XUeObgCJYZgbTUNHyMerg2O5LMMqH2pTEIfv12nfhFblhX/I5gts6bFUeWS5whOXZ0vl8nOBK9/nCqIkC6L02hQ+AW+vdYgVLdPHAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 09 14 01 41" title="" data-src="/static/2022-02-09-14-01-41-f710f92ea825c9a5b44323b11de710d8-acb24.png" data-srcset="/static/2022-02-09-14-01-41-f710f92ea825c9a5b44323b11de710d8-ff279.png 200w,\n/static/2022-02-09-14-01-41-f710f92ea825c9a5b44323b11de710d8-acb24.png 399w" data-sizes="(max-width: 399px) 100vw, 399px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>用代码表示就是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55351195458134426000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: matrix3d(sx, 0, 0, 0, 0, sy, 0, 0, 0, 0, sz, 0, 0, 0, 0, 1);`, `55351195458134426000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">matrix3d</span><span class="token punctuation">(</span>sx<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> sz<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="常常被遗忘的-transform-origin-属性"><a href="#%E5%B8%B8%E5%B8%B8%E8%A2%AB%E9%81%97%E5%BF%98%E7%9A%84-transform-origin-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>常常被遗忘的 transform-origin 属性</h3>\n<p>transform-origin 属性可以用来改变元素变换的中心坐标点。很多开发者容易把这个 CSS 属性给遗忘，这个属性还是很实用的，大家可以强化记忆一下。</p>\n<p>变换默认是相对于元素的中心点进行的，这个中心点是由 transform-origin 属性决定的。</p>\n<p>在 IE9 浏览器中的 transform-origin 属性支持 2 个属性值，在 IE10+ 浏览器中则支持 3 个属性值，分别表示 x 轴、 y 轴和 z 轴的变换中心点，初始值是 50%、50% 和 0，其中需要注意以下几点。</p>\n<ul>\n<li>z 轴只能是数值。</li>\n<li>x 轴和 y 轴支持百分比值、数值和关键字属性值（left | center | right | top | bottom）。</li>\n<li>关键字属性值自带方位，因此 y 轴关键字写在前面也是合法的，例如：</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23808278516327854000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* x轴 | y轴 */\ntransform-origin: right top;\n/* y轴 | x轴 */\ntransform-origin: top right;`, `23808278516327854000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* x轴 | y轴 */</span>\n<span class="token property">transform-origin</span><span class="token punctuation">:</span> right top<span class="token punctuation">;</span>\n<span class="token comment">/* y轴 | x轴 */</span>\n<span class="token property">transform-origin</span><span class="token punctuation">:</span> top right<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>center 关键字可省略，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8063363252451739000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform-origin: bottom center;\n/* 可以写作 */\ntransform-origin: bottom;`, `8063363252451739000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform-origin</span><span class="token punctuation">:</span> bottom center<span class="token punctuation">;</span>\n<span class="token comment">/* 可以写作 */</span>\n<span class="token property">transform-origin</span><span class="token punctuation">:</span> bottom<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>同样，如果看到单个值语法，则另外一个省略的值就是 50%，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78403834989234340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform-origin: 20px;\n/* 等同于 */\ntransform-origin: 20px 50%;`, `78403834989234340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform-origin</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n<span class="token comment">/* 等同于 */</span>\n<span class="token property">transform-origin</span><span class="token punctuation">:</span> 20px 50%<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>transform-origin 属性在实际项目开发中主要用在下面两个场景。</p>\n<ol>\n<li>\n<p>模拟现实世界物体的运动。例如蜡烛火焰摆动的效果，该效果需要设置火焰元素的 transform-origin 属性值为 bottom，这样火焰摆动的时候才自然。又如实现钟摆运动的动画效果，需要设置 transform-origin 属性值为 top，这样钟摆顶部就会固定，下方会摆动。</p>\n</li>\n<li>\n<p>布局与定位。例如，在 Chrome 浏览器中想要实现 10px 大小的字符，可以先设置 12px 大小的字符，然后缩放一下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31947933145544870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.text {\n  transform: scale(0.83333);\n}`, `31947933145544870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.text</span> <span class="token punctuation">{</span>\n  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0.83333<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但是这样做有一个问题，transform 变换的时候元素的原始位置是保留的，这会导致元素缩小后原本设定的间距变大，此时可以使用 transform-origin 属性优化一下。如果元素是左对齐的，则可以设置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25090009661618872000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform-origin: left;`, `25090009661618872000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform-origin</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果元素是右对齐的，则可以设置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87665081460580700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform-origin: right;`, `87665081460580700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform-origin</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n</ol>\n<p>transform-origin 属性是支持 CSS 过渡和 CSS 动画效果的，活用这个特性可以实现体现数学之美的运动轨迹效果，本书不展开讲解。</p>\n<h4 id="transform-origin-属性作用原理"><a href="#transform-origin-%E5%B1%9E%E6%80%A7%E4%BD%9C%E7%94%A8%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transform-origin 属性作用原理</h4>\n<p>transform-origin 属性的作用原理就是改变 transform 变换的中心点坐标。transform 变换默认的中心点坐标为 (0, 0)，如图 4-60 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-11-11-20-58-913d68e9b76ae02aa463a1b69bda7170-6566f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 462px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 108.44155844155843%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsSAAALEgHS3X78AAACLUlEQVQ4y51U7W/SYBDvP2/8oDFZ5srK+gIC5ZPGRWRAsYUZE3Bs4DaqU3ASNbxsDGiBtvbNe/q0WAZIsssvT+653u/uenct4brOZriqMlFV1UWyxoEIu94Tx3E0beaukRWyaVqj8TSACufdSO32bsbBFQOMum7gEISXwAa12x8xCZFLlUKQKC7v6zxCPF3eZwX5y0/wt217iUwnRDZVCiPK5cPXWLocYYXmRnJSCnvvczmkBMZtZEwLvCl2OTMfJlv/LTspocwQaJGZL61mdhZkLmB6igTvHOOPufTxatmKohC6rs3nM9M0fnS6ETYXjQvRWGGB59QhSWf2DjLQdrjSL4Rd6m39vO045nA4JKB0yzIh0u/uMBovMkkRBgYnnXgHmXcirx4/jT96wlGxPIOKl/aYwqXcAX+gEXiTvLLHdOJfq3H9eM6BpYwbJl/92tJt2BA4gQwJmdQDRgXdZpfnzG8mQxKOLyOgfUQKNMlT/CtaT664Zj2hYbsHeQhMApgC6Sk7kQzJCGRgBOYzMnve7NwnK9P5yVmr1mgj1DFaH6pN3+IZTxvtSu1rfzD22mxv+Z4NXdv+PUMYABZPsbz5W/Ab8a3I4tttVKlPfrggsmEYvf5A07TpbDafa5Dw9haW7w4wGNwoigrW0XhiGH8mEwVBUfDPBJF7vcHL128uLuXKx9r1dQeeZY+Eo1wxL4jZnFA9Oa03LirVmvz56qz+SSq9L4qlb63vQPwLWfpXAj1GtU8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 11 11 20 58" title="" data-src="/static/2022-02-11-11-20-58-913d68e9b76ae02aa463a1b69bda7170-6566f.png" data-srcset="/static/2022-02-11-11-20-58-913d68e9b76ae02aa463a1b69bda7170-c4b43.png 200w,\n/static/2022-02-11-11-20-58-913d68e9b76ae02aa463a1b69bda7170-5dba5.png 400w,\n/static/2022-02-11-11-20-58-913d68e9b76ae02aa463a1b69bda7170-6566f.png 462w" data-sizes="(max-width: 462px) 100vw, 462px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>为了方便大家理解，我就使用这个中心点坐标来做原理讲解。在默认状态下，这个点的坐标是 (0, 0)。2D 矩阵变换的坐标转换公式如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17902513598260562000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x\' = ax + cy + e\ny\' = bx + dy + f`, `17902513598260562000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x&#39; = ax + cy + e\ny&#39; = bx + dy + f</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>坐标 (0, 0) 表示 x 是 0，y 是 0，因此，此时无论旋转多少度，变换后的坐标还是 (0, 0)，因为旋转相关的 4 个参数 a、b、c、d 都是与 0 相乘。</p>\n<p>现在，我们设置变换中心点位于左上角：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96752182821019530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform-origin: 0 0;`, `96752182821019530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform-origin</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在的中心点坐标就不是 (0, 0) 了，而是 (140, -145)（这是因为色块尺寸为 280px×290px），如图 4-61 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-11-11-51-31-932f4a483de590f832e105e599c8dd37-2c5fa.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 601px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 82.36272878535773%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAABeUlEQVQoz6WT7U+CQBzH/ft71dZS84FDBHRztmZzuVQeXrl62XxKQMU04GjRQiEXYAeYw2WO1nffHce4z933Bz8Sm4g8zzPNd89zN78LrXFdJ5wnwovjfK7XH7ZtaZoOdQO+GPoPQ/3VXK4sa7U0zT3Y3851kMly4+S0BEgGL/E4zW1NcYUSf4G3un0ZLXZdbw9GeLCDc3ndSYMmRnF5ko0ao/kkaHYHTwHsHoDRyVf1+yzBAprDEEBxOwOaT8WA7zIFZg8OJjjFprA4MBHAKDnFUZlaOVklc/XKeSWdv40Hh1GL7SJ2A0gWFBmcjHlyoQ2+S81TfKTmVncwixt7V/AfXliOYHGaBwGwG9FnT+Ot3vAoXK11klgzS7RR+KizBHOWaTz0jsYeTxVBUsTxAT+KC+NtGbb3FvZ8hfde2OHH/wrUhoF9JTb/UKLXH2oaNAzDsu3hSBgJkqpCVYOiNJnN51DXRWm8eFbQOJnKiqqp0H80leWRIH4B6Z5H0RvhvZsAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 11 11 51 31" title="" data-src="/static/2022-02-11-11-51-31-932f4a483de590f832e105e599c8dd37-2c5fa.png" data-srcset="/static/2022-02-11-11-51-31-932f4a483de590f832e105e599c8dd37-31ae8.png 200w,\n/static/2022-02-11-11-51-31-932f4a483de590f832e105e599c8dd37-e4d65.png 400w,\n/static/2022-02-11-11-51-31-932f4a483de590f832e105e599c8dd37-2c5fa.png 601w" data-sizes="(max-width: 601px) 100vw, 601px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>此时，中心点的旋转变换坐标值就变成了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1153513944982020900"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x\' = ax + cy + e = a * 140 - c * 145 + e\ny\' = bx + dy + f = b * 140 - d * 145 + f`, `1153513944982020900`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x&#39; = ax + cy + e = a * 140 - c * 145 + e\ny&#39; = bx + dy + f = b * 140 - d * 145 + f</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>显然是一个有着明显坐标变化的新的坐标点，于是视觉上就有元素绕着左上角旋转的效果了。</p>\n<p>总结一下，所有 transform 变换本质上都是坐标点位置的矩阵变换，transform-origin 属性变化后，所有点的坐标都会发生变化，这导致最终的矩阵变换计算结果也发生变化。</p>\n<h3 id="scale-函数缩放和-zoom-属性缩放的区别"><a href="#scale-%E5%87%BD%E6%95%B0%E7%BC%A9%E6%94%BE%E5%92%8C-zoom-%E5%B1%9E%E6%80%A7%E7%BC%A9%E6%94%BE%E7%9A%84%E5%8C%BA%E5%88%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>scale() 函数缩放和 zoom 属性缩放的区别</h3>\n<p>除了 Firefox 浏览器不支持 zoom 属性，其他所有浏览器都支持，且支持时间非常早，移动端也可以放心使用。zoom 属性的正式语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75423459447686380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`zoom: normal | reset | <number> | <percentage>;`, `75423459447686380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">zoom</span><span class="token punctuation">:</span> normal | reset | &lt;number> | &lt;percentage><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>从语法中可以看出 zoom 属性支持以下属性值。</p>\n<ul>\n<li>百分比值。zoom: 50%，表示缩小到原来的一半。</li>\n<li>数值。zoom: 0.5，表示缩小到原来的一半。</li>\n<li>normal 关键字。zoom: normal 等同于 zoom: 1，是默认值。</li>\n<li>reset 关键字。zoom: reset，表示用户按 Ctrl 和 − 或 Ctrl 和 + 进行文档缩放的时候，元素不跟着缩小与放大。不过，这个关键字兼容性很糟糕，仅被 Safari 浏览器支持。</li>\n</ul>\n<p>下面我通过对比 zoom 属性缩放和 scale() 函数缩放的不同之处带大家快速了解一下 zoom 属性。</p>\n<ol>\n<li>\n<p>标准和非标准区别。zoom 属性是一个非标准属性，虽然 MDN 文档建议不要在非生产环境使用，但是根据我的判断，浏览器日后绝无可能放弃对 zoom 属性的支持。</p>\n</li>\n<li>\n<p>坐标系不同。zoom 属性缩放的中心坐标是相对于元素的左上角，且不能修改。transform 变换中的 scale() 函数缩放默认的中心坐标是元素的中心点。</p>\n</li>\n<li>\n<p>占据的尺寸空间表现不同。zoom 属性缩放会实时改变元素占据的尺寸空间。例如，一个图片原始尺寸是 128px×96px，则应用下面的 CSS 代码后，图片占据的尺寸就会变成 256px×192px，该图片周围的元素会被推开，并会触发重绘和重计算，因此 zoom 属性缩放的性能比 scale() 函数缩放的性能差。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63364310846182590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n  zoom: 2;\n}`, `63364310846182590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n  <span class="token property">zoom</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果图片使用的是 scale() 函数缩放，则占据的尺寸还是原先的 128px×96px。</p>\n</li>\n<li>\n<p>元素应用 zoom 属性不会出现应用 transform 属性后的 N 个变化。元素应用 zoom 属性不会创建层叠上下文，不会影响 fixed 元素的定位和 overflow 属性对绝对定位的溢出隐藏，也不会改变绝对定位元素的包含块。</p>\n</li>\n</ol>\n<p>总而言之，zoom 属性就是一个普普通通的改变元素比例的 CSS 属性。</p>\n<h3 id="了解全新的-translate、scale-和-rotate-属性"><a href="#%E4%BA%86%E8%A7%A3%E5%85%A8%E6%96%B0%E7%9A%84-translate%E3%80%81scale-%E5%92%8C-rotate-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解全新的 translate、scale 和 rotate 属性</h3>\n<p>最新的 CSS Transforms Level 2 规范针对位移、缩放和旋转定义了全新的 CSS 属性。例如，位移可以直接使用 translate 属性，该属性支持 1 ～ 3 个值，分别表示 x 轴、y 轴和 z 轴，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18696053970889847000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`translate: 50%;\ntranslate: 10px 20px;\ntranslate: 50% 105px 5rem;`, `18696053970889847000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">translate</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n<span class="token property">translate</span><span class="token punctuation">:</span> 10px 20px<span class="token punctuation">;</span>\n<span class="token property">translate</span><span class="token punctuation">:</span> 50% 105px 5rem<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>缩放可以直接使用 scale 属性，支持 1 ～ 3 个值，分别表示 x 轴、y 轴和 z 轴，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51805507126386880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`scale: 1;\nscale: 1.5;\nscale: 1 2 3;`, `51805507126386880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">scale</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n<span class="token property">scale</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span>\n<span class="token property">scale</span><span class="token punctuation">:</span> 1 2 3<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>旋转可以直接使用 rotate 属性，语法相对复杂些：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43641494181977645000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`rotate: 45deg;\n/* 指定旋转轴 */\nrotate: x 90deg;\nrotate: y 0.25turn;\nrotate: z 1.57rad;\n/* 矢量角度值 */\nrotate: 1 1 1 90deg;`, `43641494181977645000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">rotate</span><span class="token punctuation">:</span> 45deg<span class="token punctuation">;</span>\n<span class="token comment">/* 指定旋转轴 */</span>\n<span class="token property">rotate</span><span class="token punctuation">:</span> x 90deg<span class="token punctuation">;</span>\n<span class="token property">rotate</span><span class="token punctuation">:</span> y 0.25turn<span class="token punctuation">;</span>\n<span class="token property">rotate</span><span class="token punctuation">:</span> z 1.57rad<span class="token punctuation">;</span>\n<span class="token comment">/* 矢量角度值 */</span>\n<span class="token property">rotate</span><span class="token punctuation">:</span> 1 1 1 90deg<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面将逐一讲解上述语法中的元素：</p>\n<ul>\n<li>rotate: 45deg 等同于 transform: rotate(45deg)，是一个 2D 旋转变换；</li>\n<li>rotate: x 90deg 等同于 transform: rotateX(90deg)；</li>\n<li>rotate: y 0.25turn 等同于 transform: rotateY(0.25turn)；</li>\n<li>rotate: z 1.57rad 等同于 transform: rotateZ(1.57rad)；</li>\n<li>rotate: 1 1 1 90deg 等同于 transform: rotate3D(1, 1, 1, 90deg)。</li>\n</ul>\n<p>目前只有 Firefox 浏览器支持这个新特性，想要在实际项目中使用这个新特性，还需要一段时间，大家了解即可。最后，没有 skew 属性。</p>\n<h1 id="简单实用的-calc-函数"><a href="#%E7%AE%80%E5%8D%95%E5%AE%9E%E7%94%A8%E7%9A%84-calc-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简单实用的 calc() 函数</h1>\n<p>calc() 函数非常实用，项目使用率接近 100%，且其语法简单，效果显著，深受广大开发者喜欢。</p>\n<h2 id="关于-calc-函数"><a href="#%E5%85%B3%E4%BA%8E-calc-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 calc() 函数</h2>\n<p>calc() 函数支持加减乘除 4 种运算，任何可以使用 <code class="language-text">&lt;length&gt;</code>、<code class="language-text">&lt;frequency&gt;</code>、<code class="language-text">&lt;angle&gt;</code>、<code class="language-text">&lt;time&gt;</code>、<code class="language-text">&lt;percentage&gt;</code>、<code class="language-text">&lt;number&gt;</code> 或者 <code class="language-text">&lt;integer&gt;</code> 数据类型的地方都可以使用 calc() 函数。但这并不表示上述数据类型都可以出现在 calc() 函数中，该函数是有很多约束的。</p>\n<p>在 calc() 函数中，不能使用当前 CSS 属性不支持的数据类型。例如，下面这些 CSS 声明都是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84366383567307880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nwidth: calc(100% - 10deg);\nwidth: calc(10s / 10);`, `84366383567307880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>10s / 10<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在 calc() 函数中，运算符前后带单位或者带百分号的值只能进行加减运算，不能进行乘除运算，否则是不合法的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58445288523655406000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nwidth: calc(10px * 10px);\nwidth: calc(90% / 1rem);`, `58445288523655406000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>10px * 10px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>90% / 1rem<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在 calc() 函数中，除法运算斜杠右侧必须是不为 0 的数值类型，否则是不合法的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73435807359999300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nwidth: calc(100 / 10px);\nwidth: calc(100px / 0);`, `73435807359999300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100 / 10px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100px / 0<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>关于 calc() 运算符的书写也是有一定的限制的，如加号和减号左右两边一定要有空格，否则是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16378009557594808000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nwidth: calc(100%-2rem);\nwidth: calc(lem+2px);`, `16378009557594808000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100%-2rem<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>lem+2px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>因为浏览器无法区分 −2rem 和 +2px 是表示正负还是表示计算。乘法和除法符号两侧无须空格，但是为了格式一致、便于阅读，建议也要设置空格。calc() 函数在过去很长一段时间的发展中都处于一种很平和的状态，主要是以一种非常硬朗的方式实现各种自适应布局效果。例如，替换元素的宽度自适应：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1813941647883377000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`button {\n   width: calc(100% - 20px);\n}`, `1813941647883377000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 20px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>又如，根据设备屏幕设定根字号大小：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50723854963321920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font-size: calc(16px + 2 * (100vw - 375px) / 39);\n}`, `50723854963321920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>16px + 2 * <span class="token punctuation">(</span>100vw - 375px<span class="token punctuation">)</span> / 39<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>再如，让等比例的列表尺寸之和可以 100% 匹配容器尺寸，如果写成 width: 16.67%，则 6 个列表尺寸之和可能会超过容器尺寸，如果写成 width: 16.66%，则 6 个列表尺寸之和可能会小于容器尺寸 1 ～ 2 像素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93595332847039460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.list {\n   width: calc(100% / 6);\n}`, `93595332847039460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.list</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% / 6<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在数年前，calc() 函数突然大量地出现在 CSS 代码中，原因就是 CSS 变量出现了。</p>\n<p>我们只需要定义一个 CSS 自定义属性，让其他 CSS 样式全部基于这个自定义属性构建，然后我们只需要通过 JavaScript 代码重置这个唯一的 CSS 自定义属性值，整个网页的样式效果就会神奇地跟着变化，大大降低了实现成本和日后的维护成本。而基于 CSS 自定义属性构建其他 CSS 样式必须依赖 calc() 函数，这就导致 calc() 函数迎来了爆发式的发展。</p>\n<p>举个自定义进度条效果例子，以前我们需要先使用双层 HTML 标签模拟出进度条的样式，然后使用 JavaScript 代码实时改变内层 DOM 元素的宽度，这很麻烦。但是现在有了 CSS 自定义属性和 calc() 函数，就可以很方便地实现这个效果，HTML 代码和 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75278971616760770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<label>图片 1：</label>\n<div class=&quot;bar&quot; style=&quot;--percent: 60;&quot;></div>\n<label>图片 2：</label>\n<div class=&quot;bar&quot; style=&quot;--percent: 40;&quot;></div>\n<label>图片 3：</label>\n<div class=&quot;bar&quot; style=&quot;--percent: 20;&quot;></div>\n<style>\n   .bar {\n      line-height: 20px;\n      background-color: #eee;\n   }\n\n   .bar::before {\n      counter-reset: progress var(--percent);\n      content: counter(progress) \'%\\2002\';\n      display: block;\n      width: calc(100% * var(--percent) / 100);\n      color: #fff;\n      background-color: deepskyblue;\n      text-align: right;\n   }\n</style>`, `75278971616760770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>图片 1：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--percent</span><span class="token punctuation">:</span> 60<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>图片 2：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--percent</span><span class="token punctuation">:</span> 40<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>图片 3：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--percent</span><span class="token punctuation">:</span> 20<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.bar</span> <span class="token punctuation">{</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.bar::before</span> <span class="token punctuation">{</span>\n      <span class="token property">counter-reset</span><span class="token punctuation">:</span> progress <span class="token function">var</span><span class="token punctuation">(</span>--percent<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token function">counter</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span> <span class="token string">\'%\\2002\'</span><span class="token punctuation">;</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% * <span class="token function">var</span><span class="token punctuation">(</span>--percent<span class="token punctuation">)</span> / 100<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n      <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>加载的进度数值和加载的进度条宽度全部由 —percent 这个 CSS 自定义属性控制，最终的效果如图 4-62 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-12-23-54-28-6badda8487d45b47299fdc277222aa92-46120.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.49828178694158%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABTklEQVQoz52QzUoCURTH78qInqAHaRMtWiZCJT1Dy2pXi54hoicI2vYCtsuyohDNO1/OOKPjF6XpnU/zNnPnnhwrsMggf/w5nxw45yB8d9syKqFnw/9B25iuFVka87QAk9oUYEuAAx32K7zjeAPPc71v+L6PduqQkmBdhBT+qQ0Bdiuwp/HutGFS1cJuG16dWdY+yxuncufcdC8IZPqxLi24tsGjYRCEQfhpfwUtYUjkYCEHc1lIZGH+ClYKsJznStf2bYtYU3EcB2lkIJGh7jNzCNUv1YYQsOhvOOcI3z+Yhk56/VluXi3yxRtIliD5yAvPjm+TPpm6LZlouK6Ljlpw2ICTJzhuw0sQAQsZi3gUMRa/ZOTjJPrIg3HMxoZRShGjA6KXaa/z5liqolRrpigpGEuGUTPrTVXTS1gcVWRFrTeacSyXBVGSy+po+B3MaFXrniPl5AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 12 23 54 28" title="" data-src="/static/2022-02-12-23-54-28-6badda8487d45b47299fdc277222aa92-fee1c.png" data-srcset="/static/2022-02-12-23-54-28-6badda8487d45b47299fdc277222aa92-a67b7.png 200w,\n/static/2022-02-12-23-54-28-6badda8487d45b47299fdc277222aa92-0b187.png 400w,\n/static/2022-02-12-23-54-28-6badda8487d45b47299fdc277222aa92-fee1c.png 800w,\n/static/2022-02-12-23-54-28-6badda8487d45b47299fdc277222aa92-46120.png 1164w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/21fbmy?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>类似的案例非常多。随着陈旧设备的迅速淘汰，calc() 函数一定会铺天盖地袭来，大家准备好迎接 calc() 函数的暴风雨吧。</p>\n<p>最后，在现代浏览器中，还支持 calc() 函数嵌套使用，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73043848420022740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.list {\n   --size: calc(100% - 2rem);\n   width: calc(var(--size) / 6);\n}`, `73043848420022740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.list</span> <span class="token punctuation">{</span>\n   <span class="token property">--size</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 2rem<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--size<span class="token punctuation">)</span> / 6<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12379731683498330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.list {\n   width: calc(calc(100% - 2rem) / 6);\n}`, `12379731683498330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.list</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>100% - 2rem<span class="token punctuation">)</span> / 6<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h2 id="了解-min、max-和-clamp-函数"><a href="#%E4%BA%86%E8%A7%A3-min%E3%80%81max-%E5%92%8C-clamp-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 min()、max() 和 clamp() 函数</h2>\n<p>min()、max() 和 clamp() 这 3 个函数是现代浏览器从 2018 年底开始支持的，理论上还不是可以放心使用的 CSS 特性。但是由于这几个函数太实用了，因此我建议大家尽量使用。至于那些陈旧的不支持的浏览器，直接使用固定值兜底，保证样式不乱即可。例如：</p>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67532232086656730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font-size: 16px;\n   font-size: clamp(16px, calc(16px + 2 * (100vw - 375px) / 39), 20px);\n}`, `67532232086656730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>16px<span class="token punctuation">,</span> <span class="token function">calc</span><span class="token punctuation">(</span>16px + 2 * <span class="token punctuation">(</span>100vw - 375px<span class="token punctuation">)</span> / 39<span class="token punctuation">)</span><span class="token punctuation">,</span> 20px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果浏览器支持，则根字体大小随着浏览器宽度不同在 16px ～ 20px 弹性变化，如果浏览器不支持，则依然使用浏览器默认的根字体大小 16px。</p>\n<h3 id="语法"><a href="#%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>语法</h3>\n<p>和 calc() 函数类似，任何可以使用 <code class="language-text">&lt;length&gt;</code>、<code class="language-text">&lt;frequency&gt;</code>、<code class="language-text">&lt;angle&gt;</code>、<code class="language-text">&lt;time&gt;</code>、<code class="language-text">&lt;percentage&gt;</code>、<code class="language-text">&lt;number&gt;</code> 或者 <code class="language-text">&lt;integer&gt;</code> 数据类型的地方都可以使用 min()、max() 和 clamp() 这 3 个函数。</p>\n<p>min()、max() 和 clamp() 这 3 个函数与 calc() 函数是可以相互嵌套使用的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53741063440691910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`width: calc(min(800px, 100vw) / 6);`, `53741063440691910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span>800px<span class="token punctuation">,</span> 100vw<span class="token punctuation">)</span> / 6<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>下面具体介绍一下 min()、max() 和 clamp() 这 3 个函数。</p>\n<h3 id="min-函数"><a href="#min-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>min() 函数</h3>\n<p>min() 函数语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3132352984213482500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`min(expression [,expression])`, `3132352984213482500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">min</span><span class="token punctuation">(</span>expression [<span class="token punctuation">,</span>expression]<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>min() 函数支持一个或多个表达式，每个表达式之间使用逗号分隔，然后将最小的表达式的值作为返回值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5332773489161346000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`width: min(10vw, 5em, 80px);`, `5332773489161346000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span>10vw<span class="token punctuation">,</span> 5em<span class="token punctuation">,</span> 80px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中出现了 2 个相对长度值，1 个固定长度值，因此上面的 width 计算值最大就是 80px。至于真实的宽度值，如果浏览器视口宽度小于 800px，或文字字号小于 16px，真实宽度值则会更小。也就是说，虽然函数的名称是 min()，表示最小，但实际上这个函数是用来限制最大值的。</p>\n<p>min() 函数的表达式可以是数学表达式（使用算术运算符）、具体的值或其他表达式（如 attr() 新语法）。因此，下面这些 CSS 声明都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58186835975488000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nwidth: min(10px * 10, 10em);\nwidth: min(calc(10px * 10), 10em);\nwidth: min(10px * 10, var(--width));`, `58186835975488000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span>10px * 10<span class="token punctuation">,</span> 10em<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>10px * 10<span class="token punctuation">)</span><span class="token punctuation">,</span> 10em<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span>10px * 10<span class="token punctuation">,</span> <span class="token function">var</span><span class="token punctuation">(</span>--width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果我们希望网页在桌面端浏览器中的宽度为 1024px，在移动端的宽度为 100%，过去是这么实现的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23886791937783290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.constr {\n   width: 1024px;\n   max-width: 100%;\n}`, `23886791937783290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.constr</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 1024px<span class="token punctuation">;</span>\n   <span class="token property">max-width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有了 min() 函数，我们只需要一句 CSS 声明就可以实现这个效果了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15676277774196734000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.constr {\n   width: min(1024px, 100%);\n}`, `15676277774196734000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.constr</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span>1024px<span class="token punctuation">,</span> 100%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="max-函数"><a href="#max-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>max() 函数</h3>\n<p>max() 函数和 min() 函数语法类似，区别在于 max() 函数返回的是最大值，min() 函数返回的是最小值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85197506142321950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`width: max(10vw, 5em, 80px);`, `85197506142321950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">max</span><span class="token punctuation">(</span>10vw<span class="token punctuation">,</span> 5em<span class="token punctuation">,</span> 80px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示最小宽度是 80px，如果浏览器视口宽度大于 800px，或者文字字号大于 16px，则最终的宽度值会更大。也就是说，虽然 max() 函数从名称上看表示最大，但是其实际作用是限制最小值。max() 函数其他特性都和 min() 函数类似，在此不赘述。</p>\n<h3 id="clamp-函数"><a href="#clamp-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>clamp() 函数</h3>\n<p>clamp() 函数的作用是返回一个区间范围的值，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35417674849905280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`clamp(MIN, VAL, MAX);`, `35417674849905280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">clamp</span><span class="token punctuation">(</span>MIN<span class="token punctuation">,</span> VAL<span class="token punctuation">,</span> MAX<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，MIN 表示最小值，VAL 表示首选值，MAX 表示最大值。这段语句的意思是：如果 VAL 在 MIN ～ MAX 范围内，则使用 VAL 作为函数返回值；如果 VAL 大于 MAX，则使用 MAX 作为返回值；如果 VAL 小于 MIN，则使用 MIN 作为返回值。clamp(MIN, VAL, MAX) 实际上等同于 max(MIN, min(VAL, MAX))。</p>\n<p>我们通过一个例子看一下效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8958930744446469000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<button>我的宽度是？</button>\n<style>\n   button {\n      width: clamp(200px, 50vw, 600px);\n   }\n</style>`, `8958930744446469000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>我的宽度是？<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">button</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>200px<span class="token punctuation">,</span> 50vw<span class="token punctuation">,</span> 600px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果我们不断改变浏览器视口的宽度，可以看到按钮的宽度在 200px ～ 600px 范围内变化。</p>\n<p>例如，在浏览器视口很宽的时候，按钮宽度是 600px，如图 4-63 所示。随着浏览器视口宽度不断变小，小到宽度为 646px 的时候，按钮宽度变成了 323px，如图 4-64 所示。随着浏览器视口宽度进一步变小，按钮宽度维持在 200px 并不再变小，如图 4-65 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-13-00-26-19-7bf11c0e6c7605483244b8ae46bca535-822e9.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 93.55961705831159%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAACAElEQVQ4y42SW2/aQBCF/f9/RJWGtm+tlIpWAdISqagVAcwl2BgnNiTEa3zF67uNAznBTQQ2anMe5mF1RrPznWH8kjzPC8LQtqzpRBiORvZqFYYhHstO5rGkzWaDqmuaJEmGoeuGkSRp/lgQsy0p9yVJgoFxHEdRtM6y7TExhTZUy7JvJdmhVFHU6/GEF8SbWwkfONK8LgkzMTBN02gnzEeN46TsZCilBVroFEWx2WxcXjar1Wq91tA0Hf0FZq7rMuGhgiDAZFTqOtSlYG6aJsbmCAoq7PxcgXcmz0Xxhue4xUJJ44gQgp2Rw7+A5XI9zzRMQzdUQhyHrtPUcVbY7j+0IWBQVS3/lUKWiwdF0w3X9XTTxMqviRxvzrJMJcuVQ4HnfqEohBgm1rYUovpBUGwuY4hTRIWE/CiMcCJB4Hu+hwekEAaHwLBMfka7MGPfpdWzs89fvv74flE5fX9S+VQ5PXn34aM0m0cvtr9O3LZtI44XmeCk8dy41+sL3HTQ7191u4PhsMv21aW2S8209sTsX/z2Ddr3HwCjtq0S9YEoPM/LkixOBUEU8b6yrfndva7roIg4jtDebLLrXqfV+nXFsj8vGufn9Uaj9q1WT9L1fCaz7GA0ZP+0O7i7V+bM9s2Cv3BjxWaccbvdkWd3INT63caobm8w5ibd3jOzQs5PXj41WgqUAaYAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 13 00 26 19" title="" data-src="/static/2022-02-13-00-26-19-7bf11c0e6c7605483244b8ae46bca535-fee1c.png" data-srcset="/static/2022-02-13-00-26-19-7bf11c0e6c7605483244b8ae46bca535-a67b7.png 200w,\n/static/2022-02-13-00-26-19-7bf11c0e6c7605483244b8ae46bca535-0b187.png 400w,\n/static/2022-02-13-00-26-19-7bf11c0e6c7605483244b8ae46bca535-fee1c.png 800w,\n/static/2022-02-13-00-26-19-7bf11c0e6c7605483244b8ae46bca535-822e9.png 1149w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/etuxjf?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>在弹性布局中（宽度自适应布局中），min()、max() 和 clamp() 函数可以帮助我们简化很多 CSS 代码，用过的开发者都说好用，有机会大家一定要在项目中试一试。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/CSS新世界更细致的样式表现/index.md absPath of file >>> MarkdownRemark",timeToRead:49,frontmatter:{date:"2022-01-19 11:12:44",path:"/css-new-world-detailed-style-performance/",tags:"前端, CSS, CSS新世界, 读书笔记",title:"CSS新世界更细致的样式表现",draft:null}}],length:75,tag:"读书笔记",pagesSum:15,page:5}}}});