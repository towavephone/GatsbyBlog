webpackJsonp([0xcef36a61ced9],{1339:function(a,n){a.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"图片服务器需要配置 Access-Control-Allow-Origin 一般团队都会有一个专门域名放置静态资源，例如腾讯是 gtimg.com，百度是 bdimg.com；或者很多团队使用的是腾讯云或者阿里云的服务。 而主页面所在域名往往不一样，当需要需要对 canvas 图片进行 getImageData()或 toDataURL()操作的时候，跨域问题就出来了，而且跨域问题还不止一层。 首先，第一步，图片服务器需要配置 Access-Control-Allow-Origin…",html:'<h1 id="图片服务器需要配置-access-control-allow-origin"><a href="#%E5%9B%BE%E7%89%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE-access-control-allow-origin" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图片服务器需要配置 Access-Control-Allow-Origin</h1>\n<p>一般团队都会有一个专门域名放置静态资源，例如腾讯是 gtimg.com，百度是 bdimg.com；或者很多团队使用的是腾讯云或者阿里云的服务。</p>\n<p>而主页面所在域名往往不一样，当需要需要对 canvas 图片进行 getImageData()或 toDataURL()操作的时候，跨域问题就出来了，而且跨域问题还不止一层。</p>\n<p>首先，第一步，图片服务器需要配置 Access-Control-Allow-Origin 信息，例如：</p>\n<p>如 PHP 添加响应头信息，*通配符表示允许任意域名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46231646300695495000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header(&quot;Access-Control-Allow-Origin: *&quot;);`, `46231646300695495000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="php"\n              >\n                <span class="gatsby-code-button-language">php</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Access-Control-Allow-Origin: *"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或者指定域名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21981051282476870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header(&quot;Access-Control-Allow-Origin: 你的网站域名&quot;);`, `21981051282476870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="php"\n              >\n                <span class="gatsby-code-button-language">php</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Access-Control-Allow-Origin: 你的网站域名"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时，Chrome 浏览器就不会有 Access-Control-Allow-Origin 相关的错误信息了，但是，还会有其他的跨域错误信息。</p>\n<h1 id="canvas-图片-getimagedata-cross-origin-跨域问题"><a href="#canvas-%E5%9B%BE%E7%89%87-getimagedata-cross-origin-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 图片 getImageData cross-origin 跨域问题</h1>\n<p>对于跨域的图片，只要能够在网页中正常显示出来，就可以使用 canvas 的 drawImage() API 绘制出来。但是如果你想更进一步，通过 getImageData()方法获取图片的完整的像素信息，则多半会出错。</p>\n<p>举例来说，使用下面代码获取 github 上的自己头像图片信息：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91013931634367370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var canvas = document.createElement(\'canvas\');\nvar context = canvas.getContext(\'2d\');\n\nvar img = new Image();\nimg.onload = function() {\n  context.drawImage(this, 0, 0);\n  context.getImageData(0, 0, this.width, this.height);\n};\nimg.src = \'https://avatars3.githubusercontent.com/u/496048?s=120&v=4\';`, `91013931634367370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'https://avatars3.githubusercontent.com/u/496048?s=120&amp;v=4\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果在 Chrome 浏览器下显示如下错误：</p>\n<blockquote>\n<p>Uncaught DOMException: Failed to execute ‘getImageData’ on ‘CanvasRenderingContext2D’: The canvas has been tainted by cross-origin data.</p>\n</blockquote>\n<p>Firefox 浏览器错误为：</p>\n<blockquote>\n<p>SecurityError: The operation is insecure.</p>\n</blockquote>\n<p>如果使用的是 canvas.toDataURL()方法，则会报：</p>\n<blockquote>\n<p>Failed to execute ‘toDataURL’ on 　’HTMLCanvasElement’: Tainted canvased may not be exported</p>\n</blockquote>\n<p>原因其实都是一样的，跨域导致。</p>\n<p>那有没有什么办法可以解决这个问题呢？</p>\n<p>可以试试 crossOrigin 属性。</p>\n<h1 id="html-crossorigin-属性解决资源跨域问题"><a href="#html-crossorigin-%E5%B1%9E%E6%80%A7%E8%A7%A3%E5%86%B3%E8%B5%84%E6%BA%90%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTML crossOrigin 属性解决资源跨域问题</h1>\n<p>在 HTML5 中，有些元素提供了支持 CORS(Cross-Origin Resource Sharing)（跨域资源共享）的属性，这些元素包括<code class="language-text">&lt;img&gt;</code>，<code class="language-text">&lt;video&gt;</code>，<code class="language-text">&lt;script&gt;</code>等，而提供的属性名就是 crossOrigin 属性。</p>\n<p>因此，上面的跨域问题可以这么处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57028083054452064000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var canvas = document.createElement(\'canvas\');\nvar context = canvas.getContext(\'2d\');\n\nvar img = new Image();\nimg.crossOrigin = \'\';\nimg.onload = function() {\n  context.drawImage(this, 0, 0);\n  context.getImageData(0, 0, this.width, this.height);\n};\nimg.src = \'https://avatars3.githubusercontent.com/u/496048?s=120&v=4\';`, `57028083054452064000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'https://avatars3.githubusercontent.com/u/496048?s=120&amp;v=4\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>增加一个 img.crossOrigin = ”即可，虽然 JS 代码这里设置的是空字符串，实际上起作用的属性值是 anonymous。</p>\n<p>crossOrigin 可以有下面两个值：</p>\n<ul>\n<li>anonymous：元素的跨域资源请求不需要凭证标志设置。</li>\n<li>use-credentials：元素的跨域资源请求需要凭证标志设置，意味着该请求需要提供凭证。</li>\n</ul>\n<p>其中，只要 crossOrigin 的属性值不是 use-credentials，全部都会解析为 anonymous，包括空字符串，包括类似’abc’这样的字符。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25225240428799676000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img.crossOrigin = \'abc\';\nconsole.log(img.crossOrigin); // 结果是\'anonymous\'`, `25225240428799676000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">\'abc\'</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>crossOrigin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结果是\'anonymous\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-0bf37.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 269px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.12267657992565%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRklEQVQoz4VS24rCMBTs//+OeEGhUPTNF8FtLUitG2ua9KLWNml6SbvTyrILi+wQwuQkc2Y4xMiy7PF4NE1TlmVVVc0ftG0rikIphVu8qesaFdRBjOOIvu8JIbfbDaTrun4ESKs1SJKmQog8z33fj+MYdXThnBtDB6VkUaAtdlWW8JFSCinrqmrHSBpuY4SXIQgeMMYMhMmV+vC88H4PksSjNIhj/3w+HA6yeOpaleQiCMmfTyj1GARACw5xD8Ptlq5Wl8XiMp9nm81pNiO+bztOEASMcUQ9fw7Y7/eUUphBjH0UH4+FZTHXTR0n3O1Sz6tMU1+vsEC8/hv6F37E3ekkJpNovY5MM1wuI8uqp9M+SV4T699giI2BlUIUhHDbZrYdu25k2xK2Wg/zeQPcYtosDA0ahlfGrpzTKMICGY7/AePAB/kCMM34H+DOrC8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 20 51 41" title="" data-src="/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-0bf37.png" data-srcset="/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-b37f7.png 200w,\n/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-0bf37.png 269w" data-sizes="(max-width: 269px) 100vw, 269px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>另外还有一点需要注意，那就是虽然没有 crossOrigin 属性，和设置 crossOrigin=“use-credentials”在默认情况下都会报跨域出错，但是性质上却不一样，两者有较大区别。</p>\n<h2 id="crossorigin-兼容性"><a href="#crossorigin-%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>crossOrigin 兼容性</h2>\n<p>IE11+(IE Edge)，Safari，Chrome，Firefox 浏览器均支持，IE9 和 IE10 会报 SecurityError 安全错误，如下截图：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-0ab45.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 356px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 29.213483146067414%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABBElEQVQY02VN2WrDMBDM/39ZoXlIE9qASxxbkQ/JOlZaWVdst3LpQ6HDsMwMM+zhlTkNM53cY3ICJyJq7eS1e5+93dZ1W5dyn8vyl8u6ppxTSoc6bQ33ElOvY831uWM3gZ9SjJhM2riJyuWvfwghgIaDOZ7OzFcULgTqEQXhgjDbT6btYeBSWoUh5uxTCql8y6GI/FTG7mP6cjo+bEX1W6M+iGpvXXNtuhulFRnuD9IJKl0z2UFiy23NLBWo0I9C6TLW8dlMjoPv5NxyrJi7y9DbOJjIMJewV3OvvTB+UHOxTPs5ZgV2H4NSaMGAtgbQgNupsdgflqTkRfwWStNAgRDCe/8N9W9QOYlOEfoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 20 52 38" title="" data-src="/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-0ab45.png" data-srcset="/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-8eb8a.png 200w,\n/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-0ab45.png 356w" data-sizes="(max-width: 356px) 100vw, 356px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="crossorigin-属性为什么可以解决资源跨域问题？"><a href="#crossorigin-%E5%B1%9E%E6%80%A7%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E8%A7%A3%E5%86%B3%E8%B5%84%E6%BA%90%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>crossOrigin 属性为什么可以解决资源跨域问题？</h1>\n<p>crossOrigin=anonymous 相对于告诉对方服务器，你不需要带任何非匿名信息过来。例如 cookie，因此，当前浏览器肯定是安全的。</p>\n<p>就好比你要去别人家里拿一件衣服，crossOrigin=anonymous 相对于告诉对方，我只要衣服，其他都不要。如果不说，可能对方在衣服里放个窃听器什么的，就不安全了，浏览器就会阻止。</p>\n<h1 id="ie10-浏览器不支持-crossorigin-怎么办？"><a href="#ie10-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8D%E6%94%AF%E6%8C%81-crossorigin-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IE10 浏览器不支持 crossOrigin 怎么办？</h1>\n<p>我们请求图片的时候，不是直接通过 new Image()，而是借助 ajax 和 URL.createObjectURL()方法曲线救国。</p>\n<p>代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20524912602667110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var xhr = new XMLHttpRequest();\nxhr.onload = function() {\n  var url = URL.createObjectURL(this.response);\n  var img = new Image();\n  img.onload = function() {\n    // 此时你就可以使用canvas对img为所欲为了\n    // ... code ...\n    // 图片用完后记得释放内存\n    URL.revokeObjectURL(url);\n  };\n  img.src = url;\n};\nxhr.open(\'GET\', url, true);\nxhr.responseType = \'blob\';\nxhr.send();`, `20524912602667110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 此时你就可以使用canvas对img为所欲为了</span>\n    <span class="token comment">// ... code ...</span>\n    <span class="token comment">// 图片用完后记得释放内存</span>\n    <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  img<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">\'GET\'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">\'blob\'</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此方法不仅 IE10 浏览器 OK，原本支持 crossOrigin 的诸位浏览器也是支持的。</p>\n<p>也就多走一个 ajax 请求，还可以！</p>\n<p>根据，根据实践发现，在 IE 浏览器下，如果请求的图片过大，几千像素那种，图片会加载失败，我猜是超过了 blob 尺寸限制。</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/解决canvas图片getImageData,toDataURL跨域问题/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-12-15 20:32:54",path:"/crossorigin-canvas-getimagedata-cors/",tags:"前端, DOM, DOM知识点",title:"解决canvas图片getImageData,toDataURL跨域问题",draft:null}},{excerpt:"HTML 与文件下载 如果希望在前端侧直接触发某些资源的下载，最方便快捷的方法就是使用 HTML5 原生的 download 属性，例如： 但显然，如果纯粹利用 HTML 属性来实现文件的下载（而不是浏览器打开或浏览），对于动态内容，就无能为力。 例如，我们对页面进行分享的时候，希望分享图片是页面内容的实时截图，此时，这个图片就是动态的，纯 HTML 显然是无法满足我们的需求的，借助 JS 和其它一些 HTML5 特性，例如，将页面元素转换到 canvas…",html:'<h1 id="html-与文件下载"><a href="#html-%E4%B8%8E%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTML 与文件下载</h1>\n<p>如果希望在前端侧直接触发某些资源的下载，最方便快捷的方法就是使用 HTML5 原生的 download 属性，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62921215210958000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot; download>下载</a>`, `62921215210958000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但显然，如果纯粹利用 HTML 属性来实现文件的下载（而不是浏览器打开或浏览），对于动态内容，就无能为力。</p>\n<p>例如，我们对页面进行分享的时候，希望分享图片是页面内容的实时截图，此时，这个图片就是动态的，纯 HTML 显然是无法满足我们的需求的，借助 JS 和其它一些 HTML5 特性，例如，将页面元素转换到 canvas 上，然后再转成图片进行下载。</p>\n<p>但本文要介绍的下载不是图片的下载，而是文本信息的下载，所需要使用的 HTML 特性不是 canvas，而是其它。</p>\n<h1 id="借助-html5-blob-实现文本信息文件下载"><a href="#%E5%80%9F%E5%8A%A9-html5-blob-%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 HTML5 Blob 实现文本信息文件下载</h1>\n<p>原理其实很简单，我们可以将文本或者 JS 字符串信息借助 Blob 转换成二进制，然后，作为<code class="language-text">&lt;a&gt;</code>元素的 href 属性，配合 download 属性，实现下载。</p>\n<p>代码也比较简单，如下示意（兼容 Chrome 和 Firefox）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13617645448879622000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var funDownload = function(content, filename) {\n  // 创建隐藏的可下载链接\n  var eleLink = document.createElement(\'a\');\n  eleLink.download = filename;\n  eleLink.style.display = \'none\';\n  // 字符内容转变成blob地址\n  var blob = new Blob([content]);\n  eleLink.href = URL.createObjectURL(blob);\n  // 触发点击\n  document.body.appendChild(eleLink);\n  eleLink.click();\n  // 然后移除\n  document.body.removeChild(eleLink);\n};`, `13617645448879622000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">funDownload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 创建隐藏的可下载链接</span>\n  <span class="token keyword">var</span> eleLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n  <span class="token comment">// 字符内容转变成blob地址</span>\n  <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发点击</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 然后移除</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，content 指需要下载的文本或字符串内容，filename 指下载到系统中的文件名称。</p>\n<h1 id="借助-base64-实现任意文件下载"><a href="#%E5%80%9F%E5%8A%A9-base64-%E5%AE%9E%E7%8E%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 Base64 实现任意文件下载</h1>\n<p>对于非文本文件，也是可以直接 JS 触发下载的，例如，如果我们想下载一张图片，可以把这张图片转换成 base64 格式，然后下载。</p>\n<p>代码示意：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84820512836148250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var funDownload = function(domImg, filename) {\n  // 创建隐藏的可下载链接\n  var eleLink = document.createElement(\'a\');\n  eleLink.download = filename;\n  eleLink.style.display = \'none\';\n  // 图片转base64地址\n  var canvas = document.createElement(\'canvas\');\n  var context = canvas.getContext(\'2d\');\n  var width = domImg.naturalWidth;\n  var height = domImg.naturalHeight;\n  context.drawImage(domImg, 0, 0);\n  // 如果是PNG图片，则canvas.toDataURL(\'image/png\')\n  eleLink.href = canvas.toDataURL(\'image/jpeg\');\n  // 触发点击，这里为了兼容Firefox加了appendChild方法\n  document.body.appendChild(eleLink);\n  eleLink.click();\n  // 然后移除\n  document.body.removeChild(eleLink);\n};`, `84820512836148250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">funDownload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">domImg<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 创建隐藏的可下载链接</span>\n  <span class="token keyword">var</span> eleLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n  <span class="token comment">// 图片转base64地址</span>\n  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> width <span class="token operator">=</span> domImg<span class="token punctuation">.</span>naturalWidth<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> height <span class="token operator">=</span> domImg<span class="token punctuation">.</span>naturalHeight<span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>domImg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 如果是PNG图片，则canvas.toDataURL(\'image/png\')</span>\n  eleLink<span class="token punctuation">.</span>href <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">\'image/jpeg\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发点击，这里为了兼容Firefox加了appendChild方法</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 然后移除</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>不止是.html 文件，.txt, .json 等只要内容是文本的文件，都是可以利用这种小技巧实现下载的。</p>\n<p>在 Chrome 浏览器下，模拟点击创建的<code class="language-text">&lt;a&gt;</code>元素即使不 append 到页面中，也是可以触发下载的，但是在 Firefox 浏览器中却不行，因此，上面的 funDownload()方法有一个 appendChild 和 removeChild 的处理，就是为了兼容 Firefox 浏览器。</p>\n<p>当然，有时对 canvas 图片进行 toDataURL 操作时，会存在跨域问题的报错，具体见<a href="/crossorigin-canvas-getimagedata-cors/">解决 canvas 图片 getImageData,toDataURL 跨域问题</a></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/JS前端创建html或json文件并浏览器导出下载/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-15 19:55:53",path:"/js-text-string-download-as-html-json-file/",tags:"前端, JS, JS知识点",title:"JS前端创建html或json文件并浏览器导出下载",draft:null}},{excerpt:"简介 首先看下面这种截图： 如果我们想实现点击上面的下载按钮下载一张图片，你会如何实现？ 我们可能会想到一个最简单的方法，就是直接按钮 a 标签链接一张图片，类似下面这样： 但是，想法虽好，实际效果却不是我们想要的，因为浏览器可以直接浏览图片，因此，我们点击下面的“下载”链接，并是不下载图片，而是在新窗口直接浏览图片。 于是，基本上，目前的实现都是放弃 HTML 策略，而是使用，例如 php 这样的后端语言，通过告知浏览器 header…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>首先看下面这种截图：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-38-16-6c0e89e29634e19a5b1beab36a10f310-84da0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 295px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.45762711864407%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABKElEQVQoz4VR2W7CMBDM//9WK/HWlwLhCIoKuYljk4DXx9p0HSPaqpW6mgfv7Mw6niTee/df+bm+M4iotU7i7P6zQk/k7KEjH9jH8UiGx+h+t9ZmWZYgOpwXPEH6uI8QGW0MgH62dFBab3e7RFkUYC8KI4TCQSIHy262v1kBgeTSnEfoRhk1o3b9BOvNNpgHQK7coNxofHZWmxYWObyd4L2UHJzQvmKXVZavDkcmg5KYblIrMmuLV4U37SKmcA8WXDdcsgkmZYmU1tNHE6JGGi+uKiVzeK9zMZ45IUd5KAX7/f71ZdE0bWhBDqzve/ZQUmDG7OjNf6ZtLRZls1ymXXeOu4TgXFz8l8AGM/2usiyLX1XXdds2dV2dTgUJqK2rKo6ozfM8TdefeUYECiqgkp4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 38 16" title="" data-src="/static/2019-12-15-19-38-16-6c0e89e29634e19a5b1beab36a10f310-84da0.png" data-srcset="/static/2019-12-15-19-38-16-6c0e89e29634e19a5b1beab36a10f310-38392.png 200w,\n/static/2019-12-15-19-38-16-6c0e89e29634e19a5b1beab36a10f310-84da0.png 295w" data-sizes="(max-width: 295px) 100vw, 295px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果我们想实现点击上面的下载按钮下载一张图片，你会如何实现？</p>\n<p>我们可能会想到一个最简单的方法，就是直接按钮 a 标签链接一张图片，类似下面这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83260641844059200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot;>下载</a>`, `83260641844059200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但是，想法虽好，实际效果却不是我们想要的，因为浏览器可以直接浏览图片，因此，我们点击下面的“下载”链接，并是不下载图片，而是在新窗口直接浏览图片。</p>\n<p>于是，基本上，目前的实现都是放弃 HTML 策略，而是使用，例如 php 这样的后端语言，通过告知浏览器 header 信息，来实现下载。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78692166798007000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header(\'Content-type: image/jpeg\');\nheader(&quot;Content-Disposition: attachment; filename=\'download.jpg\'&quot;);`, `78692166798007000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">\'Content-type: image/jpeg\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition: attachment; filename=\'download.jpg\'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然而，这种前后端都要操心的方式神烦，现在都流行前后端分离，还搅在一起太累了，感觉不会再爱了。</p>\n<p>那有没有什么只需要前端动动指头就能实现下载的方式呢？有，就是本文要介绍的 download 属性。</p>\n<p>例如，我们希望点击“下载”链接下载图片而不是浏览，直接增加一个 download 属性就可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67158744734087600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot; download>下载</a>`, `67158744734087600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>结果在 Chrome 浏览器下（FireFox 浏览器因为跨域限制无效）：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-ab1e0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 530px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 32.264150943396224%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABLUlEQVQY01WP207CQBCG+/6PYOLxEo2EeIEJQgwixVIIUgklKi1tsd3udntiDy2060biBX++TDKTTGY+pSxLxigvWFHwjeMkOQ0hdBxnaa6yLE+ShFJaVdXhNHKS57nCOcdRBsMMY6LpCw/gEIZzwxiqowAAFEWM8bquq9MIISCECuPc91N7nUJIRtrK2oZB4I91vdt7dt1tmu3KvTxU/1Ed2cumFgghhRCCIJAPRhiq2vgHxpQQEASu6zFK2S6pDkyIUojDP9WxSjslTrOPz02+I3JnMjPWrl9wBhGyLcv2QGNeXuj8clKcq/H1ENyo6GoIz17C1gy7nqcQysIokebS62ttf2+2MY6m02m/PzAWq7vee3OwbGtWo6PfPr42n7T7jtrqvj10VdM0fwFK7kX1KHkfuAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 41 40" title="" data-src="/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-ab1e0.png" data-srcset="/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-8e92d.png 200w,\n/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-d963f.png 400w,\n/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-ab1e0.png 530w" data-sizes="(max-width: 530px) 100vw, 530px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>不仅如此，我们还可以指定下载图片的文件名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27170805440951206000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=\'index_logo.gif\' download=\'_5332_.gif\'>\n  下载\n</a>`, `27170805440951206000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">\'index_logo.gif\'</span> download<span class="token operator">=</span><span class="token string">\'_5332_.gif\'</span><span class="token operator">></span>\n  下载\n<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果后缀名一样，我们还可以缺省，直接文件名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29288706953949008000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=\'index_logo.gif\' download=\'_5332_\'>\n  下载\n</a>`, `29288706953949008000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">\'index_logo.gif\'</span> download<span class="token operator">=</span><span class="token string">\'_5332_\'</span><span class="token operator">></span>\n  下载\n<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-bc7e0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 9.685641461342396%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAARElEQVQI12N4+/bt3du3Lt960L7r8frzrz5++vLu47f3nwijl+8+M7x48eLatWs3bt4+du7a6fNXbt2+9ez5c6LQs+cAwipsAX3IkRAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 48 37" title="" data-src="/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-fee1c.png" data-srcset="/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-a67b7.png 200w,\n/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-0b187.png 400w,\n/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-fee1c.png 800w,\n/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-bc7e0.png 1177w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="浏览器兼容性和跨域策略"><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7%E5%92%8C%E8%B7%A8%E5%9F%9F%E7%AD%96%E7%95%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>浏览器兼容性和跨域策略</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-a76b9.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 559px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.406082289803216%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB7klEQVQoz3WO22/ScBzF++f54MP0YWYPXjbDkkXDlmzCYItQVpGbUXcB4jKnm3POZMjLuKwhgVJ+0HtZR1tgSGdlbWFsgXUPvlkfND5o8nk43+R8zzmQyOS4cpYDaR6kuUpGIFAGpHiQEliUrB0Y37ihLv4PqK9Wta+Mhd5idEsojK4wWpvWFFo9Jfudo18+rfbv5ytDuu7KZle+Pq8Pz0RdpIwm02uyRp02ddk05IHl60lDQxz8FWFpC+j3cXzVqTVbhXjOt1eKvsbfxsD7rlod6LXOMZDxbF+pml3pzwSrzOzJVrNocaZwJIam2f3RvM0B3Pfzj23FGYE9FKncDogvpp1sPXOuWFmWWbr4LpzWCbVBQG2JaBDFPXLrLmqHccSOOXzAN1N0zmEuzm2XJu4hmflblakE2MD2d1pHhR+XJ1qLLB9sUugnSIgGyiM33310jlHT3pLHVVj0Y0sL2FMYh5PL08lnE6HswiTl+rI+X7kzIu9Ghxcnai2fDNhSa7NQYw0Rbt/Y3XY9xJ8EcCRIh2PscpAKRciwuwxPYrNB3O9hgodbsDg+1k5s8lSOrmam8DlvBYbEN0H6wWji85KHCcSIlyE2HOdXw3TkBR15VYkgOLJOr0TEVfQDwj0a51cQGnFhG34H8D4v+X8CMfqQsZZ4QGUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 49 10" title="" data-src="/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-a76b9.png" data-srcset="/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-8c77e.png 200w,\n/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-f1700.png 400w,\n/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-a76b9.png 559w" data-sizes="(max-width: 559px) 100vw, 559px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>然而，caniuse 展示的兼容性不是很准确，主要表现在跨域策略的处理上，由于我手上没有 IE13，所以，只能对比 Chrome 浏览器和 FireFox 浏览器：</p>\n<p>如果需要下载的资源是跨域的，包括跨子域，在 Chrome 浏览器下，使用 download 属性是可以下载的，但是，并不能重置下载的文件的命名；而 FireFox 浏览器下，则 download 属性是无效的，也就是 FireFox 浏览器无论如何都不支持跨域资源的 download 属性下载。</p>\n<p>而如果资源是同域名的，则两个浏览器都是畅通无阻的下载，不会出现下载变浏览的情况。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-6566f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 462px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 77.92207792207792%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACg0lEQVQoz3VS23KbMBD1/39KZtq8us0ktd3G8QUbg7lK4iKwARmQECJ22mmaLk7cyUO6c9AwLGfP2V0N/ITFrNlVKq2PtHnB9R+3fIfDMwBVzyF/pvx3ql7StEzvvtD771mWD8ZrV/OThR1piC3pcULUGHejfwhP4+hpHJ6m8UlLT3r2S/ey1fBG+3Y/XywHrm2tV5rnujSmrRQNr2XDewg4hYpDif02JG0YdGGg4ki0rXr6mYtuqa0GdpwvbbyYP2RF0XWdUqqFtFJSyu7xyPXN10+f1uOxOZ2Gq9XR84DcNiJnVU/ODxWJ4ofpD3NrE0JM0wzDMIqiJEkwIYWPZBw3AEplFLVJIqCqbFhZa0B+7LqExrP5PCAEzLuOu7UswzQNw/A8rxSi6bpGKaHU6ymEaKXcs3oBZNCZz2aglaap7/tA0nUdIcwYk20LbTTvA2o1TdvKtKjny9UA7FmWhTH2fARSZ20XYVxAsIIdDpxzUOMXVHUNNd7I0EOaFb6PgiCY9RZifb0eDodXV1fX159vbu+MjRGQgGCYQACzcBwny/a7g+jJVc0ZK7bQpGliRBiLEEGGsa05r6q6qqpDH2WeF7ZlTSYTKFIeWMr4GxmSYRD4CPXlA4SjGBR2+91uvwfv4FNAr0JQShFClCaC8zfbkCuKHGNk9NqGttTAtu04cMK7bTvgFmj9dqWEOwADU61MLmQuz9G+xvmSyMsLPH0KZg7LPcf5x8u0YZay+Tjge8VFzKqNh8m+yMo6zzNorCwZzcrFaj0oy7rfBP8A0GlW8i2Jh7ejte37SQarHI3GGPmYZg/z5cBwsO0H1n8AqY1LDBzrbmB5BOCg0HKx4QZg4S/lLUz0/hhcVwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 50 48" title="" data-src="/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-6566f.png" data-srcset="/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-c4b43.png 200w,\n/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-5dba5.png 400w,\n/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-6566f.png 462w" data-sizes="(max-width: 462px) 100vw, 462px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="是否支持-download-属性的监测"><a href="#%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81-download-%E5%B1%9E%E6%80%A7%E7%9A%84%E7%9B%91%E6%B5%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>是否支持 download 属性的监测</h2>\n<p>要监测当前浏览器是否支持 download 属性，一行 JS 代码就可以了，如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11263407477873932000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var isSupportDownload = \'download\' in document.createElement(\'a\');`, `11263407477873932000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> isSupportDownload <span class="token operator">=</span> <span class="token string">\'download\'</span> <span class="token keyword">in</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>除了图片资源，我们还可以是 PDF 资源，或者 txt 资源等等。尤其 Chrome 等浏览器可以直接打开 PDF 文件，使得此文件格式需要 download 处理的场景越来越普遍。</p>\n<p>此 HTML 属性虽然非常实用和方便，但是兼容性制约了我们的大规模应用。</p>\n<p>同时考虑到很多时候，需要进行一些下载的统计，纯前端的方式想要保存下载量数据，还是有些吃紧，需要跟开发的同学配合才行，还不如使用传统方法。</p>\n<p>所以，download 属性的未来前景在哪里？当下是否可以直接加入到实际项目？还需要我们一起好好想想。其实使用 JS 实现 download 属性的 polyfill 并不难，但是，考虑到为何不所有浏览器都使用 polyfill 的方法，又觉得为了技术而技术是不太妥当的。</p>\n<p>如果是需要用 JS 触发下载，见下一篇文章<a href="/js-text-string-download-as-html-json-file/">使用 JS 让文本字符串作为 html 或 JSON 文件下载</a></p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/HTML5中的download属性/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-15 19:36:41",path:"/html-download-attribute/",tags:"前端, DOM, DOM知识点",title:"HTML5中的download属性",draft:null}},{excerpt:"简介 innerText IE6 就开始支持，那个时候，Firefox 浏览器是不支持这个 API 的，一直到 2016 年 3 月份 Firefox 45+才开始支持。 而 textContent IE9 浏览器才开始支持： 由于存在兼容性，因此在开发 PC 端项目的时候获取元素的文本内容都是下面的语句： 久而久之，就误认为 innerText 和 textContent 作用是一样的。 innerText 和 textContent 的不同 调用对象不同 innerText 只有 HTML…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>innerText IE6 就开始支持，那个时候，Firefox 浏览器是不支持这个 API 的，一直到 2016 年 3 月份 Firefox 45+才开始支持。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-12-27-8530d3e74f17af3254498f5daa088eb4-87f29.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 602px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.52159468438538%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACMElEQVQozwElAtr9ANvXzdzaz93azuDWxd3Twd7Vw8bTr+zl0PHp1fHo1PLo1fPp1vPp1vHs3/Lu4vHp1/Hn0vHo1PHo1PLo1QDrwofrxIvryJPn383l3Mrn28nd2L/q383w49P36tny5dXu4tLv4tD1zpz1yI/45Mz68Of26df36tn06dYA7suU89Gc8dKh5NzJ6uLO6OfV7enZ0d2/t9Kowtuyv9euvNOtvtSswsR/xMB3xtepxuG+wtqww9qy5eLLANPR093a2dzY1tDJxOPRxdWokd2llYe3ciq1QTKyRDq3TEm8WEK6VT+9XEXAZEG6VjOyQzK0RjCuQ66wkgDM2bjT273V3L7Q4cHOxaiiTi6nRi1sjUU6vlNOu1xJu1k9tk05tUpAt09Mu1lKu1lHulc7t0w5sUnBy6sAT7NZa7xucb1zULRbdL5zZLdqXrVkRLRRRLlUT71dQ7hSOLVJSLtYS7taR7pYSrtaR7pYSLxYQbRPtcOjADerR0SgSkqbTUu0V0WTRi6QNi6WODWePz25Tjy2TDy2TDy2TFbAZGTFb1rCZzm1Sjy2TTy4TTqySkSjTgC1zKO2yKJvsmxftmVsrmlPn1FJnk1FqE0tr0AvrkIwrkIvrkE/tFBMuVpLuFoyr0QvrkEvr0IwqkGUuYoA/Ovd+uvbxd2zuNipxNyztdOmsNChudOppcmZqcqcr8yhpcmZq8udwtGvw9GwwdGup8qbpcqZus6p7+LSACdVg7RT1r8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 12 27" title="" data-src="/static/2019-12-15-19-12-27-8530d3e74f17af3254498f5daa088eb4-87f29.png" data-srcset="/static/2019-12-15-19-12-27-8530d3e74f17af3254498f5daa088eb4-38577.png 200w,\n/static/2019-12-15-19-12-27-8530d3e74f17af3254498f5daa088eb4-26124.png 400w,\n/static/2019-12-15-19-12-27-8530d3e74f17af3254498f5daa088eb4-87f29.png 602w" data-sizes="(max-width: 602px) 100vw, 602px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>而 textContent IE9 浏览器才开始支持：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-12-49-7a72d93a56e728e5ed225a53aa50859e-a484c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 577px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.233968804159446%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACMElEQVQozwElAtr9AObfztjTxdrTxt3WyN3Tw9/Vw9vSweDUxczSstndwPPo1fLo1fPp1vPp1vLq2fLr3PLp2fHn0/Lo1fLo1QDw38Pt063u1rHu1rLr38nr4tDq4M3s4c/l38nm4Mvw59Tx59Tt49Dt5NPw3sHx1q/y4MP17d7y6NXx6NUA8tar8sB58sWF88eH69zA59/P59/N6uPR6eDP6N/M8ujT8ObS5t7M6OHR7tGk8cB28taq+PPr9OrW9OnVAO3k0tzSxOPZyeff0NfQw+bdzOfbxt3QvOvgzN/azdjTxurj0tjQv97WxezgztvNvefayN3Vw9DJuN3SwQDbq5u7UkrCYljZwrbZ1cvd1Mnn18Lk0rzl18Tb1s/f2tHGwbmLh4iQjIzSw7bkzr7jz7+jnJiFgoScl5QAvcugaZ1Mgqlhk8yJcch1i8+HjtGNcsh7k9KQhMyCfct8kcyMXbBoZLNulNCSecx+idCJg8KFVrBkf7+BAJ7Jli6rRkarVEueT0GuUEmhTk2fUEWvUUydTkikT0WqUFGcUUuxVEysVEyaTj2rS0GhSVOhVEq0VVOiVAC7zKd3tHOFsntioF1Xsl9apFlfolxbs2BcoFlbqF1cr19enFparl5Yqlt0o2qGvoF/sXden1tZsl9doFoA9enX9+jY/+zftdioh8qFndGVptSdjcuKpdObm9CUk86OrNahks2Oks6O4eTJ++rc+eraqtWgiMqFpNOaMoh8mzx297EAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 12 49" title="" data-src="/static/2019-12-15-19-12-49-7a72d93a56e728e5ed225a53aa50859e-a484c.png" data-srcset="/static/2019-12-15-19-12-49-7a72d93a56e728e5ed225a53aa50859e-64be4.png 200w,\n/static/2019-12-15-19-12-49-7a72d93a56e728e5ed225a53aa50859e-6870d.png 400w,\n/static/2019-12-15-19-12-49-7a72d93a56e728e5ed225a53aa50859e-a484c.png 577w" data-sizes="(max-width: 577px) 100vw, 577px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由于存在兼容性，因此在开发 PC 端项目的时候获取元素的文本内容都是下面的语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41640825776360520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var text = dom.innerText || dom.textContent;`, `41640825776360520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> text <span class="token operator">=</span> dom<span class="token punctuation">.</span>innerText <span class="token operator">||</span> dom<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>久而久之，就误认为 innerText 和 textContent 作用是一样的。</p>\n<h1 id="innertext-和-textcontent-的不同"><a href="#innertext-%E5%92%8C-textcontent-%E7%9A%84%E4%B8%8D%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>innerText 和 textContent 的不同</h1>\n<h2 id="调用对象不同"><a href="#%E8%B0%83%E7%94%A8%E5%AF%B9%E8%B1%A1%E4%B8%8D%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用对象不同</h2>\n<p>innerText 只有 HTML 元素才可以调用，但是 textContent 任意 Node 节点都可以：HTMLElement.innerText 和 Node.textContent。</p>\n<h2 id="值获取规则不同"><a href="#%E5%80%BC%E8%8E%B7%E5%8F%96%E8%A7%84%E5%88%99%E4%B8%8D%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>值获取规则不同</h2>\n<h3 id="规则差异之块级元素与换行符"><a href="#%E8%A7%84%E5%88%99%E5%B7%AE%E5%BC%82%E4%B9%8B%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E4%B8%8E%E6%8D%A2%E8%A1%8C%E7%AC%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规则差异之块级元素与换行符</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50266780532708370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<p id=&quot;dom&quot;>一段文字内容<span style=&quot;position:absolute;&quot;>...</span></p>`, `50266780532708370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>一段文字内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>实时效果如下：</p>\n<p>一段文字内容…</p>\n<p>可以看到设置了 position:absolute 的<code class="language-text">&lt;span&gt;</code>元素里面的点点点…和前面的文字内容是紧密连接在一起的，前后没有任何空格。</p>\n<p>但是，当我们分别获取 id=“dom”的<code class="language-text">&lt;p&gt;</code>元素的 innerText 和 textContent 值的时候，有意思的事情发生了，innerText 的返回值居然在点点点前面出现了一个空格。</p>\n<p>如下截图所示：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-14-52-ba966b28a7aec66dd331bccad4059f72-acb24.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 399px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 44.3609022556391%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABJUlEQVQoz41QXY+CMBD0//8lHyQ57hVFLybeXbTSAkX5EBBot7S9tcScPpg42bbbyc5OtzOt9SAUwAjqHvAqFEg8NS6ldN8PM3MTj+OITbRSmCh3QdpM0Pcw1hoAUxTa3pDn+Qx5UKaqqsN+HzNGyKFpavsKnmezzLi0KAoUGyHHQYimbdq2uVwuyJ5Op7quAUBK2SGu11YIyZidz1HmHuHEmPcDYPXvz/dqtcTw/c+Ft9hut+fzOcuyJEk455TS0j14muXfeZAjGnKepkmCXbB6t9sdj8eyLNEVdxwKJ7x2nXWyZ7FQKefrMPzabJarZRAEH76/XodpmqIGbSf/oizNgxibuplBG2PfxyS+/Xbfd4RElDL6gChChjL2RE7MhDiOCSF/5zn92+R9zPQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 14 52" title="" data-src="/static/2019-12-15-19-14-52-ba966b28a7aec66dd331bccad4059f72-acb24.png" data-srcset="/static/2019-12-15-19-14-52-ba966b28a7aec66dd331bccad4059f72-ff279.png 200w,\n/static/2019-12-15-19-14-52-ba966b28a7aec66dd331bccad4059f72-acb24.png 399w" data-sizes="(max-width: 399px) 100vw, 399px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="差异的原因"><a href="#%E5%B7%AE%E5%BC%82%E7%9A%84%E5%8E%9F%E5%9B%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>差异的原因</h4>\n<p>实际上是 innerText 会保留块级元素的换行特性，以换行符形式呈现。在 HTML 中，如果 white-space 不是 pre 或 pre-wrap 则会表现为空格。也就是下图中的空格实际上是换行符：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-15-46-ba966b28a7aec66dd331bccad4059f72-acb24.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 399px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 44.3609022556391%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABJUlEQVQoz41QXY+CMBD0//8lHyQ57hVFLybeXbTSAkX5EBBot7S9tcScPpg42bbbyc5OtzOt9SAUwAjqHvAqFEg8NS6ldN8PM3MTj+OITbRSmCh3QdpM0Pcw1hoAUxTa3pDn+Qx5UKaqqsN+HzNGyKFpavsKnmezzLi0KAoUGyHHQYimbdq2uVwuyJ5Op7quAUBK2SGu11YIyZidz1HmHuHEmPcDYPXvz/dqtcTw/c+Ft9hut+fzOcuyJEk455TS0j14muXfeZAjGnKepkmCXbB6t9sdj8eyLNEVdxwKJ7x2nXWyZ7FQKefrMPzabJarZRAEH76/XodpmqIGbSf/oizNgxibuplBG2PfxyS+/Xbfd4RElDL6gChChjL2RE7MhDiOCSF/5zn92+R9zPQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 15 46" title="" data-src="/static/2019-12-15-19-15-46-ba966b28a7aec66dd331bccad4059f72-acb24.png" data-srcset="/static/2019-12-15-19-15-46-ba966b28a7aec66dd331bccad4059f72-ff279.png 200w,\n/static/2019-12-15-19-15-46-ba966b28a7aec66dd331bccad4059f72-acb24.png 399w" data-sizes="(max-width: 399px) 100vw, 399px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>例如，我们设置呈现结果的父元素 white-space:pre，则会出现下图所示的效果：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-16-09-b1ddcd110b440fc1314148a20ac99f28-a3cb3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 336px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.976190476190474%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABcElEQVQoz42Re2+CMBTF/f7fxUSjM3EmTo3+wRBj5OELMW4+kIBIkVdp6S5lOueWbL+Qm7Y3p+dcWiKEpIQwxjIO49C/wBhHUVRKCY3iFOMENkmS1ziOb3f9BJTQRQgZhlEihCY42223i8VitVrpuq4oSkrSW4oHinPf97mYZlGSZ8c4TaFgDM5hGAZBUGSBHgiKHlTCZ/wUw0UnF1nWcarKg1dREAbd3qBaq5crFUEUD8ejZdvGZjPnzGYzVVW/xJRmlzBByHNPjr15OyPPORxsy3JM82xZZ8fxHSf1PArjccD8W+w4gQYP0+/7jQbTNNZssuGQCULWajFJCsZjd7m8f5Grc8bQJTqd7KW+nK/XUq363n7xymWn3XY7HVSvh5OJKcuH8TgXQ84HsYeC/X43GkkaDKRp0nNLbDbFRmP49CR3u/Neby9JcRD89rcJxKbs39zE8K4lsFIUKIVrjgr766cpcMwXd0yn0wnMYpof72hiO1sGPTgAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 16 09" title="" data-src="/static/2019-12-15-19-16-09-b1ddcd110b440fc1314148a20ac99f28-a3cb3.png" data-srcset="/static/2019-12-15-19-16-09-b1ddcd110b440fc1314148a20ac99f28-d9b8e.png 200w,\n/static/2019-12-15-19-16-09-b1ddcd110b440fc1314148a20ac99f28-a3cb3.png 336w" data-sizes="(max-width: 336px) 100vw, 336px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在本例中，虽然<code class="language-text">&lt;span&gt;</code>元素是内联元素，但由于设置了 position:absolute 使其 display 计算值变成了 block，因此，虽然视觉上没有换行，但 innerText 获取的时候依旧产生了换行，导致空格出现。</p>\n<h3 id="规则差异之隐藏元素的获取与否"><a href="#%E8%A7%84%E5%88%99%E5%B7%AE%E5%BC%82%E4%B9%8B%E9%9A%90%E8%97%8F%E5%85%83%E7%B4%A0%E7%9A%84%E8%8E%B7%E5%8F%96%E4%B8%8E%E5%90%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规则差异之隐藏元素的获取与否</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2364755378568439300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<p id=&quot;dom2&quot;>我后面有一段隐藏文字<span hidden>，就是我啦！</span></p>`, `2364755378568439300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dom2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>我后面有一段隐藏文字<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">hidden</span><span class="token punctuation">></span></span>，就是我啦！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-17-21-f2c132f0cba56e8de576d556ae8928ec-1857e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 448px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.839285714285715%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABGUlEQVQY04WQXW+CMBiF+///jn+AC2+8kA0/gHZQ+oGAFdeKQKsIrHMLMbpkT940J2ne03MKuq4fX+hfud0e52pMXddAm6tSci9E0zRKKSFEVVVd11mLYRh+vCYx0WrNOAdNayilhJDz+ZxlGULI7htjnsNU1ViWv3M8as45Y6DV15OSlNEYR4Hvu64LIZRSWjsr8jw/HA5+GPLZ7OT7Y1EMWTYKoedzjpBdvpSlIMQ+T+M4DsPQiuOdoihsEZso3+/lcnlBqMNYQ9gnSeu6PElA3WhKk7d3b73ZrFYrx3EWiwVjDGMcBEGaptbC87wPjD+lxISst9sYY6lUutuB2x+f/T9af7cGEFrTeCKKokc9MV3ZE9/b2VBfiXm7LFKsQ8gAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 17 21" title="" data-src="/static/2019-12-15-19-17-21-f2c132f0cba56e8de576d556ae8928ec-1857e.png" data-srcset="/static/2019-12-15-19-17-21-f2c132f0cba56e8de576d556ae8928ec-15195.png 200w,\n/static/2019-12-15-19-17-21-f2c132f0cba56e8de576d556ae8928ec-82e6d.png 400w,\n/static/2019-12-15-19-17-21-f2c132f0cba56e8de576d556ae8928ec-1857e.png 448w" data-sizes="(max-width: 448px) 100vw, 448px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>可以看到，display:none 元素是无法使用 innerText 获取的，但是 textContent 却可以，无论元素隐藏与否。</p>\n<h3 id="规则差异之性能与回流"><a href="#%E8%A7%84%E5%88%99%E5%B7%AE%E5%BC%82%E4%B9%8B%E6%80%A7%E8%83%BD%E4%B8%8E%E5%9B%9E%E6%B5%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规则差异之性能与回流</h3>\n<p>此外，由于 innerText 属性值的获取会考虑 CSS 样式，因此读取 innerText 的值将触发回流以确保计算出的样式是最新的，而回流在计算上很昂贵，会降低性能，因此应尽可能避免回流。而 textContent 只是单纯读取文本内容，因此性能更高。</p>\n<h3 id="ie-浏览器不符合上面规则"><a href="#ie-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8D%E7%AC%A6%E5%90%88%E4%B8%8A%E9%9D%A2%E8%A7%84%E5%88%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IE 浏览器不符合上面规则</h3>\n<p>但是在 IE 浏览器下，innerText 的表现和规范是不符的，最终表现为 textContent 属性一样的效果，也就是没有空格，也不会不显示隐藏元素，例如下面 IE11 下的效果截图：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-19-22-ed6cd04142f32b39f7f0e8f244966457-0208c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 493px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 74.2393509127789%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB50lEQVQoz4VSXXObMBD0//8zeWgf81g/xU0wBheoqcEIBMISID7MN11MJrHbZHKjuVlO7N1qpVVWtCQuHZp4LKe8+niJC00bKrt5LSDraCxXRdWGvPq51W2XZmUvZM2zWtwu2XBepH+8zLAz3crsE3Jie0cSrcZhaFusrm3bpmn6vh+uMS4BME29lLWqNo+PzcNDrSjd92/p+ofP2Ar7/TDJPD+fz5TSPM+naQJruo1xlFHEfV9QKoIAoOA8SVOQx6btGWOEeK7jGoax2+0I8YUQaZpyztG067r7VnNr7K4A67b3PGIav3R9v73G8XgMwxAqpJT4CScabwKHeiVfJw+Oc9wqW03TFOVlvV6rOw1kzIyiCABefDx5JncD5yKMwogx/Or78IJhbH2Ny+UCFz8lt/04/OPQf7EQ3pS/nxmGEd/HOWEPIQQAgr9s9C6bsRhqIds9ubZtn88csquqKssSbpXXgOfIRVGgcuc2Jv+2LE3XX56fN09PjuO4rns6nSAEhqNdEARoh4wtVEBOkuTVbVysaZqHwwFZVVUAOAeroR/zgXHtcA45jmNU7q7K87z9fg+mrmmbzca0LMzEgwMNc6ACjSAYn6gvr3CejJIfUPQTfA70RhVgrgixgLcKhCwAdwmP/gJk0kn2mN5dTgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 19 22" title="" data-src="/static/2019-12-15-19-19-22-ed6cd04142f32b39f7f0e8f244966457-0208c.png" data-srcset="/static/2019-12-15-19-19-22-ed6cd04142f32b39f7f0e8f244966457-1777c.png 200w,\n/static/2019-12-15-19-19-22-ed6cd04142f32b39f7f0e8f244966457-1db89.png 400w,\n/static/2019-12-15-19-19-22-ed6cd04142f32b39f7f0e8f244966457-0208c.png 493w" data-sizes="(max-width: 493px) 100vw, 493px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>另外，与 textContent 不同，在 Internet Explorer（版本 11 及以下）中更改 innerText 将从元素中移除子节点，并永久销毁所有子文本节点。不可能再将节点插入任何其他元素或同一元素中。</p>\n<h1 id="结论"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结论</h1>\n<p>innerText 由于存在诸多特别的特性、以及兼容性差异，以及性能方面问题，以及实际开发的需求的考量，不推荐使用，推荐使用 textContent 获取文本内容。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81319089938217860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var text = dom.textContent;`, `81319089938217860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> text <span class="token operator">=</span> dom<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果你的项目还需要兼容 IE8 浏览器，则使用下面的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75429462645395230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var text = dom.textContent || dom.innerText;`, `75429462645395230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> text <span class="token operator">=</span> dom<span class="token punctuation">.</span>textContent <span class="token operator">||</span> dom<span class="token punctuation">.</span>innerText<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>另外，如果你要在一个 DOM 元素中改变文字内容，推荐使用 textContent，而不是 innerHTML，性能会更高一点。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/JS DOM innerText和textContent的区别/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-12-15 19:11:45",path:"/js-dom-innertext-textcontent/",tags:"前端, JS, JS知识点",title:"JS DOM innerText和textContent的区别",draft:null}},{excerpt:"简介 document.readyState 是一个只读属性，可以返回当前文档的准备状态。 语法 其中 state 值包含下面三个值： loading 表示文档正在加载中。 interactive 表示文档已完成加载，文档已被解析，但图像、样式表和框架等子资源仍在加载。 complete 表示文档和所有子资源已完成加载。如果状态变成这个，表明 load 事件即将触发。 DOM 事件绑定没必要等 domready 对于 web 页面开发，JavaScript 最主要的功能之一就是页面上 DOM…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>document.readyState 是一个只读属性，可以返回当前文档的准备状态。</p>\n<p>语法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50046711641996010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var state = document.readyState;`, `50046711641996010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> state <span class="token operator">=</span> document<span class="token punctuation">.</span>readyState<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中 state 值包含下面三个值：</p>\n<ul>\n<li>loading<br>\n表示文档正在加载中。</li>\n<li>interactive<br>\n表示文档已完成加载，文档已被解析，但图像、样式表和框架等子资源仍在加载。</li>\n<li>complete<br>\n表示文档和所有子资源已完成加载。如果状态变成这个，表明 load 事件即将触发。</li>\n</ul>\n<h1 id="dom-事件绑定没必要等-domready"><a href="#dom-%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A%E6%B2%A1%E5%BF%85%E8%A6%81%E7%AD%89-domready" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 事件绑定没必要等 domready</h1>\n<p>对于 web 页面开发，JavaScript 最主要的功能之一就是页面上 DOM 元素的交互实现，如果 DOM 元素还没有加载也没有被解析，自然这些 DOM 操作难以为继。于是，JS 初始化的时机就变得很重要。</p>\n<p>实际上，如果我们的 JS 文件以及 script 代码都放在页面的底部，我们不用考虑 JS 初始化时机，因为 JS 放在底部，等到要执行的时候，上面 DOM 都已经解析好了。也就是什么 readyState，什么 DOMContentLoaded 都不需要考虑。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62187041456939340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$(document).ready(function() {});\n// \\$(document).ready这一戳东西删掉，只要你的JS代码是在页面底部的，这些都完全不需要\n(function() {})();`, `62187041456939340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// $(document).ready这一戳东西删掉，只要你的JS代码是在页面底部的，这些都完全不需要</span>\n<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h1 id="domcontentloaded-事件"><a href="#domcontentloaded-%E4%BA%8B%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOMContentLoaded 事件</h1>\n<p>document.readyState 越来越少用到的另外一个原因，就是半路上杀出一个程咬金——‘DOMContentLoaded’事件。</p>\n<p>DOMContentLoaded 事件是 DOM Level 3 新增的一个事件类型，IE9+浏览器支持，表示 DOM 节点内容加载完毕。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36267712986569990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\'DOMContentLoaded\', function() {});\n\nwindow.addEventListener(\'DOMContentLoaded\', function() {});`, `36267712986569990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>DOMContentLoaded 设计初衷就是为了方便 JS 代码的初始化，要比记得记不住的 interactive 状态容易理解，也容易使用的多。</p>\n<p>因此，如果为了提防我们的 JavaScript 代码不小心跑到了页面的顶部，需要确保在 DOM 加载完毕之后执行，推荐使用下面代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15278164081850653000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`window.addEventListener(\'DOMContentLoaded\', function() {});`, `15278164081850653000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>由于<code class="language-text">&lt;script&gt;</code>元素本身也是 DOM 元素，因此，只要脚本不是异步加载的，无论放在页面什么位置，DOMContentLoaded 事件一定会触发。</p>\n<p>假设有一个名为 insert.js 的文件，里面的 JS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90772200728617940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.log(\'zxx被加载了~\' + document.readyState);\nwindow.addEventListener(\'DOMContentLoaded\', function() {\n  console.log(\'CSS选择器这本书很赞哦！\' + document.readyState);\n});`, `90772200728617940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'zxx被加载了~\'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'CSS选择器这本书很赞哦！\'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后还有一个名为 load-test.html 的页面，里面代码这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50134876632042365000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<body>\n  <script src=&quot;./insert.js&quot;></script>\n</body>`, `50134876632042365000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./insert.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>结果页面进入，控制台出现了下图所示的结果：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-06-23-ed5b93fe489f1605d939a4dd671f23d9-4493b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 320px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.5625%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABU0lEQVQoz3WRi46CMBBF+f/vMmHVrBYjyLaALgq0IG9QHgX2gslmE7M3TTMpc2buDMo4jk3TeJ7HOXccJ0mS+/0eBIHn+6HgXphpTBDqf5qeyzMh+PV6FUIgjVKqAG7b1jRNALiLokCVKIqez2dd11lRRWkZZ1UQJiIC8AWh2e1203VDGYah67qqqoC5rgvesqw0TZNFRZH3XYsj+w4HFR+PB/LLspw7A5ZSoj9gxpiqqvv9Hs7P5zOaIANA3/dw1y1C/jRNeLFtZ4YRSTmgj23bmqYBPp1OmH+3261WK9/34zgOwxAVMS08AkYVJL9s93UjhwHtx18jLy/wDxI3X5aEdaBEnueoxZg1w8ib3gSfqvpBCNEIoYwRTTsej7phHA4HjIPVUMoUjHS5XL7fhJnhH843m42u6+v1GjGY7XaLAF9mGCazf1Quev0I3Ij/BrD2A1wk7daYmY4vAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 06 23" title="" data-src="/static/2019-12-15-19-06-23-ed5b93fe489f1605d939a4dd671f23d9-4493b.png" data-srcset="/static/2019-12-15-19-06-23-ed5b93fe489f1605d939a4dd671f23d9-102e5.png 200w,\n/static/2019-12-15-19-06-23-ed5b93fe489f1605d939a4dd671f23d9-4493b.png 320w" data-sizes="(max-width: 320px) 100vw, 320px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>可以看到，“DOMContentLoaded”事件绑定时候文档状态是’loading’，执行的时候文档状态是可交互的’interactive’。</p>\n<p>配合其他测试（这里不展示），我们可以得出一个网页文档几个加载状态变化和事件触发顺序是这样子的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57544708179177670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.readyState = \'loading\'\n↓\ndocument.readyState变成\'interactive\'\n↓\n\'DOMContentLoaded\'事件执行\n↓\ndocument.readyState变成\'complete\'\n↓\n\'load\'事件执行`, `57544708179177670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">document.readyState <span class="token operator">=</span> <span class="token string">\'loading\'</span>\n↓\ndocument.readyState变成<span class="token string">\'interactive\'</span>\n↓\n<span class="token string">\'DOMContentLoaded\'</span>事件执行\n↓\ndocument.readyState变成<span class="token string">\'complete\'</span>\n↓\n<span class="token string">\'load\'</span>事件执行</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以及可以推测出一个结论：</p>\n<p><strong>DOMContentLoaded 事件必须在文档状态为 loading 时候绑定才有效。</strong></p>\n<p>正是由于上面推论，才使得 document.readyState 有了应用场景。</p>\n<h1 id="应用"><a href="#%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用</h1>\n<p>由于 DOMContentLoaded 事件绑定后可能并不会执行，于是出现了需要用到 document.readyState 的场景。</p>\n<p>什么时候 DOMContentLoaded 事件不会执行呢？</p>\n<p>那就是相关脚本是在页面 DOM 加载完毕后执行的场景下。</p>\n<p>假设有一个名为 insert.js 的文件，里面的 JS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80250754537383940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.log(\'zxx被加载了~\' + document.readyState);\nwindow.addEventListener(\'DOMContentLoaded\', function() {\n  console.log(\'CSS选择器这本书很赞哦！\');\n});`, `80250754537383940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'zxx被加载了~\'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'CSS选择器这本书很赞哦！\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后还有一个名为 load-test.html 的页面，里面代码这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37025607841418576000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<body>\n  <script>\n    var eleScript = document.createElement(\'script\');\n    eleScript.src = \'./insert.js\';\n    document.head.appendChild(eleScript);\n  </script>\n</body>`, `37025607841418576000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">var</span> eleScript <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'script\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    eleScript<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'./insert.js\'</span><span class="token punctuation">;</span>\n    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleScript<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果页面进入，控制台只有’zxx 被加载了~‘的文案，并没有 DOMContentLoaded 事件中的 console.log 输出，如下图所示：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-09-13-16b41d70904b128a70018c3ea6cb64cb-bd67d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 250px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 57.599999999999994%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABXUlEQVQoz5WSbW+CMBSF+/9/1bKZmJgYNmUIKO8o472lUEFAd6Ax2ZZ90CcptJdzbntvIV3XXWb6vu9mMB/HcbgjY8Mw9gOCI4RSg0+EUqqqap7neAZBwDkvy/JwOHie57puGIY15xUtjoEX+q7nWFkSte3ZMAzHcSYzXmma2radJAljDBE4kcj3/WMYpjn7sIq3d+9VcV/W9trMUioMQ9cNg8AAkUyBSVVViGDZ3KGsigueliKjTUaFE8SM15qm7XY7cjqdNptNURSq+gk/ivFmpLOeOYtaNLypec2rJP4STaMoCvxECIEGQIGy9/s98um6jlzYPMuy8g4i0MjWop1xHKMvBE2+3W6oGdsul8vFYrFarSCF07IseYooitACpIDyer1KPXYior0wMa2n8QC/zLiyfpxjMz9Ff/jHLI/9ONKMoiYz7qZ+BvxFbdviUk3TJBjb7VZ9ElgoY9/k3pzE9W82EAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 09 13" title="" data-src="/static/2019-12-15-19-09-13-16b41d70904b128a70018c3ea6cb64cb-bd67d.png" data-srcset="/static/2019-12-15-19-09-13-16b41d70904b128a70018c3ea6cb64cb-30978.png 200w,\n/static/2019-12-15-19-09-13-16b41d70904b128a70018c3ea6cb64cb-bd67d.png 250w" data-sizes="(max-width: 250px) 100vw, 250px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>因为 DOMContentLoaded 事件绑定的时候，页面的准备状态已经是’interactive’而不是’loading’了。</p>\n<p>如果 insert.js 是一个公用组件，尤其以后会开源的那种，那势必要考虑到各种加载场景，页面的头部，页面底部，或者异步动态加载，此时，单纯靠 DOMContentLoaded 事件只能覆盖前两种情况，异步动态加载无能为力。</p>\n<p>此时，一直认为没什么锤子用的 document.readyState 倒是排上了用场，假设组件的初始方法名为 init，则好的实现方法是这样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35694715049850536000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (document.readyState != \'loading\') {\n  init();\n} else {\n  window.addEventListener(\'DOMContentLoaded\', function() {\n    init();\n  });\n}`, `35694715049850536000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">!=</span> <span class="token string">\'loading\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是当下实际开发中，唯一需要使用 document.readyState 的场景，在开源或者大规模使用的框架或组件中精准初始化使用。</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/document.readyState的作用/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2019-12-15 18:59:10",path:"/document-readystate/",tags:"前端, JS, JS知识点",title:"document.readyState的作用",draft:null}}],page:27,pagesSum:46,length:230,prevPath:"/page/26",nextPath:"/page/28"}}}});