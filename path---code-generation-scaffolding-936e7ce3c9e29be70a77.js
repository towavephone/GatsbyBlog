webpackJsonp([0x9235cf0bf1c0],{1195:function(n,a){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlElEQVRIx12We2xT5xXAbcI2Vmn7o1I1uhVYRxL8tuPn9bXv0+/4/YgdOyYkkATCCEEYsqVNC2wCIYQWShmUBFh4hMAWECot0BUtlI4yAS1oKqJQXimsDBgTU8codnLO7r0uUPpJn87Rp+/8vvOdc75zr8xmZmTieI1NykU5yxOfxDncz3NUjAlyDXMjXGMhys+cG+FzGQ8VU4t7XuV8z8m+GUkrJclSqVReYJ0ZWQ8Tl2AdTPhnq9ns2QKd+crDZiHha8NsYCE21HZiXphpb3sxxTf99Tdsw51ldHqFaLOXXyzvYqOyZ0YPk5soylfouuUbvHOxh56JbiqJfi4/FnE1lxKetrGUZ954nbcdU/752ORpxWVsc6mZjPxctFtApeVtra1lmIPwTxClgeCqvGTsX/WWOEbtyTGWSoGbToOPzUHQ1QghVxOEhRniZ5U8XB4TzvTdgj1ZJdq2OOrkGhVRBnrYFum6TiK0l2fr0emMlVxcBhlnEniqDjlBuqg0CnD0MPWiDrwzhR4u+5B3x3WiLUNHJjxzZYvR8ZKTCP+Xo1JoM/nBYvSB1egHuyUIrCOBPj4LtD0KlD2K4h7SGip62aygxzaK9rHA3Aqt2vw0MRYjnyJtYaQdsXG9hgWFwgmVlXZUKUjUqmm0CgfwhA80Kgr1Wg40Sue4SuFEnZq+YjMbJ0kh0zmfemjQ0j2EJYh2a23RVOODIBvHmCsBUaoWLDoWKIsP50bTApxC5QwH1Ghp0Gk4MBk8aDLQEslooCc88VClsK+zGANI2mqLer0XFuea8PSuN+DM7o3QWyhAR7IBfj+vDbyOICS9aSjkZo8nvSlUKuxXLDUOKdN6LSl/AlRUE+vNAnD50l8XeTIEPiYEzXYG5mlNeGz7BvjPpY/g5snDcHxwE+zs7oCh1zvHCrNm48u/ML8j2muVQblBZ3t6ZY2KXKtQcDiwdk1xx9rV0BlqghEuD4fNUTy1Zwhw7Cbioxu461fdsOgFDa5pbh3zu6NifE9f+XCPlGHS5nuaFI3K8brJ4EUHES4WFiyEP2/dCPc2vYH/3NIHePcywP1LWLp3Ec4tWQa3FvbAu7294yqVA801rju5utYfiQyKDD4DnC8GWEhMafJPtBALxuHjo3+C8bufIn59DfHBFcDiDcQvzyF+/iEsbWuDadNMaDW5H7nY6Iyyh165zfLNtdUqIqLTsEJSQqBVUTD1JQPqdRT8sf9NuH7kMHy0fRg+O3EUzp96H/Zs2SBklxFKxwFmowtdTCIoPQx7oKLzl32PPTRPVSudDwQgCrUGL0+twdzsDjjSdwD2J1fh/q7N0N+1EtykB178qVY4lAahRktWkw95JrG4DAxPvHU3Wwb+rlcsHfK0WNxCoMdUCgdUaxnMBPKw7dVe2LyhDw4MboORA4NQOd2CaiUFaqWjZJGAyQGRUeubP8FqElqZspquEBeUM2zrnEQUa3R8USVcp2qGDZV6ErqXL4PfrlwFhSU9cPL4MejfshOsZq90sCg5KvHZ5MnPfa+cmFrxukRFuRZNcYqIoNngHheeFmiF11ClIDBdPwfqG9qhc1E3rF25GnrX90M204JqBfWItPrP8lTqa7vFpSw3GJ9cZjI4pW5TXaWezpKxh4Q5gEY9LwApVOtZMApxVWhd2DKvC7K5FjTUsFCj45Ah4yXaHuz1MBlgyHCb1HXISIXMTcekOJqN1h/72Mx92h5DwuwHjeChWseBQsNgJJ6H944eB5oNgaLajnaL/07E24wuKr7Cz+XuuenUsMioCxYmyHhnSPLQTYVVYVfjI46Mo80WBLMgLY4E1FhCOENBAsfHQG/0juuNPqGguU8ywXas5XNbg6783wJ8w781GtUPJc+irkap/Ufdje0JXytStnDJbA2D1Z4EKxEHsyUMRmsIdcZaNFpCYBYqwWQLPhD3Btn6t2Pe5uF0cD7Sdr/xmSab8racFaDooOvuk0wDEs40EFQGbVQGbEKXJoTPgZ3JoJGIgULvR6M1jE67rzvpae5ojC7GEJ9rfgILc7lC3NV0T6flTtjoPLK+VuD8rcD65gDtaQInPxOtzoxQRrXgD8/BdW/+YezYByfxvfdHvnxl+ZLKCDfzUMIze60Ey+brJukrqcjA1u3tBw8dfZiZuRQFaNFory/WEPUlE5kFK5WDQKRtbFPfUOnChUvFL27cwKuj/8CBHXv2iQw/k/KGuNwyCYiIkhw+sO/569eu7b1+ffR/H5z4BAcG38X1m/biyjX9ODR8GC9dHsXLV0fx5KlzePDIyFd7ht9ZJZhJrcvLhV/wMuUPljQWtC6Z+FjfuWPHlPMXLq64Onpz3d8/Pf9WX//OW2vWbITBof3n3tqya9fbh/7SvW1gZ9Xj/V1dr8kf614qIZONjBwrezi8Ty54K5d9ZzTmF+xe1LnioaD+4Nvrn4/ermif3yHp8UCDLMCky7Z+n192+/YdST9z5mPZ7t1D8ouXv6gQ4S9WTplks7mut8xZijxbKz2vvi2D39/cPyB/HC5xOm2czPvd35F8rkGCS0+I4WXV1QbJaMq06XqbNXCQJIILpH8hOic3GghZMpl62qG/Nf4PRzaQ862MzO4AAAAASUVORK5CYII=",aspectRatio:.6666666666666666,src:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png",srcSet:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-8a97b.png 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-0fdf3.png 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png 600w",srcWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp",srcSetWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-5d70e.webp 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-d1677.webp 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>由于 C 端营销线新建项目需要模板化，需要代码模板的生成功能，以便统一技术栈</p>\n<h1 id="一期"><a href="#%E4%B8%80%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一期</h1>\n<p>一期代码生成需要在 lerna 工程下去做改造，除了带有代码模板的功能，还封装了执行脚本的入口</p>\n<p>参考链接：<a href="https://github.com/react-boilerplate/react-boilerplate" target="_blank" rel="nofollow noreferrer noopener">react-boilerplate</a></p>\n<blockquote>\n<p>这里的代码模板包含项目级别的代码模板、页面级别的代码模板，目前只完成了项目的代码模板生成</p>\n</blockquote>\n<h2 id="目录结构"><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录结构</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25864269169136534000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── index.html\n├── internals\n│   ├── generators\n│   │   ├── index.js // 模板代码执行主入口\n│   │   ├── package // 模板文件夹，带有模板变量的文件后缀名为 hbs\n│   │   │   ├── config.js.hbs\n│   │   │   ├── index.js // 项目级别的代码模板命令执行入口\n│   │   │   ├── package-lock.json.hbs\n│   │   │   ├── package.json.hbs // 带模板变量的模板文件\n│   │   │   └── template // 不带模板变量的模板文件\n│   │   ├── page\n│   │   │   └── index.js // 页面级别的代码模板命令执行入口\n│   │   └── utils\n│   │       ├── directoryExists.js // 检测 packages 文件夹存在性\n│   │       └── fileKeyExists.js // 检测 packages 下面文件里面某种属性是否存在，主要为了实现端口占用检测功能\n│   └── scripts\n│       ├── helpers\n│       │   └── argv.js // 命令行参数封装\n│       └── run.js // 脚本执行主入口\n├── packages // 项目源代码，即代码模板生成后的结果文件夹\n|   ├── demo1\n│   └── demo2\n├── lerna.json\n├── package-lock.json\n├── package.json // 命令主入口\n└── readme.md`, `25864269169136534000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">.</span>\n├── index<span class="token punctuation">.</span>html\n├── internals\n│   ├── generators\n│   │   ├── index<span class="token punctuation">.</span>js <span class="token comment">// 模板代码执行主入口</span>\n│   │   ├── <span class="token keyword">package</span> <span class="token comment">// 模板文件夹，带有模板变量的文件后缀名为 hbs</span>\n│   │   │   ├── config<span class="token punctuation">.</span>js<span class="token punctuation">.</span>hbs\n│   │   │   ├── index<span class="token punctuation">.</span>js <span class="token comment">// 项目级别的代码模板命令执行入口</span>\n│   │   │   ├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs\n│   │   │   ├── <span class="token keyword">package</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs <span class="token comment">// 带模板变量的模板文件</span>\n│   │   │   └── template <span class="token comment">// 不带模板变量的模板文件</span>\n│   │   ├── page\n│   │   │   └── index<span class="token punctuation">.</span>js <span class="token comment">// 页面级别的代码模板命令执行入口</span>\n│   │   └── utils\n│   │       ├── directoryExists<span class="token punctuation">.</span>js <span class="token comment">// 检测 packages 文件夹存在性</span>\n│   │       └── fileKeyExists<span class="token punctuation">.</span>js <span class="token comment">// 检测 packages 下面文件里面某种属性是否存在，主要为了实现端口占用检测功能</span>\n│   └── scripts\n│       ├── helpers\n│       │   └── argv<span class="token punctuation">.</span>js <span class="token comment">// 命令行参数封装</span>\n│       └── run<span class="token punctuation">.</span>js <span class="token comment">// 脚本执行主入口</span>\n├── packages <span class="token comment">// 项目源代码，即代码模板生成后的结果文件夹</span>\n<span class="token operator">|</span>   ├── demo1\n│   └── demo2\n├── lerna<span class="token punctuation">.</span>json\n├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json\n├── <span class="token keyword">package</span><span class="token punctuation">.</span>json <span class="token comment">// 命令主入口</span>\n└── readme<span class="token punctuation">.</span>md</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="脚本主入口"><a href="#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本主入口</h2>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6190682537055570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;name&quot;: &quot;root&quot;,\n   &quot;private&quot;: true,\n   &quot;devDependencies&quot;: {\n      &quot;cross-env&quot;: &quot;^7.0.3&quot;,\n      &quot;lerna&quot;: &quot;^4.0.0&quot;,\n      &quot;minimist&quot;: &quot;^1.2.5&quot;,\n      &quot;plop&quot;: &quot;^2.7.4&quot;,\n      &quot;shelljs&quot;: &quot;^0.8.4&quot;\n   },\n   &quot;scripts&quot;: {\n      &quot;postinstall&quot;: &quot;lerna bootstrap&quot;,\n      &quot;start&quot;: &quot;node internals/scripts/run --cmd=start&quot;,\n      &quot;build&quot;: &quot;node internals/scripts/run --cmd=build&quot;,\n      &quot;generate&quot;: &quot;plop --plopfile internals/generators/index.js&quot;\n   }\n}`, `6190682537055570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span>\n   <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n   <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"cross-env"</span><span class="token operator">:</span> <span class="token string">"^7.0.3"</span><span class="token punctuation">,</span>\n      <span class="token property">"lerna"</span><span class="token operator">:</span> <span class="token string">"^4.0.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"minimist"</span><span class="token operator">:</span> <span class="token string">"^1.2.5"</span><span class="token punctuation">,</span>\n      <span class="token property">"plop"</span><span class="token operator">:</span> <span class="token string">"^2.7.4"</span><span class="token punctuation">,</span>\n      <span class="token property">"shelljs"</span><span class="token operator">:</span> <span class="token string">"^0.8.4"</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"postinstall"</span><span class="token operator">:</span> <span class="token string">"lerna bootstrap"</span><span class="token punctuation">,</span>\n      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=start"</span><span class="token punctuation">,</span>\n      <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=build"</span><span class="token punctuation">,</span>\n      <span class="token property">"generate"</span><span class="token operator">:</span> <span class="token string">"plop --plopfile internals/generators/index.js"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模板代码生成"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码生成</h2>\n<h3 id="模板代码执行主入口"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码执行主入口</h3>\n<p>internals/generators/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42649312537709220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shell = require(\'shelljs\');\n\nconst packageGenerator = require(\'./package/index.js\');\n\nmodule.exports = (plop) => {\n   plop.setGenerator(\'package\', packageGenerator); // 注册 package 下的命令\n   // plop.setGenerator(&quot;page&quot;, containerGenerator);\n   plop.setDefaultInclude({ actionTypes: true });\n   // 拓展 plop 复制功能\n   plop.setActionType(\'copy\', (answers, config, plop) => {\n      const src = plop.renderString(config.src, answers);\n      const dest = plop.renderString(config.dest, answers);\n      shell.cp(\'-r\', src, dest);\n   });\n};`, `42649312537709220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> shell <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> packageGenerator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./package/index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   plop<span class="token punctuation">.</span><span class="token function">setGenerator</span><span class="token punctuation">(</span><span class="token string">\'package\'</span><span class="token punctuation">,</span> packageGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册 package 下的命令</span>\n   <span class="token comment">// plop.setGenerator("page", containerGenerator);</span>\n   plop<span class="token punctuation">.</span><span class="token function">setDefaultInclude</span><span class="token punctuation">(</span><span class="token punctuation">{</span> actionTypes<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// 拓展 plop 复制功能</span>\n   plop<span class="token punctuation">.</span><span class="token function">setActionType</span><span class="token punctuation">(</span><span class="token string">\'copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> config<span class="token punctuation">,</span> plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> src <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>src<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> dest <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>dest<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      shell<span class="token punctuation">.</span><span class="token function">cp</span><span class="token punctuation">(</span><span class="token string">\'-r\'</span><span class="token punctuation">,</span> src<span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="检测-packages-文件夹存在性"><a href="#%E6%A3%80%E6%B5%8B-packages-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%AD%98%E5%9C%A8%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检测 packages 文件夹存在性</h3>\n<p>internals/generators/utils/directoryExists.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41089699663127350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const fs = require(\'fs\');\nconst path = require(\'path\');\n\n/**\n *\n * @param {*} directoryPath 文件夹路径\n * @param {*} value 输入的值\n * @returns\n */\nfunction directoryExists(directoryPath, value) {\n   const directoryFullPath = path.join(\n      process.cwd(),\n      ...(Array.isArray(directoryPath) ? directoryPath : [directoryPath])\n   );\n   if (fs.existsSync(directoryFullPath) && fs.statSync(directoryFullPath).isDirectory()) {\n      const packages = fs.readdirSync(directoryFullPath);\n      return packages.indexOf(value) >= 0;\n   }\n   return false;\n}\n\nmodule.exports = directoryExists;`, `41089699663127350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n *\n * @param {*} directoryPath 文件夹路径\n * @param {*} value 输入的值\n * @returns\n */</span>\n<span class="token keyword">function</span> <span class="token function">directoryExists</span><span class="token punctuation">(</span><span class="token parameter">directoryPath<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> directoryFullPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>\n      process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token operator">...</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>directoryPath<span class="token punctuation">)</span> <span class="token operator">?</span> directoryPath <span class="token punctuation">:</span> <span class="token punctuation">[</span>directoryPath<span class="token punctuation">]</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>directoryFullPath<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>directoryFullPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> packages <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>directoryFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> packages<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> directoryExists<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="检测-packages-下面文件里面某种属性是否存在"><a href="#%E6%A3%80%E6%B5%8B-packages-%E4%B8%8B%E9%9D%A2%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E6%9F%90%E7%A7%8D%E5%B1%9E%E6%80%A7%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检测 packages 下面文件里面某种属性是否存在</h3>\n<p>主要为了实现端口占用检测功能</p>\n<p>internals/generators/utils/fileKeyExists.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72733631321048750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const fs = require(\'fs\');\nconst path = require(\'path\');\nconst packagesPath = path.join(process.cwd(), \'packages\');\nconst packages = fs.readdirSync(packagesPath);\nconst lodash = require(\'lodash\');\n\n/**\n * 检测 packages 下面文件里面某种属性是否存在\n * @param {*} filePath 文件路径\n * @param {*} key 文件的属性\n * @param {*} defaultValue 属性不存在时的默认值\n * @param {*} value 输入的值\n * @returns\n */\nfunction fileKeyExists(filePath, key, defaultValue, value) {\n   const values = [];\n   packages.forEach((item) => {\n      if (item !== \'js-bridge\') {\n         const fileFullPath = path.join(packagesPath, item, ...(Array.isArray(filePath) ? filePath : [filePath]));\n         if (fs.existsSync(fileFullPath) && fs.statSync(fileFullPath).isFile()) {\n            const fileResult = require(fileFullPath);\n            const fileKeyValue = lodash.get(fileResult, key);\n            if (fileKeyValue) {\n               values.push(fileKeyValue);\n            } else {\n               values.push(defaultValue);\n            }\n         } else {\n            values.push(defaultValue);\n         }\n      }\n   });\n   return values.map((item) => \\`\\${item}\\`).indexOf(value) >= 0;\n}\n\nmodule.exports = fileKeyExists;`, `72733631321048750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> packagesPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'packages\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> packages <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>packagesPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> lodash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * 检测 packages 下面文件里面某种属性是否存在\n * @param {*} filePath 文件路径\n * @param {*} key 文件的属性\n * @param {*} defaultValue 属性不存在时的默认值\n * @param {*} value 输入的值\n * @returns\n */</span>\n<span class="token keyword">function</span> <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token parameter">filePath<span class="token punctuation">,</span> key<span class="token punctuation">,</span> defaultValue<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   packages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!==</span> <span class="token string">\'js-bridge\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> fileFullPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>packagesPath<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token operator">?</span> filePath <span class="token punctuation">:</span> <span class="token punctuation">[</span>filePath<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">const</span> fileResult <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">const</span> fileKeyValue <span class="token operator">=</span> lodash<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fileResult<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>fileKeyValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fileKeyValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n               values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> values<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> fileKeyExists<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="项目级别的代码模板命令执行入口"><a href="#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目级别的代码模板命令执行入口</h3>\n<p>internals/generators/package/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38010202280611275000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const directoryExists = require(\'../utils/directoryExists\');\nconst fileKeyExists = require(\'../utils/fileKeyExists\');\n\nconst portExists = (value) =>\n   fileKeyExists(\'config.js\', \'serverPort\', 3000, value) || fileKeyExists(\'config.js\', \'fePort\', 8888, value);\n\nmodule.exports = {\n   description: \'生成 package\',\n   prompts: [\n      {\n         type: \'input\',\n         name: \'name\',\n         message: \'package 叫什么名字？\',\n         default: \'demo\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return directoryExists(\'packages\', value) ? \'package 名字已存在\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'serverPort\',\n         message: \'package 的 Node.js 服务端口？\',\n         default: \'8001\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 Node.js 服务端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'fePort\',\n         message: \'package 的 webpack-dev-server 端口？\',\n         default: \'8002\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 webpack-dev-server 端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      }\n   ],\n   actions: (data) => {\n      const actions = [\n         {\n            type: \'copy\',\n            src: \'internals/generators/package/template\',\n            dest: \'packages/{{ dashCase name }}\'\n         },\n         {\n            type: \'addMany\',\n            templateFiles: \'package/*.hbs\',\n            destination: \'../../packages/{{ dashCase name }}/\'\n         }\n      ];\n\n      return actions;\n   }\n};`, `38010202280611275000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> directoryExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/directoryExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fileKeyExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/fileKeyExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">portExists</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   description<span class="token punctuation">:</span> <span class="token string">\'生成 package\'</span><span class="token punctuation">,</span>\n   prompts<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'name\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 叫什么名字？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'demo\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">directoryExists</span><span class="token punctuation">(</span><span class="token string">\'packages\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'package 名字已存在\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 Node.js 服务端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8001\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 Node.js 服务端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 webpack-dev-server 端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8002\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 webpack-dev-server 端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">]</span><span class="token punctuation">,</span>\n   <span class="token function-variable function">actions</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'copy\'</span><span class="token punctuation">,</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'internals/generators/package/template\'</span><span class="token punctuation">,</span>\n            dest<span class="token punctuation">:</span> <span class="token string">\'packages/{{ dashCase name }}\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'addMany\'</span><span class="token punctuation">,</span>\n            templateFiles<span class="token punctuation">:</span> <span class="token string">\'package/*.hbs\'</span><span class="token punctuation">,</span>\n            destination<span class="token punctuation">:</span> <span class="token string">\'../../packages/{{ dashCase name }}/\'</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> actions<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="带模板变量的模板文件"><a href="#%E5%B8%A6%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F%E7%9A%84%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>带模板变量的模板文件</h3>\n<p>hbs 文件为模板文件，所有需要替换的地方用 <code class="language-text">{{}}</code> 模板变量，详情请查看 <a href="https://github.com/plopjs/plop" target="_blank" rel="nofollow noreferrer noopener">plop</a>，其他模板文件不再举例</p>\n<p>internals/generators/package/config.js.hbs</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90403045892518080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n  prefix: \'page\',\n  serverPort: {{ serverPort }},\n  fePort: {{ fePort }}\n}`, `90403045892518080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="hbs"\n              >\n                <span class="gatsby-code-button-language">hbs</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="hbs"><pre style="counter-reset: linenumber NaN" class="language-hbs line-numbers"><code class="language-hbs">module.exports = {\n  prefix: &#39;page&#39;,\n  serverPort: {{ serverPort }},\n  fePort: {{ fePort }}\n}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行结果"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h3>\n<p>以下是检测存在冲突的情况</p>\n<p><img src="/static/code-generation-addfae6d6b5126e00ca2c25e4c38dd96.gif" alt="代码生成冲突检测"></p>\n<h2 id="脚本执行封装"><a href="#%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E5%B0%81%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本执行封装</h2>\n<p>封装 lerna 脚本，以实现脚本的并行执行</p>\n<p>internals/scripts/helpers/argv.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41336701926294530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = require(\'minimist\')(process.argv.slice(2));`, `41336701926294530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'minimist\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>internals/scripts/run.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61115606225936370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env node\n\nconst shelljs = require(\'shelljs\');\nconst argv = require(\'./helpers/argv\');\n\nlet scopeParams = [];\nconst arguments = argv._;\n\nif (arguments && arguments.length > 0) {\n   scopeParams = arguments.map((item) => \\`--scope=\\${item}\\`);\n}\n\nshelljs.exec(\\`\n  cross-env FORCE_COLOR=1 lerna run \\${argv.cmd} --stream --parallel \\${scopeParams.join(\' \')}\n\\`);`, `61115606225936370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node\n\n<span class="token keyword">const</span> shelljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> argv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./helpers/argv\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> scopeParams <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> arguments <span class="token operator">=</span> argv<span class="token punctuation">.</span>_<span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>arguments <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   scopeParams <span class="token operator">=</span> arguments<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">--scope=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nshelljs<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n  cross-env FORCE_COLOR=1 lerna run </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>argv<span class="token punctuation">.</span>cmd<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --stream --parallel </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scopeParams<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="使用说明"><a href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用说明</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72380202898400680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`npm i # 安装依赖\n\n# 启动\nnpm start # 并行启动所有 package\nnpm start website # 启动 website 项目\nnpm start website demo # 并行启动 website,demo 项目\n\n# 编译\nnpm run build # 并行编译所有 package\nnpm run build website # 编译 package 项目\nnpm run build website demo # 并行编译 website,demo 项目\n\n# 模板代码生成\nnpm run generate`, `72380202898400680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> i <span class="token comment"># 安装依赖</span>\n\n<span class="token comment"># 启动</span>\n<span class="token function">npm</span> start <span class="token comment"># 并行启动所有 package</span>\n<span class="token function">npm</span> start website <span class="token comment"># 启动 website 项目</span>\n<span class="token function">npm</span> start website demo <span class="token comment"># 并行启动 website,demo 项目</span>\n\n<span class="token comment"># 编译</span>\n<span class="token function">npm</span> run build <span class="token comment"># 并行编译所有 package</span>\n<span class="token function">npm</span> run build website <span class="token comment"># 编译 package 项目</span>\n<span class="token function">npm</span> run build website demo <span class="token comment"># 并行编译 website,demo 项目</span>\n\n<span class="token comment"># 模板代码生成</span>\n<span class="token function">npm</span> run generate</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="二期"><a href="#%E4%BA%8C%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>二期</h1>\n<p>由于项目代码需要分离，不再使用 lerna 管理各个产品线的包，所以二期主要工作在于封装成可用的命令行，以便直接使用它来新建项目</p>\n<p>参考链接：<a href="https://juejin.cn/post/6919308174151385096" target="_blank" rel="nofollow noreferrer noopener">从 0-1 搭建 react，ts 脚手架</a></p>\n<h2 id="目录结构-1"><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录结构</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25817648666062910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── bin\n│   └── cli.js // 脚本主入口\n├── internals\n│   ├── generators\n│   │   ├── index.js // 模板代码生成\n│   │   ├── package\n│   │   │   ├── config.js.hbs\n│   │   │   ├── index.js\n│   │   │   ├── package-lock.json.hbs\n│   │   │   ├── package.json.hbs\n│   │   │   └── template\n│   │   ├── page\n│   │   │   └── index.js\n│   │   └── utils\n│   │       ├── directoryExists.js\n│   │       └── fileKeyExists.js\n│   └── scripts\n│       ├── helpers\n│       │   └── argv.js\n│       └── run.js\n├── package-lock.json\n├── package.json\n├── src\n│   ├── create.js // 模板代码生成主入口\n│   └── start.js\n└── utils\n    └── index.js`, `25817648666062910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">.</span>\n├── bin\n│   └── cli<span class="token punctuation">.</span>js <span class="token comment">// 脚本主入口</span>\n├── internals\n│   ├── generators\n│   │   ├── index<span class="token punctuation">.</span>js <span class="token comment">// 模板代码生成</span>\n│   │   ├── <span class="token keyword">package</span>\n│   │   │   ├── config<span class="token punctuation">.</span>js<span class="token punctuation">.</span>hbs\n│   │   │   ├── index<span class="token punctuation">.</span>js\n│   │   │   ├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs\n│   │   │   ├── <span class="token keyword">package</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs\n│   │   │   └── template\n│   │   ├── page\n│   │   │   └── index<span class="token punctuation">.</span>js\n│   │   └── utils\n│   │       ├── directoryExists<span class="token punctuation">.</span>js\n│   │       └── fileKeyExists<span class="token punctuation">.</span>js\n│   └── scripts\n│       ├── helpers\n│       │   └── argv<span class="token punctuation">.</span>js\n│       └── run<span class="token punctuation">.</span>js\n├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json\n├── <span class="token keyword">package</span><span class="token punctuation">.</span>json\n├── src\n│   ├── create<span class="token punctuation">.</span>js <span class="token comment">// 模板代码生成主入口</span>\n│   └── start<span class="token punctuation">.</span>js\n└── utils\n    └── index<span class="token punctuation">.</span>js</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="脚本主入口-1"><a href="#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本主入口</h2>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96233778157084850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;name&quot;: &quot;cli&quot;,\n   &quot;version&quot;: &quot;1.0.0&quot;,\n   &quot;description&quot;: &quot;销服C端脚手架&quot;,\n   &quot;main&quot;: &quot;index.js&quot;,\n   &quot;scripts&quot;: {\n      &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; && exit 1&quot;,\n      &quot;start&quot;: &quot;node internals/scripts/run --cmd=start&quot;,\n      &quot;build&quot;: &quot;node internals/scripts/run --cmd=build&quot;\n   },\n   &quot;bin&quot;: {\n      &quot;cli&quot;: &quot;./bin/cli.js&quot;\n   },\n   &quot;author&quot;: &quot;&quot;,\n   &quot;license&quot;: &quot;ISC&quot;,\n   &quot;dependencies&quot;: {\n      &quot;commander&quot;: &quot;^8.2.0&quot;,\n      &quot;cross-env&quot;: &quot;^7.0.3&quot;,\n      &quot;minimist&quot;: &quot;^1.2.5&quot;,\n      &quot;plop&quot;: &quot;^2.7.4&quot;,\n      &quot;shelljs&quot;: &quot;^0.8.4&quot;\n   }\n}`, `96233778157084850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"cli"</span><span class="token punctuation">,</span>\n   <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>\n   <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"销服C端脚手架"</span><span class="token punctuation">,</span>\n   <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>\n   <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \\"Error: no test specified\\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>\n      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=start"</span><span class="token punctuation">,</span>\n      <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=build"</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"bin"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"cli"</span><span class="token operator">:</span> <span class="token string">"./bin/cli.js"</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n   <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>\n   <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"commander"</span><span class="token operator">:</span> <span class="token string">"^8.2.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"cross-env"</span><span class="token operator">:</span> <span class="token string">"^7.0.3"</span><span class="token punctuation">,</span>\n      <span class="token property">"minimist"</span><span class="token operator">:</span> <span class="token string">"^1.2.5"</span><span class="token punctuation">,</span>\n      <span class="token property">"plop"</span><span class="token operator">:</span> <span class="token string">"^2.7.4"</span><span class="token punctuation">,</span>\n      <span class="token property">"shelljs"</span><span class="token operator">:</span> <span class="token string">"^0.8.4"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模板代码生成-1"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码生成</h2>\n<p>以下仅列出和一期的不同点</p>\n<h3 id="模板代码执行主入口-1"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码执行主入口</h3>\n<p>相比一期主要多了新建项目后 <code class="language-text">npm install</code> 的功能</p>\n<p>bin/cli.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25308232686517430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env node\nconst program = require(\'commander\');\nconst create = require(\'../src/create\');\n// const start = require(&quot;../src/start&quot;);\n\nconst { green } = require(\'../utils\');\n\nprogram.version(\'1.0.0\');\n\n/* create a project */\nprogram\n   .command(\'create\')\n   .description(\'create a project \')\n   .action(function() {\n      green(\'👽 👽 👽 \' + \'欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\');\n      create();\n   });\n\n/* start project */\nprogram\n   .command(\'start\')\n   .description(\'start a project\')\n   .action(function() {\n      green(\'--------运行项目-------\');\n      start(\'start\').then(() => {\n         green(\'-------✅  ✅运行完成-------\');\n      });\n   });\n\nprogram.parse(process.argv);`, `25308232686517430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node\n<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'commander\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> create <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../src/create\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// const start = require("../src/start");</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> green <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nprogram<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">\'1.0.0\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/* create a project */</span>\nprogram\n   <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">\'create\'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">\'create a project \'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">\'👽 👽 👽 \'</span> <span class="token operator">+</span> <span class="token string">\'欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/* start project */</span>\nprogram\n   <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">\'start\'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">\'start a project\'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">\'--------运行项目-------\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">start</span><span class="token punctuation">(</span><span class="token string">\'start\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">\'-------✅  ✅运行完成-------\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nprogram<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>internals/generators/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79654472665107840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shell = require(\'shelljs\');\nconst { spawn } = require(\'child_process\');\n\nconst packageGenerator = require(\'./package/index.js\');\n\nconst didSucceed = (code) => \\`\\${code}\\` === \'0\';\n\nfunction npmInstall(answers, config, plop) {\n   const path = plop.renderString(config.path, answers);\n   const spawnOptions = config.verbose\n      ? {\n           cwd: path,\n           shell: true,\n           stdio: \'inherit\'\n        }\n      : {\n           cwd: path\n        };\n\n   return new Promise((resolve, reject) => {\n      const npmI = spawn(\'npm\', [\'install\'], spawnOptions);\n\n      npmI.on(\'close\', (code) => {\n         if (didSucceed(code)) {\n            resolve(\\`npm install ran correctly\\`);\n         } else {\n            reject(\\`npm install exited with \\${code}\\`);\n         }\n      });\n   });\n}\n\nmodule.exports = (plop) => {\n   plop.setGenerator(\'package\', packageGenerator);\n   // plop.setGenerator(&quot;page&quot;, containerGenerator);\n   plop.setDefaultInclude({ actionTypes: true });\n   plop.setActionType(\'copy\', (answers, config, plop) => {\n      const src = plop.renderString(config.src, answers);\n      const dest = plop.renderString(config.dest, answers);\n      shell.cp(\'-r\', src, dest);\n   });\n   plop.setActionType(\'npmInstall\', npmInstall);\n};`, `79654472665107840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> shell <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'child_process\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> packageGenerator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./package/index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">didSucceed</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">===</span> <span class="token string">\'0\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">npmInstall</span><span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> config<span class="token punctuation">,</span> plop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> path <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>path<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> spawnOptions <span class="token operator">=</span> config<span class="token punctuation">.</span>verbose\n      <span class="token operator">?</span> <span class="token punctuation">{</span>\n           cwd<span class="token punctuation">:</span> path<span class="token punctuation">,</span>\n           shell<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n           stdio<span class="token punctuation">:</span> <span class="token string">\'inherit\'</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">:</span> <span class="token punctuation">{</span>\n           cwd<span class="token punctuation">:</span> path\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> npmI <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">\'npm\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'install\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> spawnOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      npmI<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'close\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">didSucceed</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm install ran correctly</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm install exited with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   plop<span class="token punctuation">.</span><span class="token function">setGenerator</span><span class="token punctuation">(</span><span class="token string">\'package\'</span><span class="token punctuation">,</span> packageGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// plop.setGenerator("page", containerGenerator);</span>\n   plop<span class="token punctuation">.</span><span class="token function">setDefaultInclude</span><span class="token punctuation">(</span><span class="token punctuation">{</span> actionTypes<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   plop<span class="token punctuation">.</span><span class="token function">setActionType</span><span class="token punctuation">(</span><span class="token string">\'copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> config<span class="token punctuation">,</span> plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> src <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>src<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> dest <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>dest<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      shell<span class="token punctuation">.</span><span class="token function">cp</span><span class="token punctuation">(</span><span class="token string">\'-r\'</span><span class="token punctuation">,</span> src<span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   plop<span class="token punctuation">.</span><span class="token function">setActionType</span><span class="token punctuation">(</span><span class="token string">\'npmInstall\'</span><span class="token punctuation">,</span> npmInstall<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="项目级别的代码模板命令执行入口-1"><a href="#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目级别的代码模板命令执行入口</h3>\n<p>相比一期增加 <code class="language-text">npm install</code> 逻辑</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19400092607536300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const directoryExists = require(\'../utils/directoryExists\');\nconst fileKeyExists = require(\'../utils/fileKeyExists\');\n\nconst portExists = (value) =>\n   fileKeyExists(\'config.js\', \'serverPort\', 3000, value) || fileKeyExists(\'config.js\', \'fePort\', 8888, value);\n\nmodule.exports = {\n   description: \'生成 package\',\n   prompts: [\n      {\n         type: \'input\',\n         name: \'name\',\n         message: \'package 叫什么名字？\',\n         default: \'demo\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return directoryExists(\'packages\', value) ? \'package 名字已存在\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'serverPort\',\n         message: \'package 的 Node.js 服务端口？\',\n         default: \'8001\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 Node.js 服务端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'fePort\',\n         message: \'package 的 webpack-dev-server 端口？\',\n         default: \'8002\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 webpack-dev-server 端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      }\n   ],\n   actions: (data) => {\n      const actions = [\n         {\n            type: \'copy\',\n            src: \'internals/generators/package/template\',\n            dest: \'packages/{{ dashCase name }}\'\n         },\n         {\n            type: \'addMany\',\n            templateFiles: \'package/*.hbs\',\n            destination: \'../../packages/{{ dashCase name }}/\'\n         },\n         {\n            type: \'npmInstall\',\n            path: \\`packages/{{ dashCase name }}/\\`\n         }\n      ];\n\n      return actions;\n   }\n};`, `19400092607536300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> directoryExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/directoryExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fileKeyExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/fileKeyExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">portExists</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   description<span class="token punctuation">:</span> <span class="token string">\'生成 package\'</span><span class="token punctuation">,</span>\n   prompts<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'name\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 叫什么名字？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'demo\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">directoryExists</span><span class="token punctuation">(</span><span class="token string">\'packages\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'package 名字已存在\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 Node.js 服务端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8001\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 Node.js 服务端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 webpack-dev-server 端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8002\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 webpack-dev-server 端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">]</span><span class="token punctuation">,</span>\n   <span class="token function-variable function">actions</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'copy\'</span><span class="token punctuation">,</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'internals/generators/package/template\'</span><span class="token punctuation">,</span>\n            dest<span class="token punctuation">:</span> <span class="token string">\'packages/{{ dashCase name }}\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'addMany\'</span><span class="token punctuation">,</span>\n            templateFiles<span class="token punctuation">:</span> <span class="token string">\'package/*.hbs\'</span><span class="token punctuation">,</span>\n            destination<span class="token punctuation">:</span> <span class="token string">\'../../packages/{{ dashCase name }}/\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'npmInstall\'</span><span class="token punctuation">,</span>\n            path<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">packages/{{ dashCase name }}/</span><span class="token template-punctuation string">`</span></span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> actions<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行结果-1"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74048772354843970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ cli create\n👽 👽 👽 欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\n? package 叫什么名字？ (demo) 项目路径/packages\n? package 叫什么名字？ demo\n? package 的 Node.js 服务端口？ 8001\n? package 的 webpack-dev-server 端口？ 8002\n✔  copy\n✔  +! 3 files added\n -> 项目路径/packages/demo/config.js\n -> 项目路径/packages/demo/package-lock.json\n -> 项目路径/packages/demo/package.json\n✔  npmInstall npm install ran correctly`, `74048772354843970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ cli create\n👽 👽 👽 欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\n? package 叫什么名字？ <span class="token punctuation">(</span>demo<span class="token punctuation">)</span> 项目路径/packages\n? package 叫什么名字？ demo\n? package 的 Node.js 服务端口？ <span class="token number">8001</span>\n? package 的 webpack-dev-server 端口？ <span class="token number">8002</span>\n✔  copy\n✔  +<span class="token operator">!</span> <span class="token number">3</span> files added\n -<span class="token operator">></span> 项目路径/packages/demo/config.js\n -<span class="token operator">></span> 项目路径/packages/demo/package-lock.json\n -<span class="token operator">></span> 项目路径/packages/demo/package.json\n✔  npmInstall <span class="token function">npm</span> <span class="token function">install</span> ran correctly</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>// TODO 代码生成脚手架还在完成中</p>',
excerpt:"需求背景 由于 C 端营销线新建项目需要模板化，需要代码模板的生成功能，以便统一技术栈 一期 一期代码生成需要在 lerna 工程下去做改造，除了带有代码模板的功能，还封装了执行脚本的入口 参考链接： react-boilerplate…",timeToRead:10,tableOfContents:'<ul>\n<li><a href="/code-generation-scaffolding/#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF">需求背景</a></li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E4%B8%80%E6%9C%9F">一期</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">目录结构</a></li>\n<li><a href="/code-generation-scaffolding/#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3">脚本主入口</a></li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90">模板代码生成</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3">模板代码执行主入口</a></li>\n<li><a href="/code-generation-scaffolding/#%E6%A3%80%E6%B5%8B-packages-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%AD%98%E5%9C%A8%E6%80%A7">检测 packages 文件夹存在性</a></li>\n<li><a href="/code-generation-scaffolding/#%E6%A3%80%E6%B5%8B-packages-%E4%B8%8B%E9%9D%A2%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E6%9F%90%E7%A7%8D%E5%B1%9E%E6%80%A7%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">检测 packages 下面文件里面某种属性是否存在</a></li>\n<li><a href="/code-generation-scaffolding/#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3">项目级别的代码模板命令执行入口</a></li>\n<li><a href="/code-generation-scaffolding/#%E5%B8%A6%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F%E7%9A%84%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6">带模板变量的模板文件</a></li>\n<li><a href="/code-generation-scaffolding/#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C">运行结果</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E5%B0%81%E8%A3%85">脚本执行封装</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E">使用说明</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E4%BA%8C%E6%9C%9F">二期</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-1">目录结构</a></li>\n<li><a href="/code-generation-scaffolding/#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3-1">脚本主入口</a></li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90-1">模板代码生成</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3-1">模板代码执行主入口</a></li>\n<li><a href="/code-generation-scaffolding/#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3-1">项目级别的代码模板命令执行入口</a></li>\n<li><a href="/code-generation-scaffolding/#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C-1">运行结果</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>',wordCount:{words:119},frontmatter:{date:"2021-11-15 11:43:19",path:"/code-generation-scaffolding/",tags:"前端, 前端工程化, 预研",title:"代码生成脚手架搭建",draft:null,catalog_number:null}},nextPost:{html:'<p>以下是本次参加 Tweb conf 2021 的学习笔记</p>\n<h1 id="目录"><a href="#%E7%9B%AE%E5%BD%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录</h1>\n<h2 id="主会场"><a href="#%E4%B8%BB%E4%BC%9A%E5%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主会场</h2>\n<ul>\n<li><a href="#flutter-%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5">Flutter 音视频开发实践</a></li>\n<li><a href="#%E8%85%BE%E8%AE%AF%E6%96%87%E6%A1%A3%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96%E4%B9%8B%E8%B7%AF">腾讯文档渲染优化之路</a></li>\n<li><a href="#%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%AC%E4%B8%8B%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E5%8D%8F%E5%90%8C%E5%A6%82%E4%BD%95%E6%8F%90%E6%95%88">远程办公下开发测试协同如何提效</a></li>\n<li>如何创造一门上万人使用的语言</li>\n</ul>\n<h2 id="分会场（看过）"><a href="#%E5%88%86%E4%BC%9A%E5%9C%BA%EF%BC%88%E7%9C%8B%E8%BF%87%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分会场（看过）</h2>\n<h3 id="nodejs--大前端"><a href="#nodejs--%E5%A4%A7%E5%89%8D%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node.js &#x26; 大前端</h3>\n<ul>\n<li>Kubernetes 应用的 BFF 便捷开发</li>\n<li>跨端开发，也可以这样玩</li>\n</ul>\n<h3 id="低代码--可视化"><a href="#%E4%BD%8E%E4%BB%A3%E7%A0%81--%E5%8F%AF%E8%A7%86%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>低代码 &#x26; 可视化</h3>\n<ul>\n<li>基于 serverless 的低代码平台实践</li>\n</ul>\n<h3 id="编辑器--研发效能"><a href="#%E7%BC%96%E8%BE%91%E5%99%A8--%E7%A0%94%E5%8F%91%E6%95%88%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑器 &#x26; 研发效能</h3>\n<ul>\n<li>稿定视频编辑器背后的故事</li>\n<li>在线文档冲突——OT 算法</li>\n</ul>\n<p>以上是本次大会看过的，下面是本次大会未看过的，仅做记录</p>\n<h2 id="分会场（未看）"><a href="#%E5%88%86%E4%BC%9A%E5%9C%BA%EF%BC%88%E6%9C%AA%E7%9C%8B%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分会场（未看）</h2>\n<h3 id="nodejs--大前端-1"><a href="#nodejs--%E5%A4%A7%E5%89%8D%E7%AB%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node.js &#x26; 大前端</h3>\n<ul>\n<li>从 0 开始，打造腾讯自研的跨端&#x26;动态化框架</li>\n<li>Puerts-UnityUE 下的 Typescript 框架</li>\n<li>云时代的前端开发</li>\n</ul>\n<h3 id="低代码--可视化-1"><a href="#%E4%BD%8E%E4%BB%A3%E7%A0%81--%E5%8F%AF%E8%A7%86%E5%8C%96-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>低代码 &#x26; 可视化</h3>\n<ul>\n<li>WebAssembly 在哔哩哔哩创作中心的实践</li>\n<li>厘米秀 3D 形象 DIY 渲染技术揭秘</li>\n<li>信息流运营场景中的低代码探索与实践</li>\n<li>低代码页面编辑器的设计和实现</li>\n</ul>\n<h3 id="编辑器--研发效能-1"><a href="#%E7%BC%96%E8%BE%91%E5%99%A8--%E7%A0%94%E5%8F%91%E6%95%88%E8%83%BD-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑器 &#x26; 研发效能</h3>\n<ul>\n<li>腾讯文档工程实践</li>\n<li>微信小程序真机调试</li>\n<li>CDN 版本化解决方案</li>\n<li>由兴趣驱动开源 Cherry Markdown 成长之路</li>\n</ul>\n<h1 id="flutter-音视频开发实践"><a href="#flutter-%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter 音视频开发实践</h1>\n<h2 id="flutter-简介"><a href="#flutter-%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter 简介</h2>\n<h3 id="跨平台技术发展趋势"><a href="#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%8A%80%E6%9C%AF%E5%8F%91%E5%B1%95%E8%B6%8B%E5%8A%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跨平台技术发展趋势</h3>\n<p>跨平台框架优势：一次开发，多端运行，组件复用，提升效率</p>\n<ul>\n<li>\n<p>Hybrid App（2011 年）</p>\n<ul>\n<li>页面运行在 webviwe</li>\n<li>开发迭代快</li>\n<li>受限于桥接层，拓展性能差</li>\n<li>webview 渲染性能差</li>\n</ul>\n</li>\n<li>\n<p>ReactNative（2015 年）</p>\n<ul>\n<li>原生控件渲染</li>\n<li>性能好于 webview</li>\n<li>渲染时要和 Native 通信</li>\n<li>JIT 编译</li>\n</ul>\n</li>\n<li>\n<p>Flutter（2018 年）</p>\n<ul>\n<li>dart 语言</li>\n<li>同时支持 JIT 和 AOT 编译</li>\n<li>自渲染引擎</li>\n<li>性能接近原生</li>\n</ul>\n</li>\n</ul>\n<h3 id="flutter-架构"><a href="#flutter-%E6%9E%B6%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter 架构</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-15-50-32-9bfd23e729b19e5ede9bcc2540fa4f2e-d7327.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.6416584402764%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACpElEQVQozz2Q6UtUURjG55+oby0Stnw0WymMoOWDmBK0UFpqbllaadoiuLV+CEErszInzVvuiFo6jma5jDNOakKY445LZQR27x0b7x3i17lT9OHH877Pec57Xo5Jel9PZW8TluEuoq15BFQks7M6lb11VwlryiWoNp3t1SnsEIQ25bCr5rKvNzS0MYcD9Rm+fEBlMseb72BqcXXTOm6jY8LhG7DCHM7qsmhWlUbh9yLGpwbrpXj21F5ho5Tw3zPOjazBSnME+8VwU+uojRZXD2/HHRx9c4e1ZbFsq0plc8VF/MsTfPVGKdHXH6zPJLDyEuvLzwo/hQ3SWQKFb2T8yuIIacgRG4510TzaiXWsmyPN2awpj2BrzTkCqxPxfxnFlppENryKJqAqgeDGa74z/5eRPn9TxRm2iNyO2iTWSacJaRIb2kZGcE5OMjQ7y2PbEJkWOzfb7NwwsPaRY7WTa3WI2snd9g/cbnOSZXEIz8j9VYMsce9h9yCmTscEQ65FZhZ+k/lKJ6JAJ71U45JZI+aRTuQDL/FFXqE6GZLGxRKNk/lekoq9xD7yklaqk/pcJ65IJ7vSi2lkbpnhWQ+j8x4Kmt2kSzLZNTK5gswqmTRJ4VShTHTRTxKfLZJkXiT8oUJUkcqJ+wrxxTLnzTLHCmSuV6iYJr96MBif/8X4F6PWmBAYOv1NY3hGEw95KLR4eNquUdLhIf+1TGGLTF6jKnyV4jaFew0qL965MS1M9vJ9yob6/TPusScoznCU/jP/iEUdiEMfimT5YxSevmA8AyfRP10QJKMPnmDZGYI2VcLvnyN4f4g/HO1vwOWsY97VhfLpFmrPPlR7GGrXbtTOnai9h5C7D6DYglE6g1Dsh3HPtOCebhDUszRdx9JcO0tf7AIbfwAiSkZLLSN1/AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 15 50 32" title="" data-src="/static/2021-10-25-15-50-32-9bfd23e729b19e5ede9bcc2540fa4f2e-fee1c.png" data-srcset="/static/2021-10-25-15-50-32-9bfd23e729b19e5ede9bcc2540fa4f2e-a67b7.png 200w,\n/static/2021-10-25-15-50-32-9bfd23e729b19e5ede9bcc2540fa4f2e-0b187.png 400w,\n/static/2021-10-25-15-50-32-9bfd23e729b19e5ede9bcc2540fa4f2e-fee1c.png 800w,\n/static/2021-10-25-15-50-32-9bfd23e729b19e5ede9bcc2540fa4f2e-d7327.png 1013w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>FrameWork: 是一个 Dart 实现的 UI SDK，从上到下包括了两大组件库、基础组件库、图形绘制、手势识别、动画等功能</li>\n<li>Engine: 实现 Flutter 渲染引擎、Dart 虚拟机、Platform 通信通道、事件通知、插件架构等功能</li>\n<li>Embedder: 操作系统适配层</li>\n</ul>\n<h3 id="flutter--web-开发的差异"><a href="#flutter--web-%E5%BC%80%E5%8F%91%E7%9A%84%E5%B7%AE%E5%BC%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter &#x26; Web 开发的差异</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-15-52-08-2d722df40093a28040e209ec43bfa094-7f6f5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.05726872246696%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB2klEQVQoz42RQWsTQRSA9+S/sEd/hRdv0pMHT94sIngo7VEQ8SK9iKLYUktjsaBEY4WGtggRo9E2bcQipZVqsm3MxjVtNk2zu7M7M+/N7PhCQg2e+hjeDDPzzbxvxlKnCCklY6zT6fi+H0URAPTmrdPAnPMgCFzX9TyPTvkfliAkCkDKHFR/TaKKQMXUJEaCEEDEE/IfbHqhuk2h4oILITRKY8BoYZLugPOYJkmBch/WOuGS5cqPV3bvv/3xaHFn4ufhmqZTEliqssu55o1CcyTfvPbRa8cAgjMWhWFIxZO8lWjDRGemdHVq/cpMaeTB6qWNWsYkVAY+3PLPzDrn0u7Qc/fsC/eAAfLYD7pBPGULFZWJftxshXUvqLejPxxCpbRWKhCw78vKEa+0xe+QjFXP+SQsrTQZIpCglpw6AxITpWkv2RktlYg1cIMSB56q75z9PpH+djNXnsxs3Zr/OvbeTpV+Pc3a9vlsa3ilMbp6dCHbuLjcmKvEbxxJl+tBuLD/bHHnbt6eXd69t7B9J783t1ZNbR40rn8OxtfbtzeD0eLxePH4SZkvuZBochyA7daXd5XpYu3lhvP6A5G1dKE6T3+ccfBVTab2YKEOGQcmy+LTIdBPwgD9F7zPUiG9YEqeAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 15 52 08" title="" data-src="/static/2021-10-25-15-52-08-2d722df40093a28040e209ec43bfa094-fee1c.png" data-srcset="/static/2021-10-25-15-52-08-2d722df40093a28040e209ec43bfa094-a67b7.png 200w,\n/static/2021-10-25-15-52-08-2d722df40093a28040e209ec43bfa094-0b187.png 400w,\n/static/2021-10-25-15-52-08-2d722df40093a28040e209ec43bfa094-fee1c.png 800w,\n/static/2021-10-25-15-52-08-2d722df40093a28040e209ec43bfa094-7f6f5.png 908w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>StatelessWidget(无状态)：内部没有保存状态，UI 界面创建后不会发生改变。</li>\n<li>StatefulWidget(有状态)：内部有保存状态，当状态发生改变，调用 <code class="language-text">setState()</code> 方法会触发 UI 发生更新。</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74957587208991520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.grey {\n   background: #e0e0e0;\n   width: 320px;\n   height: 240px;\n   font: 900 24px Roboto;\n   display: flex;\n   align-items: center;\n   justify-content: center;\n}`, `74957587208991520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css{6-8}"\n              >\n                <span class="gatsby-code-button-language">css{6-8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.grey</span> <span class="token punctuation">{</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> #e0e0e0<span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 240px<span class="token punctuation">;</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> 900 24px Roboto<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">   <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">   <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">   <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20047410605977813000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var container = Container(\n   child: Center(\n      child: Text(\n         &quot;Lorem ipsum&quot;,\n         style: bold24Roboto\n      ),\n   ),\n   width: 320,\n   height: 240,\n   color: Colors.grey[300]\n);`, `20047410605977813000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2}"\n              >\n                <span class="gatsby-code-button-language">js{2}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> container <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>\n<span class="gatsby-highlight-code-line">   child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span></span>      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>\n         <span class="token string">"Lorem ipsum"</span><span class="token punctuation">,</span>\n         style<span class="token punctuation">:</span> bold24Roboto\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n   <span class="token punctuation">)</span><span class="token punctuation">,</span>\n   width<span class="token punctuation">:</span> <span class="token number">320</span><span class="token punctuation">,</span>\n   height<span class="token punctuation">:</span> <span class="token number">240</span><span class="token punctuation">,</span>\n   color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">]</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="trtc-简介"><a href="#trtc-%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TRTC 简介</h2>\n<p>腾讯实时音视频致力于帮助开发者快速搭建低成本、低延时、高品质的音视频互动解决方案：</p>\n<ul>\n<li>适用于视频会议、在线教育、互动直播等场景</li>\n<li>客户有腾讯会议、企业微信、陌陌、贝壳找房等</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-01-10-63fa5db53dbb0f0f2cb1d0ec50654c50-19de3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 84.22198041349293%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsSAAALEgHS3X78AAACKUlEQVQ4y1VTh3bkMAj0/3/lpd0WVxUkASoZ7CR34Wm9MhLMMOBpIX6J+sjKtWWtWmv7tjH6wK/39p9dTpiqTrvz9/tj34+Ss+IQd89Tr+PNFXfsuRS8Iiee0vqcq/c+51xrnXykdd1iJKxUCuUsqsDymZeQgnMpJYAYZh9a2xJz8CHnIiLT7gOQUy7eh4g/lmrWiBKXjCelBJyLElKAIJwiasFUGMScmc8iVnFtX9THIGPDV+VXMPYsQjElJgvGjUDJA0L0O3jcUg2UQwiF+SdM2riRxhCZDXvyrKGO1gcOtZswgALJW9T18MfhoAUiQR3Fc+0fgbdtP2vWafH05+/T6kXB+oWMotkuw1UiETOXgmILCMCPdHIa1I7L8wm1yOpj5EDkybNbipPzZd8976qCjfV5PdzL6xv6HEIsoqD3oxYM2EAYvw29BGfrc2IBt8SMWwVSXcKecwTdcGREfgdDLDgRPS1JVulQywQDVVPaNudq2u1IzlcUsxd9pRbUsmUBsrb3+3w4f/UTYizr1q7m1EqniY2YKeEof6zusexwYpwmMDj23SYkF4gRY1y3HTUR65zk4ekZ0kzi2OCgPAUzaEEpTwzk9495XvACxpjz17d3tGXLeo98W7YtpD3LPSl43e6P5/yEtBgo58PE1b4SAF5Mf6RGnU66lx50HNxITbZ5WY/jQEfQdkOOLMhx+GCfydnia7X+z1pvNvRj3OflgQQ7Bs+7SJ8tld0CodGzGAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 01 10" title="" data-src="/static/2021-10-25-16-01-10-63fa5db53dbb0f0f2cb1d0ec50654c50-fee1c.png" data-srcset="/static/2021-10-25-16-01-10-63fa5db53dbb0f0f2cb1d0ec50654c50-a67b7.png 200w,\n/static/2021-10-25-16-01-10-63fa5db53dbb0f0f2cb1d0ec50654c50-0b187.png 400w,\n/static/2021-10-25-16-01-10-63fa5db53dbb0f0f2cb1d0ec50654c50-fee1c.png 800w,\n/static/2021-10-25-16-01-10-63fa5db53dbb0f0f2cb1d0ec50654c50-19de3.png 919w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="sdk-设计"><a href="#sdk-%E8%AE%BE%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SDK 设计</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-09-19-9d1d598a4e062207800729af700b57c4-8afa6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 73.08120133481646%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADp0lEQVQ4y3WT209jdRDH+7iPG198NHF98EVj4oNG/4BNTPTFja6XzSZmL8ascdcNJkYl68YIBHFF1hgNWWBXaJaFihBkuZZ7oRSQAuXaUmihlJbeT8/pOaf9OD3E6Iu/ZM7M7zffmfnO7zfH9kXnJodJhVxew7UZYy2cIp1Tmd2Ksb6fIpnN4/HHWQ0lyasFlvcSuLdjbB2k2Y/nLFzZnxJc0TSwvfvrMgdJlZSiU9Xrx+GJWHZtn5/uxUPLvjsc5Pf5CFCieTJM3eMAw744C8E01RLTMBS0cpSX7UKjl/1EnmAsx72JPfq8R6wfZCUwRO9fUUYk8MF0mKaJEIu7acbXjy3f/akw3lAax/whv7kOyKm61Cth+8S+QSyjsXWYpXFslx5htRLO0DgepGt+XwpEaZnc45fRHWb8CatAkxRuHNsThina3RHZh8nk9ROG5Y9pmpSk/3JLYlAyDP53Fcu+4gm2aFr4sm3qhoiOrW7kGtHjXR7N1VPZ8w529/cY4nT7h6W9bjb2F1janRRmHcxu91u5+lfaBHuee1NfsxP1UdV3idbZWoxcHttNx2sEo+s0jH7GVfur1Ds/pVgs8ViCHs3/jCfoxLnRRYurmh5vs0XS7rnDFfsrVPVfwhfxUOF4XeIrMGRSbDc7zxI4XKPBWSGgl6kfuWEl7Pe10rnwkyQcEhmx7AGf/STh3B0ut73Et/0f4DuY40bHWX4YuY6hCMO60c8Jx/Zo99zlVu/7PPT8iCF3OLDaQddis7TuxB1w8sdik4yKw7q6Qd9DwV6kyVVD8NhPzeDHtMmVmYowLCTcJJJxEgmVfB4KGuQVOIoX5UwnnkYG/d930PQyRqegZCjkYiJRCtkYWu4Yo1DAZo6dQkuto0VHMJbPUfB9SGH5bYzAbQFFMVffk/O3UH2X0b1vyv4CZvmB/V9RctowXWcoTj5B0fU0xcIRNt37Bmo2hBL1oKx9ibJZI7qSfLAFNZdA265G3bqN6q9FE635a9CFrbHzDebkaYy55zFnnhL9AkVNEprSny7zU56m/0q5Q80ooZ90au2L//jkQJdi+VgA9WhbxI+aCJ38y5k/v0NNx6XlAIqrFWWhi9xMG9rGOHoygjJ1H8XdjuJxoEw/IL8yYL10oO0WE+dPM3v9RaavnMF97Tm5OmGY6q5Gz8SlQoSMd5Csb0L0EEpwiYIUyiwNkF0ZlfNxskuD5LbnrIT+1kpGz51i+uozTFx8EtdHz6Ilo/wNXOQIyZDbWTsAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 09 19" title="" data-src="/static/2021-10-25-16-09-19-9d1d598a4e062207800729af700b57c4-fee1c.png" data-srcset="/static/2021-10-25-16-09-19-9d1d598a4e062207800729af700b57c4-a67b7.png 200w,\n/static/2021-10-25-16-09-19-9d1d598a4e062207800729af700b57c4-0b187.png 400w,\n/static/2021-10-25-16-09-19-9d1d598a4e062207800729af700b57c4-fee1c.png 800w,\n/static/2021-10-25-16-09-19-9d1d598a4e062207800729af700b57c4-8afa6.png 899w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>业务层：提供给开发者调用的 API，如进退房、推拉音视频流等近 100 个接口</li>\n<li>实现层：管理 API 的核心类，可扩展、易用、性能好</li>\n<li>通信层：通过 MethodChannel 消息通道连接 Flutter 和原生 sdk，数据通讯能力升级</li>\n<li>原生层：底层是 Android 和 iOS 原生 sdk</li>\n</ul>\n<h3 id="挑战点-1-如何实现复杂的类结构体传输？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-1-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%A4%8D%E6%9D%82%E7%9A%84%E7%B1%BB%E7%BB%93%E6%9E%84%E4%BD%93%E4%BC%A0%E8%BE%93%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 1-如何实现复杂的类结构体传输？</h3>\n<h4 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<ul>\n<li>flutter 本质是 dart 调用 native 的接口，并异步返回 native 的数据</li>\n<li>原生 sdk 存在着大量类结构体的类型定义，原有消息通道不支持传递此类型</li>\n</ul>\n<h4 id="方案"><a href="#%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p>Flutter 类结构体 -> Flutter 类结构体转 Map 对象 -> Flutter JSON 序列化 -> 通信层 JSON 反序列化 -> Android 类结构体</p>\n<p>同时可以对参数进行约束，类型校验，提升易用性</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-22-25-54b80a5656408d7069c57aa4af9213b1-c3000.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 775px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 18.322580645161292%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvklEQVQI1zWMi4qDMBBF/YtdkIqPNBk1SbOjcWIealv2/39ph8IeLszlwpmqaZq6rgFGohhjWddt2wiRTyDaY8whxE8PvPOS81HKacxjmnTV3pobywqu8zpyySkn/sHkktikEGPa9xTCzlmWlX3vyTlEXKovkN+ik6M29FKYAZP25w8dsz/MmsEFbdHohzGOY62bZyMlAExKjdX2ftLrStevjW9E8kvolGnF2ILt5NQp3Qs1/NP3g/gwDOJ+l3+JuS1U650NngAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 22 25" title="" data-src="/static/2021-10-25-16-22-25-54b80a5656408d7069c57aa4af9213b1-c3000.png" data-srcset="/static/2021-10-25-16-22-25-54b80a5656408d7069c57aa4af9213b1-84db6.png 200w,\n/static/2021-10-25-16-22-25-54b80a5656408d7069c57aa4af9213b1-07229.png 400w,\n/static/2021-10-25-16-22-25-54b80a5656408d7069c57aa4af9213b1-c3000.png 775w" data-sizes="(max-width: 775px) 100vw, 775px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="挑战点-2-图片怎么高效在-flutter-和原生-sdk-之间传输？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-2-%E5%9B%BE%E7%89%87%E6%80%8E%E4%B9%88%E9%AB%98%E6%95%88%E5%9C%A8-flutter-%E5%92%8C%E5%8E%9F%E7%94%9F-sdk-%E4%B9%8B%E9%97%B4%E4%BC%A0%E8%BE%93%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 2-图片怎么高效在 Flutter 和原生 sdk 之间传输？</h3>\n<h4 id="背景-1"><a href="#%E8%83%8C%E6%99%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p>直播过程中给视频设置水印等接口需要把 flutter 项目定义的图片资源传给原生 sdk，但是 flutter 没有 bitmap 这种数据类型，如何把 flutter 项目的图片资源转成原生 sdk 需要的 bitmap？</p>\n<h4 id="方案-1"><a href="#%E6%96%B9%E6%A1%88-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p>利用文档目录实现图片传输，通过文档目录（android 和 flutter 都可访问）传递文件路径的方式来实现共享</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-26-16-a32338bd27e1f12d57173ada6a9f6b3c-b043c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 539px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 112.05936920222635%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsSAAALEgHS3X78AAADTklEQVQ4y42Sa1PbRhSG9Z8z7cdMmiZtmumHNgFTSEnAeHDdADY4wUBIMwRIuRhLtnWzjGxZ1sWStavVyrZsSKysTGDAYTJ5552dszPn2XP27FLr+/rz12o8F3l+PVqfv2rkORN7LgCQGHvwmG0tvtH+faslt5rJN1pqm8R67n+DSr3VJ9N6LK1NrGhTGW32tTGTNfYYw/ci0gGwg+HmB/3urBLLaAub5lzOfLqsPYw3ZtZUihz2x8vGxLL6dEmdWFFj6eafS+ourfvYvYK3DrT7c/UnS+pfq83p1Sj/UUKZfdWgpLrFiGZZatGCxohGqWIygqnqNnIhgJFJUG/aBd6gBeOY1Y9KTVowifnTFuVjFPT8oOuTUp0O6pO45yPXhdfkIRh08aDf7XU8H8NB0OkHJB9RhmlyHC9J1WKxyPM8y3I8L5CG3Wsi9UWxwjBFklkqlUkCWS3LpkzTFEVRlmWWcBxXLpdZjrXslt22LtYLS5LEMAw3UqVSIatt2xQ52LsU6TDauhg6CAHP1C3bbJOAbN1RK9EVPA+PRLYU2YNLkdCFiNH29hrZD+r6OzmzU1slwW5jrWqy5NCrTCdKhtT1wZBP4UG8KS/GxYer8nROmSPOyFPz/M95dcdHXUJFxd0vvgXekpMJ8df0aSxbm8nKz1ZOJxeEX04uYPLwANS0tqw5xDfgi7ZPDa7cPCSm63t0fb/cPCJWrRpyEclotx2mauer8KQKxuDo/tgPNN0pFMjkq/kT8ggS8gIX4dGXieRcarwygAjprKscQOXAknYs6T2oH6LGIWzVYFQZjF7ki8dhB/p99u/w+MeQeRCWfg9Lj0P6p/DoByxvAa8HRwO70i3wgHsWHt0Ji49CcWbIT4SFe+HhHf97YAA9XN3o8/GBlAqERF9MnlVf9oWE2ziByIcAfAOOcBf5qm4JlZpQkfM0m6fLvCgj5IOb5G1wNBCkt1o1ReFFkRMEQZJkRXFH7zQOg5tlHeTh/dxgfe58+58gFx9sJj7+lzrbmHfZY4i/ajv68hC6V7DnBxsL4fz9YWZyuDY9zE4Pl598enEP598Bvzs+sLzq6DZoObDtRHDbw73t1Kfk47N07Cw9dZ6ZOl+Z/Lj4m1fY/Rr+DA/rfB7HC6IpAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 26 16" title="" data-src="/static/2021-10-25-16-26-16-a32338bd27e1f12d57173ada6a9f6b3c-b043c.png" data-srcset="/static/2021-10-25-16-26-16-a32338bd27e1f12d57173ada6a9f6b3c-e7723.png 200w,\n/static/2021-10-25-16-26-16-a32338bd27e1f12d57173ada6a9f6b3c-61f03.png 400w,\n/static/2021-10-25-16-26-16-a32338bd27e1f12d57173ada6a9f6b3c-b043c.png 539w" data-sizes="(max-width: 539px) 100vw, 539px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>带来的问题：拷贝文件会导致比较高的耗时，如何解决？</p>\n<h4 id="优化"><a href="#%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h4>\n<p>图片传输优化-平台共享 asset：Flutter 的 asset 资源被打包在原生资源包下面，通过 AssetManager 可直接访问，节省中间层拷贝耗时。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-28-34-572ed4c11670f9218ebcee083ee83c20-6a7be.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 524px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 112.97709923664124%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAAsSAAALEgHS3X78AAADWklEQVQ4y4WUC1PTWBiG85/dP7DKos7qgjIuOrhYa+uUFSwF2rrgjGVpK9hLQlqapEl6y7VNck4ubeoM0uyXFHfAZYdv3smcTN7nnO+ShEj+JaUOLrVxIMXzgyKpujayrFCOjcWBsX0obx8qW5/kzU/y+0K43jlSVN0gVt7Lqxn5yab0LC2v7Spru9qHz5ewaSHPxTSn3411H29I61k1lteeZ5T7if6DRK8vD4lHKQnI3zYGTzellS1p6U9pr6i4zuXJc/je686vqcHvafnFjgKexUTvQRLgEVGmlGNaLZES6IRWi6TMikMbIwuFMCwk1SyfamVKK5JaoSLBFW6PaW04MonpxJ36rucg0Fffm04c18HoSmCMJmPnq++C08YmGMA/GdvwiBBEsdfrc1yba/OdThdkmia6TsuywrCcIIgsy4lihxdEWVExxgRFUSzL1uv1arVGkmS1VtN13bIsMwrDMADv9rrFYhE8tVqNpulqtSoIgm3bhOu6juPAyorCRg42IDt7pJm6MsKmgwxoAByD4Slc3SjAH6ZtfQ9oEEZ2R2dpudxUv1S7h5VOoaGe0PJnXmtA9vMiIue8Gkz8WxqMxsVeqZ97w/6yxT/NiM93xBfbwmqCXTwQU7BvaIkCqpnrR7jYz8aYu2n+Wb4Xy3XXdzprcXZhX3wLsBVmj/ShQQkGJWJKRNdgGztNpVLopMtS9u9eBlQaZAvddH1whKO0AR4ZJtMdMT0TRFybCrIc20Om06RZjhEaVOuswcKta4+vmuDNmesHOKxoONQEod1us61Wk+c5XVdhcOimuArDKLyxkDuv379orpzTy9/o5XBBPhwzG9aVht0Eh1MeT/mt4MudgFoI2q8C7mVw+jCo/DQ9++M2ODrZ53dn9Z9n9KMLemnWWAoaj2Ejn0neCkftNBSkcCOJNSRG4ilZpNVOAw/7t9Ycne1OZAOfMjx5xpUqJOiEbBi2h29tGMI27vFeqzrmKEQfI/rE508nLGmLjIXw/8LWvGGuNyntzeL3vr1bvth8Ajp/tzx7s+Dvv7XwTTVb0dDh+8fh/87zy7kgsTDLrAb5V7Pc+mxvLUgu+h9TN8OMarU1q6VammEOsYPrR34uhnLJ0W4cZ+NuPjHJvXaP98PX+j/xD2Q0sX+b6Rz4AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 28 34" title="" data-src="/static/2021-10-25-16-28-34-572ed4c11670f9218ebcee083ee83c20-6a7be.png" data-srcset="/static/2021-10-25-16-28-34-572ed4c11670f9218ebcee083ee83c20-88dc0.png 200w,\n/static/2021-10-25-16-28-34-572ed4c11670f9218ebcee083ee83c20-98f22.png 400w,\n/static/2021-10-25-16-28-34-572ed4c11670f9218ebcee083ee83c20-6a7be.png 524w" data-sizes="(max-width: 524px) 100vw, 524px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="挑战点-3-视频在-flutter-里面如何渲染？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-3-%E8%A7%86%E9%A2%91%E5%9C%A8-flutter-%E9%87%8C%E9%9D%A2%E5%A6%82%E4%BD%95%E6%B8%B2%E6%9F%93%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 3-视频在 Flutter 里面如何渲染？</h3>\n<h4 id="背景-2"><a href="#%E8%83%8C%E6%99%AF-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p>采集视频流 -> 云服务 -> Android 原生 -> Flutter</p>\n<p>将摄像头采集的每一帧数据通过 MethodChanne 传递到 Flutter 中，性能消耗大</p>\n<h4 id="方案-2"><a href="#%E6%96%B9%E6%A1%88-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<ul>\n<li>外接纹理：可以将原生端 opengl 图像数据共享给 Flutter 进行渲染。需要原生 sdk 提供视频帧图像数据回调接口，实现较为复杂。</li>\n<li>PlatformView：主要适用于 Flutter 中不太容易实现的组件，如 WebView、视频播放器、地图等。给 Flutter 提供了嵌入 Android 和 iOS 平台原生 view 的能力。</li>\n</ul>\n<p>最后采用 PlatformView 方案</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-37-14-19e41ed726fc6e7309a1af4aa52450d2-c7bf1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 80.51643192488264%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAADQklEQVQoz02R+W/ScBjG+9f4mxqNRmM03le8M+8rnlPjMaPucG6KDo1XvM9Np5g5nVO3qVHnNlDoCmw4sIMxYMBGO6CFltJjQKHgyzBmySdvnjzv+37f922R786GZts9F2VlhPBH/HGbvXYinx3PPjueA58cdRP8uo/9j7rczch7/H6ducoeMtICWd9zUWO5PIErb6w331pvNdnuNFpv/PdfWa7U96ha+2uRVvvThr5reBDN5XK0EIqKVFQMA5ECQojkiBF2iIz5IVswCwWsGEFa+p9oLGo8iMnp5CBlcdNWD2110dZBqg8YCFt8USe8m87IHhp3UhYw3fmC3/7oAPLWduuxsRyaKZ54ZCyrNVe96L30srdG06uGKx5ipR/wB9AspuKwba3pHEwC8cRU8c52F/EzDhdtYSUqIUtDUZuXwX0M7qZtEP1svydqIzkPNGcUOcA5fSw+FME9EdzL/BlhB5FkMpdI5NLpnKLkQBeQxnJxPhthlbwQslEuyfIpmlWiXFaU8tnxrixy4Jp58Uldi57wkPy6SnTTeWyc7o3V3UXV6FYVtrPGuKvGtOWCsWjcgdTmC9jas+jpB31IURU2dV9nY0fAHeAXlehXnEFXlv5j2SnDmgoUSreojGsrupefNhSyq8rQhSX6Izd/IzBn+oGul1/9cFggLI5GJJKS/CHBHxRcgdhwWPTlBe8d5T0EByYwHBJJWgozErJVZZxzRNvwY5hix84/t6s1A9cbnVdfD9yA2OBU1TvuNbvTGUVKZG43udQaB2QhpXrheNrmQbZfNM07pmvSEnYfN3lPx8zirvnHdcCCE7q5R7VT93asPGMQE2mGTy49pZ9xsHNhiW7JSd2UvR0wFdlYjU3bV1g76x6J+0h+iIgPDnOgvQTAjwSFTEaB4XCUbzR/AgCCoARkm8o0+7BOk2/ORNgxlsvzXzCxsVg8kZFlJZvlRJkTZIZPwRYxAXQKWVVmmLSj/dU3v8PLzCjWzj32c3W5fn2lfk0FfFv9zGLtukpMFOE/J1eXo7MOaTecM6yvNEzf37lbbUbae0LvfhLuQJxhxZZfgTYDAXwajwA47ebRVDKVkhWobEXJL1gQaDGQur7wXxLO1Tmrl53KAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 37 14" title="" data-src="/static/2021-10-25-16-37-14-19e41ed726fc6e7309a1af4aa52450d2-fee1c.png" data-srcset="/static/2021-10-25-16-37-14-19e41ed726fc6e7309a1af4aa52450d2-a67b7.png 200w,\n/static/2021-10-25-16-37-14-19e41ed726fc6e7309a1af4aa52450d2-0b187.png 400w,\n/static/2021-10-25-16-37-14-19e41ed726fc6e7309a1af4aa52450d2-fee1c.png 800w,\n/static/2021-10-25-16-37-14-19e41ed726fc6e7309a1af4aa52450d2-c7bf1.png 852w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-a3e5c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 748px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 13.903743315508022%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAiUlEQVQI112NXQ6CQAwGuYURoe1uf3QRdFcJEQm8cP87WROfTCbNfH2ZivpnXfKx5MNY0iMrcwsAoSVGJBfAAICAEb6fgBh/+KyoLN245Nd6n5Zt2/Z9n9/zMPWXUdNk/ZocyxKMZGBOkbuoV3bXG1fEHuOzqqmoqoiYmYvXSCgo+fV4c2r+qZsP0NIajIijYeQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 37 41" title="" data-src="/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-a3e5c.png" data-srcset="/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-24e67.png 200w,\n/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-f22f2.png 400w,\n/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-a3e5c.png 748w" data-sizes="(max-width: 748px) 100vw, 748px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="优化-1"><a href="#%E4%BC%98%E5%8C%96-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h4>\n<p>用 oppo 的一个低端机进行测试，房间有 6 个用户的时候，第二屏画面渲染异常，使用 PerfDog 性能狗，分析出 GPU 占用过高</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-39-51-8916211809efbb3e44693b3498eeaec1-e0b49.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 21.508588498879764%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAn0lEQVQY04WOzQ6CMBCEeSHTFprSEggGSvkTxKMn3/8pxt2iEb14+DLt7LQ7SeYGKHeBdBNkwTqT7pj6hirccZ4fkay8QvCcs5F5f8PYHsp4JLqYkLkVMu+iecTWW0TkASfdUob9gTR8Z/nuRgg70oflitQtkKYh/IsWihao3EPoJm7m83v2yR3yVMxUy95QU31lO6Q2HOipef/j/WPEE/xDh6U7UIgnAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 39 51" title="" data-src="/static/2021-10-25-16-39-51-8916211809efbb3e44693b3498eeaec1-fee1c.png" data-srcset="/static/2021-10-25-16-39-51-8916211809efbb3e44693b3498eeaec1-a67b7.png 200w,\n/static/2021-10-25-16-39-51-8916211809efbb3e44693b3498eeaec1-0b187.png 400w,\n/static/2021-10-25-16-39-51-8916211809efbb3e44693b3498eeaec1-fee1c.png 800w,\n/static/2021-10-25-16-39-51-8916211809efbb3e44693b3498eeaec1-b1a91.png 1200w,\n/static/2021-10-25-16-39-51-8916211809efbb3e44693b3498eeaec1-e0b49.png 1339w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h5 id="列表懒加载与回收"><a href="#%E5%88%97%E8%A1%A8%E6%87%92%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%9B%9E%E6%94%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列表懒加载与回收</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-42-26-a38acd0a99ae1a8b77f59e69a30dcde9-29486.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABy0lEQVQozyWQTW8SYRSF58+Y+B+6cGVc2+jKlTExbrq1uyZG/QVutElTP5uoCTWitk0sRFAsLa1AqEyH+YKZgZnhYwYYBiHA4zB9k5N733Nyz809wp2POte2atzckVndUVjZlLibqAMLzBdJlI1ttCdv0J6+RX30ksazBMxhtfCVK4evuJFLsJL9wNXUa64f7SJsfDd58Enn4V6d9f0693d1Hqes2NBOZKg//4yx9Q1ze4/GZpLm+1RkuGD9709u5ZOsFVPcOz3g9vEX1sppBG84wQtm9CJ0BlO6g+V/Es0smPZHzL2AuX+JWW8YcQGLSPPHI3r/AjrjIKoj/EkYc4Le8qgqLcpiHcXoYrgBS275+pZDsypjSyqtCxW3pjNourFm9NpUdJlqQ+VcVyjJIqrTRGjYHoWSxGEmz6/jMlW1RdcbxkNmZJRPZTjL5ijl8vzJ/sZumJdat02+UuTHyRGZQj6G1rYR2tGZmuVRkYwYetQfXPicWgFBy6FxLmGJCo6kYYoyZrpAWLPoTENk26SiyYiGhuJYuOEAwfVD3P6UznB2iWjBuzOXfcmHIIxzW+a4rIvhmF66iH8ixobOqE8nyrE9HsZmbtDnP9pF7FqJ/CwHAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 42 26" title="" data-src="/static/2021-10-25-16-42-26-a38acd0a99ae1a8b77f59e69a30dcde9-fee1c.png" data-srcset="/static/2021-10-25-16-42-26-a38acd0a99ae1a8b77f59e69a30dcde9-a67b7.png 200w,\n/static/2021-10-25-16-42-26-a38acd0a99ae1a8b77f59e69a30dcde9-0b187.png 400w,\n/static/2021-10-25-16-42-26-a38acd0a99ae1a8b77f59e69a30dcde9-fee1c.png 800w,\n/static/2021-10-25-16-42-26-a38acd0a99ae1a8b77f59e69a30dcde9-29486.png 1106w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>列表优化后 GPU 占用从 72% 下降到了 53%，视频画面正常渲染显示，优化完成后的性能检测如下</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-45-55-c59a9220f3201f2a2cbde008772fc579-1ef31.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.72275054864668%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA6UlEQVQoz2VRDa/DIAj0///Mly1vabvYrFo/QO+BzrZ7I7mgnHCAZlkWEBFqrQ1X6zEgpowYI5gZpZR//AnljRJ6SCm1R7v3mKYJIYQjUYuMQlX8PE/Y9/1TXOIqakZCzhkkhZ0PmJ8Wm/iUCZlYIDxLgtyDdPu0a+OJK0LMSO0Nt0mNdna2XD5U24gSL6WPrsJ8GVnjmqO+o8BYa48dqmXpwsvYGrtaYWoCas65L37Y1w7dtuJ+/4F3r/duWJBFPTWvePzesL1WlZE7ddQuZsa4qtg7GD/dY/1DuC29CM9MB69xvavvZ8Yf6Kwn4srDybAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 45 55" title="" data-src="/static/2021-10-25-16-45-55-c59a9220f3201f2a2cbde008772fc579-fee1c.png" data-srcset="/static/2021-10-25-16-45-55-c59a9220f3201f2a2cbde008772fc579-a67b7.png 200w,\n/static/2021-10-25-16-45-55-c59a9220f3201f2a2cbde008772fc579-0b187.png 400w,\n/static/2021-10-25-16-45-55-c59a9220f3201f2a2cbde008772fc579-fee1c.png 800w,\n/static/2021-10-25-16-45-55-c59a9220f3201f2a2cbde008772fc579-b1a91.png 1200w,\n/static/2021-10-25-16-45-55-c59a9220f3201f2a2cbde008772fc579-1ef31.png 1367w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-46-25-68d1780103ea2b3de02f737fcb22c303-ef045.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.60795454545454%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABsklEQVQoz2WRWU/CUBCF+2tMEAtVymqVRWhBC5W9Ci5RXB/01b+osqhRedEHo0DYgssPOM7tRUV9+HJm5pzk3swI/X4frVYL6cIOlIiBkJpFkBHLkOZIqY6mEU+VkcpXoCVLUJNlLCWKPMP8GM+H1QyEZrOJh4dHxFZM2GUVTt8yHN44HEz9K0SS0CF6E5jxaHCS540U4FIMnhkj0nw2oEN4e3tFu92xXpgSFUzPBjEtLRI/amO1NQ9++zbnwtjnsAx7TBiNRuh0OtiqnGI1v4OsWUGmyNi1NMswv/pdq86t7ZHu8bnJfbYy5gvD4RCDwQCNxg3OL+u4rDZwUa1PQD3Na/VrNK5vUa1d4fyi9ifHM0yFj4939OgwRm4bkicK93wcckD7hcuvYj5s0CFMxPQyAiEDsl/7l5MpZx3l7v4eenoTdlcUki9Bu6Dl++I/Sjg8KkQ6intxFbKSIk/lvpcfiqnEjjLodfHy/AJNX8PUjAL7XIQWH/7PXNjyGDYpRH3Ewj5WGyG66YdP/Ve0uj0cn5xZyzbLhygQRcIcU5zsN46Qn5il1w+RLbH6AIXSPj4B+jGDR5XbQDAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 46 25" title="" data-src="/static/2021-10-25-16-46-25-68d1780103ea2b3de02f737fcb22c303-fee1c.png" data-srcset="/static/2021-10-25-16-46-25-68d1780103ea2b3de02f737fcb22c303-a67b7.png 200w,\n/static/2021-10-25-16-46-25-68d1780103ea2b3de02f737fcb22c303-0b187.png 400w,\n/static/2021-10-25-16-46-25-68d1780103ea2b3de02f737fcb22c303-fee1c.png 800w,\n/static/2021-10-25-16-46-25-68d1780103ea2b3de02f737fcb22c303-b1a91.png 1200w,\n/static/2021-10-25-16-46-25-68d1780103ea2b3de02f737fcb22c303-ef045.png 1408w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由上图可看出，cpu、内存跟 Android 原生的占用差不多，GPU 比 Android 原生性能还差约 15%</p>\n<h5 id="视频帧直出"><a href="#%E8%A7%86%E9%A2%91%E5%B8%A7%E7%9B%B4%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>视频帧直出</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-47-42-57ed338e2dbbab82fac446a0814eaa23-0204f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 70.8478513356562%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAADL0lEQVQoz21RWUwTURSdaDTGDxJj/DLRD+OXMYoa/RCXaNCgMYIhQqGKIpGgttqigksUUCOBUFoWFYwRMCoYo8ZEwc7Q6QJiqV0U2s50ujADbadobTt0w077nFHjly8nJ/edm3PvffdBolbjfqnmrW7G6g4drtUV3Rw7euPjb/CBoG5M2DBWUv9P5HVOzLuo7Rt0Q4L6T+tPwP0IZSFC2yqHd4s1u0RqjneK1Dln1fuqtYev6A5e1nLXHefUHO8Sa/Ze0Gwsh++/dkLCW/otFUjfoAeADE5FXF7GOcNgVMQ+FZ5wBR3TEdtU+KsrPOkOTbiDOBnBpsLEDENMR76FE7x50ynkKUz6v8dv99ianmGtA3hLv51jWT9+q8f2DCYBACQda3xil/VjsgFM/gKvf2xFjQHenF2ODKgoMx7MPjGYU6Xcdx7JPY/slyB7RcjGssHTjWMApA1WemvF0J5zcJ4UyZMOrxO+63iJQaUN+uxTw7382ADzsc4A6/Cz1pmfdl8K96cwb5IMprhUbD6D+1mc5lOcjtPp2XAKKrujzzmD9MK+DPUZby50KUrccoFLISBaiwhFqbOz3NFWNtEitLaUOmRFRGuxU17sbhMSjYcCql7evL0KfqKajZrffjgAoQULVfkLOEY5LlyiKV2mFmRphcs1xVlowSK0YDF6ZDFauFSZC+GPLv0d+/F7D8gko7Q/MUtziNPeGO3j4fOGKE/IM8mQ1jnKHqHszLQ97sXnSGt81ssvbHMF3DvkzTCTNrXIoZMQI9VOfR0+WoPpJDa0ivzSyb85lWFSIMaCWBokMoDldvgz9eerlH3KQNyrRNpXaLpWartXj/Rs0D1aq+1epepYZn6Tn86AH8zc93A0xMTCc7FINJ5IzKeSSej4nfGtlaqe926uFptOAJDkkGYZrtmfGIB58L/Dcp3zr46uKR7izAQVOnbbcLrZJFaYqzst0nbLGZm5pGFc/oIg6ejJu+Mn7xrEcqO0w1TZ/LmoTj8Au6Hm55hYYdGYA7gneLbFIG0z1t4zXe82X+8y1XSaqprGu145KB8jURglbaZrDyw3Hlqq282VTYbXqOcX4CtIago4HQQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 47 42" title="" data-src="/static/2021-10-25-16-47-42-57ed338e2dbbab82fac446a0814eaa23-fee1c.png" data-srcset="/static/2021-10-25-16-47-42-57ed338e2dbbab82fac446a0814eaa23-a67b7.png 200w,\n/static/2021-10-25-16-47-42-57ed338e2dbbab82fac446a0814eaa23-0b187.png 400w,\n/static/2021-10-25-16-47-42-57ed338e2dbbab82fac446a0814eaa23-fee1c.png 800w,\n/static/2021-10-25-16-47-42-57ed338e2dbbab82fac446a0814eaa23-0204f.png 861w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>性能消耗点：视频 view 的每一个像素流经附加的中间图形缓冲区，显著浪费显存和绘图性能</p>\n<p>优化方案：将视频帧数据直接输出到 SurfaceTexture 上</p>\n<h5 id="图像纹理共享"><a href="#%E5%9B%BE%E5%83%8F%E7%BA%B9%E7%90%86%E5%85%B1%E4%BA%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图像纹理共享</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-49-34-6b403d29c0bdafae8febe4f7830acac4-7e9bc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 74.94089834515367%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAACt0lEQVQoz31S7UtTURi//0cQRP9BBEEUZvWpPiRhSPRChBUSakFaabpejGb5wcIyRIUgbepwvSi56abztc1YGTa1NbfrTffSnLt39+3cc849nbMRWVQPzz339zyc33OeN84XcTV7LnVM32qftnRO36b43bJT1sWnEzXtUxbqbx2/LqS/EkKMbEqd6VZm7Yq/T515ATNxzr3YV+U40ugsu+8qezB8scpRNLzQI6lpy+DJe87zVueF+oETi7E5SgaZuDT0UHS3ie5W0fkIpASOEJMqwjCjKAAaedMkJsYmRBBAaFJADdNkHyHYJIj+GDA5RHnQ1AFKiZqiIwRNhMzcNRYD5QCiZHoaGoyHQCykrYUoQLrCdbmi+yu9pxp8pVb/6Qbfwcvjba/DucCUTDPCEGFFBwATI72W7asVX94RXzVI9jqQiHDeD4n6js9NtqXGrmCTbdHSGXT5Y5QMEU0bA4gyspbcyKazGtRVXfgs81TnNSGINJnDGBNWIV6XVAMiliyzcmX9FFYt64OpE7KOmBq5vLjOwfCO0pGimsniuqmjtZM7z7lb+kPAgN0jfI9nxebmbSMrQlJmuWgyiAa0SEBdDlAAVYnzB1PN9lDH4HLbmzA9m+1ffAspISEXVowdqvIervYWlo/OzCcpWV9flXprxP6bTHtvsJp1AGXVyKpGWgKiYlBMnwUGEpJqNCZHYrKQUGXNoG3XNU2JR5V4RE9G9e88pN1+4ghtK3m7r2L0QKWnoNyz/fiQtWuB1fl72XkPbQ/ObwJhU+Q+hTeeu3jH+GrvmNDv/dY9zAeW0vlRYTaqXKd+RTA3KeHy+/CH5J10ThqA5N/CrXmezV7ZNWct/thYMmc99r56Nz/wmPExklSdDvl/5JWBlokzW/zVe/zXCvxX906d3RrquUvfhXRp/5bUZvkBmdwGtUM7JlcAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 49 34" title="" data-src="/static/2021-10-25-16-49-34-6b403d29c0bdafae8febe4f7830acac4-fee1c.png" data-srcset="/static/2021-10-25-16-49-34-6b403d29c0bdafae8febe4f7830acac4-a67b7.png 200w,\n/static/2021-10-25-16-49-34-6b403d29c0bdafae8febe4f7830acac4-0b187.png 400w,\n/static/2021-10-25-16-49-34-6b403d29c0bdafae8febe4f7830acac4-fee1c.png 800w,\n/static/2021-10-25-16-49-34-6b403d29c0bdafae8febe4f7830acac4-7e9bc.png 846w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Flutter 与 Android 原生共享图像纹理数据，优化后性能检测如下</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-50-37-df4c94beddce1927f5634e640bbc0e14-35f69.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 736px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.82608695652174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4UlEQVQoz3WSzU8TURTF359hDAktrf2g0K/pFJjOtJEaYwJtJ26NSAuCCSltx7YOHxXoVESNbMSExBVLBTSKaxNX/lnHe2emY8W4+OXknnPf5L17RyytbMLcGaBt7mP1iYHqWhM1l+rjBtY3umh1+2i091Bbb3nZKCvkL9XqeP32BMIfmYVavI/cvI5osoDwtIpwPI9womBrlHRKKiKWnicv72Rxzcndms/5o3NYXm1AxOU7kNQyksoiMmoJmXwFGa3sqcSoi5ByC1Rzrjtwj00JMmlKraDe2oG4MZ5AIDoLfzgLX0gmhir/p/7X47NjAQkPa3TDj+dfcX75DZ8uWK9w+eX7X1x8vrLhHtbr+RA+/+PnLwijuwfr5TH6h8fo7R+hs9VHl9nuo2MeoHfwBi9encA6eoet3qGTXWfbwlP6zumHMwi+qnK7DK2oI5ktuk+YsZ/BTNA4gpMKEtl7iBOByTn43Mzriczg5kQaD5Y3IKazd2noJaSUBaTV0p+B81IISePlVCCTL3mLKI8sT4dc0JHSdNSNXYjxoIQI/SqhmIIgQzdgbsVcuCY/NKV62ShOXw4++v2qawbEo80emuYAzWcWzc+BZ2KYlu01zaE3sH1m2MPaorzN2nmO96dn+A353JGw9E+/AQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 50 37" title="" data-src="/static/2021-10-25-16-50-37-df4c94beddce1927f5634e640bbc0e14-35f69.png" data-srcset="/static/2021-10-25-16-50-37-df4c94beddce1927f5634e640bbc0e14-0149d.png 200w,\n/static/2021-10-25-16-50-37-df4c94beddce1927f5634e640bbc0e14-cfc3c.png 400w,\n/static/2021-10-25-16-50-37-df4c94beddce1927f5634e640bbc0e14-35f69.png 736w" data-sizes="(max-width: 736px) 100vw, 736px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-50-56-70e3f40f36a6044578648c9e0934f92f-0506a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 470px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 94.46808510638297%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAADHElEQVQ4y41TWU8TURSeX2WiMWwRWQRlMRoRkcT4wAvwpoZFLGsJUHYiPBnjCxi1BTUx0WgMBQoGUkpn7kzpLPfemWmn7Uw7LQ8+eaYthMS4nJzMTO7c737fOd+5jCiKwWBQ0zQ9ZpxlLG4k/iOYwotSalvJk0wql8+MlUok/x1FsKapH3fIqy949Rt++VnxH2p2OpVMpv4ejCTLh6EQVuSORb6kh6sZ5C4+ZsfXjk8yhhYz4kYxfw9HNhxgpdOqSrtXhKsu1OhG5f3s9DvxZ840U47+QsI36AAtZ+kwx+NxFYKSrhWh8hlqGENlfQ74xE4JinGMnYxgI2Yk05Zpp4uZsUwHrCgKy7KKLHUu8wVwaR83642Kit4yJdyZFFo9QrOb/36AMdXhuX1I/EESOCLgCGNaVjabhYZ1LQunYHZhXZKpUTuEagZR3TAq6+cCYfX9Nq3oZ5vd6NoQap/lqW4wIBmspgQD+MoAVz/igOd9okTi10dQ/TBqGEWwvntE17dIeR/bNIZqB9H9GZ5ocQYcFoQIxkrnc75miG+fjZT1cXM+UcQx4AQSOKLiKbcTIj4/Lu3lGsdQtQvd8/BYjTGWZeVyOV1TO5eF2iH+wfxxeT83vy4pagLAoBzIAbzHahvbtKSXBWlVLq5tmlf1BIMxQQgRopzK5kp7HdkiiQPt7UmhbcY5LnBEgRnALZ5I3TDf6snLhqmWZZlgpdCwxrFizQXZN0bRzXEBmAOhAph7uBhtcgt3p5ADNk3Ttm2n26c+A/PCedkjf5YNDQuHwWe565zPc95oVNHPN2z7EHs3lWLDBvMNozEGphSUE4y7V/gqF2rKj+dCXvaZVZUDUDNZ92MovmjVdL5mZ7YtS1NpxxJ/uYetdnEXHoVnvJKsJqB/MBWVA+ylJ2wgrHn9FH7BBpB2awKGJOEwh8Nh8PnFJ3HijTTnk0bXoh+2ZEmhU2/Faa8065Pdr8UQj7eCeHRVnPHCNnFpQySqDsxJwMPNPsla0Qi7tfkVS0LOTsNKNp3Y39/7seu3kjpchEzajKlS8GCXPTqwLQMk/wKJIGBhC7KEzgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 50 56" title="" data-src="/static/2021-10-25-16-50-56-70e3f40f36a6044578648c9e0934f92f-0506a.png" data-srcset="/static/2021-10-25-16-50-56-70e3f40f36a6044578648c9e0934f92f-8fcc1.png 200w,\n/static/2021-10-25-16-50-56-70e3f40f36a6044578648c9e0934f92f-a271d.png 400w,\n/static/2021-10-25-16-50-56-70e3f40f36a6044578648c9e0934f92f-0506a.png 470w" data-sizes="(max-width: 470px) 100vw, 470px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Flutter 优化后 GPU 性能提升了约 10%，基本能达到 Android 原生 sdk 的水平</p>\n<h3 id="挑战点-4-客户接入如何提效？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-4-%E5%AE%A2%E6%88%B7%E6%8E%A5%E5%85%A5%E5%A6%82%E4%BD%95%E6%8F%90%E6%95%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 4-客户接入如何提效？</h3>\n<h4 id="背景-3"><a href="#%E8%83%8C%E6%99%AF-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p>面临的问题：原始 SDK API 繁多，客户接入耗时很久</p>\n<p>场景化方案的价值：客户可以寻找契合自己业务的场景方案，参考源码实现，提升接入效率</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-53-24-55bca3f05b463ad9732bca306eac99b4-160dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 737px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.404341926729984%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACPElEQVQoz2WS3UuTcRTHB933f3TRlQm9aLqJ00cpISPMm27qIokg8yaLIqRuggSzuogSutCLgkyD3SRCwzWXc85NN51bytK9PWN79uK253nmp9+ehyjo/Dj84JzD93y/5xwLwo6OjhofqVSSSCRCKBRmYzNMLBolLWJ/TJazrPn9BAIB/Gtr+Hw+llxuVryruN1uI25pgDWertVJJdLIWRmlmKNWlglHf+Lf2mM/W6KqamiailqrodfrNCjURAxUKtUy+eIhuq6ZgAa7eJb4TgIlWyDk/cWcU+FrqIRvXyGWyFGuaqKpatTWDitk3rziw/AEF57IzC5loF41cgZgXXRsWHa/wuuRLzwcmOKYFKG5f5GCy2nqFTWaplEX9Rv3HhBsOsmE7RYW2wGW3gSffZoJyD8263jL4+vPeHRtjhOXV5lpHSB89QrVYtmQ2Gib83pxt7SzLdmY7Bnh+KUdrG3vmR59ZwLKhT0SuRDpfIwp1yDjix08nbzLdO8QIbsNT2c3SiBokhSeXljAc7aVdUliwd6Po3uQcPsZYkM3hAIdS1qJopRTYsBlZn7c5sXHVpw37QTtdlY6u/Bd7KOSTBmAuvByPI5X6mXF2sF6j0RQ6ub7qdNEX7z8X3Js18m3PiurTW142qwsN4vC5+Oo1SpqsYimmks5+DSLt0sSTFtYPneezTvD1PL5v0sx3VxM3uNle2yMrdH7JOfnkcVtZYMbKLu7aLpOrVSimMlQiMVIOhzISy7jlIwZi/xvgilbLHjBNAYAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 53 24" title="" data-src="/static/2021-10-25-16-53-24-55bca3f05b463ad9732bca306eac99b4-160dc.png" data-srcset="/static/2021-10-25-16-53-24-55bca3f05b463ad9732bca306eac99b4-fc7b9.png 200w,\n/static/2021-10-25-16-53-24-55bca3f05b463ad9732bca306eac99b4-cea17.png 400w,\n/static/2021-10-25-16-53-24-55bca3f05b463ad9732bca306eac99b4-160dc.png 737w" data-sizes="(max-width: 737px) 100vw, 737px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="方案-3"><a href="#%E6%96%B9%E6%A1%88-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-54-30-a142a79e0e4815c97d5b6c72f65f8d9f-160dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 737px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 79.78290366350068%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAADeElEQVQ4y1WSaW8bZRSF/RuQ+Bf8CH4F3/lQSgt8ACS+VQpUAoEEBSG1hYq2WZo0VFkqJNJWQJvUtZ3FS2axx54Z2xkvSbyOt9izOA/vjFNULB3de86575nXcyfS7Y0oHHXJlbvkRS1W7ZBrguuWjVmxwz5AUfSB9uZs/uJs4cimetIj0umNmdvQubqo8tlKjpWXNdFnef+uzPVNgzv/VLh0X+HyvMrd5xWurel8MK+Es2vxYz5dznFFnJ1bN8QD+rPA65s6Hy2pfP5Q41HshE+W81yaz/H1H0XuvahyeSHH1SWNhZ06X26YfLiY44vfCzzea4TBVxZUvtowKAWBXRGomj1kAcW0kXIVUqpFUi4jF5qoeoMD0SflIyStJrSAH5FSLDFrIRsdlGIfVaBcu7hhvtzHsIbkS10S8TgH+7skYjscKkUyss5e4hXJg1329vaFZrIbj5JO7hOPRckZDYzKSGQMLm7YH4sX2kevDEXtkRYBablA8lATtztGLdRJSVqoZUSY8gZPSXm0UkcsahhmhDd0HRdn4gt4s+pM8dxzXFEdZ8Zfw/XADTxRPR98f8YddxrWieMRGQ1sesMm/QCjVtg37Qad/ozPtAajoc1g0hHoMhh36Yw6tIftGX+NMztYyilmR8FsB5AxWgqpisphTUZvSaFW6mRp2XWKwjOEVmgckrQkUpaC3pRCTW9msNoGkX6vxba5wZr0MxvyLZ5oi6jHCR4rt/kze5916SZSPUZ/0CFRfspWdp5n2gOe64+Qj2Ni5l4491j5BbmaEIGDNn/pqyylvmMl/YMw7pCpRXmYucGm8ivLqe9J17bDwBf6Oqvpn9iQbodzqeq2eOCtkK9mfiRtRYnYdpNSU8c4yQlkKZ7msFoBF39HwAi5SdduYXVMzGZWIEe5lafaLYnXkBdcC1HvVog44zN8Z4w/OWMqthVszvNmG5yKOhWeJzxvMoRz/vc7D/jUvRj08N2J+GzGLaa9JNOBin+yhmfO4Ze/Datn3WTal4SfEr6CV3+AZ1zDK34zq9Xf8PsKvp0KM5yeRsQfn0I3CiMNX/sY71kEZ+ct3L8jeIl3YJAB+xUMs/jye/iB//LtcM5Pvhuew45BL45ny8FSWji2givSJ+09xsdbjE+eCmxx1thmYudw7ezMb8WF/uQ/f9yMhroT+LbK2Db5F4hsbHxT77x9AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 54 30" title="" data-src="/static/2021-10-25-16-54-30-a142a79e0e4815c97d5b6c72f65f8d9f-160dc.png" data-srcset="/static/2021-10-25-16-54-30-a142a79e0e4815c97d5b6c72f65f8d9f-fc7b9.png 200w,\n/static/2021-10-25-16-54-30-a142a79e0e4815c97d5b6c72f65f8d9f-cea17.png 400w,\n/static/2021-10-25-16-54-30-a142a79e0e4815c97d5b6c72f65f8d9f-160dc.png 737w" data-sizes="(max-width: 737px) 100vw, 737px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>核心目标：易接入，开箱即用，降低客户的接入门槛</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-55-38-dae4765a45c8e8fdd83f15a436abb8ce-787fb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 720px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 100.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAACOklEQVQ4y3WUC5OaQBCE+f+/LVdKkIC8QUEWUUDN+Tq4fLujVZeL6arDZZme6enZPet+v0/jNH6MHwbjqBfb7VYptd/vfxucTqfz+TxN0/gFEK1hGLq+u1wucO4GRK9WK9/30zTtDbpOB3z+DfjWRqM6Ho8XA4pQFtpsNo+iCNreQMjTF1DMWq/XQRDymTiKtG2LlrqukyQhK+I3VcUrSXe7Hc93A3IRbFHzcDi8PyHtlWXpOE6WZehPU52FsCgMncViuVySkQI8rbbdNo0izfV6vd1u8ImjlO97QRjmeV4UBXEYEYbh24+3OI5RSQzdWVVV8RnZ1GcL8fwqVcdxlCYJXaClHwaekO25HQQBMWKNRVbSU3kw4AOyyeg4CwwT5XTBvPDftu3ZbIYuhGgyP2cDcZsF4mmS3lCI7Tgn0b7n2fbcdRfQHpX5IKOSOUsidjQ5ios8HwZU9UQj2PmJZYs4Th5khGEMvck82cIzdKIQ2bVSMg6iebUNsjR7kCminhFAbGfT8zxNrmvGK+RfGi4dibWaDEva/tYz3iKqaZrhoI0khuPEKwshI9Pa1Jtm21CNq8FxlRRySGgH280B7V4fT8zECZTvdjTesqBnOEZ2XKwKErH5+mLQErM9PoFCZEOmYeaUm/ODEa/JDAIOBLmlLIiDjDmIqsyt+O+VTDN9DCgolaVIVZau6+IZllKZdl6TMVDVqn+CIvw7Kcs1hwE+ZxM+Ma/J/H3+A0ZFw4xKbhVPRvgtBrf/AB+fXD7+4uBqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 55 38" title="" data-src="/static/2021-10-25-16-55-38-dae4765a45c8e8fdd83f15a436abb8ce-787fb.png" data-srcset="/static/2021-10-25-16-55-38-dae4765a45c8e8fdd83f15a436abb8ce-4591d.png 200w,\n/static/2021-10-25-16-55-38-dae4765a45c8e8fdd83f15a436abb8ce-bf018.png 400w,\n/static/2021-10-25-16-55-38-dae4765a45c8e8fdd83f15a436abb8ce-787fb.png 720w" data-sizes="(max-width: 720px) 100vw, 720px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>SDK：接口不超过 30 个，而且语义更加场景化</p>\n<h2 id="未来"><a href="#%E6%9C%AA%E6%9D%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未来</h2>\n<p>flutter 桌面端的支持不太好，未来需要支持全平台</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-a166a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 30.82644628099174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABeUlEQVQY0wFuAZH+AL/Rv9Dh0Y3IjWK1Y2m4aWu5a2e3Z2u5bW26aK/I0XGa3oCl3YWp3mmW2cHQ5sG+uqeoqbe3t62traioqADJ4crV6thmuGcdlx0pnSo4pDksni0mnCcwny/F2dDX4PXV4O7Y4vDQ3O/h5uzm5eTj5OTn5+fk5OTh4eEA0OjR1uvYc710MqAzP6U/TKxNQ6hEOKM5Q6dEzt3P5uHh4eDc6efk4uHd5+jo6urr6urq6urq5ubm7e3tAM7o0tXs2l+3ZReYHymfMCifLyqfMiCbJymgMMDTxM/Mz9XW1c7Oz87Oz+7r6dra2sHCwtHR0evr6+vr6wDR4Mrb5tKex450sl59tmeHvHOAuGt4tGSBuG3R2tDX1tjf39/e3t3o6uzT3eza29vb29vj4+Pk5OTl5eUA2c2r7uK9/9OH/8Ji/8Vp/8Rm/8Ro/8ds/cVs7ebY8fL17+/u9fTz7vH3pr/j8PHy/Pz8+/v7+/v7+Pj4q2oDoKJ/umkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 57 59" title="" data-src="/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-fee1c.png" data-srcset="/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-a67b7.png 200w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-0b187.png 400w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-fee1c.png 800w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-b1a91.png 1200w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-a166a.png 1210w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-59-11-ab70bc1e59b90cf47b4d610e8182888a-3be6a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 726px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 80.57851239669421%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAACy0lEQVQoz22Ny08TURTGZ+3OnW5MNHHhzo1/gHGhLDSykZiYGBewIsSliYQEMCgkqNEYgwsRDVHeVMq70Eo7LRRKH+ljptO5007bYe7cmbl3Wlo0GvXeGo0Bzv3l5Dvfd04ut1VY98jj62DqEF5l2gtmGkwfTdfAZECZ59zZ4beprvfpRyPp3n+8S/eMCv1j4uBYdnBUGBhJ9/yfNha6JzIvOEGLx8p8vBw6QnC7EAzn+cQxUShWDqa0CGfoCGrHgPZMVaUgpJt/TYOCGp2xhzigAEEUxKx4iFxOkuVcrgFzREGQQEbKJzKsZyRFkrKczQofBWO7rFuaQRVbMJFdkT21zChJTdeE8aroMg3EEWw7R6BmlbDjMmTCwRZ93zLDv6LdP5Ivf8b7vyee2SbiVIhVSEoGKUKS11lXG1BH1UlBZ4KSL5sFHZcgFvJI3bNUHSslxMXUqgfUl+TaGqjz+foqqNPRpzDHX6hvFuvLcm1ZrvNy9YtysAK+rjbwKgfbss1F1MolDzmziC+u4FfJ/VNufGEZX/Mx54rPeRCpnF3Ep+fJwC5p8pETLvvcEj45h88v4Bg9jqqV+1tO2yZp3yITYrV1k3SEnc4IdZyHEed1stIaIvdC5EOSdO6Q5g18N0haAqQtRKLA5kzTqtiWY7FOq2IxTRoj1M2SZlbtRgShY5s1bNFx37aqlgkh5OSCJatEKTKkAqYAFcsMIip2jo0E0AiYMtVF8ge6IAHEJbKmizc+eeFHL9yIWp4dcyZguALGwhYKp7F7E80GjCm/wUeNlTCa8sMZP5z2G+6gEUsb7Lh9SGnuz17vE0fX9L6x4o3HYsug1D4E3CF084l453muqVeY8modb8Dlrsztp9LVHuHWgBhPIy6roNVtfS6ozfDadtrwx+BsoPyZ16gZE+i32lxIc/HabkpfC2uTvuKsvzzrL83zJVHSfwMn4Q+UVTw34QAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 59 11" title="" data-src="/static/2021-10-25-16-59-11-ab70bc1e59b90cf47b4d610e8182888a-3be6a.png" data-srcset="/static/2021-10-25-16-59-11-ab70bc1e59b90cf47b4d610e8182888a-0aa07.png 200w,\n/static/2021-10-25-16-59-11-ab70bc1e59b90cf47b4d610e8182888a-92365.png 400w,\n/static/2021-10-25-16-59-11-ab70bc1e59b90cf47b4d610e8182888a-3be6a.png 726w" data-sizes="(max-width: 726px) 100vw, 726px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="腾讯文档渲染优化之路"><a href="#%E8%85%BE%E8%AE%AF%E6%96%87%E6%A1%A3%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96%E4%B9%8B%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>腾讯文档渲染优化之路</h1>\n<h2 id="dom"><a href="#dom" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM</h2>\n<h3 id="方案-4"><a href="#%E6%96%B9%E6%A1%88-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h3>\n<h4 id="sheet"><a href="#sheet" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sheet</h4>\n<p>使用 <a href="https://github.com/handsontable/handsontable" target="_blank" rel="nofollow noreferrer noopener">Handsontable</a> 的 dom 渲染，主要页面构成为：</p>\n<ul>\n<li>单元格：数量多、结构类似</li>\n<li>图表、选区：数量少，结构独立</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-13-56-57-d0262b250ea2c9ec6f412bf6f63d40f6-6f1f8.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.457925636007836%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACSUlEQVQoz12SSY/TQBCF5/9z4QQnDkjMkQtcQCwShxFiEOtMEiYzcRLb8d7uxXsS56OScKKllqurq59fvVcXXddT2QpnHLWraVxFZSpsaSXvTne1sXRy38m5l12XmqooabWR2NJoqVWavmm5cFlOnRa4rMTEitn3gCLIyP0cHSmqPKfxloxdx8LboAsN4w638gkCxeRece8bFn6BSZUApvJQWeLEsoksy5WS2JBmlrVfEmwMau4BB75OfW4XMf12h1pG3AnQzdrxbW749SB1cXkGNMqQCUAqoDe/YwJfsVoWp62Uo1n79MIwCGLmCx+lRYowOTG7nip+3GvmocNk+tyyEYZRbAhDw8N9ThRpstTKWZPI13lrKtFXi05tXbHbbbF+xENguV05fj5YJitLmegzw6MBee4ExDGdpoRBKeyE5aqkKMQwb8V2GNjvR9q2Zz+O1FF6AjwxnGv++P8YmiSjFKETQQ8Dzd0sIdqUIoEhFqZ5brGLM+D2cGAQLcdxj5P2jy3fhK3sjtn6yFA0bMR+fWpZtpgyuRNmocVbFHje0SDRyxMNZXTUrxnJm0/o1ND6AdlGHP7wneW7L4Trgkqm5WKQwipOsXFGsSlYfPiGvplRxgX5KpGinEFGR29H7MdP2EePyeo9nZN34r17+Yrm2XMaiYdW5nAUPYZ+oK9bekmOly/YvnotrUEnuePgD+Lw8W57fc3uyVO64+O6OefevGV4cXnK7YYtF/y/Pn+Gq6v/kofzZzaF9+/PsRA5rckE5EfnsgN/AfO+N9y+lifLAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 13 56 57" title="" data-src="/static/2021-10-26-13-56-57-d0262b250ea2c9ec6f412bf6f63d40f6-fee1c.png" data-srcset="/static/2021-10-26-13-56-57-d0262b250ea2c9ec6f412bf6f63d40f6-a67b7.png 200w,\n/static/2021-10-26-13-56-57-d0262b250ea2c9ec6f412bf6f63d40f6-0b187.png 400w,\n/static/2021-10-26-13-56-57-d0262b250ea2c9ec6f412bf6f63d40f6-fee1c.png 800w,\n/static/2021-10-26-13-56-57-d0262b250ea2c9ec6f412bf6f63d40f6-6f1f8.png 1022w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="doc"><a href="#doc" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>doc</h4>\n<p>使用 React 作为 dom 渲染</p>\n<h3 id="优化-2"><a href="#%E4%BC%98%E5%8C%96-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h3>\n<h4 id="渲染管道"><a href="#%E6%B8%B2%E6%9F%93%E7%AE%A1%E9%81%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染管道</h4>\n<ul>\n<li>\n<p>layout 优化</p>\n<ul>\n<li>尽量避免改变元素的几何属性（例如宽度、高度、左侧或顶部位置等）</li>\n<li>修改 paint only 属性（例如背景颜色、文字颜色等）-> repaint</li>\n</ul>\n</li>\n<li>\n<p>Paint 优化</p>\n<ul>\n<li>使用 will-change 或 translateZ 等提升元素层级</li>\n<li>使用 transform 和 opacity 属性</li>\n</ul>\n</li>\n</ul>\n<h4 id="滚动复用"><a href="#%E6%BB%9A%E5%8A%A8%E5%A4%8D%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>滚动复用</h4>\n<p>类似于长列表的虚拟滚动：复用 DOM、离屏时销毁 DOM</p>\n<h3 id="缺点"><a href="#%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<p>随着页面复杂程度、页面滚动速度的增加，重排重绘开销随之线性增长</p>\n<h2 id="canvas"><a href="#canvas" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Canvas</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-13-53-d6b91df54df4b191209e30daf5e0205d-4e8bd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 788px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.34517766497462%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACBUlEQVQoz01SbW/SUBjtnzXxL/hF/aYmJkb5MuMSTRajg01gig4xUHkboRljDJCXIu0YIH0B2nt7b1so80Dj4kn6JDc553nOc54Kt/9hs9nW5XxdqZD6BT0rOd/TNPXZTqcJ55s7wh0EfOv12v0Hz/Mocajje96tqkx73aHcV3u935qmGYYxHo8JISHN933BcRxKafgAOOd4BsEaTcVsJvbxfeL48MPBu1Ih3263c7mcaZogW5aFLgIEjDEIFouFbdtsB3iBeDxbyqo+UPW+qmvGUpb73W630Wh0Oh3MAE0IlXA5mUxsy/JcDy1WqxXEL96KD55/efr6x/1HR7GUFD+ORiKRbDbbarWWO2CyxxgnhC2WxLKp43Dm+kEQQDy8Mdvyn56iN3vTyWyBtdXra8bdINg4DuPcFSjDsBV3fWU8n5nE9Xy+FW9j3Y9WMPbJXubxq9Nv4pVUPRPFn6lUqlgswvZ2Z89bUYdZNpkhT3OOlrCNICCu1JVUrnma/5XINDryZG7qM5A0DZlNp9OtmFJUgs1vRiPD0PkOoe03MenZfv7lQfnew8RXsXV1WWs2WwisWq0mk0lFUQQEGyaM60GGy6FXmLbcl2u1i3r98vy8NpDl0Wg0GAyGw2GYKMgCLgZBqERFF3je7H6lUqFwEv90Eo8fRQ8r5bIkSaIoYmHche4M/wWrDEzpnIIXxQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 13 53" title="" data-src="/static/2021-10-26-14-13-53-d6b91df54df4b191209e30daf5e0205d-4e8bd.png" data-srcset="/static/2021-10-26-14-13-53-d6b91df54df4b191209e30daf5e0205d-28bac.png 200w,\n/static/2021-10-26-14-13-53-d6b91df54df4b191209e30daf5e0205d-faee6.png 400w,\n/static/2021-10-26-14-13-53-d6b91df54df4b191209e30daf5e0205d-4e8bd.png 788w" data-sizes="(max-width: 788px) 100vw, 788px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="极端场景的全表双边框"><a href="#%E6%9E%81%E7%AB%AF%E5%9C%BA%E6%99%AF%E7%9A%84%E5%85%A8%E8%A1%A8%E5%8F%8C%E8%BE%B9%E6%A1%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>极端场景的全表双边框</h3>\n<h4 id="背景-4"><a href="#%E8%83%8C%E6%99%AF-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-17-48-384cdd49108be3b6d98f591712422cca-6cf69.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.21802325581396%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABZElEQVQoz1WQ247kMAhE8/9/ud3x/RYbg7G9D4t7eh42KpVKCDjEV0fC3pgq9WdgHdTECSWf8Ktv5gEdnpSLsd44fyES98CgJpgJenZ3vEnw3BSfosiOoMjfI1sw73S/s3o37y4hM+bT2oP4xHRcRInhU0RZHck7snbESNaM4IZ3XLIMI/coBAZh2jMmqC9Z86lYrg6N6vqm4FArtBqNphgu6Di6QBxDmCDMNPCjIa+QCMugTL1gjhj8iEHI5C05O3K6GnQZnmfYH8fceDy8YK6HZxXN1STPVZEo+MN09hyfopA7QeBmuFlx6rGOUfgMFJ6yRVR5lbkr4sgO7J3UUZUHa62vUTaGTXFTWPzAnG3uvrbMw9zwzRuY/47SijXaGK1TjFet4J1R90urt7j3NiMVOfJ/spydOnqnX68/P5/W+ipPCyEoJduMUirE+BC3tWHtz9/uH7hUCg7vvXRaa6U5pfQPwMY0khDmwQkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 17 48" title="" data-src="/static/2021-10-26-14-17-48-384cdd49108be3b6d98f591712422cca-fee1c.png" data-srcset="/static/2021-10-26-14-17-48-384cdd49108be3b6d98f591712422cca-a67b7.png 200w,\n/static/2021-10-26-14-17-48-384cdd49108be3b6d98f591712422cca-0b187.png 400w,\n/static/2021-10-26-14-17-48-384cdd49108be3b6d98f591712422cca-fee1c.png 800w,\n/static/2021-10-26-14-17-48-384cdd49108be3b6d98f591712422cca-b1a91.png 1200w,\n/static/2021-10-26-14-17-48-384cdd49108be3b6d98f591712422cca-6cf69.png 1376w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>渲染时间：单边框 6.71ms -> 双边框 14.91 ms</p>\n<ul>\n<li>绘制量：对比单边框，直接翻倍</li>\n<li>对接逻辑：需要额外的对接逻辑</li>\n</ul>\n<h4 id="产生原因"><a href="#%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>产生原因</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-23-17-4a2338354db22a7f0f8da4ea02ca4fcc-64bf4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 792px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.843434343434346%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABPElEQVQoz01R0W6DMAzk//9pUtnjOok+VMD6srGuaggpoSEEEYdkF7JVvQfLBN/5bGfe+/UfIXhjnJS27+0wEOfLIG3Hl65bpCQz+fAEELPVRdqTBIXgvCfvEV0IUIxx0iPn7LqBMTaOI0oz51x/u4kuAk+OHFmy1hKR1hNetNZKqbKs8jw/HA51XVdVBX4ko6ht26ZpLpfLAK9EkIMR8O/3O+yhCDn48zwjogafsY1zWaoeR7UsC9yj6ff5DPnj8VgURVmWp9MJNGOM6ETLWtiGR+hGMkaePurr7kW87tTPWcgBrkDA79RHSjlN0X+aNgGP28zrar4++f5NvO81Y0rrjvO+76ORDTCJsZGg1eMuyW9cGGHb21qTbTBvWKGIS0wRnlFmN9CGlGR/R4JqFHbpbAnPJ33c8pEj/gJdOgF3Q/10vgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 23 17" title="" data-src="/static/2021-10-26-14-23-17-4a2338354db22a7f0f8da4ea02ca4fcc-64bf4.png" data-srcset="/static/2021-10-26-14-23-17-4a2338354db22a7f0f8da4ea02ca4fcc-ea548.png 200w,\n/static/2021-10-26-14-23-17-4a2338354db22a7f0f8da4ea02ca4fcc-22e6d.png 400w,\n/static/2021-10-26-14-23-17-4a2338354db22a7f0f8da4ea02ca4fcc-64bf4.png 792w" data-sizes="(max-width: 792px) 100vw, 792px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>上下文设置 style</p>\n<p>通过 canvas 上下文设置的 <code class="language-text">fill_style</code>、<code class="language-text">stroke_style</code> 等状态, 实际上都是 CanvasStyle 这个类的实例</p>\n</li>\n<li>\n<p>GC 逻辑低效</p>\n<p>GarbageCollected 自己实现了一套 GC 逻辑，并不会走 V8 引擎的 GC，不如 C++ GC 高效</p>\n</li>\n<li>\n<p>性能开销</p>\n<p>Canvas API 调用设置状态操作，性能开销较大</p>\n</li>\n</ul>\n<p>Canvas 在渲染过程中针对单元格需要渲染背景色、边框线、富文本，而不同的颜色、文本等又需要不同的状态，所以需要频繁切换状态机</p>\n<ul>\n<li>渲染单元格：渲染背景色、渲染边框线、渲染富文本</li>\n<li>渲染⽂本：渲染 color（black 文字）、渲染 color（red 文字）、渲染 color（blue 文字）</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-4d589.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 713px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.95371669004208%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABk0lEQVQY012Q2ysEYRjG589zuNGKkCuKXDiUkES5kiIpx1VLIu2yDhcWOWSyVisjrTA7s7PWfHP4ZmbNYY2Zsbsz60M5PRfvqefX2/tipV/yPO8rokSlRU58/h4i2YVinCCNV/vbj5X+yHPdkiRxUnIpcT6dvp6Bqa1X6w3REFzytzMEPiXczUrgqvi5Bfu91jD03Iv1yCRArDESKI+FyjiiX81ZTrH0dLdGH1aG5yrIgwpArhdcRLg/sGVZCEaFBFNZoim+6XvYr+JvBhQgGlmHTYaEqA8PVvNRn0CH/8Ou62qqms97EmTARTOxW39/VJc87gL3ZMHMs9TmI15zsd2QOavNPITzxY8TsX8Ps0w7m1VVhdEhpTHXGsdAlocZoMiiCpOanNJl2sxpX3bMcRzTNG3bVnIK1ETJkDjIMhTJsylZkxVdRgMKkAn6lhbSGZEXdQUaUNA45MdwHA8FQ3EiPn000uNv7Qu0+Y/H/JHxvkALakc3elfPlsb2BgaXO0Z2uhdP5if3h4dW2oeDnQunE+9yTJhRSzHYywAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 29 28" title="" data-src="/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-4d589.png" data-srcset="/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-b9753.png 200w,\n/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-7c7b5.png 400w,\n/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-4d589.png 713w" data-sizes="(max-width: 713px) 100vw, 713px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="优化-3"><a href="#%E4%BC%98%E5%8C%96-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h4>\n<h5 id="切换状态机优化"><a href="#%E5%88%87%E6%8D%A2%E7%8A%B6%E6%80%81%E6%9C%BA%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>切换状态机优化</h5>\n<p>通过提前收集、统一整理，减少切换状态机</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-c84fc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 685px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.8978102189781%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqklEQVQY012Q3VPaUBDF8/8/tFqhVLTaTsf2RaoJEgJIExJCzNe9BZLwIRhHpdg6akFMcpN7k17aPnS6T2d3z29mzzKOP+Qtjje5liuCKRRgWbDLbU8xJyZvsVWb1Uaa6rVP9KOqzYEpaDkib67ncOIw9jko8hsF9kVJO1CG0n5za6+2depWzy6UD9KbA7koj5uiV3tXL+w3cvJALHU+UfNOdUMb6kwU4STOkiRDKI0igpPs5wKZZheAvtMf6zqkQlUNUWz7/izBaxs1UySMMJOm2X8VhmR+8+Pb9fxu/nA7u7u+nE3H/uXkKngO6Tb9B2D6vscZh5xeavbqxrnF6mvdGalfr6DQ5eq9E8s3jQud/oIHx+bEktwvZaNUAZ8BzWyNQbGyWTh+eah+lD1pm3+1XclxNtsaSW8b+b3TQsMReJt7zW3u1PLySCnDo10h917Ma0ODiWOS4iwlGaGxQ4IXEXl8Th5W6P4JPyW0TRYBDjBZRlTH98v4MSBhQnAWI8z8Pf93ktVyFdgm6iiRbURdiAYugnY8cMnsJu5BBK3Y0JB5Rr7f/kF+ATiLkYxePH1FAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 31 43" title="" data-src="/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-c84fc.png" data-srcset="/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-18514.png 200w,\n/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-82fbc.png 400w,\n/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-c84fc.png 685w" data-sizes="(max-width: 685px) 100vw, 685px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>遍历待绘制内容</p>\n<p>遍历待绘制的所有边框线、文字等</p>\n</li>\n<li>\n<p>相同状态内容整理</p>\n<p>相同状态的绘制内容，进行合并、排序等整理</p>\n</li>\n<li>\n<p>分类渲染</p>\n<p>整理之后的内容，根据状态机进行分类渲染</p>\n</li>\n</ul>\n<h5 id="渲染复用"><a href="#%E6%B8%B2%E6%9F%93%E5%A4%8D%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染复用</h5>\n<ul>\n<li>\n<p>离屏 Canvas</p>\n<p>离屏 Canvas 缓存主 Canvas 绘制内容</p>\n</li>\n<li>\n<p>复用</p>\n<p>直接复用离屏 Canvas 缓存的内容</p>\n</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-36-26-b286763fbf7e986dc2b892e4158c68a1-89964.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 754px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 72.41379310344827%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACD0lEQVQ4y11Ty27bQAzU//9G0UOKHpo0RfsLTYH45BxcAw6KAI2dSrK10mqfmg6pR5QQWOxqSQ5nh1SByYZh0L0qAz5fveDjhxO+3Vb4el3h7qfBrzuDzX2L25sKN19KfLr6hx/fa6zzBaIYD8MbRwgDnMvo+wRrI/cI0zgY49F1Ue/EH0Lm2dLfL/nFDJZz1iVfMQZdKUVdechjMeTlTpb3DofDAcfjccEYGfLD9pYVA4M8HCuumZtzDc8733UIE5vZ12ueJwEWYL4CCnIgdd8a9E2DxKDZEoOdaeAI5hkTrV1pNoxAJCFklKE6SV+SYkzqiATM3IPc2Q5Rzok+JotvboDsKaXlZXIuqqpCcE6fMleLroerS7RPfxRU/ZI0FRsmTcXiBOgYo4C/93vYtiXgqGEQ+mQ15KkR3F1Hf4gLIN+GPiSC5YWhdFoBN5sNnGjDQK9J8nzzOkZM9goYtLCjztYHPNUdjAvLqwTQ8b4wTI68kCS5bM9nWDZmLXxb15zDBpfzBXVLaWS8pi4LK2t7zmdHQD82RRQe2M0sOnBfxmICNJadZsNc5DTE/GZs0jS7r4M9abWnlrvdDn+fn/UJ86Dq70iGh8dHnDjAM+s8dVpitg8P2G63ynL5U2omlWWJpmlUl7XJ4DaXiya8N8k/nU76t4jOxZr+2kTbC0FU11b0dXqWgjIi4hOA9/Yf5F9B+lQ4hWMAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 36 26" title="" data-src="/static/2021-10-26-14-36-26-b286763fbf7e986dc2b892e4158c68a1-89964.png" data-srcset="/static/2021-10-26-14-36-26-b286763fbf7e986dc2b892e4158c68a1-13e98.png 200w,\n/static/2021-10-26-14-36-26-b286763fbf7e986dc2b892e4158c68a1-e13a3.png 400w,\n/static/2021-10-26-14-36-26-b286763fbf7e986dc2b892e4158c68a1-89964.png 754w" data-sizes="(max-width: 754px) 100vw, 754px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="针对业务逻辑减少-gc"><a href="#%E9%92%88%E5%AF%B9%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%87%8F%E5%B0%91-gc" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>针对业务逻辑减少 GC</h3>\n<p>浏览器垃圾收集器会定期（周期性）找出那些不在继续使用的变量，然后释放其内存</p>\n<ul>\n<li>\n<p>频繁 GC 导致帧率不稳定</p>\n<ul>\n<li>大量创建对象会导致更频繁的 GC</li>\n<li>频繁的 GC 会导致帧率不稳定，引起卡顿</li>\n</ul>\n</li>\n<li>\n<p>对象池优化</p>\n<ul>\n<li>建立对象池缓存，从对象池获取对象</li>\n<li>减少渲染主循环过程中新建对象操作，从而减少 GC</li>\n</ul>\n</li>\n</ul>\n<h2 id="alloy-精确统计-fps"><a href="#alloy-%E7%B2%BE%E7%A1%AE%E7%BB%9F%E8%AE%A1-fps" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alloy 精确统计 FPS</h2>\n<p>如何精确、自动化统计 FPS？</p>\n<h3 id="背景-5"><a href="#%E8%83%8C%E6%99%AF-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h3>\n<p>现有 Web 前端 FPS 统计⽅式：</p>\n<ol>\n<li>\n<p>类似 Chrome devtools 的开发者⼯具</p>\n<ol>\n<li>需要人工实时监测、无法自动化</li>\n<li>更加适合开发阶段进行自测</li>\n</ol>\n</li>\n<li>\n<p>RequestAnimationFrame API</p>\n<ol>\n<li>统计的 FPS 结果不够准确，因为以两次主线程执行时间间隔作为一帧</li>\n<li>模拟交互不够真实，需要引入脚本且实现对应代码</li>\n</ol>\n</li>\n</ol>\n<p>同时由于主线程阻塞情况下浏览器的优化，即使嵌入死循环 js，滚动依然流畅，影响 FPS 的统计</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50617105944632690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function block() {\n   while (true) {}\n}\nsetTimeout(block, 2000);`, `50617105944632690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>Chrome 浏览器在主线程阻塞情况下，会将页面滚动处理由主线程移交给合成线程</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-2cb88.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 15.783410138248849%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAk0lEQVQI1x2J2xaCIBAA/f//K4NEBV2EZY/LxYNmD2XNmaeZZs85WlvQJ7tsgdIMlWP6FSyB1gny4jLidQuG7D0NI89wlO19HE1GQqGCVL5T0+3upaRRO/Ek1a+DZjOhEChkAstaszY7857SZY2xqVyhB9ObgCiFFK1QXXdvHzDDVSxYIkLn0CMFcs55DK/z/Pz5Ap7Xo+Nvq/KyAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 52 50" title="" data-src="/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-fee1c.png" data-srcset="/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-a67b7.png 200w,\n/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-0b187.png 400w,\n/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-fee1c.png 800w,\n/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-2cb88.png 868w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</blockquote>\n<p>此时需要我们理解 FPS 本质是：</p>\n<ul>\n<li>\n<p>帧率</p>\n<p>浏览器渲染动画或页面每一帧的速率</p>\n</li>\n<li>\n<p>渲染管道</p>\n<p>浏览器渲染每一帧经历的固定流程</p>\n</li>\n</ul>\n<p>同时主线程阻塞情况下，页面渲染可能在其之后的合成线程、GPU 线程进行处理</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-55-39-8d2a8b135f819640c2525ef8444311fc-f1168.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 796px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.70854271356784%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABaElEQVQoz3WR6UvDQBDF84f7wU+KWBAVpVak1gvtoWI9UEEURPCCqgg29eohsZGSdLc2tmnyc9OqBa0Ljzc7bx4zu6Pxz/G/WNc/SG/arG9Y7O0LPP4/vu+j+a8Gvhmg/MUGrlnBLZsqNqnnXxGPXQS5lqG0N1X/ZoKqo9lUjTojaB9XCWRumlp2Bnk/R+M+wsXtGUvXDRKXVTaWSqTni6zHisSn8qxGC2wtGKzFM0wfhVjYGmRxd5jwYYjkaRTNOZ9HXI0gM6PImzCN23HOL46YOxWsHJdJTeVIjOukJnLEx3SSE1nSkSeSsRPCO/1Ek33Mbg8weTDE8klEPdmy8ewqvi3BFh2uBrAU7A6EgvzFtUATbQ+t7s9qvRbxHfs9FvUbf5fieZSkS1G4KuO1k98ILNV6k6whebGcwPFHF0rPlWsUKk5nwmDY54xOIVv46dI1gPXe5M6oUbKcnrp0XB7Md/KVevv+CWGcUjluBCvOAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 55 39" title="" data-src="/static/2021-10-26-14-55-39-8d2a8b135f819640c2525ef8444311fc-f1168.png" data-srcset="/static/2021-10-26-14-55-39-8d2a8b135f819640c2525ef8444311fc-ad772.png 200w,\n/static/2021-10-26-14-55-39-8d2a8b135f819640c2525ef8444311fc-4f4c3.png 400w,\n/static/2021-10-26-14-55-39-8d2a8b135f819640c2525ef8444311fc-f1168.png 796w" data-sizes="(max-width: 796px) 100vw, 796px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="方案-5"><a href="#%E6%96%B9%E6%A1%88-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h3>\n<ul>\n<li>Chrome devtools performance：普遍常用的 Chrome devtools performance 面板</li>\n<li>Tracing view：信息更加详细、全面的的 Tracing view 工具，使用 chrome://tracing 开启</li>\n</ul>\n<h4 id="tracing-view-介绍"><a href="#tracing-view-%E4%BB%8B%E7%BB%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tracing view 介绍</h4>\n<ul>\n<li>\n<p>进程、线程</p>\n<p>展示对应进程、线程信息</p>\n</li>\n<li>\n<p>Flow</p>\n<p>事件对应的流向</p>\n</li>\n<li>\n<p>TRACE_EVENT</p>\n<p>表示浏览器内核函数调用执行情况</p>\n</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-58-57-e607fd2ad231598f93ba887d375afd09-ad164.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.2033426183844%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACcklEQVQozzWS6W7bVhSE+f55jqI/gqAokAZR7KZuAtlxpGijVorL5b6J4qLNkWR9PVIRAoMBObzDOWeonS8XzucTp9OZC69wxeUk9JPNas/geS0o0bslnfaKQaeA888bLqcjr+czr6/Xc3JdQPP1CWo8I5hOWfYMRsOEyQ8P/fOMwb3O+J8JvU99+ncjrEcb84vB4qOO+dXAGpp4jiJJUp6mE/4ejtAK22W7f+G4e+Hx2yNvH9q0zZJ/rZy7cUBroLjTPVoTnzedNn905yw6IVMrwQ4TkmxFkq4YmiF9M0DLxDAvK/JVSTLWqTyL/bpgm6cc1iuZ/HDD8bCjqHM2mzXH457Dfsd2s6VZ1+y2W14Ex8MezR5NyIqSptmSLkxWacpqlZNnwnlG1VRUdUXd1GKwoakbyqqivD6ra6qyFF24ur7XoE2fu4RJRiEJg4WB7dqowEX57v8scHyF8hxsgeUKCyxl3e5/6Y7v4HgKrfvwlW5/SBhGRGOTeCF7kf0lZka8TIlnEfFctGV2w1ULlwlG38Id+nh6gD8WfZaSiK5Nnjv0hjqppEwWFrEXkciyYz9CzZZYT13sH/qtTd92iByf0PaEA1I3EnMPf6YIlj5RlKAZkm5hKylljaOPCYJAmpNksssoEeOiIJBx3Pse6s+2HFyImcPs4Rvff//A4P1H5p9buA9POL99kJZnBmUYU7oB4dQgz0sySRdb8n8J4sGESCbwZfTQyCilnFraVL05rXfv+Kt1z2hqkngpn95/Qdtdqy9rNlUjjUl70tpaUhV5fsNakqYyamZZ5EoJ2+S2TSgfswwTpc+JpMxU2dj2lP8AO3Yhi60GwtIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 58 57" title="" data-src="/static/2021-10-26-14-58-57-e607fd2ad231598f93ba887d375afd09-fee1c.png" data-srcset="/static/2021-10-26-14-58-57-e607fd2ad231598f93ba887d375afd09-a67b7.png 200w,\n/static/2021-10-26-14-58-57-e607fd2ad231598f93ba887d375afd09-0b187.png 400w,\n/static/2021-10-26-14-58-57-e607fd2ad231598f93ba887d375afd09-fee1c.png 800w,\n/static/2021-10-26-14-58-57-e607fd2ad231598f93ba887d375afd09-ad164.png 1077w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="分析主线程阻塞时滚动"><a href="#%E5%88%86%E6%9E%90%E4%B8%BB%E7%BA%BF%E7%A8%8B%E9%98%BB%E5%A1%9E%E6%97%B6%E6%BB%9A%E5%8A%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分析主线程阻塞时滚动</h4>\n<ul>\n<li>主线程 V8 执行 js 死循环</li>\n<li>合成线程处理滚动</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-01-18-1fddd10607bdbe82a928b860018fab9e-316dd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.88803512623491%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAADiElEQVQ4y22U+W8aVxDH92+v1B/bSm3SQ3WSKm3kKHZiG8eA7fqCwIIBgw8wt2HZe9nl2gXHdfzpmEaqWmWlr74zb46dN/PeU/jCF0WfKORD8oLshxmVSkQmNSWTnhLbCPjlJwdN+/ilUBRL17Etm9v5gnm4IJpGROGcyThi7IeMhjNGQcRovCAYzfH8CePpnJn4htEts2ghuF0ilDWlGk9ytfaOsSV/7en06m3atRadTg9jYNDv9GnU66j5I7LqIUcnSTLZAxLJLQ6Pk6i5Y1k/IiO2s6KK4l9WmZ1dEN7dY2s2pmaityTZZQu73hJu0FDLnLxLCOKkN3dJvFrn1ZNf2Xj2B0dvd0iJ7Vi4uJ9CcQ1LtjSSLU0Jhh6+5+Brffzq1RLe5TnGSYb2+h7tt4L1XeFdaqvvabyJf9b3aK3t0ts5RNF0E9sZLhPOJmPCUSAcEC4i5rfSn3AiQ5oxn4VLRNMZ0aMsPJ9Ope/hvzaJV+r1Jr4/YjyZCQd4rivsEwQ+nufiOs5S90c+w2CIN3RxLENgYuqaDNSQGBvbNhkYOspVtUaz1cGSobiGh9V3MG4snIGHI/qStUfZxxJZaw0wOzp6e8CgqWF2TRyJsSSmL7qSPy3KeSvgSoXOcIJpDDH6Np7lS3WSpNbBzpYw/0xhHn7AUouY6hma6Fa5hv1YxMDG0hwcfYhyUyzRO7/ESmWwCgW0s1PMmy6eaUjyAb1GTQL6aMk4uppmcH1Ou5SjkU/TLmbRqxWsxhX98im9ahllfNNnYbvMG228iwvccgnnuorX6zGSPtnXV7jS5yBXIThv4Veu8a/E77yEIQmt0hnuWR07n8c6lXNoR1O6I5deNKYz8+mOPW4Ch4ajUzc1ur5NV/SOpdORirumsNnH8Wwe5nPu5Ybdyy35FM15uLtDuc7H5LB+g/r+B7Lb35MVzghvv/yajRdfcbLxHeqO2HaeoMYFiR9Jb31Ls7K/vLsP/4NyetEkdpAncVIiflxYcmxf5eWbHV6sxthIfCB+UhTbP3i0b4m9XG1/fg4e/vs41PbyHDzb4vg3wfMYB8832V9ZY/vpKrGnr0n8/JojsR+sbIrfBkfid7iyRT1VZvLxnuniL9zpR5pOtJSVu8s+XqVFM50ik9iknynQy6oyoC7jmoWWK1A+TFLaS6LJ8RnkTmU4XcJrk61zi1xvQrrp83vOQAsW/A2AMnIx7kRt8gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 01 18" title="" data-src="/static/2021-10-26-15-01-18-1fddd10607bdbe82a928b860018fab9e-fee1c.png" data-srcset="/static/2021-10-26-15-01-18-1fddd10607bdbe82a928b860018fab9e-a67b7.png 200w,\n/static/2021-10-26-15-01-18-1fddd10607bdbe82a928b860018fab9e-0b187.png 400w,\n/static/2021-10-26-15-01-18-1fddd10607bdbe82a928b860018fab9e-fee1c.png 800w,\n/static/2021-10-26-15-01-18-1fddd10607bdbe82a928b860018fab9e-316dd.png 911w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="寻找关键-trace_event"><a href="#%E5%AF%BB%E6%89%BE%E5%85%B3%E9%94%AE-trace_event" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>寻找关键 TRACE_EVENT</h4>\n<ul>\n<li>\n<p>关键 TRACE_EVENT</p>\n<p>关键 TRACE_EVENT 出现次数 = 帧渲染次数</p>\n</li>\n<li>\n<p>排除主线程</p>\n<p>将寻找关键 TRACE_EVENT 的路径集中到主线程之后的流程</p>\n</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-8f73d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.08532778355879%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABTElEQVQY012QbUvDMBhF8/9/jKJMUGFTO/TL1I2hwtRVt7VpmzQvTdImTdJpujGYHi7hwn3Ol4CfI7bb/h1H1ekJOT+jFwM6GvLrKx7dVfvpH+Cv3J+Updts2hAILUI2Lyyl/ljeHgKstb7rhBRSSef90RToDqVXvLOmabRu2tZY23rvQed9x7lIoEwgy1BGVUYkYhKWMkE8lJyqnMiCyYzKFHPMFJEGVbo2FpQZzL82d7N48rZ+nS5unpbR7HOV0dHj+8PLOk7xcLKIpstvSKJZfPv8ESfo8n4+GM+XSQmsUhqTBNO85NlyDRHJEFV1k+Y4FKlqWqkcM0zCASNcNbqtlGaiIVIDJYTHWKWJhpCu0oJUBeEll2mOghyKqA2mFSwIZiJolTLKOKmt1A4wxuwe50J6vAvfQghljLc7dmO/GmPqukYYI4RaY34B62zAvGRtXBAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 03 54" title="" data-src="/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-fee1c.png" data-srcset="/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-a67b7.png 200w,\n/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-0b187.png 400w,\n/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-fee1c.png 800w,\n/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-8f73d.png 961w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="确定关键-trace_event"><a href="#%E7%A1%AE%E5%AE%9A%E5%85%B3%E9%94%AE-trace_event" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>确定关键 TRACE_EVENT</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-05-04-2c039b43183d3ebd561ee2de807f3af0-079bc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.750244857982366%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABzElEQVQoz41T22rbQBDV/7/1pRQSaGlLikleQkpxjfPqQGTZjpPYlppEDfJFl13rfqtlnc6uZZf2xV04nDOzM4fV7EoJwxC+74NzDs/zpF6v1/CjCN5ohMgwEJkm4p8m1uMx+HwOn3r+rQ+CAFVVQQmbTZFkjIETc8FUwB4fEb08k6mO6PkJvj4DXyzAyUTUMs5kn+gXxtIQx1ZFKDYA84FNfbRcMc1XGMYTXI8hoM9cxh6WiQ0nd3coPDi/OJzMgeO+wI1XcEoPK4rn0Qo2aYncASsZFNuhTdtFEMYIswyWZWByeQ31SxvaeQdqq43bs2/ot75Da3WgnV5A+/AVN+9a6L45Qe/tGbT3l+h/7GBy1YOS5SXSrECcZMiIxcqCHHr7B8anfYxOerg7H2Dy+RazT32YNyZehwssHlywJYc1oPhuCWsWwrNSKEmaSTNpmBfYbreHeZThBnVaNbOk/KY6PkNhIFBVO67rWvK23hlThnS9YzR7f+FPriZ9/Jb/c4mDyBPuRUYXIh5nHMdSF0UhwejxJkmCPKeRpCnSBkLve8qyPJgeDO/vx+h2rzGdTjEcDqANNKiqCl3XZZP4AULioIGMCbZtS+O94W/Hb0B1v3rfLwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 05 04" title="" data-src="/static/2021-10-26-15-05-04-2c039b43183d3ebd561ee2de807f3af0-fee1c.png" data-srcset="/static/2021-10-26-15-05-04-2c039b43183d3ebd561ee2de807f3af0-a67b7.png 200w,\n/static/2021-10-26-15-05-04-2c039b43183d3ebd561ee2de807f3af0-0b187.png 400w,\n/static/2021-10-26-15-05-04-2c039b43183d3ebd561ee2de807f3af0-fee1c.png 800w,\n/static/2021-10-26-15-05-04-2c039b43183d3ebd561ee2de807f3af0-079bc.png 1021w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>确定关键 <code class="language-text">TRACE_EVENT</code>，合成线程中 <code class="language-text">ProxyImpl::ScheduledActionDraw</code> 可以作为关键 <code class="language-text">TRACE_EVENT</code> 进行 FPS 统计</p>\n<h4 id="alloyperf-实现原理"><a href="#alloyperf-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AlloyPerf 实现原理</h4>\n<p>截止 <code class="language-text">2021-10-26 15:10:27</code>，AlloyPerf 未开源</p>\n<p>// TODO 查看 AlloyPref 源代码</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-06-48-0220158737d71cef52d99beb9ee90282-04aed.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.3968253968254%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABQUlEQVQoz31RsU7DMBTM//8EIysLExMMnRCCoVCCRNSUljZxnMSxY8eJfdhuoqQMtXR6T+d3p3t29PH5jn2+Q8EIlGwhOUOSfOPt/hatqFFWFZqGgXOOuq6RpimKgqLIM7CqRE4IGGMBWZYhir9iHMgeJc9xLBusNgek5Bcv6wcMSoA1HEJ4CLRtG0RaSay3GdK8hu4kuk6HO0opIixOSiVuVltcO3asd68HPG+rM2fn+8haAz0YiG5A1xtQrnBkCr3jBmPd8Ayv9JzHrhAgTRdMvH6aiSbip5SQ2oShx5iGJL2xY4LR0LGeK4XG5sixo17jgjj9NBcMBzNn9j11Aj0mvDREMEhIG8x8jU88BLkw9Ov5ZIRr7F3SJ5ewH1f7b2hcnWCnfjE3Glo0qgdXA5jscWLnt1muvKzzD9lFe+7/AMjtbLUbHIh0AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 06 48" title="" data-src="/static/2021-10-26-15-06-48-0220158737d71cef52d99beb9ee90282-fee1c.png" data-srcset="/static/2021-10-26-15-06-48-0220158737d71cef52d99beb9ee90282-a67b7.png 200w,\n/static/2021-10-26-15-06-48-0220158737d71cef52d99beb9ee90282-0b187.png 400w,\n/static/2021-10-26-15-06-48-0220158737d71cef52d99beb9ee90282-fee1c.png 800w,\n/static/2021-10-26-15-06-48-0220158737d71cef52d99beb9ee90282-b1a91.png 1200w,\n/static/2021-10-26-15-06-48-0220158737d71cef52d99beb9ee90282-04aed.png 1260w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>Docker 集成环境</p>\n<p>docker 集成 chrome、chrome driver 统一环境，支持跨平台</p>\n</li>\n<li>\n<p>自动化 CI</p>\n<p>支持自动化 CI，通过测试用例自动化测试统计对应、对应交互的页面 FPS</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-08-35-e9fa230c7fd9a0b41c19a1c43ad562bf-82dd7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 675px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAACU0lEQVQ4y41TS2vWQBT9/ruKFFcufGDrQgQ37UJsxYrYr1gQuxJcKK2Pim2SSeaRzOPeeSX5vMkndWVtOIRJZs6cM+feWbg+4DihTVZYpaOlMYzBJZ/iUJiaRxlWyQ1eYCddazN4mh08hLBwCV0G+lWjOK8L5ToYkD5tRO9zYViDHHvfZVN07Ly+0MFCjzY5R+Rfurxz+vjut6dPfj7f+L518+uD26ePtn5sK9Ah5jGtltXxjZP7W2fbm2c7986ebXzdvHXy8FXxro/jorbyZXm4Xx0d1Me7xXK3PNgrD5fsgyFD/din8ZP4snOx/6Z6/7o6omV75fJF+faj+JzTuPA+9L530olKrOgZJwx5CD6mfowxOw/aGi00aOiEXuXRRdR0rJgXgAjeW+dUpwGJEQk+eKQxbRGSgpZiq3jNVGOCI2YDSjgV1mRKxiG2xjiEkCIBgydHa2UFXWWaqmG15D4Hn4L0rXLtpGzRCd+ypq45T0Mf+5T6DNGTnTyTW9TM8LJmQsmCVY3kbTAS2pjywgFoZ7TVndEO3RoWLF6SoWOWM9F0ThtPFQLablImMk3Twei9HlyC4kp5WJM5KMYb0iBfMScq9Wy7X9CKf4H4FACRaytImTTpzJhDg/JPYFeQ18pqtk1pdWAweYLEVv5X+dJ2aZpGilpxFxBT4DiV6lpkNdsuGeusDpmuC5Fn5XRtMuN1aztiYpxs0/2Z6jylcgXmwBonqREMtWSfQo5iVr5WYC3oUjcUmNAKIv4NjGxfrUwF12C4kVRn6i0ISM7FZHtS/g2XUPnyW5yr8wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 08 35" title="" data-src="/static/2021-10-26-15-08-35-e9fa230c7fd9a0b41c19a1c43ad562bf-82dd7.png" data-srcset="/static/2021-10-26-15-08-35-e9fa230c7fd9a0b41c19a1c43ad562bf-b59b2.png 200w,\n/static/2021-10-26-15-08-35-e9fa230c7fd9a0b41c19a1c43ad562bf-189f4.png 400w,\n/static/2021-10-26-15-08-35-e9fa230c7fd9a0b41c19a1c43ad562bf-82dd7.png 675w" data-sizes="(max-width: 675px) 100vw, 675px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ul>\n<h1 id="远程办公下开发测试协同如何提效"><a href="#%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%AC%E4%B8%8B%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E5%8D%8F%E5%90%8C%E5%A6%82%E4%BD%95%E6%8F%90%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>远程办公下开发测试协同如何提效</h1>\n<h2 id="异地开发测试协同"><a href="#%E5%BC%82%E5%9C%B0%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E5%8D%8F%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异地开发测试协同</h2>\n<h3 id="背景-6"><a href="#%E8%83%8C%E6%99%AF-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h3>\n<ul>\n<li>开发联调：截图、传递抓包文件、需要同步联调信息</li>\n<li>测试：测试测出问题反馈给开发，开发需要重现步骤，然后推到测试环境才能让测试测，问题定位步骤长很低效</li>\n<li>产品体验：如果异地的老板想看测试环境的效果，需要部署外网地址才能访问</li>\n</ul>\n<h3 id="业界方案"><a href="#%E4%B8%9A%E7%95%8C%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>业界方案</h3>\n<h4 id="vpn--修改-host"><a href="#vpn--%E4%BF%AE%E6%94%B9-host" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vpn + 修改 host</h4>\n<p>实现的途径：</p>\n<ol>\n<li>手动修改</li>\n<li>借助工具修改（比如 switchhosts）</li>\n</ol>\n<p>但暴露的问题有</p>\n<ol>\n<li>功能受限</li>\n<li>不支持移动端</li>\n<li>信息同步慢</li>\n</ol>\n<p>由此开发联调、测试、产品体验效率都很差</p>\n<h4 id="vpn--代理工具"><a href="#vpn--%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vpn + 代理工具</h4>\n<p>实现途径：</p>\n<ol>\n<li>whsitle</li>\n<li>fiddler</li>\n<li>charles</li>\n</ol>\n<p>对比以上的 <code class="language-text">vpn + 修改 host</code> 分别有以下优点</p>\n<ol>\n<li>支持各种复杂规则配置</li>\n<li>支持移动端</li>\n<li>分享抓包信息</li>\n</ol>\n<p>但是通常一个代理工具需要以下步骤才能使用</p>\n<ol>\n<li>启动代理工具</li>\n<li>配置系统代理或使用浏览器插件</li>\n<li>wifi 代理</li>\n<li>手机配置 https 证书</li>\n</ol>\n<p>由此导致的问题有：</p>\n<ol>\n<li>体验前置步骤多、成本大</li>\n<li>分享抓包路径长</li>\n<li>配置不共享</li>\n<li>本地需要启动代理服务</li>\n</ol>\n<p>测试、产品的体验效率很差</p>\n<h4 id="vpn--测试域名"><a href="#vpn--%E6%B5%8B%E8%AF%95%E5%9F%9F%E5%90%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vpn + 测试域名</h4>\n<p>优点：访问方便</p>\n<p>缺点：</p>\n<ol>\n<li>无抓包，定位问题复杂</li>\n<li>配置固定，修改配置麻烦</li>\n<li>切换环境不方便</li>\n<li>安全性如何保证</li>\n</ol>\n<p>测试、产品体验很方便，但联调、定位问题的效率差</p>\n<h3 id="痛点"><a href="#%E7%97%9B%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>痛点</h3>\n<ol>\n<li>访问不方便</li>\n<li>测试环境中业务信息保密性</li>\n<li>本地启动代理服务</li>\n<li>定位问题不方便（抓包、分享不方便）</li>\n<li>多人协作修改规则不方便（配置不共享）</li>\n</ol>\n<p>// TODO Tweb 学习笔记待完成</p>\n<h2 id="如何协作提效"><a href="#%E5%A6%82%E4%BD%95%E5%8D%8F%E4%BD%9C%E6%8F%90%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何协作提效</h2>\n<h2 id="tde-的现状与未来规划"><a href="#tde-%E7%9A%84%E7%8E%B0%E7%8A%B6%E4%B8%8E%E6%9C%AA%E6%9D%A5%E8%A7%84%E5%88%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TDE 的现状与未来规划</h2>\n<h2 id="tde-的实现原理"><a href="#tde-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TDE 的实现原理</h2>\n<h1 id="如何创造一门上万人使用的语言"><a href="#%E5%A6%82%E4%BD%95%E5%88%9B%E9%80%A0%E4%B8%80%E9%97%A8%E4%B8%8A%E4%B8%87%E4%BA%BA%E4%BD%BF%E7%94%A8%E7%9A%84%E8%AF%AD%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何创造一门上万人使用的语言</h1>\n<h1 id="kubernetes-应用的-bff-便捷开发"><a href="#kubernetes-%E5%BA%94%E7%94%A8%E7%9A%84-bff-%E4%BE%BF%E6%8D%B7%E5%BC%80%E5%8F%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubernetes 应用的 BFF 便捷开发</h1>\n<h1 id="跨端开发，也可以这样玩"><a href="#%E8%B7%A8%E7%AB%AF%E5%BC%80%E5%8F%91%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%BF%99%E6%A0%B7%E7%8E%A9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跨端开发，也可以这样玩</h1>\n<h1 id="基于-serverless-的低代码平台实践-tweb"><a href="#%E5%9F%BA%E4%BA%8E-serverless-%E7%9A%84%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0%E5%AE%9E%E8%B7%B5-tweb" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基于 serverless 的低代码平台实践-TWEB</h1>\n<h1 id="稿定视频编辑器背后的故事"><a href="#%E7%A8%BF%E5%AE%9A%E8%A7%86%E9%A2%91%E7%BC%96%E8%BE%91%E5%99%A8%E8%83%8C%E5%90%8E%E7%9A%84%E6%95%85%E4%BA%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>稿定视频编辑器背后的故事</h1>\n<h1 id="在线文档冲突ot-算法"><a href="#%E5%9C%A8%E7%BA%BF%E6%96%87%E6%A1%A3%E5%86%B2%E7%AA%81ot-%E7%AE%97%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在线文档冲突——OT 算法</h1>\n<h1 id="从-0-开始，打造腾讯自研的跨端动态化框架"><a href="#%E4%BB%8E-0-%E5%BC%80%E5%A7%8B%EF%BC%8C%E6%89%93%E9%80%A0%E8%85%BE%E8%AE%AF%E8%87%AA%E7%A0%94%E7%9A%84%E8%B7%A8%E7%AB%AF%E5%8A%A8%E6%80%81%E5%8C%96%E6%A1%86%E6%9E%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从 0 开始，打造腾讯自研的跨端&#x26;动态化框架</h1>\n<h1 id="puerts-unityue-下的-typescript-框架"><a href="#puerts-unityue-%E4%B8%8B%E7%9A%84-typescript-%E6%A1%86%E6%9E%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Puerts-UnityUE 下的 Typescript 框架</h1>\n<h1 id="2021-tweb-云时代的前端开发-王伟嘉"><a href="#2021-tweb-%E4%BA%91%E6%97%B6%E4%BB%A3%E7%9A%84%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E7%8E%8B%E4%BC%9F%E5%98%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2021 Tweb 云时代的前端开发 王伟嘉</h1>\n<h1 id="webassembly-在哔哩哔哩创作中心的实践"><a href="#webassembly-%E5%9C%A8%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E5%88%9B%E4%BD%9C%E4%B8%AD%E5%BF%83%E7%9A%84%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebAssembly 在哔哩哔哩创作中心的实践</h1>\n<h1 id="厘米秀-3d-形象-diy-渲染技术揭秘"><a href="#%E5%8E%98%E7%B1%B3%E7%A7%80-3d-%E5%BD%A2%E8%B1%A1-diy-%E6%B8%B2%E6%9F%93%E6%8A%80%E6%9C%AF%E6%8F%AD%E7%A7%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>厘米秀 3D 形象 DIY 渲染技术揭秘</h1>\n<h1 id="信息流运营场景中的低代码探索与实践"><a href="#%E4%BF%A1%E6%81%AF%E6%B5%81%E8%BF%90%E8%90%A5%E5%9C%BA%E6%99%AF%E4%B8%AD%E7%9A%84%E4%BD%8E%E4%BB%A3%E7%A0%81%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>信息流运营场景中的低代码探索与实践</h1>\n<h1 id="低代码页面编辑器的设计和实现"><a href="#%E4%BD%8E%E4%BB%A3%E7%A0%81%E9%A1%B5%E9%9D%A2%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>低代码页面编辑器的设计和实现</h1>\n<h1 id="腾讯文档工程实践"><a href="#%E8%85%BE%E8%AE%AF%E6%96%87%E6%A1%A3%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>腾讯文档工程实践</h1>\n<h1 id="微信小程序真机调试"><a href="#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微信小程序真机调试</h1>\n<h1 id="cdn-版本化解决方案"><a href="#cdn-%E7%89%88%E6%9C%AC%E5%8C%96%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN 版本化解决方案</h1>\n<h1 id="由兴趣驱动开源-cherry-markdown-成长之路"><a href="#%E7%94%B1%E5%85%B4%E8%B6%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E6%BA%90-cherry-markdown-%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>由兴趣驱动开源 Cherry Markdown 成长之路</h1>',
excerpt:"以下是本次参加 Tweb conf 2021 的学习笔记 目录 主会场 Flutter 音视频开发实践 腾讯文档渲染优化之路 远程办公下开发测试协同如何提效 如何创造一门上万人使用的语言 分会场（看过） Node.js & 大前端 Kubernetes 应用的 BFF…",frontmatter:{date:"2021-10-25 10:34:12",path:"/tweb-learn-note-2021/",tags:"前端, 前端大会, 前端分享",title:"2021TWeb学习笔记",draft:null}},prePost:{html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>由于 PMS 项目需要开发如下图所示的甘特图，需要选择合适的组件来实现此功能</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-11-16-17-43-29-3a19f19f610438d817f4d830953d71b5-9c1be.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 26.041666666666668%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAuUlEQVQY001PW2rDQAz0/S/WG7QkDU0/TAiunZel3dW7sh1ChtEyCM2O1DHLOE0PbMSaujYyC/NgESISkXjBAxCrsKi6ezY6M38UhiJNIjkXHK9/9/lW2ArHXB3IMdkMSQt7Xbn91mUxMQBqJkaM98vnz2GYTqlbg2n4FkbX6ktwbuTJbfJplnVDXxFvyJyPff913BH0tQGWi9pyxWtsMatq+jezrFryya5Z5ShkA8S+P+9+D1DLu/kf+6kjyh20r2EAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="pms-example" title="" data-src="/static/2021-11-16-17-43-29-3a19f19f610438d817f4d830953d71b5-fee1c.png" data-srcset="/static/2021-11-16-17-43-29-3a19f19f610438d817f4d830953d71b5-a67b7.png 200w,\n/static/2021-11-16-17-43-29-3a19f19f610438d817f4d830953d71b5-0b187.png 400w,\n/static/2021-11-16-17-43-29-3a19f19f610438d817f4d830953d71b5-fee1c.png 800w,\n/static/2021-11-16-17-43-29-3a19f19f610438d817f4d830953d71b5-b1a91.png 1200w,\n/static/2021-11-16-17-43-29-3a19f19f610438d817f4d830953d71b5-9c1be.png 1440w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="技术选型"><a href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术选型</h1>\n<table>\n<thead>\n<tr>\n<th align="left">选型</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"><a href="https://github.com/neuronetio/gantt-schedule-timeline-calendar" target="_blank" rel="nofollow noreferrer noopener">gantt-schedule-timeline-calendar</a></td>\n<td align="left">功能丰富</td>\n<td align="left">与 UI 相差较大，定制化代码较多</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/guiqui/react-timeline-gantt" target="_blank" rel="nofollow noreferrer noopener">react-timeline-gantt</a></td>\n<td align="left">功能丰富</td>\n<td align="left">与 UI 相差较大，定制化代码较多</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/frappe/gantt" target="_blank" rel="nofollow noreferrer noopener">gantt</a></td>\n<td align="left">与 UI 相差不大</td>\n<td align="left">在 react 使用需要封装；缺失左侧文字描述功能</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/hustcc/gantt-for-react" target="_blank" rel="nofollow noreferrer noopener">gantt-for-react</a></td>\n<td align="left">与 UI 相差不大，可直接在 react 中使用</td>\n<td align="left">缺失左侧文字描述功能</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/MaTeMaTuK/gantt-task-react" target="_blank" rel="nofollow noreferrer noopener">gantt-task-react</a></td>\n<td align="left">与 UI 最为接近</td>\n<td align="left">左侧文字展示功能较弱，只能展示固定的几个字段；关键样式没有暴露，不好做定制化</td>\n</tr>\n</tbody>\n</table>\n<h1 id="技术难点"><a href="#%E6%8A%80%E6%9C%AF%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术难点</h1>\n<p>需要针对 gantt-task-react 的源码做功能的增强：</p>\n<ol>\n<li>左侧文字展示功能增强</li>\n<li>样式属性暴露</li>\n</ol>\n<h1 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h1>\n<p>所有代码在<a href="https://github.com/towavephone/gantt-task-react/commit/01ef13b7623e2f1bc2fe0b483093d4b84f5edb2f" target="_blank" rel="nofollow noreferrer noopener">这里</a>，这里只展示核心逻辑</p>\n<h2 id="左侧文字展示功能"><a href="#%E5%B7%A6%E4%BE%A7%E6%96%87%E5%AD%97%E5%B1%95%E7%A4%BA%E5%8A%9F%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>左侧文字展示功能</h2>\n<p>左侧文字展示的功能和 antd 的列表渲染 API 一致</p>\n<h3 id="表头渲染"><a href="#%E8%A1%A8%E5%A4%B4%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>表头渲染</h3>\n<p>主要功能如下：</p>\n<ol>\n<li>表头的宽度</li>\n<li>标题渲染</li>\n</ol>\n<p>src/components/task-list/task-list-header.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81772271383141140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from &quot;react&quot;;\n+ import { ListColumn } from &quot;../../types/public-types&quot;;\nimport styles from &quot;./task-list-header.module.css&quot;;\n\nexport const TaskListHeaderDefault: React.FC<{\n  headerHeight: number;\n  rowWidth: string;\n  fontFamily: string;\n  fontSize: string;\n- }> = ({ headerHeight, fontFamily, fontSize, rowWidth }) => {\n+ listColumns: ListColumn[];\n+ }> = ({ headerHeight, fontFamily, fontSize, listColumns, rowWidth }) => {\n  return (\n    <div\n      className={styles.ganttTable}\n      style={{\n        fontFamily: fontFamily,\n        fontSize: fontSize,\n+       width: rowWidth,\n      }}\n    >\n      <div\n@@ -21,44 +24,17 @@ export const TaskListHeaderDefault: React.FC<{\n          height: headerHeight - 2,\n        }}\n      >\n-       <div\n-         className={styles.ganttTable_HeaderItem}\n-         style={{\n-           minWidth: rowWidth,\n-         }}\n-       >\n-         &nbsp;Name\n-       </div>\n-       <div\n-         className={styles.ganttTable_HeaderSeparator}\n-         style={{\n-           height: headerHeight * 0.5,\n-           marginTop: headerHeight * 0.2,\n-         }}\n-       />\n-       <div\n-         className={styles.ganttTable_HeaderItem}\n-         style={{\n-           minWidth: rowWidth,\n-         }}\n-       >\n-         &nbsp;From\n-       </div>\n-       <div\n-         className={styles.ganttTable_HeaderSeparator}\n-         style={{\n-           height: headerHeight * 0.5,\n-           marginTop: headerHeight * 0.25,\n-         }}\n-       />\n-       <div\n-         className={styles.ganttTable_HeaderItem}\n-         style={{\n-           minWidth: rowWidth,\n-         }}\n-       >\n-         &nbsp;To\n-       </div>\n+       {listColumns.map(item => (\n+         <div\n+           key={item.key || item.dataIndex}\n+           className={styles.ganttTable_HeaderItem}\n+           style={{\n+             width: item.width || &quot;auto&quot;,\n+           }}\n+         >\n+           {item.title}\n+         </div>\n+       ))}\n      </div>\n    </div>\n  );`, `81772271383141140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff">import React from "react";\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import { ListColumn } from "../../types/public-types";\n</span>import styles from "./task-list-header.module.css";\n\nexport const TaskListHeaderDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span> headerHeight: number;\n<span class="token prefix unchanged"> </span> rowWidth: string;\n<span class="token prefix unchanged"> </span> fontFamily: string;\n<span class="token prefix unchanged"> </span> fontSize: string;\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> }> = ({ headerHeight, fontFamily, fontSize, rowWidth }) => {\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> listColumns: ListColumn[];\n<span class="token prefix inserted">+</span> }> = ({ headerHeight, fontFamily, fontSize, listColumns, rowWidth }) => {\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span> return (\n<span class="token prefix unchanged"> </span>   &lt;div\n<span class="token prefix unchanged"> </span>     className={styles.ganttTable}\n<span class="token prefix unchanged"> </span>     style={{\n<span class="token prefix unchanged"> </span>       fontFamily: fontFamily,\n<span class="token prefix unchanged"> </span>       fontSize: fontSize,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>       width: rowWidth,\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     }}\n<span class="token prefix unchanged"> </span>   >\n<span class="token prefix unchanged"> </span>     &lt;div\n</span>@@ -21,44 +24,17 @@ export const TaskListHeaderDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span>         height: headerHeight - 2,\n<span class="token prefix unchanged"> </span>       }}\n<span class="token prefix unchanged"> </span>     >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderItem}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           minWidth: rowWidth,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       >\n<span class="token prefix deleted">-</span>         &amp;nbsp;Name\n<span class="token prefix deleted">-</span>       &lt;/div>\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderSeparator}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           height: headerHeight * 0.5,\n<span class="token prefix deleted">-</span>           marginTop: headerHeight * 0.2,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       />\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderItem}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           minWidth: rowWidth,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       >\n<span class="token prefix deleted">-</span>         &amp;nbsp;From\n<span class="token prefix deleted">-</span>       &lt;/div>\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderSeparator}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           height: headerHeight * 0.5,\n<span class="token prefix deleted">-</span>           marginTop: headerHeight * 0.25,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       />\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderItem}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           minWidth: rowWidth,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       >\n<span class="token prefix deleted">-</span>         &amp;nbsp;To\n<span class="token prefix deleted">-</span>       &lt;/div>\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>       {listColumns.map(item => (\n<span class="token prefix inserted">+</span>         &lt;div\n<span class="token prefix inserted">+</span>           key={item.key || item.dataIndex}\n<span class="token prefix inserted">+</span>           className={styles.ganttTable_HeaderItem}\n<span class="token prefix inserted">+</span>           style={{\n<span class="token prefix inserted">+</span>             width: item.width || "auto",\n<span class="token prefix inserted">+</span>           }}\n<span class="token prefix inserted">+</span>         >\n<span class="token prefix inserted">+</span>           {item.title}\n<span class="token prefix inserted">+</span>         &lt;/div>\n<span class="token prefix inserted">+</span>       ))}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     &lt;/div>\n<span class="token prefix unchanged"> </span>   &lt;/div>\n<span class="token prefix unchanged"> </span> );</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="列表内容渲染"><a href="#%E5%88%97%E8%A1%A8%E5%86%85%E5%AE%B9%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列表内容渲染</h3>\n<p>主要功能如下：</p>\n<ol>\n<li>表格宽度</li>\n<li>列表内容渲染</li>\n<li>表格行、列单元格合并</li>\n<li>表格长标题过长时省略</li>\n</ol>\n<p>src/components/task-list/task-list-table.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40369091727152930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`- import React, { useMemo } from &quot;react&quot;;\n+ import React from &quot;react&quot;;\n+ import classnames from &quot;classnames&quot;;\n+\nimport styles from &quot;./task-list-table.module.css&quot;;\n- import { Task } from &quot;../../types/public-types&quot;;\n+ import { Task, ListColumn } from &quot;../../types/public-types&quot;;\n+ import { getPathValue } from &quot;../../helpers/other-helper&quot;;\n\n- const localeDateStringCache = {};\n- const toLocaleDateStringFactory = (locale: string) => (\n-   date: Date,\n-   dateTimeOptions: Intl.DateTimeFormatOptions\n- ) => {\n-   const key = date.toString();\n-   let lds = localeDateStringCache[key];\n-   if (!lds) {\n-     lds = date.toLocaleDateString(locale, dateTimeOptions);\n-     localeDateStringCache[key] = lds;\n-   }\n-   return lds;\n- };\n- const dateTimeOptions: Intl.DateTimeFormatOptions = {\n-   weekday: &quot;short&quot;,\n-   year: &quot;numeric&quot;,\n-   month: &quot;long&quot;,\n-   day: &quot;numeric&quot;,\n- };\n\n+ function isRenderCell(data: any) {\n+   return (\n+     data &&\n+     typeof data === &quot;object&quot; &&\n+     !Array.isArray(data) &&\n+     !React.isValidElement(data)\n+   );\n+ }\n\nexport const TaskListTableDefault: React.FC<{\n  rowHeight: number;\n@@ -32,84 +44,153 @@ export const TaskListTableDefault: React.FC<{\n  selectedTaskId: string;\n  setSelectedTask: (taskId: string) => void;\n  onExpanderClick: (task: Task) => void;\n+ listColumns: ListColumn[];\n}> = ({\n  rowHeight,\n  rowWidth,\n  tasks,\n  fontFamily,\n  fontSize,\n- locale,\n  onExpanderClick,\n+ listColumns,\n}) => {\n- const toLocaleDateString = useMemo(() => toLocaleDateStringFactory(locale), [\n-   locale,\n- ]);\n\n  return (\n-   <div\n+   <table\n      className={styles.taskListWrapper}\n      style={{\n        fontFamily: fontFamily,\n        fontSize: fontSize,\n+       width: rowWidth,\n      }}\n    >\n-     {tasks.map(t => {\n-       let expanderSymbol = &quot;&quot;;\n-       if (t.hideChildren === false) {\n-         expanderSymbol = &quot;▼&quot;;\n-       } else if (t.hideChildren === true) {\n-         expanderSymbol = &quot;▶&quot;;\n-       }\n+     <tbody>\n+       {tasks.map((t, index) => {\n+         let expanderSymbol = &quot;&quot;;\n+         if (t.hideChildren === false) {\n+           expanderSymbol = &quot;▼&quot;;\n+         } else if (t.hideChildren === true) {\n+           expanderSymbol = &quot;▶&quot;;\n+         }\n\n-       return (\n-         <div\n-           className={styles.taskListTableRow}\n-           style={{ height: rowHeight }}\n-           key={\\`\\${t.id}row\\`}\n-         >\n-           <div\n-             className={styles.taskListCell}\n-             style={{\n-               minWidth: rowWidth,\n-               maxWidth: rowWidth,\n-             }}\n-             title={t.name}\n+         return (\n+           <tr\n+             className={styles.taskListTableRow}\n+             style={{ height: rowHeight }}\n+             key={\\`\\${t.id}row\\`}\n            >\n-             <div className={styles.taskListNameWrapper}>\n-               <div\n-                 className={\n-                   expanderSymbol\n-                     ? styles.taskListExpander\n-                     : styles.taskListEmptyExpander\n+             {listColumns.map(item => {\n+               let childNode: any;\n+               let cellProps;\n+               if (item.children) {\n+                 childNode = item.children;\n+               } else {\n+                 const value = getPathValue(t, item.dataIndex);\n+                 childNode = value;\n+                 if (item.render) {\n+                   const renderData = item.render(value, t, index);\n+                   if (isRenderCell(renderData)) {\n+                     childNode = renderData.children;\n+                     cellProps = renderData.props;\n+                   } else {\n+                     childNode = renderData;\n+                   }\n                  }\n-                 onClick={() => onExpanderClick(t)}\n-               >\n-                 {expanderSymbol}\n-               </div>\n-               <div>{t.name}</div>\n-             </div>\n-           </div>\n-           <div\n-             className={styles.taskListCell}\n-             style={{\n-               minWidth: rowWidth,\n-               maxWidth: rowWidth,\n-             }}\n-           >\n-             &nbsp;{toLocaleDateString(t.start, dateTimeOptions)}\n-           </div>\n-           <div\n-             className={styles.taskListCell}\n-             style={{\n-               minWidth: rowWidth,\n-               maxWidth: rowWidth,\n-             }}\n-           >\n-             &nbsp;{toLocaleDateString(t.end, dateTimeOptions)}\n-           </div>\n-         </div>\n-       );\n-     })}\n-   </div>\n+               }\n+               if (\n+                 typeof childNode === &quot;object&quot; &&\n+                 !Array.isArray(childNode) &&\n+                 !React.isValidElement(childNode)\n+               ) {\n+                 childNode = null;\n+               }\n+               const { colSpan: cellColSpan, rowSpan: cellRowSpan } =\n+                 cellProps || {};\n+               const mergedColSpan =\n+                 cellColSpan !== undefined ? cellColSpan : item.colSpan;\n+               const mergedRowSpan =\n+                 cellRowSpan !== undefined ? cellRowSpan : item.rowSpan;\n+               if (mergedColSpan === 0 || mergedRowSpan === 0) {\n+                 return null;\n+               }\n+               let title;\n+               const ellipsisConfig =\n+                 item.ellipsis === true\n+                   ? {\n+                       showTitle: true,\n+                     }\n+                   : item.ellipsis;\n+               if (ellipsisConfig && ellipsisConfig.showTitle) {\n+                 if (\n+                   typeof childNode === &quot;string&quot; ||\n+                   typeof childNode === &quot;number&quot;\n+                 ) {\n+                   title = childNode.toString();\n+                 } else if (\n+                   React.isValidElement(childNode) &&\n+                   // @ts-ignore\n+                   typeof childNode.props.children === &quot;string&quot;\n+                 ) {\n+                   // @ts-ignore\n+                   title = childNode.props.children;\n+                 }\n+               }\n+               return (\n+                 <td\n+                   key={item.key || item.dataIndex}\n+                   className={classnames(\n+                     styles.taskListCell,\n+                     item.ellipsis ? styles.ellipsis : &quot;&quot;\n+                   )}\n+                   style={{\n+                     width: item.width || &quot;auto&quot;,\n+                   }}\n+                   colSpan={\n+                     mergedColSpan && mergedColSpan !== 1\n+                       ? mergedColSpan\n+                       : null\n+                   }\n+                   rowSpan={\n+                     mergedRowSpan && mergedRowSpan !== 1\n+                       ? mergedRowSpan\n+                       : null\n+                   }\n+                 >\n+                   <div className={styles.taskListNameWrapper}>\n+                     <div\n+                       className={\n+                         expanderSymbol\n+                           ? styles.taskListExpander\n+                           : styles.taskListEmptyExpander\n+                       }\n+                       onClick={() => onExpanderClick(t)}\n+                     >\n+                       {expanderSymbol}\n+                     </div>\n+                     <div title={title} className={styles.ellipsis}>\n+                       {childNode}\n+                     </div>\n+                   </div>\n+                 </td>\n+               );\n+             })}\n+           </tr>\n+         );\n+       })}\n+     </tbody>\n+   </table>\n  );\n};`, `40369091727152930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> import React, { useMemo } from "react";\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import React from "react";\n<span class="token prefix inserted">+</span> import classnames from "classnames";\n<span class="token prefix inserted">+</span>\n</span>import styles from "./task-list-table.module.css";\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> import { Task } from "../../types/public-types";\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import { Task, ListColumn } from "../../types/public-types";\n<span class="token prefix inserted">+</span> import { getPathValue } from "../../helpers/other-helper";\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> const localeDateStringCache = {};\n<span class="token prefix deleted">-</span> const toLocaleDateStringFactory = (locale: string) => (\n<span class="token prefix deleted">-</span>   date: Date,\n<span class="token prefix deleted">-</span>   dateTimeOptions: Intl.DateTimeFormatOptions\n<span class="token prefix deleted">-</span> ) => {\n<span class="token prefix deleted">-</span>   const key = date.toString();\n<span class="token prefix deleted">-</span>   let lds = localeDateStringCache[key];\n<span class="token prefix deleted">-</span>   if (!lds) {\n<span class="token prefix deleted">-</span>     lds = date.toLocaleDateString(locale, dateTimeOptions);\n<span class="token prefix deleted">-</span>     localeDateStringCache[key] = lds;\n<span class="token prefix deleted">-</span>   }\n<span class="token prefix deleted">-</span>   return lds;\n<span class="token prefix deleted">-</span> };\n<span class="token prefix deleted">-</span> const dateTimeOptions: Intl.DateTimeFormatOptions = {\n<span class="token prefix deleted">-</span>   weekday: "short",\n<span class="token prefix deleted">-</span>   year: "numeric",\n<span class="token prefix deleted">-</span>   month: "long",\n<span class="token prefix deleted">-</span>   day: "numeric",\n<span class="token prefix deleted">-</span> };\n</span>\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> function isRenderCell(data: any) {\n<span class="token prefix inserted">+</span>   return (\n<span class="token prefix inserted">+</span>     data &amp;&amp;\n<span class="token prefix inserted">+</span>     typeof data === "object" &amp;&amp;\n<span class="token prefix inserted">+</span>     !Array.isArray(data) &amp;&amp;\n<span class="token prefix inserted">+</span>     !React.isValidElement(data)\n<span class="token prefix inserted">+</span>   );\n<span class="token prefix inserted">+</span> }\n</span>\nexport const TaskListTableDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span> rowHeight: number;\n</span>@@ -32,84 +44,153 @@ export const TaskListTableDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span> selectedTaskId: string;\n<span class="token prefix unchanged"> </span> setSelectedTask: (taskId: string) => void;\n<span class="token prefix unchanged"> </span> onExpanderClick: (task: Task) => void;\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> listColumns: ListColumn[];\n</span>}> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> rowHeight,\n<span class="token prefix unchanged"> </span> rowWidth,\n<span class="token prefix unchanged"> </span> tasks,\n<span class="token prefix unchanged"> </span> fontFamily,\n<span class="token prefix unchanged"> </span> fontSize,\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> locale,\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span> onExpanderClick,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> listColumns,\n</span>}) => {\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> const toLocaleDateString = useMemo(() => toLocaleDateStringFactory(locale), [\n<span class="token prefix deleted">-</span>   locale,\n<span class="token prefix deleted">-</span> ]);\n</span>\n<span class="token unchanged"><span class="token prefix unchanged"> </span> return (\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   &lt;div\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>   &lt;table\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     className={styles.taskListWrapper}\n<span class="token prefix unchanged"> </span>     style={{\n<span class="token prefix unchanged"> </span>       fontFamily: fontFamily,\n<span class="token prefix unchanged"> </span>       fontSize: fontSize,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>       width: rowWidth,\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     }}\n<span class="token prefix unchanged"> </span>   >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>     {tasks.map(t => {\n<span class="token prefix deleted">-</span>       let expanderSymbol = "";\n<span class="token prefix deleted">-</span>       if (t.hideChildren === false) {\n<span class="token prefix deleted">-</span>         expanderSymbol = "▼";\n<span class="token prefix deleted">-</span>       } else if (t.hideChildren === true) {\n<span class="token prefix deleted">-</span>         expanderSymbol = "▶";\n<span class="token prefix deleted">-</span>       }\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>     &lt;tbody>\n<span class="token prefix inserted">+</span>       {tasks.map((t, index) => {\n<span class="token prefix inserted">+</span>         let expanderSymbol = "";\n<span class="token prefix inserted">+</span>         if (t.hideChildren === false) {\n<span class="token prefix inserted">+</span>           expanderSymbol = "▼";\n<span class="token prefix inserted">+</span>         } else if (t.hideChildren === true) {\n<span class="token prefix inserted">+</span>           expanderSymbol = "▶";\n<span class="token prefix inserted">+</span>         }\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>       return (\n<span class="token prefix deleted">-</span>         &lt;div\n<span class="token prefix deleted">-</span>           className={styles.taskListTableRow}\n<span class="token prefix deleted">-</span>           style={{ height: rowHeight }}\n<span class="token prefix deleted">-</span>           key={`${t.id}row`}\n<span class="token prefix deleted">-</span>         >\n<span class="token prefix deleted">-</span>           &lt;div\n<span class="token prefix deleted">-</span>             className={styles.taskListCell}\n<span class="token prefix deleted">-</span>             style={{\n<span class="token prefix deleted">-</span>               minWidth: rowWidth,\n<span class="token prefix deleted">-</span>               maxWidth: rowWidth,\n<span class="token prefix deleted">-</span>             }}\n<span class="token prefix deleted">-</span>             title={t.name}\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>         return (\n<span class="token prefix inserted">+</span>           &lt;tr\n<span class="token prefix inserted">+</span>             className={styles.taskListTableRow}\n<span class="token prefix inserted">+</span>             style={{ height: rowHeight }}\n<span class="token prefix inserted">+</span>             key={`${t.id}row`}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>           >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>             &lt;div className={styles.taskListNameWrapper}>\n<span class="token prefix deleted">-</span>               &lt;div\n<span class="token prefix deleted">-</span>                 className={\n<span class="token prefix deleted">-</span>                   expanderSymbol\n<span class="token prefix deleted">-</span>                     ? styles.taskListExpander\n<span class="token prefix deleted">-</span>                     : styles.taskListEmptyExpander\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>             {listColumns.map(item => {\n<span class="token prefix inserted">+</span>               let childNode: any;\n<span class="token prefix inserted">+</span>               let cellProps;\n<span class="token prefix inserted">+</span>               if (item.children) {\n<span class="token prefix inserted">+</span>                 childNode = item.children;\n<span class="token prefix inserted">+</span>               } else {\n<span class="token prefix inserted">+</span>                 const value = getPathValue(t, item.dataIndex);\n<span class="token prefix inserted">+</span>                 childNode = value;\n<span class="token prefix inserted">+</span>                 if (item.render) {\n<span class="token prefix inserted">+</span>                   const renderData = item.render(value, t, index);\n<span class="token prefix inserted">+</span>                   if (isRenderCell(renderData)) {\n<span class="token prefix inserted">+</span>                     childNode = renderData.children;\n<span class="token prefix inserted">+</span>                     cellProps = renderData.props;\n<span class="token prefix inserted">+</span>                   } else {\n<span class="token prefix inserted">+</span>                     childNode = renderData;\n<span class="token prefix inserted">+</span>                   }\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>                 }\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>                 onClick={() => onExpanderClick(t)}\n<span class="token prefix deleted">-</span>               >\n<span class="token prefix deleted">-</span>                 {expanderSymbol}\n<span class="token prefix deleted">-</span>               &lt;/div>\n<span class="token prefix deleted">-</span>               &lt;div>{t.name}&lt;/div>\n<span class="token prefix deleted">-</span>             &lt;/div>\n<span class="token prefix deleted">-</span>           &lt;/div>\n<span class="token prefix deleted">-</span>           &lt;div\n<span class="token prefix deleted">-</span>             className={styles.taskListCell}\n<span class="token prefix deleted">-</span>             style={{\n<span class="token prefix deleted">-</span>               minWidth: rowWidth,\n<span class="token prefix deleted">-</span>               maxWidth: rowWidth,\n<span class="token prefix deleted">-</span>             }}\n<span class="token prefix deleted">-</span>           >\n<span class="token prefix deleted">-</span>             &amp;nbsp;{toLocaleDateString(t.start, dateTimeOptions)}\n<span class="token prefix deleted">-</span>           &lt;/div>\n<span class="token prefix deleted">-</span>           &lt;div\n<span class="token prefix deleted">-</span>             className={styles.taskListCell}\n<span class="token prefix deleted">-</span>             style={{\n<span class="token prefix deleted">-</span>               minWidth: rowWidth,\n<span class="token prefix deleted">-</span>               maxWidth: rowWidth,\n<span class="token prefix deleted">-</span>             }}\n<span class="token prefix deleted">-</span>           >\n<span class="token prefix deleted">-</span>             &amp;nbsp;{toLocaleDateString(t.end, dateTimeOptions)}\n<span class="token prefix deleted">-</span>           &lt;/div>\n<span class="token prefix deleted">-</span>         &lt;/div>\n<span class="token prefix deleted">-</span>       );\n<span class="token prefix deleted">-</span>     })}\n<span class="token prefix deleted">-</span>   &lt;/div>\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               if (\n<span class="token prefix inserted">+</span>                 typeof childNode === "object" &amp;&amp;\n<span class="token prefix inserted">+</span>                 !Array.isArray(childNode) &amp;&amp;\n<span class="token prefix inserted">+</span>                 !React.isValidElement(childNode)\n<span class="token prefix inserted">+</span>               ) {\n<span class="token prefix inserted">+</span>                 childNode = null;\n<span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               const { colSpan: cellColSpan, rowSpan: cellRowSpan } =\n<span class="token prefix inserted">+</span>                 cellProps || {};\n<span class="token prefix inserted">+</span>               const mergedColSpan =\n<span class="token prefix inserted">+</span>                 cellColSpan !== undefined ? cellColSpan : item.colSpan;\n<span class="token prefix inserted">+</span>               const mergedRowSpan =\n<span class="token prefix inserted">+</span>                 cellRowSpan !== undefined ? cellRowSpan : item.rowSpan;\n<span class="token prefix inserted">+</span>               if (mergedColSpan === 0 || mergedRowSpan === 0) {\n<span class="token prefix inserted">+</span>                 return null;\n<span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               let title;\n<span class="token prefix inserted">+</span>               const ellipsisConfig =\n<span class="token prefix inserted">+</span>                 item.ellipsis === true\n<span class="token prefix inserted">+</span>                   ? {\n<span class="token prefix inserted">+</span>                       showTitle: true,\n<span class="token prefix inserted">+</span>                     }\n<span class="token prefix inserted">+</span>                   : item.ellipsis;\n<span class="token prefix inserted">+</span>               if (ellipsisConfig &amp;&amp; ellipsisConfig.showTitle) {\n<span class="token prefix inserted">+</span>                 if (\n<span class="token prefix inserted">+</span>                   typeof childNode === "string" ||\n<span class="token prefix inserted">+</span>                   typeof childNode === "number"\n<span class="token prefix inserted">+</span>                 ) {\n<span class="token prefix inserted">+</span>                   title = childNode.toString();\n<span class="token prefix inserted">+</span>                 } else if (\n<span class="token prefix inserted">+</span>                   React.isValidElement(childNode) &amp;&amp;\n<span class="token prefix inserted">+</span>                   // @ts-ignore\n<span class="token prefix inserted">+</span>                   typeof childNode.props.children === "string"\n<span class="token prefix inserted">+</span>                 ) {\n<span class="token prefix inserted">+</span>                   // @ts-ignore\n<span class="token prefix inserted">+</span>                   title = childNode.props.children;\n<span class="token prefix inserted">+</span>                 }\n<span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               return (\n<span class="token prefix inserted">+</span>                 &lt;td\n<span class="token prefix inserted">+</span>                   key={item.key || item.dataIndex}\n<span class="token prefix inserted">+</span>                   className={classnames(\n<span class="token prefix inserted">+</span>                     styles.taskListCell,\n<span class="token prefix inserted">+</span>                     item.ellipsis ? styles.ellipsis : ""\n<span class="token prefix inserted">+</span>                   )}\n<span class="token prefix inserted">+</span>                   style={{\n<span class="token prefix inserted">+</span>                     width: item.width || "auto",\n<span class="token prefix inserted">+</span>                   }}\n<span class="token prefix inserted">+</span>                   colSpan={\n<span class="token prefix inserted">+</span>                     mergedColSpan &amp;&amp; mergedColSpan !== 1\n<span class="token prefix inserted">+</span>                       ? mergedColSpan\n<span class="token prefix inserted">+</span>                       : null\n<span class="token prefix inserted">+</span>                   }\n<span class="token prefix inserted">+</span>                   rowSpan={\n<span class="token prefix inserted">+</span>                     mergedRowSpan &amp;&amp; mergedRowSpan !== 1\n<span class="token prefix inserted">+</span>                       ? mergedRowSpan\n<span class="token prefix inserted">+</span>                       : null\n<span class="token prefix inserted">+</span>                   }\n<span class="token prefix inserted">+</span>                 >\n<span class="token prefix inserted">+</span>                   &lt;div className={styles.taskListNameWrapper}>\n<span class="token prefix inserted">+</span>                     &lt;div\n<span class="token prefix inserted">+</span>                       className={\n<span class="token prefix inserted">+</span>                         expanderSymbol\n<span class="token prefix inserted">+</span>                           ? styles.taskListExpander\n<span class="token prefix inserted">+</span>                           : styles.taskListEmptyExpander\n<span class="token prefix inserted">+</span>                       }\n<span class="token prefix inserted">+</span>                       onClick={() => onExpanderClick(t)}\n<span class="token prefix inserted">+</span>                     >\n<span class="token prefix inserted">+</span>                       {expanderSymbol}\n<span class="token prefix inserted">+</span>                     &lt;/div>\n<span class="token prefix inserted">+</span>                     &lt;div title={title} className={styles.ellipsis}>\n<span class="token prefix inserted">+</span>                       {childNode}\n<span class="token prefix inserted">+</span>                     &lt;/div>\n<span class="token prefix inserted">+</span>                   &lt;/div>\n<span class="token prefix inserted">+</span>                 &lt;/td>\n<span class="token prefix inserted">+</span>               );\n<span class="token prefix inserted">+</span>             })}\n<span class="token prefix inserted">+</span>           &lt;/tr>\n<span class="token prefix inserted">+</span>         );\n<span class="token prefix inserted">+</span>       })}\n<span class="token prefix inserted">+</span>     &lt;/tbody>\n<span class="token prefix inserted">+</span>   &lt;/table>\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span> );\n</span>};</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="样式属性暴露"><a href="#%E6%A0%B7%E5%BC%8F%E5%B1%9E%E6%80%A7%E6%9A%B4%E9%9C%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>样式属性暴露</h2>\n<p>主要功能如下：</p>\n<ol>\n<li>行级斑马线显示</li>\n<li>日期分隔线显示</li>\n<li>行级分隔线显示</li>\n</ol>\n<p>src/components/grid/grid-body.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36982283537878780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  columnWidth: number;\n  todayColor: string;\n  rtl: boolean;\n+  hasCrosswalk: boolean;\n+  hasDateLine: boolean;\n+  renderRowLines: (index: number) => boolean;\n};\n+\nexport const GridBody: React.FC<GridBodyProps> = ({\n  tasks,\n  dates,\n@@ -20,6 +24,9 @@ export const GridBody: React.FC<GridBodyProps> = ({\n  columnWidth,\n  todayColor,\n  rtl,\n+ hasCrosswalk,\n+ hasDateLine,\n+ renderRowLines,\n}) => {\n  let y = 0;\n  const gridRows: ReactChild[] = [];\n@@ -33,27 +40,33 @@ export const GridBody: React.FC<GridBodyProps> = ({\n      className={styles.gridRowLine}\n    />,\n  ];\n- for (const task of tasks) {\n-   gridRows.push(\n-     <rect\n-       key={&quot;Row&quot; + task.id}\n-       x=&quot;0&quot;\n-       y={y}\n-       width={svgWidth}\n-       height={rowHeight}\n-       className={styles.gridRow}\n-     />\n-   );\n-   rowLines.push(\n-     <line\n-       key={&quot;RowLine&quot; + task.id}\n-       x=&quot;0&quot;\n-       y1={y + rowHeight}\n-       x2={svgWidth}\n-       y2={y + rowHeight}\n-       className={styles.gridRowLine}\n-     />\n-   );\n+ for (let i = 0; i < tasks.length; i++) {\n+   const task = tasks[i];\n+   if (hasCrosswalk) {\n+     gridRows.push(\n+       <rect\n+         key={&quot;Row&quot; + task.id}\n+         x=&quot;0&quot;\n+         y={y}\n+         width={svgWidth}\n+         height={rowHeight}\n+         className={styles.gridRow}\n+       />\n+     );\n+   }\n+   const isRenderRowLines = renderRowLines(i);\n+   if (isRenderRowLines) {\n+     rowLines.push(\n+       <line\n+         key={&quot;RowLine&quot; + task.id}\n+         x=&quot;0&quot;\n+         y1={y + rowHeight}\n+         x2={svgWidth}\n+         y2={y + rowHeight}\n+         className={styles.gridRowLine}\n+       />\n+     );\n+   }\n    y += rowHeight;\n  }\n\n@@ -63,16 +76,18 @@ export const GridBody: React.FC<GridBodyProps> = ({\n  let today: ReactChild = <rect />;\n  for (let i = 0; i < dates.length; i++) {\n    const date = dates[i];\n-   ticks.push(\n-     <line\n-       key={date.getTime()}\n-       x1={tickX}\n-       y1={0}\n-       x2={tickX}\n-       y2={y}\n-       className={styles.gridTick}\n-     />\n-   );\n+   if (hasDateLine) {\n+     ticks.push(\n+       <line\n+         key={date.getTime()}\n+         x1={tickX}\n+         y1={0}\n+         x2={tickX}\n+         y2={y}\n+         className={styles.gridTick}\n+       />\n+     );\n+   }\n    if (\n      (i + 1 !== dates.length &&\n        date.getTime() < now.getTime() &&`, `36982283537878780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span> columnWidth: number;\n<span class="token prefix unchanged"> </span> todayColor: string;\n<span class="token prefix unchanged"> </span> rtl: boolean;\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>  hasCrosswalk: boolean;\n<span class="token prefix inserted">+</span>  hasDateLine: boolean;\n<span class="token prefix inserted">+</span>  renderRowLines: (index: number) => boolean;\n</span>};\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>\n</span>export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> tasks,\n<span class="token prefix unchanged"> </span> dates,\n</span>@@ -20,6 +24,9 @@ export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> columnWidth,\n<span class="token prefix unchanged"> </span> todayColor,\n<span class="token prefix unchanged"> </span> rtl,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> hasCrosswalk,\n<span class="token prefix inserted">+</span> hasDateLine,\n<span class="token prefix inserted">+</span> renderRowLines,\n</span>}) => {\n<span class="token unchanged"><span class="token prefix unchanged"> </span> let y = 0;\n<span class="token prefix unchanged"> </span> const gridRows: ReactChild[] = [];\n</span>@@ -33,27 +40,33 @@ export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span>     className={styles.gridRowLine}\n<span class="token prefix unchanged"> </span>   />,\n<span class="token prefix unchanged"> </span> ];\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> for (const task of tasks) {\n<span class="token prefix deleted">-</span>   gridRows.push(\n<span class="token prefix deleted">-</span>     &lt;rect\n<span class="token prefix deleted">-</span>       key={"Row" + task.id}\n<span class="token prefix deleted">-</span>       x="0"\n<span class="token prefix deleted">-</span>       y={y}\n<span class="token prefix deleted">-</span>       width={svgWidth}\n<span class="token prefix deleted">-</span>       height={rowHeight}\n<span class="token prefix deleted">-</span>       className={styles.gridRow}\n<span class="token prefix deleted">-</span>     />\n<span class="token prefix deleted">-</span>   );\n<span class="token prefix deleted">-</span>   rowLines.push(\n<span class="token prefix deleted">-</span>     &lt;line\n<span class="token prefix deleted">-</span>       key={"RowLine" + task.id}\n<span class="token prefix deleted">-</span>       x="0"\n<span class="token prefix deleted">-</span>       y1={y + rowHeight}\n<span class="token prefix deleted">-</span>       x2={svgWidth}\n<span class="token prefix deleted">-</span>       y2={y + rowHeight}\n<span class="token prefix deleted">-</span>       className={styles.gridRowLine}\n<span class="token prefix deleted">-</span>     />\n<span class="token prefix deleted">-</span>   );\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> for (let i = 0; i &lt; tasks.length; i++) {\n<span class="token prefix inserted">+</span>   const task = tasks[i];\n<span class="token prefix inserted">+</span>   if (hasCrosswalk) {\n<span class="token prefix inserted">+</span>     gridRows.push(\n<span class="token prefix inserted">+</span>       &lt;rect\n<span class="token prefix inserted">+</span>         key={"Row" + task.id}\n<span class="token prefix inserted">+</span>         x="0"\n<span class="token prefix inserted">+</span>         y={y}\n<span class="token prefix inserted">+</span>         width={svgWidth}\n<span class="token prefix inserted">+</span>         height={rowHeight}\n<span class="token prefix inserted">+</span>         className={styles.gridRow}\n<span class="token prefix inserted">+</span>       />\n<span class="token prefix inserted">+</span>     );\n<span class="token prefix inserted">+</span>   }\n<span class="token prefix inserted">+</span>   const isRenderRowLines = renderRowLines(i);\n<span class="token prefix inserted">+</span>   if (isRenderRowLines) {\n<span class="token prefix inserted">+</span>     rowLines.push(\n<span class="token prefix inserted">+</span>       &lt;line\n<span class="token prefix inserted">+</span>         key={"RowLine" + task.id}\n<span class="token prefix inserted">+</span>         x="0"\n<span class="token prefix inserted">+</span>         y1={y + rowHeight}\n<span class="token prefix inserted">+</span>         x2={svgWidth}\n<span class="token prefix inserted">+</span>         y2={y + rowHeight}\n<span class="token prefix inserted">+</span>         className={styles.gridRowLine}\n<span class="token prefix inserted">+</span>       />\n<span class="token prefix inserted">+</span>     );\n<span class="token prefix inserted">+</span>   }\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   y += rowHeight;\n<span class="token prefix unchanged"> </span> }\n</span>\n@@ -63,16 +76,18 @@ export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> let today: ReactChild = &lt;rect />;\n<span class="token prefix unchanged"> </span> for (let i = 0; i &lt; dates.length; i++) {\n<span class="token prefix unchanged"> </span>   const date = dates[i];\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   ticks.push(\n<span class="token prefix deleted">-</span>     &lt;line\n<span class="token prefix deleted">-</span>       key={date.getTime()}\n<span class="token prefix deleted">-</span>       x1={tickX}\n<span class="token prefix deleted">-</span>       y1={0}\n<span class="token prefix deleted">-</span>       x2={tickX}\n<span class="token prefix deleted">-</span>       y2={y}\n<span class="token prefix deleted">-</span>       className={styles.gridTick}\n<span class="token prefix deleted">-</span>     />\n<span class="token prefix deleted">-</span>   );\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>   if (hasDateLine) {\n<span class="token prefix inserted">+</span>     ticks.push(\n<span class="token prefix inserted">+</span>       &lt;line\n<span class="token prefix inserted">+</span>         key={date.getTime()}\n<span class="token prefix inserted">+</span>         x1={tickX}\n<span class="token prefix inserted">+</span>         y1={0}\n<span class="token prefix inserted">+</span>         x2={tickX}\n<span class="token prefix inserted">+</span>         y2={y}\n<span class="token prefix inserted">+</span>         className={styles.gridTick}\n<span class="token prefix inserted">+</span>       />\n<span class="token prefix inserted">+</span>     );\n<span class="token prefix inserted">+</span>   }\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   if (\n<span class="token prefix unchanged"> </span>     (i + 1 !== dates.length &amp;&amp;\n<span class="token prefix unchanged"> </span>       date.getTime() &lt; now.getTime() &amp;&amp;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="实现效果"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h1>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/vtuj8t?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<ol>\n<li>ts 写的不够熟练且精简，需要加强</li>\n<li>对于样式属性暴露应该用固定类名去控制，原作者包含很多的 className 属性，非常冗余</li>\n<li>本地源码优化很少涉及到 svg 的优化，需要加强 svg 的学习</li>\n</ol>',
excerpt:"需求背景 由于 PMS 项目需要开发如下图所示的甘特图，需要选择合适的组件来实现此功能 技术选型 选型 优点 缺点 gantt-schedule-timeline-calendar 功能丰富 与 UI 相差较大，定制化代码较多 react-timeline-gantt…",frontmatter:{date:"2021-11-15 11:48:33",path:"/gantt-component-optimization/",tags:"前端, 源码优化, 预研",title:"甘特图组件源码优化",draft:null}}},pathContext:{mainPostPath:"/code-generation-scaffolding/",nextPostPath:"/tweb-learn-note-2021/",prePostPath:"/gantt-component-optimization/"}}}});