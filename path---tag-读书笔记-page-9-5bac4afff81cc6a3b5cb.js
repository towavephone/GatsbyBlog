webpackJsonp([0xd978f8cced47],{1621:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"编码只是开发过程中的一小部分，为了使我们工作更加高效，我们必须学会调试，并擅长调试。 内容概要 文中列举了常用调试技巧，如下： Debugger 在代码中插入   可以在其位置触发断点调试。 Console.dir 使用   命令，可以打印出对象的结构，而   仅能打印返回值，在打印   属性时尤为有用。 ps: 大部分时候，对象返回值就是其结构 使用辅助工具，语法高亮、linting 它可以帮助我们快速定位问题，其实 flow 与 typescript…",html:'<p>编码只是开发过程中的一小部分，为了使我们工作更加高效，我们必须学会调试，并擅长调试。</p>\n<h1 id="内容概要"><a href="#%E5%86%85%E5%AE%B9%E6%A6%82%E8%A6%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内容概要</h1>\n<p>文中列举了常用调试技巧，如下：</p>\n<h2 id="debugger"><a href="#debugger" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debugger</h2>\n<p>在代码中插入 <code class="language-text">debugger</code> 可以在其位置触发断点调试。</p>\n<h2 id="consoledir"><a href="#consoledir" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Console.dir</h2>\n<p>使用 <code class="language-text">console.dir</code> 命令，可以打印出对象的结构，而 <code class="language-text">console.log</code> 仅能打印返回值，在打印 <code class="language-text">document</code> 属性时尤为有用。</p>\n<blockquote>\n<p>ps: 大部分时候，对象返回值就是其结构</p>\n</blockquote>\n<h2 id="使用辅助工具，语法高亮、linting"><a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7%EF%BC%8C%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE%E3%80%81linting" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用辅助工具，语法高亮、linting</h2>\n<p>它可以帮助我们快速定位问题，其实 flow 与 typescript 也起到了很好的调试作用。</p>\n<h2 id="浏览器拓展"><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8B%93%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>浏览器拓展</h2>\n<p>使用类似 <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi" target="_blank" rel="nofollow noreferrer noopener">ReactDTools</a> <a href="https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd" target="_blank" rel="nofollow noreferrer noopener">VueDTools</a> 调试对应框架。</p>\n<h2 id="借助-devtools"><a href="#%E5%80%9F%E5%8A%A9-devtools" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 DevTools</h2>\n<p>Chrome Dev Tools 非常强大，<a href="https://umaar.com/dev-tips/" target="_blank" rel="nofollow noreferrer noopener">dev-tips</a> 列出了 100 多条它可以做的事。</p>\n<h2 id="移动端调试工具"><a href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移动端调试工具</h2>\n<p>最靠谱的应该是 <a href="http://eruda.liriliri.io/" target="_blank" rel="nofollow noreferrer noopener">eruda</a>，可以内嵌在任何 h5 页面，充当 DevTools 控制台的作用。</p>\n<h2 id="实时调试"><a href="#%E5%AE%9E%E6%97%B6%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实时调试</h2>\n<p>不需要预先埋点，比如 <code class="language-text">document.activeElement</code> 可以打印最近 focus 过的元素，因为打开控制台导致失去焦点，但我们可以通过此 api 获取它。</p>\n<h2 id="结构化打印对象瞬时状态"><a href="#%E7%BB%93%E6%9E%84%E5%8C%96%E6%89%93%E5%8D%B0%E5%AF%B9%E8%B1%A1%E7%9E%AC%E6%97%B6%E7%8A%B6%E6%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结构化打印对象瞬时状态</h2>\n<p><code class="language-text">JSON.stringify(obj, null, 2)</code> 可以结构化打印出对象，因为是字符串，不用担心引用问题。</p>\n<h2 id="数组调试"><a href="#%E6%95%B0%E7%BB%84%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数组调试</h2>\n<p>通过 <code class="language-text">Array.prototype.find</code> 快速寻找某个元素。</p>\n<h1 id="精读"><a href="#%E7%B2%BE%E8%AF%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>精读</h1>\n<p>本精读由 <a href="https://github.com/rccoder" target="_blank" rel="nofollow noreferrer noopener">rccoder</a> <a href="https://github.com/ascoders" target="_blank" rel="nofollow noreferrer noopener">ascoders</a> <a href="https://github.com/NE-SmallTown" target="_blank" rel="nofollow noreferrer noopener">NE-SmallTown</a> <a href="https://github.com/BlackGanglion" target="_blank" rel="nofollow noreferrer noopener">BlackGanglion</a> <a href="https://github.com/jasonslyvia" target="_blank" rel="nofollow noreferrer noopener">jasonslyvia</a> <a href="https://github.com/alcat2008" target="_blank" rel="nofollow noreferrer noopener">alcat2008</a> <a href="https://github.com/DanielWLam" target="_blank" rel="nofollow noreferrer noopener">DanielWLam</a> <a href="https://github.com/HsuanXyz" target="_blank" rel="nofollow noreferrer noopener">HsuanXyz</a> <a href="https://github.com/huxiaoyun" target="_blank" rel="nofollow noreferrer noopener">huxiaoyun</a> <a href="https://github.com/vagusX" target="_blank" rel="nofollow noreferrer noopener">vagusX</a> 讨论而出。</p>\n<h2 id="移动端真机测试"><a href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%9C%9F%E6%9C%BA%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移动端真机测试</h2>\n<p>由于 webview 不一定支持连接 chrome 控制台调试，只有真机测试才能复现真实场景。</p>\n<p><a href="https://www.browserstack.com/" target="_blank" rel="nofollow noreferrer noopener">browserstack</a> <a href="https://www.dynatrace.com/platform/offerings/customer-experience-monitoring/" target="_blank" rel="nofollow noreferrer noopener">dynatrace</a> 都是真机测试平台，公司内部应该也会搭建这种平台。</p>\n<h2 id="移动端控制台"><a href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%8E%A7%E5%88%B6%E5%8F%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移动端控制台</h2>\n<ul>\n<li><a href="https://developers.google.com/web/tools/chrome-devtools/remote-debugging/webviews" target="_blank" rel="nofollow noreferrer noopener">Chrome 远程调试</a> app 支持后，连接 usb 或者局域网，即可通过 Dev Tools 调试 webview 页面。</li>\n<li><a href="http://people.apache.org/~pmuellr/weinre/docs/latest/Home.html" target="_blank" rel="nofollow noreferrer noopener">Weinre</a> 通过页面加载脚本，与 pc 端调试器通信。</li>\n<li>通过内嵌控制台解决，比如 <a href="http://eruda.liriliri.io/" target="_blank" rel="nofollow noreferrer noopener">eruda</a> <a href="https://github.com/WechatFE/vConsole" target="_blank" rel="nofollow noreferrer noopener">VConsole</a></li>\n<li><a href="http://alloyteam.github.io/Rosin/" target="_blank" rel="nofollow noreferrer noopener">Rosin</a> fiddler 的一个插件，协助移动页面调试。</li>\n<li><a href="https://jsconsole.com/" target="_blank" rel="nofollow noreferrer noopener">jsconsole</a> 在本地部署后，手机访问对应 ip，可以测试对应浏览器的控制台。</li>\n</ul>\n<h2 id="请求代理"><a href="#%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>请求代理</h2>\n<p><a href="http://www.charlesproxy.com/" target="_blank" rel="nofollow noreferrer noopener">charles</a> <a href="http://www.telerik.com/fiddler" target="_blank" rel="nofollow noreferrer noopener">Fiddler</a> 可以抓包，更重要是可以代理请求。假数据、边界值测试、开发环境代码加载，每一项都非常有用。</p>\n<h2 id="定制-chrome-拓展"><a href="#%E5%AE%9A%E5%88%B6-chrome-%E6%8B%93%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>定制 Chrome 拓展</h2>\n<p>对于特定业务场景也可以通过开发 chrome 插件来做，比如分析自己网站的结构、版本、代码开发责任人、一键切换开发环境。</p>\n<h2 id="在用户设备调试"><a href="#%E5%9C%A8%E7%94%A8%E6%88%B7%E8%AE%BE%E5%A4%87%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在用户设备调试</h2>\n<p>把控制台输出信息打到服务器，本地通过与服务器建立 socket 链接实时查看控制台信息。要知道实时根据用户 id 开启调试信息，并看用户真是环境的控制台打印信息是非常有用的，能解决很多难以复现问题。</p>\n<p>代码中可以使用封装过的 <code class="language-text">console.log</code>，当服务端开启调试状态后，对应用户网页会源源不断打出 log。</p>\n<h2 id="dom-断点、事件断点"><a href="#dom-%E6%96%AD%E7%82%B9%E3%80%81%E4%BA%8B%E4%BB%B6%E6%96%AD%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 断点、事件断点</h2>\n<ul>\n<li>DOM 断点，在 dom 元素右键，选择 （Break on subtree modifications），可以在此 dom 被修改时触发断点，在不确定 dom 被哪段 js 脚本修改时可能有用。</li>\n<li>Event Listener Breakpoints，神器之一，对于任何事件都能进入断点，比如 click，touch，script 事件统统能监听。</li>\n</ul>\n<h2 id="使用错误追踪平台"><a href="#%E4%BD%BF%E7%94%A8%E9%94%99%E8%AF%AF%E8%BF%BD%E8%B8%AA%E5%B9%B3%E5%8F%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用错误追踪平台</h2>\n<p>对错误信息采集、分析、报警是很必要的，这里有一些对外服务：<a href="https://sentry.io/welcome/" target="_blank" rel="nofollow noreferrer noopener">sentry</a> <a href="https://trackjs.com/" target="_blank" rel="nofollow noreferrer noopener">trackjs</a></p>\n<h2 id="黑盒调试"><a href="#%E9%BB%91%E7%9B%92%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>黑盒调试</h2>\n<p>SourceMap 可以精准定位到代码，但有时候报错是由某处代码统一抛出的，比如 <a href="https://github.com/zertosh/invariant" target="_blank" rel="nofollow noreferrer noopener">invariant</a> 让人又爱又恨的库，所有定位全部跑到这个库里了（要你有何用），这时候，可以在 DevTools 源码中右键，选中 <code class="language-text">BlackBox Script</code>，它就变成黑盒了，下次 log 的定位将会是准确的。</p>\n<p><a href="https://hacks.mozilla.org/2013/08/new-features-of-firefox-developer-tools-episode-25/" target="_blank" rel="nofollow noreferrer noopener">FireFox</a>、<a href="https://umaar.com/dev-tips/128-blackboxing/" target="_blank" rel="nofollow noreferrer noopener">Chrome</a>。</p>\n<h2 id="删除无用的-css"><a href="#%E5%88%A0%E9%99%A4%E6%97%A0%E7%94%A8%E7%9A%84-css" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除无用的 css</h2>\n<p>css 不像 js 一样方便分析规则是否存在冗余，Chrome 帮我们做了这件事：<a href="https://umaar.com/dev-tips/126-css-tracker/" target="_blank" rel="nofollow noreferrer noopener">CSS Tracker</a>。</p>\n<h2 id="在-chrome-快速查找元素"><a href="#%E5%9C%A8-chrome-%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 Chrome 快速查找元素</h2>\n<p>Chrome 会记录最后插入的 5 个元素，分别以 <code class="language-text">$0</code> ~ <code class="language-text">$4</code> 的方式在控制台直接输出。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-06-05-15-38-56-c694d891260fc0b4fcf948ed7a986706-27a9d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 417px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 123.74100719424462%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsSAAALEgHS3X78AAACdUlEQVQ4y5VT23KbMBDl79sP6E90+toPSDJ9ycXGTmhiYyfG3OyAQELoLoG72J0001ycHHaE0Go5u3skj3HGOKctxXtQSpumgZExBmO7x2Hl4ILPwzqMnj/2g2lwdXl1enZ6cnY69seAyWQShqHv+0EQLJfL0WgMk/l8fnl5NZvNptOp70+ur6+9YlMUiwJntWgF2RJOmDFGa23gUdo8g7X2aT5sMMZjgpXzxzIoLLemsU643YfhVVWVxVl6m1RFgVFelSjP6zxD1RahDcI1fgceuElD8uUmCxfR9Cy6WZxfZJNRkgTr+GZdoQqTt4N3/ZCAxEqUFYkDuqnDJUtjLgveprTv+vfS7vvBzQrOCoTXNzQvl/dtvGpoSkhMnHX9rn8LXtd1RhnYJzA3SlZYPSKJqelc54zr34WXpFlRllGU1CWK8ubrj+TL9/jbz1wqDcroZ8K8hJdlebSO4ySZh+HdPDyfLk7Og18XwSpaB79v7+5mDw+rugYpgOJ/eGmaglplibbbbbRaZWlcoccG17B5FcVxmq3jtGXMOWdfwIMzjAmxzkFfrevgFHXd0KSu76RWUg4G3te7Db8UXOpWyaaUGJFal0hxImUtnDpy2jxoBiHUamu1sEAjrBDWKGul6Wz31NjXg401kitFlSSlqBGuVInknplbZT/C3ICkDpgFV9JxAbSDAfORYLhpksmBeV8zrj/DDFq3lDntrORgUjio2cKnMMeZQS7Wct1qRWtF6gZrjLWERLB0+gPMGJO/3ZZCCcshX26GbrtjzMo4iDTcyKaCmhsCOkvRKEXk8ZrhzrljDG8G/5v2h5s7vHcH+0Tw5/EHZgKcJ/7jwdwAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 06 05 15 38 56" title="" data-src="/static/2019-06-05-15-38-56-c694d891260fc0b4fcf948ed7a986706-27a9d.png" data-srcset="/static/2019-06-05-15-38-56-c694d891260fc0b4fcf948ed7a986706-6fc91.png 200w,\n/static/2019-06-05-15-38-56-c694d891260fc0b4fcf948ed7a986706-7d566.png 400w,\n/static/2019-06-05-15-38-56-c694d891260fc0b4fcf948ed7a986706-27a9d.png 417w" data-sizes="(max-width: 417px) 100vw, 417px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="consoletable"><a href="#consoletable" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Console.table</h2>\n<p>以表格形式打印，对于对象数组尤为合适。</p>\n<h2 id="监听特定函数调用"><a href="#%E7%9B%91%E5%90%AC%E7%89%B9%E5%AE%9A%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>监听特定函数调用</h2>\n<p><code class="language-text">monitor</code> 有点像 <code class="language-text">proxy</code>，用 <code class="language-text">monitor</code> 包裹住的 function，在其调用后，会在控制台输出其调用信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41572100941055280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`> function func(num){}\n> monitor(func)\n> func(3)\n// < function func called with arguments: 3`, `41572100941055280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="javascript"\n              >\n                <span class="gatsby-code-button-language">javascript</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token operator">></span> <span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token operator">></span> <span class="token function">monitor</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>\n<span class="token operator">></span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>\n<span class="token comment">// &lt; function func called with arguments: 3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模拟发送请求利器-postman"><a href="#%E6%A8%A1%E6%8B%9F%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E5%88%A9%E5%99%A8-postman" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模拟发送请求利器 PostMan</h2>\n<p><a href="https://www.getpostman.com/products" target="_blank" rel="nofollow noreferrer noopener">PostMan</a>, FireFox 控制台 Network 也支持此功能。</p>\n<h2 id="找到控制台最后一个对象"><a href="#%E6%89%BE%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>找到控制台最后一个对象</h2>\n<p>有了 <code class="language-text">$_</code>，我们就不需要定义新的对象来打印值了，比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47117506286512860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`> [1, 2, 3, 4]\n< [1, 2, 3, 4]\n> \\$_.length\n// < 4`, `47117506286512860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="javascript"\n              >\n                <span class="gatsby-code-button-language">javascript</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>\n<span class="token operator">&lt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>\n<span class="token operator">></span> $_<span class="token punctuation">.</span>length\n<span class="token comment">// &lt; 4</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>更多控制台相关技巧可以查看：<a href="https://developers.google.com/web/tools/chrome-devtools/console/command-line-reference?utm_source=dcc&#x26;utm_medium=redirect&#x26;utm_campaign=2016q3" target="_blank" rel="nofollow noreferrer noopener">command-line-reference</a>。</p>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>虽然在抛砖引玉，但整理完之后发现仍然是块砖头，调试技巧繁多，里面包含了通用的、不通用的，精读不可能一一列举。希望大家能根据自己的业务场景，掌握相关的调试技巧，让工作更加高效。</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/前端调试技巧/index.md absPath of file >>> MarkdownRemark",timeToRead:6,frontmatter:{date:"2019-06-05 15:37:02",path:"/frontend-debug-skill/",tags:"前端, 调试, 读书笔记",title:"前端调试技巧",draft:null}},{excerpt:"通用篇 复制与保存 copy 方法 可以通过全局的方法   在   里   任何你能拿到的资源 存储为一个全局变量 如果你在   中打印了一堆数据 (例如你在 App 中计算出来的一个数组)，然后你想对这些数据做一些额外的操作比如我们刚刚说的   (在不影响它原来值的情况下)。那就可以将它转换成一个全局变量，只需要右击它，并选择 “Store as global variable” (保存为全局变量) 选项。 第一次使用的话，它会创建一个名为 temp1 的变量，第二次创建 temp…",html:'<h1 id="通用篇"><a href="#%E9%80%9A%E7%94%A8%E7%AF%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>通用篇</h1>\n<h2 id="复制与保存"><a href="#%E5%A4%8D%E5%88%B6%E4%B8%8E%E4%BF%9D%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>复制与保存</h2>\n<h3 id="copy-方法"><a href="#copy-%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>copy 方法</h3>\n<p>可以通过全局的方法 <code class="language-text">copy()</code> 在 <code class="language-text">console</code> 里 <code class="language-text">copy</code> 任何你能拿到的资源</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-11-19-27-08-6ebc51c3dd827c66ec59c745a9eb7333-19a4b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 435px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.4367816091954%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAhklEQVQoz52OSQ7DIBAE+f8zCSCzIyAsNglpKx8A16E1h6npIZRSxpgQAimlzDnHGNMaxBhzHAdMzrlzrpQCf0NGIXylFAYkTiz6t4xOxl4Ag9Z6Q/beW2uUMtbaEEJrDZ+/1yDYbrWN6zNvvn/mGqTUM6Uagu+9z03IeQ10e+eeyGOM+ZQfOnUH5m+1RGgAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 11 19 27 08" title="" data-src="/static/2019-03-11-19-27-08-6ebc51c3dd827c66ec59c745a9eb7333-19a4b.png" data-srcset="/static/2019-03-11-19-27-08-6ebc51c3dd827c66ec59c745a9eb7333-5fb9b.png 200w,\n/static/2019-03-11-19-27-08-6ebc51c3dd827c66ec59c745a9eb7333-56ca1.png 400w,\n/static/2019-03-11-19-27-08-6ebc51c3dd827c66ec59c745a9eb7333-19a4b.png 435w" data-sizes="(max-width: 435px) 100vw, 435px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="存储为一个全局变量"><a href="#%E5%AD%98%E5%82%A8%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>存储为一个全局变量</h3>\n<p>如果你在 <code class="language-text">console</code> 中打印了一堆数据 (例如你在 App 中计算出来的一个数组)，然后你想对这些数据做一些额外的操作比如我们刚刚说的 <code class="language-text">copy</code> (在不影响它原来值的情况下)。那就可以将它转换成一个全局变量，只需要右击它，并选择 “Store as global variable” (保存为全局变量) 选项。</p>\n<p>第一次使用的话，它会创建一个名为 temp1 的变量，第二次创建 temp2，第三次 … 。通过使用这些变量来操作对应的数据，不用再担心影响到他们原来的值</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-11-19-29-25-46b34883f590c591821921a69677c2ee-344e0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 307px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 57.32899022801303%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA8UlEQVQoz6WRzW6DMBCE/f4P1UptSJMeqsAZKTgKPkCAYBtj8F8n0OaQUomqn6zV2tbu2LOkaZq6rhGv1xaxqirOuVgHKYoiz3N6AreQpinqccFXQLTWQoq+E6IdnLPOObMaYq2RQptBG+PDHyFo0EkDSe+xgpuYE2vn/FduxVKKQfG6EpdyKIoLbOPtCP8Ya/B3KMwtFpS9sy349kDKTik1m9lNzAmurLWPxf3oVa/LssyOx2jzmiTxx+EQvW2i3TZO4vf9/unlOaMZpRQS91d8PVuP2AeMBwM7T5wm7lvAGMMJ5vKoHP4BWTIiLNrzk09A7HomshCAPQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 11 19 29 25" title="" data-src="/static/2019-03-11-19-29-25-46b34883f590c591821921a69677c2ee-344e0.png" data-srcset="/static/2019-03-11-19-29-25-46b34883f590c591821921a69677c2ee-73b08.png 200w,\n/static/2019-03-11-19-29-25-46b34883f590c591821921a69677c2ee-344e0.png 307w" data-sizes="(max-width: 307px) 100vw, 307px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="保存堆栈信息"><a href="#%E4%BF%9D%E5%AD%98%E5%A0%86%E6%A0%88%E4%BF%A1%E6%81%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>保存堆栈信息</h3>\n<p>大多数情况下都不是一个人开发一个项目，而是一个团队协作，那么如何准确的描述问题，就成为了沟通的关键，这时候 <code class="language-text">console</code> 打印出来的堆栈跟踪的信息对你和同事来说就起大作用了，可以省去很多沟通成本，所以你可以直接把堆栈跟踪的信息保存为一个文件，而不只是截图发给对方</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-11-19-30-29-78b0b5b8c0e8552961f19d0f5b95b52f-cf56a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 353px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.35694050991502%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABTklEQVQoz41SXW+DIBTl//+4Lm2yPfShSysCIogonwqyq223tVmWHg83QO7JgSMI4/pyqTDGp9NJCOG9H18GUp2oqkuvVMs52RBjnF8DOhyZtXOcYwjRgW8Iy7KU14DwsZqFKtaWGEsIt+pc8b44v1Zg8MmYBXoeiRJnyRrVUIpxyxtOKauJ4BzmnRQd5zBvCJnjNDZNFqIo9U2UtU45e2c6KZXWUkpCad9rBTHoXgrZKdUwlpYiCEkg1rr0/ZUoK5VScsYOwwBXhmpG83y5LQVR16ltV9lv57wsSsoa11IpSgmjdJqmNCfYvyHnVQzOXVfGsQzDlSjntecu7kFMakIwPn+enQ93481ZCDjjQ9qwNtZasxbnnF3hPHxuHf6OEALnPG9H+BHDv4bdj/f33e5tf9iDa9vCe/kDVVU9PQEEa0iYMdb8C2iAtqccvwDmt61tWnlJ6AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 11 19 30 29" title="" data-src="/static/2019-03-11-19-30-29-78b0b5b8c0e8552961f19d0f5b95b52f-cf56a.png" data-srcset="/static/2019-03-11-19-30-29-78b0b5b8c0e8552961f19d0f5b95b52f-da624.png 200w,\n/static/2019-03-11-19-30-29-78b0b5b8c0e8552961f19d0f5b95b52f-cf56a.png 353w" data-sizes="(max-width: 353px) 100vw, 353px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="直接-copy-html"><a href="#%E7%9B%B4%E6%8E%A5-copy-html" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直接 Copy HTML</h3>\n<p>几乎所有人都知道，右击或者点击在 <code class="language-text">HTML</code> 元素边上的省略号 (…) 就可以将它 <code class="language-text">copy</code> 到剪贴板中，但是你不知道的是：古老的 <code class="language-text">[ctrl] + [c]</code> 大法依旧可用！</p>\n<h2 id="快捷键"><a href="#%E5%BF%AB%E6%8D%B7%E9%94%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>快捷键</h2>\n<h3 id="切换-devtools-窗口的展示布局"><a href="#%E5%88%87%E6%8D%A2-devtools-%E7%AA%97%E5%8F%A3%E7%9A%84%E5%B1%95%E7%A4%BA%E5%B8%83%E5%B1%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>切换 DevTools 窗口的展示布局</h3>\n<p>快捷键 <code class="language-text">ctrl + shift + D (⌘ + shift + D Mac)</code> 来实现位置的切换（通常是从 <code class="language-text">开始的位置</code> 到 <code class="language-text">右边位置</code>， 但是如果一开始就是 <code class="language-text">右边的位置</code> 那么会切换到 <code class="language-text">左边的位置</code>）</p>\n<h3 id="切换-devtools-的面板"><a href="#%E5%88%87%E6%8D%A2-devtools-%E7%9A%84%E9%9D%A2%E6%9D%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>切换 DevTools 的面板</h3>\n<ul>\n<li>按下 <code class="language-text">ctrl + [ 和 ctrl + ]</code> 可以从当前面板的分别向左和向右切换面板</li>\n<li>按下 <code class="language-text">ctrl + 1</code> 到 <code class="language-text">ctrl + 9</code>可以直接转到编号 1…9 的面板(<code class="language-text">ctrl + 1</code>转到元素面板，<code class="language-text">ctrl + 4</code> 转到 网络信息面板等等)</li>\n</ul>\n<h3 id="递增递减"><a href="#%E9%80%92%E5%A2%9E%E9%80%92%E5%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>递增/递减</h3>\n<p>通过使用 <code class="language-text">带有</code> 或者 <code class="language-text">不带有修饰键</code> 的 <code class="language-text">上 / 下</code> 箭头按键， 你可以实现递增和递减 <code class="language-text">0.1</code> ， <code class="language-text">1</code> 或者 <code class="language-text">10</code> 这样数值类型的值</p>\n<p><code class="language-text">ctrl + 上 / 下</code>递增和递减 100，<code class="language-text">shift + 上 / 下</code>递增和递减 10</p>\n<h3 id="elements，-logs，-sources--network-中的查找"><a href="#elements%EF%BC%8C-logs%EF%BC%8C-sources--network-%E4%B8%AD%E7%9A%84%E6%9F%A5%E6%89%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>elements， logs， sources &#x26; network 中的查找</h3>\n<p>DevTools 中的前 4 个主要的面板，每一个都支持 <code class="language-text">[ctrl] + [f]</code> 快捷方式，你可以使用对应的查询方式来查找信息:</p>\n<ul>\n<li>在 <code class="language-text">Elements</code> 面板中 - 通过 <code class="language-text">string</code>，<code class="language-text">选择器</code> 或者 <code class="language-text">XPath</code> 来查找</li>\n<li>而在 <code class="language-text">Console</code>， <code class="language-text">Network</code> 以及 <code class="language-text">Source</code> 面板 - 通过区分大小写，或者可以被视为表达式的 <code class="language-text">strings</code> 来查找</li>\n</ul>\n<h2 id="使用-command"><a href="#%E4%BD%BF%E7%94%A8-command" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 Command</h2>\n<p>快捷键 <code class="language-text">Ctrl + Shift + P</code></p>\n<h3 id="截屏"><a href="#%E6%88%AA%E5%B1%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>截屏</h3>\n<p>节点截图与全屏截图</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-11-19-39-13-b42634b770a179e5836aa76c451a5d98-50124.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 545px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 68.62385321100916%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB5ElEQVQoz41TSW/TQBidX8mZP8A/4AwSEiABvSGkHnJhvVSiQpCWiCakdbrRxDFOlDiO45nEy8zY41m8hEnCoWobqU9Po6dP+la9AQmlEUKCc7GGlFLcD4wxkEk5jiNZqiJXq1Qp1f2Q5zno+YtHx279ynNH7sRxptMpjmMcxSTGBOOVvsZNRL9hEHieB2Yoev+h+fbdYeePLwsZYJLwjLBU5KpabgXjfDAcAnXRJK8fiN2HWftH0O4smi1sGPGxEZ+ckM5p3usXpnWDlWUnxqlnDwDab+4+7bb27DRExEcEIoIQ9mGRpBXL7mDKlvosI4f2TDBvnNV2psZPn1UikSqRkkrBy3LrxNVqmyIImW2D+bdG7fn+r88HxLawZcd9S0zcJUSVDzXLmX+T3qxCc9U12WAIQnf46eureqOGu+b8/Dyx/qqxI0djTS3KiXsnlTNhNAH6sHvt7xfDPhMqoIRyngie5TlTikm5bfaiLFmWgQVDLy6fHfkHJVcIQpamtzdcvdepk3V17bA5id7UP35p/YaQEqKtgPM1Nh7aiPLW/YqiyHRnH6Yvd8zHT84OjyZSJNpCYRjoGukaujylVOev2/+H1jqi4yBNxVUfXvbQ1IviONIIw5AQsra53PZVdFvO+T/GPwtTIMIYkQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 11 19 39 13" title="" data-src="/static/2019-03-11-19-39-13-b42634b770a179e5836aa76c451a5d98-50124.png" data-srcset="/static/2019-03-11-19-39-13-b42634b770a179e5836aa76c451a5d98-805e3.png 200w,\n/static/2019-03-11-19-39-13-b42634b770a179e5836aa76c451a5d98-95560.png 400w,\n/static/2019-03-11-19-39-13-b42634b770a179e5836aa76c451a5d98-50124.png 545w" data-sizes="(max-width: 545px) 100vw, 545px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<blockquote>\n<p>注：节点截图有时会失效，全屏截图暂时没有遇到问题，建议大家使用后者。</p>\n</blockquote>\n<h3 id="快速切换面板"><a href="#%E5%BF%AB%E9%80%9F%E5%88%87%E6%8D%A2%E9%9D%A2%E6%9D%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>快速切换面板</h3>\n<p>输入 layout ，你会看到 2 到 3 个选项</p>\n<ul>\n<li>使用横向面板布局</li>\n<li>使用纵向面板布局</li>\n<li>使用自动面板布局</li>\n</ul>\n<h3 id="快速切换主题"><a href="#%E5%BF%AB%E9%80%9F%E5%88%87%E6%8D%A2%E4%B8%BB%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>快速切换主题</h3>\n<p>输入 theme 切换主题</p>\n<h2 id="代码块的使用"><a href="#%E4%BB%A3%E7%A0%81%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码块的使用</h2>\n<h3 id="snippets"><a href="#snippets" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Snippets</h3>\n<p>它允许你存放 JavaScript 代码到 DevTools 中，方便你复用这些 JavaScript 代码块，进入到 Sources 面板，在导航栏里选中 Snippets 这栏，点击 New snippet(新建一个代码块) ，然后输入你的代码之后保存，大功告成！现在你可以通过右击菜单或者快捷键： <code class="language-text">[ctrl] + [enter]</code> 来运行它了：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-11-19-51-46-f714b3483e73f787601817c86e2c52c7-55e1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 689px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 57.61973875181423%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABKElEQVQoz42Si46DIBBF+f8vtK3b1ioyyFuwDyN1rzabdDfZxhOYQJxhbu7IjFaibdVCp7Te1+LUSilJa40rEVnnSHaIghaMMUQSX5HESk5lQ96HlGIfozL22HYnTsm6ZE10rlcaKyiVQrg/7rc3WHEoT9VFCLRvOeex78cpG23owrXQxDvFlYYWLmNIwzDmnOcfGGR45xCttYjX63Wen/O6/yzsnJ/zG2wYhvQGisdxnKYpTwv5I8xo7b3vV2KMOHcr8AYehv9BPitqqX1Ae5Ti/ip4SfgA2jjnWLHbFUXRNM3LfTiH5luK4RE77A/lVwmf4XZd13gPlXFV8QEkII2J6tgKgtHrsBagvN8GO58rSLXWWYuRWbx32wyrLjX+jjTcnr9GuIlvdWGo2lk/saYAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 11 19 51 46" title="" data-src="/static/2019-03-11-19-51-46-f714b3483e73f787601817c86e2c52c7-55e1c.png" data-srcset="/static/2019-03-11-19-51-46-f714b3483e73f787601817c86e2c52c7-f8f03.png 200w,\n/static/2019-03-11-19-51-46-f714b3483e73f787601817c86e2c52c7-d8034.png 400w,\n/static/2019-03-11-19-51-46-f714b3483e73f787601817c86e2c52c7-55e1c.png 689w" data-sizes="(max-width: 689px) 100vw, 689px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="运行其他来源的代码块"><a href="#%E8%BF%90%E8%A1%8C%E5%85%B6%E4%BB%96%E6%9D%A5%E6%BA%90%E7%9A%84%E4%BB%A3%E7%A0%81%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行其他来源的代码块</h3>\n<p>预设了 Snippets 之后，使用 Command Menu 才是最快的方式，只需在它的输入框中输入 ! ，就可以根据名字来筛选预设代码块：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-11-19-53-43-647ac87f1111b6a9056faa4220e5c755-4de50.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 22.25042301184433%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAg0lEQVQI13WP3QrDMAhG8/7PuJuxdilJavxLDKOw2RbGoOxwLvxARUNc0rJi773tqKp89eiKSLvg/cwc0iOmmNcMUApUqdQrNThca2NuCJWI+AIiBgUSnwFT1gQ2l/EsY86uTdmYbHtt7z+E230iJFH29WZ92M44HebfMJNfrj/IgRcfYHzkHcMGhFcAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 11 19 53 43" title="" data-src="/static/2019-03-11-19-53-43-647ac87f1111b6a9056faa4220e5c755-fee1c.png" data-srcset="/static/2019-03-11-19-53-43-647ac87f1111b6a9056faa4220e5c755-a67b7.png 200w,\n/static/2019-03-11-19-53-43-647ac87f1111b6a9056faa4220e5c755-0b187.png 400w,\n/static/2019-03-11-19-53-43-647ac87f1111b6a9056faa4220e5c755-fee1c.png 800w,\n/static/2019-03-11-19-53-43-647ac87f1111b6a9056faa4220e5c755-4de50.png 1182w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<blockquote>\n<p>查找预设代码块 有时候会出现失效的情况</p>\n</blockquote>\n<p>以上更新于<code class="language-text">2019-3-11 20:02:21</code></p>\n<hr>\n<h1 id="控制台篇"><a href="#%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%AF%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>控制台篇</h1>\n<h2 id="console-中的-"><a href="#console-%E4%B8%AD%E7%9A%84-" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>console 中的 &#x26;</h2>\n<h3 id="0"><a href="#0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>&#x26;0</h3>\n<p>在 Chrome 的 Elements 面板中， $0 是对我们当前选中的 html 节点的引用。</p>\n<p>理所当然，<code class="language-text">$1</code> 是对上一次我们选择的节点的引用，$2 是对在那之前选择的节点的引用等等，一直到 <code class="language-text">$4</code></p>\n<p>你可以尝试一些相关操作(例如: <code class="language-text">$1.appendChild($0)</code>)</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-15-00-13-31-32c616c759a00d87f7915c889d3bf1c0-7a146.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.51492537313432%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABY0lEQVQoz42R227CMAyG8/4vxcRAA8GglMO0SYhBC7RJmlOTNqVJmQubpqFt4rtwLNvJbzto1O8MZs/j6SIIl4vFahYup8G81x8+9ofd3uChN+h0+0/D0WQaQmo8mU2CMJivpuFqMlsiipmgMooxzmRRFOaCLYECbGWtMbqqKqM1hCB1OB7j/UEJqYRAjLD4dW9NWwdFp9+AeF3X4DhXEybX232aJARjxBjbvGzwAdMsozTj/wLFQnDQ19pAI8gIrYg8N41z/nwHQkiRZaJ9iCNypHGUkCSjhOZ53k78Ofg3xYWrnyvF05QRSjBB79vobb09pljnuZQSGovjmFKqtb7eAQciu12EMRYA50JKrfNoFyGlFGzVWluALVsLJ+ym+cJ7X19wP4EIKkyhOPQLAlpKJYU62ZOr3T3zIxCiuN0z47zVLE+Nb26Kmj9A8LuKgWKrDfso89I739wHct7fKJzv5gMsCqtEM7/lEQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 15 00 13 31" title="" data-src="/static/2019-03-15-00-13-31-32c616c759a00d87f7915c889d3bf1c0-fee1c.png" data-srcset="/static/2019-03-15-00-13-31-32c616c759a00d87f7915c889d3bf1c0-a67b7.png 200w,\n/static/2019-03-15-00-13-31-32c616c759a00d87f7915c889d3bf1c0-0b187.png 400w,\n/static/2019-03-15-00-13-31-32c616c759a00d87f7915c889d3bf1c0-fee1c.png 800w,\n/static/2019-03-15-00-13-31-32c616c759a00d87f7915c889d3bf1c0-7a146.png 1072w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="-和-"><a href="#-%E5%92%8C-" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>&#x26; 和 &#x26;&#x26;</h3>\n<p>如果你没有在 App 中定义过 <code class="language-text">$</code> 变量 (例如 jQuery )的话，它在 console 中就是对这一大串函数 document.querySelector 的别名。</p>\n<p>如果是 <code class="language-text">$$</code> 就更加厉害了，还能节省更多的时间，因为它不仅执行 <code class="language-text">document.QuerySelectorAll</code> 并且它返回的是：一个节点的 数组 ，而不是一个 Node list</p>\n<p>本质上来说 <code class="language-text">Array.from(document.querySelectorAll(&#39;div&#39;)) === $$(&#39;div&#39;)</code> ，但是<code class="language-text">document.querySelectorAll(&#39;div&#39;)</code> 和 <code class="language-text">$$(&#39;div&#39;)</code> 哪一种方式更加优雅呢？</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-15-00-17-13-c8839962a92ab6aab52ed358832eb45d-042f3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.13725490196078%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAAA6klEQVQoz5VQ0ZKDIBDj/3+xd0pVEBewKjhaFWywPe/mntoM4ySQTXZk/eBijOsBkBACyJKwgoeY5H1ZtrABid+XdB3jvu9MUddQI6SStXLO2fYGUpQVvxZd37vRl6XIMm6MbUjjVELeug5BmGeiVsu6btsrGKkgqEXDU66HxCanB/LVLGpbFoVAoJDa2GFwqiEh6yzn6PHjiG/OC+xi25a0qVUDwzTNabiUcsDCX5fJe6Q9I98Ea21L39oIk9QxGH9wmk7574lpIs/z4crxS/9a3wHz3ptca06ud3QhW9kP1p7n6bctxI/wAJsvCiACmnukAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 15 00 17 13" title="" data-src="/static/2019-03-15-00-17-13-c8839962a92ab6aab52ed358832eb45d-fee1c.png" data-srcset="/static/2019-03-15-00-17-13-c8839962a92ab6aab52ed358832eb45d-a67b7.png 200w,\n/static/2019-03-15-00-17-13-c8839962a92ab6aab52ed358832eb45d-0b187.png 400w,\n/static/2019-03-15-00-17-13-c8839962a92ab6aab52ed358832eb45d-fee1c.png 800w,\n/static/2019-03-15-00-17-13-c8839962a92ab6aab52ed358832eb45d-042f3.png 816w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="_"><a href="#_" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>&#x26;_</h3>\n<p>调试的过程中，你经常会通过打印查看一些变量的值，但如果你想看一下上次执行的结果呢？再输一遍表达式吗？</p>\n<p>这时候 <code class="language-text">$_</code> 就派上了用场，<code class="language-text">$_</code> 是对上次执行的结果的 引用 ：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-15-00-18-52-0b97562f9af9404307cf5e5af9845d66-2cb88.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.77880184331797%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABKklEQVQoz42P63KDIBCFff+Hy7SdNo0aId5iBIUFb4BgujWTn+n0m2UHlt3DIWqapiiKPM9xMwwDISTLsjRNOedaqzSJk/hEsvOg1aPhgdZaShl1XccYq6oKs1Kq73u+g3dVp5K6i0v2XbTXHjhnWNRPhBBRkiRlWWbnM6UUZ9DCNE0PbQFKgAY91jfWCXk4HCi9YB0tAEBd19E8z6jRtq0eFIBgnCmQzjnv3eqss3vgsnZZFmOM2w9mJwrBcw6EXouiJ+SWpiWl7TiuANgW7n8Seb+K3rSNiU+KkrG9GZKNTT3FJ1BgsSOE7RU47NGwc+Ypt93/TbRtK2Pzher3t/54lDnVxy9Z5MPnhwD5+/L2Wi0al9Vaj98zxlsb/BocZh+sQU9o7f5H/AACUP/luJ85FwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 15 00 18 52" title="" data-src="/static/2019-03-15-00-18-52-0b97562f9af9404307cf5e5af9845d66-fee1c.png" data-srcset="/static/2019-03-15-00-18-52-0b97562f9af9404307cf5e5af9845d66-a67b7.png 200w,\n/static/2019-03-15-00-18-52-0b97562f9af9404307cf5e5af9845d66-0b187.png 400w,\n/static/2019-03-15-00-18-52-0b97562f9af9404307cf5e5af9845d66-fee1c.png 800w,\n/static/2019-03-15-00-18-52-0b97562f9af9404307cf5e5af9845d66-2cb88.png 868w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="i"><a href="#i" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>&#x26;i</h3>\n<p>现在的前端开发过程，离不开各种 <code class="language-text">npm</code> 插件，但你可能没有想过，有一天我们竟然可以在 Dev Tools 里面来使用 <code class="language-text">npm</code> 插件！</p>\n<p>有时你只是想玩玩新出的 npm 包，现在不用再大费周章去建一个项目测试了，只需要在 Chrome 插件: <a href="https://chrome.google.com/webstore/detail/console-importer/hgajpakhafplebkdljleajgbpdmplhie/related" target="_blank" rel="nofollow noreferrer noopener">Console Importer</a> 的帮助之下，快速的在 console 中引入和测试一些 npm 库。</p>\n<p>运行 <code class="language-text">$i(&#39;lodash&#39;)</code> 或者 <code class="language-text">$i(&#39;moment&#39;)</code> 几秒钟后，你就可以获取到 <code class="language-text">lodash / momentjs</code> 了:</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-15-00-54-24-4c1337a69a43dac3c0e34467176e7dba-7ad22.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 57.32838589981447%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABjklEQVQoz4VSCY7bMAz0/9/XopvNeu3Eki07uqj7slM6BbYoiqIDghgdlMghOzLPM6VCbADmoTTjEjes0SnFWkvOOYTA2ELPO0K/YK31zozj2Fmbl9USlkIszgcfglRxFc2Hc3kcx/P5rG2v7dj3k5fajMGTWErtLKwzJdeP+2Ob2Hxl9H1dPsnUr0sPiuTIS+Q1i5ZlSRzN6Hm6/VjoNUfRgRxvw/fr2zdGLmK9CPbO2YWzNxCfwRILd2cmq2/eEjSjR1A3vvVKDDU/OufTMJCJKuczJuNjcj4isc4755FgipincyGXGlNGy7kg34+jS8HLjQVn9pxqSjXGVvKvUv+Ho3PWcjqhxE48kncYXHPeUZx/Y38BSQcmrtgfzlF+CVmZDAaMMVpDKeXvDHATALCM1hrWXCnzlCVsk8ZeW4teaY317nt72W9gcIyRMSalxFc6IaEfyEdPCCULIXzb9J9QSn15HA98/Xa/4/L8GQeIcw5KaMZgW2FjETSOSjSQ0KdTXO89eoys9RT5q4SfIw5ymqPfkrEAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 15 00 54 24" title="" data-src="/static/2019-03-15-00-54-24-4c1337a69a43dac3c0e34467176e7dba-fee1c.png" data-srcset="/static/2019-03-15-00-54-24-4c1337a69a43dac3c0e34467176e7dba-a67b7.png 200w,\n/static/2019-03-15-00-54-24-4c1337a69a43dac3c0e34467176e7dba-0b187.png 400w,\n/static/2019-03-15-00-54-24-4c1337a69a43dac3c0e34467176e7dba-fee1c.png 800w,\n/static/2019-03-15-00-54-24-4c1337a69a43dac3c0e34467176e7dba-7ad22.png 1078w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="consolelog-的-bug-"><a href="#consolelog-%E7%9A%84-bug-" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>console.log 的 “bug” ?</h2>\n<p>一般来说，我们会使用 console.log() 来打印某个对象，并且，两次打印之间，还会对这个对象进行修改，最后我们查看打印的结果发现，修改前的打印和修改后的打印，竟然是一样的？这样出乎意料的情况，让我们难以继续 console.log 的调试。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-15-00-58-20-5c8ce93aa7c549edebe54fad1e18e035-0f56a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABlUlEQVQoz4VS13LDMAzT//9dHzuS1Em8h6xpeaKUnOGk6dVnHCVbBEhQ7OPzDXlVQbQCZVmt8Hsp8bmP8P71jcMxeYEU+2hd+7g7nAhHsGla0Pc9uBAoiCwrCmR5gZQQp2n41pBY1XCK7S3WTRNyGt6G/3lRIk8TsGVZ8N+TJAmiKEIcxzgdj0iyAh9U0SE6Yb/bIc8yNPEZyfkMtqbcSb3AKrL4jX+htQ5kWVFTNwOc6+EoamPQdR0EVZrsdyjzHEwLg1Z2kEJCKxWSPZSykH5tVBDS0tC3/mUHvoBxnkNZzBBR2xIB+dAZS4ouqPpoQ7QhwWgHpYdfnWwt82tmaKIN1zRVQRWJQOaHdIVzjg7O6IhQVAqd4FB1dSN6ngHrlCQPqB3ywRj9QHbFOE2oSbgqWhhlwJsas2/xQuZFOeew1tKUX/ixVZ3ndUBKaMgnD6/nPPkwDJhImGHjxZZsHMdQ3fUWWGpZbzx8Jr21vPxB6OO9LRqKtOClvHhYP5zbgv11DbbrYZww0L3rjSMPFXh99/AZP2Mfo7QhUMKVAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 15 00 58 20" title="" data-src="/static/2019-03-15-00-58-20-5c8ce93aa7c549edebe54fad1e18e035-fee1c.png" data-srcset="/static/2019-03-15-00-58-20-5c8ce93aa7c549edebe54fad1e18e035-a67b7.png 200w,\n/static/2019-03-15-00-58-20-5c8ce93aa7c549edebe54fad1e18e035-0b187.png 400w,\n/static/2019-03-15-00-58-20-5c8ce93aa7c549edebe54fad1e18e035-fee1c.png 800w,\n/static/2019-03-15-00-58-20-5c8ce93aa7c549edebe54fad1e18e035-0f56a.png 1050w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>打印的时候，两次都是我们修改之后的值？</p>\n<blockquote>\n<p>console 中打印出的对象，在你打印出他内容之前，是以引用的方式保存的。</p>\n</blockquote>\n<p><strong>解决方案</strong></p>\n<ul>\n<li>打印一个从这个对象复制出来的对象。</li>\n<li>使用资源面中的断点来调试</li>\n<li>使用 JSON.stringify() 方法处理打印的结果</li>\n</ul>\n<p>以上更新于<code class="language-text">2019-03-10 19:21:45</code></p>\n<hr>\n<h2 id="异步的-console"><a href="#%E5%BC%82%E6%AD%A5%E7%9A%84-console" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步的 console</h2>\n<blockquote>\n<p>console 默认就被 async 包裹</p>\n</blockquote>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-16-15-44-35-71e0c6ef092cced79b429b22a9ec0f50-e1644.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 24.068157614483496%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAgUlEQVQY05WP2wrDIAxA/f//LKPMu63GJMalpSt72tjhcEgeAmqSC9GH6j3mTFrn0Fp09hyemCLXir23AwLo0BCAGhDxMH4J6+py2aYicvVDGUM9kXcPFROWLYWOnaaM+SemPPLuUo+R912ILpm110O+HLP+oeRWygDg1m51lV+8AODFJZaiZhkqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 16 15 44 35" title="" data-src="/static/2019-03-16-15-44-35-71e0c6ef092cced79b429b22a9ec0f50-fee1c.png" data-srcset="/static/2019-03-16-15-44-35-71e0c6ef092cced79b429b22a9ec0f50-a67b7.png 200w,\n/static/2019-03-16-15-44-35-71e0c6ef092cced79b429b22a9ec0f50-0b187.png 400w,\n/static/2019-03-16-15-44-35-71e0c6ef092cced79b429b22a9ec0f50-fee1c.png 800w,\n/static/2019-03-16-15-44-35-71e0c6ef092cced79b429b22a9ec0f50-e1644.png 939w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="storage-系统的占用数和空闲数"><a href="#storage-%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8D%A0%E7%94%A8%E6%95%B0%E5%92%8C%E7%A9%BA%E9%97%B2%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storage 系统的占用数和空闲数</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38559149363421770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`await navigator.storage.estimate();`, `38559149363421770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">await</span> navigator<span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">estimate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-16-15-46-14-3f89011f5cf2b20f801b95f731bcec38-19a4b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 435px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.85057471264368%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAqUlEQVQY06WQ0Q6DIAxF+f8f9GHZ1GQ6pCAIKKBU1myPi5mJJ23TNLm3aVnd1N2z45wbY+wH5xz1QoiqqrTWUsqUEiLmH1gc5mVapJJ9/yLlOI5kRBUABMgQYillP4BpqYGDNb59hPoW2nvQ2pOQJqBC3PZyDMOMppns4BVkJfIIOUUyRcryD5bS6rinWGP2s1US6JhyDrZ/1+COG65pjTHSb86KywUuid8+vNRlHWUlNAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 16 15 46 14" title="" data-src="/static/2019-03-16-15-46-14-3f89011f5cf2b20f801b95f731bcec38-19a4b.png" data-srcset="/static/2019-03-16-15-46-14-3f89011f5cf2b20f801b95f731bcec38-5fb9b.png 200w,\n/static/2019-03-16-15-46-14-3f89011f5cf2b20f801b95f731bcec38-56ca1.png 400w,\n/static/2019-03-16-15-46-14-3f89011f5cf2b20f801b95f731bcec38-19a4b.png 435w" data-sizes="(max-width: 435px) 100vw, 435px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="设备的-电池信息"><a href="#%E8%AE%BE%E5%A4%87%E7%9A%84-%E7%94%B5%E6%B1%A0%E4%BF%A1%E6%81%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设备的 电池信息</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21566708952478343000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.table(await navigator.getBattery());`, `21566708952478343000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token keyword">await</span> navigator<span class="token punctuation">.</span><span class="token function">getBattery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-16-15-49-02-4ee25609e2dac9eca2dda14ccd46f029-5e78d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 23.712342079689016%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAcElEQVQY05XOXQ7CIBAE4L3/IY3GBtukFBbcX6iVeIHWyZd5moeBGCMjYc4pbYioqnYWdyMiYYEwL2Jt0F+z+jnzLXN5G7yWtZJ6P8wP61eV6pV3uN2fjykgibaP+H7FWK6pVDaYwozjQet/YTEx/wKkciJ9DWeYfgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 16 15 49 02" title="" data-src="/static/2019-03-16-15-49-02-4ee25609e2dac9eca2dda14ccd46f029-fee1c.png" data-srcset="/static/2019-03-16-15-49-02-4ee25609e2dac9eca2dda14ccd46f029-a67b7.png 200w,\n/static/2019-03-16-15-49-02-4ee25609e2dac9eca2dda14ccd46f029-0b187.png 400w,\n/static/2019-03-16-15-49-02-4ee25609e2dac9eca2dda14ccd46f029-fee1c.png 800w,\n/static/2019-03-16-15-49-02-4ee25609e2dac9eca2dda14ccd46f029-5e78d.png 1029w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="媒体能力"><a href="#%E5%AA%92%E4%BD%93%E8%83%BD%E5%8A%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>媒体能力</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-16-15-51-07-4f8594f20ae479bf78c9c56bb097a199-a29fb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 575px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.82608695652174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABaElEQVQoz2VR27KkIAz0//9vXodyFZWrQABBbht3pnar9mAXkE5Cd8Vp2zbGudY6hAAA3nvn3L4f67o6a5HpvdfWxhjneRJClmWhlBpjXq/XxBjzYPeNBmeDFN5ZIQTmlFJSSs55jDEpFTgDutrzLKXc911rzTlPqKz1afcDuNQM6+XBGIpjj0czPlwp5eu6vMcYz1rQR0M76GUy1jrwxlinXDLROVBSAe7nqTQ6ffIIPKXWWHbsjJD51OZp3rZdCBlC9B5lAgoE/9xjvKTSjHEPf0l0cwmhfs3rRg/0P73fOAMKEO5Sc7pTvnN+dsxJ5cgs4oXBne8HyGNZbf1J1zq9FyoMhNJj6bmN1MZVRywj9yFMIiu4XGNroX7hS0XA/WkmM90PMi874/hjwPmHxqnUBnAxAX/Eyn9ALzjwaV02um6CCw9eK+2sa6X12h+0PvD73H9gtDGllPDpz+i/q3+BXG//wp/4DQVlPHMSO3beAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 16 15 51 07" title="" data-src="/static/2019-03-16-15-51-07-4f8594f20ae479bf78c9c56bb097a199-a29fb.png" data-srcset="/static/2019-03-16-15-51-07-4f8594f20ae479bf78c9c56bb097a199-d450c.png 200w,\n/static/2019-03-16-15-51-07-4f8594f20ae479bf78c9c56bb097a199-dee51.png 400w,\n/static/2019-03-16-15-51-07-4f8594f20ae479bf78c9c56bb097a199-a29fb.png 575w" data-sizes="(max-width: 575px) 100vw, 575px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="cache-storage-keys"><a href="#cache-storage-keys" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cache storage keys</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-16-15-55-04-699ab925dae68d29d6c1438557382562-87f29.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 602px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.55149501661129%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABEElEQVQY031Q2W7EIBDL//9cH1fatlG6AZIAA4Qbsgkdekh9KjIjY+xhxEBmQinVSo3jyChlQr3cXt9mtnE+ju9KKcbYNE1G63mekaBH/a4BpWVZOOdm32NK2nlwQVo/EwIASpta63ld53mWWh+E4FMYQTMaBg9WL4qv60rIRqkDOEI4YiwI7xE1per9gTXG5FwOoaTYxZSGHKKcHpYQfb/LDZLSBWSWULTOUmQFZTdpW4s2WcgkRNGqulCse8Y4tNaCchYnud0sYfZjij2jsjGdGF2QcF72PQOgjsfiA6ba1Xo4x+o27TbA8ZIxR61Xv/oPfZ9t6D8Rc7K55qf3QQiIPn43ble3/fA/yoX1q8cnPC2Ne8cBHh4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 16 15 55 04" title="" data-src="/static/2019-03-16-15-55-04-699ab925dae68d29d6c1438557382562-87f29.png" data-srcset="/static/2019-03-16-15-55-04-699ab925dae68d29d6c1438557382562-38577.png 200w,\n/static/2019-03-16-15-55-04-699ab925dae68d29d6c1438557382562-26124.png 400w,\n/static/2019-03-16-15-55-04-699ab925dae68d29d6c1438557382562-87f29.png 602w" data-sizes="(max-width: 602px) 100vw, 602px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="对象--方法"><a href="#%E5%AF%B9%E8%B1%A1--%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对象 &#x26; 方法</h2>\n<h3 id="queryobjects-（对象查询）方法"><a href="#queryobjects-%EF%BC%88%E5%AF%B9%E8%B1%A1%E6%9F%A5%E8%AF%A2%EF%BC%89%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>queryObjects （对象查询）方法</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-16-16-32-32-448809917c0b50b1a706d574a14b4e87-70a78.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 610px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 111.14754098360655%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsSAAALEgHS3X78AAACTUlEQVQ4y4VUB3LcMAy8/z8ymYzPqmxgA8AiBTx5Ejvx2RKGalxhF1jyRpkwYM4UkVPmjMTlOuq3cYsm2l/GbmlSOCvcNBQqrbTK38dNfqGAV0fKkQbcdZh2XAyHWBZN++ayT730xu3/uAk/RHaTBxVe97zoHCLG+5SULtyFRaX6KfINLIefwW9+s7g5ImJe17grSdifwN7AzCzTk4pJR+fZwChbMSYb07i3r8GC9N4fvfVWj1rP0g9uvZ69Hl8jBxgACLFxqSNqpTZEUv0jVV7+c/NOcy2SsUnOVnupvfbeDkl7xVGPs5ydRXw/63mUD3Ru4pCggljEAolaDJR1ZogFIkPywbvoCElCe5NCfF/8W7LJvwACzhpt5AgYJk/Oo7ZorfNuB5VTxoyLW8C5guUvuA5yh3TlbK2XNmgL8Yt868JT2D6l7VfwS3jVPBsGMXnIMkOmNmqdPrTqk4JxYdEcjUcHaJy3bvO7j8A0JGuvMdLTVtVa4e78ZNBq3PZgjDhtdWshNlEvbk1feJuYwh7QSG2BHCQAF40Nqoh58sicAz7NbK1NOQ2DyXN51IzH2MbYn+V8Aw9byinz6vFYCWLPflW1l+Mq3lPaUccoJjGWDATjbHQ2jGAksYeShRq8yP4cnFxGl0sMQ3MIiWLIPmYvbpfRJ3hsUXS1etC5bsrl7VZqFdPIziXXKnWqhVuRDtLjC48FM96zbAwS0kIhxcji05u0N84brpvT4b7iopa7vU9unuy8wPpz/6FA9qJNeSX9k1FM+mLuECBC/A3iGPuaqgKWtwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 16 16 32 32" title="" data-src="/static/2019-03-16-16-32-32-448809917c0b50b1a706d574a14b4e87-70a78.png" data-srcset="/static/2019-03-16-16-32-32-448809917c0b50b1a706d574a14b4e87-1dff0.png 200w,\n/static/2019-03-16-16-32-32-448809917c0b50b1a706d574a14b4e87-8ee4c.png 400w,\n/static/2019-03-16-16-32-32-448809917c0b50b1a706d574a14b4e87-70a78.png 610w" data-sizes="(max-width: 610px) 100vw, 610px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>DevTools 里的 queryObjects 函数可以展示这些信息</p>\n<blockquote>\n<p>请注意，列表中创建的最后一个对象是不可用的 : 在代码执行后，对于它的引用并没有留存下来，也就是说，我们只有 3 个 person 对象：</p>\n</blockquote>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-16-16-33-42-62a9ccf3f62326223982fab5c5c23944-b169a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 670px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.98507462686567%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABWklEQVQoz3VSa3ODIBD0///BfmnGR0UTEUURRB7aFUxjxvRmx4GDZW/vTEiILMvuTfv1nRakztK0rusqBGOsyIssz8uyvN1uTdN0Xdf3PaVtmqYJqSpKac85MKm52w/oMI7Lsqzr6pzz3oMTH5qeIYSAXpKmGZ6RSkkpt1OACVr8bv9E8ng82pZpvczzrLVeT3F+6GMmgZn6fp8mKcQkpYKWD2ou6PrIiJ8n7aUM90qpq4iP66P+l/IbGc0zxlz9/F36aOQgE1INw4BujSGwttaeRa6Cp7I5R8No2zaUooTFGOsvEY34AxgVnCKd5HkB25gbZPcJygkj7VgnwzQBLHjfP/amigiCHhPirE1GOc+LVdoobaU2crH0h3DKZuNC0uB04CMrq7gFFrsiid9nJ4e9P+C2viSCMuM3XNrhNikUL8mxtauOZJRNmwZdghfnXURw6d7gPiTh/hcxg/Ey8qWGIQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 16 16 33 42" title="" data-src="/static/2019-03-16-16-33-42-62a9ccf3f62326223982fab5c5c23944-b169a.png" data-srcset="/static/2019-03-16-16-33-42-62a9ccf3f62326223982fab5c5c23944-1714e.png 200w,\n/static/2019-03-16-16-33-42-62a9ccf3f62326223982fab5c5c23944-5c3b9.png 400w,\n/static/2019-03-16-16-33-42-62a9ccf3f62326223982fab5c5c23944-b169a.png 670w" data-sizes="(max-width: 670px) 100vw, 670px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="monitor-（镜像）方法"><a href="#monitor-%EF%BC%88%E9%95%9C%E5%83%8F%EF%BC%89%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>monitor （镜像）方法</h3>\n<p>monitor 是 DevTools 的一个方法， 它能够让你 “潜入” 到任何 _function calls(方法的调用) 中：每当一个被潜入的方法运行的时候，console 控制台会把它的实例打印出来，包含函数名以及调用它的参数</p>\n<p>我们把前面例子里面的 Person 类拿过来，并且给它扩展两个方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23900551036406403000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Person {\n  constructor(name, role) {\n    this.name = name;\n    this.role = role;\n  }\n\n  greet() {\n    return this.getMessage(\'greeting\');\n  }\n  getMessage(type) {\n    if (type === \'greeting\') {\n      return \\`Hello, I\'m \\${this.name}!\\`;\n    }\n  }\n}`, `23900551036406403000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> role</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>role <span class="token operator">=</span> role<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">\'greeting\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">\'greeting\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, I\'m </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如你所见，greet 方法通过一个特殊的参数来执行 getMessage 方法，让我们看看对 getMessage 方法进行追踪会产生什么结果：</p>\n<hr>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-18-15-42-13-7a415f849d2bee4dcf17c4a502e283a9-01991.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 671px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.584202682563344%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABZ0lEQVQoz11S23KFIBDz/7+wD61VvAAidxQRgS56TqfTzLqzLsaYjM08z8M4or7Hy/rx1aMJt21LCJmmCWPCGOu6vu8RGsb2+5stjHMhpKR0gXVDCJVcaGO0NtZYLtS6cudcjDGldF1XuiJb6EKwFMJvDurYNiVV16OGYsJnBuISIUuJP459391WyaXk80r8yCYWFooMhfssQ158DqkAGimk4Yqx1WK8S+k9kDcAaMJxTBnvpbNpdBlvGdlsTmBm2AMaMDTjCjKMgvNH+U3O8UqLL9NW4BWjK8wXuAU+HFVlDJ6lgjGVDCbLG/nu8HmDyyAL/VNnFWrpSi5VmYwTIxQ6ZGCMhdigIFHnNqWVtk6HF2e9rV7x5Otqra1k3KOVEMN58B5COgF3v+f4xPa3IP7jCLCvZEYIXxidZ6WU1rpexohHuQo7iOa3qpEQ4C+QUlZy0Dru+6H1dZ6Pk/ux/HL+Hv7h2f8AROc8Obg8meYAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 18 15 42 13" title="" data-src="/static/2019-03-18-15-42-13-7a415f849d2bee4dcf17c4a502e283a9-01991.png" data-srcset="/static/2019-03-18-15-42-13-7a415f849d2bee4dcf17c4a502e283a9-0bc2c.png 200w,\n/static/2019-03-18-15-42-13-7a415f849d2bee4dcf17c4a502e283a9-6bec7.png 400w,\n/static/2019-03-18-15-42-13-7a415f849d2bee4dcf17c4a502e283a9-01991.png 671w" data-sizes="(max-width: 671px) 100vw, 671px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这样写会省很多 console.log</p>\n<h3 id="monitorevents-（镜像事件）方法"><a href="#monitorevents-%EF%BC%88%E9%95%9C%E5%83%8F%E4%BA%8B%E4%BB%B6%EF%BC%89%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>monitorEvents （镜像事件）方法</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-18-15-43-56-5f57f77c0fff6622d141a415e829bd92-c248e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 663px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACHElEQVQoz1VS70/bMBDNXz8kWlLGBFL3aRL025C2/SeDtkiTBiJN4sSxff5tx0mbHa2EmPXknHN5uXfvnJ2dfZrNZjfH9fW4lsvll6urPM8Xi0W+uJzln8/nF/P5DHGBz/n55SK/vr6ZzfMsBBeDVxKMViF45yy+sXiQELzVPhS1ZKQmFdntWFHQ14KWlZDCaAaZdwaUFEpRLqQCrSGlME17H+OubjlnGqTmjNGOEN620DSipcCYACay2PvOOKpdDVY5h8w+hXGIlMGOcKMlAAcp2oZ0XeOdVtA5I5VkElgGotNK4EFL7pyyFsXbGFG+5gI6MEPqU4onBGei4UHzaITTItPW4rs+xb4Ph8MwTeNpd86UNSmqRmkVncX2cWFFAVxjNRAAIvtbEEprVIuc/T69o0++aSrOqbG69y55O+7TMPbDEBHO6b732WtFX57/CNEheRz7j2iRXZUgsG3GhQKp0E6t3vouy0ppkzGFozL4s5Pgd+VIrqvy5eWZ1B1t66ZBf6WzaIpHX+qqVlJlSkvvDQ4MdxRj39IKJaHyqtoVxWvb4KBa2iH3LeWcN1ZVWBnJm/XDdvP49LTZbtfr9e/N5mG7few6Mgw9GoQ9A94BJaRUxpjjIALueJ3wg4yQEnPYDI4UA2MkxlgZc8cW9tM0/N9ROsX7Q8pub7/9/PXj/v77anV3t7pdHYFB09TTdEAvxjEd/UsfZ3HCP4srwvii5bQYAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 18 15 43 56" title="" data-src="/static/2019-03-18-15-43-56-5f57f77c0fff6622d141a415e829bd92-c248e.png" data-srcset="/static/2019-03-18-15-43-56-5f57f77c0fff6622d141a415e829bd92-3b104.png 200w,\n/static/2019-03-18-15-43-56-5f57f77c0fff6622d141a415e829bd92-3a484.png 400w,\n/static/2019-03-18-15-43-56-5f57f77c0fff6622d141a415e829bd92-c248e.png 663w" data-sizes="(max-width: 663px) 100vw, 663px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="console-中骚操作"><a href="#console-%E4%B8%AD%E9%AA%9A%E6%93%8D%E4%BD%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>console 中骚操作</h2>\n<h3 id="consoleassert"><a href="#consoleassert" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>console.assert</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8874766065795936000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.assert(assertion, obj1 [, obj2, ..., objN]);\nconsole.assert(assertion, msg [, subst1, ..., substN]); // c-like message formatting`, `8874766065795936000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span>assertion<span class="token punctuation">,</span> obj1 <span class="token punctuation">[</span><span class="token punctuation">,</span> obj2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> objN<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span>assertion<span class="token punctuation">,</span> msg <span class="token punctuation">[</span><span class="token punctuation">,</span> subst1<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> substN<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c-like message formatting</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<blockquote>\n<p>当我们传入的第一个参数为假时，console.assert 打印跟在这个参数后面的值。</p>\n</blockquote>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-14-42-14-e76d61a43584e70af2d25c3a5512e0b3-ab313.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 677px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 22.008862629246675%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAb0lEQVQI142Ouw7DIAwA+f+/bIfGJoFAeNg12OnaSKnU0y23nWtERynCw9TOLy7xA9e37QAo3meAtq6C+PbIy0tSMuZbZ+8tJanVlQXS89ERRwwjxrnvM8YRghIZ33gySasBsOfshqqa6XXV/tv+ABMI6YsO0NsLAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 14 42 14" title="" data-src="/static/2019-03-19-14-42-14-e76d61a43584e70af2d25c3a5512e0b3-ab313.png" data-srcset="/static/2019-03-19-14-42-14-e76d61a43584e70af2d25c3a5512e0b3-94813.png 200w,\n/static/2019-03-19-14-42-14-e76d61a43584e70af2d25c3a5512e0b3-beb37.png 400w,\n/static/2019-03-19-14-42-14-e76d61a43584e70af2d25c3a5512e0b3-ab313.png 677w" data-sizes="(max-width: 677px) 100vw, 677px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>通过它，你可以摆脱令人讨厌的 if 表达式，还可以获得堆栈信息。</p>\n<h3 id="增强-log-的阅读体验"><a href="#%E5%A2%9E%E5%BC%BA-log-%E7%9A%84%E9%98%85%E8%AF%BB%E4%BD%93%E9%AA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>增强 log 的阅读体验</h3>\n<p>有时即使你 console.log 一个简单的变量，你可能会忘记（或混淆）哪一个是那个。那当你有不同的变量需要打印的时候，阅读起来会更费劲。</p>\n<p>为了让它变得更加易读，你可以打印一个对象，加上 {}</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-14-46-09-1dfdea53e7ee6d6945fb600c16fedaa6-aa023.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 392px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.78571428571428%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA50lEQVQoz42Q23LDIAxE/f8/GnvMXRcsQLhyM31x0qZnGHhAu5J2GV1zJuf2EEoMmCJ7BykFhAOx2iESooog85w3ltZ6yVadYkxjqOqpQ8eF9n49z9uYLywiEkLYd+scnHOIgIjMfNn8YHXP+y7uvfvgY8w5ofd+27Z1fcQYzZSJcqFSzWXqfMNilk3ESgi66hBptVZTWmeRox7Sx/kbl5gtj4BIaMkhSmVlanoxzz/5FjMLN4gF81EKrA/vnCeUJuODeKoSESSAgEI2qVhsOee3Cd13tqUQoBhQbgl/FrPch3l+nP/gC5WXSp6kRu3kAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 14 46 09" title="" data-src="/static/2019-03-19-14-46-09-1dfdea53e7ee6d6945fb600c16fedaa6-aa023.png" data-srcset="/static/2019-03-19-14-46-09-1dfdea53e7ee6d6945fb600c16fedaa6-b2451.png 200w,\n/static/2019-03-19-14-46-09-1dfdea53e7ee6d6945fb600c16fedaa6-aa023.png 392w" data-sizes="(max-width: 392px) 100vw, 392px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="consoletable"><a href="#consoletable" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>console.table</h3>\n<p>如果有一个数组(或者是类数组的对象，或者就是一个对象)需要打印，你可以使用 console.table 方法将它以一个漂亮的表格的形式打印出来。它不仅会根据数组中包含的对象的所有属性，去计算出表中的列名，而且这些列都是可以缩放甚至还可以排序!!!</p>\n<p>如果你觉得展示的列太多了，使用第二个参数，传入你想要展示的列的名字:</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-14-49-02-363ed644008c92001cb59c92c050ca21-3086a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 656px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 35.670731707317074%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABFUlEQVQY001Q267DIAzr/3/jtFWs9DJKuUO4lM6ddKRj+SExkZ0wvF7PZZ75NK3r+mDLg3H2vmtgl1IIMb2nmc8Yg8IYQ7sLYbSe53lYlnWa+LZ9DnlYY5VU2zjafa8xkZQ5xrN3KeVxqBhjyYUIWgwhwneglPAWfAjex+ATZOdghGlnjHcOo5my9/5QOqWUCZ6Sc456cN4rbRPlkEAKlK0LO18EmyzScg2RoMtl3ZcNGVgoYjISVhjurp7lvKj+2K6Qin4xPb7Vc7QfSaVDNHz1m0hYvF0g1Z5rG+C1CWUDpdKQc0el7LRxynhtvXU/sXmDoyjVK+UGRqqlNNxMWqmcMz6mnSd447r+eIu99+uH/h/n+QWs8I6DpSYTlAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 14 49 02" title="" data-src="/static/2019-03-19-14-49-02-363ed644008c92001cb59c92c050ca21-3086a.png" data-srcset="/static/2019-03-19-14-49-02-363ed644008c92001cb59c92c050ca21-a142c.png 200w,\n/static/2019-03-19-14-49-02-363ed644008c92001cb59c92c050ca21-201ef.png 400w,\n/static/2019-03-19-14-49-02-363ed644008c92001cb59c92c050ca21-3086a.png 656w" data-sizes="(max-width: 656px) 100vw, 656px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="table-和--的配合"><a href="#table-%E5%92%8C--%E7%9A%84%E9%85%8D%E5%90%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>table 和 {} 的配合</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-14-51-01-5868c7c048d50759b501e5dbcea53ab3-c391c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 525px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABHklEQVQoz5VS7ZKDIAz0/V+zjjdVEfkIhEDwlvbu/rXT28noJrgRNkz3+2qMWdf7uq7W2larjNDrBVSViEQEfAqOMrWcc4yUUoKQ8OaX4lrrvu/4cojJU6LkfSKq6Niq9t6vzzBRgDSlwNtmEDkX7fpG3X8xxDjwac8qj5PW2j/AX5fJeYc4z9N7H2Nk5vdbba2FEH4M+1qW4ziQL8vivQveI4WfqMD8GAM6ntaiNYrOucOY+Xbbt2382RhLKYeY9/1MmWF5CMRFwEEyFwQIUhQjDSK1cSmY2ZRFRS9iTaJFr5hbSFralaW7UFkucBDiDoLVVDqWcmlDjE1iyPUBnEeGc4PgCefboLgFBWXVxiylDPK0dprnGUPv/wcM+wbALYLL/NgwbgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 14 51 01" title="" data-src="/static/2019-03-19-14-51-01-5868c7c048d50759b501e5dbcea53ab3-c391c.png" data-srcset="/static/2019-03-19-14-51-01-5868c7c048d50759b501e5dbcea53ab3-99d74.png 200w,\n/static/2019-03-19-14-51-01-5868c7c048d50759b501e5dbcea53ab3-ef08a.png 400w,\n/static/2019-03-19-14-51-01-5868c7c048d50759b501e5dbcea53ab3-c391c.png 525w" data-sizes="(max-width: 525px) 100vw, 525px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="consoledir"><a href="#consoledir" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>console.dir</h3>\n<p>有时候你想要打印一个 DOM 节点。 console.log 会将这个交互式的元素渲染成像是从 Elements 中剪切出来的一样。如果说你想要查看这个节点所关联到的真实的 js 对象呢？并且想要查看他的属性等等？</p>\n<p>在那样的情况下，就可以使用 console.dir:</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-14-52-57-94221578239c617da9d6f1e5a77d7b30-9f4d2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 619px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 73.34410339256866%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB0UlEQVQoz4VT2XLbMAz0//9cn9JO40lS24lJ8QAJ3pfsQtbElR88hSiJFLlc7BLalVpzit65qFXLeYxL74PaGvOYKa5PYtd6TzGjtk5xtHYSAV0AY4y1GiD5VEJ5Dm5daVBCaSkY44iRvhTKp1Z6dtq7jcst5nlp29jRBq20ZF00oqYkZbLWgaYLaMPgYnL5crnewTf8MlyYc85SKSGFsZhLGaNvE6OVy+Lba9U/b9h3tVWSZ9H5SGoxpULTY7Rxt+yx3cDfzNRFRJDqi4GLy9wglaPckSvTlvKfYTRotamj5nshDiq4QB5RPHP4AUw3HZXYS/574j+Z/FDnPbNgnUMDhpKyhvrOGEDrHeYVvmawgL3z08cEJyPfpJrgfGJ8ElJrpbVFbxiBojLgQ8QJI0aLVmsdQrkxp3x4ORK5Oio4MBR0XFAQawjVuUarrK1oM+Kie758e06ar1cySL6pr5czKYc/HN7P+lMFCdX5grZ5XwxU0M25VfSD5uAjcfJfXLxLKTRnk0FvwWtuyPf/GOZdIJ/gBKjwzBgjwZIKR4OQnvOes/c+xdi8y6C3B7Gk3WonzuOPE9tPKIV4fSUX2lLVnQTXUmNKVOpzKT2l7U/2FzTRYfy1IvSHAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 14 52 57" title="" data-src="/static/2019-03-19-14-52-57-94221578239c617da9d6f1e5a77d7b30-9f4d2.png" data-srcset="/static/2019-03-19-14-52-57-94221578239c617da9d6f1e5a77d7b30-a6aa8.png 200w,\n/static/2019-03-19-14-52-57-94221578239c617da9d6f1e5a77d7b30-6c7b5.png 400w,\n/static/2019-03-19-14-52-57-94221578239c617da9d6f1e5a77d7b30-9f4d2.png 619w" data-sizes="(max-width: 619px) 100vw, 619px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="给-logs-加上时间戳"><a href="#%E7%BB%99-logs-%E5%8A%A0%E4%B8%8A%E6%97%B6%E9%97%B4%E6%88%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>给 logs 加上时间戳</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-14-53-34-e82be77d4958e7fd841457bdb29b8e38-a54b5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.08474576271186%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABi0lEQVQoz3VSTUvDQBDdPyzevHsRLHgRvCm9VEXwIHgSRBG9tH5C2pqGJmm+dpMm3d0kbT3YRF8SGqPgO4TZ2Xnz5u2EOI6j6zrzC4xGo/F4LIQwDGM4HAZBwBhD0nXdKIpUVUUeASo552EYkrmUH2ny9Rv5GnXcDGqQZ5t2HTbhQgqOrrPZDMpxHKclkiRJ/wGuyLZibrzox++mbej9wUBRFE3T4EVKKUpgwjqoAIEiyTlpG3RvZF87fiK4HwSVT9u2Ue1Rj1GGLrAHn3+sZXlOdrVwU/EvHL6IpZASw4CG3pgc7cHEhKIBWKOUzufzLMvIpfl0qt09UjXlEhyIQBw60+kUdfhSxpbLJaoXJRCgDJmCfPR23uoedvpXimXxkoy7oGTCK45wkTfQ3Ahp93r79w+t25uz/itEIQVZy7IQYOZCH73W8DxvtVr9rCponThbB9FOJ9RM12eMUpCDko9nAxmj1ksG83MNxCSeRnTiLIRM4uKpoIanqvdUPVjlFj6xQtM08cPBC87fugJcprIRa5cAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 14 53 34" title="" data-src="/static/2019-03-19-14-53-34-e82be77d4958e7fd841457bdb29b8e38-a54b5.png" data-srcset="/static/2019-03-19-14-53-34-e82be77d4958e7fd841457bdb29b8e38-33798.png 200w,\n/static/2019-03-19-14-53-34-e82be77d4958e7fd841457bdb29b8e38-27c47.png 400w,\n/static/2019-03-19-14-53-34-e82be77d4958e7fd841457bdb29b8e38-a54b5.png 590w" data-sizes="(max-width: 590px) 100vw, 590px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="监测执行时间"><a href="#%E7%9B%91%E6%B5%8B%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>监测执行时间</h3>\n<p>与其在所有事上展示一个时间戳，或许你对脚本中的特殊的节点之间执行的时间跨度更加感兴趣，对于这样的情况，我们可以采用一对有效的 console 方法</p>\n<ul>\n<li>console.time() — 开启一个计时器</li>\n<li>console.timeEnd() — 结束计时并且将结果在 console 中打印出来</li>\n</ul>\n<p>如果你想一次记录多件事，可以往这些函数中传入不同的标签值。(例如: console.time(‘loading’) ， console.timeEnd(‘loading’) )</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-14-56-43-6c0e92174f7f4fc7e2d7316fdc412286-73362.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 609px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.993431855500816%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABqUlEQVQoz11R2XLrIBTz//9f7zRx6oVg8Ao2++4eJ+19qIaBGUASElWRMXPPdmmE9cJ5n0o5Ad77rusxHhBCx3H0fV/X9TwvmEwfn/cG4Y2xKjPnR7MwoaRzu/EmpHyxrbW32w04TdNM0zQMwzzP68a6kX+i6V9H+yeuoouJeav8sktrfDQB2EA2xoDnuq6EkG29oLUWQhitUvDemp3zKqZy5rPkknLKGZbyfrZSCo5hxhiP07QsC6Fj27aUjuvGpVRwp3Ixq5iCiVGHFHOxMelQXmTGmDYGYzIQyjhHCLdd//hq7vWjR88YY5VSUSoZGcLhg0lX4P/OO1daoye0NoAQOH+1Xf2AEjqQ2PfjIp+h5JCd81dcGPHKrF/OxlpKoa/5OASQ8UBu97ppO1CE76iyS2kwG+GIrnpTmuxOuYusNeccZvAFGmMc1icmPcJ38G07KSQ4Z2mclCaDf4biSiwlnaeQatuY1oaO0NfM+U4onZcFlEACCkwpVdCwsEEcRqxS23go52Px+RRKzct2pX938Iufz3ihgoLLa+O9l3/P4MGQ+c/tP/gGWppwYiAnBx4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 14 56 43" title="" data-src="/static/2019-03-19-14-56-43-6c0e92174f7f4fc7e2d7316fdc412286-73362.png" data-srcset="/static/2019-03-19-14-56-43-6c0e92174f7f4fc7e2d7316fdc412286-06e0b.png 200w,\n/static/2019-03-19-14-56-43-6c0e92174f7f4fc7e2d7316fdc412286-70531.png 400w,\n/static/2019-03-19-14-56-43-6c0e92174f7f4fc7e2d7316fdc412286-73362.png 609w" data-sizes="(max-width: 609px) 100vw, 609px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="直接在回调中使用-consolelog"><a href="#%E7%9B%B4%E6%8E%A5%E5%9C%A8%E5%9B%9E%E8%B0%83%E4%B8%AD%E4%BD%BF%E7%94%A8-consolelog" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直接在回调中使用 console.log</h3>\n<p>不仅减少了输入，还可能在回调中接收多个参数</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-14-58-18-64ada5eec411498f24258660e3a58e92-715c5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 658px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.60182370820669%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABJElEQVQY001RiY7EIAj1//9xk53tbe20HoAH2sXdzGTwhYACPkAdx2GMEa213rZtN13mad73fZ7nEALnQj5ExISUAMh5cUXXwipAEPjgAYCZc0qVubVWubba7k8RT24+oPSkzbqv03qcZ6YcrwAeU64SmlNGwBRTpCiGQCr2Ei+oEjIT19R/4sgtVYBIqTQpXZgASQ6gt84LVUm+X8n3rZZpIYwxYAISnswvru3mwgKpIve1tq5LrZmbxPw9qXTF4ig5qpALZOvg3ajQ9tajDM250xz2ugpAuq5kLT2fGUlt86wXo7U3xu7LIliGYR0nwTZOelzM4fYDnieYEy12Im9Rw+MxDNPPuH19j8466VBGDwH+gSj7YSQmmQV1o6+g9rGL8QuUCM2D0iKMxAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 14 58 18" title="" data-src="/static/2019-03-19-14-58-18-64ada5eec411498f24258660e3a58e92-715c5.png" data-srcset="/static/2019-03-19-14-58-18-64ada5eec411498f24258660e3a58e92-c456f.png 200w,\n/static/2019-03-19-14-58-18-64ada5eec411498f24258660e3a58e92-60786.png 400w,\n/static/2019-03-19-14-58-18-64ada5eec411498f24258660e3a58e92-715c5.png 658w" data-sizes="(max-width: 658px) 100vw, 658px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="使用实时表达式"><a href="#%E4%BD%BF%E7%94%A8%E5%AE%9E%E6%97%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用实时表达式</h3>\n<p>DevTools 在 Console 面板中引入了一个非常漂亮的附加功能，这是一个名为 Live expression 的工具</p>\n<p>只需按下 “眼睛” 符号，你就可以在那里定义任何 JavaScript 表达式。 它会不断更新，所以表达的结果将永远，存在 :-)</p>\n<p>同时支持定义好几个：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-15-01-21-2444329e05cdaf1eb8c63a418e285afb-de7e2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.05936073059361%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABgklEQVQoz5WOy07CQBSG51F0YWI0SmMLovgILlwYF76BCx/DhIULYoFapHbhw3hZYaIJF5WZFrkMUNqZXigX6ykx0cSNfvlz8s+Z+ecctH9wKEhpKZ2R0ntCMr0ppkAJMbWWEMXtzLogrSUkIbkrJHc2xNTq5tby0srZ0bF8cnpb1pGq3RTU67yqF0p6/lK7UGLJipYrXF0o18WSVlQ19UpXy7qslHKykpOLslzMZs8f7u7ReBIFs4hPIn8WuZOIhbHg6E5j8xF9Mw5DfxyCmc/n09ncD3yEqxX8+oIN8oaxaRCQgTEhmOCmAZWQZrOJMY4LIaZp2rbtOA7UbreLOj06GAy6w5HRG3Q6HcsaMcYBKPCs3W5TSofDofXFyFkApkVHqPX+btm253ku59CFmLsAOv1+nyymgYEO/0H8NeOIGma/1bIp/b5YAAYGwVhIwmqwJ/8FalcerWqV12oME+Z5zHHYn0GUe2waMgjVG/8Os2rdrTfcp2cfk2A6CXw/+DOfDoD0ZRprMoQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 15 01 21" title="" data-src="/static/2019-03-19-15-01-21-2444329e05cdaf1eb8c63a418e285afb-fee1c.png" data-srcset="/static/2019-03-19-15-01-21-2444329e05cdaf1eb8c63a418e285afb-a67b7.png 200w,\n/static/2019-03-19-15-01-21-2444329e05cdaf1eb8c63a418e285afb-0b187.png 400w,\n/static/2019-03-19-15-01-21-2444329e05cdaf1eb8c63a418e285afb-fee1c.png 800w,\n/static/2019-03-19-15-01-21-2444329e05cdaf1eb8c63a418e285afb-de7e2.png 876w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="network-篇"><a href="#network-%E7%AF%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Network 篇</h1>\n<h2 id="请求过滤"><a href="#%E8%AF%B7%E6%B1%82%E8%BF%87%E6%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>请求过滤</h2>\n<p>Network 面板中的过滤器输入框接受字符串或正则表达式，对应显示匹配的请求。 但是你也可以使用它来过滤很多属性。</p>\n<p>只需输入 例如 method 或者 mime-type :</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-15-08-43-1324202a1e95dd6ae7f717a3671dae69-ac14c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 674px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.82492581602374%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB00lEQVQoz12S2Y6bQBBF+d58QqTkKR+Q30giJXnIpijvWewYywaMod17Q4PBmPYYLzO2c5mRR6Pch1Y1VNWpW+DpshSqV9M0jLGU0qIollWVEiKFaNuWUkYprVfNQuhxEFFpEBNCkOzlw4EIQyqkyXKSpCoIpJTVsuSMaa2FEFJJgyizE6L8ORsnQuJic/C8fOyjyOSZ0UoI3hlRLJemaoTOtFLAGmOU0qifRSFm4Ixyzm1R9MUfp+XbgX7/N3/zS3wNyu/8bmoP7f42rx36UcaSNCULyoUcjvz0PjBZprVJUuK9/qFefNLPP9uXX7JX3/SzD827UdO5VQVnV6HeH08sZrU2iudFUQZhZG3hacnTWWC1WCRxHE62NzfddoM9dV23vUoqhV673Q79six3bsO4QOyBPg1ncUqiOA3jRJkcC3HOnU6nu3sh6FNXzeVyaVuHRugLLF55/mi4oBS25glBzfF43O/3gHRPRBmvqvpwONR1jUbr9RrD4/RoEsPSbI4JqNtsHoGPeiA3zbonO8el2nYdVtjtdp4/HGCd2CHgNYw9sfogPCCEFmWJiaqqwsfCCuN50pP//P4JKnJur5z/dD6f8aes2xZk+FLKwBTIOP8BjvdRbKi+HD0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 15 08 43" title="" data-src="/static/2019-03-19-15-08-43-1324202a1e95dd6ae7f717a3671dae69-ac14c.png" data-srcset="/static/2019-03-19-15-08-43-1324202a1e95dd6ae7f717a3671dae69-2d27a.png 200w,\n/static/2019-03-19-15-08-43-1324202a1e95dd6ae7f717a3671dae69-cc70c.png 400w,\n/static/2019-03-19-15-08-43-1324202a1e95dd6ae7f717a3671dae69-ac14c.png 674w" data-sizes="(max-width: 674px) 100vw, 674px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果想要显示所有可能的关键字，在空白的输入框按下 <code class="language-text">[ctrl] + [space]</code></p>\n<h2 id="自定义请求表"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义请求表</h2>\n<p>要自定义显示哪些列，右键单击请求表标题上的任意位置。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-15-11-42-348d392996e97d7ea4cbef378fb3bac3-7c992.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.30914231856739%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABLklEQVQoz22Ri26EIBBF+f9PbHZtNkFA8MUbQbRXbZpt7Q2ZDDhn7oDkSdWTazbn++K6NEJ/0JGOUfXDNE21bnyKDzZfBaSVqhuNz9t9hbLPfjGhpHX33mut9323sTA1uVRRQKTiRs8lL/e1lhy8C8HXFYkfxynnnGIUnC0pooAMSo7jkMuh/Fs4cQ6WYV1XY4x1Ds4xRs55SgkFpJcC86RTd9ifAow4z/MFM8a+YaUkF6Lve/T+Fw7hcLbGIAGM2J4wDomUPaW06zr4X8CPLkPonN92nQR5jC2Edx6NiGqoYFwqBR4/Ay2mN2EcmABGjmmtscf8eOBSDril9PV6gXSn8G15E7awQikibGutiMMwbNt2wI/mk7atUgrvYa2Fzx8Y1bjOBSNB9N5dl/oCwXA8vEGEpwMAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 15 11 42" title="" data-src="/static/2019-03-19-15-11-42-348d392996e97d7ea4cbef378fb3bac3-fee1c.png" data-srcset="/static/2019-03-19-15-11-42-348d392996e97d7ea4cbef378fb3bac3-a67b7.png 200w,\n/static/2019-03-19-15-11-42-348d392996e97d7ea4cbef378fb3bac3-0b187.png 400w,\n/static/2019-03-19-15-11-42-348d392996e97d7ea4cbef378fb3bac3-fee1c.png 800w,\n/static/2019-03-19-15-11-42-348d392996e97d7ea4cbef378fb3bac3-7c992.png 1061w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="重新发送-xhr-的请求（已过时）"><a href="#%E9%87%8D%E6%96%B0%E5%8F%91%E9%80%81-xhr-%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%88%E5%B7%B2%E8%BF%87%E6%97%B6%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重新发送 XHR 的请求（已过时）</h2>\n<h2 id="xhrfetch-断点"><a href="#xhrfetch-%E6%96%AD%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>XHR/fetch 断点</h2>\n<p>在某一特定时刻，你想要对已发送的 “ajax” 请求进行捕获怎么做呢？ 可以使用 XHR/fetch breakpoint 。</p>\n<blockquote>\n<p>这些只能在 Source 面板中设置。（我也同样希望可以直接在 Network 面板中设置，但事实并非如此）</p>\n</blockquote>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-15-19-25-d44624340348ba78365ee02d8abe72c9-5d858.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.65760869565217%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAACUUlEQVQoz1VT23KbMBDN//9WOpO+tJm8OI6d2hhjIXS/oiukC9idZgcYRtqze3T26Mk63xPOuYCXMUYplWtora21pVRpnLJeGmv8KLSt0/T1iCcu5Lntzs2l6zpCljLDMLRtq5QyxsQce3ajkhA5cM2oIsZL7Zgb9TzPT8fPz9+/fh0Oh0t7JZR676Ghc85o46yH8tNU8zSOWbughR3MKIUhuaSl8/7j4/n5x8cSxz+nMxcCegJnqQQWTaw2TWOq3o4KMNISF4wdJXwX8Ol0fnn5ud/vKWUYDwghID+OY4geq1Od0te8RKm5TkVaOkYHK7WWBQx9AABSSakY49DVAzDGlFLOZRNmBU8ZCpQ8z/8Jtu2FlIRxVGp4MBdjjBtqfb5izkQoIjVTIGH+Bi6lYEoxZWggQECsQpdyT8o5D5R1eKCcQw7slrzEHVxLPTfNbrc/HI5te7XGgOYg+AYG/pdL2zQXGCdnPMVkjYWEBSyMAZIxhp5cMb2h4Qo6p5xqrbANjokpxxRAah8t14QIpAyHhGXO0zSDDIRjRNqedkxhobFxcgODcAtthjrc4MUtiIgbV5jKPkT3tGbE9tqBSeAL0wKrDITAwTfaMDZYv3Y32AgBlE1hjfuZv8e86Q8ediGCq3Mp68L8mBr8zXe1YZzO+61YAelqBZ6Q4MeIqLgRAT+QPq3xKPEYFSF0t3t/e3s7HI89HrobApIxRMw5eI1rxaTqGRu4bBASWn8DCyF27++vr6/gUIT61dUKmqcS4Pb4YLQDbZcTuqDgbvzjDPEXFDGMpukgeTQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 15 19 25" title="" data-src="/static/2019-03-19-15-19-25-d44624340348ba78365ee02d8abe72c9-fee1c.png" data-srcset="/static/2019-03-19-15-19-25-d44624340348ba78365ee02d8abe72c9-a67b7.png 200w,\n/static/2019-03-19-15-19-25-d44624340348ba78365ee02d8abe72c9-0b187.png 400w,\n/static/2019-03-19-15-19-25-d44624340348ba78365ee02d8abe72c9-fee1c.png 800w,\n/static/2019-03-19-15-19-25-d44624340348ba78365ee02d8abe72c9-b1a91.png 1200w,\n/static/2019-03-19-15-19-25-d44624340348ba78365ee02d8abe72c9-5d858.png 1472w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="drawer-篇"><a href="#drawer-%E7%AF%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Drawer 篇</h1>\n<h2 id="检查代码-coverage"><a href="#%E6%A3%80%E6%9F%A5%E4%BB%A3%E7%A0%81-coverage" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检查代码 coverage</h2>\n<p>实际开发中，你的页面可能并不需要位于尾部的许多代码。也许那是来自外部库的一大块 JavaScript，也许是被遗忘的选择器上的一些 CSS 规则，它们不再匹配任何东西。</p>\n<p>使用 coverage 面板来获得关于冗余代码的摘要-细节信息。使用 Drawer 菜单或者 Command 菜单来打开它。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-15-27-40-00672e9c957c091ffcc19011daef94ad-63a9f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 24.77064220183486%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA20lEQVQY002Py26EMAxF+f+vmlUXM0itwlSFCSPeJCp5NSQhwKaXQZV6FrFlX/s6CRv7L9oO7Nu5WUhZvqCU5nleVRXn3BgzTRNjDMnPP7TWiVLcaOXmA7Truqb08XyWj6IQQqASY1zXFa+1NoQQ//DeJ1YIpbWUUilEbYyW2rajsLM7RcuyYAZS51w4OarRO5+otpm9hwN8oNj3HWtGxk8N3NCC87Zt6zESsWnB0cGYYJJ3Qm7Xa5qmWZb1fd91XdM0CEhRwf/bF8MwFHn+QUh9/yzfLjeaEpr9Ah4FEySSllBSAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 15 27 40" title="" data-src="/static/2019-03-19-15-27-40-00672e9c957c091ffcc19011daef94ad-fee1c.png" data-srcset="/static/2019-03-19-15-27-40-00672e9c957c091ffcc19011daef94ad-a67b7.png 200w,\n/static/2019-03-19-15-27-40-00672e9c957c091ffcc19011daef94ad-0b187.png 400w,\n/static/2019-03-19-15-27-40-00672e9c957c091ffcc19011daef94ad-fee1c.png 800w,\n/static/2019-03-19-15-27-40-00672e9c957c091ffcc19011daef94ad-63a9f.png 872w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>DevTools 的 coverage 工具可以跟踪当前加载的 JS 和 CSS 文件的哪些行正在被执行，并显示未使用字节的百分比。</p>\n<p>它用绿色的线条标记运行和用红色的线条标记未运行。举个例子：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-15-29-35-cbc0883ee4cbf03f291a18e3ad205b15-a15de.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 617px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.946515397082656%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABF0lEQVQoz5WRzVLEIBCEef8X1JMmgbBZMZAZ/gMsDntyPaz6FQwU0HQXsNf37Y1v8yJmvgq58VUuQn7uxlqLv8EMHi8rFxtMXIlZT/POrwe4GEJw3o/mqAxijO0RZoOVIHvvZ0habHzicGijtXM2uVByaf3WbqMR/RGGHi9miGnLqOPjchHTotVOTtkl8i8p1eBrSi3nSlClxZzpLuYcKjXE5azepUghNQ35LJVWTurj9F1cyohQa4uxnCfNyRnk3dmbgDtoZXIiYW10srRW28+s32NHBCdEv+fOLqPCaAMgBgwZYvDjkZ6I0cmVZq1QwNz/A3MWrteltVsOZAsBKIqndxlfUdtzmDF6WWfBBQAggNGGgL/xBZZ1QRIE1k57AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 15 29 35" title="" data-src="/static/2019-03-19-15-29-35-cbc0883ee4cbf03f291a18e3ad205b15-a15de.png" data-srcset="/static/2019-03-19-15-29-35-cbc0883ee4cbf03f291a18e3ad205b15-70603.png 200w,\n/static/2019-03-19-15-29-35-cbc0883ee4cbf03f291a18e3ad205b15-4a3ab.png 400w,\n/static/2019-03-19-15-29-35-cbc0883ee4cbf03f291a18e3ad205b15-a15de.png 617w" data-sizes="(max-width: 617px) 100vw, 617px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="检查你修改的内容"><a href="#%E6%A3%80%E6%9F%A5%E4%BD%A0%E4%BF%AE%E6%94%B9%E7%9A%84%E5%86%85%E5%AE%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检查你修改的内容</h2>\n<p>通过浏览器进行设计和调整 css ：能够在代码执行的地方进行调试是方便又有趣的开发方式。 但在某些时候，你可能希望将 已更改的内容 与 最初加载的样式表 进行比较。</p>\n<p>为此，可以使用 DevTools’ Drawer 中的更改工具。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-15-31-03-4649d4233db0ab736a9e95778365b54e-fee1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABQElEQVQoz23OXU/CMBSAYf7/P9BIuPFW441GQJQYRTF8zbEgDMpgwNjWdt/ttq6riFFxevJcnDZ5k1N67WqdtjKQBrIyUoCu6ubcQJQmaZIylvGM53sZy/4qJZSRMCaEUBoLzjFE0LLTkFLscRJzlseMszQT/02p8I4JtTEeruRup9aTm03w8qhJU3cFfONDYJgUW9T5tI/zH7sLTYSqo/pVo3zWvjy9u25NH+63w/pKullLt2tp7C1ngT7d+x0LgZGz3WxpkrA8T4VgefHU3Qf/Uow9x/M9P9L1cPIWLE1rApltZxAyCDMEdwtH6FsxJiFBGFv6zOi3gDp/et4Y1sYLoeNZ2DULirGLXQRRglAEQLhcWmNgAs1eaMS2BaF5RA4V48APU5qwXi9qVO1aTS2fqJVK//hocXEulJGQlUPvprD24PZW4hkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 15 31 03" title="" data-src="/static/2019-03-19-15-31-03-4649d4233db0ab736a9e95778365b54e-fee1c.png" data-srcset="/static/2019-03-19-15-31-03-4649d4233db0ab736a9e95778365b54e-a67b7.png 200w,\n/static/2019-03-19-15-31-03-4649d4233db0ab736a9e95778365b54e-0b187.png 400w,\n/static/2019-03-19-15-31-03-4649d4233db0ab736a9e95778365b54e-fee1c.png 800w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>它不仅会使用差异形式的变化（像 Git 这样的源控制工具一样）向你展示，同时还可以撤销它们。</p>\n<p>举个例子：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-03-19-15-33-54-83edd00a852cc34b1ce84e24fbfbc945-ab313.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 677px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.527326440177255%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACGElEQVQoz2VSu24TQRTd/0Kg/AGKyD9QUFBRUFBRUSAaJDpIhdIgpwAJoUiIWOERHBw7AWIl3thx4uzuvGfnse9wdiOl4czqavZozp1z79yA0Fgyvzd/1Tu42xutfTl5BIazdG/+sjde3RyvbU8fU0oEc7uzF5sHq73xvf70CaWMUhrE8SUn7nv4fP3rrdfbK5+O7sfJJSP6W/hsfef2m+2VrcmDJIk5sTvTpy3Tv7M1eZgkJEmSoCzLumpMdk79L5btczcBU5W1zubEXTNH+K/KBgz1QzDCH5cdAqlkagwXxtnKmcrZItUpYNLM29roInOV1tpaq5XLXGPT0tvCew9VIBjnlF5EMEJQhrVGd5BSaK24YDpVALIxTlOjCE2WywucbG0baaLTM7Gko3DQ//NhMT8PwxD3OOcRvM8QjTGtF2NNiuQOW865lDJQTMYXsZJyODnZ+PgjPCVC8vZgp4cKDq86NFiIdVPXjXPIaIOqqjUVikWjw8Xbd8PR74WUDCUgcZ7nOIR4rQTqpvG5RTnInmUZGqai+TIOZ39n/d3jjThZosKr/9CJoW20UXimsqpABkabKFw6ZQ5n+5/H7xlj6ARuq+u61XS41sMvYuY9epsXRSvObeaUxW5xthgMfmJ0CCFRFCOi2hvlDYqiEFIorfAigVXWKeeVnk+n4/EBNKwD5g8WhBC4sPXcfRDnRR4nCZqPIfkHrmSQC+A7CggAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 03 19 15 33 54" title="" data-src="/static/2019-03-19-15-33-54-83edd00a852cc34b1ce84e24fbfbc945-ab313.png" data-srcset="/static/2019-03-19-15-33-54-83edd00a852cc34b1ce84e24fbfbc945-94813.png 200w,\n/static/2019-03-19-15-33-54-83edd00a852cc34b1ce84e24fbfbc945-beb37.png 400w,\n/static/2019-03-19-15-33-54-83edd00a852cc34b1ce84e24fbfbc945-ab313.png 677w" data-sizes="(max-width: 677px) 100vw, 677px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>以上更新于<code class="language-text">2019-3-19 15:43:42</code></p>\n<hr>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Chrome调试技巧/index.md absPath of file >>> MarkdownRemark",timeToRead:14,frontmatter:{date:"2019-03-19 15:43:42",path:"/chrome-debug-practice/",tags:"前端, 调试, 读书笔记",title:"Chrome调试技巧",draft:null}},{excerpt:"异步：现在与将来 分块的程序 程序是由多个块组成，只有一个是现在执行，其余的则会在将来执行，最常见的块单位是函数 程序中将来执行的部分并不一定在现在运行的部分执行完后就立即执行，也就是现在无法完成的任务将会异步完成 从现在到将来的等待最简单的方法是使用一个通常称为回调函数的函数 可以同步发送 ajax 请求，但是建议在任何情况都不应该使用这种方式，因为它会被锁定器 UI（按钮、菜单、滚动条等），并阻塞所有用户交互 考虑以下代码： 以上代码可以拆分现在和将来部分： 异步控制台 宿主环境添加到 js…",html:'<h1 id="异步：现在与将来"><a href="#%E5%BC%82%E6%AD%A5%EF%BC%9A%E7%8E%B0%E5%9C%A8%E4%B8%8E%E5%B0%86%E6%9D%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步：现在与将来</h1>\n<h2 id="分块的程序"><a href="#%E5%88%86%E5%9D%97%E7%9A%84%E7%A8%8B%E5%BA%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分块的程序</h2>\n<ul>\n<li>程序是由多个块组成，只有一个是现在执行，其余的则会在将来执行，最常见的块单位是函数</li>\n<li>程序中将来执行的部分并不一定在现在运行的部分执行完后就立即执行，也就是现在无法完成的任务将会异步完成</li>\n<li>从现在到将来的等待最简单的方法是使用一个通常称为回调函数的函数</li>\n<li>可以同步发送 ajax 请求，但是建议在任何情况都不应该使用这种方式，因为它会被锁定器 UI（按钮、菜单、滚动条等），并阻塞所有用户交互</li>\n</ul>\n<p>考虑以下代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17720932319144022000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function now() {\n  return 21;\n}\nfunction later() {\n  answer = answer * 2;\n  console.log(\'Meaning of life:\', answer);\n}\nvar answer = now();\nsetTimeout(later, 1000);`, `17720932319144022000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token number">21</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">later</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  answer <span class="token operator">=</span> answer <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Meaning of life:\'</span><span class="token punctuation">,</span> answer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> answer <span class="token operator">=</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span>later<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上代码可以拆分现在和将来部分：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61902828836349010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 现在\nfunction now() {\n  return 21;\n}\nfunction later() {\n  /*...*/\n}\nvar answer = now();\nsetTimeout(later, 1000);`, `61902828836349010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 现在</span>\n<span class="token keyword">function</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token number">21</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">later</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">/*...*/</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> answer <span class="token operator">=</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span>later<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70933100679236190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 将来\nanswer = answer * 2;\nconsole.log(\'Meaning of life:\', answer);`, `70933100679236190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 将来</span>\nanswer <span class="token operator">=</span> answer <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Meaning of life:\'</span><span class="token punctuation">,</span> answer<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="异步控制台"><a href="#%E5%BC%82%E6%AD%A5%E6%8E%A7%E5%88%B6%E5%8F%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步控制台</h3>\n<ul>\n<li>宿主环境添加到 js 中的，在某些条件下某些浏览器的 console.log(…) 并不会把传入的内容立即输出</li>\n<li>出现以上情况的原因是，在许多程序中，I/O 是非常低速阻塞部分，所以浏览器在后台异步处理控制台 I/O 能够提高性能</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13200295392787954000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a = {\n  index: 1\n};\nconsole.log(a); //可能为 2，由 I/O 异步化造成\na.index++;`, `13200295392787954000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>\n  index<span class="token punctuation">:</span> <span class="token number">1</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可能为 2，由 I/O 异步化造成</span>\na<span class="token punctuation">.</span>index<span class="token operator">++</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="解决方法"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方法</h4>\n<ul>\n<li>在控制台中使用断点</li>\n<li>把对象序列化到一个字符串中，以强制指向一次快照，比如通过 JSON.stringify()</li>\n</ul>\n<h2 id="事件循环"><a href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>事件循环</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60641372777821580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//eventLoop 是一个用作队列的数组\nvar eventLoop = [];\nvar event;\nwhile (true) {\n  // 一次 tick\n  if (eventLoop.length > 0) {\n    // 拿到队列中的下一个事件\n    event = eventLoop.shift();\n    try {\n      // 执行下一个事件\n      event();\n    } catch (err) {\n      reportError(err);\n    }\n  }\n}`, `60641372777821580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//eventLoop 是一个用作队列的数组</span>\n<span class="token keyword">var</span> eventLoop <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> event<span class="token punctuation">;</span>\n<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 一次 tick</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>eventLoop<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 拿到队列中的下一个事件</span>\n    event <span class="token operator">=</span> eventLoop<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 执行下一个事件</span>\n      <span class="token function">event</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">reportError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>事件循环理解：有一个 while 循环实现的持续运行的循环，循环的每一轮称为一个 tick。对每个 tick 而言，如果在队列中有等待事件，那么就会在队列中摘下一个事件并执行，这些事件就是你的回调函数</p>\n<p>setTimeout 并没有把你的回调函数挂在事件循环队列中，它所作的是设定一个定时器，当定时器到时后，环境会把你的回调函数放在事件循环中，这样在未来的某个时刻 tick 会摘下并执行这个回调</p>\n<p>回调函数不会再指定的时间间隔之前执行，很可能会在那个时刻运行，也有可能在那之后运行，要根据事件队列的状态来决定</p>\n<h2 id="并行线程"><a href="#%E5%B9%B6%E8%A1%8C%E7%BA%BF%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>并行线程</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95059853341779180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a = 20;\nfunction foo() {\n  a = a + 1;\n}\nfunction bar() {\n  a = a * 2;\n}\najax(\'http://some.url.1\', foo);\najax(\'http://some.url.2\', bar);`, `95059853341779180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  a <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>根据 js 单线程运行特性，如果 foo() 运行在 bar() 之前，a 的结果是 42，而如果 bar() 运行在 foo() 之前，a 的结果是 41。</p>\n<p>如果共享同一数据的 js 事件并行执行的话，那么问题会变得非常复杂</p>\n<p>例如线程 a（X 和 Y 是临时内存地址）</p>\n<p>foo():</p>\n<ol>\n<li>把 a 的值加载到 X</li>\n<li>把 1 保存在 Y</li>\n<li>执行 X 加 Y，结果保存在 X</li>\n<li>把 X 的值保存在 a</li>\n</ol>\n<p>线程 b（X 和 Y 是临时内存地址）</p>\n<p>bar():</p>\n<ol>\n<li>把 a 的值加载到 X</li>\n<li>把 2 保存在 Y</li>\n<li>执行 X 乘 Y，结果保存在 X</li>\n<li>把 X 的值保存在 a</li>\n</ol>\n<p>假如按照以下步骤执行</p>\n<table>\n<thead>\n<tr>\n<th align="center">步骤</th>\n<th align="center">执行方法</th>\n<th align="center">结果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">1</td>\n<td align="center">a1</td>\n<td align="center">20</td>\n</tr>\n<tr>\n<td align="center">2</td>\n<td align="center">b1</td>\n<td align="center">20</td>\n</tr>\n<tr>\n<td align="center">3</td>\n<td align="center">a2</td>\n<td align="center">1</td>\n</tr>\n<tr>\n<td align="center">4</td>\n<td align="center">b2</td>\n<td align="center">2</td>\n</tr>\n<tr>\n<td align="center">5</td>\n<td align="center">a3</td>\n<td align="center">22</td>\n</tr>\n<tr>\n<td align="center">6</td>\n<td align="center">a4</td>\n<td align="center">22</td>\n</tr>\n<tr>\n<td align="center">7</td>\n<td align="center">b3</td>\n<td align="center">44</td>\n</tr>\n<tr>\n<td align="center">8</td>\n<td align="center">b4</td>\n<td align="center">44</td>\n</tr>\n</tbody>\n</table>\n<p>按另一种方式运行：</p>\n<table>\n<thead>\n<tr>\n<th align="center">步骤</th>\n<th align="center">执行方法</th>\n<th align="center">结果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">1</td>\n<td align="center">a1</td>\n<td align="center">20</td>\n</tr>\n<tr>\n<td align="center">2</td>\n<td align="center">b1</td>\n<td align="center">20</td>\n</tr>\n<tr>\n<td align="center">3</td>\n<td align="center">b2</td>\n<td align="center">2</td>\n</tr>\n<tr>\n<td align="center">4</td>\n<td align="center">a2</td>\n<td align="center">1</td>\n</tr>\n<tr>\n<td align="center">5</td>\n<td align="center">b3</td>\n<td align="center">20</td>\n</tr>\n<tr>\n<td align="center">6</td>\n<td align="center">a3</td>\n<td align="center">21</td>\n</tr>\n<tr>\n<td align="center">7</td>\n<td align="center">a4</td>\n<td align="center">21</td>\n</tr>\n<tr>\n<td align="center">8</td>\n<td align="center">b4</td>\n<td align="center">21</td>\n</tr>\n</tbody>\n</table>\n<p>所以多线程是非常复杂的，如果不通过特殊的步骤来防止中断和交错运行，可能会得到不确定的行为</p>\n<p>js 从不跨线程共享数据，但并不保证 js 总是确定性的，foo 和 bar 的相对顺序的改变可能会导致不同的结果</p>\n<h3 id="完整运行"><a href="#%E5%AE%8C%E6%95%B4%E8%BF%90%E8%A1%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>完整运行</h3>\n<p>由于 js 单线程特性，foo 以及 bar 中的代码具有原子性，也就是说一旦 foo 开始运行，它的所有代码都会在 bar 中的任意代码运行之前完成，或者相反，这称为完整运行特性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55425717417914740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a = 1;\nvar b = 2;\nfunction foo() {\n  a++;\n  b = b * a;\n  a = b + 3;\n}\nfunction bar() {\n  b--;\n  a = 8 + b;\n  b = a * 2;\n}\najax(\'http://some.url.1\', foo);\najax(\'http://some.url.2\', bar);`, `55425717417914740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  a<span class="token operator">++</span><span class="token punctuation">;</span>\n  b <span class="token operator">=</span> b <span class="token operator">*</span> a<span class="token punctuation">;</span>\n  a <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  b<span class="token operator">--</span><span class="token punctuation">;</span>\n  a <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">+</span> b<span class="token punctuation">;</span>\n  b <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>会被解析为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19926959715423090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//块 1\nvar a = 1;\nvar b = 2;\n//块 2\na++;\nb = b * a;\na = b + 3;\n//块 3\nb--;\na = 8 + b;\nb = a * 2;`, `19926959715423090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//块 1</span>\n<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token comment">//块 2</span>\na<span class="token operator">++</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> b <span class="token operator">*</span> a<span class="token punctuation">;</span>\na <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>\n<span class="token comment">//块 3</span>\nb<span class="token operator">--</span><span class="token punctuation">;</span>\na <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">+</span> b<span class="token punctuation">;</span>\nb <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>块 2 和块 3 哪个都有可能先运行，所以有两种输出，是函数顺序级别的不确定，而不是多线程下语句的顺序级别</p>\n<p>在 js 的特性中，这种函数顺序的不确定性就是通常所说的竞态条件，foo 和 bar 相互竞争，看谁先运行</p>\n<h2 id="并发"><a href="#%E5%B9%B6%E5%8F%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>并发</h2>\n<p>单线程事件循环是并发的一种形式</p>\n<h3 id="非交互"><a href="#%E9%9D%9E%E4%BA%A4%E4%BA%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>非交互</h3>\n<p>如果进程间没有相互影响的话，不确定性是完全可以接受的，如以下代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34453841491973947000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var res = {};\nfunction foo(results) {\n  res.foo = results;\n}\nfunction bar(result) {\n  res.bar = results;\n}\najax(\'http://some.url.1\', foo);\najax(\'http://some.url.2\', bar);`, `34453841491973947000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  res<span class="token punctuation">.</span>foo <span class="token operator">=</span> results<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  res<span class="token punctuation">.</span>bar <span class="token operator">=</span> results<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>不管如何执行，结果一样，这就是非交互</p>\n<h3 id="交互"><a href="#%E4%BA%A4%E4%BA%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>交互</h3>\n<p>更常见的情况是，并发的进程需要交流，通过作用域或 DOM 间接交互，正如前面介绍的，如果出现这样的交互，就需要对他们的交互进行协调以避免竞态的出现</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50271947893567440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var res = {};\nfunction response(data) {\n  res.push(data);\n}\najax(\'http://some.url.1\', response);\najax(\'http://some.url.2\', response);`, `50271947893567440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>不同的调用顺序会导致数组顺序的不同，这种不确定性很有可能就是竞态条件的 bug</p>\n<p>需要协调交互顺序来处理竞态条件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33615014908649000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var res = [];\nfunction response(data) {\n  if (data.url == \'http://some.url.1\') {\n    res[0] = data;\n  } else {\n    res[1] = data;\n  }\n}\najax(\'http://some.url.1\', response);\najax(\'http://some.url.2\', response);`, `33615014908649000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>url <span class="token operator">==</span> <span class="token string">\'http://some.url.1\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有些并发场景不做协调，就总是出错，考虑</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34238475702801453000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a, b;\nfunction foo(x) {\n  a = x * 2;\n  baz();\n}\nfunction bar(y) {\n  b = y * 2;\n  baz();\n}\nfunction baz() {\n  console.log(a + b);\n}\najax(\'http://some.url.1\', foo);\najax(\'http://some.url.2\', bar);`, `34238475702801453000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  a <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  b <span class="token operator">=</span> y <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这个例子中，无论 bar 与 foo 哪一个先触发，总会使 baz 过早运行（a 或者 b 处于未定义状态）；但对 baz 的第二次调用就没有问题，因为这时候 a,b 都已经可用了</p>\n<p>解决方法如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38481561657200710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a, b;\nfunction foo(x) {\n  a = x * 2;\n  if (a && b) {\n    baz();\n  }\n}\nfunction bar(y) {\n  b = y * 2;\n  if (a && b) {\n    baz();\n  }\n}\nfunction baz() {\n  console.log(a + b);\n}\najax(\'http://some.url.1\', foo);\najax(\'http://some.url.2\', bar);`, `38481561657200710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  a <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  b <span class="token operator">=</span> y <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另一种可能遇到的并发交互条件有时称为竞态 (race)，但更精确的叫法是门闩 (latch)，它的特性可以描述为只有第一名取胜，不确定性是可以接受的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2043700319811692000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a;\nfunction foo(x) {\n  a = x * 2;\n  baz();\n}\nfunction bar(x) {\n  a = x / 2;\n  baz();\n}\nfunction baz() {\n  console.log(a);\n}\najax(\'http://some.url.1\', foo);\najax(\'http://some.url.2\', bar);`, `2043700319811692000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a<span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  a <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  a <span class="token operator">=</span> x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>不管哪一个先触发，都会覆盖另外一个给 a 赋的值，也会重复调用 baz</p>\n<p>可以通过一个简单的门闩协调这个过程，只让第一个通过</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40033402898818020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a;\nfunction foo(x) {\n  if (!a) {\n    a = x * 2;\n    baz();\n  }\n}\nfunction bar(x) {\n  if (!a) {\n    a = x / 2;\n    baz();\n  }\n}\nfunction baz() {\n  console.log(a);\n}\najax(\'http://some.url.1\', foo);\najax(\'http://some.url.2\', bar);`, `40033402898818020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a<span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    a <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    a <span class="token operator">=</span> x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上例子只会让第一个运行的通过</p>\n<h3 id="协作"><a href="#%E5%8D%8F%E4%BD%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>协作</h3>\n<p>并发协作：取到一个长期运行的进程，并将其分割成多个步骤或多批任务，使得其他并发进程有机会将自己的运算插入到事件循环队列中交替运行</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76373354926535460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var res=[];\nfunction response(data){\n    res=res.concat(data.map(function(val){\n        return val*2;\n    })\n}\najax(&quot;http://some.url.1&quot;,response);\najax(&quot;http://some.url.2&quot;,response);`, `76373354926535460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> res<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n    res<span class="token operator">=</span>res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        <span class="token keyword">return</span> val<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">"http://some.url.1"</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">"http://some.url.2"</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>假设 ajax 请求的数据规模达到上千万，那么就会阻塞 UI 事件的运行，所以需要创建一个协作性更强且不会阻塞事件循环队列的并发系统，可以分批处理这些结果，每次处理后返回事件循环，让其他等待事件有机会运行</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28563047534502430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var res = [];\nfunction response(data) {\n  var chunk = data.splice(0, 1000);\n  res = res.concat(\n    chunk.map(function(val) {\n      return val * 2;\n    })\n  );\n  if (data.length > 0) {\n    //异步调度下一次批处理\n    setTimeout(function() {\n      response(data);\n    }, 0);\n  }\n}\najax(\'http://some.url.1\', response);\najax(\'http://some.url.2\', response);`, `28563047534502430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> chunk <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  res <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>\n    chunk<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> val <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">//异步调度下一次批处理</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">response</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>每次只处理 1000 条数据，确保运行时间会很短，即使这意味着更多的后续进程，因为事件循环队列的交替运行会提高响应</p>\n<p>当然这些结果的顺序是不可预测的，使用 setTimeout 进行异步调度，其意义在于把这个函数插入到当前事件循环队列的结尾处</p>\n<h2 id="任务"><a href="#%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>任务</h2>\n<p>在 ES6 中，promise 的异步建立在事件循环队列之上，叫做任务队列</p>\n<p>它是挂在事件循环队列的每个 tick 之后的一个队列，任务循环可能无限循环，进而导致程序卡死，无法转移到下一个事件循环 tick</p>\n<p>设想一个调度任务的 API，称之为 schedule，考虑</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64989460924588300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.log(\'A\');\nsetTimeout(function() {\n  console.log(\'B\');\n}, 0);\nschedule(function() {\n  console.log(\'C\');\n  schedule(function() {\n    console.log(\'D\');\n  });\n});`, `64989460924588300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'A\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'B\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'C\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'D\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际打印的结果是 ACDB，因为任务处理是在当前事件循环 tick 结尾处，且定时器触发是为了调度下一个事件循环 tick（如果可用的话）</p>\n<h2 id="语句顺序"><a href="#%E8%AF%AD%E5%8F%A5%E9%A1%BA%E5%BA%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>语句顺序</h2>\n<p>代码中语句的顺序和 js 引擎执行语句的顺序并不一定要一致</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42890814595174650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a, b;\na = 10;\nb = 30;\na = a + 1;\nb = b + 1;\nconsole.log(a + b); //42`, `42890814595174650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>\na <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\na <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//42</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>js 引擎会这样优化以提高执行速度</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71088825908665030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a, b;\na = 11;\nb = 31;\nconsole.log(42);`, `71088825908665030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>\na <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>或者</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66990487404346786000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.log(42);`, `66990487404346786000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但是有一种场景其中特定的优化是不安全的，因此也是不允许的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15290190734347964000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a, b;\na = 10;\nb = 30;\n// 我们需要 a 和 b 处于递增之前的状态\nconsole.log(a * b);\na = a + 1;\nb = b + 1;\nconsole.log(a + b);`, `15290190734347964000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>\na <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\n<span class="token comment">// 我们需要 a 和 b 处于递增之前的状态</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\na <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有其他一些例子，其中编译器排序会产生可见的副作用（因此必须禁止），比如会产生副作用的函数调用或 ES6 代理对象</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38585456068485450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo() {\n  console.log(b);\n  return 1;\n}\nvar a, b, c;\n// ES5.1 getter 字面量语法\nc = {\n  get bar() {\n    console.log(a);\n    return 1;\n  }\n};\na = 10;\nb = 30;\na += foo(); //30\nb += c.bar; //11\nconsole.log(a + b); //42`, `38585456068485450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">;</span>\n<span class="token comment">// ES5.1 getter 字面量语法</span>\nc <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token keyword">get</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\na <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\na <span class="token operator">+=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//30</span>\nb <span class="token operator">+=</span> c<span class="token punctuation">.</span>bar<span class="token punctuation">;</span> <span class="token comment">//11</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//42</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果不是代码片段中的语句 console.log，js 引擎如果愿意的话，本来可以自由的把代码重新排序</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28372504780533170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//...\na = 10 + foo();\nb = 30 + c.bar;\n//...`, `28372504780533170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//...</span>\na <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nb <span class="token operator">=</span> <span class="token number">30</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>bar<span class="token punctuation">;</span>\n<span class="token comment">//...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>编译器语句的重排序几乎就是并发和交互的微型隐喻，作为一个一般性的概念，理解后有助于理清异步 js 的代码流问题</p>\n<h1 id="回调"><a href="#%E5%9B%9E%E8%B0%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>回调</h1>\n<h2 id="continuation"><a href="#continuation" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>continuation</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22261335835201757000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// A\najax( &quot;..&quot;, function(..){\n// C\n} );\n// B`, `22261335835201757000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// A</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">".."</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n<span class="token comment">// C</span>\n<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// B</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>// A 和 // B 表示程序的前半部分（也就是现在的部分），而 // C 标识了程序的后半部分（也就是将来的部分）。前半部分立刻执行，然后是一段时间不确定的停顿。在未来的某个时刻，如果 Ajax 调用完成，程序就会从停下的位置继续执行后半部分。</p>\n<h3 id="嵌套回调与链式回调"><a href="#%E5%B5%8C%E5%A5%97%E5%9B%9E%E8%B0%83%E4%B8%8E%E9%93%BE%E5%BC%8F%E5%9B%9E%E8%B0%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>嵌套回调与链式回调</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97468650536650340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`listen(\'click\', function handler(evt) {\n  setTimeout(function request() {\n    ajax(\'http://some.url.1\', function response(text) {\n      if (text == \'hello\') {\n        handler();\n      } else if (text == \'world\') {\n        request();\n      }\n    });\n  }, 500);\n});`, `97468650536650340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>text <span class="token operator">==</span> <span class="token string">\'hello\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>text <span class="token operator">==</span> <span class="token string">\'world\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种代码常常被称为回调地狱（callback hell），有时也被称为毁灭金字塔</p>\n<p>一开始我们在等待 click 事件，然后等待定时器启动，然后等待 Ajax 响应返回，之后可能再重头开始。</p>\n<p>一眼看去，这段代码似乎很自然地将其异步性映射到了顺序大脑计划。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93383975833069930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`doA(function() {\n  doB();\n  doC(function() {\n    doD();\n  });\n  doE();\n});\ndoF();`, `93383975833069930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">doA</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">doB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">doC</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">doD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">doE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">doF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际运行顺序：doA()、doF()、doB()、doC()、doE()、doD()</p>\n<p>我们的顺序阻塞式的大脑计划行为无法很好地映射到面向回调的异步代码，这就是回调方式最主要的缺陷</p>\n<h2 id="信任问题"><a href="#%E4%BF%A1%E4%BB%BB%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>信任问题</h2>\n<p>顺序的人脑计划和回调驱动的异步 JavaScript 代码之间的不匹配只是回调问题的一部分。还有一些更深入的问题需要考虑</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10479627598904350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// A\najax( &quot;..&quot;, function(..){\n// C\n} );\n// B`, `10479627598904350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// A</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span> <span class="token string">".."</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n<span class="token comment">// C</span>\n<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// B</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有时候 ajax(..) （也就是你交付回调 continuation 的第三方）不是你编写的代码，也不在你的直接控制下。多数情况下，它是某个第三方提供的工具</p>\n<p>我们把这称为控制反转（inversion of control），也就是把自己程序一部分的执行控制交给某个第三方。在你的代码和第三方工具（一组你希望有人维护的东西）之间有一份并没有明确表达的契约</p>\n<h3 id="五个回调的故事"><a href="#%E4%BA%94%E4%B8%AA%E5%9B%9E%E8%B0%83%E7%9A%84%E6%95%85%E4%BA%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>五个回调的故事</h3>\n<p>假设你是一名开发人员，为某个销售昂贵电视的网站建立商务结账系统。你已经做好了结账系统的各个界面。在最后一页，当用户点击“确定”就可以购买电视时，你需要调用（假设由某个分析追踪公司提供的）第三方函数以便跟踪这个交易。</p>\n<p>代码可能是这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22972890190958584000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`analytics.trackPurchase(purchaseData, function() {\n  chargeCreditCard();\n  displayThankyouPage();\n});`, `22972890190958584000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">analytics<span class="token punctuation">.</span><span class="token function">trackPurchase</span><span class="token punctuation">(</span>purchaseData<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">chargeCreditCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">displayThankyouPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>唯一的解释就是那个分析工具出于某种原因把你的回调调用了五次而不是一次。他们的文档中完全没有提到这种情况</p>\n<p>经过修补之后，你实现了像下面这样的简单临时代码，大家似乎也很满意：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2525604380390267400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var tracked = false;\nanalytics.trackPurchase(purchaseData, function() {\n  if (!tracked) {\n    tracked = true;\n    chargeCreditCard();\n    displayThankyouPage();\n  }\n});`, `2525604380390267400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> tracked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\nanalytics<span class="token punctuation">.</span><span class="token function">trackPurchase</span><span class="token punctuation">(</span>purchaseData<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tracked<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    tracked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token function">chargeCreditCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">displayThankyouPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，后来有一个 QA 工程师问道：“如果他们根本不调用这个回调怎么办？”哎呦！之前你们双方都没有想到这一点。</p>\n<p>然后，你开始沿着这个兔子洞深挖下去，考虑着他们调用你的回调时所有可能的出错情况。这里粗略列出了你能想到的分析工具可能出错的情况：</p>\n<ul>\n<li>调用回调过早（在追踪之前）；</li>\n<li>调用回调过晚（或没有调用）；</li>\n<li>调用回调的次数太少或太多（就像你遇到过的问题！）；</li>\n<li>没有把所需的环境 / 参数成功传给你的回调函数；</li>\n<li>吞掉可能出现的错误或异常；</li>\n</ul>\n<p>这感觉就像是一个麻烦列表，实际上它就是。你可能已经开始慢慢意识到，对于被传给你无法信任的工具的每个回调，你都将不得不创建大量的混乱逻辑。</p>\n<h3 id="不只是别人的代码"><a href="#%E4%B8%8D%E5%8F%AA%E6%98%AF%E5%88%AB%E4%BA%BA%E7%9A%84%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不只是别人的代码</h3>\n<p>回调并没有为我们提供任何东西来支持类型的检查 / 规范化。我们不得不自己构建全部的机制，而且通常为每个异步回调重复这样的工作最后都成了负担。</p>\n<p>回调最大的问题是控制反转，它会导致信任链的完全断裂。</p>\n<p>如果你的代码中使用了回调，尤其是但也不限于使用第三方工具，而且你还没有应用某种逻辑来解决所有这些控制反转导致的信任问题，那你的代码现在已经有了 bug，即使它们还没有给你造成损害，隐藏的 bug 也是 bug。</p>\n<h2 id="省点回调"><a href="#%E7%9C%81%E7%82%B9%E5%9B%9E%E8%B0%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>省点回调</h2>\n<p>回调设计存在几个变体，意在解决前面讨论的一些信任问题（不是全部！）。这种试图从回调模式内部挽救它的意图是勇敢的，但却注定要失败。</p>\n<p>举例来说，为了更优雅地处理错误，有些 API 设计提供了分离回调（一个用于成功通知，一个用于出错通知）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70107566189252730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function success(data) {\n  console.log(data);\n}\nfunction failure(err) {\n  console.error(err);\n}\najax(\'http://some.url.1\', success, failure);`, `70107566189252730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">failure</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> success<span class="token punctuation">,</span> failure<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这种设计下，API 的出错处理函数 failure() 常常是可选的，如果没有提供的话，就是假定这个错误可以吞掉。</p>\n<p>还有一种常见的回调模式叫作“error-first 风格”（有时候也称为“Node 风格”，因为几乎所有 Node.js API 都采用这种风格），其中回调的第一个参数保留用作错误对象（如果有的话）。如果成功的话，这个参数就会被清空 / 置假（后续的参数就是成功数据）。不过，如果产生了错误结果，那么第一个参数就会被置起 / 置真（通常就不会再传递其他结果）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67714750610955260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function response(err, data) {\n  // 出错？\n  if (err) {\n    console.error(err);\n  }\n  // 否则认为成功\n  else {\n    console.log(data);\n  }\n}\najax(\'http://some.url.1\', response);`, `67714750610955260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 出错？</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 否则认为成功</span>\n  <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这两种情况下，都应该注意到以下几点。</p>\n<p>这并没有像表面看上去那样真正解决主要的信任问题。这并没有涉及阻止或过滤不想要的重复调用回调的问题，因为现在你可能同时得到成功或者失败的结果，或者都没有，并且你还是不得不编码处理所有这些情况</p>\n<p>那么完全不调用这个信任问题又会怎样呢？如果这是个问题的话（可能应该是个问题！），你可能需要设置一个超时来取消事件。可以构造一个工具（这里展示的只是一个“验证概念”版本）来帮助实现这一点</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28890088807938863000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function timeoutify(fn, delay) {\n  var intv = setTimeout(function() {\n    intv = null;\n    fn(new Error(\'Timeout!\'));\n  }, delay);\n\n  return function() {\n    // 还没有超时？\n    if (intv) {\n      clearTimeout(intv);\n      fn.apply(this, arguments);\n    }\n  };\n}`, `28890088807938863000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">timeoutify</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> intv <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    intv <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Timeout!\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 还没有超时？</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>intv<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>intv<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以下是使用方式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47859199211406380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用&quot;error-first 风格&quot; 回调设计\nfunction foo(err, data) {\n  if (err) {\n    console.error(err);\n  } else {\n    console.log(data);\n  }\n}\najax(\'http://some.url.1\', timeoutify(foo, 500));`, `47859199211406380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 使用"error-first 风格" 回调设计</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> <span class="token function">timeoutify</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有一个信任问题是调用过早。在特定应用的术语中，这可能实际上是指在某个关键任务完成之前调用回调。但是更通用地来说，对于既可能在现在（同步）也可能在将来（异步）调用你的回调的工具来说，这个问题是明显的。</p>\n<p>这种由同步或异步行为引起的不确定性几乎总会带来极大的 bug 追踪难度</p>\n<p>这也引出了一条非常有效的建议：永远异步调用回调，即使就在事件循环的下一轮，这样，所有回调就都是可预测的异步调用了</p>\n<p>考虑：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46271297528730160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function result(data) {\n  console.log(a);\n}\nvar a = 0;\najax(\'..pre-cached-url..\', result);\na++;`, `46271297528730160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'..pre-cached-url..\'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>\na<span class="token operator">++</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这段代码会打印出 0 （同步回调调用）还是 1 （异步回调调用）呢？这要视情况而定。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53286165310145540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function asyncify(fn) {\n  var orig_fn = fn,\n    intv = setTimeout(function() {\n      intv = null;\n      if (fn) fn();\n    }, 0);\n  fn = null;\n  return function() {\n    // 触发太快，在定时器 intv 触发指示异步转换发生之前？\n    if (intv) {\n      fn = orig_fn.bind.apply(\n        orig_fn,\n        // 把封装器的 this 添加到 bind(..) 调用的参数中，\n        // 以及克里化（currying）所有传入参数\n        [this].concat([].slice.call(arguments))\n      );\n    }\n    // 已经是异步\n    else {\n      // 调用原来的函数\n      orig_fn.apply(this, arguments);\n    }\n  };\n}`, `53286165310145540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">asyncify</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> orig_fn <span class="token operator">=</span> fn<span class="token punctuation">,</span>\n    intv <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      intv <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  fn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 触发太快，在定时器 intv 触发指示异步转换发生之前？</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>intv<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      fn <span class="token operator">=</span> orig_fn<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>\n        orig_fn<span class="token punctuation">,</span>\n        <span class="token comment">// 把封装器的 this 添加到 bind(..) 调用的参数中，</span>\n        <span class="token comment">// 以及克里化（currying）所有传入参数</span>\n        <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// 已经是异步</span>\n    <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 调用原来的函数</span>\n      <span class="token function">orig_fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以像这样使用 asyncify(..) ：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83141973684477620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function result(data) {\n  console.log(a);\n}\nvar a = 0;\najax(\'..pre-cached-url..\', asyncify(result));\na++;`, `83141973684477620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">\'..pre-cached-url..\'</span><span class="token punctuation">,</span> <span class="token function">asyncify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\na<span class="token operator">++</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>不管这个 Ajax 请求已经在缓存中并试图对回调立即调用，还是要从网络上取得，进而在将来异步完成，这段代码总是会输出 1 ，而不是 0 —— result(..) 只能异步调用，这意味着 a++ 有机会在 result(..) 之前运行。</p>\n<p>可能现在你希望有内建的 API 或其他语言机制来解决这些问题。最终，ES6 带着一些极好的答案登场了，所以，继续读下去吧！</p>\n<h1 id="promise"><a href="#promise" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise</h1>\n<h2 id="什么是-promise"><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-promise" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>什么是 Promise</h2>\n<p>事实证明，只了解 API 会丢失很多抽象的细节。Promise 属于这样一类工具：通过某人使用它的方式，很容易分辨他是真正理解了这门技术，还是仅仅学习和使用 API 而已</p>\n<h3 id="未来值"><a href="#%E6%9C%AA%E6%9D%A5%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未来值</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54650655159811490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function add(getX, getY, cb) {\n  var x, y;\n  getX(function(xVal) {\n    x = xVal;\n    // 两个都准备好了？\n    if (y != undefined) {\n      cb(x + y); // 发送和\n    }\n  });\n  getY(function(yVal) {\n    y = yVal;\n    // 两个都准备好了？\n    if (x != undefined) {\n      cb(x + y); // 发送和\n    }\n  });\n}\n\n// fetchX() 和 fetchY() 是同步或者异步函数\nadd(fetchX, fetchY, function(sum) {\n  console.log(sum); // 是不是很容易？\n});`, `54650655159811490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">getX<span class="token punctuation">,</span> getY<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>\n  <span class="token function">getX</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    x <span class="token operator">=</span> xVal<span class="token punctuation">;</span>\n    <span class="token comment">// 两个都准备好了？</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">cb</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送和</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">getY</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">yVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    y <span class="token operator">=</span> yVal<span class="token punctuation">;</span>\n    <span class="token comment">// 两个都准备好了？</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">cb</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送和</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// fetchX() 和 fetchY() 是同步或者异步函数</span>\n<span class="token function">add</span><span class="token punctuation">(</span>fetchX<span class="token punctuation">,</span> fetchY<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是不是很容易？</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这段代码中，我们把 x 和 y 当作未来值，并且表达了一个运算 add(..) 。这个运算（从外部看）不在意 x 和 y 现在是否都已经可用。换句话说，它把现在和将来归一化了，因此我们可以确保这个 add(..) 运算的输出是可预测的</p>\n<p>为了统一处理现在和将来，我们把它们都变成了将来，即所有的操作都成了异步的</p>\n<p>通过 Promise 函数表达这个 x + y 的例子</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87981115363587010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function add(xPromise, yPromise) {\n  // Promise.all([ .. ]) 接受一个 promise 数组并返回一个新的 promise，\n  // 这个新 promise 等待数组中的所有 promise 完成\n  return (\n    Promise.all([xPromise, yPromise])\n      // 这个 promise 决议之后，我们取得收到的 X 和 Y 值并加在一起\n      .then(function(values) {\n        // values 是来自于之前决议的 promise 的消息数组\n        return values[0] + values[1];\n      })\n  );\n}\n// fetchX() 和 fetchY() 返回相应值的 promise，可能已经就绪，\n// 也可能以后就绪\nadd(fetchX(), fetchY())\n  // 我们得到一个这两个数组的和的 promise\n  // 现在链式调用 then(..) 来等待返回 promise 的决议\n  .then(function(sum) {\n    console.log(sum); // 这更简单！\n  });`, `87981115363587010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">xPromise<span class="token punctuation">,</span> yPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// Promise.all([ .. ]) 接受一个 promise 数组并返回一个新的 promise，</span>\n  <span class="token comment">// 这个新 promise 等待数组中的所有 promise 完成</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>xPromise<span class="token punctuation">,</span> yPromise<span class="token punctuation">]</span><span class="token punctuation">)</span>\n      <span class="token comment">// 这个 promise 决议之后，我们取得收到的 X 和 Y 值并加在一起</span>\n      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// values 是来自于之前决议的 promise 的消息数组</span>\n        <span class="token keyword">return</span> values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// fetchX() 和 fetchY() 返回相应值的 promise，可能已经就绪，</span>\n<span class="token comment">// 也可能以后就绪</span>\n<span class="token function">add</span><span class="token punctuation">(</span><span class="token function">fetchX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fetchY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token comment">// 我们得到一个这两个数组的和的 promise</span>\n  <span class="token comment">// 现在链式调用 then(..) 来等待返回 promise 的决议</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这更简单！</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>fetchX() 和 fetchY() 是直接调用的，它们的返回值（promise）被传给 add(..) 。这些 promise 代表的底层值的可用时间可能是现在或将来，但不管怎样，promise 归一保证了行为的一致性。我们可以按照不依赖于时间的方式追踪值 X 和 Y 。它们是未来值。</p>\n<p>第二层是 add(..) （通过 Promise.all([ .. ]) ）创建并返回的 promise。我们通过调用 then(..) 等待这个 promise。 add(..) 运算完成后，未来值 sum 就准备好了，可以打印出来。我们把等待未来值 X 和 Y 的逻辑隐藏在了 add(..) 内部。</p>\n<p>通过 Promise，调用 then(..) 实际上可以接受两个函数，第一个用于完成情况（如前所示），第二个用于拒绝情况：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34329938848799134000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`add(fetchX(), fetchY()).then(\n  // 完成处理函数\n  function(sum) {\n    console.log(sum);\n  },\n  // 拒绝处理函数\n  function(err) {\n    console.error(err); // 烦！\n  }\n);`, `34329938848799134000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">fetchX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fetchY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token comment">// 完成处理函数</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// 拒绝处理函数</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 烦！</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果在获取 X 或 Y 的过程中出错，或者在加法过程中出错， add(..) 返回的就是一个被拒绝的 promise，传给 then(..) 的第二个错误处理回调就会从这个 promise 中得到拒绝值。</p>\n<p>Promise 是一种封装和组合未来值的易于复用的机制。</p>\n<h3 id="完成事件"><a href="#%E5%AE%8C%E6%88%90%E4%BA%8B%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>完成事件</h3>\n<p>如前所述，单独的 Promise 展示了未来值的特性。但是，也可以从另外一个角度看待 Promise 的决议：一种在异步任务中作为两个或更多步骤的流程控制机制，时序上的 this-then-that。</p>\n<p>使用回调的话，通知就是任务 (foo(..)) 调用的回调。而使用 Promise 的话，我们把这个关系反转了过来，侦听来自 foo(..) 的事件，然后在得到通知的时候，根据情况继续。</p>\n<p>首先，考虑以下伪代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38948069877339960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`foo(x) {\n    // 开始做点可能耗时的工作\n}\nfoo(42)\non (foo &quot;completion&quot;) {\n    // 可以进行下一步了！\n}\non (foo &quot;error&quot;) {\n    // 啊，foo(..) 中出错了\n}`, `38948069877339960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 开始做点可能耗时的工作</span>\n<span class="token punctuation">}</span>\n<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>\n<span class="token function">on</span> <span class="token punctuation">(</span>foo <span class="token string">"completion"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 可以进行下一步了！</span>\n<span class="token punctuation">}</span>\n<span class="token function">on</span> <span class="token punctuation">(</span>foo <span class="token string">"error"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 啊，foo(..) 中出错了</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们调用 foo(..) ，然后建立了两个事件侦听器，一个用于 ” completion” ，一个用于”error” —— foo(..) 调用的两种可能结果。从本质上讲， foo(..) 并不需要了解调用代码订阅了这些事件，这样就很好地实现了关注点分离。</p>\n<p>遗憾的是，这样的代码需要 JavaScript 环境提供某种魔法，而这种环境并不存在（实际上也有点不实际）。以下是在 JavaScript 中更自然的表达方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57045274515479585000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo(x) {\n  // 开始做点可能耗时的工作\n  // 构造一个 listener 事件通知处理对象来返回\n  return listener;\n}\nvar evt = foo(42);\nevt.on(\'completion\', function() {\n  // 可以进行下一步了！\n});\nevt.on(\'failure\', function(err) {\n  // 啊，foo(..) 中出错了\n});`, `57045274515479585000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 开始做点可能耗时的工作</span>\n  <span class="token comment">// 构造一个 listener 事件通知处理对象来返回</span>\n  <span class="token keyword">return</span> listener<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> evt <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nevt<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'completion\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 可以进行下一步了！</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nevt<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'failure\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 啊，foo(..) 中出错了</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>foo(..) 显式创建并返回了一个事件订阅对象，调用代码得到这个对象，并在其上注册了两个事件处理函数。</p>\n<p>相对于面向回调的代码，这里的反转是显而易见的，而且这也是有意为之。这里没有把回调传给 foo(..) ，而是返回一个名为 evt 的事件注册对象，由它来接受回调。</p>\n<p>回调本身就表达了一种控制反转。所以对回调模式的反转实际上是对反转的反转，或者称为反控制反转——把控制返还给调用代码，这也是我们最开始想要的效果。</p>\n<p>一个很重要的好处是，可以把这个事件侦听对象提供给代码中多个独立的部分；在 foo(..) 完成的时候，它们都可以独立地得到通知，以执行下一步：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77848879027591530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var evt = foo(42);\n// 让 bar(..) 侦听 foo(..) 的完成\nbar(evt);\n// 并且让 baz(..) 侦听 foo(..) 的完成\nbaz(evt);`, `77848879027591530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> evt <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 让 bar(..) 侦听 foo(..) 的完成</span>\n<span class="token function">bar</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 并且让 baz(..) 侦听 foo(..) 的完成</span>\n<span class="token function">baz</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对控制反转的恢复实现了更好的关注点分离，其中 bar(..) 和 baz(..) 不需要牵扯到 foo(..) 的调用细节。类似地， foo(..) 不需要知道或关注 bar(..) 和 baz(..) 是否存在，或者是否在等待 foo(..) 的完成通知。</p>\n<p>从本质上说， evt 对象就是分离的关注点之间一个中立的第三方协商机制。</p>\n<p>事件侦听对象 evt 就是 Promise 的一个模拟。</p>\n<p>在基于 Promise 的方法中，前面的代码片段会让 foo(..) 创建并返回一个 Promise 实例，而且这个 Promise 会被传递到 bar(..) 和 baz(..)</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31984136848284670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo(x) {\n  // 可是做一些可能耗时的工作\n  // 构造并返回一个 promise\n  return new Promise(function(resolve, reject) {\n    // 最终调用 resolve(..) 或者 reject(..)\n    // 这是这个 promise 的决议回调\n  });\n}\nvar p = foo(42);\nbar(p);\nbaz(p);`, `31984136848284670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 可是做一些可能耗时的工作</span>\n  <span class="token comment">// 构造并返回一个 promise</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 最终调用 resolve(..) 或者 reject(..)</span>\n    <span class="token comment">// 这是这个 promise 的决议回调</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">bar</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">baz</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你可能会猜测 bar(..) 和 baz(..) 的内部实现或许如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19274733326164030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function bar(fooPromise) {\n  // 侦听 foo(..) 完成\n  fooPromise.then(\n    function() {\n      // foo(..) 已经完毕，所以执行 bar(..) 的任务\n    },\n    function() {\n      // 啊，foo(..) 中出错了！\n    }\n  );\n}`, `19274733326164030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">fooPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 侦听 foo(..) 完成</span>\n  fooPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// foo(..) 已经完毕，所以执行 bar(..) 的任务</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 啊，foo(..) 中出错了！</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另外一种实现方式是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38029994018427570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function bar() {\n  // foo(..) 肯定已经完成，所以执行 bar(..) 的任务\n}\nfunction oopsBar() {\n  // 啊，foo(..) 中出错了，所以 bar(..) 没有运行\n}\n// 对于 baz() 和 oopsBaz() 也是一样\nvar p = foo(42);\np.then(bar, oopsBar);\np.then(baz, oopsBaz);`, `38029994018427570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// foo(..) 肯定已经完成，所以执行 bar(..) 的任务</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">oopsBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 啊，foo(..) 中出错了，所以 bar(..) 没有运行</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 对于 baz() 和 oopsBaz() 也是一样</span>\n<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>bar<span class="token punctuation">,</span> oopsBar<span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>baz<span class="token punctuation">,</span> oopsBaz<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里没有把 promise p 传给 bar(..) 和 baz(..) ，而是使用 promise 控制 bar(..) 和 baz(..) 何时执行，如果执行的话。最主要的区别在于错误处理部分。</p>\n<p>在第一段代码的方法里，不论 foo(..) 成功与否， bar(..) 都会被调用。并且如果收到了 foo(..) 失败的通知，它会亲自处理自己的回退逻辑。显然， baz(..) 也是如此。</p>\n<p>在第二段代码中， bar(..) 只有在 foo(..) 成功时才会被调用，否则就会调用 oppsBar(..) 。baz(..) 也是如此。</p>\n<p>不管哪种情况，都是从 foo(..) 返回的 promise p 来控制接下来的步骤。</p>\n<p>另外，两段代码都以使用 promise p 调用 then(..) 两次结束。这个事实说明了前面的观点，就是 Promise（一旦决议）一直保持其决议结果（完成或拒绝）不变，可以按照需要多次查看</p>\n<p>一旦 p 决议，不论是现在还是将来，下一个步骤总是相同的。</p>\n<h3 id="具有-then-方法的鸭子类型"><a href="#%E5%85%B7%E6%9C%89-then-%E6%96%B9%E6%B3%95%E7%9A%84%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具有 then 方法的鸭子类型</h3>\n<p>在 Promise 领域，一个重要的细节是如何确定某个值是不是真正的 Promise。或者更直接地说，它是不是一个行为方式类似于 Promise 的值</p>\n<p>因此，识别 Promise（或者行为类似于 Promise 的东西）就是定义某种称为 thenable 的东西，将其定义为任何具有 then(..) 方法的对象和函数。我们认为，任何这样的值就是 Promise 一致的 thenable。</p>\n<p>根据一个值的形态（具有哪些属性）对这个值的类型做出一些假定。这种类型检查（typecheck）一般用术语鸭子类型（duck typing）来表示——“如果它看起来像只鸭子，叫起来像只鸭子，那它一定就是只鸭子”（参见本书的“类型和语法”部分）。于是，对 thenable 值的鸭子类型检测就大致类似于</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41648415277363090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (p !== null && (typeof p === \'object\' || typeof p === \'function\') && typeof p.then === \'function\') {\n  // 假定这是一个 thenable!\n} else {\n  // 不是 thenable\n}`, `41648415277363090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> p <span class="token operator">===</span> <span class="token string">\'object\'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> p <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> p<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 假定这是一个 thenable!</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 不是 thenable</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果你试图使用恰好有 then(..) 函数的一个对象或函数值完成一个 Promise，但并不希望它被当作 Promise 或 thenable，那就有点麻烦了，因为它会自动被识别为 thenable，并被按照特定的规则处理（参见本章后面的内容）。</p>\n<p>即使你并没有意识到这个值有 then(..) 函数也是这样。比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8116104106917721000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var o = { then: function() {} };\n// 让 v [[Prototype]]-link 到 o\nvar v = Object.create(o);\nv.someStuff = \'cool\';\nv.otherStuff = \'not so cool\';\nv.hasOwnProperty(\'then\'); // false`, `8116104106917721000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function-variable function">then</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token comment">// 让 v [[Prototype]]-link 到 o</span>\n<span class="token keyword">var</span> v <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>\nv<span class="token punctuation">.</span>someStuff <span class="token operator">=</span> <span class="token string">\'cool\'</span><span class="token punctuation">;</span>\nv<span class="token punctuation">.</span>otherStuff <span class="token operator">=</span> <span class="token string">\'not so cool\'</span><span class="token punctuation">;</span>\nv<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">\'then\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35940238093774690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Object.prototype.then = function() {};\nArray.prototype.then = function() {};\nvar v1 = { hello: \'world\' };\nvar v2 = [\'Hello\', \'World\'];`, `35940238093774690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> v1 <span class="token operator">=</span> <span class="token punctuation">{</span> hello<span class="token punctuation">:</span> <span class="token string">\'world\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> v2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'Hello\'</span><span class="token punctuation">,</span> <span class="token string">\'World\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>v1 和 v2 都会被认作 thenable</p>\n<p>如果 thenable 鸭子类型误把不是 Promise 的东西识别为了 Promise，可能就是有害的</p>\n<h2 id="promise-信任问题"><a href="#promise-%E4%BF%A1%E4%BB%BB%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 信任问题</h2>\n<h3 id="调用过早"><a href="#%E8%B0%83%E7%94%A8%E8%BF%87%E6%97%A9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用过早</h3>\n<p>这个问题主要就是担心代码是否会引入类似 Zalgo 这样的副作用（参见第 2 章）。在这类问题中，一个任务有时同步完成，有时异步完成，这可能会导致竞态条件。</p>\n<p>根据定义，Promise 就不必担心这种问题，因为即使是立即完成的 Promise（类似于 new Promise(function(resolve){ resolve(42); })）也无法被同步观察到。</p>\n<p>也就是说，对一个 Promise 调用 then(..) 的时候，即使这个 Promise 已经决议，提供给 then(..) 的回调也总会被异步调用（对此的更多讨论，请参见 1.5 节）。</p>\n<p>不再需要插入你自己的 setTimeout(..,0) hack，Promise 会自动防止 Zalgo 出现。</p>\n<h3 id="调用过晚"><a href="#%E8%B0%83%E7%94%A8%E8%BF%87%E6%99%9A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用过晚</h3>\n<p>和前面一点类似，Promise 创建对象调用 resolve(..) 或 reject(..) 时，这个 Promise 的 then(..) 注册的观察回调就会被自动调度。可以确信，这些被调度的回调在下一个异步事件点上一定会被触发</p>\n<p>同步查看是不可能的，所以一个同步任务链无法以这种方式运行来实现按照预期有效延迟另一个回调的发生。也就是说，一个 Promise 决议后，这个 Promise 上所有的通过 then(..) 注册的回调都会在下一个异步时机点上依次被立即调用（再次提醒，请参见 1.5 节）。这些回调中的任意一个都无法影响或延误对其他回调的调用。</p>\n<p>举例来说</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28194415486160550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`p.then(function() {\n  p.then(function() {\n    console.log(\'C\');\n  });\n  console.log(\'A\');\n});\np.then(function() {\n  console.log(\'B\');\n});\n// A B C`, `28194415486160550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'C\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'A\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'B\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// A B C</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里， “C” 无法打断或抢占 “B” ，这是因为 Promise 的运作方式。</p>\n<p>但是，还有很重要的一点需要指出，有很多调度的细微差别。在这种情况下，两个独立 Promise 上链接的回调的相对顺序无法可靠预测。</p>\n<p>如果两个 promise p1 和 p2 都已经决议，那么 p1.then(..) ; p2.then(..) 应该最终会先调用 p1 的回调，然后是 p2 的那些。但还有一些微妙的场景可能不是这样的，比如以下代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98959979867142360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p3 = new Promise(function(resolve, reject) {\n  resolve(\'B\');\n});\nvar p1 = new Promise(function(resolve, reject) {\n  resolve(p3);\n});\np2 = new Promise(function(resolve, reject) {\n  resolve(\'A\');\n});\np1.then(function(v) {\n  console.log(v);\n});\np2.then(function(v) {\n  console.log(v);\n});\n// A B <-- 而不是像你可能认为的 B A`, `98959979867142360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">\'B\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">\'A\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// A B &lt;-- 而不是像你可能认为的 B A</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>后面我们还会深入介绍，但目前你可以看到， p1 不是用立即值而是用另一个 promise p3 决议，后者本身决议为值 “B” 。规定的行为是把 p3 展开到 p1 ，但是是异步地展开。所以，在异步任务队列中， p1 的回调排在 p2 的回调之后（参见 1.5 节）。</p>\n<p>要避免这样的细微区别带来的噩梦，你永远都不应该依赖于不同 Promise 间回调的顺序和调度。实际上，好的编码实践方案根本不会让多个回调的顺序有丝毫影响，可能的话就要避免。</p>\n<h3 id="回调未调用"><a href="#%E5%9B%9E%E8%B0%83%E6%9C%AA%E8%B0%83%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>回调未调用</h3>\n<p>这个问题很常见，Promise 可以通过几种途径解决。</p>\n<p>首先，没有任何东西（甚至 JavaScript 错误）能阻止 Promise 向你通知它的决议（如果它决议了的话）。如果你对一个 Promise 注册了一个完成回调和一个拒绝回调，那么 Promise 在决议时总是会调用其中的一个</p>\n<p>当然，如果你的回调函数本身包含 JavaScript 错误，那可能就会看不到你期望的结果，但实际上回调还是被调用了。后面我们会介绍如何在回调出错时得到通知，因为就连这些错误也不会被吞掉</p>\n<p>但是，如果 Promise 本身永远不被决议呢？即使这样，Promise 也提供了解决方案，其使用了一种称为竞态的高级抽象机制：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90911529036288980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 用于超时一个 Promise 的工具\nfunction timeoutPromise(delay) {\n  return new Promise(function(resolve, reject) {\n    setTimeout(function() {\n      reject(\'Timeout!\');\n    }, delay);\n  });\n}\n// 设置 foo() 超时\nPromise.race([\n  foo(), // 试着开始 foo()\n  timeoutPromise(3000) // 给它 3 秒钟\n]).then(\n  function() {\n    // foo(..) 及时完成！\n  },\n  function(err) {\n    // 或者 foo() 被拒绝，或者只是没能按时完成\n    // 查看 err 来了解是哪种情况\n  }\n);`, `90911529036288980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 用于超时一个 Promise 的工具</span>\n<span class="token keyword">function</span> <span class="token function">timeoutPromise</span><span class="token punctuation">(</span><span class="token parameter">delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">\'Timeout!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 设置 foo() 超时</span>\nPromise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 试着开始 foo()</span>\n  <span class="token function">timeoutPromise</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span> <span class="token comment">// 给它 3 秒钟</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// foo(..) 及时完成！</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 或者 foo() 被拒绝，或者只是没能按时完成</span>\n    <span class="token comment">// 查看 err 来了解是哪种情况</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>很重要的一点是，我们可以保证一个 foo() 有一个输出信号，防止其永久挂住程序。</p>\n<h3 id="调用次数过少或过多"><a href="#%E8%B0%83%E7%94%A8%E6%AC%A1%E6%95%B0%E8%BF%87%E5%B0%91%E6%88%96%E8%BF%87%E5%A4%9A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用次数过少或过多</h3>\n<p>根据定义，回调被调用的正确次数应该是 1，“过少”的情况就是调用 0 次，和前面解释过的“未被”调用是同一种情况。</p>\n<p>过多的情况很容易解释，Promise 的定义方式使得它只能被决议一次。如果出于某种原因，Promise 创建代码试图调用 resolve(..) 或 reject(..) 多次，或者试图两者都调用，那么这个 Promise 将只会接受第一次决议，并默默地忽略任何后续调用。</p>\n<p>由于 Promise 只能被决议一次，所以任何通过 then(..) 注册的（每个）回调就只会被调用一次。</p>\n<p>当然，如果你把同一个回调注册了不止一次（比如 p.then(f); p.then(f);），那它被调用的次数就会和注册次数相同。响应函数只会被调用一次，但这个保证并不能预防你搬起石头砸自己的脚。</p>\n<h3 id="未能传递参数--环境值"><a href="#%E6%9C%AA%E8%83%BD%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0--%E7%8E%AF%E5%A2%83%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未能传递参数 / 环境值</h3>\n<p>Promise 至多只能有一个决议值（完成或拒绝）</p>\n<p>如果你没有用任何值显式决议，那么这个值就是 undefined ，这是 JavaScript 常见的处理方式。但不管这个值是什么，无论当前或未来，它都会被传给所有注册的（且适当的完成或拒绝）回调。</p>\n<p>还有一点需要清楚：如果使用多个参数调用 resovle(..) 或者 reject(..) ，第一个参数之后的所有参数都会被默默忽略。这看起来似乎违背了我们前面介绍的保证，但实际上并没有，因为这是对 Promise 机制的无效使用。对于这组 API 的其他无效使用（比如多次重复调用 resolve(..) ），也是类似的保护处理，所以这里的 Promise 行为是一致的（如果不是有点令人沮丧的话）。</p>\n<p>对环境来说，JavaScript 中的函数总是保持其定义所在的作用域的闭包（参见《你不知道的 JavaScript（上卷）》的“作用域和闭包”部分），所以它们当然可以继续访问你提供的环境状态。当然，对于只用回调的设计也是这样，因此这并不是 Promise 特有的优点——但不管怎样，这仍是我们可以依靠的一个保证。</p>\n<h3 id="吞掉错误或异常"><a href="#%E5%90%9E%E6%8E%89%E9%94%99%E8%AF%AF%E6%88%96%E5%BC%82%E5%B8%B8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>吞掉错误或异常</h3>\n<p>基本上，这部分是上个要点的再次说明。如果拒绝一个 Promise 并给出一个理由（也就是一个出错消息），这个值就会被传给拒绝回调。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7331180909085777000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = new Promise(function(resolve, reject) {\n  foo.bar(); // foo 未定义，所以会出错！\n  resolve(42); // 永远不会到达这里 :(\n});\np.then(\n  function fulfilled() {\n    // 永远不会到达这里 :(\n  },\n  function rejected(err) {\n    // err 将会是一个 TypeError 异常对象来自 foo.bar() 这一行\n  }\n);`, `7331180909085777000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo 未定义，所以会出错！</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 永远不会到达这里 :(</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 永远不会到达这里 :(</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// err 将会是一个 TypeError 异常对象来自 foo.bar() 这一行</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>foo.bar() 中发生的 JavaScript 异常导致了 Promise 拒绝，你可以捕捉并对其作出响应</p>\n<p>这是一个重要的细节，因为其有效解决了另外一个潜在的 Zalgo 风险，即出错可能会引起同步响应，而不出错则会是异步的。Promise 甚至把 JavaScript 异常也变成了异步行为，进而极大降低了竞态条件出现的可能</p>\n<p>但是，如果 Promise 完成后在查看结果时（ then(..) 注册的回调中）出现了 JavaScript 异常错误会怎样呢？即使这些异常不会被丢弃，但你会发现，对它们的处理方式还是有点出乎意料，需要进行一些深入研究才能理解：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25351390447808120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = new Promise(function(resolve, reject) {\n  resolve(42);\n});\np.then(\n  function fulfilled(msg) {\n    foo.bar();\n    console.log(msg); // 永远不会到达这里 :(\n  },\n  function rejected(err) {\n    // 永远也不会到达这里 :(\n  }\n);`, `25351390447808120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 永远不会到达这里 :(</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 永远也不会到达这里 :(</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="是可信任的-promise-吗"><a href="#%E6%98%AF%E5%8F%AF%E4%BF%A1%E4%BB%BB%E7%9A%84-promise-%E5%90%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>是可信任的 Promise 吗</h3>\n<p>你肯定已经注意到 Promise 并没有完全摆脱回调。它们只是改变了传递回调的位置。我们并不是把回调传递给 foo(..) ，而是从 foo(..) 得到某个东西（外观上看是一个真正的 Promise），然后把回调传给这个东西。</p>\n<p>但是，为什么这就比单纯使用回调更值得信任呢？如何能够确定返回的这个东西实际上就是一个可信任的 Promise 呢？这难道不是一个（脆弱的）纸牌屋，在里面只能信任我们已经信任的？</p>\n<p>关于 Promise 的很重要但是常常被忽略的一个细节是，Promise 对这个问题已经有一个解决方案。包含在原生 ES6 Promise 实现中的解决方案就是 Promise.resolve(..) 。</p>\n<p>如果向 Promise.resolve(..) 传递一个非 Promise、非 thenable 的立即值，就会得到一个用这个值填充的 promise。下面这种情况下，promise p1 和 promise p2 的行为是完全一样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93744703946713970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p1 = new Promise(function(resolve, reject) {\n  resolve(42);\n});\nvar p2 = Promise.resolve(42);`, `93744703946713970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而如果向 Promise.resolve(..) 传递一个真正的 Promise，就只会返回同一个 promise：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93145558363175060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p1 = Promise.resolve(42);\nvar p2 = Promise.resolve(p1);\np1 === p2; // true`, `93145558363175060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>\np1 <span class="token operator">===</span> p2<span class="token punctuation">;</span> <span class="token comment">// true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>更重要的是，如果向 Promise.resolve(..) 传递了一个非 Promise 的 thenable 值，前者就会试图展开这个值，而且展开过程会持续到提取出一个具体的非类 Promise 的最终值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81938386811538780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = {\n  then: function(cb) {\n    cb(42);\n  }\n};\n// 这可以工作，但只是因为幸运而已\np.then(\n  function fulfilled(val) {\n    console.log(val); // 42\n  },\n  function rejected(err) {\n    // 永远不会到达这里\n  }\n);`, `81938386811538780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">then</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token comment">// 这可以工作，但只是因为幸运而已</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 永远不会到达这里</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个 p 是一个 thenable，但并不是一个真正的 Promise。幸运的是，和绝大多数值一样，它是可追踪的。但是，如果得到的是如下这样的值又会怎样呢：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93759847552081070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = {\n  then: function(cb, errcb) {\n    cb(42);\n    errcb(\'evil laugh\');\n  }\n};\np.then(\n  function fulfilled(val) {\n    console.log(val); // 42\n  },\n  function rejected(err) {\n    // 啊，不应该运行！\n    console.log(err); // 邪恶的笑\n  }\n);`, `93759847552081070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">then</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token punctuation">,</span> errcb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">errcb</span><span class="token punctuation">(</span><span class="token string">\'evil laugh\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 啊，不应该运行！</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 邪恶的笑</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个 p 是一个 thenable，但是其行为和 promise 并不完全一致。这是恶意的吗？还只是因为它不知道 Promise 应该如何运作？说实话，这并不重要。不管是哪种情况，它都是不可信任的。</p>\n<p>尽管如此，我们还是都可以把这些版本的 p 传给 Promise.resolve(..) ，然后就会得到期望中的规范化后的安全结果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66662708897331700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Promise.resolve(p).then(\n  function fulfilled(val) {\n    console.log(val); // 42\n  },\n  function rejected(err) {\n    // 永远不会到达这里\n  }\n);`, `66662708897331700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 永远不会到达这里</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Promise.resolve(..) 可以接受任何 thenable，将其解封为它的非 thenable 值。从 Promise.resolve(..) 得到的是一个真正的 Promise，是一个可以信任的值。如果你传入的已经是真正的 Promise，那么你得到的就是它本身，所以通过 Promise.resolve(..) 过滤来获得可信任性完全没有坏处。</p>\n<p>假设我们要调用一个工具 foo(..) ，且并不确定得到的返回值是否是一个可信任的行为良好的 Promise，但我们可以知道它至少是一个 thenable。 Promise.resolve(..) 提供了可信任的 Promise 封装工具，可以链接使用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68432878651900445000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 不要只是这么做：\nfoo(42).then(function(v) {\n  console.log(v);\n});\n// 而要这么做：\nPromise.resolve(foo(42)).then(function(v) {\n  console.log(v);\n});`, `68432878651900445000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 不要只是这么做：</span>\n<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 而要这么做：</span>\nPromise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于用 Promise.resolve(..) 为所有函数的返回值（不管是不是 thenable）都封装一层。另一个好处是，这样做很容易把函数调用规范为定义良好的异步任务。如果 foo(42) 有时会返回一个立即值，有时会返回 Promise，那么 Promise.resolve( foo(42) ) 就能够保证总会返回一个 Promise 结果，而且避免 Zalgo 就能得到更好的代码。</p>\n<h3 id="建立信任"><a href="#%E5%BB%BA%E7%AB%8B%E4%BF%A1%E4%BB%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>建立信任</h3>\n<p>可以用 JavaScript 编写异步代码而无需信任吗？当然可以。JavaScript 开发者近二十年来一直都只用回调编写异步代码。</p>\n<p>可一旦开始思考你在其上构建代码的机制具有何种程度的可预见性和可靠性时，你就会开始意识到回调的可信任基础是相当不牢靠。</p>\n<p>Promise 这种模式通过可信任的语义把回调作为参数传递，使得这种行为更可靠更合理。通过把回调的控制反转反转回来，我们把控制权放在了一个可信任的系统（Promise）中，这种系统的设计目的就是为了使异步编码更清晰。</p>\n<h2 id="链式流"><a href="#%E9%93%BE%E5%BC%8F%E6%B5%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>链式流</h2>\n<p>我们可以把多个 Promise 连接到一起以表示一系列异步步骤</p>\n<p>这种方式可以实现的关键在于以下两个 Promise 固有行为特性：</p>\n<ul>\n<li>每次你对 Promise 调用 then(..) ，它都会创建并返回一个新的 Promise，我们可以将其链接起来；</li>\n<li>不管从 then(..) 调用的完成回调（第一个参数）返回的值是什么，它都会被自动设置为被链接 Promise（第一点中的）的完成。</li>\n</ul>\n<p>考虑如下代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15686992752217010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = Promise.resolve(21);\nvar p2 = p.then(function(v) {\n  console.log(v); // 21\n  // 用值 42 填充 p2\n  return v * 2;\n});\n// 连接 p2\np2.then(function(v) {\n  console.log(v); // 42\n});`, `15686992752217010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> p2 <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 21</span>\n  <span class="token comment">// 用值 42 填充 p2</span>\n  <span class="token keyword">return</span> v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 连接 p2</span>\np2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们通过返回 v _ 2 ( 即 42 )，完成了第一个调用 then(..) 创建并返回的 promise p2 。 p2 的 then(..) 调用在运行时会从 return v _ 2 语句接受完成值。当然， p2.then(..) 又创建了另一个新的 promise，可以用变量 p3 存储</p>\n<p>但是，如果必须创建一个临时变量 p2 （或 p3 等），还是有一点麻烦的。谢天谢地，我们很容易把这些链接到一起：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49070598418197365000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = Promise.resolve(21);\np.then(function(v) {\n  console.log(v); // 21\n  // 用值 42 完成连接的 promise\n  return v * 2;\n})\n  // 这里是链接的 promise\n  .then(function(v) {\n    console.log(v); // 42\n  });`, `49070598418197365000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 21</span>\n  <span class="token comment">// 用值 42 完成连接的 promise</span>\n  <span class="token keyword">return</span> v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token comment">// 这里是链接的 promise</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在第一个 then(..) 就是异步序列中的第一步，第二个 then(..) 就是第二步。这可以一直任意扩展下去。只要保持把先前的 then(..) 连到自动创建的每一个 Promise 即可。</p>\n<p>如果需要步骤 2 等待步骤 1 异步来完成一些事情怎么办？我们使用了立即返回 return 语句，这会立即完成链接的 promise</p>\n<p>使 Promise 序列真正能够在每一步有异步能力的关键是，回忆一下当传递给 Promise.resolve(..) 的 是 一 个 Promise 或 thenable 而不是最终值时的运作方式。Promise.resolve(..) 会直接返回接收到的真正 Promise，或展开接收到的 thenable 值，并在持续展开 thenable 的同时递归地前进</p>\n<p>从完成（或拒绝）处理函数返回 thenable 或者 Promise 的时候也会发生同样的展开。考虑：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22741807926912380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = Promise.resolve(21);\np.then(function(v) {\n  console.log(v); // 21\n  // 创建一个 promise 并将其返回\n  return new Promise(function(resolve, reject) {\n    // 用值 42 填充\n    resolve(v * 2);\n  });\n}).then(function(v) {\n  console.log(v); // 42\n});`, `22741807926912380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 21</span>\n  <span class="token comment">// 创建一个 promise 并将其返回</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 用值 42 填充</span>\n    <span class="token function">resolve</span><span class="token punctuation">(</span>v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>虽然我们把 42 封装到了返回的 promise 中，但它仍然会被展开并最终成为链接的 promise 的决议，因此第二个 then(..) 得到的仍然是 42 。如果我们向封装的 promise 引入异步，一切都仍然会同样工作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83509099177595500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = Promise.resolve(21);\np.then(function(v) {\n  console.log(v); // 21\n  // 创建一个 promise 并返回\n  return new Promise(function(resolve, reject) {\n    // 引入异步！\n    setTimeout(function() {\n      // 用值 42 填充\n      resolve(v * 2);\n    }, 100);\n  });\n}).then(function(v) {\n  // 在前一步中的 100ms 延迟之后运行\n  console.log(v); // 42\n});`, `83509099177595500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 21</span>\n  <span class="token comment">// 创建一个 promise 并返回</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 引入异步！</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 用值 42 填充</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span>v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 在前一步中的 100ms 延迟之后运行</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种强大实在不可思议！现在我们可以构建这样一个序列：不管我们想要多少个异步步骤，每一步都能够根据需要等待下一步（或者不等！）。</p>\n<p>当然，在这些例子中，一步步传递的值是可选的。如果不显式返回一个值，就会隐式返回 undefined ，并且这些 promise 仍然会以同样的方式链接在一起。这样，每个 Promise 的决议就成了继续下一个步骤的信号。</p>\n<p>为了进一步阐释链接，让我们把延迟 Promise 创建（没有决议消息）过程一般化到一个工具中，以便在多个步骤中复用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15341965384186819000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function delay(time) {\n  return new Promise(function(resolve, reject) {\n    setTimeout(resolve, time);\n  });\n}\ndelay(100) // 步骤 1\n  .then(function STEP2() {\n    console.log(\'step 2 (after 100ms)\');\n    return delay(200);\n  })\n  .then(function STEP3() {\n    console.log(\'step 3 (after another 200ms)\');\n  })\n  .then(function STEP4() {\n    console.log(\'step 4 (next Job)\');\n    return delay(50);\n  })\n  .then(function STEP5() {\n    console.log(\'step 5 (after another 50ms)\');\n  });`, `15341965384186819000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// 步骤 1</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">STEP2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'step 2 (after 100ms)\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">STEP3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'step 3 (after another 200ms)\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">STEP4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'step 4 (next Job)\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">STEP5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'step 5 (after another 50ms)\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调用 delay(200) 创建了一个将在 200ms 后完成的 promise，然后我们从第一个 then(..) 完成回调中返回这个 promise，这会导致第二个 then(..) 的 promise 等待这个 200ms 的 promise。</p>\n<p>但说实话，没有消息传递的延迟序列对于 Promise 流程控制来说并不是一个很有用的示例。我们来考虑如下这样一个更实际的场景。</p>\n<p>这里不用定时器，而是构造 Ajax 请求：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74778477477409060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 假定工具 ajax( {url}, {callback} ) 存在\n// Promise-aware ajax\nfunction request(url) {\n  return new Promise(function(resolve, reject) {\n    // ajax(..) 回调应该是我们这个 promise 的 resolve(..) 函数\n    ajax(url, resolve);\n  });\n}`, `74778477477409060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 假定工具 ajax( {url}, {callback} ) 存在</span>\n<span class="token comment">// Promise-aware ajax</span>\n<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ajax(..) 回调应该是我们这个 promise 的 resolve(..) 函数</span>\n    <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们首先定义一个工具 request(..) ，用来构造一个表示 ajax(..) 调用完成的 promise：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78480229791438450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`request(\'http://some.url.1/\')\n  .then(function(response1) {\n    return request(\'http://some.url.2/?v=\' + response1);\n  })\n  .then(function(response2) {\n    console.log(response2);\n  });`, `78480229791438450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1/\'</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2/?v=\'</span> <span class="token operator">+</span> response1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>利用返回 Promise 的 request(..) ，我们通过使用第一个 URL 调用它来创建链接中的第一步，并且把返回的 promise 与第一个 then(..) 链接起来。</p>\n<p>我们构建的这个 Promise 链不仅是一个表达多步异步序列的流程控制，还是一个从一个步骤到下一个步骤传递消息的消息通道。</p>\n<p>如果这个 Promise 链中的某个步骤出错了怎么办？错误和异常是基于每个 Promise 的，这意味着可能在链的任意位置捕捉到这样的错误，而这个捕捉动作在某种程度上就相当于在这一位置将整条链“重置”回了正常运作</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28047290212041240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 步骤 1：\nrequest(\'http://some.url.1/\')\n  // 步骤 2：\n  .then(function(response1) {\n    foo.bar(); // undefined，出错！\n    // 永远不会到达这里\n    return request(\'http://some.url.2/?v=\' + response1);\n  })\n  // 步骤 3：\n  .then(\n    function fulfilled(response2) {\n      // 永远不会到达这里\n    },\n    // 捕捉错误的拒绝处理函数\n    function rejected(err) {\n      console.log(err);\n      // 来自 foo.bar() 的错误 TypeError\n      return 42;\n    }\n  )\n  // 步骤 4：\n  .then(function(msg) {\n    console.log(msg); // 42\n  });`, `28047290212041240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 步骤 1：</span>\n<span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1/\'</span><span class="token punctuation">)</span>\n  <span class="token comment">// 步骤 2：</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined，出错！</span>\n    <span class="token comment">// 永远不会到达这里</span>\n    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2/?v=\'</span> <span class="token operator">+</span> response1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token comment">// 步骤 3：</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n    <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">response2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 永远不会到达这里</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token comment">// 捕捉错误的拒绝处理函数</span>\n    <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 来自 foo.bar() 的错误 TypeError</span>\n      <span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">)</span>\n  <span class="token comment">// 步骤 4：</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>第 2 步出错后，第 3 步的拒绝处理函数会捕捉到这个错误。拒绝处理函数的返回值（这段代码中是 42 ），如果有的话，会用来完成交给下一个步骤（第 4 步）的 promise，这样，这个链现在就回到了完成状态。</p>\n<p>如果你调用 promise 的 then(..) ，并且只传入一个完成处理函数，一个默认拒绝处理函数就会顶替上来：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67200784668672970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = new Promise(function(resolve, reject) {\n  reject(\'Oops\');\n});\nvar p2 = p.then(\n  function fulfilled() {\n    // 永远不会达到这里\n  }\n  // 假定的拒绝处理函数，如果省略或者传入任何非函数值\n  // function(err) {\n  // throw err;\n  // }\n);`, `67200784668672970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">\'Oops\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> p2 <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 永远不会达到这里</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 假定的拒绝处理函数，如果省略或者传入任何非函数值</span>\n  <span class="token comment">// function(err) {</span>\n  <span class="token comment">// throw err;</span>\n  <span class="token comment">// }</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如你所见，默认拒绝处理函数只是把错误重新抛出，这最终会使得 p2 （链接的 promise）用同样的错误理由拒绝。从本质上说，这使得错误可以继续沿着 Promise 链传播下去，直到遇到显式定义的拒绝处理函数。</p>\n<p>如果没有给 then(..) 传递一个适当有效的函数作为完成处理函数参数，还是会有作为替代的一个默认处理函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46300137833696305000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p = Promise.resolve(42);\np.then(\n  // 假设的完成处理函数，如果省略或者传入任何非函数值\n  // function(v) {\n  // return v;\n  // }\n  null,\n  function rejected(err) {\n    // 永远不会到达这里\n  }\n);`, `46300137833696305000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token comment">// 假设的完成处理函数，如果省略或者传入任何非函数值</span>\n  <span class="token comment">// function(v) {</span>\n  <span class="token comment">// return v;</span>\n  <span class="token comment">// }</span>\n  <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 永远不会到达这里</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你可以看到，默认的完成处理函数只是把接收到的任何传入值传递给下一个步骤（Promise）而已。</p>\n<p>then(null,function(err){ .. }) 这个模式——只处理拒绝（如果有的话），但又把完成值传递下去——有一个缩写形式的 API：catch(function(err){ .. })。下一小节会详细介绍 catch(..)。</p>\n<p>让我们来简单总结一下使链式流程控制可行的 Promise 固有特性。</p>\n<ul>\n<li>调用 Promise 的 then(..) 会自动创建一个新的 Promise 从调用返回。</li>\n<li>在完成或拒绝处理函数内部，如果返回一个值或抛出一个异常，新返回的（可链接的）Promise 就相应地决议。</li>\n<li>如果完成或拒绝处理函数返回一个 Promise，它将会被展开，这样一来，不管它的决议值是什么，都会成为当前 then(..) 返回的链接 Promise 的决议值。</li>\n</ul>\n<p>尽管链式流程控制是有用的，但是对其最精确的看法是把它看作 Promise 组合到一起的一个附加益处，而不是主要目的。正如前面已经多次深入讨论的，Promise 规范化了异步，并封装了时间相关值的状态，使得我们能够把它们以这种有用的方式链接到一起。</p>\n<p>当然，相对于第 2 章讨论的回调的一团乱麻，链接的顺序表达（this-then-this-then-this…）已经是一个巨大的进步。但是，仍然有大量的重复样板代码（ then(..) 以及 function(){ … } ）。在第 4 章，我们将会看到在顺序流程控制表达方面提升巨大的优美模式，通过生成器实现。</p>\n<h3 id="术语：决议、完成以及拒绝"><a href="#%E6%9C%AF%E8%AF%AD%EF%BC%9A%E5%86%B3%E8%AE%AE%E3%80%81%E5%AE%8C%E6%88%90%E4%BB%A5%E5%8F%8A%E6%8B%92%E7%BB%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>术语：决议、完成以及拒绝</h3>\n<p>术语决议（resolve）、完成（fulfill）和拒绝（reject）</p>\n<p>构造器 Promise(..) 的第一个参数，特指完成这个 Promise，为什么不用使用 fulfill(..) 来代替 resolve(..) 以求表达更精确的原因：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89786503683260600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var rejectedTh = {\n  then: function(resolved, rejected) {\n    rejected(\'Oops\');\n  }\n};\nvar rejectedPr = Promise.resolve(rejectedTh);`, `89786503683260600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> rejectedTh <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">then</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolved<span class="token punctuation">,</span> rejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token string">\'Oops\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> rejectedPr <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>rejectedTh<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Promise.resolve(..) 会将传入的真正 Promise 直接返回，对传入的 thenable 则会展开，如果这个 thenable 展开得到一个拒绝状态，那么从 Promise.resolve(..) 返回的 Promise 实际上就是这同一个拒绝状态</p>\n<p>所以对这个 API 方法来说， Promise.resolve(..) 是一个精确的好名字，因为它实际上的结果可能是完成或拒绝</p>\n<p>Promise(..) 构造器的第一个参数回调会展开 thenable（和 Promise.resolve(..) 一样）或真正的 Promise：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43560207032171405000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var rejectedPr = new Promise(function(resolve, reject) {\n  // 用一个被拒绝的 promise 完成这个 promise, 注意 reject(..) 不会像 resolve(..) 一样进行展开\n  resolve(Promise.reject(\'Oops\'));\n});\nrejectedPr.then(\n  function fulfilled() {\n    // 永远不会到达这里\n  },\n  function rejected(err) {\n    console.log(err); // &quot;Oops&quot;\n  }\n);`, `43560207032171405000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2}"\n              >\n                <span class="gatsby-code-button-language">js{2}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> rejectedPr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">  <span class="token comment">// 用一个被拒绝的 promise 完成这个 promise, 注意 reject(..) 不会像 resolve(..) 一样进行展开</span></span>  <span class="token function">resolve</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">\'Oops\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nrejectedPr<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 永远不会到达这里</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Oops"</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>then 的回调建议是 fulfilled(..) 和 rejected(..)</p>\n<h2 id="promise-模式"><a href="#promise-%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 模式</h2>\n<p>前面使用了 Promise 链的顺序模式（this-then-this-then-that 流程控制），</p>\n<h3 id="promiseall--"><a href="#promiseall--" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise.all([ .. ])</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62163554792080335000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// request(..) 是一个 Promise-aware Ajax 工具\n// 就像我们在本章前面定义的一样\nvar p1 = request(\'http://some.url.1/\');\nvar p2 = request(\'http://some.url.2/\');\nPromise.all([p1, p2])\n  .then(function(msgs) {\n    // 这里，p1 和 p2 完成并把它们的消息传入\n    return request(\'http://some.url.3/?v=\' + msgs.join(\',\'));\n  })\n  .then(function(msg) {\n    console.log(msg);\n  });`, `62163554792080335000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// request(..) 是一个 Promise-aware Ajax 工具</span>\n<span class="token comment">// 就像我们在本章前面定义的一样</span>\n<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nPromise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 这里，p1 和 p2 完成并把它们的消息传入</span>\n    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.3/?v=\'</span> <span class="token operator">+</span> msgs<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>严格说来，传给 Promise.all([ .. ]) 的数组中的值可以是 Promise、thenable，甚至是立即值。就本质而言，列表中的每个值都会通过 Promise.resolve(..) 过滤，以确保要等待的是一个真正的 Promise，所以立即值会被规范化为为这个值构建的 Promise。如果数组是空的，主 Promise 就会立即完成</p>\n</blockquote>\n<h3 id="promiserace--"><a href="#promiserace--" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise.race([ .. ])</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87545684740467670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// request(..) 是一个支持 Promise 的 Ajax 工具\n// 就像我们在本章前面定义的一样\nvar p1 = request(\'http://some.url.1/\');\nvar p2 = request(\'http://some.url.2/\');\nPromise.race([p1, p2])\n  .then(function(msg) {\n    // p1 或者 p2 将赢得这场竞赛\n    return request(\'http://some.url.3/?v=\' + msg);\n  })\n  .then(function(msg) {\n    console.log(msg);\n  });`, `87545684740467670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// request(..) 是一个支持 Promise 的 Ajax 工具</span>\n<span class="token comment">// 就像我们在本章前面定义的一样</span>\n<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nPromise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// p1 或者 p2 将赢得这场竞赛</span>\n    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.3/?v=\'</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="超时竞赛"><a href="#%E8%B6%85%E6%97%B6%E7%AB%9E%E8%B5%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>超时竞赛</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53213849165033930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// foo() 是一个支持 Promise 的函数\n// 前面定义的 timeoutPromise(..) 返回一个 promise，\n// 这个 promise 会在指定延时之后拒绝\n// 为 foo() 设定超时\nPromise.race([\n  foo(), // 启动 foo()\n  timeoutPromise(3000) // 给它 3 秒钟\n]).then(\n  function() {\n    // foo(..) 按时完成！\n  },\n  function(err) {\n    // 要么 foo() 被拒绝，要么只是没能够按时完成，\n    // 因此要查看 err 了解具体原因\n  }\n);`, `53213849165033930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// foo() 是一个支持 Promise 的函数</span>\n<span class="token comment">// 前面定义的 timeoutPromise(..) 返回一个 promise，</span>\n<span class="token comment">// 这个 promise 会在指定延时之后拒绝</span>\n<span class="token comment">// 为 foo() 设定超时</span>\nPromise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 启动 foo()</span>\n  <span class="token function">timeoutPromise</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span> <span class="token comment">// 给它 3 秒钟</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// foo(..) 按时完成！</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 要么 foo() 被拒绝，要么只是没能够按时完成，</span>\n    <span class="token comment">// 因此要查看 err 了解具体原因</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="finally"><a href="#finally" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>finally</h4>\n<p>允许你执行任何必要的清理工作，我们可以构建一个静态辅助工具来支持查看（而不影响）Promise 的决议：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91878077342437540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// polyfill 安全的 guard 检查\nif (!Promise.observe) {\n  Promise.observe = function(pr, cb) {\n    // 观察 pr 的决议\n    pr.then(\n      function fulfilled(msg) {\n        // 安排异步回调（作为 Job）\n        Promise.resolve(msg).then(cb);\n      },\n      function rejected(err) {\n        // 安排异步回调（作为 Job）\n        Promise.resolve(err).then(cb);\n      }\n    );\n    // 返回最初的 promise\n    return pr;\n  };\n}`, `91878077342437540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// polyfill 安全的 guard 检查</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Promise<span class="token punctuation">.</span>observe<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  Promise<span class="token punctuation">.</span><span class="token function-variable function">observe</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">pr<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 观察 pr 的决议</span>\n    pr<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n      <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 安排异步回调（作为 Job）</span>\n        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 安排异步回调（作为 Job）</span>\n        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 返回最初的 promise</span>\n    <span class="token keyword">return</span> pr<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面是如何在前面的超时例子中使用这个工具：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8225396842624755000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Promise.race([\n  Promise.observe(\n    foo(), // 试着运行 foo()\n    function cleanup(msg) {\n      // 在 foo() 之后清理，即使它没有在超时之前完成\n    }\n  ),\n  timeoutPromise(3000) // 给它 3 秒钟\n]);`, `8225396842624755000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  Promise<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>\n    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 试着运行 foo()</span>\n    <span class="token keyword">function</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 在 foo() 之后清理，即使它没有在超时之前完成</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">timeoutPromise</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span> <span class="token comment">// 给它 3 秒钟</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="all---和-race---的变体"><a href="#all---%E5%92%8C-race---%E7%9A%84%E5%8F%98%E4%BD%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>all([ .. ]) 和 race([ .. ]) 的变体</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56393305641043255000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// polyfill 安全的 guard 检查\nif (!Promise.first) {\n  Promise.first = function(prs) {\n    return new Promise(function(resolve, reject) {\n      // 在所有 promise 上循环\n      prs.forEach(function(pr) {\n        // 把值规整化\n        Promise.resolve(pr)\n          // 不管哪个最先完成，就决议主 promise\n          .then(resolve);\n      });\n    });\n  };\n}`, `56393305641043255000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// polyfill 安全的 guard 检查</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Promise<span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  Promise<span class="token punctuation">.</span><span class="token function-variable function">first</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">prs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 在所有 promise 上循环</span>\n      prs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">pr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 把值规整化</span>\n        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>pr<span class="token punctuation">)</span>\n          <span class="token comment">// 不管哪个最先完成，就决议主 promise</span>\n          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="并发迭代"><a href="#%E5%B9%B6%E5%8F%91%E8%BF%AD%E4%BB%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>并发迭代</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8508819838336601000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (!Promise.map) {\n  Promise.map = function(vals, cb) {\n    // 一个等待所有 map 的 promise 的新 promise\n    return Promise.all(\n      // 注：一般数组 map(..) 把值数组转换为 promise 数组\n      vals.map(function(val) {\n        // 用 val 异步 map 之后决议的新 promise 替换 val\n        return new Promise(function(resolve) {\n          cb(val, resolve);\n        });\n      })\n    );\n  };\n}`, `8508819838336601000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Promise<span class="token punctuation">.</span>map<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  Promise<span class="token punctuation">.</span><span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">vals<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 一个等待所有 map 的 promise 的新 promise</span>\n    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>\n      <span class="token comment">// 注：一般数组 map(..) 把值数组转换为 promise 数组</span>\n      vals<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 用 val 异步 map 之后决议的新 promise 替换 val</span>\n        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">cb</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面展示如何在一组 Promise（而非简单的值）上使用 map(..)</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50163137583260890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var p1 = Promise.resolve(21);\nvar p2 = Promise.resolve(42);\nvar p3 = Promise.reject(\'Oops\');\n// 把列表中的值加倍，即使是在 Promise 中\nPromise.map([p1, p2, p3], function(pr, done) {\n  // 保证这一条本身是一个 Promise\n  Promise.resolve(pr).then(\n    // 提取值作为 v\n    function(v) {\n      // map 完成的 v 到新值\n      done(v * 2);\n    },\n    // 或者 map 到 promise 拒绝消息\n    done\n  );\n}).then(function(vals) {\n  console.log(vals); // [42,84,&quot;Oops&quot;]\n});`, `50163137583260890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">\'Oops\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 把列表中的值加倍，即使是在 Promise 中</span>\nPromise<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">pr<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 保证这一条本身是一个 Promise</span>\n  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>pr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n    <span class="token comment">// 提取值作为 v</span>\n    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// map 完成的 v 到新值</span>\n      <span class="token function">done</span><span class="token punctuation">(</span>v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token comment">// 或者 map 到 promise 拒绝消息</span>\n    done\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">vals</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [42,84,"Oops"]</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="promise-局限性"><a href="#promise-%E5%B1%80%E9%99%90%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 局限性</h2>\n<h3 id="顺序错误处理"><a href="#%E9%A1%BA%E5%BA%8F%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顺序错误处理</h3>\n<p>Promise 链中的错误很容易被无意中默默忽略掉</p>\n<h3 id="单一值"><a href="#%E5%8D%95%E4%B8%80%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>单一值</h3>\n<p>根据定义，Promise 只能有一个完成值或一个拒绝理由，有时是一种局限</p>\n<h4 id="分裂值"><a href="#%E5%88%86%E8%A3%82%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分裂值</h4>\n<p>有时候你可以把这一点当作提示你应该把问题分解为两个或更多 Promise 的信号</p>\n<p>设想你有一个工具 foo(..) ，它可以异步产生两个值（ x 和 y ）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34540701661256843000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function getY(x) {\n  return new Promise(function(resolve, reject) {\n    setTimeout(function() {\n      resolve(3 * x - 1);\n    }, 5000);\n  });\n}\nfunction foo(bar, baz) {\n  var x = bar * baz;\n  return getY(x).then(function(y) {\n    // 把两个值封装到容器中\n    return [x, y];\n  });\n}\nfoo(10, 20).then(function(msgs) {\n  var x = msgs[0];\n  var y = msgs[1];\n  console.log(x, y); // 200 599\n});`, `34540701661256843000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getY</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">bar<span class="token punctuation">,</span> baz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> x <span class="token operator">=</span> bar <span class="token operator">*</span> baz<span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token function">getY</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 把两个值封装到容器中</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> x <span class="token operator">=</span> msgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y <span class="token operator">=</span> msgs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200 599</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>重构之后：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66652404458094576000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo(bar, baz) {\n  var x = bar * baz;\n  // 返回两个 promise\n  return [Promise.resolve(x), getY(x)];\n}\nPromise.all(foo(10, 20)).then(function(msgs) {\n  var x = msgs[0];\n  var y = msgs[1];\n  console.log(x, y);\n});`, `66652404458094576000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">bar<span class="token punctuation">,</span> baz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> x <span class="token operator">=</span> bar <span class="token operator">*</span> baz<span class="token punctuation">;</span>\n  <span class="token comment">// 返回两个 promise</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getY</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\nPromise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> x <span class="token operator">=</span> msgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y <span class="token operator">=</span> msgs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一个 promise 数组真的要优于传递给单个 promise 的一个值数组吗？从语法的角度来说，这算不上是一个改进</p>\n<p>但是，这种方法更符合 Promise 的设计理念。如果以后需要重构代码把对 x 和 y 的计算分开，这种方法就简单得多。由调用代码来决定如何安排这两个 promise，而不是把这种细节放在 foo(..) 内部抽象，这样更整洁也更灵活。这里使用了 Promise.all([ .. ]) ，当然，这并不是唯一的选择。</p>\n<h4 id="展开--传递参数"><a href="#%E5%B1%95%E5%BC%80--%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>展开 / 传递参数</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47128568816703710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Promise.all(foo(10, 20)).then(function([x, y]) {\n  console.log(x, y); // 200 599\n});`, `47128568816703710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200 599</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="单决议"><a href="#%E5%8D%95%E5%86%B3%E8%AE%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>单决议</h3>\n<p>你可能要启动一系列异步步骤以响应某种可能多次发生的激励（就像是事件），比如按钮点击</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51867094013551895000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// click(..) 把&quot;click&quot;事件绑定到一个 DOM 元素\n// request(..) 是前面定义的支持 Promise 的 Ajax\nvar p = new Promise(function(resolve, reject) {\n  click(\'#mybtn\', resolve);\n});\np.then(function(evt) {\n  var btnID = evt.currentTarget.id;\n  return request(\'http://some.url.1/?id=\' + btnID);\n}).then(function(text) {\n  console.log(text);\n});`, `51867094013551895000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// click(..) 把"click"事件绑定到一个 DOM 元素</span>\n<span class="token comment">// request(..) 是前面定义的支持 Promise 的 Ajax</span>\n<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">click</span><span class="token punctuation">(</span><span class="token string">\'#mybtn\'</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\np<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> btnID <span class="token operator">=</span> evt<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1/?id=\'</span> <span class="token operator">+</span> btnID<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只有在你的应用只需要响应按钮点击一次的情况下，这种方式才能工作，只有为每个事件的发生创建一整个新的 Promise 链才能正常工作</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92909325556017320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`click(\'#mybtn\', function(evt) {\n  var btnID = evt.currentTarget.id;\n  request(\'http://some.url.1/?id=\' + btnID).then(function(text) {\n    console.log(text);\n  });\n});`, `92909325556017320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">\'#mybtn\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> btnID <span class="token operator">=</span> evt<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n  <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1/?id=\'</span> <span class="token operator">+</span> btnID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于需要在事件处理函数中定义整个 Promise 链，这很丑陋。除此之外，这个设计在某种程度上破坏了关注点与功能分离（SoC）的思想。这需要一些辅助机制来实现，其中 rxjs 做出了一些抽象</p>\n<h3 id="惯性（封装回调代码）"><a href="#%E6%83%AF%E6%80%A7%EF%BC%88%E5%B0%81%E8%A3%85%E5%9B%9E%E8%B0%83%E4%BB%A3%E7%A0%81%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>惯性（封装回调代码）</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67276285112819130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// polyfill 安全的 guard 检查\nif (!Promise.wrap) {\n  Promise.wrap = function(fn) {\n    return function() {\n      var args = [].slice.call(arguments);\n      return new Promise(function(resolve, reject) {\n        fn.apply(\n          null,\n          args.concat(function(err, v) {\n            if (err) {\n              reject(err);\n            } else {\n              resolve(v);\n            }\n          })\n        );\n      });\n    };\n  };\n}\n\nvar request = Promise.wrap(ajax);\nrequest(\'http://some.url.1/\').then();`, `67276285112819130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// polyfill 安全的 guard 检查</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Promise<span class="token punctuation">.</span>wrap<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  Promise<span class="token punctuation">.</span><span class="token function-variable function">wrap</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>\n          <span class="token keyword">null</span><span class="token punctuation">,</span>\n          args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">var</span> request <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>ajax<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1/\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54370329489955725000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 为 ajax(..) 构造一个 promisory\nvar request = Promise.wrap(ajax);\n// 重构 foo(..)，但使其外部成为基于外部回调的，\n// 与目前代码的其他部分保持通用\n// ——只在内部使用 request(..) 的 promise\nfunction foo(x, y, cb) {\n  request(\'http://some.url.1/?x=\' + x + \'&y=\' + y).then(function fulfilled(text) {\n    cb(null, text);\n  }, cb);\n}\n// 现在，为了这段代码的目的，为 foo(..) 构造一个 promisory\nvar betterFoo = Promise.wrap(foo);\n// 并使用这个 promisory\nbetterFoo(11, 31).then(\n  function fulfilled(text) {\n    console.log(text);\n  },\n  function rejected(err) {\n    console.error(err);\n  }\n);`, `54370329489955725000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 为 ajax(..) 构造一个 promisory</span>\n<span class="token keyword">var</span> request <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>ajax<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 重构 foo(..)，但使其外部成为基于外部回调的，</span>\n<span class="token comment">// 与目前代码的其他部分保持通用</span>\n<span class="token comment">// ——只在内部使用 request(..) 的 promise</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1/?x=\'</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">\'&amp;y=\'</span> <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 现在，为了这段代码的目的，为 foo(..) 构造一个 promisory</span>\n<span class="token keyword">var</span> betterFoo <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 并使用这个 promisory</span>\n<span class="token function">betterFoo</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token keyword">function</span> <span class="token function">fulfilled</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="无法取消的-promise"><a href="#%E6%97%A0%E6%B3%95%E5%8F%96%E6%B6%88%E7%9A%84-promise" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>无法取消的 Promise</h3>\n<p>一旦创建了一个 Promise 并为其注册了完成和 / 或拒绝处理函数，如果出现某种情况使得这个任务悬而未决的话，你也没有办法从外部停止它的进程。</p>\n<p>单独的一个 Promise 并不是一个真正的流程控制机制（至少不是很有意义），这正是取消所涉及的层次（流程控制）。这就是为什么 Promise 取消总是让人感觉很别扭。</p>\n<p>相比之下，集合在一起的 Promise 构成的链，我喜欢称之为一个“序列”，就是一个流程控制的表达，因此将取消定义在这个抽象层次上是合适的。</p>\n<h3 id="promise-性能"><a href="#promise-%E6%80%A7%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 性能</h3>\n<p>几乎所有那些你可能认为 Promise 性能会慢到需要担心的情况，实际上都是通过绕开 Promise 可信任性和可组合性优化掉了它们带来的好处的反模式</p>\n<h1 id="生成器"><a href="#%E7%94%9F%E6%88%90%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成器</h1>\n<h2 id="打破完整运行"><a href="#%E6%89%93%E7%A0%B4%E5%AE%8C%E6%95%B4%E8%BF%90%E8%A1%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>打破完整运行</h2>\n<p>一个函数一旦开始执行，就会运行到结束，期间不会有其他代码能够打断它并插入其间。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17252228493301015000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var x = 1;\nfunction* foo() {\n  x++;\n  yield; // 暂停！\n  console.log(\'x:\', x);\n}\nfunction bar() {\n  x++;\n}`, `17252228493301015000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  x<span class="token operator">++</span><span class="token punctuation">;</span>\n  <span class="token keyword">yield</span><span class="token punctuation">;</span> <span class="token comment">// 暂停！</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'x:\'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  x<span class="token operator">++</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77877434700112430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 构造一个迭代器 it 来控制这个生成器\nvar it = foo();\n// 这里启动 foo()，执行到 yield 处或生成器结束\nit.next();\nx; // 2\nbar();\nx; // 3\nit.next(); // x: 3，恢复执行`, `77877434700112430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 构造一个迭代器 it 来控制这个生成器</span>\n<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 这里启动 foo()，执行到 yield 处或生成器结束</span>\nit<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nx<span class="token punctuation">;</span> <span class="token comment">// 2</span>\n<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nx<span class="token punctuation">;</span> <span class="token comment">// 3</span>\nit<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x: 3，恢复执行</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="输入和输出"><a href="#%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>输入和输出</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84445407826628300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo(x, y) {\n  return x * y;\n}\nvar it = foo(6, 7);\nvar res = it.next();\nres.value; // 42`, `84445407826628300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> x <span class="token operator">*</span> y<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> res <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nres<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 42</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="迭代消息传递"><a href="#%E8%BF%AD%E4%BB%A3%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>迭代消息传递</h4>\n<p>除了能够接受参数并提供返回值之外，生成器甚至提供了更强大更引人注目的内建消息输入输出能力，通过 yield 和 next(..) 实现。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23279178792451604000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo(x) {\n  var y = x * (yield);\n  return y;\n}\nvar it = foo(6);\n// 启动 foo(..)\nit.next();\nvar res = it.next(7);\nres.value; // 42`, `23279178792451604000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> y <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> y<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 启动 foo(..)</span>\nit<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> res <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nres<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 42</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="两个问题的故事"><a href="#%E4%B8%A4%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9A%84%E6%95%85%E4%BA%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>两个问题的故事</h4>\n<p>只考虑生成器代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32404161395726905000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var y = x * yield;\nreturn y;`, `32404161395726905000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> y <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token keyword">yield</span><span class="token punctuation">;</span>\n<span class="token keyword">return</span> y<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>必须由第二个 next(..) 调用回答第一个 yield 提出的这个问题，第二个对第一个？</p>\n<p>消息是双向传递的，yield 作为一个表达式可以发出消息响应 next(..) 调用，next(..) 也可以向暂停的 yield 表达式发送值，考虑下面这段稍稍调整过的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83891210127404630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo(x) {\n  var y = x * (yield \'Hello\'); // <-- yield 一个值！\n  return y;\n}\nvar it = foo(6);\nvar res = it.next(); // 第一个 next()，并不传入任何东西\nres.value; // &quot;Hello&quot;\nres = it.next(7); // 向等待的 yield 传入 7\nres.value; // 42`, `83891210127404630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> y <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token string">\'Hello\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- yield 一个值！</span>\n  <span class="token keyword">return</span> y<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> res <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一个 next()，并不传入任何东西</span>\nres<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// "Hello"</span>\nres <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 向等待的 yield 传入 7</span>\nres<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 42</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>yield .. 和 next(..) 这一对组合起来，在生成器的执行过程中构成了一个双向消息传递系统。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65784250564556830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var res = it.next(); // 第一个 next()，并不传入任何东西\nres.value; // &quot;Hello&quot;\nres = it.next(7); // 向等待的 yield 传入 7\nres.value; // 42`, `65784250564556830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> res <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一个 next()，并不传入任何东西</span>\nres<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// "Hello"</span>\nres <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 向等待的 yield 传入 7</span>\nres<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 42</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="多个迭代器"><a href="#%E5%A4%9A%E4%B8%AA%E8%BF%AD%E4%BB%A3%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多个迭代器</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83401429828502420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo() {\n  var x = yield 2;\n  z++;\n  var y = yield x * z;\n  console.log(x, y, z);\n}\nvar z = 1;\nvar it1 = foo();\nvar it2 = foo();\nvar val1 = it1.next().value; // 2 <-- yield 2\nvar val2 = it2.next().value; // 2 <-- yield 2\nval1 = it1.next(val2 * 10).value; // 40 <-- x:20, z:2\nval2 = it2.next(val1 * 5).value; // 600 <-- x:200, z:3\nit1.next(val2 / 2); // y:300\n// 20 300 3\nit2.next(val1 / 4); // y:10\n// 200 10 3`, `83401429828502420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  z<span class="token operator">++</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token keyword">yield</span> x <span class="token operator">*</span> z<span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> it1 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> it2 <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> val1 <span class="token operator">=</span> it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 2 &lt;-- yield 2</span>\n<span class="token keyword">var</span> val2 <span class="token operator">=</span> it2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 2 &lt;-- yield 2</span>\nval1 <span class="token operator">=</span> it1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>val2 <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 40 &lt;-- x:20, z:2</span>\nval2 <span class="token operator">=</span> it2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>val1 <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 600 &lt;-- x:200, z:3</span>\nit1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>val2 <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// y:300</span>\n<span class="token comment">// 20 300 3</span>\nit2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>val1 <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// y:10</span>\n<span class="token comment">// 200 10 3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="生成器产生值"><a href="#%E7%94%9F%E6%88%90%E5%99%A8%E4%BA%A7%E7%94%9F%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成器产生值</h2>\n<h3 id="生成者与迭代器"><a href="#%E7%94%9F%E6%88%90%E8%80%85%E4%B8%8E%E8%BF%AD%E4%BB%A3%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成者与迭代器</h3>\n<p>假定你要产生一系列值，其中每个值都与前面一个有特定的关系。要实现这一点，需要一个有状态的生产者能够记住其生成的最后一个值。</p>\n<p>可以实现一个直接使用函数闭包的版本：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15073620880495065000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var gimmeSomething = (function() {\n  var nextVal;\n  return function() {\n    if (nextVal === undefined) {\n      nextVal = 1;\n    } else {\n      nextVal = 3 * nextVal + 6;\n    }\n    return nextVal;\n  };\n})();\ngimmeSomething(); // 1\ngimmeSomething(); // 9\ngimmeSomething(); // 33\ngimmeSomething(); // 105`, `15073620880495065000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> gimmeSomething <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> nextVal<span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextVal <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      nextVal <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      nextVal <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> nextVal <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> nextVal<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">gimmeSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>\n<span class="token function">gimmeSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9</span>\n<span class="token function">gimmeSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 33</span>\n<span class="token function">gimmeSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 105</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以为我们的数字序列生成器实现标准的迭代器接口：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57750281988848615000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var something = (function() {\n  var nextVal;\n  return {\n    // for..of 循环需要\n    [Symbol.iterator]: function() {\n      return this;\n    },\n    // 标准迭代器接口方法\n    next: function() {\n      if (nextVal === undefined) {\n        nextVal = 1;\n      } else {\n        nextVal = 3 * nextVal + 6;\n      }\n      return { done: false, value: nextVal };\n    }\n  };\n})();\nsomething.next().value; // 1\nsomething.next().value; // 9\nsomething.next().value; // 33\nsomething.next().value; // 105`, `57750281988848615000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> something <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> nextVal<span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    <span class="token comment">// for..of 循环需要</span>\n    <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token comment">// 标准迭代器接口方法</span>\n    <span class="token function-variable function">next</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>nextVal <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        nextVal <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        nextVal <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> nextVal <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> <span class="token punctuation">{</span> done<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> nextVal <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nsomething<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 1</span>\nsomething<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 9</span>\nsomething<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 33</span>\nsomething<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 105</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>或这样调用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76538044576274170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for (var v of something) {\n  console.log(v);\n  // 不要死循环！\n  if (v > 500) {\n    break;\n  }\n}\n// 1 9 33 105 321 969`, `76538044576274170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> something<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 不要死循环！</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">break</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 1 9 33 105 321 969</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2408977007325385700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for (var ret; (ret = something.next()) && !ret.done; ) {\n  console.log(ret.value);\n  // 不要死循环！\n  if (ret.value > 500) {\n    break; //这种手工 for 方法当然要比 ES6 的 for..of 循环语法丑陋，但其优点是，这样就可以在需要时向 next() 传递值。\n  }\n}\n// 1 9 33 105 321 969`, `2408977007325385700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ret<span class="token punctuation">;</span> <span class="token punctuation">(</span>ret <span class="token operator">=</span> something<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>ret<span class="token punctuation">.</span>done<span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 不要死循环！</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">.</span>value <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//这种手工 for 方法当然要比 ES6 的 for..of 循环语法丑陋，但其优点是，这样就可以在需要时向 next() 传递值。</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 1 9 33 105 321 969</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="生成器中的-promise-并发"><a href="#%E7%94%9F%E6%88%90%E5%99%A8%E4%B8%AD%E7%9A%84-promise-%E5%B9%B6%E5%8F%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成器中的 Promise 并发</h2>\n<p>你需要从两个不同的来源获取数据，然后把响应组合在一起以形成第三个请求，最终把最后一条响应打印出来。第 3 章已经用 Promise 研究过一个类似的场景，但是让我们在生成器的环境下重新考虑一下这个问题吧。</p>\n<p>第一次考虑代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39382992557798930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo() {\n  var r1 = yield request(\'http://some.url.1\');\n  var r2 = yield request(\'http://some.url.2\');\n  var r3 = yield request(\'http://some.url.3/?v=\' + r1 + \',\' + r2);\n  console.log(r3);\n}\n// 使用前面定义的工具 run(..)\nrun(foo);`, `39382992557798930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> r1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.3/?v=\'</span> <span class="token operator">+</span> r1 <span class="token operator">+</span> <span class="token string">\',\'</span> <span class="token operator">+</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 使用前面定义的工具 run(..)</span>\n<span class="token function">run</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最自然有效的答案就是让异步流程基于 Promise，特别是基于它们以时间无关的方式管理状态的能力。</p>\n<p>最简单的方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56801841218675480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo() {\n  // 让两个请求&quot;并行&quot;\n  var p1 = request(\'http://some.url.1\');\n  var p2 = request(\'http://some.url.2\');\n  // 等待两个 promise 都决议\n  var r1 = yield p1;\n  var r2 = yield p2;\n  var r3 = yield request(\'http://some.url.3/?v=\' + r1 + \',\' + r2);\n  console.log(r3);\n}\n// 使用前面定义的工具 run(..)\nrun(foo);`, `56801841218675480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 让两个请求"并行"</span>\n  <span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 等待两个 promise 都决议</span>\n  <span class="token keyword">var</span> r1 <span class="token operator">=</span> <span class="token keyword">yield</span> p1<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r2 <span class="token operator">=</span> <span class="token keyword">yield</span> p2<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.3/?v=\'</span> <span class="token operator">+</span> r1 <span class="token operator">+</span> <span class="token string">\',\'</span> <span class="token operator">+</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 使用前面定义的工具 run(..)</span>\n<span class="token function">run</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>两个 yield 语句等待并取得 promise 的决议（分别写入 r1 和 r2 ）。如果 p1 先决议，那么 yield p1 就会先恢复执行，然后等待 yield p2 恢复。如果 p2 先决议，它就会耐心保持其决议值等待请求，但是 yield p1 将会先等待，直到 p1 决议。</p>\n<p>等价于 Promise.all([ .. ]) 工具：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5551383818524180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo() {\n  // 让两个请求&quot;并行&quot;，并等待两个 promise 都决议\n  var results = yield Promise.all([request(\'http://some.url.1\'), request(\'http://some.url.2\')]);\n  var r1 = results[0];\n  var r2 = results[1];\n  var r3 = yield request(\'http://some.url.3/?v=\' + r1 + \',\' + r2);\n  console.log(r3);\n}\n// 使用前面定义的工具 run(..)\nrun(foo);`, `5551383818524180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 让两个请求"并行"，并等待两个 promise 都决议</span>\n  <span class="token keyword">var</span> results <span class="token operator">=</span> <span class="token keyword">yield</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r1 <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r2 <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.3/?v=\'</span> <span class="token operator">+</span> r1 <span class="token operator">+</span> <span class="token string">\',\'</span> <span class="token operator">+</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 使用前面定义的工具 run(..)</span>\n<span class="token function">run</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>更简洁的方案：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51784336284985090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 注：普通函数，不是生成器\nfunction bar(url1, url2) {\n  return Promise.all([request(url1), request(url2)]);\n}\nfunction* foo() {\n  // 隐藏 bar(..) 内部基于 Promise 的并发细节\n  var results = yield bar(\'http://some.url.1\', \'http://some.url.2\');\n  var r1 = results[0];\n  var r2 = results[1];\n  var r3 = yield request(\'http://some.url.3/?v=\' + r1 + \',\' + r2);\n  console.log(r3);\n}\n// 使用前面定义的工具 run(..)\nrun(foo);`, `51784336284985090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 注：普通函数，不是生成器</span>\n<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">url1<span class="token punctuation">,</span> url2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">request</span><span class="token punctuation">(</span>url1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">request</span><span class="token punctuation">(</span>url2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 隐藏 bar(..) 内部基于 Promise 的并发细节</span>\n  <span class="token keyword">var</span> results <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">,</span> <span class="token string">\'http://some.url.2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r1 <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r2 <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.3/?v=\'</span> <span class="token operator">+</span> r1 <span class="token operator">+</span> <span class="token string">\',\'</span> <span class="token operator">+</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 使用前面定义的工具 run(..)</span>\n<span class="token function">run</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果想要实现一系列高级流程控制的话，那么非常有用的做法是：把你的 Promise 逻辑隐藏在一个只从生成器代码中调用的函数内部。比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67204937104228810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function bar() {\n    Promise.all( [\n        baz( .. ).then( .. ),\n        Promise.race( [ .. ] )\n    ] ).then( .. )\n}`, `67204937104228810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span> <span class="token punctuation">[</span>\n        <span class="token function">baz</span><span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>\n    <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有时候会需要这种逻辑，而如果把它直接放在生成器内部的话，那你就失去了几乎所有一开始使用生成器的理由。应该有意将这样的细节从生成器代码中抽象出来，以避免它把高层次的任务表达变得杂乱。</p>\n<h2 id="生成器委托"><a href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%A7%94%E6%89%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成器委托</h2>\n<p>从一个生成器调用另一个生成器，使用辅助函数 run(..)，就像这样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82183577691584330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo() {\n  var r2 = yield request(\'http://some.url.2\');\n  var r3 = yield request(\'http://some.url.3/?v=\' + r2);\n  return r3;\n}\nfunction* bar() {\n  var r1 = yield request(\'http://some.url.1\');\n  // 通过 run(..) &quot;委托&quot;给*foo()\n  var r3 = yield run(foo);\n  console.log(r3);\n}\nrun(bar);`, `82183577691584330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> r2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.3/?v=\'</span> <span class="token operator">+</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> r3<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> r1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 通过 run(..) "委托"给*foo()</span>\n  <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">run</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">run</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们再次通过 run(..) 工具从 *bar() 内部运行 *foo() 。这里我们利用了如下事实：我们前面定义的 run(..) 返回一个 promise，这个 promise 在生成器运行结束时（或出错退出时）决议。因此，如果从一个 run(..) 调用中 yield 出来一个 promise 到另一个 run(..) 实例中，它会自动暂停 *bar() ，直到 *foo() 结束。</p>\n<p>其实还有一个更好的方法可以实现从 *bar() 调用 *foo() ，称为 yield 委托。 yield 委托的具体语法是： yield _ __（注意多出来的 _ ）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54079585188843260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo() {\n  var r2 = yield request(\'http://some.url.2\');\n  var r3 = yield request(\'http://some.url.3/?v=\' + r2);\n  return r3;\n}\nfunction* bar() {\n  var r1 = yield request(\'http://some.url.1\');\n  // 通过 yeild* &quot;委托&quot;给*foo()\n  var r3 = yield* foo();\n  console.log(r3);\n}\nrun(bar);`, `54079585188843260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> r2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.3/?v=\'</span> <span class="token operator">+</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> r3<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> r1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">\'http://some.url.1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 通过 yeild* "委托"给*foo()</span>\n  <span class="token keyword">var</span> r3 <span class="token operator">=</span> <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">run</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>yield * 暂停了迭代控制，而不是生成器控制。当你调用 <em>foo() 生成器时，现在 yield 委托到了它的迭代器。但实际上，你可以 yield 委托到任意 iterable ， yield `</em>[1,2,3]<code class="language-text">会消耗数组值</code>[1,2,3]` 的默认迭代器。</p>\n<h3 id="为什么用委托"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8%E5%A7%94%E6%89%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么用委托</h3>\n<p>yield 委托的主要目的是代码组织，以达到与普通函数调用的对称。</p>\n<h3 id="消息委托"><a href="#%E6%B6%88%E6%81%AF%E5%A7%94%E6%89%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息委托</h3>\n<p>yield 委托是如何不只用于迭代器控制工作，也用于双向消息传递工作。认真跟踪下面的通过 yield 委托实现的消息流出入：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44263555274585650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* foo() {\n  console.log(\'inside *foo():\', yield \'B\');\n  console.log(\'inside *foo():\', yield \'C\');\n  return \'D\';\n}\nfunction* bar() {\n  console.log(\'inside *bar():\', yield \'A\');\n  // yield 委托！\n  console.log(\'inside *bar():\', yield* foo());\n  console.log(\'inside *bar():\', yield \'E\');\n  return \'F\';\n}\nvar it = bar();\nconsole.log(\'outside:\', it.next().value);\n// outside: A\nconsole.log(\'outside:\', it.next(1).value);\n// inside *bar(): 1\n// outside: B\nconsole.log(\'outside:\', it.next(2).value);\n// inside *foo(): 2\n// outside: C\nconsole.log(\'outside:\', it.next(3).value);\n// inside *foo(): 3\n// inside *bar(): D\n// outside: E\nconsole.log(\'outside:\', it.next(4).value);\n// inside *bar(): 4\n// outside: F`, `44263555274585650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'inside *foo():\'</span><span class="token punctuation">,</span> <span class="token keyword">yield</span> <span class="token string">\'B\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'inside *foo():\'</span><span class="token punctuation">,</span> <span class="token keyword">yield</span> <span class="token string">\'C\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">\'D\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'inside *bar():\'</span><span class="token punctuation">,</span> <span class="token keyword">yield</span> <span class="token string">\'A\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// yield 委托！</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'inside *bar():\'</span><span class="token punctuation">,</span> <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'inside *bar():\'</span><span class="token punctuation">,</span> <span class="token keyword">yield</span> <span class="token string">\'E\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">\'F\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'outside:\'</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// outside: A</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'outside:\'</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// inside *bar(): 1</span>\n<span class="token comment">// outside: B</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'outside:\'</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// inside *foo(): 2</span>\n<span class="token comment">// outside: C</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'outside:\'</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// inside *foo(): 3</span>\n<span class="token comment">// inside *bar(): D</span>\n<span class="token comment">// outside: E</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'outside:\'</span><span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// inside *bar(): 4</span>\n<span class="token comment">// outside: F</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/你不知道的JS之异步和性能/index.md absPath of file >>> MarkdownRemark",timeToRead:33,frontmatter:{date:"2018-11-16 14:35:13",path:"/you-dont-know-js-asynchronism-and-performance/",tags:"前端, JS, 你不知道的JS, 读书笔记",title:"你不知道的 JS 之异步与性能",draft:null}},{excerpt:"前言 英文原版 README 翻译可能存在错误或不标准的地方，欢迎大家指正和修改，谢谢！ 什么是”飞行规则”? 一个  宇航员指南   (现在, 程序员们都在使用 GIT) 是关于出现问题过后应该怎么操作。 飞行规则 (Flight Rules)- 是记录在手册上的来之不易的一系列知识，记录了某个事情发生的原因，以及怎样一步一步的进行处理。本质上, 它们是特定场景的非常详细的标准处理流程。 自 20 世纪 60 年代初以来，NASA 一直在捕捉 (capturing…",html:'<h2 id="前言"><a href="#%E5%89%8D%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前言</h2>\n<ul>\n<li>英文原版<a href="https://github.com/k88hudson/git-flight-rules/blob/master/README.md" target="_blank" rel="nofollow noreferrer noopener">README</a></li>\n<li>翻译可能存在错误或不标准的地方，欢迎大家指正和修改，谢谢！</li>\n</ul>\n<h2 id="什么是飞行规则"><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%A3%9E%E8%A1%8C%E8%A7%84%E5%88%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>什么是”飞行规则”?</h2>\n<p>一个 <a href="http://www.jsc.nasa.gov/news/columbia/fr_generic.pdf" target="_blank" rel="nofollow noreferrer noopener">宇航员指南 </a> (现在, 程序员们都在使用 GIT) 是关于出现问题过后应该怎么操作。</p>\n<blockquote>\n<p>飞行规则 (Flight Rules)- 是记录在手册上的来之不易的一系列知识，记录了某个事情发生的原因，以及怎样一步一步的进行处理。本质上, 它们是特定场景的非常详细的标准处理流程。</p>\n</blockquote>\n<blockquote>\n<p>自 20 世纪 60 年代初以来，NASA 一直在捕捉 (capturing) 我们的失误，灾难和解决方案, 当时水星时代 (Mercury-era) 的地面小组首先开始将“经验教训”收集到一个纲要 (compendium) 中，该纲现在已经有上千个问题情景，从发动机故障到破损的舱口把手到计算机故障，以及它们对应的解决方案。</p>\n</blockquote>\n<h2 id="这篇文章的约定"><a href="#%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E7%9A%84%E7%BA%A6%E5%AE%9A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>这篇文章的约定</h2>\n<p>为了清楚的表述，这篇文档里的所有例子使用了自定义的 bash 提示，以便指示当前分支和是否有暂存的变化 (changes)。分支名用小括号括起来，分支名后面跟的<code class="language-text">-</code>表示暂存的变化 (changes)。</p>\n<h2 id="编辑提交-editting-commits"><a href="#%E7%BC%96%E8%BE%91%E6%8F%90%E4%BA%A4-editting-commits" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑提交 (editting commits)</h2>\n<h3 id="我刚才提交了什么"><a href="#%E6%88%91%E5%88%9A%E6%89%8D%E6%8F%90%E4%BA%A4%E4%BA%86%E4%BB%80%E4%B9%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我刚才提交了什么?</h3>\n<p>如果你用 <code class="language-text">git commit -a</code> 提交了一次变化 (changes)，而你又不确定到底这次提交了哪些内容。你就可以用下面的命令显示当前<code class="language-text">HEAD</code>上的最近一次的提交 (commit):</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9362804339097397000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git show`, `9362804339097397000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git show</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或者</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40050920801060900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git log -n1 -p`, `40050920801060900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git log<span class="token parameter"> -n1</span><span class="token parameter"> -p</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我的提交信息-commit-message-写错了"><a href="#%E6%88%91%E7%9A%84%E6%8F%90%E4%BA%A4%E4%BF%A1%E6%81%AF-commit-message-%E5%86%99%E9%94%99%E4%BA%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的提交信息 (commit message) 写错了</h3>\n<p>如果你的提交信息 (commit message) 写错了且这次提交 (commit) 还没有推 (push), 你可以通过下面的方法来修改提交信息 (commit message):</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89116150691328920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git commit --amend`, `89116150691328920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git commit<span class="token parameter"> --amend</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这会打开你的默认编辑器, 在这里你可以编辑信息。另一方面, 你也可以用一条命令一次完成：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46634995967224136000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git commit --amend -m \'xxxxxxx\'`, `46634995967224136000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git commit<span class="token parameter"> --amend</span><span class="token parameter"> -m</span> </span><span class="token string">\'xxxxxxx\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果你已经推 (push) 了这次提交 (commit), 你可以修改这次提交 (commit) 然后强推 (force push), 但是不推荐这么做。</p>\n<h3 id="我提交-commit-里的用户名和邮箱不对"><a href="#%E6%88%91%E6%8F%90%E4%BA%A4-commit-%E9%87%8C%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E9%82%AE%E7%AE%B1%E4%B8%8D%E5%AF%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我提交 (commit) 里的用户名和邮箱不对</h3>\n<p>如果这只是单个提交 (commit)，修改它：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19869680886317687000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git commit --amend --author &quot;New Authorname <authoremail@mydomain.com>&quot;`, `19869680886317687000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git commit<span class="token parameter"> --amend</span><span class="token parameter"> --author</span> </span><span class="token string">"New Authorname &lt;authoremail@mydomain.com>"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果你需要修改所有历史, 参考 ‘git filter-branch’ 的指南页.</p>\n<h3 id="我想从一个提交-commit-里移除一个文件"><a href="#%E6%88%91%E6%83%B3%E4%BB%8E%E4%B8%80%E4%B8%AA%E6%8F%90%E4%BA%A4-commit-%E9%87%8C%E7%A7%BB%E9%99%A4%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想从一个提交 (commit) 里移除一个文件</h3>\n<p>通过下面的方法，从一个提交 (commit) 里移除一个文件:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83178914742369080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git checkout HEAD^ myfile\n\\$ git add -A\n\\$ git commit --amend`, `83178914742369080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git checkout HEAD^ myfile</span>\n<span class="token command">$ git add<span class="token parameter"> -A</span></span>\n<span class="token command">$ git commit<span class="token parameter"> --amend</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这将非常有用，当你有一个开放的补丁 (open patch)，你往上面提交了一个不必要的文件，你需要强推 (force push) 去更新这个远程补丁。</p>\n<h3 id="我想删除我的最后一次提交-commit"><a href="#%E6%88%91%E6%83%B3%E5%88%A0%E9%99%A4%E6%88%91%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E6%AC%A1%E6%8F%90%E4%BA%A4-commit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想删除我的最后一次提交 (commit)</h3>\n<p>如果你需要删除推了的提交 (pushed commits)，你可以使用下面的方法。可是，这会不可逆的改变你的历史，也会搞乱那些已经从该仓库拉取 (pulled) 了的人的历史。简而言之，如果你不是很确定，千万不要这么做。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12716478233291317000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git reset HEAD^ --hard\n\\$ git push -f [remote] [branch]`, `12716478233291317000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git reset HEAD^<span class="token parameter"> --hard</span></span>\n<span class="token command">$ git push<span class="token parameter"> -f</span> [remote] [branch]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果你还没有推到远程, 把 Git 重置 (reset) 到你最后一次提交前的状态就可以了 (同时保存暂存的变化):</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81053644254929600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch-)\\$ git reset --soft HEAD@{1}`, `81053644254929600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">(</span>my<span class="token operator">-</span>branch<span class="token operator">-</span><span class="token punctuation">)</span>$ git reset <span class="token operator">--</span>soft <span class="token constant">HEAD</span>@<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这只能在没有推送之前有用。如果你已经推了, 唯一安全能做的是 <code class="language-text">git revert SHAofBadCommit</code>， 那会创建一个新的提交 (commit) 用于撤消前一个提交的所有变化 (changes)；或者, 如果你推的这个分支是 rebase-safe 的（例如：其它开发者不会从这个分支拉）, 只需要使用 <code class="language-text">git push -f</code> ；更多, 请参考 <a href="#deleteremove-last-pushed-commit">the above section</a>。</p>\n<h3 id="删除任意提交-commit"><a href="#%E5%88%A0%E9%99%A4%E4%BB%BB%E6%84%8F%E6%8F%90%E4%BA%A4-commit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除任意提交 (commit)</h3>\n<p>同样的警告：不到万不得已的时候不要这么做.</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46494164766574264000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git rebase --onto SHA1_OF_BAD_COMMIT^ SHA1_OF_BAD_COMMIT\n\\$ git push -f [remote] [branch]`, `46494164766574264000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git rebase<span class="token parameter"> --onto</span> SHA1_OF_BAD_COMMIT^ SHA1_OF_BAD_COMMIT</span>\n<span class="token command">$ git push<span class="token parameter"> -f</span> [remote] [branch]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>或者做一个 <a href="#interactive-rebase">交互式 rebase</a> 删除那些你想要删除的提交 (commit) 里所对应的行。</p>\n<h3 id="我尝试推一个修正后的提交-amended-commit-到远程，但是报错："><a href="#%E6%88%91%E5%B0%9D%E8%AF%95%E6%8E%A8%E4%B8%80%E4%B8%AA%E4%BF%AE%E6%AD%A3%E5%90%8E%E7%9A%84%E6%8F%90%E4%BA%A4-amended-commit-%E5%88%B0%E8%BF%9C%E7%A8%8B%EF%BC%8C%E4%BD%86%E6%98%AF%E6%8A%A5%E9%94%99%EF%BC%9A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我尝试推一个修正后的提交 (amended commit) 到远程，但是报错：</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17616585319593337000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`To https://github.com/yourusername/repo.git\n! [rejected]        mybranch -> mybranch (non-fast-forward)\nerror: failed to push some refs to \'https://github.com/tanay1337/webmaker.org.git\'\nhint: Updates were rejected because the tip of your current branch is behind\nhint: its remote counterpart. Integrate the remote changes (e.g.\nhint: \'git pull ...\') before pushing again.\nhint: See the \'Note about fast-forwards\' in \'git push --help\' for details.`, `17616585319593337000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git">To https://github.com/yourusername/repo.git\n! [rejected]        mybranch -> mybranch (non-fast-forward)\nerror: failed to push some refs to <span class="token string">\'https://github.com/tanay1337/webmaker.org.git\'</span>\nhint: Updates were rejected because the tip of your current branch is behind\nhint: its remote counterpart. Integrate the remote changes (e.g.\nhint: <span class="token string">\'git pull ...\'</span>) before pushing again.\nhint: See the <span class="token string">\'Note about fast-forwards\'</span> in <span class="token string">\'git push --help\'</span> for details.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意, rebasing(见下面) 和修正 (amending) 会用一个新的提交 (commit) 代替旧的，所以如果之前你已经往远程仓库上推过一次修正前的提交 (commit)，那你现在就必须强推 (force push) (<code class="language-text">-f</code>)。 注意：总是确保你指明一个分支!</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51948405071705480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git push origin mybranch -f`, `51948405071705480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git push origin mybranch<span class="token parameter"> -f</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>一般来说, 要避免强推。最好是创建和推 (push) 一个新的提交 (commit)，而不是强推一个修正后的提交。后者会使那些与该分支或该分支的子分支工作的开发者，在源历史中产生冲突。</p>\n<h3 id="我意外的做了一次硬重置-hard-reset，我想找回我的内容"><a href="#%E6%88%91%E6%84%8F%E5%A4%96%E7%9A%84%E5%81%9A%E4%BA%86%E4%B8%80%E6%AC%A1%E7%A1%AC%E9%87%8D%E7%BD%AE-hard-reset%EF%BC%8C%E6%88%91%E6%83%B3%E6%89%BE%E5%9B%9E%E6%88%91%E7%9A%84%E5%86%85%E5%AE%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我意外的做了一次硬重置 (hard reset)，我想找回我的内容</h3>\n<p>如果你意外的做了 <code class="language-text">git reset --hard</code>, 你通常能找回你的提交 (commit), 因为 Git 对每件事都会有日志，且都会保存几天。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75095300892936130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git reflog`, `75095300892936130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git reflog</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>你将会看到一个你过去提交 (commit) 的列表和一个重置的提交。选择你想要回到的提交 (commit) 的 SHA，再重置一次：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96701380576287700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git reset --hard SHA1234`, `96701380576287700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git reset<span class="token parameter"> --hard</span> SHA1234</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这样就完成了。</p>\n<h2 id="暂存-staging"><a href="#%E6%9A%82%E5%AD%98-staging" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>暂存 (Staging)</h2>\n<h3 id="我需要把暂存的内容添加到上一次的提交-commit"><a href="#%E6%88%91%E9%9C%80%E8%A6%81%E6%8A%8A%E6%9A%82%E5%AD%98%E7%9A%84%E5%86%85%E5%AE%B9%E6%B7%BB%E5%8A%A0%E5%88%B0%E4%B8%8A%E4%B8%80%E6%AC%A1%E7%9A%84%E6%8F%90%E4%BA%A4-commit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我需要把暂存的内容添加到上一次的提交 (commit)</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16184329012361198000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch-)\\$ git commit --amend`, `16184329012361198000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch-)$ git commit<span class="token parameter"> --amend</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我想要暂存一个新文件的一部分，而不是这个文件的全部"><a href="#%E6%88%91%E6%83%B3%E8%A6%81%E6%9A%82%E5%AD%98%E4%B8%80%E4%B8%AA%E6%96%B0%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E5%85%A8%E9%83%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想要暂存一个新文件的一部分，而不是这个文件的全部</h3>\n<p>一般来说, 如果你想暂存一个文件的一部分, 你可这样做:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15276650511852452000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git add --patch filename.x`, `15276650511852452000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git add<span class="token parameter"> --patch</span> filename.x</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><code class="language-text">-p</code> 简写。这会打开交互模式， 你将能够用 <code class="language-text">s</code> 选项来分隔提交 (commit)； 然而, 如果这个文件是新的, 会没有这个选择， 添加一个新文件时, 这样做:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66370374563495530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git add -N filename.x`, `66370374563495530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git add<span class="token parameter"> -N</span> filename.x</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后, 你需要用 <code class="language-text">e</code> 选项来手动选择需要添加的行，执行 <code class="language-text">git diff --cached</code> 将会显示哪些行暂存了哪些行只是保存在本地了。</p>\n<p><a href="stage-in-two-commits"></a></p>\n<h3 id="我想把在一个文件里的变化-changes-加到两个提交-commit-里"><a href="#%E6%88%91%E6%83%B3%E6%8A%8A%E5%9C%A8%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E9%87%8C%E7%9A%84%E5%8F%98%E5%8C%96-changes-%E5%8A%A0%E5%88%B0%E4%B8%A4%E4%B8%AA%E6%8F%90%E4%BA%A4-commit-%E9%87%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想把在一个文件里的变化 (changes) 加到两个提交 (commit) 里</h3>\n<p><code class="language-text">git add</code> 会把整个文件加入到一个提交。<code class="language-text">git add -p</code> 允许交互式的选择你想要提交的部分.</p>\n<h3 id="我想把暂存的内容变成未暂存，把未暂存的内容暂存起来"><a href="#%E6%88%91%E6%83%B3%E6%8A%8A%E6%9A%82%E5%AD%98%E7%9A%84%E5%86%85%E5%AE%B9%E5%8F%98%E6%88%90%E6%9C%AA%E6%9A%82%E5%AD%98%EF%BC%8C%E6%8A%8A%E6%9C%AA%E6%9A%82%E5%AD%98%E7%9A%84%E5%86%85%E5%AE%B9%E6%9A%82%E5%AD%98%E8%B5%B7%E6%9D%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想把暂存的内容变成未暂存，把未暂存的内容暂存起来</h3>\n<p>这个有点困难， 我能想到的最好的方法是先 stash 未暂存的内容， 然后重置 (reset)，再 pop 第一步 stashed 的内容, 最后再 add 它们。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28878059665029943000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git stash -k\n\\$ git reset --hard\n\\$ git stash pop\n\\$ git add -A`, `28878059665029943000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git stash<span class="token parameter"> -k</span></span>\n<span class="token command">$ git reset<span class="token parameter"> --hard</span></span>\n<span class="token command">$ git stash pop</span>\n<span class="token command">$ git add<span class="token parameter"> -A</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="未暂存-unstaged-的内容"><a href="#%E6%9C%AA%E6%9A%82%E5%AD%98-unstaged-%E7%9A%84%E5%86%85%E5%AE%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未暂存 (Unstaged) 的内容</h2>\n<h3 id="我想把未暂存的内容移动到一个新分支"><a href="#%E6%88%91%E6%83%B3%E6%8A%8A%E6%9C%AA%E6%9A%82%E5%AD%98%E7%9A%84%E5%86%85%E5%AE%B9%E7%A7%BB%E5%8A%A8%E5%88%B0%E4%B8%80%E4%B8%AA%E6%96%B0%E5%88%86%E6%94%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想把未暂存的内容移动到一个新分支</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60478186835395120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git checkout -b my-branch`, `60478186835395120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git checkout<span class="token parameter"> -b</span> my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我想把未暂存的内容移动到另一个已存在的分支"><a href="#%E6%88%91%E6%83%B3%E6%8A%8A%E6%9C%AA%E6%9A%82%E5%AD%98%E7%9A%84%E5%86%85%E5%AE%B9%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84%E5%88%86%E6%94%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想把未暂存的内容移动到另一个已存在的分支</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49705125005127780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git stash\n\\$ git checkout my-branch\n\\$ git stash pop`, `49705125005127780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git stash</span>\n<span class="token command">$ git checkout my-branch</span>\n<span class="token command">$ git stash pop</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="我想丢弃本地未提交的变化-uncommitted-changes"><a href="#%E6%88%91%E6%83%B3%E4%B8%A2%E5%BC%83%E6%9C%AC%E5%9C%B0%E6%9C%AA%E6%8F%90%E4%BA%A4%E7%9A%84%E5%8F%98%E5%8C%96-uncommitted-changes" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想丢弃本地未提交的变化 (uncommitted changes)</h3>\n<p>如果你只是想重置源 (origin) 和你本地 (local) 之间的一些提交 (commit)，你可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32362599187048645000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# one commit\n(my-branch)\\$ git reset --hard HEAD^\n# two commits\n(my-branch)\\$ git reset --hard HEAD^^\n# four commits\n(my-branch)\\$ git reset --hard HEAD~4\n# or\n(master)\\$ git checkout -f`, `32362599187048645000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token comment"># one commit</span>\n<span class="token command">(my-branch)$ git reset<span class="token parameter"> --hard</span> HEAD^</span>\n<span class="token comment"># two commits</span>\n<span class="token command">(my-branch)$ git reset<span class="token parameter"> --hard</span> HEAD^^</span>\n<span class="token comment"># four commits</span>\n<span class="token command">(my-branch)$ git reset<span class="token parameter"> --hard</span> HEAD~4</span>\n<span class="token comment"># or</span>\n<span class="token command">(master)$ git checkout<span class="token parameter"> -f</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>重置某个特殊的文件, 你可以用文件名做为参数:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45598897056478310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git reset filename`, `45598897056478310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git reset filename</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我想丢弃某些未暂存的内容"><a href="#%E6%88%91%E6%83%B3%E4%B8%A2%E5%BC%83%E6%9F%90%E4%BA%9B%E6%9C%AA%E6%9A%82%E5%AD%98%E7%9A%84%E5%86%85%E5%AE%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想丢弃某些未暂存的内容</h3>\n<p>如果你想丢弃工作拷贝中的一部分内容，而不是全部。</p>\n<p>签出 (checkout) 不需要的内容，保留需要的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77388910978502570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git checkout -p\n# Answer y to all of the snippets you want to drop`, `77388910978502570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git checkout<span class="token parameter"> -p</span></span>\n<span class="token comment"># Answer y to all of the snippets you want to drop</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>另外一个方法是使用 <code class="language-text">stash</code>， Stash 所有要保留下的内容, 重置工作拷贝, 重新应用保留的部分。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74962883336268960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git stash -p\n# Select all of the snippets you want to save\n\\$ git reset --hard\n\\$ git stash pop`, `74962883336268960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git stash<span class="token parameter"> -p</span></span>\n<span class="token comment"># Select all of the snippets you want to save</span>\n<span class="token command">$ git reset<span class="token parameter"> --hard</span></span>\n<span class="token command">$ git stash pop</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>或者, stash 你不需要的部分, 然后 stash drop。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73890598975851530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git stash -p\n# Select all of the snippets you don\'t want to save\n\\$ git stash drop`, `73890598975851530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git stash<span class="token parameter"> -p</span></span>\n<span class="token comment"># Select all of the snippets you don\'t want to save</span>\n<span class="token command">$ git stash drop</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h2 id="分支-branches"><a href="#%E5%88%86%E6%94%AF-branches" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分支 (Branches)</h2>\n<h3 id="我从错误的分支拉取了内容，或把内容拉取到了错误的分支"><a href="#%E6%88%91%E4%BB%8E%E9%94%99%E8%AF%AF%E7%9A%84%E5%88%86%E6%94%AF%E6%8B%89%E5%8F%96%E4%BA%86%E5%86%85%E5%AE%B9%EF%BC%8C%E6%88%96%E6%8A%8A%E5%86%85%E5%AE%B9%E6%8B%89%E5%8F%96%E5%88%B0%E4%BA%86%E9%94%99%E8%AF%AF%E7%9A%84%E5%88%86%E6%94%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我从错误的分支拉取了内容，或把内容拉取到了错误的分支</h3>\n<p>这是另外一种使用 <code class="language-text">git reflog</code> 情况，找到在这次错误拉 (pull) 之前 HEAD 的指向。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69389424335088700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git reflog\nab7555f HEAD@{0}: pull origin wrong-branch: Fast-forward\nc5bc55a HEAD@{1}: checkout: checkout message goes here`, `69389424335088700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git reflog</span>\nab7555f HEAD@{0}: pull origin wrong-branch: Fast-forward\nc5bc55a HEAD@{1}: checkout: checkout message goes here</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>重置分支到你所需的提交 (desired commit):</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40363736639058540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git reset --hard c5bc55a`, `40363736639058540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git reset<span class="token parameter"> --hard</span> c5bc55a</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>完成。</p>\n<h3 id="我想扔掉本地的提交-commit，以便我的分支与远程的保持一致"><a href="#%E6%88%91%E6%83%B3%E6%89%94%E6%8E%89%E6%9C%AC%E5%9C%B0%E7%9A%84%E6%8F%90%E4%BA%A4-commit%EF%BC%8C%E4%BB%A5%E4%BE%BF%E6%88%91%E7%9A%84%E5%88%86%E6%94%AF%E4%B8%8E%E8%BF%9C%E7%A8%8B%E7%9A%84%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想扔掉本地的提交 (commit)，以便我的分支与远程的保持一致</h3>\n<p>先确认你没有推 (push) 你的内容到远程。</p>\n<p><code class="language-text">git status</code> 会显示你领先 (ahead) 源 (origin) 多少个提交:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73394812860082274000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git status\n# On branch my-branch\n# Your branch is ahead of \'origin/my-branch\' by 2 commits.\n#   (use &quot;git push&quot; to publish your local commits)\n#`, `73394812860082274000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git status</span>\n<span class="token comment"># On branch my-branch</span>\n<span class="token comment"># Your branch is ahead of \'origin/my-branch\' by 2 commits.</span>\n<span class="token comment">#   (use "git push" to publish your local commits)</span>\n<span class="token comment">#</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一种方法是:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15570678641426606000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git reset --hard origin/my-branch`, `15570678641426606000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git reset<span class="token parameter"> --hard</span> origin/my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我需要提交到一个新分支，但错误的提交到了-master"><a href="#%E6%88%91%E9%9C%80%E8%A6%81%E6%8F%90%E4%BA%A4%E5%88%B0%E4%B8%80%E4%B8%AA%E6%96%B0%E5%88%86%E6%94%AF%EF%BC%8C%E4%BD%86%E9%94%99%E8%AF%AF%E7%9A%84%E6%8F%90%E4%BA%A4%E5%88%B0%E4%BA%86-master" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我需要提交到一个新分支，但错误的提交到了 master</h3>\n<p>在 master 下创建一个新分支，不切换到新分支,仍在 master 下:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73497919167799200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git branch my-branch`, `73497919167799200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git branch my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>把 master 分支重置到前一个提交:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21342389305790110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git reset --hard HEAD^`, `21342389305790110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git reset<span class="token parameter"> --hard</span> HEAD^</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><code class="language-text">HEAD^</code> 是 <code class="language-text">HEAD^1</code> 的简写，你可以通过指定要设置的<code class="language-text">HEAD</code>来进一步重置。</p>\n<p>或者, 如果你不想使用 <code class="language-text">HEAD^</code>, 找到你想重置到的提交 (commit) 的 hash(<code class="language-text">git log</code> 能够完成)， 然后重置到这个 hash。 使用<code class="language-text">git push</code> 同步内容到远程。</p>\n<p>例如, master 分支想重置到的提交的 hash 为<code class="language-text">a13b85e</code>:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21928360894020305000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git reset --hard a13b85e\nHEAD is now at a13b85e`, `21928360894020305000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git reset<span class="token parameter"> --hard</span> a13b85e</span>\nHEAD is now at a13b85e</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>签出 (checkout) 刚才新建的分支继续工作:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15175248781002715000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git checkout my-branch`, `15175248781002715000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git checkout my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我想保留来自另外一个-ref-ish-的整个文件"><a href="#%E6%88%91%E6%83%B3%E4%BF%9D%E7%95%99%E6%9D%A5%E8%87%AA%E5%8F%A6%E5%A4%96%E4%B8%80%E4%B8%AA-ref-ish-%E7%9A%84%E6%95%B4%E4%B8%AA%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想保留来自另外一个 ref-ish 的整个文件</h3>\n<p>假设你正在做一个原型方案 (原文为 working spike (see note)), 有成百的内容，每个都工作得很好。现在, 你提交到了一个分支，保存工作内容:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16673196461401018000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(solution)\\$ git add -A && git commit -m &quot;Adding all changes from this spike into one big commit.&quot;`, `16673196461401018000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(solution)$ git add<span class="token parameter"> -A</span> &amp;&amp; git commit<span class="token parameter"> -m</span> </span><span class="token string">"Adding all changes from this spike into one big commit."</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>当你想要把它放到一个分支里 (可能是<code class="language-text">feature</code>, 或者 <code class="language-text">develop</code>), 你关心是保持整个文件的完整，你想要一个大的提交分隔成比较小。</p>\n<p>假设你有:</p>\n<ul>\n<li>分支 <code class="language-text">solution</code>, 拥有原型方案， 领先 <code class="language-text">develop</code> 分支。</li>\n<li>分支 <code class="language-text">develop</code>, 在这里你应用原型方案的一些内容。</li>\n</ul>\n<p>我去可以通过把内容拿到你的分支里，来解决这个问题:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50874918361111200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(develop)\\$ git checkout solution -- file1.txt`, `50874918361111200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(develop)$ git checkout solution -- file1.txt</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这会把这个文件内容从分支 <code class="language-text">solution</code> 拿到分支 <code class="language-text">develop</code> 里来:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22708107391672373000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# On branch develop\n# Your branch is up-to-date with \'origin/develop\'.\n# Changes to be committed:\n#  (use &quot;git reset HEAD <file>...&quot; to unstage)\n#\n#        modified:   file1.txt`, `22708107391672373000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token comment"># On branch develop</span>\n<span class="token comment"># Your branch is up-to-date with \'origin/develop\'.</span>\n<span class="token comment"># Changes to be committed:</span>\n<span class="token comment">#  (use "git reset HEAD &lt;file>..." to unstage)</span>\n<span class="token comment">#</span>\n<span class="token comment">#        modified:   file1.txt</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后, 正常提交。</p>\n<p>Note: Spike solutions are made to analyze or solve the problem. These solutions are used for estimation and discarded once everyone gets clear visualization of the problem. ~ <a href="https://en.wikipedia.org/wiki/Extreme_programming_practices" target="_blank" rel="nofollow noreferrer noopener">Wikipedia</a>.</p>\n<h3 id="我把几个提交-commit-提交到了同一个分支，而这些提交应该分布在不同的分支里"><a href="#%E6%88%91%E6%8A%8A%E5%87%A0%E4%B8%AA%E6%8F%90%E4%BA%A4-commit-%E6%8F%90%E4%BA%A4%E5%88%B0%E4%BA%86%E5%90%8C%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF%EF%BC%8C%E8%80%8C%E8%BF%99%E4%BA%9B%E6%8F%90%E4%BA%A4%E5%BA%94%E8%AF%A5%E5%88%86%E5%B8%83%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E5%88%86%E6%94%AF%E9%87%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我把几个提交 (commit) 提交到了同一个分支，而这些提交应该分布在不同的分支里</h3>\n<p>假设你有一个<code class="language-text">master</code>分支， 执行<code class="language-text">git log</code>, 你看到你做过两次提交:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70974457151717620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git log\n\ncommit e3851e817c451cc36f2e6f3049db528415e3c114\nAuthor: Alex Lee <alexlee@example.com>\nDate:   Tue Jul 22 15:39:27 2014 -0400\n\n    Bug #21 - Added CSRF protection\n\ncommit 5ea51731d150f7ddc4a365437931cd8be3bf3131\nAuthor: Alex Lee <alexlee@example.com>\nDate:   Tue Jul 22 15:39:12 2014 -0400\n\n    Bug #14 - Fixed spacing on title\n\ncommit a13b85e984171c6e2a1729bb061994525f626d14\nAuthor: Aki Rose <akirose@example.com>\nDate:   Tue Jul 21 01:12:48 2014 -0400\n\n    First commit`, `70974457151717620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git log</span>\n\n<span class="token commit_sha1">commit e3851e817c451cc36f2e6f3049db528415e3c114</span>\nAuthor: Alex Lee &lt;alexlee@example.com>\nDate:   Tue Jul 22 15:39:27 2014 -0400\n\n    Bug #21 - Added CSRF protection\n\n<span class="token commit_sha1">commit 5ea51731d150f7ddc4a365437931cd8be3bf3131</span>\nAuthor: Alex Lee &lt;alexlee@example.com>\nDate:   Tue Jul 22 15:39:12 2014 -0400\n\n    Bug #14 - Fixed spacing on title\n\n<span class="token commit_sha1">commit a13b85e984171c6e2a1729bb061994525f626d14</span>\nAuthor: Aki Rose &lt;akirose@example.com>\nDate:   Tue Jul 21 01:12:48 2014 -0400\n\n    First commit</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>让我们用提交 hash(commit hash) 标记 bug (<code class="language-text">e3851e8</code> for #21, <code class="language-text">5ea5173</code> for #14).</p>\n<p>首先, 我们把<code class="language-text">master</code>分支重置到正确的提交 (<code class="language-text">a13b85e</code>):</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80298384069681280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git reset --hard a13b85e\nHEAD is now at a13b85e`, `80298384069681280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git reset<span class="token parameter"> --hard</span> a13b85e</span>\nHEAD is now at a13b85e</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>现在, 我们对 bug #21 创建一个新的分支:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55427426471505250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git checkout -b 21\n(21)\\$`, `55427426471505250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git checkout<span class="token parameter"> -b</span> 21</span>\n(21)$</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>接着, 我们用 -cherry-pick- 把对 bug #21 的提交放入当前分支。 这意味着我们将应用 (apply) 这个提交 (commit)，仅仅这一个提交 (commit)，直接在 HEAD 上面。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59150086924517790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(21)\\$ git cherry-pick e3851e8`, `59150086924517790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(21)$ git cherry-pick e3851e8</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这时候, 这里可能会产生冲突， 参见<a href="#interactive-rebase">交互式 rebasing 章 </a> <a href="#merge-conflict">—冲突节—</a> 解决冲突.</p>\n<p>再者， 我们为 bug #14 创建一个新的分支, 也基于<code class="language-text">master</code>分支</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98047936846966500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(21)\\$ git checkout master\n(master)\\$ git checkout -b 14\n(14)\\$`, `98047936846966500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(21)$ git checkout master</span>\n<span class="token command">(master)$ git checkout<span class="token parameter"> -b</span> 14</span>\n(14)$</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>最后, 为 bug #14 执行 <code class="language-text">cherry-pick</code>:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86256628826290060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(14)\\$ git cherry-pick 5ea5173`, `86256628826290060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(14)$ git cherry-pick 5ea5173</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我想删除上游-upstream-分支被删除了的本地分支"><a href="#%E6%88%91%E6%83%B3%E5%88%A0%E9%99%A4%E4%B8%8A%E6%B8%B8-upstream-%E5%88%86%E6%94%AF%E8%A2%AB%E5%88%A0%E9%99%A4%E4%BA%86%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想删除上游 (upstream) 分支被删除了的本地分支</h3>\n<p>一旦你在 github 上面合并 (merge) 了一个 pull request, 你就可以删除你 fork 里被合并的分支。 如果你不准备继续在这个分支里工作, 删除这个分支的本地拷贝会更干净，使你不会陷入工作分支和一堆陈旧分支的混乱之中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69731672769146760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git fetch -p`, `69731672769146760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git fetch<span class="token parameter"> -p</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我不小心删除了我的分支"><a href="#%E6%88%91%E4%B8%8D%E5%B0%8F%E5%BF%83%E5%88%A0%E9%99%A4%E4%BA%86%E6%88%91%E7%9A%84%E5%88%86%E6%94%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我不小心删除了我的分支</h3>\n<p>如果你定期推送到远程, 多数情况下应该是安全的，但有些时候还是可能删除了还没有推到远程的分支。 让我们先创建一个分支和一个新的文件:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55739966183863850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git checkout -b my-branch\n(my-branch)\\$ git branch\n(my-branch)\\$ touch foo.txt\n(my-branch)\\$ ls\nREADME.md foo.txt`, `55739966183863850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git checkout<span class="token parameter"> -b</span> my-branch</span>\n<span class="token command">(my-branch)$ git branch</span>\n(my-branch)$ touch foo.txt\n(my-branch)$ ls\nREADME.md foo.txt</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>添加文件并做一次提交</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="276385000987811040"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git add .\n(my-branch)\\$ git commit -m \'foo.txt added\'\n(my-branch)\\$ foo.txt added\n 1 files changed, 1 insertions(+)\n create mode 100644 foo.txt\n(my-branch)\\$ git log\n\ncommit 4e3cd85a670ced7cc17a2b5d8d3d809ac88d5012\nAuthor: siemiatj <siemiatj@example.com>\nDate:   Wed Jul 30 00:34:10 2014 +0200\n\n    foo.txt added\n\ncommit 69204cdf0acbab201619d95ad8295928e7f411d5\nAuthor: Kate Hudson <katehudson@example.com>\nDate:   Tue Jul 29 13:14:46 2014 -0400\n\n    Fixes #6: Force pushing after amending commits`, `276385000987811040`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git add .</span>\n<span class="token command">(my-branch)$ git commit<span class="token parameter"> -m</span> </span><span class="token string">\'foo.txt added\'</span>\n(my-branch)$ foo.txt added\n 1 files changed, 1 insertions(+)\n create mode 100644 foo.txt\n<span class="token command">(my-branch)$ git log</span>\n\n<span class="token commit_sha1">commit 4e3cd85a670ced7cc17a2b5d8d3d809ac88d5012</span>\nAuthor: siemiatj &lt;siemiatj@example.com>\nDate:   Wed Jul 30 00:34:10 2014 +0200\n\n    foo.txt added\n\n<span class="token commit_sha1">commit 69204cdf0acbab201619d95ad8295928e7f411d5</span>\nAuthor: Kate Hudson &lt;katehudson@example.com>\nDate:   Tue Jul 29 13:14:46 2014 -0400\n\n    Fixes #6: Force pushing after amending commits</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们切回到主 (master) 分支，‘不小心的’删除<code class="language-text">my-branch</code>分支</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84450299777923320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git checkout master\nSwitched to branch \'master\'\nYour branch is up-to-date with \'origin/master\'.\n(master)\\$ git branch -D my-branch\nDeleted branch my-branch (was 4e3cd85).\n(master)\\$ echo oh noes, deleted my branch!\noh noes, deleted my branch!`, `84450299777923320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git checkout master</span>\nSwitched to branch <span class="token string">\'master\'</span>\nYour branch is up-to-date with <span class="token string">\'origin/master\'</span>.\n<span class="token command">(master)$ git branch<span class="token parameter"> -D</span> my-branch</span>\nDeleted branch my-branch (was 4e3cd85).\n(master)$ echo oh noes, deleted my branch!\noh noes, deleted my branch!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这时候你应该想起了<code class="language-text">reflog</code>, 一个升级版的日志，它存储了仓库 (repo) 里面所有动作的历史。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88792503704278800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git reflog\n69204cd HEAD@{0}: checkout: moving from my-branch to master\n4e3cd85 HEAD@{1}: commit: foo.txt added\n69204cd HEAD@{2}: checkout: moving from master to my-branch`, `88792503704278800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">(</span>master<span class="token punctuation">)</span>$ git reflog\n<span class="token number">69204</span>cd <span class="token constant">HEAD</span>@<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">:</span> checkout<span class="token punctuation">:</span> moving <span class="token keyword">from</span> my<span class="token operator">-</span>branch to master\n<span class="token number">4e3</span>cd85 <span class="token constant">HEAD</span>@<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">:</span> commit<span class="token punctuation">:</span> foo<span class="token punctuation">.</span>txt added\n<span class="token number">69204</span>cd <span class="token constant">HEAD</span>@<span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">:</span> checkout<span class="token punctuation">:</span> moving <span class="token keyword">from</span> master to my<span class="token operator">-</span>branch</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>正如你所见，我们有一个来自删除分支的提交 hash(commit hash)，接下来看看是否能恢复删除了的分支。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49427003282965080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git checkout -b my-branch-help\nSwitched to a new branch \'my-branch-help\'\n(my-branch-help)\\$ git reset --hard 4e3cd85\nHEAD is now at 4e3cd85 foo.txt added\n(my-branch-help)\\$ ls\nREADME.md foo.txt`, `49427003282965080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git checkout<span class="token parameter"> -b</span> my-branch-help</span>\nSwitched to a new branch <span class="token string">\'my-branch-help\'</span>\n<span class="token command">(my-branch-help)$ git reset<span class="token parameter"> --hard</span> 4e3cd85</span>\nHEAD is now at 4e3cd85 foo.txt added\n(my-branch-help)$ ls\nREADME.md foo.txt</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看! 我们把删除的文件找回来了。 Git 的 <code class="language-text">reflog</code> 在 rebasing 出错的时候也是同样有用的。</p>\n<h3 id="我想删除一个分支"><a href="#%E6%88%91%E6%83%B3%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想删除一个分支</h3>\n<p>删除一个远程分支:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92095836172163320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git push origin --delete my-branch`, `92095836172163320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git push origin<span class="token parameter"> --delete</span> my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>你也可以:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89990430975466440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git push origin :my-branch`, `89990430975466440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git push origin :my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>删除一个本地分支:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55753497124151410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git branch -D my-branch`, `55753497124151410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git branch<span class="token parameter"> -D</span> my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我想从别人正在工作的远程分支签出-checkout-一个分支"><a href="#%E6%88%91%E6%83%B3%E4%BB%8E%E5%88%AB%E4%BA%BA%E6%AD%A3%E5%9C%A8%E5%B7%A5%E4%BD%9C%E7%9A%84%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF%E7%AD%BE%E5%87%BA-checkout-%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想从别人正在工作的远程分支签出 (checkout) 一个分支</h3>\n<p>首先, 从远程拉取 (fetch) 所有分支:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94012848974901530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git fetch --all`, `94012848974901530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git fetch<span class="token parameter"> --all</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>假设你想要从远程的<code class="language-text">daves</code>分支签出到本地的<code class="language-text">daves</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99435894222271020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git checkout --track origin/daves\nBranch daves set up to track remote branch daves from origin.\nSwitched to a new branch \'daves\'`, `99435894222271020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git checkout<span class="token parameter"> --track</span> origin/daves</span>\nBranch daves set up to track remote branch daves from origin.\nSwitched to a new branch <span class="token string">\'daves\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>(<code class="language-text">--track</code> 是 <code class="language-text">git checkout -b [branch] [remotename]/[branch]</code> 的简写)</p>\n<p>这样就得到了一个<code class="language-text">daves</code>分支的本地拷贝, 任何推过 (pushed) 的更新，远程都能看到.</p>\n<h2 id="rebasing-和合并-merging"><a href="#rebasing-%E5%92%8C%E5%90%88%E5%B9%B6-merging" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rebasing 和合并 (Merging)</h2>\n<h3 id="我想撤销-rebasemerge"><a href="#%E6%88%91%E6%83%B3%E6%92%A4%E9%94%80-rebasemerge" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想撤销 rebase/merge</h3>\n<p>你可以合并 (merge) 或 rebase 了一个错误的分支, 或者完成不了一个进行中的 rebase/merge。 Git 在进行危险操作的时候会把原始的 HEAD 保存在一个叫 ORIG_HEAD 的变量里, 所以要把分支恢复到 rebase/merge 前的状态是很容易的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39360209126294700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git reset --hard ORIG_HEAD`, `39360209126294700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git reset<span class="token parameter"> --hard</span> ORIG_HEAD</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="我已经-rebase-过-但是我不想强推-force-push"><a href="#%E6%88%91%E5%B7%B2%E7%BB%8F-rebase-%E8%BF%87-%E4%BD%86%E6%98%AF%E6%88%91%E4%B8%8D%E6%83%B3%E5%BC%BA%E6%8E%A8-force-push" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我已经 rebase 过, 但是我不想强推 (force push)</h3>\n<p>不幸的是，如果你想把这些变化 (changes) 反应到远程分支上，你就必须得强推 (force push)。 是因你快进 (Fast forward) 了提交，改变了 Git 历史, 远程分支不会接受变化 (changes)，除非强推 (force push)。这就是许多人使用 merge 工作流, 而不是 rebasing 工作流的主要原因之一， 开发者的强推 (force push) 会使大的团队陷入麻烦。使用时需要注意，一种安全使用 rebase 的方法是，不要把你的变化 (changes) 反映到远程分支上, 而是按下面的做:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20241516304414708000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git checkout my-branch\n(my-branch)\\$ git rebase -i master\n(my-branch)\\$ git checkout master\n(master)\\$ git merge --ff-only my-branch`, `20241516304414708000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git checkout my-branch</span>\n<span class="token command">(my-branch)$ git rebase<span class="token parameter"> -i</span> master</span>\n<span class="token command">(my-branch)$ git checkout master</span>\n<span class="token command">(master)$ git merge<span class="token parameter"> --ff</span>-only my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>更多, 参见 <a href="http://stackoverflow.com/questions/11058312/how-can-i-use-git-rebase-without-requiring-a-forced-push" target="_blank" rel="nofollow noreferrer noopener">this SO thread</a>.</p>\n<h3 id="我需要组合-combine-几个提交-commit"><a href="#%E6%88%91%E9%9C%80%E8%A6%81%E7%BB%84%E5%90%88-combine-%E5%87%A0%E4%B8%AA%E6%8F%90%E4%BA%A4-commit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我需要组合 (combine) 几个提交 (commit)</h3>\n<p>假设你的工作分支将会做对于 <code class="language-text">master</code> 的 pull-request。 一般情况下你不关心提交 (commit) 的时间戳，只想组合 -所有- 提交 (commit) 到一个单独的里面, 然后重置 (reset) 重提交 (recommit)。 确保主 (master) 分支是最新的和你的变化都已经提交了, 然后:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6639722144018179000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git reset --soft master\n(my-branch)\\$ git commit -am &quot;New awesome feature&quot;`, `6639722144018179000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git reset<span class="token parameter"> --soft</span> master</span>\n<span class="token command">(my-branch)$ git commit<span class="token parameter"> -am</span> </span><span class="token string">"New awesome feature"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果你想要更多的控制, 想要保留时间戳, 你需要做交互式 rebase (interactive rebase):</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36916857650576570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git rebase -i master`, `36916857650576570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git rebase<span class="token parameter"> -i</span> master</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果没有相对的其它分支， 你将不得不相对自己的<code class="language-text">HEAD</code> 进行 rebase。 例如：你想组合最近的两次提交 (commit), 你将相对于<code class="language-text">HEAD~2</code> 进行 rebase， 组合最近 3 次提交 (commit), 相对于<code class="language-text">HEAD~3</code>, 等等。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92383427964071400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git rebase -i HEAD~2`, `92383427964071400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git rebase<span class="token parameter"> -i</span> HEAD~2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在你执行了交互式 rebase 的命令 (interactive rebase command) 后, 你将在你的编辑器里看到类似下面的内容:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45708405662618420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pick a9c8a1d Some refactoring\npick 01b2fd8 New awesome feature\npick b729ad5 fixup\npick e3851e8 another fix\n\n# Rebase 8074d12..b729ad5 onto 8074d12\n#\n# Commands:\n#  p, pick = use commit\n#  r, reword = use commit, but edit the commit message\n#  e, edit = use commit, but stop for amending\n#  s, squash = use commit, but meld into previous commit\n#  f, fixup = like &quot;squash&quot;, but discard this commit\'s log message\n#  x, exec = run command (the rest of the line) using shell\n#\n# These lines can be re-ordered; they are executed from top to bottom.\n#\n# If you remove a line here THAT COMMIT WILL BE LOST.\n#\n# However, if you remove everything, the rebase will be aborted.\n#\n# Note that empty commits are commented out`, `45708405662618420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="vim"\n              >\n                <span class="gatsby-code-button-language">vim</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="vim"><pre style="counter-reset: linenumber NaN" class="language-vim line-numbers"><code class="language-vim">pick a9c8a1d Some refactoring\npick 01b2fd8 New awesome feature\npick b729ad5 fixup\npick e3851e8 another <span class="token keyword">fix</span>\n\n# Rebase 8074d12<span class="token operator">.</span><span class="token operator">.</span>b729ad5 onto 8074d12\n#\n# Commands<span class="token punctuation">:</span>\n#  <span class="token keyword">p</span><span class="token punctuation">,</span> pick <span class="token operator">=</span> use commit\n#  <span class="token keyword">r</span><span class="token punctuation">,</span> reword <span class="token operator">=</span> use commit<span class="token punctuation">,</span> but <span class="token keyword">edit</span> the commit message\n#  <span class="token keyword">e</span><span class="token punctuation">,</span> <span class="token keyword">edit</span> <span class="token operator">=</span> use commit<span class="token punctuation">,</span> but <span class="token keyword">stop</span> <span class="token keyword">for</span> amending\n#  s<span class="token punctuation">,</span> squash <span class="token operator">=</span> use commit<span class="token punctuation">,</span> but meld into <span class="token keyword">previous</span> commit\n#  <span class="token keyword">f</span><span class="token punctuation">,</span> fixup <span class="token operator">=</span> like <span class="token string">"squash"</span><span class="token punctuation">,</span> but discard this commit\'s log message\n#  <span class="token keyword">x</span><span class="token punctuation">,</span> exec <span class="token operator">=</span> run command <span class="token punctuation">(</span>the rest of the line<span class="token punctuation">)</span> using <span class="token keyword">shell</span>\n#\n# These <span class="token builtin">lines</span> can <span class="token keyword">be</span> re<span class="token operator">-</span>ordered<span class="token punctuation">;</span> they are executed from <span class="token builtin">top</span> <span class="token keyword">to</span> bottom<span class="token operator">.</span>\n#\n# If you remove a line here THAT COMMIT WILL BE LOST<span class="token operator">.</span>\n#\n# However<span class="token punctuation">,</span> <span class="token keyword">if</span> you remove everything<span class="token punctuation">,</span> the rebase will <span class="token keyword">be</span> aborted<span class="token operator">.</span>\n#\n# Note that empty commits are commented out</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所有以 <code class="language-text">#</code> 开头的行都是注释, 不会影响 rebase.</p>\n<p>然后，你可以用任何上面命令列表的命令替换 <code class="language-text">pick</code>, 你也可以通过删除对应的行来删除一个提交 (commit)。</p>\n<p>例如, 如果你想 —单独保留最旧 (first) 的提交 (commit),组合所有剩下的到第二个里面—, 你就应该编辑第二个提交 (commit) 后面的每个提交 (commit) 前的单词为 <code class="language-text">f</code>:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38550676623661605000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pick a9c8a1d Some refactoring\npick 01b2fd8 New awesome feature\nf b729ad5 fixup\nf e3851e8 another fix`, `38550676623661605000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="vim"\n              >\n                <span class="gatsby-code-button-language">vim</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="vim"><pre style="counter-reset: linenumber NaN" class="language-vim line-numbers"><code class="language-vim">pick a9c8a1d Some refactoring\npick 01b2fd8 New awesome feature\n<span class="token keyword">f</span> b729ad5 fixup\n<span class="token keyword">f</span> e3851e8 another <span class="token keyword">fix</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果你想组合这些提交 (commit) —并重命名这个提交 (commit)—, 你应该在第二个提交 (commit) 旁边添加一个<code class="language-text">r</code>，或者更简单的用<code class="language-text">s</code> 替代 <code class="language-text">f</code>:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1900277788934579000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pick a9c8a1d Some refactoring\npick 01b2fd8 New awesome feature\ns b729ad5 fixup\ns e3851e8 another fix`, `1900277788934579000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="vim"\n              >\n                <span class="gatsby-code-button-language">vim</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="vim"><pre style="counter-reset: linenumber NaN" class="language-vim line-numbers"><code class="language-vim">pick a9c8a1d Some refactoring\npick 01b2fd8 New awesome feature\ns b729ad5 fixup\ns e3851e8 another <span class="token keyword">fix</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你可以在接下来弹出的文本提示框里重命名提交 (commit)。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18924129623297614000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Newer, awesomer features\n\n# Please enter the commit message for your changes. Lines starting\n# with \'#\' will be ignored, and an empty message aborts the commit.\n# rebase in progress; onto 8074d12\n# You are currently editing a commit while rebasing branch \'master\' on \'8074d12\'.\n#\n# Changes to be committed:\n# modified:   README.md\n#`, `18924129623297614000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="vim"\n              >\n                <span class="gatsby-code-button-language">vim</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="vim"><pre style="counter-reset: linenumber NaN" class="language-vim line-numbers"><code class="language-vim">Newer<span class="token punctuation">,</span> awesomer features\n\n# Please enter the commit message <span class="token keyword">for</span> your <span class="token keyword">changes</span><span class="token operator">.</span> Lines starting\n# with <span class="token string">\'#\'</span> will <span class="token keyword">be</span> ignored<span class="token punctuation">,</span> and an empty message aborts the commit<span class="token operator">.</span>\n# rebase <span class="token keyword">in</span> progress<span class="token punctuation">;</span> onto 8074d12\n# You are currently editing a commit <span class="token keyword">while</span> rebasing branch <span class="token string">\'master\'</span> <span class="token keyword">on</span> <span class="token string">\'8074d12\'</span><span class="token operator">.</span>\n#\n# Changes <span class="token keyword">to</span> <span class="token keyword">be</span> committed<span class="token punctuation">:</span>\n# <span class="token builtin">modified</span><span class="token punctuation">:</span>   README<span class="token operator">.</span>md\n#</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果成功了, 你应该看到类似下面的内容:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88698146492345350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ Successfully rebased and updated refs/heads/master.`, `88698146492345350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git">(master)$ Successfully rebased and updated refs/heads/master.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h4 id="安全合并-merging-策略"><a href="#%E5%AE%89%E5%85%A8%E5%90%88%E5%B9%B6-merging-%E7%AD%96%E7%95%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安全合并 (merging) 策略</h4>\n<p><code class="language-text">--no-commit</code> 执行合并 (merge) 但不自动提交, 给用户在做提交前检查和修改的机会。 <code class="language-text">no-ff</code> 会为特性分支 (feature branch) 的存在过留下证据, 保持项目历史一致。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84610105810936730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git merge --no-ff --no-commit my-branch`, `84610105810936730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git merge<span class="token parameter"> --no</span>-ff<span class="token parameter"> --no</span>-commit my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h4 id="我需要将一个分支合并成一个提交-commit"><a href="#%E6%88%91%E9%9C%80%E8%A6%81%E5%B0%86%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E6%88%90%E4%B8%80%E4%B8%AA%E6%8F%90%E4%BA%A4-commit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我需要将一个分支合并成一个提交 (commit)</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42973966561632620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git merge --squash my-branch`, `42973966561632620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git merge<span class="token parameter"> --squash</span> my-branch</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h4 id="我只想组合-combine-未推的提交-unpushed-commit"><a href="#%E6%88%91%E5%8F%AA%E6%83%B3%E7%BB%84%E5%90%88-combine-%E6%9C%AA%E6%8E%A8%E7%9A%84%E6%8F%90%E4%BA%A4-unpushed-commit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我只想组合 (combine) 未推的提交 (unpushed commit)</h4>\n<p>有时候，在将数据推向上游之前，你有几个正在进行的工作提交 (commit)。这时候不希望把已经推 (push) 过的组合进来，因为其他人可能已经有提交 (commit) 引用它们了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55565190868178620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git rebase -i @{u}`, `55565190868178620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git rebase<span class="token parameter"> -i</span> @{u}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这会产生一次交互式的 rebase(interactive rebase), 只会列出没有推 (push) 的提交 (commit)， 在这个列表时进行 reorder/fix/squash 都是安全的。</p>\n<h3 id="检查是否分支上的所有提交-commit-都合并-merge-过了"><a href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%88%86%E6%94%AF%E4%B8%8A%E7%9A%84%E6%89%80%E6%9C%89%E6%8F%90%E4%BA%A4-commit-%E9%83%BD%E5%90%88%E5%B9%B6-merge-%E8%BF%87%E4%BA%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检查是否分支上的所有提交 (commit) 都合并 (merge) 过了</h3>\n<p>检查一个分支上的所有提交 (commit) 是否都已经合并 (merge) 到了其它分支, 你应该在这些分支的 head(或任何 commits) 之间做一次 diff:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53143792954990520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git log --graph --left-right --cherry-pick --oneline HEAD...feature/120-on-scroll`, `53143792954990520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git log<span class="token parameter"> --graph</span><span class="token parameter"> --left</span>-right<span class="token parameter"> --cherry</span>-pick<span class="token parameter"> --oneline</span> HEAD...feature/120-on-scroll</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这会告诉你在一个分支里有而另一个分支没有的所有提交 (commit), 和分支之间不共享的提交 (commit) 的列表。 另一个做法可以是:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61258204023586920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git log master ^feature/120-on-scroll --no-merges`, `61258204023586920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git log master ^feature/120-on-scroll<span class="token parameter"> --no</span>-merges</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="交互式-rebaseinteractive-rebase-可能出现的问题"><a href="#%E4%BA%A4%E4%BA%92%E5%BC%8F-rebaseinteractive-rebase-%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>交互式 rebase(interactive rebase) 可能出现的问题</h3>\n<h4 id="这个-rebase-编辑屏幕出现-noop"><a href="#%E8%BF%99%E4%B8%AA-rebase-%E7%BC%96%E8%BE%91%E5%B1%8F%E5%B9%95%E5%87%BA%E7%8E%B0-noop" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>这个 rebase 编辑屏幕出现 ‘noop’</h4>\n<p>如果你看到的是这样:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47516852816337990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`noop;`, `47516852816337990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">noop<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这意味着你 rebase 的分支和当前分支在同一个提交 (commit) 上, 或者 -领先 (ahead)- 当前分支。 你可以尝试:</p>\n<ul>\n<li>检查确保主 (master) 分支没有问题</li>\n<li>rebase <code class="language-text">HEAD~2</code> 或者更早</li>\n</ul>\n<h4 id="有冲突的情况"><a href="#%E6%9C%89%E5%86%B2%E7%AA%81%E7%9A%84%E6%83%85%E5%86%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>有冲突的情况</h4>\n<p>如果你不能成功的完成 rebase, 你可能必须要解决冲突。</p>\n<p>首先执行 <code class="language-text">git status</code> 找出哪些文件有冲突:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52422693674222100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git status\nOn branch my-branch\nChanges not staged for commit:\n  (use &quot;git add <file>...&quot; to update what will be committed)\n  (use &quot;git checkout -- <file>...&quot; to discard changes in working directory)\n\n modified:   README.md`, `52422693674222100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git status</span>\nOn branch my-branch\nChanges not staged for commit:\n  (use <span class="token string">"git add &lt;file>..."</span> to update what will be committed)\n  (use <span class="token string">"git checkout -- &lt;file>..."</span> to discard changes in working directory)\n\n modified:   README.md</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这个例子里面, <code class="language-text">README.md</code> 有冲突。 打开这个文件找到类似下面的内容:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39325789714664320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`   <<<<<<< HEAD\n   some code\n   =========\n   some code\n   >>>>>>> new-commit`, `39325789714664320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="vim"\n              >\n                <span class="gatsby-code-button-language">vim</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="vim"><pre style="counter-reset: linenumber NaN" class="language-vim line-numbers"><code class="language-vim">   <span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span> HEAD\n   some code\n   <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>\n   some code\n   <span class="token operator">></span><span class="token operator">></span><span class="token operator">></span><span class="token operator">></span><span class="token operator">></span><span class="token operator">></span><span class="token operator">></span> <span class="token keyword">new</span><span class="token operator">-</span>commit</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你需要解决新提交的代码 (示例里, 从中间<code class="language-text">==</code>线到<code class="language-text">new-commit</code>的地方) 与<code class="language-text">HEAD</code> 之间不一样的地方.</p>\n<p>有时候这些合并非常复杂，你应该使用可视化的差异编辑器 (visual diff editor):</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78382073882684700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master-)\\$ git mergetool -t opendiff`, `78382073882684700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master-)$ git mergetool<span class="token parameter"> -t</span> opendiff</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在你解决完所有冲突和测试过后, <code class="language-text">git add</code> 变化了的 (changed) 文件, 然后用<code class="language-text">git rebase --continue</code> 继续 rebase。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48310912968019410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git add README.md\n(my-branch)\\$ git rebase --continue`, `48310912968019410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git add README.md</span>\n<span class="token command">(my-branch)$ git rebase<span class="token parameter"> --continue</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果在解决完所有的冲突过后，得到了与提交前一样的结果, 可以执行<code class="language-text">git rebase --skip</code>。</p>\n<p>任何时候你想结束整个 rebase 过程，回来 rebase 前的分支状态, 你可以做:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99105890978253000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(my-branch)\\$ git rebase --abort`, `99105890978253000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(my-branch)$ git rebase<span class="token parameter"> --abort</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="杂项-miscellaneous-objects"><a href="#%E6%9D%82%E9%A1%B9-miscellaneous-objects" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>杂项 (Miscellaneous Objects)</h2>\n<h3 id="克隆所有子模块"><a href="#%E5%85%8B%E9%9A%86%E6%89%80%E6%9C%89%E5%AD%90%E6%A8%A1%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>克隆所有子模块</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12180392947133911000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git clone --recursive git://github.com/foo/bar.git`, `12180392947133911000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git clone<span class="token parameter"> --recursive</span> git://github.com/foo/bar.git</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果已经克隆了:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96937083199134140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git submodule update --init --recursive`, `96937083199134140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git submodule update<span class="token parameter"> --init</span><span class="token parameter"> --recursive</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="删除标签-tag"><a href="#%E5%88%A0%E9%99%A4%E6%A0%87%E7%AD%BE-tag" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除标签 (tag)</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85266364176211740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git tag -d <tag_name>\n\\$ git push <remote> :refs/tags/<tag_name>`, `85266364176211740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git tag<span class="token parameter"> -d</span> &lt;tag_name></span>\n<span class="token command">$ git push &lt;remote> :refs/tags/&lt;tag_name></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="恢复已删除标签-tag"><a href="#%E6%81%A2%E5%A4%8D%E5%B7%B2%E5%88%A0%E9%99%A4%E6%A0%87%E7%AD%BE-tag" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>恢复已删除标签 (tag)</h3>\n<p>如果你想恢复一个已删除标签 (tag), 可以按照下面的步骤: 首先, 需要找到无法访问的标签 (unreachable tag):</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86818314023260060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git fsck --unreachable | grep tag`, `86818314023260060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git fsck<span class="token parameter"> --unreachable</span> | grep tag</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>记下这个标签 (tag) 的 hash，然后用 Git 的 <a href="http://git-scm.com/docs/git-update-ref" target="_blank" rel="nofollow noreferrer noopener">update-ref</a>:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77900266313607770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git update-ref refs/tags/<tag_name> <hash>`, `77900266313607770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git update-ref refs/tags/&lt;tag_name> &lt;hash></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这时你的标签 (tag) 应该已经恢复了。</p>\n<h3 id="已删除补丁-patch"><a href="#%E5%B7%B2%E5%88%A0%E9%99%A4%E8%A1%A5%E4%B8%81-patch" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>已删除补丁 (patch)</h3>\n<p>如果某人在 GitHub 上给你发了一个 pull request, 但是然后他删除了他自己的原始 fork, 你将没法克隆他们的提交 (commit) 或使用 <code class="language-text">git am</code>。在这种情况下, 最好手动的查看他们的提交 (commit)，并把它们拷贝到一个本地新分支，然后做提交。</p>\n<p>做完提交后, 再修改作者，参见<a href="#commit-wrong-author">变更作者 </a>。 然后, 应用变化, 再发起一个新的 pull request。</p>\n<h2 id="跟踪文件-tracking-files"><a href="#%E8%B7%9F%E8%B8%AA%E6%96%87%E4%BB%B6-tracking-files" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跟踪文件 (Tracking Files)</h2>\n<h3 id="我只想改变一个文件名字的大小写，而不修改内容"><a href="#%E6%88%91%E5%8F%AA%E6%83%B3%E6%94%B9%E5%8F%98%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E5%90%8D%E5%AD%97%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%86%99%EF%BC%8C%E8%80%8C%E4%B8%8D%E4%BF%AE%E6%94%B9%E5%86%85%E5%AE%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我只想改变一个文件名字的大小写，而不修改内容</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50944407233012834000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git mv --force myfile MyFile`, `50944407233012834000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git mv<span class="token parameter"> --force</span> myfile MyFile</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><a href="remove-from-git"></a></p>\n<h3 id="我想从-git-删除一个文件，但保留该文件"><a href="#%E6%88%91%E6%83%B3%E4%BB%8E-git-%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%EF%BC%8C%E4%BD%86%E4%BF%9D%E7%95%99%E8%AF%A5%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想从 Git 删除一个文件，但保留该文件</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13806204797799105000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git rm --cached log.txt`, `13806204797799105000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git rm<span class="token parameter"> --cached</span> log.txt</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="配置-configuration"><a href="#%E9%85%8D%E7%BD%AE-configuration" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置 (Configuration)</h2>\n<h3 id="我想给一些-git-命令添加别名-alias"><a href="#%E6%88%91%E6%83%B3%E7%BB%99%E4%B8%80%E4%BA%9B-git-%E5%91%BD%E4%BB%A4%E6%B7%BB%E5%8A%A0%E5%88%AB%E5%90%8D-alias" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想给一些 Git 命令添加别名 (alias)</h3>\n<p>在 OS X 和 Linux 下, 你的 Git 的配置文件储存在 <code class="language-text">~/.gitconfig</code>。我在<code class="language-text">[alias]</code> 部分添加了一些快捷别名 (和一些我容易拼写错误的)，如下:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23558597362534320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[alias]\n    a = add\n    amend = commit --amend\n    c = commit\n    ca = commit --amend\n    ci = commit -a\n    co = checkout\n    d = diff\n    dc = diff --changed\n    ds = diff --staged\n    f = fetch\n    loll = log --graph --decorate --pretty=oneline --abbrev-commit\n    m = merge\n    one = log --pretty=oneline\n    outstanding = rebase -i @{u}\n    s = status\n    unpushed = log @{u}\n    wc = whatchanged\n    wip = rebase -i @{u}\n    zap = fetch -p`, `23558597362534320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="vim"\n              >\n                <span class="gatsby-code-button-language">vim</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="vim"><pre style="counter-reset: linenumber NaN" class="language-vim line-numbers"><code class="language-vim"><span class="token punctuation">[</span>alias<span class="token punctuation">]</span>\n    a <span class="token operator">=</span> add\n    amend <span class="token operator">=</span> commit <span class="token operator">-</span><span class="token operator">-</span>amend\n    <span class="token keyword">c</span> <span class="token operator">=</span> commit\n    <span class="token keyword">ca</span> <span class="token operator">=</span> commit <span class="token operator">-</span><span class="token operator">-</span>amend\n    <span class="token builtin">ci</span> <span class="token operator">=</span> commit <span class="token operator">-</span>a\n    <span class="token keyword">co</span> <span class="token operator">=</span> checkout\n    <span class="token keyword">d</span> <span class="token operator">=</span> <span class="token builtin">diff</span>\n    dc <span class="token operator">=</span> <span class="token builtin">diff</span> <span class="token operator">-</span><span class="token operator">-</span>changed\n    <span class="token keyword">ds</span> <span class="token operator">=</span> <span class="token builtin">diff</span> <span class="token operator">-</span><span class="token operator">-</span>staged\n    <span class="token keyword">f</span> <span class="token operator">=</span> fetch\n    loll <span class="token operator">=</span> log <span class="token operator">-</span><span class="token operator">-</span>graph <span class="token operator">-</span><span class="token operator">-</span>decorate <span class="token operator">-</span><span class="token operator">-</span>pretty<span class="token operator">=</span>oneline <span class="token operator">-</span><span class="token operator">-</span>abbrev<span class="token operator">-</span>commit\n    <span class="token keyword">m</span> <span class="token operator">=</span> merge\n    one <span class="token operator">=</span> log <span class="token operator">-</span><span class="token operator">-</span>pretty<span class="token operator">=</span>oneline\n    outstanding <span class="token operator">=</span> rebase <span class="token operator">-</span>i @<span class="token punctuation">{</span><span class="token keyword">u</span><span class="token punctuation">}</span>\n    s <span class="token operator">=</span> status\n    unpushed <span class="token operator">=</span> log @<span class="token punctuation">{</span><span class="token keyword">u</span><span class="token punctuation">}</span>\n    <span class="token builtin">wc</span> <span class="token operator">=</span> whatchanged\n    wip <span class="token operator">=</span> rebase <span class="token operator">-</span>i @<span class="token punctuation">{</span><span class="token keyword">u</span><span class="token punctuation">}</span>\n    zap <span class="token operator">=</span> fetch <span class="token operator">-</span><span class="token keyword">p</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我想缓存一个仓库-repository-的用户名和密码"><a href="#%E6%88%91%E6%83%B3%E7%BC%93%E5%AD%98%E4%B8%80%E4%B8%AA%E4%BB%93%E5%BA%93-repository-%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我想缓存一个仓库 (repository) 的用户名和密码</h3>\n<p>你可能有一个仓库需要授权，这时你可以缓存用户名和密码，而不用每次推/拉 (push/pull) 的时候都输入，Credential helper 能帮你。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83531472033549270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git config --global credential.helper cache\n# Set git to use the credential memory cache`, `83531472033549270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git config<span class="token parameter"> --global</span> credential.helper cache</span>\n<span class="token comment"># Set git to use the credential memory cache</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89050216175159740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git config --global credential.helper \'cache --timeout=3600\'\n# Set the cache to timeout after 1 hour (setting is in seconds)`, `89050216175159740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git config<span class="token parameter"> --global</span> credential.helper </span><span class="token string">\'cache --timeout=3600\'</span>\n<span class="token comment"># Set the cache to timeout after 1 hour (setting is in seconds)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p><a href="#ive-no-idea-what-i-did-wrong"></a></p>\n<h2 id="我不知道我做错了些什么"><a href="#%E6%88%91%E4%B8%8D%E7%9F%A5%E9%81%93%E6%88%91%E5%81%9A%E9%94%99%E4%BA%86%E4%BA%9B%E4%BB%80%E4%B9%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我不知道我做错了些什么</h2>\n<p>你把事情搞砸了：你 <code class="language-text">重置 (reset)</code> 了一些东西, 或者你合并了错误的分支, 亦或你强推了后找不到你自己的提交 (commit) 了。有些时候, 你一直都做得很好, 但你想回到以前的某个状态。</p>\n<p>这就是 <code class="language-text">git reflog</code> 的目的， <code class="language-text">reflog</code> 记录对分支顶端 (the tip of a branch) 的任何改变, 即使那个顶端没有被任何分支或标签引用。基本上, 每次 HEAD 的改变, 一条新的记录就会增加到<code class="language-text">reflog</code>。遗憾的是，这只对本地分支起作用，且它只跟踪动作 (例如，不会跟踪一个没有被记录的文件的任何改变)。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28796300483705516000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(master)\\$ git reflog\n0a2e358 HEAD@{0}: reset: moving to HEAD~2\n0254ea7 HEAD@{1}: checkout: moving from 2.2 to master\nc10f740 HEAD@{2}: checkout: moving from master to 2.2`, `28796300483705516000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">(master)$ git reflog</span>\n0a2e358 HEAD@{0}: reset: moving to HEAD~2\n0254ea7 HEAD@{1}: checkout: moving from 2.2 to master\nc10f740 HEAD@{2}: checkout: moving from master to 2.2</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面的 reflog 展示了从 master 分支签出 (checkout) 到 2.2 分支，然后再签回。 那里，还有一个硬重置 (hard reset) 到一个较旧的提交。最新的动作出现在最上面以 <code class="language-text">HEAD@{0}</code>标识.</p>\n<p>如果事实证明你不小心回移 (move back) 了提交 (commit), reflog 会包含你不小心回移前 master 上指向的提交 (0254ea7)。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37256883703262765000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ git reset --hard 0254ea7`, `37256883703262765000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="git"\n              >\n                <span class="gatsby-code-button-language">git</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="git"><pre style="counter-reset: linenumber NaN" class="language-git line-numbers"><code class="language-git"><span class="token command">$ git reset<span class="token parameter"> --hard</span> 0254ea7</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后使用 git reset 就可以把 master 改回到之前的 commit，这提供了一个在历史被意外更改情况下的安全网。</p>\n<h2 id="其它资源-other-resources"><a href="#%E5%85%B6%E5%AE%83%E8%B5%84%E6%BA%90-other-resources" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其它资源 (Other Resources)</h2>\n<h3 id="书-books"><a href="#%E4%B9%A6-books" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>书 (Books)</h3>\n<ul>\n<li><a href="https://git-scm.com/book/en/v2" target="_blank" rel="nofollow noreferrer noopener">Pro Git</a> - Scott Chacon’s excellent git book</li>\n<li><a href="https://github.com/pluralsight/git-internals-pdf" target="_blank" rel="nofollow noreferrer noopener">Git Internals</a> - Scott Chacon’s other excellent git book</li>\n</ul>\n<h3 id="教程-tutorials"><a href="#%E6%95%99%E7%A8%8B-tutorials" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>教程 (Tutorials)</h3>\n<ul>\n<li><a href="https://learngitbranching.js.org/" target="_blank" rel="nofollow noreferrer noopener">Learn Git branching</a> 一个基于网页的交互式 branching/merging/rebasing 教程</li>\n<li><a href="https://medium.com/@porteneuve/getting-solid-at-git-rebase-vs-merge-4fa1a48c53aa" target="_blank" rel="nofollow noreferrer noopener">Getting solid at Git rebase vs. merge</a></li>\n<li><a href="https://github.com/asmeurer/git-workflow" target="_blank" rel="nofollow noreferrer noopener">git-workflow</a> - <a href="https://github.com/asmeurer" target="_blank" rel="nofollow noreferrer noopener">Aaron Meurer</a> 的怎么使用 Git 为开源仓库贡献</li>\n<li><a href="http://hugogiraudel.com/2015/08/13/github-as-a-workflow/" target="_blank" rel="nofollow noreferrer noopener">GitHub as a workflow</a> - 使用 GitHub 做为工作流的趣事, 尤其是空 PRs</li>\n</ul>\n<h3 id="脚本和工具-scripts-and-tools"><a href="#%E8%84%9A%E6%9C%AC%E5%92%8C%E5%B7%A5%E5%85%B7-scripts-and-tools" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本和工具 (Scripts and Tools)</h3>\n<ul>\n<li><a href="http://firstaidgit.io/" target="_blank" rel="nofollow noreferrer noopener">firstaidgit.io</a> 一个可搜索的最常被问到的 Git 的问题</li>\n<li><a href="https://github.com/unixorn/git-extra-commands" target="_blank" rel="nofollow noreferrer noopener">git-extra-commands</a> - 一堆有用的额外的 Git 脚本</li>\n<li><a href="https://github.com/tj/git-extras" target="_blank" rel="nofollow noreferrer noopener">git-extras</a> - GIT 工具集 — repo summary, repl, changelog population, author commit percentages and more</li>\n<li><a href="https://github.com/qw3rtman/git-fire" target="_blank" rel="nofollow noreferrer noopener">git-fire</a> - git-fire 是一个 Git 插件，用于帮助在紧急情况下添加所有当前文件, 做提交 (committing), 和推 (push) 到一个新分支 (阻止合并冲突)。</li>\n<li><a href="https://github.com/git-tips/tips" target="_blank" rel="nofollow noreferrer noopener">git-tips</a> - Git 小提示</li>\n</ul>\n<h3 id="gui-客户端-gui-clients"><a href="#gui-%E5%AE%A2%E6%88%B7%E7%AB%AF-gui-clients" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GUI 客户端 (GUI Clients)</h3>\n<ul>\n<li><a href="https://www.gitkraken.com/" target="_blank" rel="nofollow noreferrer noopener">GitKraken</a> - 豪华的 Git 客户端 Windows, Mac &#x26; Linux</li>\n<li><a href="https://git-cola.github.io/" target="_blank" rel="nofollow noreferrer noopener">git-cola</a> - 另外一个 Git 客户端 Windows &#x26; OS X</li>\n<li><a href="https://github.com/git-up/GitUp" target="_blank" rel="nofollow noreferrer noopener">GitUp</a> - 一个新的 Git 客户端，在处理 Git 的复杂性上有自己的特点</li>\n<li><a href="https://rowanj.github.io/gitx/" target="_blank" rel="nofollow noreferrer noopener">gitx-dev</a> - 图形化的 Git 客户端 OS X</li>\n<li><a href="https://www.sourcetreeapp.com/" target="_blank" rel="nofollow noreferrer noopener">Source Tree</a> - 免费的图形化 Git 客户端 Windows &#x26; OS X</li>\n<li><a href="http://www.git-tower.com/" target="_blank" rel="nofollow noreferrer noopener">Tower</a> - 图形化 Git 客户端 OS X(付费)</li>\n</ul>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/git飞行规则/index.md absPath of file >>> MarkdownRemark",timeToRead:31,frontmatter:{date:"2018-11-09 10:09:28",path:"/git-flight-rules/",tags:"Git, git 飞行规则, 读书笔记",title:"git 飞行规则",draft:null}},{excerpt:"块级元素负责结构，内联元素接管内容，而 CSS 世界是面向图文混排，也就是内联元素设计的，由此可见，本章内容在整个 CSS 世界体系中占有非常重要的位置。 字母 x —— CSS 世界中隐匿的举足轻重的角色 字母 x 与 CSS 世界的基线 在各种内联相关模型中，凡是涉及垂直方向的排版或者对齐的，都离不开最基本的基线 （baseline）。例如，line-height 行高的定义就是两基线的间距，vertical-align…",html:'<p>块级元素负责结构，内联元素接管内容，而 CSS 世界是面向图文混排，也就是内联元素设计的，由此可见，本章内容在整个 CSS 世界体系中占有非常重要的位置。</p>\n<h1 id="字母-x--css-世界中隐匿的举足轻重的角色"><a href="#%E5%AD%97%E6%AF%8D-x--css-%E4%B8%96%E7%95%8C%E4%B8%AD%E9%9A%90%E5%8C%BF%E7%9A%84%E4%B8%BE%E8%B6%B3%E8%BD%BB%E9%87%8D%E7%9A%84%E8%A7%92%E8%89%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字母 x —— CSS 世界中隐匿的举足轻重的角色</h1>\n<h2 id="字母-x-与-css-世界的基线"><a href="#%E5%AD%97%E6%AF%8D-x-%E4%B8%8E-css-%E4%B8%96%E7%95%8C%E7%9A%84%E5%9F%BA%E7%BA%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字母 x 与 CSS 世界的基线</h2>\n<p>在各种内联相关模型中，凡是涉及垂直方向的排版或者对齐的，都离不开最基本的基线 （baseline）。例如，line-height 行高的定义就是两基线的间距，vertical-align 的默认值就是基线，其他中线顶线一类的定义也离不开基线，基线甚至衍生出了很多其他基线概念（如图 5-1 所示）。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-08-27-17-19-48-8267ee7cd7a08af0b8a36d0232c55636-a29fb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 575px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.47826086956522%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA90lEQVQY0y2Oz2rCQBDG87y+QR+gXlToqRA9VDSH4smDV29CS1soJSchmFQXg4TYze7OJvs3nRg/mGF2+H47X9De5FHOOWuNMfjUdd1wbqQszufWOX/zcMai6WwZTr8/Pnsk6GEEsf/E8ctigQMlpDoc1vP5w2BglOo9nLPn8eTpcfi+291hrM59OpVx/LXZrMPQa92fWkbR62qFg6T0L89LQmbjSTgavW23d7gL65xgjBaFEqLVGpPjspbS6E7G2oqQ634PhBRZVuKZ41ErZa0N0IoOAcABKsaYELgBIX6zjFKapmmSJPnlglmc9wK/bBouJQAg9Q/rjRAuzXMa1gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 08 27 17 19 48" title="" data-src="/static/2018-08-27-17-19-48-8267ee7cd7a08af0b8a36d0232c55636-a29fb.png" data-srcset="/static/2018-08-27-17-19-48-8267ee7cd7a08af0b8a36d0232c55636-d450c.png 200w,\n/static/2018-08-27-17-19-48-8267ee7cd7a08af0b8a36d0232c55636-dee51.png 400w,\n/static/2018-08-27-17-19-48-8267ee7cd7a08af0b8a36d0232c55636-a29fb.png 575w" data-sizes="(max-width: 575px) 100vw, 575px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>字母 x 的下边缘（线）就是我们的基线。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-08-27-17-23-29-e03a1158a00ed8b6ba35b80b2688826c-65498.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 409px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.567237163814184%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABmUlEQVQoz2VSTU/CQBDld+p/kZMchISvAMVIgkrwIMqXhYMKiV4wEQ7KD6A1VixU0jbAdrvd+tpiRZlMJ6+782ambxphjFGbwm3bDoDDHZt5mHPuA8u7ZZQyPwXRd9d1I3iQ5PoWAE3TUANAVVVCSHgepoXmkQ3dWCwWAJ/qJ6IgCOPxK8BwNNS+NPANw7CohXbEIujpeMY88kSaRKMHkjQpFPLwer2ezWYTiUSlcv74+NBqt9LpVLFYvL+/q15UxY6ICfClG7JpmslU8kYU05mMoii5XC4Wi0mSlM/ny6enBUHo9/uoOHh62tvb7/V64KDvZuyVrlfL5bOTUvwwljqK34qdTqOhSFLzsnbX7XaazZfn4WgwqFUv2lfX7es6N00iy/RjCgkiUHGuqpC5dHz8/vbm+mMF7v4AOCWEO45NLIdSbtvebSBYoCTmxzy/yvu+bf+1BjncW7BV7nLsmTmMewVRySsSHIaZf/a8vWTsbLlaUkoBMAvifD7HqoDd3c7/3vFjgLBer6G8ruvT6VSWZcTZbLZL/gYtPFfO/pKzQAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 08 27 17 23 29" title="" data-src="/static/2018-08-27-17-23-29-e03a1158a00ed8b6ba35b80b2688826c-65498.png" data-srcset="/static/2018-08-27-17-23-29-e03a1158a00ed8b6ba35b80b2688826c-67408.png 200w,\n/static/2018-08-27-17-23-29-e03a1158a00ed8b6ba35b80b2688826c-5cbc3.png 400w,\n/static/2018-08-27-17-23-29-e03a1158a00ed8b6ba35b80b2688826c-65498.png 409w" data-sizes="(max-width: 409px) 100vw, 409px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="字母-x-与-css-中的-x-height"><a href="#%E5%AD%97%E6%AF%8D-x-%E4%B8%8E-css-%E4%B8%AD%E7%9A%84-x-height" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字母 x 与 CSS 中的 x-height</h2>\n<p>CSS 中有一个概念叫作 x-height，指的是字母 x 的高度，术语描述就是基线和等分线（mean line）（也称作中线，midline）之间的距离。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-08-27-17-26-53-dc4e4fc11214aa102e46d343b9f1f73d-5a036.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 314px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.71974522292993%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABN0lEQVQY02WRW2+CQBCF9/8/2xf7QNM35ZHG/gGj1FpDE4iK1wQksAuLAltEbp5itTX9skzOHpjJzEDquv5qyLIMMU1TxOpKfeW/AwieoMFxnNlstlgsdF2Hhr/f733fz/M8jmNcIYqiOJ1Ox+MR4jv5Vo8xtl6vEWVZ1jSNMjYejxVF4WE4nU53ux2l8FgiBPIvKQRVV8slXniUIrnI8zdVfWy3O50O4pMkvSiK3O0+tFqvvR4cRmkYBLZlQZDfCYKgtu2Cc2uzmQyHz5K0MozP0QjnYzDQVNWYTN77fd+ysjBMogjNE3TveR7GY7Ztz+ee46A5z3UNw0DBsizRX1lVFwGKhosmcDnnSZLEQvDDARqDYec/mQ3lPbedk/qe7XaL3URRJITwG1zXxb9ARdM0saq/H58BtLC512YJjL4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 08 27 17 26 53" title="" data-src="/static/2018-08-27-17-26-53-dc4e4fc11214aa102e46d343b9f1f73d-5a036.png" data-srcset="/static/2018-08-27-17-26-53-dc4e4fc11214aa102e46d343b9f1f73d-2e2a0.png 200w,\n/static/2018-08-27-17-26-53-dc4e4fc11214aa102e46d343b9f1f73d-5a036.png 314w" data-sizes="(max-width: 314px) 100vw, 314px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>ascender height: 上行线高度。</li>\n<li>cap height: 大写字母高度。</li>\n<li>median: 中线。</li>\n<li>descender height: 下行线高度。</li>\n</ul>\n<p>CSS 中有些属性值的定义就和这个 x-height 有关，最典型的代表就是 vertical-align:middle，这里的 middle 是中间的意思。注意，跟上面的 median（中线）不是一个意思。在 CSS 世界中，middle 指的是基线往上 1/2 x-height 高度。我们可以近似理解为字母 x 交叉点那个位置。</p>\n<p>由此可见，vertical-align:middle 并不是绝对的垂直居中对齐，我们平常看到的 middle 效果只是一种近似效果，因为不同的字体在行内盒子中的位置是不一样的</p>\n<h2 id="字母-x-与-css-中的-ex"><a href="#%E5%AD%97%E6%AF%8D-x-%E4%B8%8E-css-%E4%B8%AD%E7%9A%84-ex" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字母 x 与 CSS 中的 ex</h2>\n<p>字母 x 衍生出了 x-height 概念，并在这个基础上深耕细作，进一步衍生出了 ex。注意，这里的 ex 是 CSS 中的一个尺寸单位。</p>\n<p>ex 是 CSS 中的一个相对单位，指的是小写字母 x 的高度，没错，就是指 x-height。</p>\n<p>虽然说 em、px 这类单位的主要作用是限定元素的尺寸，但是，由于字母 x 受字体等 CSS 属性影响大，不稳定，因此 ex 不太适合用来限定元素的尺寸</p>\n<p>没错，ex 的价值就在其副业上 — 不受字体和字号影响的内联元素的垂直居中对齐效果。</p>\n<p>内联元素默认是基线对齐的，而基线就是 x 的底部，而 1ex 就是一个 x 的高度。设想一下，假如图标高度就是 1ex，同时背景图片居中，岂不是图标和文字天然垂直居中，而且完全不受字体和字号的影响？因为 ex 就是一个相对于字体和字号的单位。</p>\n<p>比如以下的文字后面跟着一个小三角形图标的效果</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 50%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/code-editor.html?html=zhangxinxu%3Ci%20class%3D%22icon-arrow%22%3E%3C/i%3E%0A%0A%u5F20%u946B%u65ED%3Ci%20class%3D%22icon-arrow%22%3E%3C/i%3E&amp;css=.icon-arrow%20%7B%0A%20%20%20%20display%3A%20inline-block%3B%0A%20%20%20%20width%3A%2020px%3B%0A%20%20%20%20height%3A%201ex%3B%0A%20%20%20%20background%3A%20url%28/images/5/arrow.png%29%20no-repeat%20center%3B%0A%7D" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<h1 id="内联元素的基石-line-height"><a href="#%E5%86%85%E8%81%94%E5%85%83%E7%B4%A0%E7%9A%84%E5%9F%BA%E7%9F%B3-line-height" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内联元素的基石 line-height</h1>\n<p>下文中所有的“行高”指的就是 line-height</p>\n<h2 id="内联元素的高度之本--line-height"><a href="#%E5%86%85%E8%81%94%E5%85%83%E7%B4%A0%E7%9A%84%E9%AB%98%E5%BA%A6%E4%B9%8B%E6%9C%AC--line-height" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内联元素的高度之本 — line-height</h2>\n<p>默认空<code class="language-text">&lt;div&gt;</code>高度是 0，但是一旦里面写上几个文字，<code class="language-text">&lt;div&gt;</code>高度就有了，请问这个高度由何而来，或者说是由哪个 CSS 属性决定的？</p>\n<p>本质上是由 line-height 属性全权决定的，尽管某些场景确实与 font-size 大小有关。</p>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24775015869119164000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;test1&quot;>我的高度是？</div>\n<style>\n   .test1 {\n      font-size: 16px;\n      line-height: 0;\n      border: 1px solid #ccc;\n      background: #eee;\n   }\n</style>`, `24775015869119164000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>我的高度是？<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.test1</span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56259423860843040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;test2&quot;>我的高度是？</div>\n<style>\n   .test1 {\n      font-size: 0;\n      line-height: 16px;\n      border: 1px solid #ccc;\n      background: #eee;\n   }\n</style>`, `56259423860843040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>我的高度是？<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.test1</span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这两段代码的区别在于一个 line-height 行高为 0，一个 font-size 字号为 0。结果，第一段代码，最后元素的高度只剩下边框那么丁点儿，而后面一段代码，虽然文字小到都看不见了，但是 16px 的内部高度依然坚挺</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-15-17-42-22-a8a79781fbe7c5b00163927c7ddfd94b-cf562.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 246px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.58536585365854%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAAAxklEQVQY03WPXQ9DQBBF/f//pQ9t+lBvIhHEtyJStdgtPSxNG+lJjGvduTNrzAemaVLqBYrXquY/GDxSynFlGAYpVds+zhe4mnAyb5YlhBjHzaPRiUuzOtD3/bN7UkUvSDwa2G5pJqPcqarqW2vKX+4rXddtk/U9gf2nHQ7J1VqLj03rpblpGtu20zQtioJTRJIknuc5juO6ru/7aAYGQRCGIZUTap7nSzMLxHHMb/3NSnVd048pyzIElQEI0vEQEUUR18H8BtzHj2r7wUHWAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 15 17 42 22" title="" data-src="/static/2018-09-15-17-42-22-a8a79781fbe7c5b00163927c7ddfd94b-cf562.png" data-srcset="/static/2018-09-15-17-42-22-a8a79781fbe7c5b00163927c7ddfd94b-c493e.png 200w,\n/static/2018-09-15-17-42-22-a8a79781fbe7c5b00163927c7ddfd94b-cf562.png 246w" data-sizes="(max-width: 246px) 100vw, 246px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>对于非替换元素的纯内联元素，其可视高度完全由 line-height 决定，也就是什么 padding、border 属性对可视高度是没有任何影响的，这也是我们平常口中的“盒模型”约定俗成说的是块级元素的原因</p>\n<p>因此，对于文本这样的纯内联元素，line-height 就是高度计算的基石，用专业说法就是指定了用来计算行框盒子高度的基础高度。比方说，line-height 设为 16px，则一行文字高度是 16px，两行就是 32px，三行就是 48px，所有浏览器渲染解析都是这个值，1 像素都不差</p>\n<h3 id="line-height-在替换元素、块级元素的作用"><a href="#line-height-%E5%9C%A8%E6%9B%BF%E6%8D%A2%E5%85%83%E7%B4%A0%E3%80%81%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E7%9A%84%E4%BD%9C%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>line-height 在替换元素、块级元素的作用</h3>\n<p>行距 = line-height - font-size</p>\n<p>半行距的显示：(当我们的字体是宋体的时候，内容区域和 em-box 是等同的)</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29258560183327044000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n   .test {\n      font-family: simsun;\n      font-size: 24px;\n      line-height: 36px;\n      background-color: yellow;\n   }\n\n   .test > span {\n      background-color: white;\n   }\n</style>\n<div class=&quot;test&quot;>\n   <span>\n      sphinx\n   </span>\n</div>`, `29258560183327044000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.test</span> <span class="token punctuation">{</span>\n      <span class="token property">font-family</span><span class="token punctuation">:</span> simsun<span class="token punctuation">;</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.test > span</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>\n      sphinx\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，平常虚无的 em-box 借助内容区域（图 5-8 中字符 sp 的选中区域）暴露出了庐山真面目，“半行距”也准确显现出来了，如图 5-8 右侧标注</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-19-10-03-19-e49a5156efbd23d948d20d68338ea99d-fb6d6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 369px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.28455284552846%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB7klEQVQoz3VSTU8TURTtLzAx0YXxD6A7VyZuVKJuMJG6QXfs1BiICakLExd+EIIKiS7QWEREFBWQimgwGoxhIShNbKHJhLHtFNpOv2YQZso4fe/d4+sAUVBP7ru5eXnnfp3nw98QompE0hORPMJ1RaEodF2kUpTJwLKqz4h8f7JISBA3l0ShIBYWkM9vTWqUqkk5X7vw4T8goyh9eCbWff9FsPflg96hvv6R7uBAIrnoVaXfZFkQWJ6emmi9fLut9U77jbudnfcY08bfBpvPnrp6M3Dl+vlbHS3X2i7MRb6gwoTjeGTZjOMI6ydw8P3E7samhovtRy911A0M1q2uHgAOEdUCR4BjqAbbkevCh2nMRTxyxUU2w3+4SNb0fW7e14XDPezEE6Fm07KhUsngTKLibdAQbBvRI28q5pFJwDS5osHY+3ym6fRjND51AmMUejeZjCualsjl0tFoWFW/q+oUsGOdDL4xs2Hw2TiW9zz7FvA/xJlBdm4Ik+HMvJJSFD2dXopG5mOxfCQ6C+zcTJZ7t22yHZT3J7K7XsUavi7Wf0r4bdcPnCSqB/xE0mR83JO2f3PldcjE48BrUAhimGiU8xBjI647LMQoMAa8AT4CxTUpt+os9ZJ3pulqKXtlRVgW1/VyPG6Uy5V//oVfho49NZEDdLIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 19 10 03 19" title="" data-src="/static/2018-09-19-10-03-19-e49a5156efbd23d948d20d68338ea99d-fb6d6.png" data-srcset="/static/2018-09-19-10-03-19-e49a5156efbd23d948d20d68338ea99d-4bba0.png 200w,\n/static/2018-09-19-10-03-19-e49a5156efbd23d948d20d68338ea99d-fb6d6.png 369w" data-sizes="(max-width: 369px) 100vw, 369px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>所有与文字相关的间距都是从文字的上边缘和下边缘开始标注的，假设 line-height 是 1.5，font-size 大小是 14px，那么我们的半行距大小就是（套用上面的行距公式再除以 2）：(14px _ 1.5 - 14px) / 2 = 14px _ 0.25 = 3.5px。border 以及 line-height 等传统 CSS 属性并没有小数像素的概念（从 CSS3 动画的细腻程度可以看出），因此，这里的 3.5px 需要取整处理，如果标注的是文字上边距，则向下取整；如果是文字下边距，则向上取整，因为绝大多数的字体在内容区域中都是偏下的。所以，假设设计师标注了文字字形上边缘到图片下边缘间距 20px，则我们实际的 margin-top 值应该是 17px，因为 3.5px 向下取整是 3px。</p>\n<h3 id="line-height-如何通过改变行距实现文字排版"><a href="#line-height-%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E6%94%B9%E5%8F%98%E8%A1%8C%E8%B7%9D%E5%AE%9E%E7%8E%B0%E6%96%87%E5%AD%97%E6%8E%92%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>line-height 如何通过改变行距实现文字排版</h3>\n<p>当 line-height 设为 2 的时候，半行距是一半的文字大小，两行文字中间的间隙差不多一个文字尺寸大小；如果 line-height 大小是 1 倍文字大小，则根据计算，半行距是 0，也就是两行文字会紧密依偎在一起；如果 line-height 值是 0.5，则此时的行距就是负值，虽然 line-height 不支持负值，但是行距可以为负值，此时，两行文字就是重叠纠缠在一起</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-19-10-13-58-f4133e65e5896ceb63d06ec1c4c3ea0f-43b87.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 330px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 35.45454545454545%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABFklEQVQY03WPwUrEMBCG8wSePHsSfAMvvoIP4s2r4At41QURj+ITeBIPgogXEV1FLLrbxmYr3bLbTZo0zcY0GdPK6gruzzCHf+bLn0HwI1f7puiJHK9PJ5v2k3y7vhzYthz8FfplnfGd4t3BCxqFS4ZeaX5t+LmdDmevwEIYoIGN2NM5qvmawAdPFyi5R7LXIXf76cN2EZ21GfXC5FF/57WLhv1lEXeeb1eT3oqKjx4vt4KbjfHb8TzsnJtPtq3XBXMI9Sk41hi2bk7+/9eA8jzHGFNKlVKcF4xpVgBldkJ58pHEhPhphKOYvJMBCcMwy7I0TYMg8CDSWkspTSvPa61ag6uqKsuSc17OVEkphPAzj3jfL38BuWWBNJIoGp4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 19 10 13 58" title="" data-src="/static/2018-09-19-10-13-58-f4133e65e5896ceb63d06ec1c4c3ea0f-43b87.png" data-srcset="/static/2018-09-19-10-13-58-f4133e65e5896ceb63d06ec1c4c3ea0f-12832.png 200w,\n/static/2018-09-19-10-13-58-f4133e65e5896ceb63d06ec1c4c3ea0f-43b87.png 330w" data-sizes="(max-width: 330px) 100vw, 330px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="替换元素和块级元素中-line-height-的影响"><a href="#%E6%9B%BF%E6%8D%A2%E5%85%83%E7%B4%A0%E5%92%8C%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E4%B8%AD-line-height-%E7%9A%84%E5%BD%B1%E5%93%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>替换元素和块级元素中 line-height 的影响</h3>\n<p>line-height 可以影响替换元素（如图片的高度）？</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="59212978198654984000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<style>\n   .box {\n      line-height: 256px;\n   }\n</style>\n<div class=&quot;box&quot;>\n   <img data-src=&quot;1.jpg&quot; height=&quot;128&quot; />\n</div>`, `59212978198654984000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 256px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>128<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>不可以，不是 line-height 把图片占据高度变高了，而是把“幽灵空白节点”的高度变高了，图片为内联元素，会构成一个“行框盒子”，而在 HTML5 文档模式下，每一个“行框盒子”的前面都有一个宽度为 0 的“幽灵空白节点”，其内联特性表现和普通字符一模一样，所以，这里的容器高度会等于 line-height 设置的属性值 256px。</p>\n<p>实际开发的时候，图文和文字混在一起是很常见的，那这种内联替换元素和内联非替换元素在一起时的高度表现又是怎样的呢？</p>\n<p>由于同属内联元素，因此，会共同形成一个“行框盒子”，line-height 在这个混合元素的“行框盒子”中扮演的角色是决定这个行盒的最小高度，对于纯文本元素，line-height 直接决定了最终的高度。但是，如果同时有替换元素，则 line-height 只能决定最小高度，为什么会这样呢？一是替换元素的高度不受 line-height 影响，二是 vertical-align 属性在背后作祟。</p>\n<p>对于这种混合替换元素的场景，line-height 要想一统江山，需要值足够大才行。但是，实际开发的时候，我们给 line-height 设置的值总是很中规中矩，于是，就会出现类似下面的场景：明明文字设置了 line-height 为 20px，但是，如果文字后面有小图标，最后“行框盒子”高度却是 21px 或是 22px。这种现象背后最大的黑手其实是 vertical-align 属性，我们会在下一章好好深入剖析为什么会有这样的表现</p>\n<p>对于块级元素，line-height 对其本身是没有任何作用的，我们平时改变 line-height，块级元素的高度跟着变化实际上是通过改变块级元素里面内联级别元素占据的高度实现的。</p>\n<h2 id="为什么-line-height-可以让内联元素垂直居中"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-line-height-%E5%8F%AF%E4%BB%A5%E8%AE%A9%E5%86%85%E8%81%94%E5%85%83%E7%B4%A0%E5%9E%82%E7%9B%B4%E5%B1%85%E4%B8%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么 line-height 可以让内联元素“垂直居中”</h2>\n<p>要想让单行文字垂直居中，只要设置 line-height 大小和 height 高度一样就可以了，这是个误区，正确的做法如下：</p>\n<ul>\n<li>\n<p>要让单行文字垂直居中，只需要 line-height 这一个属性就可以，与 height 一点儿关系都没有。也就是说，我们直接：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34275114926233453000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.title {\n  line-height: 24px;\n}`, `34275114926233453000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.title</span> <span class="token punctuation">{</span>\n  <span class="token property">line-height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>行高控制文字垂直居中，不仅适用于单行，多行也是可以的。准确的说法应该是“line-height 可以让单行或多行元素近似垂直居中”</p>\n</li>\n</ul>\n<p>实现“垂直居中”原因在于 CSS 中“行距的上下等分机制”，如果行距的添加规则是在文字的上方或者下方，则行高是无法让文字垂直居中的。</p>\n<p>说“近似”是因为文字字形的垂直中线位置普遍要比真正的“行框盒子”的垂直中线位置低，譬如我们拿现在用得比较多的微软雅黑字体举例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13061349251624233000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n   p {\n      font-size: 80px;\n      line-height: 120px;\n      background-color: #666;\n      font-family: \'microsoft yahei\';\n      color: #fff;\n   }\n</style>\n<p>微软雅黑</p>`, `13061349251624233000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">p</span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 120px<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>\n      <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'microsoft yahei\'</span><span class="token punctuation">;</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>微软雅黑<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>字形明显偏下，font-size 12px ～ 16px 很多，因此，虽然微软雅黑字体有下沉，但也就 1 像素的样子</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-19-10-49-14-214ecfc80fd4328a538224bb689d0531-8f764.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 257px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.42023346303502%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAByklEQVQoz2VQW4tBURj1Kz16kSTx4hLNuEW5zRAPLhFSJBQv7ncvSimRQryhSEiYOTjOLOc409Ssh93a3/7W+tb+OPf7PRKJmM3mTxoOh8Nms33QcDqd4Ha7HSeeULFarbgajcZGo0FRFOd6vWo0GpFIJBQKcfJ4PJlMBiIWi7lcrlQqBVepVHw+XyAQyOVyhUKBSjKZfIoJgkgkEsViMZ/Pl0qlcDgMkk6nM5lMNBpFU61WazabgUDA7/dXq9VyuZzL5TqdzkuMbiRPpVKFQiEYDMLI5/Mxf8lms+12G3WIkRlXGMVisXq9/opdqVTQGo/HMdliscAYQ2AhkUgwGXUMRAr8FokQBOlardZTfLlcQqEQXN1uN/q0Wi12hmcQVFwul8fjgTW2BY4KXsFfsW+3m9frxUreaWB5Op3OYDCo1WoQk8kE/kYDBI56vV6pVCLjU0yS5Pl8JmjcWDCcYPFNA22I+cXiKd5ut8PhcLlczmYzdOx2O1SOx+N+vz8cDuv1erPZnE6n+Xw+mUz6/T4qIKPRCMviPB4PkgU4/NDd6/XG43G32x0MBovFYjqdYixeIfjtB+FQf8CIMWe1WmECTiYF7CCj/uEHOSXojEQVu44AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 19 10 49 14" title="" data-src="/static/2018-09-19-10-49-14-214ecfc80fd4328a538224bb689d0531-8f764.png" data-srcset="/static/2018-09-19-10-49-14-214ecfc80fd4328a538224bb689d0531-1fd86.png 200w,\n/static/2018-09-19-10-49-14-214ecfc80fd4328a538224bb689d0531-8f764.png 257w" data-sizes="(max-width: 257px) 100vw, 257px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>多行文本或者替换元素的垂直居中实现原理和单行文本就不一样了，需要 line-height 属性的好朋友 vertical-align 属性帮助才可以，示例代码如下：</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 50%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/code-editor.html?html=%3Cdiv%20class%3D%22box%22%3E%0A%20%20%20%20%3Cdiv%20class%3D%22content%22%3E%u57FA%u4E8E%u884C%u9AD8%u5B9E%u73B0%u7684...%3C/div%3E%0A%3C/div%3E&amp;css=.box%20%7B%0A%20%20%20%20width%3A%20280px%3B%0A%20%20%20%20line-height%3A%20120px%3B%0A%20%20%20%20background-color%3A%20%23f0f3f9%3B%0A%20%20%20%20margin%3A%20auto%3B%0A%7D%0A.content%20%7B%0A%20%20%20%20display%3A%20inline-block%3B%0A%20%20%20%20line-height%3A%2020px%3B%0A%20%20%20%20margin%3A%200%2020px%3B%0A%20%20%20%20text-align%3A%20left%3B%0A%20%20%20%20vertical-align%3A%20middle%3B%0A%7D" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p>实现的原理大致如下:</p>\n<ol>\n<li>多行文字使用一个标签包裹，然后设置 display 为 inline-block。好处在于既能重置外部的 line-height 为正常的大小，又能保持内联元素特性，从而可以设置 vertical-align 属性，以及产生一个非常关键的“行框盒子”。我们需要的其实并不是这个“行框盒子”，而是每个“行框盒子”都会附带的一个产物 — “幽灵空白节点”，即一个宽度为 0、表现如同普通字符的看不见的“节点”。有了这个“幽灵空白节点”，我们的 line-height:120px 就有了作用的对象，从而相当于在.content 元素前面撑起了一个高度为 120px 的宽度为 0 的内联元素。</li>\n<li>因为内联元素默认都是基线对齐的，所以我们通过对 .content 元素设置 vertical-align:middle 来调整多行文本的垂直位置，从而实现我们想要的“垂直居中”效果。如果是要借助 line-height 实现图片垂直居中效果，也是类似的原理和做法</li>\n</ol>\n<p>这里实现的“垂直居中”确实也不是真正意义上的垂直居中，也是“近似垂直居中”。还是上面的多行文本垂直居中的例子，如果我们捕获到多行文本元素的尺寸空间，截个图，然后通过尺子工具一量就会发现，上面的留空是 41px，下面的留空是 39px，对啦，原来不是完全的垂直居中</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-19-11-20-20-0aa2e64cf587e27efa279196a2cfb8aa-0bfb1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 224px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACHElEQVQoz2VRy27TQBTNJ3WFEBUIFjylqruyZsEPsIIFC1AfiCVUvKqUFJKqNCVpqYCqFRVpalIWKUmInThxglMnjt/4OX5NbMZJhAQdnRmde+aeuTN3YmEY9li+0eq0fjFU6wShTTNNRNoM2exIim670LJ9y4bAgUC3gIO473oQGWODYHD71p0LEzfOXpqavH7z3LWZiTMXr1ydnpqemTx/eSWZhkGoqEAzPU02jDKud3nFggYYmtF8v56+d3d2eW17KZldSm2+WknHk5l4KvN8ee1bkRB1vydZfQWwMuA6PCvooqJbphGZgyAI2zv7+UL8UFgt9BO5kzdY7/UB8xZjU0dcIse82KMWP9WffCQWP5Mvd8lnX/s/jvZhcyeIrj0YwOPEu8zW7DY9t1G5v3o8n63NZ4hHW/WFzQhzGfzhxs8H6+WFLPF0l368JxS+fAjxdDCqbPdwnGxjpJbHuQOCx0gJq0lYXcbqUh4X8lU+V+UPCSFfE7+TcoHU2xTlcuT4zZodogYA4AHbt1FXgT9EFA6VESCwXLtctVk+yrfDsdkEnmo4quH+hTYipvuPbro6w2nCb9XyAHDH5v9GEAZRF0/rp9QYy7KlUonjOJqmVVV1XVcURZ7jKpVKo9HodrsMw6CVoigUioJgmkaxWES7mqbFTNOUZfT9BvI4juP7PlIQkSRJURSUgU7UdR2FiHieByFEmYIgoDJ/AI+8OPfyH+ulAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 19 11 20 20" title="" data-src="/static/2018-09-19-11-20-20-0aa2e64cf587e27efa279196a2cfb8aa-0bfb1.png" data-srcset="/static/2018-09-19-11-20-20-0aa2e64cf587e27efa279196a2cfb8aa-73be6.png 200w,\n/static/2018-09-19-11-20-20-0aa2e64cf587e27efa279196a2cfb8aa-0bfb1.png 224w" data-sizes="(max-width: 224px) 100vw, 224px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>不垂直居中与 line-height 无关，而是 vertical-align 导致的，具体原因我们将在 5.3 节讲解。</p>\n<h2 id="深入-line-height-的各类属性值"><a href="#%E6%B7%B1%E5%85%A5-line-height-%E7%9A%84%E5%90%84%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入 line-height 的各类属性值</h2>\n<p>line-height 的默认值是 normal，还支持数值、百分比值以及长度值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90025176181722420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   line-height: normal;\n   font-family: \'microsoft yahei\';\n}\n\ndiv {\n   line-height: normal;\n   font-family: simsun;\n}`, `90025176181722420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'microsoft yahei\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> simsun<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时两段 CSS 中 line-height 的属性值 normal 的计算值是不一样的，下表给出的是我在几个桌面浏览器的测试数据。</p>\n<table>\n<thead>\n<tr>\n<th align="center">字体</th>\n<th align="center">chrome</th>\n<th align="center">Firefox</th>\n<th align="center">IE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">微软雅黑</td>\n<td align="center">1.32</td>\n<td align="center">1.321</td>\n<td align="center">1.32</td>\n</tr>\n<tr>\n<td align="center">宋体</td>\n<td align="center">1.141</td>\n<td align="center">1.142</td>\n<td align="center">1.141</td>\n</tr>\n</tbody>\n</table>\n<p>只要字体确定，各个浏览器下的默认 line-height 解析值基本上都是一样的，然而不同的浏览器所使用的默认中英文字体并不是一样的，并且不同操作系统的默认字体也不一样，换句话说，就是不同系统不同浏览器的默认 line-height 都是有差异的。因此，在实际开发的时候，对 line-height 的默认值进行重置是势在必行的。下面问题来了，line-height 应该重置为多大的值呢？是使用数值、百分比值还是长度值呢？</p>\n<p>要回答这个问题，我们需要先对这几种属性值有一定的了解才行</p>\n<ul>\n<li>数值，如 line-height:1.5，其最终的计算值是和当前 font-size 相乘后的值。例如，假设我们此时的 font-size 大小为 14px，则 line-height 计算值是 1.5*14px = 21px。</li>\n<li>百分比值，如 line-height:150%，其最终的计算值是和当前 font-size 相乘后的值。例如，假设我们此时的 font-size 大小为 14px，则 line-height 计算值是 150%*14px=21px。</li>\n<li>长度值，也就是带单位的值，如 line-height:21px 或者 line-height:1.5em 等，此处 em 是一个相对于 font-size 的相对单位，因此，line-height:1.5em 最终的计算值也是和当前 font-size 相乘后的值。例如，假设我们此时的 font-size 大小为 14px，则 line-height 计算值是 1.5*14px=21px。</li>\n</ul>\n<p>实际上，line-height:1.5 和另外两个有一点儿不同，那就是继承细节有所差别。如果使用数值作为 line-height 的属性值，那么所有的子元素继承的都是这个值；但是，如果使用百分比值或者长度值作为属性值，那么所有的子元素继承的是最终的计算值。什么意思呢？比方说下面 3 段 CSS 代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7128766725154256000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`body {\n   font-size: 14px;\n   line-height: 1.5;\n}\n\nbody {\n   font-size: 14px;\n   line-height: 150%;\n}\n\nbody {\n   font-size: 14px;\n   line-height: 1.5em;\n}`, `7128766725154256000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 150%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5em<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于<code class="language-text">&lt;body&gt;</code>元素而言，上面 3 段 CSS 最终的行高计算值是 21px 是没有任何区别的，但是，如果同时还有子元素，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92978230338664530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n   h3,\n   p {\n      margin: 0;\n   }\n\n   h3 {\n      font-size: 32px;\n   }\n\n   p {\n      font-size: 20px;\n   }\n</style>\n<h3>标题</h3>\n<p>内容</p>`, `92978230338664530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">h3,\n   p</span> <span class="token punctuation">{</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">h3</span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">p</span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果 line-height:150% 和 line-height:1.5em 的最终表现是“标题”文字和“内容”文字重叠在了一起，如图 5-13 所示</p>\n<p>俗话讲“没有对比就没有伤害”，我们来看看 line-height:1.5 的最终表现，排版令人舒畅</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 50%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/code-editor.html?html=%3Cdiv%20class%3D%22box%20box-1%22%3E%0A%20%20%20%20%3Ch3%3E%u6807%u9898%3C/h3%3E%0A%20%20%20%20%3Cp%3E%u5185%u5BB9%3C/p%3E%0A%3C/div%3E%0A%3Cdiv%20class%3D%22box%20box-2%22%3E%0A%20%20%20%20%3Ch3%3E%u6807%u9898%3C/h3%3E%0A%20%20%20%20%3Cp%3E%u5185%u5BB9%3C/p%3E%0A%3C/div%3E%0A%3Cdiv%20class%3D%22box%20box-3%22%3E%0A%20%20%20%20%3Ch3%3E%u6807%u9898%3C/h3%3E%0A%20%20%20%20%3Cp%3E%u5185%u5BB9%3C/p%3E%0A%3C/div%3E&amp;css=.box%20%20%20%7B%20font-size%3A%2014px%3B%20%7D%0A.box-1%20%7B%20line-height%3A%201.5%3B%20%7D%0A.box-2%20%7B%20line-height%3A%20150%25%3B%20%7D%0A.box-3%20%7B%20line-height%3A%201.5em%3B%20%7D%0A%0Ah3%2C%20p%20%7B%0A%20%20%20%20margin%3A%200%3B%0A%7D%0Ah3%20%7B%20font-size%3A%2032px%3B%20%7D%0Ap%20%20%7B%20font-size%3A%2020px%3B%20%7D" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p>line-height:150% 和 line-height:1.5em 代码下的文字重叠的原因在于<code class="language-text">&lt;h3&gt;</code>和<code class="language-text">&lt;p&gt;</code>元素继承的并不是 150% 或者 1.5em，而是<code class="language-text">&lt;body&gt;</code>元素的 line-height 计算值 21px，也就是说，<code class="language-text">&lt;h3&gt;</code>和<code class="language-text">&lt;p&gt;</code>元素的行高都是 21px，考虑到<code class="language-text">&lt;h3&gt;</code>的 font-size 大小为 32px，此时<code class="language-text">&lt;h3&gt;</code>的半行间距就是-5.5px，因而“标题”文字和下面的“内容”文字发生重叠。</p>\n<p>但是 line-height:1.5 的继承则不同，<code class="language-text">&lt;h3&gt;</code>和<code class="language-text">&lt;p&gt;</code>元素的 line-height 继承的不是计算值，而是属性值 1.5，因此，对于<code class="language-text">&lt;h3&gt;</code>元素，此时的行高计算值是 1.5 _ 32px = 48px，<code class="language-text">&lt;p&gt;</code>元素的行高计算值是 1.5 _ 20px = 30px，于是，间距合理，排版舒适。</p>\n<p>实际上，line-height:150%、line-height:1.5em 要想有类似 line-height:1.5 的继承效果，也是可以实现的，类似下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10689732406232520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`* {\n   line-height: 150%;\n}`, `10689732406232520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">*</span> <span class="token punctuation">{</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 150%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>既然 line-height 数值可以让元素天然继承相对计算特性，那这里的通配符岂不完全没必要？</p>\n<p>两者还是有差别的。HTML 中的很多替换元素，尤其表单类的替换元素，如输入框、按钮之类的，很多具有继承特性的 CSS 属性其自己也有一套，如 font-family、font-size 以及这里的 line-height。由于继承是属于最弱的权重，因此 body 中设置的 line-height 是无法影响到这些替换元素的，但是 _ 作为一个选择器，就不一样了，会直接重置这些替换元素默认的 line-height，这其实是我们需要的，因此从道义上讲，使用 _ 通配也是合理的。但又考虑到*的性能以及明明有继承却不好好利用的羞耻感，我们可以折中使用下面的方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52627770029451400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`body {\n   line-height: 1.5;\n}\n\ninput,\nbutton {\n   line-height: inherit;\n}`, `52627770029451400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">input,\nbutton</span> <span class="token punctuation">{</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="内联元素-line-height-的大值特性"><a href="#%E5%86%85%E8%81%94%E5%85%83%E7%B4%A0-line-height-%E7%9A%84%E5%A4%A7%E5%80%BC%E7%89%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内联元素 line-height 的“大值特性”</h2>\n<p>一个子元素行高是 20px，一个是 96px，假如文字就 1 行，.box 元素的高度分别是多少？</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 50%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/code-editor.html?html=%3Cdiv%20class%3D%22box%20box1%22%3E%0A%20%20%20%20%3Cspan%3Espan%3A%20line-height%3A20px%3C/span%3E%0A%3C/div%3E%0A%3Cdiv%20class%3D%22box%20box2%22%3E%0A%20%20%20%20%3Cspan%3Espan%3A%20line-height%3A20px%3C/span%3E%0A%3C/div%3E&amp;css=.box%20%7B%0A%20%20%20%20width%3A%20280px%3B%0A%20%20%20%20margin%3A%201em%20auto%3B%0A%20%20%20%20outline%3A%201px%20solid%20%23beceeb%3B%0A%20%20%20%20background%3A%20%23f0f3f9%3B%0A%7D%0A.box1%20%7B%0A%20%20%20%20line-height%3A%2096px%3B%0A%7D%0A.box1%20span%20%7B%0A%20%20%20%20line-height%3A%2020px%3B%0A%7D%0A.box2%20%7B%0A%20%20%20%20line-height%3A%2020px%3B%0A%7D%0A.box2%20span%20%7B%0A%20%20%20%20line-height%3A%2096px%3B%0A%7D" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p>全都是 96px 高，无论内联元素 line-height 如何设置，最终父级元素的高度都是由数值大的那个 line-height 决定的，称之为“内联元素 line-height 的大值特性”，因为幽灵空白节点的问题，“幽灵空白节点”就在<code class="language-text">&lt;span&gt;</code>元素的前方</p>\n<p>于是，就效果而言，我们的 HTML 实际上等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62871167925431720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;box&quot;>字符<span>内容...</span></div>`, `62871167925431720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>字符<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>内容...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这下就好理解了，当 .box 元素设置 line-height:96px 时，“字符”高度 96px；当设置 line-height:20px 时，<code class="language-text">&lt;span&gt;</code>元素的高度则变成了 96px，而行框盒子的高度是由高度最高的那个“内联盒子”决定的，这就是 .box 元素高度永远都是最大的那个 line-height 的原因。</p>\n<p>知道了原因也就能够对症下药，要避免“幽灵空白节点”的干扰，例如，设置<code class="language-text">&lt;span&gt;</code>元素 display:inline-block，创建一个独立的“行框盒子”，这样<code class="language-text">&lt;span&gt;</code>元素设置的 line-height:20px 就可以生效了，否则 line-height 都是 96px，这也是多行文字垂直居中示例中这么设置的原因。</p>\n<h1 id="line-height-的好朋友-vertical-align"><a href="#line-height-%E7%9A%84%E5%A5%BD%E6%9C%8B%E5%8F%8B-vertical-align" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>line-height 的好朋友 vertical-align</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83441034549469040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n   .box {\n      line-height: 32px;\n   }\n\n   .box > span {\n      font-size: 24px;\n   }\n</style>\n<div class=&quot;box&quot;>\n   <span>\n      文字\n   </span>\n</div>`, `83441034549469040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.box > span</span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>\n      文字\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>.box 元素的高度是多少？</p>\n<p>很多人一定认为是 32px，但是事实上，高度并不是 32px，而是要大那么几像素（受不同字体影响，增加高度也不一样），比方说 36px</p>\n<p>这里，之所以最终.box 元素的高度并不等于 line-height，就是因为行高的朋友属性 vertical-align 在背后默默地下了黑手</p>\n<h2 id="vertical-align-家族基本认识"><a href="#vertical-align-%E5%AE%B6%E6%97%8F%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vertical-align 家族基本认识</h2>\n<p>抛开 inherit 这类全局属性值不谈，我把 vertical-align 属性值分为以下 4 类：</p>\n<ul>\n<li>线类，如 baseline（默认值）、top、middle、bottom；</li>\n<li>文本类，如 text-top、text-bottom；</li>\n<li>上标下标类，如 sub、super；</li>\n<li>数值百分比类，如 20px、2em、20%等。</li>\n</ul>\n<p>实际上，“数值百分比类”应该是两类，分别是“数值类”和“百分比类”，这里之所以把它们合在一起归为一类，是因为它们有不少共性，包括“都带数字”和“行为表现一致”。</p>\n<p>行为表现一致”表示具有相同的渲染规则，具体为：根据计算值的不同，相对于基线往上或往下偏移，到底是往上还是往下取决于 vertical-align 的计算值是正值还是负值，如果是负值，往下偏移，如果是正值，往上偏移。</p>\n<p>由于 vertical-align 的默认值是 baseline，即基线对齐，而基线的定义是字母 x 的下边缘。因此，内联元素默认都是沿着字母 x 的下边缘对齐的。对于图片等替换元素，往往使用元素本身的下边缘作为基线，因此，进入上面的演示页面，看到的是图 5-18 所示的图文排列效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-21-17-10-49-8161de6f2f1d34fecc18117a0d83b801-2ee65.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 220px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.090909090909086%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABpUlEQVQoz2P4TwFgQOb8+/cPSN7eP2FDh9/VNTEvd8beXBxzaUHU/inRs3L810wohSjCpfkvkLy2NnFlLsupLvGb/SJnakVnRQo4qvDJcDIEOZnCLcCiGWLqgx1Zx5pFzvao3Vmo/HCm4uZE+fkeiubivLbWDvg0//sLsvnO5oxTvSI3l6heyVO8XKWwN1b+ZKRSo4Wgh5M9fptBmi9tyDraJ3bDV3WZpHypvmyYknSmgZy1Gq+bhxMWzRD+nz9/Hty/d+/B0wtbo857sh+SFN2SL7QrUaDfma/FW7DUhqk92hLiOrh+hM1///59/vz5w0ePXj84+Pnw6henVr+4vPrXvfW/b679c2Pt90urPl3dDXEeis0fP3789u3bbzAAyn39/vvLzz9//v///uv/p+//vv789+vf/x//gNw/3759BYJPnz79BYcOA9ANZ86cuXnz5uPHjy9cuPDjx487d26fOnH85vVr58+fPXrk8KWL5+/dvXPzxvXLly5euXL14sWLR48e/fLlC9RmoDFAD/8FA7j/ga749esXRBDOAAKIAyE2AwCqASL3f9CVXAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 21 17 10 49" title="" data-src="/static/2018-09-21-17-10-49-8161de6f2f1d34fecc18117a0d83b801-2ee65.png" data-srcset="/static/2018-09-21-17-10-49-8161de6f2f1d34fecc18117a0d83b801-6af5a.png 200w,\n/static/2018-09-21-17-10-49-8161de6f2f1d34fecc18117a0d83b801-2ee65.png 220w" data-sizes="(max-width: 220px) 100vw, 220px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由于是相对字母 x 的下边缘对齐，而中文和部分英文字形的下边缘要低于字母 x 的下边缘，因此，会给人感觉文字是明显偏下的，一般都会进行调整。比方说，我们给文字内容设置 vertical-align:10px，则文字内容就会在当前基线位置再往上精确偏移 10px，效果如图 5-19 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-21-17-12-01-789f9b22c862b36f81d3e9e7b25eeef5-6f190.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 333px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 42.94294294294294%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABaUlEQVQoz4VQPUvDUBQN6igqgoiDW5EuDm6O/gPRQRwE0UVwcXJzFHFw0uKiIKLYUlAXxRbspAUdFKRqJWZIbULznbQvHy8vX16j4tBiz3C479x3zn33UdEvwjAAlt9vCqlp7nKRSS/ktue3lqfeHougB4EfNYH6M8dtqXSSX+0q7w69bA6sT/QNd1DZTBp0z/Pam5XXs4fU4PNa8nopkZ8ZmUv2HmdP25hDeLRP+JrxdLtzP9t5Ndq/Md69MtYzmaBy5xm44Pv/ToYAQkKklNWL/drdESod1ooHbGFPq9JBnN7C/K0i1FBVpQFAtukHdYtopm9gXzAcHER107axFzVF/EwGlygJuq4bumZoqiDwsiyrer1a/cDEQzZ23Fa/rSgKQshxnHixLwQxYEmMieN6loORaWPXlSRJVVUYACyKIiGEqlQqUMEZ/NCGLKi1GIZhcBxnWaYoCpIo0TTNsizP88AMw9i2/QluF+ASEHkGQwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 21 17 12 01" title="" data-src="/static/2018-09-21-17-12-01-789f9b22c862b36f81d3e9e7b25eeef5-6f190.png" data-srcset="/static/2018-09-21-17-12-01-789f9b22c862b36f81d3e9e7b25eeef5-5dfa0.png 200w,\n/static/2018-09-21-17-12-01-789f9b22c862b36f81d3e9e7b25eeef5-6f190.png 333w" data-sizes="(max-width: 333px) 100vw, 333px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>vertical-align 的数值属性值在实际开发的时候实用性非常强</p>\n<ul>\n<li>其兼容性非常好</li>\n<li>其可以精确控制内联元素的垂直对齐位置</li>\n</ul>\n<p>假设有一个 display 值为 inline-block 的尺寸为 20 像素 ×20 像素的小图标，默认状态下，文字是明显偏下的，类似图 5-20 中“请选择”三个字和后面三角图形的位置关系。</p>\n<p>这里，我们需要的是垂直居中对齐效果，所以很多人都使用具有强烈语义的 vertical-align:middle 控制图标的垂直位置，然而，由于 middle 并不是真正意义上的垂直居中，因此还是会有像素级别的误差，误差大小与字体和字号均有关。例如，在本例中，图标往下多偏移了 1 像素而导致容器的可视高度变成了 21 像素，如图 5-21 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-01-07-11-51-28-7855af2451eaa2cd42788de709cba04b-a15de.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 617px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 13.290113452188008%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAe0lEQVQI11WMSwrDIBiEPW1X2edkJQ8KPUIOkIUPVEQXhSJiiI9MkYZk4B+Gj5mf1FpLKXva4fWuRnLO8GF6P7r+Ob5OAhFcSskYE2M8N9dHrbqqz7zIb9h+5F8gmHnvrbVCCMaY1jqE0CDnnFKqlEIAkVIio4bgnEP5ABOBqLve18/yAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 01 07 11 51 28" title="" data-src="/static/2020-01-07-11-51-28-7855af2451eaa2cd42788de709cba04b-a15de.png" data-srcset="/static/2020-01-07-11-51-28-7855af2451eaa2cd42788de709cba04b-70603.png 200w,\n/static/2020-01-07-11-51-28-7855af2451eaa2cd42788de709cba04b-4a3ab.png 400w,\n/static/2020-01-07-11-51-28-7855af2451eaa2cd42788de709cba04b-a15de.png 617w" data-sizes="(max-width: 617px) 100vw, 617px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>但是，如果我们使用精确的数值，则一切尽在掌控之中。例如，设置 vertical-align:-5px，此时，图标和文字实现了真正意义上的垂直居中，此时容器的可视高度和当前行高 20 像素保持了一致</p>\n<p>在 CSS 世界中，凡是百分比值，均是需要一个相对计算的值，例如，margin 和 padding 是相对于宽度计算的，line-height 是相对于 font-size 计算的，而这里的 vertical-align 属性的百分比值则是相对于 line-height 的计算值计算的。可见，CSS 世界中的各类属性相互间有着紧密联系而非孤立的个体。</p>\n<p>但是事实上，平时开发中很少使用。原因在于，在如今的网页布局中，line-height 的计算值都是相对固定并且已知的，因此，直接使用具体的数值反而更方便</p>\n<h2 id="vertical-align-作用的前提"><a href="#vertical-align-%E4%BD%9C%E7%94%A8%E7%9A%84%E5%89%8D%E6%8F%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vertical-align 作用的前提</h2>\n<h3 id="为什么我设置了-vertical-align-却没任何作用？"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E8%AE%BE%E7%BD%AE%E4%BA%86-vertical-align-%E5%8D%B4%E6%B2%A1%E4%BB%BB%E4%BD%95%E4%BD%9C%E7%94%A8%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么我设置了 vertical-align 却没任何作用？</h3>\n<p>只能应用于内联元素以及 display 值为 table-cell 的元素，当然 CSS 世界中，有一些 CSS 属性值会在背后默默地改变元素 display 属性的计算值，从而导致 vertical-align 不起作用。比方说，浮动和绝对定位会让元素块状化，因此，下面的代码组合 vertical-align 是没有理由出现的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41693033622046550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   float: left;\n   vertical-align: middle; /* 没有作用 */\n}\n\n.example {\n   position: absolute;\n   vertical-align: middle; /* 没有作用 */\n}`, `41693033622046550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span> <span class="token comment">/* 没有作用 */</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span> <span class="token comment">/* 没有作用 */</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="30978151734546612000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<style>\n   .box {\n      height: 128px;\n   }\n\n   .box > img {\n      height: 96px;\n      vertical-align: middle;\n   }\n</style>\n<div class=&quot;box&quot;>\n   <img data-src=&quot;1.jpg&quot; />\n</div>`, `30978151734546612000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 128px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.box > img</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 96px<span class="token punctuation">;</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时图片顶着.box 元素的上边缘显示，根本没垂直居中，完全没起作用！</p>\n<p>这种情况看上去是 vertical-align:middle 没起作用，实际上，vertical-align 是在努力地渲染的，只是行框盒子前面的“幽灵空白节点”高度太小，如果我们通过设置一个足够大的行高让“幽灵空白节点”高度足够，就会看到 vertical-align:middle 起作用了，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75347882745383170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.box {\n   height: 128px;\n   line-height: 128px; /* 关键 CSS 属性 */\n}\n\n.box > img {\n   height: 96px;\n   vertical-align: middle;\n}`, `75347882745383170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">{</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 128px<span class="token punctuation">;</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 128px<span class="token punctuation">;</span> <span class="token comment">/* 关键 CSS 属性 */</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.box > img</span> <span class="token punctuation">{</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 96px<span class="token punctuation">;</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="为什么-displaytable-cell-却可以无视行高？"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-displaytable-cell-%E5%8D%B4%E5%8F%AF%E4%BB%A5%E6%97%A0%E8%A7%86%E8%A1%8C%E9%AB%98%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么 display:table-cell 却可以无视行高？</h3>\n<p>那是因为对 table-cell 元素而言，vertical-align 起作用的是 table-cell 元素自身</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="544314733502826430" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<style>\n   .cell {\n      height: 128px;\n      display: table-cell;\n   }\n\n   .cell > img {\n      height: 96px;\n      vertical-align: middle;\n   }\n</style>\n<div class=&quot;cell&quot;>\n   <img data-src=&quot;1.jpg&quot; />\n</div>`, `544314733502826430`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.cell</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 128px<span class="token punctuation">;</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> table-cell<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.cell > img</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 96px<span class="token punctuation">;</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cell<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果图片并没有要垂直居中的迹象，还是紧贴着父元素的上边缘</p>\n<p>但是，如果 vertical-align:middle 是设置在 table-cell 元素上，图片就居中了</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42895732112913530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.cell {\n   height: 128px;\n   display: table-cell;\n   vertical-align: middle;\n}\n\n.cell > img {\n   height: 96px;\n}`, `42895732112913530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.cell</span> <span class="token punctuation">{</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 128px<span class="token punctuation">;</span>\n   <span class="token property">display</span><span class="token punctuation">:</span> table-cell<span class="token punctuation">;</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.cell > img</span> <span class="token punctuation">{</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 96px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>虽然就效果而言，table-cell 元素设置 vertical-align 垂直对齐的是子元素，但是其作用的并不是子元素，而是 table-cell 元素自身</p>\n<h2 id="vertical-align-和-line-height-之间的关系"><a href="#vertical-align-%E5%92%8C-line-height-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vertical-align 和 line-height 之间的关系</h2>\n<p>最明显的就是 vertical-align 的百分比值是相对于 line-height 计算的，实际是只要出现内联元素，这对好朋友一定会同时出现</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36863958199775260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n   .box {\n      line-height: 32px;\n   }\n\n   .box > span {\n      font-size: 24px;\n   }\n</style>\n<div class=&quot;box&quot;>\n   <span>\n      文字\n   </span>\n</div>`, `36863958199775260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.box > span</span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>\n      文字\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中有一个很关键的点，那就是 24px 的 font-size 大小是设置在<code class="language-text">&lt;span&gt;</code>元素上的，这就导致了外部<code class="language-text">&lt;div&gt;</code>元素的字体大小和<code class="language-text">&lt;span&gt;</code>元素有较大出入</p>\n<p>大家一定还记得图 5-16。这里也是类似的，<code class="language-text">&lt;span&gt;</code>标签前面实际上有一个看不见的类似字符的“幽灵空白节点”。看不见的东西不利于理解，因此我们不妨使用一个看得见的字符 x 占位，同时“文字”后面也添加一个 x，便于看出基线位置，于是就有如下 HTML：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39835018487058416000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;box&quot;>x<span>文字 x</span></div>`, `39835018487058416000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>文字 x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们可以明显看到两处大小完全不同的文字。一处是字母 x 构成了一个“匿名内联盒子”，另一处是“文字 x”所在的<code class="language-text">&lt;span&gt;</code>元素，构成了一个“内联盒子”。由于都受 line-height:32px 影响，因此，这两个“内联盒子”的高度都是 32px。下面关键的来了，对字符而言，font-size 越大字符的基线位置越往下，因为文字默认全部都是基线对齐，所以当字号大小不一样的两个文字在一起的时候，彼此就会发生上下位移，如果位移距离足够大，就会超过行高的限制，而导致出现意料之外的高度，如图 5-25 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-26-19-12-22-4e1d433802a2072efad5eb9be7c5d2bf-e07da.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 611px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 25.859247135842878%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5ElEQVQY02VPzWqEMBj0/V+ghz5BKfSwpdCz9FLoltJDG4uuqybR/Bk/rdWoiQ0uu5cdho+Bj2FmgiPvnj/obk8T9gughVR/wwBtq2vdm+klEo9v+DXRUkpjjHXOLktZ0sMh1loHX7m6C5Pbp899RAVnGBMAUEoRgo+U34c/N7v3hxDFcdx2Xd/3ta4xLlD0XeAiWDdMk2lq1QBIqXTTcCG4kNbZdaPbuF4huCjfavMIH1sxRstynmdrfU17FsvpujMuyVOe55TSwQ8GIIT4kYyxqqrSNEUIZVnmvxhjL8ZxPLn+AXxkFkCQ1l5jAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 26 19 12 22" title="" data-src="/static/2018-09-26-19-12-22-4e1d433802a2072efad5eb9be7c5d2bf-e07da.png" data-srcset="/static/2018-09-26-19-12-22-4e1d433802a2072efad5eb9be7c5d2bf-20936.png 200w,\n/static/2018-09-26-19-12-22-4e1d433802a2072efad5eb9be7c5d2bf-da2be.png 400w,\n/static/2018-09-26-19-12-22-4e1d433802a2072efad5eb9be7c5d2bf-e07da.png 611w" data-sizes="(max-width: 611px) 100vw, 611px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 5-25 非常直观地说明了为何最后容器的高度会是 36px，而非 line-height 设置的 32px。</p>\n<p>知道了问题发生的原因，那问题就很好解决了。我们可以让“幽灵空白节点”和后面<code class="language-text">&lt;span&gt;</code>元素字号一样大，也就是</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27539786680857813000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.box {\n   line-height: 32px;\n   font-size: 24px;\n}\n\n.box > span {\n}`, `27539786680857813000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">{</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.box > span</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>或者改变垂直对齐方式，如顶部对齐，这样就不会有参差位移了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="153448836740488480"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.box {\n   line-height: 32px;\n}\n\n.box > span {\n   font-size: 24px;\n   vertical-align: top;\n}`, `153448836740488480`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">{</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.box > span</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>搞清楚了大小字号文字的高度问题，对更为常见的图片底部留有间隙的问题的理解就容易多了。现象是这样的：任意一个块级元素，里面若有图片，则块级元素高度基本上都要比图片的高度高</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19454152139159773000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.box {\n   width: 280px;\n   outline: 1px solid #aaa;\n   text-align: center;\n}\n.box > img {\n   height: 96px;\n}`, `19454152139159773000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.box</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 280px<span class="token punctuation">;</span>\n   <span class="token property">outline</span><span class="token punctuation">:</span> 1px solid #aaa<span class="token punctuation">;</span>\n   <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">.box > img</span> <span class="token punctuation">{</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 96px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果.box 元素的高度可能就会像图 5-26 一样，底部平白无故多了 5 像素。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-26-19-18-54-527a73164886eaefeb41c7758ca5285a-68435.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 298px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 57.71812080536913%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB/klEQVQoz2P4+/fvLwT4/ePbl4/v3379/O7H1/ffP7/7/e3d3+/vv354++PbZ6AsXB1Q1////xkgrH///v398xvIf3h02oIsiSO9mg8XaZzpUN9Vo9oWpZplJrxiSj1Q9s/v3yCVYPugmoF8IAuoG0i+ODVxeyXf8U65W5NkL7bJTA2VcFUV5WZlrK0oBcr+/g2yAKgeu+bXZyefbhc+N0Hp9iKFJ7MU9sTLbQqQtxFhKy0pI6z58fHJx/pEbs5ROemhuCFKfomf3I5QpRhdnsrqCpCz/+DVfO9Y/+EGnova0ku1xCoMRLylBYI0RXSlGOsrSyF+RtH88+dPSND9+wf2883ZV1NUTrkaHejVv9mhd7DUYEeF4YpkhZOL2oCyf8EWADUDdYE0A70BZP389esnKKZ+f//6/uu7x18+P/3y7tndG6c/vrjz/+uLv5+e/vr6/s/fv0DFf8EkxPMMEJMgAOIEkAiY/PP33/tP3568eH320rVrN25fv3Hz2fPnl69cffLkGUQXw3908A+mFwqAlnz//h2YPr5+/foLTH779g2h+dmzZ48ePfr8+fOrV6/+/Pnz9u3b+/fvv3nz5ikMPH78GKjgw4cPQAVAZRCdUGcD5e7cufP8+fPr16//+PEDqOLWrVtAE2+AwU0wuHz58sOHD2/fvg2UhWsGAFj7X8n+3wv4AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 26 19 18 54" title="" data-src="/static/2018-09-26-19-18-54-527a73164886eaefeb41c7758ca5285a-68435.png" data-srcset="/static/2018-09-26-19-18-54-527a73164886eaefeb41c7758ca5285a-43494.png 200w,\n/static/2018-09-26-19-18-54-527a73164886eaefeb41c7758ca5285a-68435.png 298w" data-sizes="(max-width: 298px) 100vw, 298px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-09-26-19-19-27-5240f874e0091bff046932b4d1beb179-3c965.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 290px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.758620689655174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAByklEQVQoz2P49+/fXyQA5P7///8fGEEAnIGpjOHHjx+/fv36/fv3r18/gQJv7h7d0ht6ZF78s50Jt1bFX5wfd3pe/NzCkBU9hZ+/fAJqgyj++fMnUD8DhALZ8Pc3kHxzffWafJY9DSK3JwpdahJamSTgpc0ty8Xga6Xz6fMXkDKwYkzNf4DkhzubT3ZKnuxQuTFL5dEClT25ynPdlOxlhIwNzL5+/QrXDLQfi+a3Nzed6hS/uljlRqvS7XqlE5nyJyOUptqLuVmafvryhYDm51c2758kc6Nac7e8ar2ucpK2QompUpCRuJOL9efPeDT/A2m+d3HRqWKecyJiG/xFt6aKtJsLFNsLZZqxl/kbfv2C4WxgaP8Ggz9/fv/6/f/Wld2P1nU+XNF7eVfX25Ndbw/1fDzc83JXx5O9s398+/rn71+wyj/QAAOGPpADj23kGIbHM0QEogZIQvSD4hmI379/f+bMmWfPnj169Pjp0yd///w+c+rU/fv37ty+dfnSxdOnTl65fOnqFRB4+fLl1atXP3/+DDELpPnbt2/Pnz//+PHjq1evgGygKNAgoIlv3rwBMh4+fAiUBWp7+vQpUOTRo0ffv3+HaAYAiGAih/2NWq8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 09 26 19 19 27" title="" data-src="/static/2018-09-26-19-19-27-5240f874e0091bff046932b4d1beb179-3c965.png" data-srcset="/static/2018-09-26-19-19-27-5240f874e0091bff046932b4d1beb179-6d0bb.png 200w,\n/static/2018-09-26-19-19-27-5240f874e0091bff046932b4d1beb179-3c965.png 290w" data-sizes="(max-width: 290px) 100vw, 290px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>当前 line-height 计算值是 20px，而 font-size 只有 14px，因此，字母 x 往下一定有至少 3px 的半行间距（具体大小与字体有关），而图片作为替换元素其基线是自身的下边缘。根据定义，默认和基线（也就是这里字母 x 的下边缘）对齐，字母 x 往下的行高产生的多余的间隙就嫁祸到图片下面，让人以为是图片产生的间隙，实际上，是“幽灵空白节点”、line-height 和 vertical-align 属性共同作用的结果</p>\n<p>解决方法如下：</p>\n<ol>\n<li>图片块状化。可以一口气干掉“幽灵空白节点”、line-height 和 vertical-align。</li>\n<li>容器 line-height 足够小。只要半行间距小到字母 x 的下边缘位置或者再往上，自然就没有了撑开底部间隙高度空间了。比方说，容器设置 line-height:0。</li>\n<li>容器 font-size 足够小。此方法要想生效，需要容器的 line-height 属性值和当前 font-size 相关，如 line-height:1.5 或者 line-height:150% 之类；否则只会让下面的间隙变得更大，因为基线位置因字符 x 变小而往上升了。</li>\n<li>图片设置其他 vertical-align 属性值。间隙的产生原因之一就是基线对齐，所以我们设置 vertical-align 的值为 top、middle、bottom 中的任意一个都是可以的。</li>\n</ol>\n<h3 id="内联特性导致的-margin-无效的案例"><a href="#%E5%86%85%E8%81%94%E7%89%B9%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84-margin-%E6%97%A0%E6%95%88%E7%9A%84%E6%A1%88%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内联特性导致的 margin 无效的案例</h3>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="11232110718454580000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<div class=&quot;box&quot;>\n   <img data-src=&quot;mm1.jpg&quot; />\n</div>\n<style>\n   .box > img {\n      height: 96px;\n      margin-top: -200px;\n   }\n</style>`, `11232110718454580000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mm1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.box > img</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 96px<span class="token punctuation">;</span>\n      <span class="token property">margin-top</span><span class="token punctuation">:</span> -200px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，按照理解，-200px 远远超过图片的高度，图片应该完全跑到容器的外面，但是，图片依然有部分在.box 元素中，而且就算 margin-top 设置成-99999px，图片也不会继续往上移动，完全失效。其原理和上面图片底部留有间隙实际上是一样的，图片的前面有个“幽灵空白节点”，而在 CSS 世界中，非主动触发位移的内联元素是不可能跑到计算容器外面的，导致图片的位置被“幽灵空白节点”的 vertical-align:baseline 给限死了。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-19-31-30-38c432b955390f218fa6b4e7f09ef699-4fab5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 402px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 35.820895522388064%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABRUlEQVQY02P4DwP//v0FkvdOLDm5KPHVvoJba3K2Ts5Y0Jz7/s2Lr99+vHnz5t279x8+fHj1Gsh8+/cvSDEDQvPfP0Dy1ubcnaVMt2dIHC4TjtfiUBXjv3zp0oePn96+fffly1cg+PDxIxBhaP4H0vxwT8X5KaLXm9WPFypt8ZMLNlI6fPIMWPbffwzAAJH48+f379+/gPJXtuefDOZcayBVbCiSpifgYyxx8+YNoJqfP39CbEPX/PvP718g+Ov7r7+3j8y81ZhxaXnhndUF5xbknpxb9OnV038gzT9+/f6Nrhnoje9g8OfPn1+/fv35AzL+HxhBwLdv3z5//gzUCVQAtByoBqgFKAgkGR4/fvzw4cO7d+8C9b9+/frdu7dvXr9++xYYtu9evHj+8uWLZ0+f3bhx49WrVy/BABjWQO79+/eBJACf92jyDvAbZwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 19 31 30" title="" data-src="/static/2018-10-09-19-31-30-38c432b955390f218fa6b4e7f09ef699-4fab5.png" data-srcset="/static/2018-10-09-19-31-30-38c432b955390f218fa6b4e7f09ef699-6bdb3.png 200w,\n/static/2018-10-09-19-31-30-38c432b955390f218fa6b4e7f09ef699-9ead5.png 400w,\n/static/2018-10-09-19-31-30-38c432b955390f218fa6b4e7f09ef699-4fab5.png 402w" data-sizes="(max-width: 402px) 100vw, 402px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>因为字符 x 下边缘和图片下边缘对齐，字符 x 非主动定位，不可能跑到容器外面，所以图片就被限死在此问题，margin-top 失效。</p>\n<h3 id="text-alignjusitfy-声明"><a href="#text-alignjusitfy-%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>text-align:jusitfy 声明</h3>\n<p>text-align:jusitfy 声明可以帮助我们实现兼容的列表两端对齐效果，但是 text-align:jusitfy 两端对齐需要内容超过一行，同时为了让任意个数的列表最后一行也是左对齐排列，我们需要在列表最后辅助和列表宽度一样的空标签元素来占位，类似下面 HTML 代码的<code class="language-text">&lt;i&gt;</code>标签</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="10036609467555336000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<style>\n   .box {\n      text-align: justify;\n   }\n   .justify-fix {\n      display: inline-block;\n      width: 96px;\n   }\n</style>\n<div class=&quot;box&quot;>\n   <img data-src=&quot;1.jpg&quot; width=&quot;96&quot; />\n   <img src=&quot;1.jpg&quot; width=&quot;96&quot; />\n   <img src=&quot;1.jpg&quot; width=&quot;96&quot; />\n   <img src=&quot;1.jpg&quot; width=&quot;96&quot; />\n   <i class=&quot;justify-fix&quot;></i>\n   <i class=&quot;justify-fix&quot;></i>\n   <i class=&quot;justify-fix&quot;></i>\n</div>`, `10036609467555336000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">text-align</span><span class="token punctuation">:</span> justify<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.justify-fix</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 96px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>96<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>96<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>96<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>96<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>justify-fix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>justify-fix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>justify-fix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>空的 inline-block 元素的高度是 0，按照通常的理解，下面应该是一马平川，结果却有非常大的空隙存在，如图 5-29 所示</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-19-39-18-fce4885f9952987ce5fb93a9be0a2713-235d7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 777px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.027027027027025%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABOklEQVQY0yWOvUvDQADF46Li0sG/xw8wqIOLiyiCk6uIDroIhlZwqJRSigWrqQGhbai1kmItohSHQgdBdBB0UaumtZrv3F3uzpzRvuFNvx/vca1bqb4zcpwRP+7lRmw4n0qoD+WbJH8U3WCM+Yw1a0I1MlZVKq1G7CIyWpYLX3fiZWToVEpz75VwdqonExVerxLF6f79rfW3+qEyE0quzLH/PKZn9yb6SlnpJb8sTg7kxF31LJwZ783GBa5Z2y4thlLCmg1Zu/3d0QxdB5rmuAAyPxhmT/KCND+YO0h7hGmaZbnINKBmOBBh7rMuna/yihjvWJ7aMZtqAEAb+S6kXfm5sFlc4q8rJ8Bjpu6atmfZXuADgDlCfUgoQsi0bAdAx4VBm5aDMe3exohCAAkmdnAGogD4Ix1A6M8v+snqZCQ1QHkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 19 39 18" title="" data-src="/static/2018-10-09-19-39-18-fce4885f9952987ce5fb93a9be0a2713-235d7.png" data-srcset="/static/2018-10-09-19-39-18-fce4885f9952987ce5fb93a9be0a2713-ce076.png 200w,\n/static/2018-10-09-19-39-18-fce4885f9952987ce5fb93a9be0a2713-4e776.png 400w,\n/static/2018-10-09-19-39-18-fce4885f9952987ce5fb93a9be0a2713-235d7.png 777w" data-sizes="(max-width: 777px) 100vw, 777px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>为了便于大家看个究竟，我把占位<code class="language-text">&lt;i&gt;</code>元素的 outline 属性用虚外框标示一下，此时效果如图 5-30 所示。</p>\n<p>结果发现，上面巨大的空隙是由占位<code class="language-text">&lt;i&gt;</code>元素上面和下面的间隙共同组成的。</p>\n<p>很多时候，复杂问题是由简单问题组合而成的。实际上，这里的间隙现象和上面的图片间隙现象本质一样，都是 vertical-align 和 line-height 共同作用的结果。</p>\n<p>按照之前解决问题的方法，我们可以直接给.box 元素来个 line-height:0 解决垂直间隙问题，结果，这样设置之后的效果却如图 5-31 所示。图片和图片之间的间隙是没有了，但是图片和最后的占位元素之间依然有几像素的间距，真有些让人抓狂了。这究竟是为什么？</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-19-44-25-172e91efc4b0553fe164efc6c29ec5fb-6db8f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 383px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.958224543080945%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACNUlEQVQozzXNX0hTURwH8EkvIkS1FFkERbB66MUQhCwJpRzYS72ULTIaLgifRhRBD0IFZUElQ2m1etDoQXoQqY3WaAvNZU1HFKmN1bxtd7t/d8+95557zr1ut6Osw+/8+J0ffL7HYds28y3KzAX5L+HUdPBTZMqq2aXsQi45KqXDmchY4vVzCLEiMCuJoJR+tpoIxV4FBZah0EFv5uW5+Ttbsg9dgbaG010dqmkvR28nhhvy47see5qOuV2/1mRuJR672fg71Drja+50NsTfv6vjXNS/FGidPuN+0NnsO9UrITs3O7J4fWukf2+op8Xb4f7+RxZzH5ZuOZMX9kz07R44sC0ai9fxz4nBjyecU5f2jZx0Boc8ANv5+Sdf+w/ODB0du9j+6MrxIqtwTCrjPxQbPPLi8uF759tWM6k6Xpz0zd3dkX+6f7h3e+BsrwIJAJokCVCXsCohRQYQAxXJkqhCiUAZKeK6adZx9o0/c78lfcM92rXT2+cRANZ0E0BTgVZlswCNo6XTYeMpa6ZpVet4eWpgtrtpvNt1tb3xmrdHVOg/WK7oFYUW2ugaVoDxf6PLMiTEqmPtR7I4E+YXJvOxcPHzW0yqGGIkq6iiIVmj3azWLGIRgEzVICoiwKiam5jneUmqaNCgYZZVw2TdJERHuoGxgQ1iEoSQKApsiS2yxUKhUObKLMsyDEP3DkEQOK4siiIhWNehIPAAAJpI9zzHqQCoqloqlahboyefp/Ivw9CR4n/L68/Fj8K5ywAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 19 44 25" title="" data-src="/static/2018-10-09-19-44-25-172e91efc4b0553fe164efc6c29ec5fb-6db8f.png" data-srcset="/static/2018-10-09-19-44-25-172e91efc4b0553fe164efc6c29ec5fb-89fca.png 200w,\n/static/2018-10-09-19-44-25-172e91efc4b0553fe164efc6c29ec5fb-6db8f.png 383w" data-sizes="(max-width: 383px) 100vw, 383px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这就要理解 inline-block 元素和基线 baseline 之间的一些关系</p>\n<h2 id="深入理解-vertical-align-线性类属性值"><a href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-vertical-align-%E7%BA%BF%E6%80%A7%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入理解 vertical-align 线性类属性值</h2>\n<h3 id="inline-block-与-baseline"><a href="#inline-block-%E4%B8%8E-baseline" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>inline-block 与 baseline</h3>\n<p>vertical-align 属性的默认值 baseline 在文本之类的内联元素那里就是字符 x 的下边缘，对于替换元素则是替换元素的下边缘。但是，如果是 inline-block 元素，则规则要复杂了：一个 inline-block 元素，如果里面没有内联元素，或者 overflow 不是 visible，则该元素的基线就是其 margin 底边缘；否则其基线就是元素里面最后一行内联元素的基线。</p>\n<p>两个同尺寸的 inline-block 水平元素，唯一区别就是一个是空的，一个里面有字符，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71753289802387735000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n   .dib-baseline {\n      display: inline-block;\n      width: 150px;\n      height: 150px;\n      border: 1px solid #cad5eb;\n      background-color: #f0f3f9;\n   }\n</style>\n<span class=&quot;dib-baseline&quot;> </span>\n<span class=&quot;dib-baseline&quot;>\n   x-baseline\n</span>`, `71753289802387735000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.dib-baseline</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #cad5eb<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #f0f3f9<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dib-baseline<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dib-baseline<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   x-baseline\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-19-48-40-77657a922b0cef8d20d2df9b03922b50-9bee3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 28.19277108433735%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAAtklEQVQY022P6w6DIAyFff+XHH/UqFis3KxQWOc0MZsnEE7S9nylqbVyKRtlOVlcqf/aM9uQfEzMpV4N0trIkzKblQBpT1yfJLmAcbHEt+xzWIjoaPU7oNOwEOVfcmLrP+QZUAMK7ByWK3l8LGzW0E+4OjpKN33LtcxLGMGHLYln5uZOoFT9Jv9/Xl7kt2xDpv0iI2Lf98YYMW3bqpeapmk8FGMchsFaq5Tqus45BwDSprVuD70BlPdd/Zopu5AAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 19 48 40" title="" data-src="/static/2018-10-09-19-48-40-77657a922b0cef8d20d2df9b03922b50-fee1c.png" data-srcset="/static/2018-10-09-19-48-40-77657a922b0cef8d20d2df9b03922b50-a67b7.png 200w,\n/static/2018-10-09-19-48-40-77657a922b0cef8d20d2df9b03922b50-0b187.png 400w,\n/static/2018-10-09-19-48-40-77657a922b0cef8d20d2df9b03922b50-fee1c.png 800w,\n/static/2018-10-09-19-48-40-77657a922b0cef8d20d2df9b03922b50-9bee3.png 830w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>你会发现，明明尺寸、display 水平都是一样的，结果两个却不在一个水平线上对齐，为什么呢？上面的规范已经说明了一切。第一个框里面没有内联元素，因此基线就是容器的 margin 下边缘，也就是下边框下面的位置；而第二个框里面有字符，纯正的内联元素，因此第二个框就是这些字符的基线，也就是字母 x 的下边缘了。于是，我们就看到了左边框框下边缘和右边框框里面字符 x 底边对齐的好戏。</p>\n<p>同情境模拟，我们也设置右边框的 line-height 值为 0，于是就有所图 5-33 所示的表现。</p>\n<p>因为字符实际占据的高度是由 line-height 决定的，当 line-height 变成 0 的时候，字符占据的高度也是 0，此时，高度的起始位置就变成了字符内容区域的垂直中心位置，于是文字就有一半落在框的外面了。由于文字字符上移了，自然基线位置（字母 x 的底边缘）也往上移动了，于是两个框的垂直落差就更大了。</p>\n<p>紧接着上面的复杂例子，如果我们在最后一个占位的<code class="language-text">&lt;i&gt;</code>元素后面新增同样的 x-baseline 字符，则结果如图 5-34 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-19-53-10-e4c1d75fab7c4f8b0b5297174d3e4a09-8e7aa.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 362px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.011049723756905%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACrUlEQVQoz0WSW0gUYRTHt4ckCLrI6pahgqmkVFBgPpRYRiBiBGVQrNJDIFGBgg9FDykYJOVT+VBEGZVtapm1dBNd87beW7dds71o7uzMOjv3++zszOz0zRJ0OPz5f993fudw4LNE/S5k/gXjf7M2/Xru00sKj6tqMjQ7gC31kF7H7/FXi0NvZTkp8VTQ7SB9DnzJ4Rt57pv8ahiGZaH77HhbxlrX7s7aHYesGS7XhCJzQ+0li/e3r9zb1VS2pWJfbiTGEFHvl1vZyw+tP1ptFwo3nT9VYcLBjw3eDttcS+GHc/kXS7Odw1Ngiqe73Hcnz91c1FOdU1e+PxBlaMTneVTsb9s7cb2462jWpTM1yZRhCTgaZiqznlTl3z6ec6XSNj3pFhLcQmvp9/JtnRWZzYe3Np4siCA0hnoXrmYPHdl595j12sHNN+pP6ACef2wfbcoMdBUONuW319h+zU2Kmo5MOdfH+rDlgdhsPzTjpBmJZklk9F3E3Y/73sPuvpjHlQKwv7d+9kFW9GnRs7rcsj3Wb8Njqm7QCZ3XDE4xeNVMVkyygsrrpueSpkqaYe68Mmj3tGQ66/K6q3PsB6yfR8bBLSfIvJBgeYlJJysoZv7zEsNJvJgw4YDjsrsqt9de0nG64GZtwfToSJwU1v/ACIJThEDhPEWwNC8zrJz2HDiSOMcxYiqVsshwmA97VPSngfiUtSU6jqIYHocRCsNVMaGKsirJqqZrqp72CU1SVElRBMkwUhYwPQrH4gS9QTA0y6d0TVESoiSKkiSIgiCKnMCDb8NxHAzDsY2NCAShcdRIhwnjWJwggKAMTYmigOM4QRA0RSEIEgwGoUgEYBAEhUMhv9+/urqKYdh/GIQsy1S6GtSBN5IkgYIu0XQEAoFQKBQOhwHMMAyoBwsD/QvNpClhGnyrZwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 19 53 10" title="" data-src="/static/2018-10-09-19-53-10-e4c1d75fab7c4f8b0b5297174d3e4a09-8e7aa.png" data-srcset="/static/2018-10-09-19-53-10-e4c1d75fab7c4f8b0b5297174d3e4a09-acee0.png 200w,\n/static/2018-10-09-19-53-10-e4c1d75fab7c4f8b0b5297174d3e4a09-8e7aa.png 362w" data-sizes="(max-width: 362px) 100vw, 362px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>现在行高 line-height 是 0，则字符 x-baseline 行间距就是-1em，也就是高度为 0，由于 CSS 世界中的行间距是上下等分的，因此，此时字符 x-baseline 的对齐点就是当前内容区域（可以看成文字选中背景区域，如图 5-35 所示，截自 Firefox 浏览器）的垂直中心位置。由于图 5-34 中的 x-baseline 使用的是微软雅黑字体，字形下沉明显，因此，内容区域的垂直中心位置大约在字符 x 的上面 1/4 处，而这个位置就是字符 x-baseline 和最后一行图片下边缘交汇的地方</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-19-54-45-b96d4f26982b5d6f61d502988f5060fa-1e4d6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 420px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.904761904761905%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAA/UlEQVQY06WOu0oEMRSG56WsLCwFa9lOFlt7bXwEsRNsfAvBR1jsRMX1gsuwk5lJMpOwkSQzyebm2SlkYUUFf5KTnMuXP1na1FIFo9MflK0nMUaIl8f7p0djREVNBSK8Jpw0AjeLMHR/ga9GWwe7O/m8nOf50/T1ZYZmBXnLq+/h+FUdLheH2yfjvQlKN/d8Wi31Ry8XWknrw4/OKxx2eff+8Hg2See36fo5ONUZ2ZnObBinzBgjpez73jkHX/AeDKJftUL01nbShRBShCKccYgwo7W21mZCiKIoMMbwhFKKUlqViDPWMA6rqnHbts0gzjkwhBDGGCCQZukf+gQ3z8UvbFFK5gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 19 54 45" title="" data-src="/static/2018-10-09-19-54-45-b96d4f26982b5d6f61d502988f5060fa-1e4d6.png" data-srcset="/static/2018-10-09-19-54-45-b96d4f26982b5d6f61d502988f5060fa-5f5a6.png 200w,\n/static/2018-10-09-19-54-45-b96d4f26982b5d6f61d502988f5060fa-fe3d6.png 400w,\n/static/2018-10-09-19-54-45-b96d4f26982b5d6f61d502988f5060fa-1e4d6.png 420w" data-sizes="(max-width: 420px) 100vw, 420px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>理解了 x-baseline 的垂直位置表现，间隙问题就很好理解了。由于前面的<code class="language-text">&lt;i class=&quot;justify-fix&quot;&gt;&lt;/i&gt;</code>是一个 inline-block 的空元素，因此基线就是自身的底部，于是下移了差不多 3/4 个 x 的高度，这个下移的高度就是上面产生的间隙高度。</p>\n<p>好了，一旦知道了现象的本质，我们就能轻松对症下药了！要么改变占位<code class="language-text">&lt;i&gt;</code>元素的基线，要么改造“幽灵空白节点”的基线位置，要么使用其他 vertical-align 对齐方式。</p>\n<ol>\n<li>改变占位<code class="language-text">&lt;i&gt;</code>元素的基线。这个很简单，只要在空的<code class="language-text">&lt;i&gt;</code>元素里面随便放几个字符就可以了。例如，塞一个空格<code class="language-text">&amp;nbsp</code>;</li>\n<li>改造“幽灵空白节点”的基线位置可以使用 font-size，当字体足够小时，基线和中线会重合在一起。什么时候字体足够小呢？就是 0。于是，如下 CSS 代码（line-height 如果是相对 font-size 的属性值，line-height:0 也可以省掉），看上去好像效果类似，都是没有间隙，但是 font-size:0 下的各类对齐效果都更彻底。</li>\n<li>使用其他 vertical-align 对齐方式就是让<code class="language-text">&lt;i&gt;</code>占位元素 vertical-align:top/bottom 之类，当前，前提还是先让容器 line-height:0</li>\n</ol>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-19-58-24-1f3aec874afd30455a52c23c5836606e-7320c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 367px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.59128065395095%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACQUlEQVQozz1RS0hUYRS+CzcuSjDRwR5CmrpManB6IA4ZVMNEUEm1iCChhQm1qRbhqlU+MnpI6BhMiBYKMbuIAgebDGccZ2qchzij5TTemvv87/u//z3dq9DH4XDenO8cCsBii1mxGFfpJLcRp/MpAiAL5fLGkkonpFJiKxeVeNYCKG+mxd9OkF2P/d3IGoZBAZDIq/OLg/Xppy13vbXdXjcyYG1h8kO/qzDePNPX2NFQGZqZAYDPI6ejw3tTT1r6Tu654fdijCkg5sq0L/G4bunBwTFvjd9zuKzAZmwyNlKXetQ419N4dX/lePCd3RwPdn0fqI/eOzTaUXOlq1PWDYqAmQ74572uZ50H7h+vuX3BzSmQj00sXKqYdu962L77YgM1OzVpAkQH3XPtFcOeqt5Wqtd/RNW31/46cC58pzY51BS4Xvv8pkdQCFPMFGYDhS/BX5Hg6scxurAqGqQ4/34tNF5cfJP/NPHzW0jf4bz02hcfda2/aOo/UX3KfZQVVaQRCUAyHVEtQBoWkI4wSJYTkQloAM7BLGL+mDobu1X91r9v6FhVd0cbzatI1nlR4ZEqINXWvKQJks7v2EjlkIIU3Wm2Oa+OXov4Wmd72kYuN7/sPcMjTeRlfosV/nACzfM0K4qKqGCB5vgtznbtFGJEQ9fttYGIIpYYC3OglEFmLRvEMu3RqmZibBoG3gbB2DLthGlhE4i182cHdr2tV7K5VDqby+VKpZIgCJlMOpPJJJLJ5eV4OBxmGOZ/JWxz/gddF8hHWXYRRwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 19 58 24" title="" data-src="/static/2018-10-09-19-58-24-1f3aec874afd30455a52c23c5836606e-7320c.png" data-srcset="/static/2018-10-09-19-58-24-1f3aec874afd30455a52c23c5836606e-3f7ac.png 200w,\n/static/2018-10-09-19-58-24-1f3aec874afd30455a52c23c5836606e-7320c.png 367w" data-sizes="(max-width: 367px) 100vw, 367px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-20-00-01-19838cb39cb96e94975f91962a82b022-bf330.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 347px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 57.06051873198847%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACSklEQVQoz6WRW0gUYRiGJygqEjQPER087aIFRTfVQnQVXYbBgqipCVaioYEoWpgpFlIXKSapbSeUILsTjwlSEbk07qpQdNrGvZgdd91qTv/M/HPama9xLei+l4ePnwdePj5+QqAXxq/lfB10+7sKK46lNVcXawAh/8jk1V2Ur3CmtaDo4I7ezlYAWB7rmG3LWnlw4HlDwen87VMvhgnEvCd793wbyP7YlttxOOXc2SLFhkhgmOzJWhl0LTW7al1bmxqbnPL32fZATzrV75qvc3t3b/Y9ekxwUXK5I/vVqZzbJ7MbjqTWV3nlBFCBh4G6bRMnMm95Ms7nEjdartgAn162Biu2jHoyuzwZ3r3EyFMfwa+Rbyr3z9fnzrXk+0rTR9tLJANiobnP1yuD9y7O36+Z6C4LTg5jgMjCsw8t5YtDl97114zdLA0HXxNihJzp3Bd6krfY7So7lHK5vFjWbKSYyALZAh0gAYANS5A0pFqSDUpSmgAWgHMzuTSQ9+WOm2wsuOvJqi4pEVVLlFQBYRE5U+URdpqirDvyr1E5EetGgmBj/oXa1OmjOzuPp10o3NRcdUZU1vcISBekf1k3PNJ4Sd9ANy1ClyLx0b7o9AD7digy1RfzjxsJMBRV+8VrnOigsoKOcMICQ8KGIJmiZAgy/smaWCUgGZZHnCArqoE1I2GaiiKrGOuapqkOqvPAisKx7CrDrK3FHDZahG07v2BHGYaJ0KsMLQicpunxeJzjOIQQy3Lx+A8+GZqmQ6FQOBymKOpPGf4jvwGP6/Z+SNleXwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 20 00 01" title="" data-src="/static/2018-10-09-20-00-01-19838cb39cb96e94975f91962a82b022-bf330.png" data-srcset="/static/2018-10-09-20-00-01-19838cb39cb96e94975f91962a82b022-637d1.png 200w,\n/static/2018-10-09-20-00-01-19838cb39cb96e94975f91962a82b022-bf330.png 347w" data-sizes="(max-width: 347px) 100vw, 347px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>准确了解 inline-block 与 baseline 之间多变的关系，除了便于理解一些令人抓狂的现象外，还可以专门利用其来简化我们的开发，比方说一直很头疼的背景小图标和文字对齐的问题。我这里再给大家介绍一个 vertical-align 负值以外的其他处理技巧。</p>\n<p>例如，要删除一个小图标，通常的做法无非是下面两种：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24492852396769790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<i class=&quot;icon-delete&quot;></i> 删除`, `24492852396769790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon-delete<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span> 删除</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或者直接一个按钮图标，里面包含文本内容，保证可访问性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89462389169194390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<i class=&quot;icon-delete&quot;>删除</i>`, `89462389169194390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon-delete<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>而以上两种实现基本上图标元素的基线都是元素的下边缘，之前讲过 inline-block 元素的基线规则：一个 inline-block 元素，如果里面没有内联元素，或者 overflow 不是 visible，则该元素的基线就是其 margin 底边缘。</p>\n<p>第一种做法中，<code class="language-text">&lt;i class=&quot;icon-delete&quot;&gt;&lt;/i&gt;</code>是一个空标签，里面无内联元素，因此，基线是底边缘；而第二种做法中，虽然里面有文字，但是此文字是不显示的，因此开发者习惯设置 overflow:hidden，这又导致基线是底边缘。而正是由于基线是元素底边缘，才导致图标和文字默认严重不对齐, 但是，我们不妨反过来试想下，如果图标和后面的文字高度一致，同时图标的基线和文字基线一样，那岂不是图标和文字天然对齐，根本就不需要 margin 或 vertical-align 的垂直偏移了？</p>\n<p>基于 20px 图标对齐的处理技巧，该技巧有下面 3 个要点。</p>\n<ol>\n<li>图标高度和当前行高都是 20px。</li>\n<li>图标标签里面永远有字符</li>\n<li>图标 CSS 不使用 overflow:hidden 保证基线为里面字符的基线，但是要让里面潜在的字符不可见。</li>\n</ol>\n<p>于是，最终形成的最佳图标实践 CSS 如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74678481916598700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.icon {\n   display: inline-block;\n   width: 20px;\n   height: 20px;\n   background: url(sprite.png) no-repeat;\n   white-space: nowrap;\n   letter-spacing: -1em;\n   text-indent: -999em;\n}\n\n.icon:before {\n   content: \'\\3000\';\n}\n\n/* 具体图标 */\n.icon-xxx {\n   background-position: 0 -20px;\n}`, `74678481916598700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.icon</span> <span class="token punctuation">{</span>\n   <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>sprite.png<span class="token punctuation">)</span></span> no-repeat<span class="token punctuation">;</span>\n   <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>\n   <span class="token property">letter-spacing</span><span class="token punctuation">:</span> -1em<span class="token punctuation">;</span>\n   <span class="token property">text-indent</span><span class="token punctuation">:</span> -999em<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.icon:before</span> <span class="token punctuation">{</span>\n   <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'\\3000\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* 具体图标 */</span>\n<span class="token selector">.icon-xxx</span> <span class="token punctuation">{</span>\n   <span class="token property">background-position</span><span class="token punctuation">:</span> 0 -20px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-20-10-58-8ac3891d07646689b03d26cceb92e0b1-f1634.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 395px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.88607594936708%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABXklEQVQoz21SXXeCMAz1//+p7cXnAQVkFAFR8IO2QKHIQGFXqriH5Rx62uTeJDdhNU3TDTbcxnGc/tj9fh9mQ3CcbfFoJzArfGVZ5nlOKXU3G9txTNPcuG4cx0o1SqnL5RIEgeO4aZpdry08TdMIIZ7kuq677qeqJLJUVVUUhZSybVvdAkoOQ991Xd/3S18APMnI57jUMEkcRzN6fNEelzBKvgzr4/OTMbY432RdGfaSgwncoFDjlGoZ46fT6f/K0CBllez3NAi+ff9wOPiUplnGOEd0l6QWsdfrtWEYCEG/ZZF87uJJ5qLgXHDO50QSCpcOy1LmOUuzVIhC1jVGpTFvzcT2TJMQm8S7ne/7mJxeDFrVW9G5tBYYlD7IeGNPQOsJozgGDoXH4zHLsvP5DA+6xQUwnHDiiROpV8gdhiGgICBfkiRYLIpvt1vP86IoAkdfQEAU+7dt/A0OKv0CKgEyuzQrUF8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 20 10 58" title="" data-src="/static/2018-10-09-20-10-58-8ac3891d07646689b03d26cceb92e0b1-f1634.png" data-srcset="/static/2018-10-09-20-10-58-8ac3891d07646689b03d26cceb92e0b1-44417.png 200w,\n/static/2018-10-09-20-10-58-8ac3891d07646689b03d26cceb92e0b1-f1634.png 395w" data-sizes="(max-width: 395px) 100vw, 395px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>可以看到，小图标和文字对齐完全不受 font-size 大小的影响。可以说，整个网站所有小图标的对齐问题都可以解决了，节省了大量 CSS 代码，降低了大量开发和维护成本，是个好处非常明显的处理技巧。</p>\n<h3 id="了解-vertial-aligntopbottom"><a href="#%E4%BA%86%E8%A7%A3-vertial-aligntopbottom" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 vertial-align:top/bottom</h3>\n<p>顾名思义，vertial-align:top 就是垂直上边缘对齐，具体定义如下</p>\n<ul>\n<li>内联元素：元素底部和当前行框盒子的顶部对齐</li>\n<li>table-cell 元素：元素底 padding 边缘和表格行的顶部对齐。</li>\n</ul>\n<p>用更通俗的话解释就是：如果是内联元素，则和这一行位置最高的内联元素的顶部对齐；如果 display 计算值是 table-cell 的元素，我们不妨脑补成<code class="language-text">&lt;td&gt;</code>元素，则和<code class="language-text">&lt;tr&gt;</code>元素上边缘对齐。</p>\n<p>已知一个<code class="language-text">&lt;div&gt;</code>元素中有两张图片，其中后面一张图片设置了 vertial-align:bottom，请问这两张图片的底边缘是对齐的吗？</p>\n<p>不是对齐的。因为图片所在行框盒子的最低点是“幽灵空白节点”的底部，所以最后的表现会如图 5-39 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-20-19-21-a3b1e1f282bfcabef8d36a4decf8ad3d-4a888.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 287px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.35540069686411%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACa0lEQVQoz42Q70sTcRzH/Q/S2pyeu23eBf4YkhoENbMsemCtRlk9CSooetSTyAepZKYElQyaoERGJQnRb0zHxH6BpEZr6m677c616bbb5jZ3c987d5vb3XWm9KQnvfl8nrzhxef9/hSIophJA6/NTH7/QHvGaGIsio0C0kxOjji/mel4mEnRHJuQJs2s5NJ0GiTAaiKbSfOCUCCIIpsMjHYir67LFh5CuBEav6boapHpK7Zd2it73lr9pqOGHKrzPK6f6qkdubmrXV/dbqhZIOzS1Q2YA6EffTVfu2GXCfH2I59aNW06SFsiK4eK39+APt+GHCbYY4S/tJZd1ckRWSFaumN+bm4LXktRjgHtnEnlfoLEhhCyE508qx48rKxXyS09mnljuX2gPPwSxbrV5hbVnX0QKlfYZv/A0jKr1JSpav4pbD+tebFb2XccHmxS3jtStkdb/K5D5RrWuLuQmTNqyxX1uEH91gDvryyx2v7CyeB0P4odkn9UKwaOKS7DhfqdRc2VRY1V21/fgp1tmmkY7q1VXkRLDWjJCW2xtkJh24QFQWSZEPaomTjVYOlo8A43uXoP2o2NMz0HJtp0U/cRvE41ehSauaucuKB8dh4ePAc9OAkv4bObsJDL5QRR4MU8L/B5Pr+eXxdF6RWSckzEsbZojfutbNiaWbYJkZ98yJoN2DIsEDZjcxzn9/tTKRCPxWma5nk+tKFwOBwJLa8kWS6RZOMJJhJfjSXZBOCWV1KZbHarMwAAx/FoNOrz+SiKkoIQBIFhmNvtJkmCCgacDsyFOz2eBYoKLi0t+ry/GAC24P+R1O5f8zcmR8jfY1Tb9gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 20 19 21" title="" data-src="/static/2018-10-09-20-19-21-a3b1e1f282bfcabef8d36a4decf8ad3d-4a888.png" data-srcset="/static/2018-10-09-20-19-21-a3b1e1f282bfcabef8d36a4decf8ad3d-09aba.png 200w,\n/static/2018-10-09-20-19-21-a3b1e1f282bfcabef8d36a4decf8ad3d-4a888.png 287w" data-sizes="(max-width: 287px) 100vw, 287px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="vertial-alignmiddle-与近似垂直居中"><a href="#vertial-alignmiddle-%E4%B8%8E%E8%BF%91%E4%BC%BC%E5%9E%82%E7%9B%B4%E5%B1%85%E4%B8%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vertial-align:middle 与近似垂直居中</h3>\n<p>line-height 和 vertial-align: middle 实现的多行文本或者图片的垂直居中全部都是“近似垂直居中”，原因与 vertial-align:middle 的定义有关。</p>\n<ul>\n<li>内联元素：元素的垂直中心点和行框盒子基线往上 1/2 x-height 处对齐。</li>\n<li>table-cell 元素：单元格填充盒子相对于外面的表格行居中对齐。</li>\n</ul>\n<p>vertial-align:middle 可以让内联元素的真正意义上的垂直中心位置和字符 x 的交叉点对齐</p>\n<p>基本上所有的字体中，字符 x 的位置都是偏下一点儿的，font-size 越大偏移越明显，这才导致默认状态下的 vertial-align:middle 实现的都是“近似垂直居中”。</p>\n<p>为了更直观地表示上面的解释，其中，图片上线显示的是图片垂直中心位置，而贯穿整个容器的线就是容器的垂直中心位置，可以看到，默认状态下，两根线就不在一个水平线上，如图 5-40 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-20-24-50-0d1772eba8b15c05a626f74545b370a6-d82ed.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 303px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 57.42574257425742%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACD0lEQVQoz21Rv2sUQRROZafxMKJJLqciisRIimBlIVjEiK0Qy9wfIIJgIWihUQuRYDQpUqiIIjamkbMJmkYPLtlV7lDOuDnxmD3vSHZ3dn7s7M7M7o5ziXoB8/GK997MN99733SpDVAmIeY+4T4Vrgvt+s+1JvDWgdMExAHuL9CoA+hTn4j2HcIxFalSXX/JwsOhhwIs1WrxyYvL2dKj4fqz4dLdE/PXjl89f+TK2LHPn4xAKBcxSCJEeYfMwhgRiXBIpQKluYUbu5bvH6zN5szJ3J2zvSP9mb69PcWiIRPlYy0raSDVP7JLMHCdhrPWDOLvH6aLt3aXpg99mzuwci+3cHHg+VjfSHbP60LBCxlw1m3PafkwTdM/ZEhZC6KW5zmR+vp+ZnEq8+Xm4TeDA1Oj2Qensw9H+08N7Xv7bhFz2fT8lo8dTNP0v7GZUNbSbOnSDqN3/8tzPZMnM+NHuy8M7Twz2L30cVlsO7Y2zEUhRIEfKFArrN4eN6/nK/MT9qu89TRffTxhzuQb1orPUoiYhyJEthgmZCJkGomkHTpJVKybidIfoiVk2g4uE66PeMyFTpIOOY5jCKHgnDEWRWEsJfRcSjDBiBAcUBIElPMIYyylIIQIIdpja9PaOzNmmqZt24ZhAAAopbosl8u6rFarPzZQq9V007KsSqWilTo7a+hXkiTZTLZFvAWbkr8By9op6rLaRXsAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 20 24 50" title="" data-src="/static/2018-10-09-20-24-50-0d1772eba8b15c05a626f74545b370a6-d82ed.png" data-srcset="/static/2018-10-09-20-24-50-0d1772eba8b15c05a626f74545b370a6-828c4.png 200w,\n/static/2018-10-09-20-24-50-0d1772eba8b15c05a626f74545b370a6-d82ed.png 303w" data-sizes="(max-width: 303px) 100vw, 303px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>因为图片上的那根线趋向于和字符 x 的中心靠近，而不是容器的垂直中心。如果我们把 font-size 改大，如 48px，则效果更加明显，如图 5-41 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-10-09-20-25-55-60b24fc9ba9ec5cf948130335920d15b-8130d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 312px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.61538461538461%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACOElEQVQoz21RO0xTURjuyCAQUDEYKjZEoya6OTmrgy66ojFxInFx0BgjiwM4mDgYo4uDM0mJiRVjgiViUrQ1txQItLcp5ZJSyqW9PY97HvdxzvG0gIDxy3/+/MP3fed/RJRSUirKg93whK+UJxQNFZetzKQKlGJeSFnwlxYKqYUR/YSQAHsO5MAVdnU9OzNRTMe3lyfXM/Gt3KT5PT6XmKhubgE3aELeRJ6DPD8Qe2IpkesDyDBX1aXPEw87Z8dOlN/2/xrtez189Or5rmtDHVljPpCqCRnEPsD+AbGQDmZ1iB2mqitTqfH+1IuY+T62+Or0h9vROxf7ezu7Jz8mqnXQQLQOSR1SPwh3xaEQlUbdsmsVSE0j/mOsL/Nu0HgSNZ5GZ4YHpm6dvHnh+LPno9M/52oIWrZtbdvU4/ttYxJAzImv1he+zr4ZyN8/E4/FHl0avHduYOTyqbNDxxJfkgBx6PqoFUEQHFoYdyCBVFnmp98PjsxFexMjPYm7PS+vd43f6H58pWMlazChGoA0EXcQ359Zn8ql2s9zqQCgZhvTm/PJjfw3uJokxaRrJp3FadDQawkx8TDxEfH0rVpiKaUQreog5F6E7bwDTZOHEeGcp9Ppcrmcy+X0KJSSUrFglVerG5XNjcrK8tLSQi6XNbKGUSgU1tbWarVaJpNJpVIAgIj2c11XW1BKd7rYqcttlEqlfD5v27bmEEJ836eM6RohpH+KqP+BMVZsw7Is0zQxxu3VyH9ofwAGXGOD6M+NmQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 10 09 20 25 55" title="" data-src="/static/2018-10-09-20-25-55-60b24fc9ba9ec5cf948130335920d15b-8130d.png" data-srcset="/static/2018-10-09-20-25-55-60b24fc9ba9ec5cf948130335920d15b-08db0.png 200w,\n/static/2018-10-09-20-25-55-60b24fc9ba9ec5cf948130335920d15b-8130d.png 312w" data-sizes="(max-width: 312px) 100vw, 312px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果想要实现真正意义上的垂直居中对齐，只要想办法让字符 x 的中心位置就是容器的垂直中心位置即可，通常的做法是设置 font-size:0，整个字符 x 缩小成了一个看不见的点，根据 line-height 的半行间距上下等分规则，这个点就正好是整个容器的垂直中心位置，这样就可以实现真正意义上的垂直居中对齐了。</p>\n<p>不过话又说回来，平常我们开发的时候，font-size 可能就 12px 或 14px，虽然最终的效果是“近似垂直居中”，但偏差也就 1px ～ 2px 的样子，普通用户其实是很难觉察到其中的差异的，因此，是否非要真正意义上垂直居中，还是要根据项目的实现情况权衡做出决策。</p>\n<h2 id="无处不在的-vertical-align"><a href="#%E6%97%A0%E5%A4%84%E4%B8%8D%E5%9C%A8%E7%9A%84-vertical-align" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>无处不在的 vertical-align</h2>\n<p>对于内联元素，如果大家遇到不太好理解的现象，请一定要意识到，有个“幽灵空白节点”以及无处不在的 vertical-align 属性。</p>\n<p>虽然同属线性类属性值，但是 top/bottom 和 baseline/middle 却是完全不同的两个帮派，前者对齐看边缘看行框盒子，而后者是和字符 x 打交道。因此，细细考究，两者的行为表现实则大相径庭，一定要注意区分。</p>\n<h2 id="基于-vertical-align-属性的水平垂直居中弹框"><a href="#%E5%9F%BA%E4%BA%8E-vertical-align-%E5%B1%9E%E6%80%A7%E7%9A%84%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E5%B1%85%E4%B8%AD%E5%BC%B9%E6%A1%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基于 vertical-align 属性的水平垂直居中弹框</h2>\n<p>纯 CSS 实现大小不固定的弹框永远居中的效果，并且如果伪元素换成普通元素，连 IE7 浏览器都可以兼容。</p>\n<p>其 HTML 结构很简单，一个 container，显示半透明背景，然后里面的子元素就是弹框主体，假设类名是.dialog，则 HTML 如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10836723461671948000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n  .container {\n    position: fixed;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    background-color: rgba(0, 0, 0, .5);\n    /* 水平居中 */\n    text-align: center;\n    /* 使vertical-align: middle;真正的居中，防止幽灵结点“x”的干扰 */\n    font-size: 0;\n    /* 阻止换行，为了:after伪元素和.dialog在同一行 */\n    white-space: nowrap;\n    /* 过长时滚动 */\n    overflow: auto;\n  }\n\n  /* 参考实例“辅助实现两端对齐以及垂直居中、上边缘、下边缘对齐效果” */\n  .container:after {\n    content: \'\';\n    display: inline-block;\n    vertical-align: middle;\n    height: 100%;\n  }\n\n  .dialog {\n    display: inline-block;\n    vertical-align: middle;\n    text-align: left;\n    font-size: 14px;\n    /* 恢复换行 */\n    white-space: normal;\n  }\n</style>\n<div class=&quot;container&quot;>\n  <div class=&quot;dialog&quot;></dialog>\n</div>`, `10836723461671948000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n  <span class="token selector">.container</span> <span class="token punctuation">{</span>\n    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>\n    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> .5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">/* 水平居中 */</span>\n    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n    <span class="token comment">/* 使vertical-align: middle;真正的居中，防止幽灵结点“x”的干扰 */</span>\n    <span class="token property">font-size</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token comment">/* 阻止换行，为了:after伪元素和.dialog在同一行 */</span>\n    <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>\n    <span class="token comment">/* 过长时滚动 */</span>\n    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">/* 参考实例“辅助实现两端对齐以及垂直居中、上边缘、下边缘对齐效果” */</span>\n  <span class="token selector">.container:after</span> <span class="token punctuation">{</span>\n    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n    <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">.dialog</span> <span class="token punctuation">{</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n    <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n    <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>\n    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>\n    <span class="token comment">/* 恢复换行 */</span>\n    <span class="token property">white-space</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，无论浏览器尺寸是多大，也无论弹框尺寸是多少，我们的弹框永远都是居中的。</p>\n<p>优点：</p>\n<ul>\n<li>节省了很多无谓的定位的 JavaScript 代码，也不需要浏览器 resize 事件之类的处理，当弹框内容动态变化的时候，也无须重新定位。</li>\n<li>性能更改、渲染速度更快，毕竟浏览器内置 CSS 的即时渲染显然比 JavaScript 的处理要更好。</li>\n<li>可以非常灵活控制垂直居中的比例，比方说设置：</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72924439488511060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container:after {\n   height: 90%;\n}`, `72924439488511060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container:after</span> <span class="token punctuation">{</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 90%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>则弹框不是垂直居中对齐，而是近似上下 2 : 3 这种感觉的对齐，反而会让人有视觉上居中的感觉。</p>\n<ul>\n<li>容器设置 overflow:auto 可以实现弹框高度超过一屏时依然能看见屏幕外的内容，传统实现方法则比较尴尬。</li>\n</ul>\n<p>这里的技巧还有一个关键点是半透明黑色蒙层和弹框元素是在一起的父子关系</p>\n<p>此方法实现的原理关键就是两个 vertical-align:middle，前面“图片近似垂直居中”那里只图片一个元素 vertical-align:middle 就实现了垂直居中，原因就是 line-height 大小设置得恰到好处，但是对于弹框，高度不确定，显然不能使用某个具体的行高值创建足够高的内联元素。于是，这里借助伪元素创建了一个和外部容器一样高的宽度为 0 的 inline-block 元素。有种“幽灵空白节点”的感觉</p>\n<p>下面是原理作用的关键部分，在 5.3.7 节讲过如何分析多个 vertical-align 的作用，根据定义专注当前元素即可。vertical-align:middle 定义是元素的中线和字符 x 中心点对齐。</p>\n<ol>\n<li>在本例中，由于 font-size 设置为 0，所以 x 中心点位置就是 .container 的上边缘，此时，高度 100% 的宽度为 0 的伪元素和这个中心点对齐。如果中心点位置不动，这个伪元素上面一半的位置应该在.container 的外面，但是 CSS 中默认是左上方排列对齐的，所以，伪元素和这个原本在容器上边缘的 x 中心点一起往下移动了半个容器高度，也就是此时 x 中心点就在容器的垂直中心线上。</li>\n<li>弹框元素 .dialog 也设置了 vertical-align:middle。根据定义，弹框的垂直中心位置和 x 中心点位置对齐，此时，x 中心点就在容器的垂直中心位置，于是 .dialog 元素就和容器的垂直中心位置对齐了，从而实现了垂直居中效果。</li>\n<li>水平居中就 text-align:center 实现，非常好理解。</li>\n</ol>\n<p>按照初衷，块级元素负责布局，内联元素设置内容。但是，这里的弹框居中却是把块级元素内联化，利用一些内联属性实现垂直居中效果，这也是不得已而为之，因为 vertical-align 等内联属性确实比块级属性强悍，也正因为 CSS 世界在布局上的弱势，后来多栏布局、弹性盒子布局以及栅格布局一个一个都出来补强了。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/CSS世界内联元素与流/index.md absPath of file >>> MarkdownRemark",timeToRead:22,frontmatter:{date:"2018-09-21 16:52:43",path:"/css-world-inline-element-flow/",tags:"前端, CSS, CSS世界, 读书笔记",title:"CSS世界内联元素与流",draft:null}}],length:74,tag:"读书笔记",pagesSum:15,page:9}}}});