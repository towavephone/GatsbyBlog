webpackJsonp([0x92790ddf727],{1248:function(n,a){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlElEQVRIx12We2xT5xXAbcI2Vmn7o1I1uhVYRxL8tuPn9bXv0+/4/YgdOyYkkATCCEEYsqVNC2wCIYQWShmUBFh4hMAWECot0BUtlI4yAS1oKqJQXimsDBgTU8codnLO7r0uUPpJn87Rp+/8vvOdc75zr8xmZmTieI1NykU5yxOfxDncz3NUjAlyDXMjXGMhys+cG+FzGQ8VU4t7XuV8z8m+GUkrJclSqVReYJ0ZWQ8Tl2AdTPhnq9ns2QKd+crDZiHha8NsYCE21HZiXphpb3sxxTf99Tdsw51ldHqFaLOXXyzvYqOyZ0YPk5soylfouuUbvHOxh56JbiqJfi4/FnE1lxKetrGUZ954nbcdU/752ORpxWVsc6mZjPxctFtApeVtra1lmIPwTxClgeCqvGTsX/WWOEbtyTGWSoGbToOPzUHQ1QghVxOEhRniZ5U8XB4TzvTdgj1ZJdq2OOrkGhVRBnrYFum6TiK0l2fr0emMlVxcBhlnEniqDjlBuqg0CnD0MPWiDrwzhR4u+5B3x3WiLUNHJjxzZYvR8ZKTCP+Xo1JoM/nBYvSB1egHuyUIrCOBPj4LtD0KlD2K4h7SGip62aygxzaK9rHA3Aqt2vw0MRYjnyJtYaQdsXG9hgWFwgmVlXZUKUjUqmm0CgfwhA80Kgr1Wg40Sue4SuFEnZq+YjMbJ0kh0zmfemjQ0j2EJYh2a23RVOODIBvHmCsBUaoWLDoWKIsP50bTApxC5QwH1Ghp0Gk4MBk8aDLQEslooCc88VClsK+zGANI2mqLer0XFuea8PSuN+DM7o3QWyhAR7IBfj+vDbyOICS9aSjkZo8nvSlUKuxXLDUOKdN6LSl/AlRUE+vNAnD50l8XeTIEPiYEzXYG5mlNeGz7BvjPpY/g5snDcHxwE+zs7oCh1zvHCrNm48u/ML8j2muVQblBZ3t6ZY2KXKtQcDiwdk1xx9rV0BlqghEuD4fNUTy1Zwhw7Cbioxu461fdsOgFDa5pbh3zu6NifE9f+XCPlGHS5nuaFI3K8brJ4EUHES4WFiyEP2/dCPc2vYH/3NIHePcywP1LWLp3Ec4tWQa3FvbAu7294yqVA801rju5utYfiQyKDD4DnC8GWEhMafJPtBALxuHjo3+C8bufIn59DfHBFcDiDcQvzyF+/iEsbWuDadNMaDW5H7nY6Iyyh165zfLNtdUqIqLTsEJSQqBVUTD1JQPqdRT8sf9NuH7kMHy0fRg+O3EUzp96H/Zs2SBklxFKxwFmowtdTCIoPQx7oKLzl32PPTRPVSudDwQgCrUGL0+twdzsDjjSdwD2J1fh/q7N0N+1EtykB178qVY4lAahRktWkw95JrG4DAxPvHU3Wwb+rlcsHfK0WNxCoMdUCgdUaxnMBPKw7dVe2LyhDw4MboORA4NQOd2CaiUFaqWjZJGAyQGRUeubP8FqElqZspquEBeUM2zrnEQUa3R8USVcp2qGDZV6ErqXL4PfrlwFhSU9cPL4MejfshOsZq90sCg5KvHZ5MnPfa+cmFrxukRFuRZNcYqIoNngHheeFmiF11ClIDBdPwfqG9qhc1E3rF25GnrX90M204JqBfWItPrP8lTqa7vFpSw3GJ9cZjI4pW5TXaWezpKxh4Q5gEY9LwApVOtZMApxVWhd2DKvC7K5FjTUsFCj45Ah4yXaHuz1MBlgyHCb1HXISIXMTcekOJqN1h/72Mx92h5DwuwHjeChWseBQsNgJJ6H944eB5oNgaLajnaL/07E24wuKr7Cz+XuuenUsMioCxYmyHhnSPLQTYVVYVfjI46Mo80WBLMgLY4E1FhCOENBAsfHQG/0juuNPqGguU8ywXas5XNbg6783wJ8w781GtUPJc+irkap/Ufdje0JXytStnDJbA2D1Z4EKxEHsyUMRmsIdcZaNFpCYBYqwWQLPhD3Btn6t2Pe5uF0cD7Sdr/xmSab8racFaDooOvuk0wDEs40EFQGbVQGbEKXJoTPgZ3JoJGIgULvR6M1jE67rzvpae5ojC7GEJ9rfgILc7lC3NV0T6flTtjoPLK+VuD8rcD65gDtaQInPxOtzoxQRrXgD8/BdW/+YezYByfxvfdHvnxl+ZLKCDfzUMIze60Ey+brJukrqcjA1u3tBw8dfZiZuRQFaNFory/WEPUlE5kFK5WDQKRtbFPfUOnChUvFL27cwKuj/8CBHXv2iQw/k/KGuNwyCYiIkhw+sO/569eu7b1+ffR/H5z4BAcG38X1m/biyjX9ODR8GC9dHsXLV0fx5KlzePDIyFd7ht9ZJZhJrcvLhV/wMuUPljQWtC6Z+FjfuWPHlPMXLq64Onpz3d8/Pf9WX//OW2vWbITBof3n3tqya9fbh/7SvW1gZ9Xj/V1dr8kf614qIZONjBwrezi8Ty54K5d9ZzTmF+xe1LnioaD+4Nvrn4/ermif3yHp8UCDLMCky7Z+n192+/YdST9z5mPZ7t1D8ouXv6gQ4S9WTplks7mut8xZijxbKz2vvi2D39/cPyB/HC5xOm2czPvd35F8rkGCS0+I4WXV1QbJaMq06XqbNXCQJIILpH8hOic3GghZMpl62qG/Nf4PRzaQ862MzO4AAAAASUVORK5CYII=",aspectRatio:.6666666666666666,src:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png",srcSet:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-8a97b.png 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-0fdf3.png 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png 600w",srcWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp",srcSetWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-5d70e.webp 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-d1677.webp 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>针对本博客现有的 Gatsby 框架实现代码复制、代码实时查看编辑的功能</p>\n<h1 id="技术选型"><a href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术选型</h1>\n<p>以下都是采用最后一种方案，由于插件功能不满足，所以对其源码做出改动</p>\n<h2 id="代码复制"><a href="#%E4%BB%A3%E7%A0%81%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码复制</h2>\n<table>\n<thead>\n<tr>\n<th align="left">技术选型</th>\n<th align="left">语法</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">项目代码自实现</td>\n<td align="left">未实现</td>\n<td align="left">定制化程度高</td>\n<td align="left"><ol>\n<li>\n实现难度大；\n</li>\n<li>\n拓展较差\n</li>\n</ol></td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/iamskok/gatsby-remark-code-buttons" target="_blank" rel="nofollow noreferrer noopener">gatsby-remark-code-buttons</a></td>\n<td align="left">不需特定语法，只要是代码块默认具有复制功能</td>\n<td align="left">已具有代码复制功能</td>\n<td align="left"><ol>\n<li>\n有多复制一行的 bug；\n</li>\n<li>\nUI 不符合博客主题\n</li>\n</ol></td>\n</tr>\n</tbody>\n</table>\n<h2 id="代码实时查看编辑"><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BC%96%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码实时查看编辑</h2>\n<table>\n<thead>\n<tr>\n<th align="left">技术选型</th>\n<th align="left">语法</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n<th>样例页面</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">iframe + \n<a href="https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-remark-embed-snippet" target="_blank" rel="nofollow noreferrer noopener">gatsby-remark-embed-snippet</a></td>\n<td align="left"><code class="language-text">&lt;iframe src=&quot;/examples/snow.html&quot; width=&quot;800&quot; height=&quot;400&quot;&gt;&lt;/iframe&gt;</code>\n \n<br />\n \n<code class="language-text">`embed:snow.html`</code></td>\n<td align="left">实现最为简单，容易出效果</td>\n<td align="left"><ol>\n<li>\n没有实时编辑功能；\n<li>\n嵌入的代码往往需要将其写成一个 html 文件且一般情况下只支持静态页面的展示；\n</li>\n<li>\n需要 iframe、embed 标签声明两次\n</li>\n</ol></td>\n<td><a href="/snow-css/">下雪特效</a></td>\n</tr>\n<tr>\n<td align="left">iframe + code-editor.html 传参</td>\n<td align="left"><code class="language-text">&lt;iframe src=&quot;/examples/code-editor.html?html=转义字符串&amp;css=转义字符串&amp;js=转义字符串</code></td>\n<td align="left">基本实现代码的实时查看编辑</td>\n<td align="left"><ol>\n<li>\n嵌入的代码只支持静态的 html 页面；\n</li>\n<li>\n需要明确拆分出 js、css、html 三个结构；\n</li>\n<li>\n嵌入的 js、css、html 分别需要手动 escape 加密\n</li>\n</ol></td>\n<td><a href="/css-world-four-kinds-of-box/#border-%E7%AD%89%E9%AB%98%E5%B8%83%E5%B1%80%E6%8A%80%E6%9C%AF">CSS 世界四大盒尺寸</a></td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/elboman/gatsby-remark-embedded-codesandbox" target="_blank" rel="nofollow noreferrer noopener">gatsby-remark-embedded-codesandbox</a></td>\n<td align="left"><code class="language-text">[pms-example](embedded-codesandbox://gantt-component-optimization/pms-example)</code></td>\n<td align="left">借助 codesandbox 实现了较为丰富的代码实时查看编辑功能</td>\n<td align="left"><ol>\n<li>\n借助第三方实现的功能，不够稳定；\n</li>\n<li>\n不支持带目录的文件夹；\n</li>\n<li>\n单次请求过大（即上传代码过多）会报请求体过大错误；\n</li>\n<li>\n会上传 node_modules 等等大文件\n</li>\n</ol></td>\n<td>需实现</td>\n</tr>\n</tbody>\n</table>\n<h1 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h1>\n<h2 id="代码复制-1"><a href="#%E4%BB%A3%E7%A0%81%E5%A4%8D%E5%88%B6-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码复制</h2>\n<h3 id="修复复制多一行-bug"><a href="#%E4%BF%AE%E5%A4%8D%E5%A4%8D%E5%88%B6%E5%A4%9A%E4%B8%80%E8%A1%8C-bug" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复复制多一行 bug</h3>\n<p>代码在<a href="https://github.com/towavephone/gatsby-remark-code-buttons/commit/d95bb194d74182a3c5b8118102b3826695c2ff6d" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<p>src/gatsby-browser.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89638027481648840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@@ -7,19 +7,9 @@ exports.onClientEntry = () => {\n    el.innerHTML = str;\n    document.body.appendChild(el);\n\n-   const range = document.createRange();\n-   range.selectNode(el);\n-   window.getSelection().removeAllRanges();\n-   window.getSelection().addRange(range);\n-   document.execCommand(\\`copy\\`);\n-   document.activeElement.blur();\n-   setTimeout(() => {\n-     document.getSelection().removeAllRanges();\n-     document.body.removeChild(el);\n-   }, 100);\n+   el.select();\n+   document.execCommand(&quot;copy&quot;);\n+   document.body.removeChild(el);\n    if (toasterId) {\n      window.showClipboardToaster(toasterId);\n    }`, `89638027481648840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff">@@ -7,19 +7,9 @@ exports.onClientEntry = () => {\n<span class="token unchanged"><span class="token prefix unchanged"> </span>   el.innerHTML = str;\n<span class="token prefix unchanged"> </span>   document.body.appendChild(el);\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   const range = document.createRange();\n<span class="token prefix deleted">-</span>   range.selectNode(el);\n<span class="token prefix deleted">-</span>   window.getSelection().removeAllRanges();\n<span class="token prefix deleted">-</span>   window.getSelection().addRange(range);\n<span class="token prefix deleted">-</span>   document.execCommand(`copy`);\n<span class="token prefix deleted">-</span>   document.activeElement.blur();\n<span class="token prefix deleted">-</span>   setTimeout(() => {\n<span class="token prefix deleted">-</span>     document.getSelection().removeAllRanges();\n<span class="token prefix deleted">-</span>     document.body.removeChild(el);\n<span class="token prefix deleted">-</span>   }, 100);\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>   el.select();\n<span class="token prefix inserted">+</span>   document.execCommand("copy");\n<span class="token prefix inserted">+</span>   document.body.removeChild(el);\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   if (toasterId) {\n<span class="token prefix unchanged"> </span>     window.showClipboardToaster(toasterId);\n<span class="token prefix unchanged"> </span>   }</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="增加显示语言类型的功能；改变按钮文本显示逻辑；任何语言都可以显示复制按钮"><a href="#%E5%A2%9E%E5%8A%A0%E6%98%BE%E7%A4%BA%E8%AF%AD%E8%A8%80%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%9B%E6%94%B9%E5%8F%98%E6%8C%89%E9%92%AE%E6%96%87%E6%9C%AC%E6%98%BE%E7%A4%BA%E9%80%BB%E8%BE%91%EF%BC%9B%E4%BB%BB%E4%BD%95%E8%AF%AD%E8%A8%80%E9%83%BD%E5%8F%AF%E4%BB%A5%E6%98%BE%E7%A4%BA%E5%A4%8D%E5%88%B6%E6%8C%89%E9%92%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>增加显示语言类型的功能；改变按钮文本显示逻辑；任何语言都可以显示复制按钮</h3>\n<p>主要针对原插件做出的一些 UI、功能上的适配，代码在<a href="https://github.com/towavephone/gatsby-remark-code-buttons/commit/90094cd1c6a4a6fa7253f61e898f8a832173d6a9" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<p>src/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59888849845323145000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@@ -21,10 +21,6 @@ module.exports = function gatsbyRemarkCodeButtons(\n    const actions = qs.parse(params);\n    const { clipboard } = actions;\n\n-   if (!language) {\n-     return;\n-   }\n-\n    if (clipboard === \'false\') {\n      delete actions[\'clipboard\'];\n    } else {\n@@ -57,12 +53,12 @@ module.exports = function gatsbyRemarkCodeButtons(\n            >\n              <div\n                class=&quot;\\${buttonClass}&quot;\n-               data-tooltip=&quot;\\${tooltipText}&quot;\n+               \\${tooltipText ? \\`data-tooltip=&quot;\\${tooltipText}&quot;\\` : \'\'}\n              >\n-               \\${buttonText}\\${svgIcon}\n+               \\${[language, buttonText || svgIcon].filter((item) => item).join(\' \')}\n              </div>\n            </div>\n-           \\`.trim()\n+         \\`.trim()\n      };\n\n      parent.children.splice(index, 0, buttonNode);`, `59888849845323145000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff">@@ -21,10 +21,6 @@ module.exports = function gatsbyRemarkCodeButtons(\n<span class="token unchanged"><span class="token prefix unchanged"> </span>   const actions = qs.parse(params);\n<span class="token prefix unchanged"> </span>   const { clipboard } = actions;\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   if (!language) {\n<span class="token prefix deleted">-</span>     return;\n<span class="token prefix deleted">-</span>   }\n<span class="token prefix deleted">-</span>\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   if (clipboard === \'false\') {\n<span class="token prefix unchanged"> </span>     delete actions[\'clipboard\'];\n<span class="token prefix unchanged"> </span>   } else {\n</span>@@ -57,12 +53,12 @@ module.exports = function gatsbyRemarkCodeButtons(\n<span class="token unchanged"><span class="token prefix unchanged"> </span>           >\n<span class="token prefix unchanged"> </span>             &lt;div\n<span class="token prefix unchanged"> </span>               class="${buttonClass}"\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>               data-tooltip="${tooltipText}"\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>               ${tooltipText ? `data-tooltip="${tooltipText}"` : \'\'}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>             >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>               ${buttonText}${svgIcon}\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>               ${[language, buttonText || svgIcon].filter((item) => item).join(\' \')}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>             &lt;/div>\n<span class="token prefix unchanged"> </span>           &lt;/div>\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>           `.trim()\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>         `.trim()\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     };\n</span>\n<span class="token unchanged"><span class="token prefix unchanged"> </span>     parent.children.splice(index, 0, buttonNode);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="实现效果"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65130189891853820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 测试代码复制功能，这个代码块应该具有复制代码功能`, `65130189891853820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 测试代码复制功能，这个代码块应该具有复制代码功能</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="代码实时查看编辑-1"><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BC%96%E8%BE%91-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码实时查看编辑</h2>\n<p>代码在<a href="https://github.com/towavephone/gatsby-remark-embedded-codesandbox/commit/6a1947c22566c6ad5baae33dabf99edd16f4c8eb" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<h3 id="递归遍历文件夹；增加忽略文件功能"><a href="#%E9%80%92%E5%BD%92%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E5%A4%B9%EF%BC%9B%E5%A2%9E%E5%8A%A0%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>递归遍历文件夹；增加忽略文件功能</h3>\n<p>原插件不支持目录的读取，这里拓展了目录下也能递归读取的功能，同时也实现了默认忽略文件的功能</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28483530505311780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const DEFAULT_IGNORED_FILES = [\'node_modules\', \'package-lock.json\', \'yarn.lock\'];\n\nconst ignoredFilesSet = new Set(ignoredFiles);\n\nconst getAllFiles = (dirPath) =>\n   fs.readdirSync(dirPath).reduce((acc, file) => {\n      // 过滤文件立即跳出下一个\n      if (ignoredFilesSet.has(file)) return acc;\n      const relativePath = path.join(dirPath, file);\n      const isDirectory = fs.statSync(relativePath).isDirectory();\n      // 判断是目录继续递归遍历\n      const additions = isDirectory ? getAllFiles(relativePath) : [relativePath.replace(\\`\\${directory}/\\`, \'\')];\n      return [...acc, ...additions];\n   }, []);`, `28483530505311780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">DEFAULT_IGNORED_FILES</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'node_modules\'</span><span class="token punctuation">,</span> <span class="token string">\'package-lock.json\'</span><span class="token punctuation">,</span> <span class="token string">\'yarn.lock\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> ignoredFilesSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>ignoredFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">getAllFiles</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dirPath</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 过滤文件立即跳出下一个</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>ignoredFilesSet<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> acc<span class="token punctuation">;</span>\n      <span class="token keyword">const</span> relativePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> isDirectory <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>relativePath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 判断是目录继续递归遍历</span>\n      <span class="token keyword">const</span> additions <span class="token operator">=</span> isDirectory <span class="token operator">?</span> <span class="token function">getAllFiles</span><span class="token punctuation">(</span>relativePath<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>relativePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>directory<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>acc<span class="token punctuation">,</span> <span class="token operator">...</span>additions<span class="token punctuation">]</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="默认模式为静态服务器"><a href="#%E9%BB%98%E8%AE%A4%E6%A8%A1%E5%BC%8F%E4%B8%BA%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>默认模式为静态服务器</h3>\n<p>因为 codesandbox 需要明确模板类型，这里默认为静态模板，否则静态文件不能正常运行</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46476550161514490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const getFileExist = (fileList, filename = \'package.json\') => {\n   const found = fileList.filter((name) => name === filename);\n   return found.length > null;\n};\n\nif (!getFileExist(folderFiles, \'sandbox.config.json\')) {\n   sandboxFiles.push({\n      name: \'sandbox.config.json\',\n      content: \'{ &quot;template&quot;: &quot;static&quot; }\'\n   });\n}`, `46476550161514490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> getFileExist <span class="token operator">=</span> <span class="token punctuation">(</span>fileList<span class="token punctuation">,</span> filename <span class="token operator">=</span> <span class="token string">\'package.json\'</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> found <span class="token operator">=</span> fileList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=></span> name <span class="token operator">===</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> found<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">getFileExist</span><span class="token punctuation">(</span>folderFiles<span class="token punctuation">,</span> <span class="token string">\'sandbox.config.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   sandboxFiles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'sandbox.config.json\'</span><span class="token punctuation">,</span>\n      content<span class="token punctuation">:</span> <span class="token string">\'{ "template": "static" }\'</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="codesandbox-请求方式改为-post-异步化"><a href="#codesandbox-%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%E6%94%B9%E4%B8%BA-post-%E5%BC%82%E6%AD%A5%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>codesandbox 请求方式改为 post 异步化</h3>\n<p>原插件是基于 get 请求的，一旦上传文件过多就会报错，这里改为 post 请求就不再有请求体大小的限制，同时也要注意 post 的异步</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74498634799122860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const convertNodeToEmbedded = async (node, params, options = {}) => {\n   delete node.children;\n   delete node.position;\n   delete node.title;\n   delete node.url;\n\n   // merge the overriding options with the plugin one\n   const mergedOptions = { ...embedOptions, ...options };\n   const encodedEmbedOptions = queryString.stringify(mergedOptions);\n\n   const { sandbox_id } = await fetch(\'https://codesandbox.io/api/v1/sandboxes/define?json=1\', {\n      method: \'POST\',\n      headers: {\n         \'Content-Type\': \'application/json\',\n         Accept: \'application/json\'\n      },\n      body: params\n   }).then((x) => x.json());\n\n   const sandboxUrl = \\`https://codesandbox.io/embed/\\${sandbox_id}?\\${encodedEmbedOptions}\\`;\n   const embedded = getIframe(sandboxUrl);\n   node.type = \'html\';\n   node.value = embedded;\n\n   return node;\n};\n\nconst nodes = [];\nmap(markdownAST, (node, index, parent) => {\n   if (node.type === \'link\' && node.url.startsWith(protocol)) {\n      // split the url in base and query to allow user\n      // to customise embedding options on a per-node basis\n      const url = getUrlParts(node.url);\n      // get all files in the folder and generate\n      // the embeddeing parameters\n      const dir = getDirectoryPath(url.base);\n      const files = getFilesList(dir);\n      const params = createParams(files);\n      convertNodeToEmbedded(node, params, url.query);\n      const currentNode = convertNodeToEmbedded(node, params, url.query);\n      nodes.push(currentNode);\n   }\n\n   return node;\n});\n\n// 注意这里的异步化，必须等所有的请求成功响应才可继续遍历\nawait Promise.all(nodes);`, `74498634799122860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">convertNodeToEmbedded</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> params<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">delete</span> node<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n   <span class="token keyword">delete</span> node<span class="token punctuation">.</span>position<span class="token punctuation">;</span>\n   <span class="token keyword">delete</span> node<span class="token punctuation">.</span>title<span class="token punctuation">;</span>\n   <span class="token keyword">delete</span> node<span class="token punctuation">.</span>url<span class="token punctuation">;</span>\n\n   <span class="token comment">// merge the overriding options with the plugin one</span>\n   <span class="token keyword">const</span> mergedOptions <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>embedOptions<span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> encodedEmbedOptions <span class="token operator">=</span> queryString<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>mergedOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> sandbox_id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">\'https://codesandbox.io/api/v1/sandboxes/define?json=1\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      method<span class="token punctuation">:</span> <span class="token string">\'POST\'</span><span class="token punctuation">,</span>\n      headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         <span class="token string">\'Content-Type\'</span><span class="token punctuation">:</span> <span class="token string">\'application/json\'</span><span class="token punctuation">,</span>\n         Accept<span class="token punctuation">:</span> <span class="token string">\'application/json\'</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      body<span class="token punctuation">:</span> params\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> sandboxUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://codesandbox.io/embed/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sandbox_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>encodedEmbedOptions<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> embedded <span class="token operator">=</span> <span class="token function">getIframe</span><span class="token punctuation">(</span>sandboxUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   node<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">\'html\'</span><span class="token punctuation">;</span>\n   node<span class="token punctuation">.</span>value <span class="token operator">=</span> embedded<span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> node<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token function">map</span><span class="token punctuation">(</span>markdownAST<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> index<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'link\'</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>protocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// split the url in base and query to allow user</span>\n      <span class="token comment">// to customise embedding options on a per-node basis</span>\n      <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getUrlParts</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// get all files in the folder and generate</span>\n      <span class="token comment">// the embeddeing parameters</span>\n      <span class="token keyword">const</span> dir <span class="token operator">=</span> <span class="token function">getDirectoryPath</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token function">getFilesList</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token function">createParams</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">convertNodeToEmbedded</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> params<span class="token punctuation">,</span> url<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> currentNode <span class="token operator">=</span> <span class="token function">convertNodeToEmbedded</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> params<span class="token punctuation">,</span> url<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>currentNode<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">return</span> node<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 注意这里的异步化，必须等所有的请求成功响应才可继续遍历</span>\n<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="实现效果-1"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h3>\n<p><a href="/gantt-component-optimization/#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C">甘特图组件源码优化</a></p>\n<h3 id="后续优化"><a href="#%E5%90%8E%E7%BB%AD%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后续优化</h3>\n<p><a href="https://github.com/elboman/gatsby-remark-embedded-codesandbox/compare/master...towavephone:gatsby-remark-embedded-codesandbox:master" target="_blank" rel="nofollow noreferrer noopener">代码地址</a></p>\n<ol>\n<li>增加上传文件忽略功能，支持 post 上传文件</li>\n<li>修复 json 解析报错</li>\n<li>限制请求并发防止 codesandbox 报错</li>\n</ol>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<ol>\n<li>复制功能需考虑兼容性、复制性能，可参考<a href="https://www.zhangxinxu.com/wordpress/2021/10/js-copy-paste-clipboard/" target="_blank" rel="nofollow noreferrer noopener">JS 复制文字到剪切板的极简实现及扩展</a></li>\n<li>代码实时查看编辑借助于第三方服务不够稳定，可自行搭建第三方服务或者参照 <a href="https://github.com/gfxfundamentals/live-editor" target="_blank" rel="nofollow noreferrer noopener">live-editor</a> 自建本地编辑器，必要时具有分享功能</li>\n</ol>\n<h1 id="其他优化"><a href="#%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他优化</h1>\n<ol>\n<li>把 gatsby-remark-graph 配置化，以支持最新的 mermaid 特性，<a href="https://github.com/konsumer/gatsby-remark-graph/compare/master...towavephone:gatsby-remark-graph-towavephone:master" target="_blank" rel="nofollow noreferrer noopener">代码地址</a></li>\n<li>gatsby-remark-design-system 支持文字转语音（利用百度翻译），<a href="https://github.com/LekoArts/gatsby-remark-design-system/compare/master...towavephone:gatsby-remark-design-system-towavephone:master" target="_blank" rel="nofollow noreferrer noopener">代码地址</a></li>\n<li>img、video、iframe 增加懒加载功能，<a href="https://github.com/1kohei1/gatsby-remark-lazy-load/compare/master...towavephone:gatsby-remark-lazy-load:master" target="_blank" rel="nofollow noreferrer noopener">代码地址</a></li>\n</ol>',
excerpt:"需求背景 针对本博客现有的 Gatsby 框架实现代码复制、代码实时查看编辑的功能 技术选型 以下都是采用最后一种方案，由于插件功能不满足，所以对其源码做出改动 代码复制 技术选型 语法 优点 缺点 项目代码自实现 未实现 定制化程度高 实现难度大； 拓展较差 gatsby…",timeToRead:8,tableOfContents:'<ul>\n<li><a href="/gatsby-plugin-transformation/#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF">需求背景</a></li>\n<li>\n<p><a href="/gatsby-plugin-transformation/#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B">技术选型</a></p>\n<ul>\n<li><a href="/gatsby-plugin-transformation/#%E4%BB%A3%E7%A0%81%E5%A4%8D%E5%88%B6">代码复制</a></li>\n<li><a href="/gatsby-plugin-transformation/#%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BC%96%E8%BE%91">代码实时查看编辑</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/gatsby-plugin-transformation/#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91">核心逻辑</a></p>\n<ul>\n<li>\n<p><a href="/gatsby-plugin-transformation/#%E4%BB%A3%E7%A0%81%E5%A4%8D%E5%88%B6-1">代码复制</a></p>\n<ul>\n<li><a href="/gatsby-plugin-transformation/#%E4%BF%AE%E5%A4%8D%E5%A4%8D%E5%88%B6%E5%A4%9A%E4%B8%80%E8%A1%8C-bug">修复复制多一行 bug</a></li>\n<li><a href="/gatsby-plugin-transformation/#%E5%A2%9E%E5%8A%A0%E6%98%BE%E7%A4%BA%E8%AF%AD%E8%A8%80%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%9B%E6%94%B9%E5%8F%98%E6%8C%89%E9%92%AE%E6%96%87%E6%9C%AC%E6%98%BE%E7%A4%BA%E9%80%BB%E8%BE%91%EF%BC%9B%E4%BB%BB%E4%BD%95%E8%AF%AD%E8%A8%80%E9%83%BD%E5%8F%AF%E4%BB%A5%E6%98%BE%E7%A4%BA%E5%A4%8D%E5%88%B6%E6%8C%89%E9%92%AE">增加显示语言类型的功能；改变按钮文本显示逻辑；任何语言都可以显示复制按钮</a></li>\n<li><a href="/gatsby-plugin-transformation/#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C">实现效果</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/gatsby-plugin-transformation/#%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BC%96%E8%BE%91-1">代码实时查看编辑</a></p>\n<ul>\n<li><a href="/gatsby-plugin-transformation/#%E9%80%92%E5%BD%92%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E5%A4%B9%EF%BC%9B%E5%A2%9E%E5%8A%A0%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD">递归遍历文件夹；增加忽略文件功能</a></li>\n<li><a href="/gatsby-plugin-transformation/#%E9%BB%98%E8%AE%A4%E6%A8%A1%E5%BC%8F%E4%B8%BA%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8">默认模式为静态服务器</a></li>\n<li><a href="/gatsby-plugin-transformation/#codesandbox-%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%E6%94%B9%E4%B8%BA-post-%E5%BC%82%E6%AD%A5%E5%8C%96">codesandbox 请求方式改为 post 异步化</a></li>\n<li><a href="/gatsby-plugin-transformation/#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C-1">实现效果</a></li>\n<li><a href="/gatsby-plugin-transformation/#%E5%90%8E%E7%BB%AD%E4%BC%98%E5%8C%96">后续优化</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href="/gatsby-plugin-transformation/#%E6%80%BB%E7%BB%93">总结</a></li>\n<li><a href="/gatsby-plugin-transformation/#%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96">其他优化</a></li>\n</ul>',wordCount:{words:111},frontmatter:{date:"2023-11-28 16:17:27",path:"/gatsby-plugin-transformation/",tags:"前端, 源码优化, 预研",title:"博客 Gatsby 插件改造",draft:null,catalog_number:null}},nextPost:{html:'<h1 id="入门"><a href="#%E5%85%A5%E9%97%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>入门</h1>\n<h2 id="hello-world"><a href="#hello-world" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hello, World</h2>\n<p>我们以现已成为传统的 <code class="language-text">hello world</code> 案例来开始吧</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54357878226278890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`package main\n\nimport &quot;fmt&quot;\n\nfunc main() {\n    fmt.Println(&quot;Hello, 世界&quot;)\n}`, `54357878226278890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="go"\n              >\n                <span class="gatsby-code-button-language">go</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> main\n\n<span class="token keyword">import</span> <span class="token string">"fmt"</span>\n\n<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Hello, 世界"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Go 是一门编译型语言，Go 语言的工具链将源代码及其依赖转换成计算机的机器指令（译注：静态编译）。Go 语言提供的工具都通过一个单独的命令 go 调用，go 命令有一系列子命令。最简单的一个子命令就是 run。这个命令编译一个或多个以 .go 结尾的源文件，链接库文件，并运行最终生成的可执行文件（本书使用 <code class="language-text">$</code> 表示命令行提示符。）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18739714926960914000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ go run helloworld.go`, `18739714926960914000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ go run helloworld.go</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>毫无意外，这个命令会输出：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44521767759993990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Hello, 世界`, `44521767759993990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Hello, 世界</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>Go 语言原生支持 Unicode，它可以处理全世界任何语言的文本。</p>\n<p>如果不只是一次性实验，你肯定希望能够编译这个程序，保存编译结果以备将来之用，可以用 build 子命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45058627822140560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ go build helloworld.go`, `45058627822140560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ go build helloworld.go</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这个命令生成一个名为 helloworld 的可执行的二进制文件（译注：Windows 系统下生成的可执行文件是 helloworld.exe，增加了 .exe 后缀名），之后你可以随时运行它（译注：在 Windows 系统下在命令行直接输入 helloworld.exe 命令运行），不需任何处理（译注：因为静态编译，所以不用担心在系统库更新的时候冲突，幸福感满满）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75164988480567540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ ./helloworld\nHello, 世界`, `75164988480567540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ ./helloworld\nHello, 世界</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>执行 <code class="language-text">go get gopl.io/ch1/helloworld</code> 命令，就会从网上获取代码，并放到对应目录中（需要先安装 Git 或 Hg 之类的版本管理工具，并将对应的命令添加到 PATH 环境变量中。</p>\n<p>来讨论下程序本身。Go 语言的代码通过包（package）组织，包类似于其它语言里的库（libraries）或者模块（modules）。一个包由位于单个目录下的一个或多个 .go 源代码文件组成，目录定义包的作用。每个源文件都以一条 package 声明语句开始，这个例子里就是 package main，表示该文件属于哪个包，紧跟着一系列导入（import）的包，之后是存储在这个文件里的程序语句。</p>\n<p>Go 的标准库提供了 100 多个包，以支持常见功能，如输入、输出、排序以及文本处理。比如 fmt 包，就含有格式化输出、接收输入的函数。Println 是其中一个基础函数，可以打印以空格间隔的一个或多个值，并在最后添加一个换行符，从而输出一整行。</p>\n<p>main 包比较特殊。它定义了一个独立可执行的程序，而不是一个库。在 main 里的 main 函数也很特殊，它是整个程序执行时的入口（译注：C 系语言差不多都这样）。main 函数所做的事情就是程序做的。当然了，main 函数一般调用其它包里的函数完成很多工作（如：fmt.Println）。</p>\n<p>必须告诉编译器源文件需要哪些包，这就是跟随在 package 声明后面的 import 声明扮演的角色。hello world 例子只用到了一个包，大多数程序需要导入多个包。</p>\n<p>必须恰当导入需要的包，缺少了必要的包或者导入了不需要的包，程序都无法编译通过。这项严格要求避免了程序开发过程中引入未使用的包（译注：Go 语言编译过程没有警告信息，争议特性之一）。</p>\n<p>import 声明必须跟在文件的 package 声明之后。随后，则是组成程序的函数、变量、常量、类型的声明语句（分别由关键字 func、var、const、type 定义）。这些内容的声明顺序并不重要（译注：最好还是定一下规范）。这个例子的程序已经尽可能短了，只声明了一个函数，其中只调用了一个其他函数。为了节省篇幅，有些时候示例程序会省略 package 和 import 声明，但是，这些声明在源代码里有，并且必须得有才能编译。</p>\n<p>一个函数的声明由 func 关键字、函数名、参数列表、返回值列表（这个例子里的 main 函数参数列表和返回值都是空的）以及包含在大括号里的函数体组成。第五章进一步考察函数。</p>\n<p>Go 语言不需要在语句或者声明的末尾添加分号，除非一行上有多条语句。实际上，编译器会主动把特定符号后的换行符转换为分号，因此换行符添加的位置会影响 Go 代码的正确解析（译注：比如行末是标识符、整数、浮点数、虚数、字符或字符串文字、关键字 break、continue、fallthrough 或 return 中的一个、运算符和分隔符 <code class="language-text">++</code>、<code class="language-text">--</code>、<code class="language-text">)</code>、<code class="language-text">]</code> 或 <code class="language-text">}</code> 中的一个）。举个例子，函数的左括号 <code class="language-text">{</code> 必须和 func 函数声明在同一行上，且位于末尾，不能独占一行，而在表达式 <code class="language-text">x + y</code> 中，可在 + 后换行，不能在 + 前换行（译注：以 + 结尾的话不会被插入分号分隔符，但是以 x 结尾的话则会被分号分隔符，从而导致编译错误）。</p>\n<p>Go 语言在代码格式上采取了很强硬的态度。gofmt 工具把代码格式化为标准格式（译注：这个格式化工具没有任何可以调整代码格式的参数，Go 语言就是这么任性），并且 go 工具中的 fmt 子命令会对指定包，否则默认为当前目录中所有 go 源文件应用 gofmt 命令。本书中的所有代码都被 gofmt 过。你也应该养成格式化自己的代码的习惯。以固定方式规定标准的代码格式可以避免无尽的无意义的琐碎争执（译注：也导致了 Go 语言的 TIOBE 排名较低，因为缺少撕逼的话题）。更重要的是，这样可以做多种自动源码转换，如果放任 Go 语言代码格式，这些转换就不大可能了。</p>\n<p>很多文本编辑器都可以配置为保存文件时自动执行 gofmt，这样你的源代码总会被恰当地格式化。还有个相关的工具：goimports，可以根据代码需要，自动地添加或删除 import 声明。这个工具并没有包含在标准的分发包中，可以用下面的命令安装：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79296034615936660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ go get golang.org/x/tools/cmd/goimports`, `79296034615936660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ go get golang.org/x/tools/cmd/goimports</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>对于大多数用户来说，下载、编译包、运行测试用例、察看 Go 语言的文档等等常用功能都可以用 go 的工具完成。10.7 节详细介绍这些知识。</p>\n<h2 id="命令行参数"><a href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>命令行参数</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20867862755190858000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Echo1 prints its command-line arguments.\npackage main\n\nimport (\n    &quot;fmt&quot;\n    &quot;os&quot;\n)\n\nfunc main() {\n    var s, sep string\n    for i := 1; i < len(os.Args); i++ {\n        s += sep + os.Args[i]\n        sep = &quot; &quot;\n    }\n    fmt.Println(s)\n}`, `20867862755190858000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="go"\n              >\n                <span class="gatsby-code-button-language">go</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token comment">// Echo1 prints its command-line arguments.</span>\n<span class="token keyword">package</span> main\n\n<span class="token keyword">import</span> <span class="token punctuation">(</span>\n    <span class="token string">"fmt"</span>\n    <span class="token string">"os"</span>\n<span class="token punctuation">)</span>\n\n<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> s<span class="token punctuation">,</span> sep <span class="token builtin">string</span>\n    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>\n        s <span class="token operator">+=</span> sep <span class="token operator">+</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span>i<span class="token punctuation">]</span>\n        sep <span class="token operator">=</span> <span class="token string">" "</span>\n    <span class="token punctuation">}</span>\n    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61100457350808000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Echo2 prints its command-line arguments.\npackage main\n\nimport (\n    &quot;fmt&quot;\n    &quot;os&quot;\n)\n\nfunc main() {\n    s, sep := &quot;&quot;, &quot;&quot;\n    for _, arg := range os.Args[1:] {\n        s += sep + arg\n        sep = &quot; &quot;\n    }\n    fmt.Println(s)\n}`, `61100457350808000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="go"\n              >\n                <span class="gatsby-code-button-language">go</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token comment">// Echo2 prints its command-line arguments.</span>\n<span class="token keyword">package</span> main\n\n<span class="token keyword">import</span> <span class="token punctuation">(</span>\n    <span class="token string">"fmt"</span>\n    <span class="token string">"os"</span>\n<span class="token punctuation">)</span>\n\n<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    s<span class="token punctuation">,</span> sep <span class="token operator">:=</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span>\n    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> arg <span class="token operator">:=</span> <span class="token keyword">range</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>\n        s <span class="token operator">+=</span> sep <span class="token operator">+</span> arg\n        sep <span class="token operator">=</span> <span class="token string">" "</span>\n    <span class="token punctuation">}</span>\n    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95754366433830470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`s := &quot;&quot; // 一条短变量声明，最简洁，但只能用在函数内部，而不能用于包变量\nvar s string // 依赖于字符串的默认初始化零值机制，被初始化为 &quot;&quot;\nvar s = &quot;&quot; // 用得很少，除非同时声明多个变量\nvar s string = &quot;&quot; // 显式地标明变量的类型，当变量类型与初值类型相同时，类型冗余，但如果两者类型不同，变量类型就必须了`, `95754366433830470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="go"\n              >\n                <span class="gatsby-code-button-language">go</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go">s <span class="token operator">:=</span> <span class="token string">""</span> <span class="token comment">// 一条短变量声明，最简洁，但只能用在函数内部，而不能用于包变量</span>\n<span class="token keyword">var</span> s <span class="token builtin">string</span> <span class="token comment">// 依赖于字符串的默认初始化零值机制，被初始化为 ""</span>\n<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string">""</span> <span class="token comment">// 用得很少，除非同时声明多个变量</span>\n<span class="token keyword">var</span> s <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">""</span> <span class="token comment">// 显式地标明变量的类型，当变量类型与初值类型相同时，类型冗余，但如果两者类型不同，变量类型就必须了</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实践中一般使用前两种形式中的某个，初始值重要的话就显式地指定变量的类型，否则使用隐式初始化。</p>\n<p>每次循环迭代字符串 s 的内容都会更新。+= 连接原字符串、空格和下个参数，产生新字符串，并把它赋值给 s。s 原来的内容已经不再使用，将在适当时机对它进行垃圾回收。</p>\n<p>如果连接涉及的数据量很大，这种方式代价高昂。一种简单且高效的解决方案是使用 strings 包的 Join 函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99306650958644170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`func main() {\n    fmt.Println(strings.Join(os.Args[1:], &quot; &quot;))\n}`, `99306650958644170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="go"\n              >\n                <span class="gatsby-code-button-language">go</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>最后，如果不关心输出格式，只想看看输出值，或许只是为了调试，可以用 Println 为我们格式化输出。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15750287340398006000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fmt.Println(os.Args[1:])`, `15750287340398006000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="go"\n              >\n                <span class="gatsby-code-button-language">go</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这条语句的输出结果跟 strings.Join 得到的结果很像，只是被放到了一对方括号里。切片都会被打印成这种格式。</p>\n<p>// TODO <a href="https://golang-china.github.io/gopl-zh/preface-zh.html" target="_blank" rel="nofollow noreferrer noopener">https://golang-china.github.io/gopl-zh/preface-zh.html</a></p>',excerpt:"入门 Hello, World 我们以现已成为传统的   案例来开始吧 Go 是一门编译型语言，Go 语言的工具链将源代码及其依赖转换成计算机的机器指令（译注：静态编译）。Go 语言提供的工具都通过一个单独的命令 go 调用，go…",frontmatter:{date:"2023-10-02 17:58:46",path:"/go-introduce-learn/",tags:"后端, go, 读书笔记",title:"Go 入门学习",draft:null}},prePost:{html:'<h1 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h1>\n<p>在 chrome 浏览器上，用高德地图的 CircleMarker, PathSimplifier 分别画点和线时候，需要实现点在线的上面的效果，此时在 windows 系统上不能正常显示红点（左侧），在 ubuntu 系统下却正常显示（右侧），如下图所示</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-11-28-17-00-49-8eed1f43729ab0534e4ba15a630ed339-16a51.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 324px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 44.1358024691358%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACWElEQVQozz2SWU9TARCF77/0RR80MYawxBaUfW2lUiWllKVFKQSoFJTFaqkgmwgCSgCxRaCAQpe7dW8pxWg+ryHx4cuZzGTOyzlCbVMdhkcN2LvMWNtqsD+pZKTjAVNd5czadXwermKr7y6Hcw7S2QyZeJRUXCKhRokrETIphWxaJZtSSSdlBHHeyvG7DvZ9NjZetrHoMuFxGnH3NDLUWceYw4jFUMKEu5/LyxzpXJxUOkYsoaAmZLL5lEaafCFLrpBByL9vhBUDrLfBjg32nXA0BieTcOrR1AvBaXIna6iiSDawQ/IwQOLAr6lf0z2SR37tHiAb/IbwuKkMU0MRlpZi7KZSBs3FvOmtYNFZxdpQLYFJI2FPE/KuR3s+JOQaJNFjIu9oIGer5sKi4+KpnrzpHvmamwjSro/gRzfbvj5WxtvxOpt57WxlpKuBbpMOi1FP08PbjL54RuHnKT+e20m2V3PpqCc/YKQwZKbg7uRqysHVmA3h98kynH8AcR3ULxqb2rwKZwtw7OPq+1uyWy7EvXnCx0HU7Q3kT0soy3PE15cR/XtE9veRAgEiAT+CuUXPgK2R/vYKRq0VeB2VrA7X8/WVgbOZNmJLVn5t2skdLBAJnRFSRM4ViZAqEY7LnMcVQhqSRlgLSjgaKeHIXc6msxRvdxnDFj09WnX+VchqrqO1WU9LbRETY04y6SQxKUxCiV6jilp1oihyhJh8vRM6zLW4LPfZGNAhjxfB9C2YvMGfqTtczFSSnGvldLSEw9leEqk0STVCMib9J66ZKpqZLEWQxBB/AQBvSOSbuQBPAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 11 28 17 00 49" title="" data-src="/static/2023-11-28-17-00-49-8eed1f43729ab0534e4ba15a630ed339-16a51.png" data-srcset="/static/2023-11-28-17-00-49-8eed1f43729ab0534e4ba15a630ed339-6752f.png 200w,\n/static/2023-11-28-17-00-49-8eed1f43729ab0534e4ba15a630ed339-16a51.png 324w" data-sizes="(max-width: 324px) 100vw, 324px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="原因"><a href="#%E5%8E%9F%E5%9B%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原因</h1>\n<p>红点是由 <a href="https://lbs.amap.com/api/javascript-api-v2/documentation#circlemarker" target="_blank" rel="nofollow noreferrer noopener">CircleMarker</a> 组件实现，而下面的线则是 <a href="https://lbs.amap.com/api/amap-ui/reference-amap-ui/mass-data/pathsimplifier" target="_blank" rel="nofollow noreferrer noopener">PathSimplifier</a> 实现，在 chrome 浏览器下不同系统的表现为：</p>\n<ol>\n<li>window: CircleMarker 由 canvas 渲染，且层级和高德地图图层一致，而 PathSimplifier 的层级比高德地图图层要高</li>\n<li>ubuntu: CircleMarker 由 svg 渲染，层级比 PathSimplifier 要高</li>\n</ol>\n<h1 id="优缺点"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h1>\n<p>综上所述，需要统一不同系统下的渲染方式，优缺点对比如下</p>\n<table>\n<thead>\n<tr>\n<th align="center">渲染方式</th>\n<th align="center">优点</th>\n<th align="center">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">canvas</td>\n<td align="center">性能好</td>\n<td align="center">实现成本高，即需要生成比 PathSimplifier 所在层级要高的新图层</td>\n</tr>\n<tr>\n<td align="center">svg</td>\n<td align="center">实现方便，有现成的 \n<a href="https://lbs.amap.com/api/amap-ui/reference-amap-ui/overlay/svgmarker" target="_blank" rel="nofollow noreferrer noopener">SvgMarker</a></td>\n<td align="center">性能差，但对于这个场景来说只需要鼠标悬浮上去才渲染一条路线上的点，即性能要求不高</td>\n</tr>\n</tbody>\n</table>\n<p>最终采用 SvgMarker 渲染</p>\n<h1 id="效果展示"><a href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>效果展示</h1>\n<p>以下都在 chrome 浏览器下测试：</p>\n<h2 id="修复前"><a href="#%E4%BF%AE%E5%A4%8D%E5%89%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复前</h2>\n<p>windows 下不能正常显示，ubuntu 正常</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/x86xtf?codemirror=1&amp;hidenavigation=1&amp;module=%2Fsrc%2Fcomponents%2FReactAmap%2Fhooks%2FuseDrawPoints.js&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="修复后"><a href="#%E4%BF%AE%E5%A4%8D%E5%90%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复后</h2>\n<p>windows、ubuntu 都能正常显示</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/9cpd4v?codemirror=1&amp;hidenavigation=1&amp;module=%2Fsrc%2Fcomponents%2FReactAmap%2Fhooks%2FuseDrawPoints.js&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>',
excerpt:"背景 在 chrome 浏览器上，用高德地图的 CircleMarker, PathSimplifier 分别画点和线时候，需要实现点在线的上面的效果，此时在 windows 系统上不能正常显示红点（左侧），在 ubuntu…",frontmatter:{date:"2023-11-28 16:55:48",path:"/amap-browser-compatibility/",tags:"前端, 地图, 预研",title:"记一次处理高德地图浏览器兼容性问题",draft:null}}},pathContext:{mainPostPath:"/gatsby-plugin-transformation/",nextPostPath:"/go-introduce-learn/",prePostPath:"/amap-browser-compatibility/"}}}});