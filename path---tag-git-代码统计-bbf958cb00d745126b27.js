webpackJsonp([47817495489441],{1421:function(a,s){a.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"需求背景 由于每个周末放假前都要给出代码量的统计，如果是手动统计的话需要到各个开发过的项目下运行相应的脚本，太过繁琐。故写出以下第一版统计代码量的脚本 代码展示 以下是统计 G:/project/tungee/ 目录下的代码量，其中标红部分需要修改为自己的项目路径和 git 邮箱 第一版 按项目统计 运行效果 以上更新于 第二版 增加按日期统计和 shell 参数输入 运行效果 第三版 增加按分支统计的功能，去掉 shell…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>由于每个周末放假前都要给出代码量的统计，如果是手动统计的话需要到各个开发过的项目下运行相应的脚本，太过繁琐。故写出以下第一版统计代码量的脚本</p>\n<h1 id="代码展示"><a href="#%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码展示</h1>\n<p>以下是统计 G:/project/tungee/ 目录下的代码量，其中标红部分需要修改为自己的项目路径和 git 邮箱</p>\n<h2 id="第一版"><a href="#%E7%AC%AC%E4%B8%80%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第一版</h2>\n<h3 id="按项目统计"><a href="#%E6%8C%89%E9%A1%B9%E7%9B%AE%E7%BB%9F%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>按项目统计</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53618646557261650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\nset -euo pipefail\ntrap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array(){\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n  echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n  read input\n  files=(\\$(to_array \\$input))\n  echo -e &quot;\\n&quot;\n  for file in \\${files[@]}\n  do\n    if [ ! -d &quot;G:/project/tungee/\\$file&quot; ]; then\n      echo -e &quot;\\$file 目录不存在。&quot;\n      continue;\n    fi\n    if [ ! -d &quot;G:/project/tungee/\\$file/.git&quot; ]; then\n      echo -e &quot;\\$file 不是git仓库。&quot;\n      continue;\n    fi\n    cd &quot;G:/project/tungee/\\$file&quot;\n    echo &quot;\\$file 代码量统计：&quot;\n    i=\\`date +%w\\`\n    while [ \\$i -ge 1 ]\n    do\n      sinceDate=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      untilDate=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      git log --author=&quot;634407147@qq.com&quot; --since=\\$sinceDate --until=\\$untilDate --pretty=tformat: --numstat | gawk \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$untilDate\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n      i=\\$((\\$i-1))\n    done\n    echo -e &quot;\\n&quot;\n  done\n}`, `53618646557261650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash{25,29,33,40}"\n              >\n                <span class="gatsby-code-button-language">bash{25,29,33,40}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token builtin class-name">set</span> -euo pipefail\n<span class="token builtin class-name">trap</span> <span class="token string">"echo \'error: Script failed: see failed command above\'"</span> ERR\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">files</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>"</span>\n  <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${files<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n<span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"G:/project/tungee/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>      <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n      <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n    <span class="token keyword">fi</span>\n<span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"G:/project/tungee/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>      <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n      <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n    <span class="token keyword">fi</span>\n<span class="gatsby-highlight-code-line">    <span class="token builtin class-name">cd</span> <span class="token string">"G:/project/tungee/<span class="token variable">$file</span>"</span></span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$file</span> 代码量统计："</span>\n    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%w<span class="token variable">`</span></span>\n    <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n    <span class="token keyword">do</span>\n      <span class="token assign-left variable">sinceDate</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token assign-left variable">untilDate</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n<span class="gatsby-highlight-code-line">      <span class="token function">git</span> log --author<span class="token operator">=</span><span class="token string">"634407147@qq.com"</span> --since<span class="token operator">=</span><span class="token variable">$sinceDate</span> --until<span class="token operator">=</span><span class="token variable">$untilDate</span> --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">gawk</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "\'</span><span class="token variable">$untilDate</span><span class="token string">\' 增加行总数：%s，删除行总数：%s，总代码行：%s<span class="token entity" title="\\n">\\n</span>", add, subs, loc }\'</span></span>      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>"</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-d5813.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 443px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 68.62302483069978%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABq0lEQVQoz5WS647bIBCFiQ34khobbIPBxJf4nsSVmo227/9mnTjVatNmpXZ+IBg4o28Ogxzr0COlledrD3GEMrR39hbZGCXhN6QU4hztduh1TN3UN8MyLaYwRmlrrK1sYYtYJEpC6qB1San3WixlluZZnudxHKdCpGmWQSLPH5sgCHzfdxxnt8ULPWQf167rEkq/pvwruq5tj8e6ro3Ryzxfrz+6rqeEAAWwCCE86hGCk4RzwR3Xfe55mpqm0UXRd926rvM8T/NECX57u47TdLvd7qIkPp8v6/rdD4InMec8ihg0liQJtAqNggHAXxQKrrTW0HYYBmkKKAJj/CQGJEyw5/kg+NLVD3f+OJemrKsDIJ1PC/Cj/4r22JZl2Tb1z/f3fhhYzIDTdTGlhDEWhnsIoIUj5MFC+A5CyO9vG8exqmolFegvl8tm2ByG4Tj0y+kELh0OFReibdu+H7TRUG6rvtmulAKPYsbAK2sBwhRaR1EEE2JLawxkyogxKe9TpJSEx+A5QN3FGLswIBvYJ55/jDRLoQx8iZQSVt8PHjP3WD+m8nNm29y1vwBcbSf6ZBrDjAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 05 22 22 18 59" title="" data-src="/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-d5813.png" data-srcset="/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-bf07a.png 200w,\n/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-250cd.png 400w,\n/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-d5813.png 443w" data-sizes="(max-width: 443px) 100vw, 443px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>以上更新于<code class="language-text">2019-5-22 22:17:24</code></p>\n<hr>\n<h2 id="第二版"><a href="#%E7%AC%AC%E4%BA%8C%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第二版</h2>\n<h3 id="增加按日期统计和-shell-参数输入"><a href="#%E5%A2%9E%E5%8A%A0%E6%8C%89%E6%97%A5%E6%9C%9F%E7%BB%9F%E8%AE%A1%E5%92%8C-shell-%E5%8F%82%E6%95%B0%E8%BE%93%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>增加按日期统计和 shell 参数输入</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39370380319470290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\nset -euo pipefail\ntrap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array() {\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n\n  file_path=&quot;G:/project/tungee&quot;\n  git_email=&quot;634407147@qq.com&quot;\n  date_stat=&quot;date +%w&quot; # 今天是一周的第几天，可换成具体数字 date_stat=&quot;echo 5&quot; 以实现统计几天前代码的功能\n\n  if [ \\$# -lt 1 ]; then\n    echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n    read input\n    files=(\\$(to_array \\$input))\n  else\n    files=\\$*\n  fi\n\n  echo -e &quot;按日期统计：&quot;\n  i=\\$(\\$date_stat)\n  while [ \\$i -ge 1 ]\n  do\n    add_sum=0\n    subs_sum=0\n    loc_sum=0\n    for file in \\${files[@]}\n    do\n      if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n        echo -e &quot;\\$file 目录不存在。&quot;\n        continue;\n      fi\n      if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n        echo -e &quot;\\$file 不是git仓库。&quot;\n        continue;\n      fi\n      cd &quot;\\$file_path/\\$file&quot;\n      since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      eval \\$(git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;add=%s; subs=%s; loc=%s;&quot;, add, subs, loc }\')\n      add_sum=\\$((\\$add_sum + \\$add))\n      subs_sum=\\$((\\$subs_sum + \\$subs))\n      loc_sum=\\$((\\$loc_sum + \\$loc))\n    done\n    printf &quot;\\$until_date 增加行总数：\\$add_sum，删除行总数：\\$subs_sum，总代码行：\\$loc_sum\\n&quot;\n    i=\\$((\\$i-1))\n  done\n\n  echo -e &quot;\\n按项目统计：&quot;\n  for file in \\${files[@]}\n  do\n    if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n      echo -e &quot;\\$file 目录不存在。&quot;\n      continue;\n    fi\n    if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n      echo -e &quot;\\$file 不是git仓库。&quot;\n      continue;\n    fi\n    cd &quot;\\$file_path/\\$file&quot;\n    echo &quot;\\$file 代码量统计：&quot;\n    i=\\$(\\$date_stat)\n    while [ \\$i -ge 1 ]\n    do\n      since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n      i=\\$((\\$i-1))\n    done\n  done\n}`, `39370380319470290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash{21-22}"\n              >\n                <span class="gatsby-code-button-language">bash{21-22}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token builtin class-name">set</span> -euo pipefail\n<span class="token builtin class-name">trap</span> <span class="token string">"echo \'error: Script failed: see failed command above\'"</span> ERR\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token assign-left variable">file_path</span><span class="token operator">=</span><span class="token string">"G:/project/tungee"</span></span><span class="gatsby-highlight-code-line">  <span class="token assign-left variable">git_email</span><span class="token operator">=</span><span class="token string">"634407147@qq.com"</span></span>  <span class="token assign-left variable">date_stat</span><span class="token operator">=</span><span class="token string">"date +%w"</span> <span class="token comment"># 今天是一周的第几天，可换成具体数字 date_stat="echo 5" 以实现统计几天前代码的功能</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> -lt <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n    <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n    <span class="token builtin class-name">read</span> input\n    <span class="token assign-left variable">files</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token keyword">else</span>\n    <span class="token assign-left variable">files</span><span class="token operator">=</span><span class="token variable">$*</span>\n  <span class="token keyword">fi</span>\n\n  <span class="token builtin class-name">echo</span> -e <span class="token string">"按日期统计："</span>\n  <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$date_stat<span class="token variable">)</span></span>\n  <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n  <span class="token keyword">do</span>\n    <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token number">0</span>\n    <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token number">0</span>\n    <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token number">0</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${files<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n      <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log --author<span class="token operator">=</span>$git_email --since<span class="token operator">=</span>$since_date --until<span class="token operator">=</span>$until_date --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "add=%s; subs=%s; loc=%s;", add, subs, loc }\'</span><span class="token variable">)</span></span>\n      <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$add_sum <span class="token operator">+</span> $add<span class="token variable">))</span></span>\n      <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$subs_sum <span class="token operator">+</span> $subs<span class="token variable">))</span></span>\n      <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$loc_sum <span class="token operator">+</span> $loc<span class="token variable">))</span></span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">$until_date</span> 增加行总数：<span class="token variable">$add_sum</span>，删除行总数：<span class="token variable">$subs_sum</span>，总代码行：<span class="token variable">$loc_sum</span><span class="token entity" title="\\n">\\n</span>"</span>\n    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n  <span class="token keyword">done</span>\n\n  <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>按项目统计："</span>\n  <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${files<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n      <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n    <span class="token keyword">fi</span>\n    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n      <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n    <span class="token keyword">fi</span>\n    <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$file</span> 代码量统计："</span>\n    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$date_stat<span class="token variable">)</span></span>\n    <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n    <span class="token keyword">do</span>\n      <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token function">git</span> log --author<span class="token operator">=</span><span class="token variable">$git_email</span> --since<span class="token operator">=</span><span class="token variable">$since_date</span> --until<span class="token operator">=</span><span class="token variable">$until_date</span> --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "\'</span><span class="token variable">$until_date</span><span class="token string">\' 增加行总数：%s，删除行总数：%s，总代码行：%s<span class="token entity" title="\\n">\\n</span>", add, subs, loc }\'</span>\n      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n    <span class="token keyword">done</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-1"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-5032e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 438px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 92.46575342465754%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACrElEQVQ4y3VT13KjMBR1sClGoohmRBUSotvOTv7/3/bITrJPe2eY4SLdcgqnpq2VVnrRSZHSgLCMJUkaB3EUREFIGQuD4Ho6nT4+rNMrLMtCgjDJpKdRqaZum6oexNA0bVVVPqFRFCol67oVYojimMWsKHIpZVmWNAiI75viYRjqqsqzfBD9vu/TNI2jjhkrsuw4dq3HfdvjJCnLW9u24zjicoCVKDHFWk8YWFW1VvL5fGzbNs0zJqHX5+fnuqzrukVRVFd8nqd5WbI0o5Tatm2KcRAAlnf1fYIXQnycOY7r+1fMxyl2dhzH81xsi5m2jXfvjf8kRA8kGE4oxdcsy3zgefPx//ghbJoBu+/7oe/ux/H19YU9CSG8LEFVXdclr1zXzdJUSpUXBd6t39bDIJu6LvJCCrEsixpHXIpZ0nXd/X7M84xeYRC2bSOEkEoVRQGM6G6KlVKgschvou/2fZvnBfdfhAkUY69l3QC1bRo0EoOEZi4ocd03Zgn20fjP87luGxozxsAQYzH0S2EYxmz7AtnTNA3C0LGdj9+1DbDKhJm4rl3XcygZhsYkUjZNA0bCKI7CKE0S8Mo5xyl9rw3du7a93W4Q9tj32cQCTbDn4/mYpwlrQ7ya8+O490IAguPY35OBuWub260E28Yh2jgM2hrDHTCcHvWEXlXF9TQNUlIKU/zo3MNenIMz+GlZ1izPsbLreZT40JyZSAw/rhvHUZIkOHJ/i1+TW9h9ho33HTghHiEUUoEFJP0gPe8KwYGH88q/Xi3rhzDYC/BAct+1IExrrdTIkhR7btsKCOu6QDle8qapcQTCIDJY+Cas7wU+qUEch3EFsIVhiJn3+x0/GVLiE1Tux2EIo8H5fP5W63K5mMSyLueLa8CZB3+8Y8J95/DjK3X+lb3iLxdnWiZOBA7KAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 05 27 17 41 19" title="" data-src="/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-5032e.png" data-srcset="/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-86481.png 200w,\n/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-1ca59.png 400w,\n/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-5032e.png 438w" data-sizes="(max-width: 438px) 100vw, 438px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="第三版"><a href="#%E7%AC%AC%E4%B8%89%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第三版</h2>\n<h3 id="增加按分支统计的功能，去掉-shell-参数输入（暂时不支持）"><a href="#%E5%A2%9E%E5%8A%A0%E6%8C%89%E5%88%86%E6%94%AF%E7%BB%9F%E8%AE%A1%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%8E%BB%E6%8E%89-shell-%E5%8F%82%E6%95%B0%E8%BE%93%E5%85%A5%EF%BC%88%E6%9A%82%E6%97%B6%E4%B8%8D%E6%94%AF%E6%8C%81%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>增加按分支统计的功能，去掉 shell 参数输入（暂时不支持）</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17964975040340270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\n# set -euo pipefail\n# trap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array() {\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n\n  file_path=&quot;G:/project/tungee&quot;\n  git_email=&quot;634407147@qq.com&quot;\n  date_stat=&quot;date +%w&quot; # 今天是一周的第几天，可换成具体数字如 date_stat=&quot;echo 5&quot; 以实现统计几天前代码的功能\n\n  echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n  read input\n  projects=(\\$(to_array \\$input))\n  echo &quot;输入分支名，以英文逗号分隔，不能有空格&quot;\n  read input\n  branches=(\\$(to_array \\$input))\n\n  for branch in \\${branches[@]}\n  do\n    exist_branch_projects=()\n    for file in \\${projects[@]}\n    do\n      if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n        echo -e &quot;\\$file 目录不存在。&quot;\n        continue;\n      fi\n      if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n        echo -e &quot;\\$file 不是git仓库。&quot;\n        continue;\n      fi\n      cd &quot;\\$file_path/\\$file&quot;\n      git checkout \\$branch -q >/dev/null 2>&1 # 重定向错误信息，即屏蔽错误信息\n      if [ \\$? -ne 0 ]; then\n        echo -e &quot;\\n\\$file 切换分支到 \\$branch 失败，可能不存在此分支&quot;\n      else\n        exist_branch_projects+=(\\$file)\n        git pull origin \\$branch -q\n      fi\n    done\n    echo -e &quot;\\n分支 \\$branch 上的代码统计：&quot;\n    {\n      echo -e &quot;按日期统计：&quot;\n      i=\\$(\\$date_stat)\n      while [ \\$i -ge 1 ]\n      do\n        add_sum=0\n        subs_sum=0\n        loc_sum=0\n        for file in \\${exist_branch_projects[@]}\n        do\n          if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n            echo -e &quot;\\$file 目录不存在。&quot;\n            continue;\n          fi\n          if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n            echo -e &quot;\\$file 不是git仓库。&quot;\n            continue;\n          fi\n          cd &quot;\\$file_path/\\$file&quot;\n          # git checkout master\n          since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n          until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n          eval \\$(git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;add=%s; subs=%s; loc=%s;&quot;, add, subs, loc }\')\n          add_sum=\\$((\\$add_sum + \\$add))\n          subs_sum=\\$((\\$subs_sum + \\$subs))\n          loc_sum=\\$((\\$loc_sum + \\$loc))\n        done\n        printf &quot;\\$until_date 增加行总数：\\$add_sum，删除行总数：\\$subs_sum，总代码行：\\$loc_sum\\n&quot;\n        i=\\$((\\$i-1))\n      done\n\n      echo -e &quot;按项目统计：&quot;\n      for file in \\${exist_branch_projects[@]}\n      do\n        if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n          echo -e &quot;\\$file 目录不存在。&quot;\n          continue;\n        fi\n        if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n          echo -e &quot;\\$file 不是git仓库。&quot;\n          continue;\n        fi\n        cd &quot;\\$file_path/\\$file&quot;\n        # git checkout master\n        echo &quot;\\$file 代码量统计：&quot;\n        i=\\$(\\$date_stat)\n        while [ \\$i -ge 1 ]\n        do\n          since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n          until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n          git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n          i=\\$((\\$i-1))\n        done\n      done\n    }\n  done\n}`, `17964975040340270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token comment"># set -euo pipefail</span>\n<span class="token comment"># trap "echo \'error: Script failed: see failed command above\'" ERR</span>\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token assign-left variable">file_path</span><span class="token operator">=</span><span class="token string">"G:/project/tungee"</span>\n  <span class="token assign-left variable">git_email</span><span class="token operator">=</span><span class="token string">"634407147@qq.com"</span>\n  <span class="token assign-left variable">date_stat</span><span class="token operator">=</span><span class="token string">"date +%w"</span> <span class="token comment"># 今天是一周的第几天，可换成具体数字如 date_stat="echo 5" 以实现统计几天前代码的功能</span>\n\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入分支名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">branches</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n\n  <span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable">${branches<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n    <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n      <span class="token function">git</span> checkout <span class="token variable">$branch</span> -q <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token comment"># 重定向错误信息，即屏蔽错误信息</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span><span class="token variable">$file</span> 切换分支到 <span class="token variable">$branch</span> 失败，可能不存在此分支"</span>\n      <span class="token keyword">else</span>\n        <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>\n        <span class="token function">git</span> pull origin <span class="token variable">$branch</span> -q\n      <span class="token keyword">fi</span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>分支 <span class="token variable">$branch</span> 上的代码统计："</span>\n    <span class="token punctuation">{</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"按日期统计："</span>\n      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$date_stat<span class="token variable">)</span></span>\n      <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n      <span class="token keyword">do</span>\n        <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${exist_branch_projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n        <span class="token keyword">do</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n          <span class="token comment"># git checkout master</span>\n          <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log --author<span class="token operator">=</span>$git_email --since<span class="token operator">=</span>$since_date --until<span class="token operator">=</span>$until_date --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "add=%s; subs=%s; loc=%s;", add, subs, loc }\'</span><span class="token variable">)</span></span>\n          <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$add_sum <span class="token operator">+</span> $add<span class="token variable">))</span></span>\n          <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$subs_sum <span class="token operator">+</span> $subs<span class="token variable">))</span></span>\n          <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$loc_sum <span class="token operator">+</span> $loc<span class="token variable">))</span></span>\n        <span class="token keyword">done</span>\n        <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">$until_date</span> 增加行总数：<span class="token variable">$add_sum</span>，删除行总数：<span class="token variable">$subs_sum</span>，总代码行：<span class="token variable">$loc_sum</span><span class="token entity" title="\\n">\\n</span>"</span>\n        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n      <span class="token keyword">done</span>\n\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"按项目统计："</span>\n      <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${exist_branch_projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n      <span class="token keyword">do</span>\n        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n          <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n          <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n        <span class="token keyword">fi</span>\n        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n          <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n          <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n        <span class="token keyword">fi</span>\n        <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n        <span class="token comment"># git checkout master</span>\n        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$file</span> 代码量统计："</span>\n        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$date_stat<span class="token variable">)</span></span>\n        <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n        <span class="token keyword">do</span>\n          <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token function">git</span> log --author<span class="token operator">=</span><span class="token variable">$git_email</span> --since<span class="token operator">=</span><span class="token variable">$since_date</span> --until<span class="token operator">=</span><span class="token variable">$until_date</span> --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "\'</span><span class="token variable">$until_date</span><span class="token string">\' 增加行总数：%s，删除行总数：%s，总代码行：%s<span class="token entity" title="\\n">\\n</span>", add, subs, loc }\'</span>\n          <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n        <span class="token keyword">done</span>\n      <span class="token keyword">done</span>\n    <span class="token punctuation">}</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-2"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-aee79.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 563px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 74.06749555950266%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABjklEQVQoz41T2ZKkIBBsbW9OARXQ9r7m/39ws3si9klnpp4qCJI8qnjELsl8llVZoIJABCY05aNkLDBVmCbB4+fq+2EcR+d99SlTGS54KWVTN4TSX8DneY7j0Pf96/UygBojpNSqbNuWcY4LQXDP/7ktyrIsiiLPC0JoGIaPP9b59XUeh3WurirnnNYar3DOCSFJkmRZxhhP0+yaf993qAYMyt9SGQMeRtBTypRSXdvCyLWcdV3neUZUrffHcXAukiSmlMJDFEVxHH9LuJb96ntnm2VZj/MAuRTSfDN3UME1mLvulnlZltY7cCJ27z0AkIrsrbVFQaQQUHQLxlX5SdtaV9c1ZxzM3jt4xiFmAUd5nl8HJlFCvAcmQADNhlEKqwAQAuP5M4p+WpJ92xprtVZ1XZVKfWAEQ3o+n+/AiiJN02vmdd2wX3A4DAOywaiM0fM8YeHegWmFRt553vZ9nqamabxz27YxLjChPM/+M6OJ7pR33cs2UG2xLdu2KqXxEDr8Fi4kfso0jUrrS+Z/BRAp/jUC8aQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 08 13 17 03 10" title="" data-src="/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-aee79.png" data-srcset="/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-b3674.png 200w,\n/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-2063d.png 400w,\n/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-aee79.png 563w" data-sizes="(max-width: 563px) 100vw, 563px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>以上更新于<code class="language-text">2019-8-15 20:49:40</code></p>\n<hr>\n<h2 id="第四版"><a href="#%E7%AC%AC%E5%9B%9B%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第四版</h2>\n<p>第三版的统计代码的数量对不上对应的时间，把昨天写的代码统计到今天了，做以下修复</p>\n<p>同时增加星期几的优化提示</p>\n<h3 id="修复代码统计对应不上错误的时间以及添加星期几的提示"><a href="#%E4%BF%AE%E5%A4%8D%E4%BB%A3%E7%A0%81%E7%BB%9F%E8%AE%A1%E5%AF%B9%E5%BA%94%E4%B8%8D%E4%B8%8A%E9%94%99%E8%AF%AF%E7%9A%84%E6%97%B6%E9%97%B4%E4%BB%A5%E5%8F%8A%E6%B7%BB%E5%8A%A0%E6%98%9F%E6%9C%9F%E5%87%A0%E7%9A%84%E6%8F%90%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复代码统计对应不上错误的时间以及添加星期几的提示</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52355512844494600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\n# set -euo pipefail\n# trap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array() {\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n\n  file_path=&quot;G:/project/tungee&quot;\n  git_email=&quot;634407147@qq.com&quot;\n  date_stat=&quot;date +%w&quot; # 今天是一周的第几天，可换成具体数字如 date_stat=&quot;echo 5&quot; 以实现统计几天前代码的功能\n\n  # if [ \\$date_stat -eq 0 ]; then\n  #   date_stat=7\n  # fi\n\n  echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n  read input\n  projects=(\\$(to_array \\$input))\n  echo &quot;输入分支名，以英文逗号分隔，不能有空格&quot;\n  read input\n  branches=(\\$(to_array \\$input))\n\n  for branch in \\${branches[@]}\n  do\n    exist_branch_projects=()\n    for file in \\${projects[@]}\n    do\n      if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n        echo -e &quot;\\$file 目录不存在。&quot;\n        continue;\n      fi\n      if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n        echo -e &quot;\\$file 不是git仓库。&quot;\n        continue;\n      fi\n      cd &quot;\\$file_path/\\$file&quot;\n      git checkout \\$branch -q >/dev/null 2>&1 # 重定向错误信息，即屏蔽错误信息\n      if [ \\$? -eq 0 ]; then\n        exist_branch_projects+=(\\$file)\n        git pull origin \\$branch -q\n      # else\n      #   # echo -e &quot;\\n\\$file 切换分支到 \\$branch 失败，可能不存在此分支&quot;\n      fi\n    done\n    echo -e &quot;\\n分支 \\$branch 上的代码统计：&quot;\n    {\n      echo -e &quot;按日期统计：&quot;\n      # 或 i=\\$((\\$(\\$date_stat)-1))\n      # \\$((\\$a+\\$b)) 用于整数运算，相当于 \\`expr \\$a + \\$b\\`\n      # \\$() 与 \\`\\` 相当于命令替换，执行结果替换\n      i=\\`expr \\$(\\$date_stat) - 1\\`\n      while [ \\$i -ge 0 ]\n      do\n        add_sum=0\n        subs_sum=0\n        loc_sum=0\n        for file in \\${exist_branch_projects[@]}\n        do\n          if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n            echo -e &quot;\\$file 目录不存在。&quot;\n            continue;\n          fi\n          if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n            echo -e &quot;\\$file 不是git仓库。&quot;\n            continue;\n          fi\n          cd &quot;\\$file_path/\\$file&quot;\n          # git checkout \\$branch\n          since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n          since_week=\\`date -d &quot;-\\$i day&quot; +%A\\`\n          until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n          eval \\$(git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;add=%s; subs=%s; loc=%s;&quot;, add, subs, loc }\')\n          add_sum=\\$((\\$add_sum + \\$add))\n          subs_sum=\\$((\\$subs_sum + \\$subs))\n          loc_sum=\\$((\\$loc_sum + \\$loc))\n        done\n        printf &quot;\\$since_date（\\$since_week） 增加行总数：\\$add_sum，删除行总数：\\$subs_sum，总代码行：\\$loc_sum\\n&quot;\n        i=\\$((\\$i-1))\n      done\n\n      # echo -e &quot;按项目统计：&quot;\n      # for file in \\${exist_branch_projects[@]}\n      # do\n      #   if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n      #     echo -e &quot;\\$file 目录不存在。&quot;\n      #     continue;\n      #   fi\n      #   if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n      #     echo -e &quot;\\$file 不是git仓库。&quot;\n      #     continue;\n      #   fi\n      #   cd &quot;\\$file_path/\\$file&quot;\n      #   # git checkout \\$branch\n      #   echo &quot;\\$file 代码量统计：&quot;\n      #   i=\\$(\\$date_stat)\n      #   while [ \\$i -ge 1 ]\n      #   do\n      #     since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      #     until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      #     git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n      #     i=\\$((\\$i-1))\n      #   done\n      # done\n    }\n  done\n}`, `52355512844494600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash{61-65,83,90}"\n              >\n                <span class="gatsby-code-button-language">bash{61-65,83,90}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token comment"># set -euo pipefail</span>\n<span class="token comment"># trap "echo \'error: Script failed: see failed command above\'" ERR</span>\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token assign-left variable">file_path</span><span class="token operator">=</span><span class="token string">"G:/project/tungee"</span>\n  <span class="token assign-left variable">git_email</span><span class="token operator">=</span><span class="token string">"634407147@qq.com"</span>\n  <span class="token assign-left variable">date_stat</span><span class="token operator">=</span><span class="token string">"date +%w"</span> <span class="token comment"># 今天是一周的第几天，可换成具体数字如 date_stat="echo 5" 以实现统计几天前代码的功能</span>\n\n  <span class="token comment"># if [ $date_stat -eq 0 ]; then</span>\n  <span class="token comment">#   date_stat=7</span>\n  <span class="token comment"># fi</span>\n\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入分支名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">branches</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n\n  <span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable">${branches<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n    <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n      <span class="token function">git</span> checkout <span class="token variable">$branch</span> -q <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token comment"># 重定向错误信息，即屏蔽错误信息</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>\n        <span class="token function">git</span> pull origin <span class="token variable">$branch</span> -q\n      <span class="token comment"># else</span>\n      <span class="token comment">#   # echo -e "\\n$file 切换分支到 $branch 失败，可能不存在此分支"</span>\n      <span class="token keyword">fi</span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>分支 <span class="token variable">$branch</span> 上的代码统计："</span>\n    <span class="token punctuation">{</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"按日期统计："</span>\n<span class="gatsby-highlight-code-line">      <span class="token comment"># 或 i=$(($($date_stat)-1))</span></span><span class="gatsby-highlight-code-line">      <span class="token comment"># $(($a+$b)) 用于整数运算，相当于 `expr $a + $b`</span></span><span class="gatsby-highlight-code-line">      <span class="token comment"># $() 与 `` 相当于命令替换，执行结果替换</span></span><span class="gatsby-highlight-code-line">      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">expr</span> <span class="token punctuation">$(</span>$date_stat<span class="token punctuation">)</span> - <span class="token number">1</span><span class="token variable">`</span></span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">0</span> <span class="token punctuation">]</span></span>      <span class="token keyword">do</span>\n        <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${exist_branch_projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n        <span class="token keyword">do</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n          <span class="token comment"># git checkout $branch</span>\n          <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n<span class="gatsby-highlight-code-line">          <span class="token assign-left variable">since_week</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%A<span class="token variable">`</span></span></span>          <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log --author<span class="token operator">=</span>$git_email --since<span class="token operator">=</span>$since_date --until<span class="token operator">=</span>$until_date --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "add=%s; subs=%s; loc=%s;", add, subs, loc }\'</span><span class="token variable">)</span></span>\n          <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$add_sum <span class="token operator">+</span> $add<span class="token variable">))</span></span>\n          <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$subs_sum <span class="token operator">+</span> $subs<span class="token variable">))</span></span>\n          <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$loc_sum <span class="token operator">+</span> $loc<span class="token variable">))</span></span>\n        <span class="token keyword">done</span>\n<span class="gatsby-highlight-code-line">        <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">$since_date</span>（<span class="token variable">$since_week</span>） 增加行总数：<span class="token variable">$add_sum</span>，删除行总数：<span class="token variable">$subs_sum</span>，总代码行：<span class="token variable">$loc_sum</span><span class="token entity" title="\\n">\\n</span>"</span></span>        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n      <span class="token keyword">done</span>\n\n      <span class="token comment"># echo -e "按项目统计："</span>\n      <span class="token comment"># for file in ${exist_branch_projects[@]}</span>\n      <span class="token comment"># do</span>\n      <span class="token comment">#   if [ ! -d "$file_path/$file" ]; then</span>\n      <span class="token comment">#     echo -e "$file 目录不存在。"</span>\n      <span class="token comment">#     continue;</span>\n      <span class="token comment">#   fi</span>\n      <span class="token comment">#   if [ ! -d "$file_path/$file/.git" ]; then</span>\n      <span class="token comment">#     echo -e "$file 不是git仓库。"</span>\n      <span class="token comment">#     continue;</span>\n      <span class="token comment">#   fi</span>\n      <span class="token comment">#   cd "$file_path/$file"</span>\n      <span class="token comment">#   # git checkout $branch</span>\n      <span class="token comment">#   echo "$file 代码量统计："</span>\n      <span class="token comment">#   i=$($date_stat)</span>\n      <span class="token comment">#   while [ $i -ge 1 ]</span>\n      <span class="token comment">#   do</span>\n      <span class="token comment">#     since_date=`date -d "-$i day" +%Y-%m-%d`</span>\n      <span class="token comment">#     until_date=`date -d "-$(($i-1)) day" +%Y-%m-%d`</span>\n      <span class="token comment">#     git log --author=$git_email --since=$since_date --until=$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += $1 ; subs += $2 ; loc += $1 - $2 } END { printf "\'$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n", add, subs, loc }\'</span>\n      <span class="token comment">#     i=$(($i-1))</span>\n      <span class="token comment">#   done</span>\n      <span class="token comment"># done</span>\n    <span class="token punctuation">}</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-3"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-72de5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 648px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 65.74074074074075%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABh0lEQVQoz4WS23KjMBBEuScYvAJJgC6AJSQRA/H//17azlO8rvI8gKpET8+cJjrJE5lJycuYJOSjYQn7R1LK8iRNorflrXPGaantbC7m0vC264ZRT5+f5Xtx33eUUd7xfui10nVV53l+Kss0Td+LRz1O03y+V900TZZncRzFcZwkSfqoOIpwzrIs+b+d90FKta6rc34Y+hDCsiyMsa9HMcrQ21pLCCmK/Fm8hqD1eBzHsjit1b7v0A+DOPb9dvvWuBsnYwzemOtUVX/Ezjk4b9t23bZxHK/XK8Sc8+A9xPM8MZydsxgHGeR/zcUgCGkgw3iM0mma4AUTyGCIaTnvlFJ1XT8rUVIIpRW+xnVVVXhSys71GbziR4EZgL2mjSWNseudkxNCgBYMKaVAaB6cMAvGKj6KV1GNE2Pcez/PFzEMv7Qh3rc7uaZp0Wue56J4JQYYrLSB0/qllEQ8i3OI6vZ9wLxtW2sN2r3+4ayxUsgQPHykFOj1mzP4hzVQhpxH5AwW2P9J+wMBHDBe9cJk8AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 03 07 12 12 03" title="" data-src="/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-72de5.png" data-srcset="/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-bb436.png 200w,\n/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-c5634.png 400w,\n/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-72de5.png 648w" data-sizes="(max-width: 648px) 100vw, 648px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>以上更新于<code class="language-text">2020-3-7 11:57:55</code></p>\n<hr>\n<h2 id="第五版"><a href="#%E7%AC%AC%E4%BA%94%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第五版</h2>\n<p>第四版的代码统计今天的代码有 2 个问题：</p>\n<ol>\n<li>当 i 循环到 0 时，<code class="language-text">-$(($i-1))</code> 这一行代码有问题，统计到的 <code class="language-text">until_date</code> 比 <code class="language-text">since_date</code> 反而早了一天，造成脚本统计错误</li>\n<li>统计今天的代码时，只传年月日会默认带上当前时分秒的时间导致统计不上，即还要加上时分秒，否则不能统计到今天的代码</li>\n</ol>\n<h3 id="修复统计今天代码"><a href="#%E4%BF%AE%E5%A4%8D%E7%BB%9F%E8%AE%A1%E4%BB%8A%E5%A4%A9%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复统计今天代码</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67104361245635570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\n# set -euo pipefail\n# trap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array() {\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n\n  file_path=&quot;G:/project/tungee&quot;\n  git_email=&quot;634407147@qq.com&quot;\n  date_stat=&quot;echo 9&quot; # 今天是一周的第几天，可换成具体数字如 date_stat=&quot;echo 5&quot; 以实现统计几天前代码的功能\n\n  # if [ \\$date_stat -eq 0 ]; then\n  #   date_stat=7\n  # fi\n\n  echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n  read input\n  projects=(\\$(to_array \\$input))\n  echo &quot;输入分支名，以英文逗号分隔，不能有空格&quot;\n  read input\n  branches=(\\$(to_array \\$input))\n\n  for branch in \\${branches[@]}\n  do\n    exist_branch_projects=()\n    for file in \\${projects[@]}\n    do\n      if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n        echo -e &quot;\\$file 目录不存在。&quot;\n        continue;\n      fi\n      if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n        echo -e &quot;\\$file 不是git仓库。&quot;\n        continue;\n      fi\n      cd &quot;\\$file_path/\\$file&quot;\n      git checkout \\$branch -q >/dev/null 2>&1 # 重定向错误信息，即屏蔽错误信息\n      if [ \\$? -eq 0 ]; then\n        exist_branch_projects+=(\\$file)\n        # git pull origin \\$branch -q\n      # else\n      #   # echo -e &quot;\\n\\$file 切换分支到 \\$branch 失败，可能不存在此分支&quot;\n      fi\n    done\n    echo -e &quot;\\n分支 \\$branch 上的代码统计：&quot;\n    {\n      echo -e &quot;按日期统计：&quot;\n      # 或 i=\\$((\\$(\\$date_stat)-1))\n      # \\$((\\$a+\\$b)) 用于整数运算，相当于 \\`expr \\$a + \\$b\\`\n      # \\$() 与 \\`\\` 相当于命令替换，执行结果替换\n      i=\\`expr \\$(\\$date_stat) - 1\\`\n      while [ \\$i -ge 0 ]\n      do\n        add_sum=0\n        subs_sum=0\n        loc_sum=0\n        for file in \\${exist_branch_projects[@]}\n        do\n          if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n            echo -e &quot;\\$file 目录不存在。&quot;\n            continue;\n          fi\n          if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n            echo -e &quot;\\$file 不是git仓库。&quot;\n            continue;\n          fi\n          cd &quot;\\$file_path/\\$file&quot;\n          # git checkout \\$branch\n          since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n          if [ \\$i -ge 1 ]; then\n            until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n          else\n            until_date=\\`date -d &quot;+\\$((0-\\$i+1)) day&quot; +%Y-%m-%d\\`\n          fi\n          eval \\$(git log --author=\\$git_email --since=&quot;\\$since_date 00:00:00&quot; --until=&quot;\\$until_date 00:00:00&quot; --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;add=%s; subs=%s; loc=%s;&quot;, add, subs, loc }\')\n          add_sum=\\$((\\$add_sum + \\$add))\n          subs_sum=\\$((\\$subs_sum + \\$subs))\n          loc_sum=\\$((\\$loc_sum + \\$loc))\n        done\n        since_week=\\`date -d &quot;-\\$i day&quot; +%A\\`\n        printf &quot;\\$since_date（\\$since_week） 增加行总数：\\$add_sum，删除行总数：\\$subs_sum，总代码行：\\$loc_sum\\n&quot;\n        i=\\$((\\$i-1))\n      done\n\n      # echo -e &quot;按项目统计：&quot;\n      # for file in \\${exist_branch_projects[@]}\n      # do\n      #   if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n      #     echo -e &quot;\\$file 目录不存在。&quot;\n      #     continue;\n      #   fi\n      #   if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n      #     echo -e &quot;\\$file 不是git仓库。&quot;\n      #     continue;\n      #   fi\n      #   cd &quot;\\$file_path/\\$file&quot;\n      #   # git checkout \\$branch\n      #   echo &quot;\\$file 代码量统计：&quot;\n      #   i=\\$(\\$date_stat)\n      #   while [ \\$i -ge 1 ]\n      #   do\n      #     since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      #     until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      #     git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n      #     i=\\$((\\$i-1))\n      #   done\n      # done\n    }\n  done\n}`, `67104361245635570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash{83-88}"\n              >\n                <span class="gatsby-code-button-language">bash{83-88}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token comment"># set -euo pipefail</span>\n<span class="token comment"># trap "echo \'error: Script failed: see failed command above\'" ERR</span>\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token assign-left variable">file_path</span><span class="token operator">=</span><span class="token string">"G:/project/tungee"</span>\n  <span class="token assign-left variable">git_email</span><span class="token operator">=</span><span class="token string">"634407147@qq.com"</span>\n  <span class="token assign-left variable">date_stat</span><span class="token operator">=</span><span class="token string">"echo 9"</span> <span class="token comment"># 今天是一周的第几天，可换成具体数字如 date_stat="echo 5" 以实现统计几天前代码的功能</span>\n\n  <span class="token comment"># if [ $date_stat -eq 0 ]; then</span>\n  <span class="token comment">#   date_stat=7</span>\n  <span class="token comment"># fi</span>\n\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入分支名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">branches</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n\n  <span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable">${branches<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n    <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n      <span class="token function">git</span> checkout <span class="token variable">$branch</span> -q <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token comment"># 重定向错误信息，即屏蔽错误信息</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>\n        <span class="token comment"># git pull origin $branch -q</span>\n      <span class="token comment"># else</span>\n      <span class="token comment">#   # echo -e "\\n$file 切换分支到 $branch 失败，可能不存在此分支"</span>\n      <span class="token keyword">fi</span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>分支 <span class="token variable">$branch</span> 上的代码统计："</span>\n    <span class="token punctuation">{</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"按日期统计："</span>\n      <span class="token comment"># 或 i=$(($($date_stat)-1))</span>\n      <span class="token comment"># $(($a+$b)) 用于整数运算，相当于 `expr $a + $b`</span>\n      <span class="token comment"># $() 与 `` 相当于命令替换，执行结果替换</span>\n      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">expr</span> <span class="token punctuation">$(</span>$date_stat<span class="token punctuation">)</span> - <span class="token number">1</span><span class="token variable">`</span></span>\n      <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">0</span> <span class="token punctuation">]</span>\n      <span class="token keyword">do</span>\n        <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${exist_branch_projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n        <span class="token keyword">do</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n          <span class="token comment"># git checkout $branch</span>\n          <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n<span class="gatsby-highlight-code-line">          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span><span class="gatsby-highlight-code-line">            <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span></span><span class="gatsby-highlight-code-line">          <span class="token keyword">else</span></span><span class="gatsby-highlight-code-line">            <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"+<span class="token variable"><span class="token variable">$((</span><span class="token number">0</span><span class="token operator">-</span>$i<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span></span><span class="gatsby-highlight-code-line">          <span class="token keyword">fi</span></span><span class="gatsby-highlight-code-line">          <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log --author<span class="token operator">=</span>$git_email --since<span class="token operator">=</span><span class="token string">"<span class="token variable">$since_date</span> 00:00:00"</span> --until<span class="token operator">=</span><span class="token string">"<span class="token variable">$until_date</span> 00:00:00"</span> --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "add=%s; subs=%s; loc=%s;", add, subs, loc }\'</span><span class="token variable">)</span></span></span>          <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$add_sum <span class="token operator">+</span> $add<span class="token variable">))</span></span>\n          <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$subs_sum <span class="token operator">+</span> $subs<span class="token variable">))</span></span>\n          <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$loc_sum <span class="token operator">+</span> $loc<span class="token variable">))</span></span>\n        <span class="token keyword">done</span>\n        <span class="token assign-left variable">since_week</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%A<span class="token variable">`</span></span>\n        <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">$since_date</span>（<span class="token variable">$since_week</span>） 增加行总数：<span class="token variable">$add_sum</span>，删除行总数：<span class="token variable">$subs_sum</span>，总代码行：<span class="token variable">$loc_sum</span><span class="token entity" title="\\n">\\n</span>"</span>\n        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n      <span class="token keyword">done</span>\n\n      <span class="token comment"># echo -e "按项目统计："</span>\n      <span class="token comment"># for file in ${exist_branch_projects[@]}</span>\n      <span class="token comment"># do</span>\n      <span class="token comment">#   if [ ! -d "$file_path/$file" ]; then</span>\n      <span class="token comment">#     echo -e "$file 目录不存在。"</span>\n      <span class="token comment">#     continue;</span>\n      <span class="token comment">#   fi</span>\n      <span class="token comment">#   if [ ! -d "$file_path/$file/.git" ]; then</span>\n      <span class="token comment">#     echo -e "$file 不是git仓库。"</span>\n      <span class="token comment">#     continue;</span>\n      <span class="token comment">#   fi</span>\n      <span class="token comment">#   cd "$file_path/$file"</span>\n      <span class="token comment">#   # git checkout $branch</span>\n      <span class="token comment">#   echo "$file 代码量统计："</span>\n      <span class="token comment">#   i=$($date_stat)</span>\n      <span class="token comment">#   while [ $i -ge 1 ]</span>\n      <span class="token comment">#   do</span>\n      <span class="token comment">#     since_date=`date -d "-$i day" +%Y-%m-%d`</span>\n      <span class="token comment">#     until_date=`date -d "-$(($i-1)) day" +%Y-%m-%d`</span>\n      <span class="token comment">#     git log --author=$git_email --since=$since_date --until=$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += $1 ; subs += $2 ; loc += $1 - $2 } END { printf "\'$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n", add, subs, loc }\'</span>\n      <span class="token comment">#     i=$(($i-1))</span>\n      <span class="token comment">#   done</span>\n      <span class="token comment"># done</span>\n    <span class="token punctuation">}</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-4"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-ad786.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 457px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.57986870897156%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABpElEQVQoz3VSyXabMBQVpWDAgIQkQELMYAgeyDlOnEVynO78/5/UW9plfVcCvXcnILayd+0uaANP+0QQwgm3hCFm7/hcEiHIziNP0ded0WXbtIwykXCRCJnJOKF+EEgcc8VY8nT5dDxy8Qeet0vTVKZpURgpZRiGWquyrHD1dDnLMs55oXWaZVoXZWl0UYRhZNs26DzPc10XY5Zl/Z23NvxbljAnZVEUcUzZhjiKKKW+H/i+xygFO6Xs/8rT4TCOY1NXYRzDZxSG+/0eVinINgpkQWwQw4LrOHEM8uin4/ywbTIO4zAMW7zy8XjkCgdz+/g4n0/9MERxvF4u58vler0qrYXgy7LgBewgEWnqGlFhHs5vt3eooTVM9F1bGIPa+r4DO9yhyygK67oeh55z4TgulA+4M8ZUZfX96xtSpTHXt/fl5aXrOnBBB1zrumZZzhid53lZjqgG6UjTNFhDZ0qpr6/PJEnyPIfPcRzKst6U+2mDUhqFtE0zTTM+kOf7BL9HVVVoBeL3+11tWF9fp+nQNC3qmTccTycsJ4yhITwmnKO+32/nM82XjX3jAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 04 24 12 11 28" title="" data-src="/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-ad786.png" data-srcset="/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-aaeb0.png 200w,\n/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-4d187.png 400w,\n/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-ad786.png 457w" data-sizes="(max-width: 457px) 100vw, 457px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/git代码统计脚本/index.md absPath of file >>> MarkdownRemark",timeToRead:11,frontmatter:{date:"2020-04-24 11:17:09",path:"/git-code-statistics-script/",tags:"Git, git 代码统计, 预研",title:"git代码统计脚本",draft:null}}],length:1,tag:"git 代码统计",pagesSum:1,page:1}}}});