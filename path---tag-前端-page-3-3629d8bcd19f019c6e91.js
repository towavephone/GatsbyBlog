webpackJsonp([0x7a92285cedda],{1511:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"WebGL 三维方向光源 实施光照的方式有很多种，最简单的可能就是方向光源了。 方向光是指光照均匀地来自某一个方向，晴朗天气下的太阳经常被当作方向光源，它距离太远所以光线被看作是平行的照到地面上。 计算方向光非常简单，将方向光的方向和面的朝向点乘就可以得到两个方向的余弦值。 这有个例子 随意拖动其中的点，如果两点方向刚好相反，点乘结果则为 -1，如果方向相同结果为 1。 这有什么用呢？如果将三维物体的朝向和光的方向点乘，结果为 1 则物体朝向和光照方向相同，为 -…",html:'<h1 id="webgl-三维方向光源"><a href="#webgl-%E4%B8%89%E7%BB%B4%E6%96%B9%E5%90%91%E5%85%89%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维方向光源</h1>\n<p>实施光照的方式有很多种，最简单的可能就是方向光源了。</p>\n<p>方向光是指光照均匀地来自某一个方向，晴朗天气下的太阳经常被当作方向光源，它距离太远所以光线被看作是平行的照到地面上。</p>\n<p>计算方向光非常简单，将方向光的方向和面的朝向点乘就可以得到两个方向的余弦值。</p>\n<p>这有个例子</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/jstbeo?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>随意拖动其中的点，如果两点方向刚好相反，点乘结果则为 -1，如果方向相同结果为 1。</p>\n<p>这有什么用呢？如果将三维物体的朝向和光的方向点乘，结果为 1 则物体朝向和光照方向相同，为 -1 则物体朝向和光照方向相反。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/j5lmj8?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>我们可以将颜色值和点乘结果相乘，有光了！</p>\n<p>还有一个问题，我们如何知道三维物体的朝向？</p>\n<h2 id="法向量"><a href="#%E6%B3%95%E5%90%91%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>法向量</h2>\n<p>我不知道为什么叫法向量，但是在三维图形学中法向量就是描述面的朝向的单位向量。</p>\n<p>这是正方体和球体的一些法向量。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/xyb9lu?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>这些插在物体上的线就是对应顶点的法向量。</p>\n<p>注意到正方体在每个顶角有 3 个法向量。这是因为需要 3 个法向量去描述相邻的每个面的朝向。</p>\n<p>这里的法向量是基于他们的方向着色的，正 x 方向为红色，上方向为绿色，正 z 方向为蓝色。</p>\n<p>让我们来给上节中的 F 添加法向量。由于 F 非常规则并且朝向都是 <code class="language-text">x, y, z</code> 轴，所以非常简单。正面的的部分法向量为 <code class="language-text">0, 0, 1</code>，背面的部分法向量为 <code class="language-text">0, 0, -1</code>，左面为 <code class="language-text">-1, 0, 0</code>，右面为 <code class="language-text">1, 0, 0</code>，上面为 <code class="language-text">0, 1, 0</code>，然后底面为 <code class="language-text">0, -1, 0</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53183201828966680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function setNormals(gl) {\n  var normals = new Float32Array([\n    // 正面左竖\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n\n    // 正面上横\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n\n    // 正面中横\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n\n    // 背面左竖\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n\n    // 背面上横\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n\n    // 背面中横\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n\n    // 顶部\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n\n    // 上横右面\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n\n    // 上横下面\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n\n    // 上横和中横之间\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n\n    // 中横上面\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n\n    // 中横右面\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n\n    // 中横底面\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n\n    // 底部右侧\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n\n    // 底面\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n\n    // 左面\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0\n  ]);\n  gl.bufferData(gl.ARRAY_BUFFER, normals, gl.STATIC_DRAW);\n}`, `53183201828966680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setNormals</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> normals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n    <span class="token comment">// 正面左竖</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 正面上横</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 正面中横</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 背面左竖</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 背面上横</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 背面中横</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 顶部</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 上横右面</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 上横下面</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 上横和中横之间</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 中横上面</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 中横右面</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 中横底面</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 底部右侧</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 底面</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 左面</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span>\n  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> normals<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在代码中使用它们，先移除顶点颜色以便观察光照效果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73052557407670490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 找顶点着色器中的属性\nvar positionLocation = gl.getAttribLocation(program, \'a_position\');\n// var colorLocation = gl.getAttribLocation(program, &quot;a_color&quot;);\nvar normalLocation = gl.getAttribLocation(program, \'a_normal\');\n\n// ...\n\n// // 创建一个缓冲存储颜色\n// var colorBuffer = gl.createBuffer();\n// // 绑定到 ARRAY_BUFFER\n// gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n// // 将几何数据放入缓冲\n// setColors(gl);\n\n// 创建缓冲存储法向量\nvar normalBuffer = gl.createBuffer();\n// 绑定到 ARRAY_BUFFER (可以看作 ARRAY_BUFFER = normalBuffer)\ngl.bindBuffer(gl.ARRAY_BUFFER, normalBuffer);\n// 将法向量存入缓冲\nsetNormals(gl);`, `73052557407670490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 找顶点着色器中的属性</span>\n<span class="token keyword">var</span> positionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// var colorLocation = gl.getAttribLocation(program, "a_color");</span>\n<span class="token keyword">var</span> normalLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_normal\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// // 创建一个缓冲存储颜色</span>\n<span class="token comment">// var colorBuffer = gl.createBuffer();</span>\n<span class="token comment">// // 绑定到 ARRAY_BUFFER</span>\n<span class="token comment">// gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);</span>\n<span class="token comment">// // 将几何数据放入缓冲</span>\n<span class="token comment">// setColors(gl);</span>\n\n<span class="token comment">// 创建缓冲存储法向量</span>\n<span class="token keyword">var</span> normalBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 绑定到 ARRAY_BUFFER (可以看作 ARRAY_BUFFER = normalBuffer)</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> normalBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 将法向量存入缓冲</span>\n<span class="token function">setNormals</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在渲染的时候</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35345307369788936000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// // 启用颜色属性\n// gl.enableVertexAttribArray(colorLocation);\n\n// // 绑定颜色缓冲\n// gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n\n// // 告诉颜色属性怎么从 colorBuffer(ARRAY_BUFFER) 中读取颜色值\n// var size = 3;                 // 每次迭代使用 3 个单位的数据\n// var type = gl.UNSIGNED_BYTE;  // 单位数据类型是无符号 8 位整数\n// var normalize = true;         // 标准化数据 (从 0-255 转换到 0.0-1.0)\n// var stride = 0;               // 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据\n// var offset = 0;               // 从绑定缓冲的起始处开始\n// gl.vertexAttribPointer(\n//     colorLocation, size, type, normalize, stride, offset)\n\n// 启用法向量属性\ngl.enableVertexAttribArray(normalLocation);\n\n// 绑定法向量缓冲\ngl.bindBuffer(gl.ARRAY_BUFFER, normalBuffer);\n\n// 告诉法向量属性怎么从 normalBuffer (ARRAY_BUFFER) 中读取值\nvar size = 3; // 每次迭代使用 3 个单位的数据\nvar type = gl.FLOAT; // 单位数据类型是 32 位浮点型\nvar normalize = false; // 单位化 (从 0-255 转换到 0-1)\nvar stride = 0; // 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(normalLocation, size, type, normalize, stride, offset);`, `35345307369788936000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// // 启用颜色属性</span>\n<span class="token comment">// gl.enableVertexAttribArray(colorLocation);</span>\n\n<span class="token comment">// // 绑定颜色缓冲</span>\n<span class="token comment">// gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);</span>\n\n<span class="token comment">// // 告诉颜色属性怎么从 colorBuffer(ARRAY_BUFFER) 中读取颜色值</span>\n<span class="token comment">// var size = 3;                 // 每次迭代使用 3 个单位的数据</span>\n<span class="token comment">// var type = gl.UNSIGNED_BYTE;  // 单位数据类型是无符号 8 位整数</span>\n<span class="token comment">// var normalize = true;         // 标准化数据 (从 0-255 转换到 0.0-1.0)</span>\n<span class="token comment">// var stride = 0;               // 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token comment">// var offset = 0;               // 从绑定缓冲的起始处开始</span>\n<span class="token comment">// gl.vertexAttribPointer(</span>\n<span class="token comment">//     colorLocation, size, type, normalize, stride, offset)</span>\n\n<span class="token comment">// 启用法向量属性</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>normalLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 绑定法向量缓冲</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> normalBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉法向量属性怎么从 normalBuffer (ARRAY_BUFFER) 中读取值</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用 3 个单位的数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是 32 位浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 单位化 (从 0-255 转换到 0-1)</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>normalLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在让着色器使用它</p>\n<p>首先在顶点着色器中只将法向量传递给片断着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68955849803068610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\n// attribute vec4 a_color;\nattribute vec3 a_normal;\n\nuniform mat4 u_matrix;\n\n// varying vec4 v_color;\nvarying vec3 v_normal;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_matrix * a_position;\n\n  // // 将颜色传到片断着色器\n  // v_color = a_color;\n\n  // 将法向量传到片断着色器\n  v_normal = a_normal;\n}`, `68955849803068610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token comment">// attribute vec4 a_color;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_matrix<span class="token punctuation">;</span>\n\n<span class="token comment">// varying vec4 v_color;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// // 将颜色传到片断着色器</span>\n  <span class="token comment">// v_color = a_color;</span>\n\n  <span class="token comment">// 将法向量传到片断着色器</span>\n  v_normal <span class="token operator">=</span> a_normal<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在片断着色器中将法向量和光照方向点乘</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64573673038582820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\n// 从顶点着色器中传入的值\n// varying vec4 v_color;\nvarying vec3 v_normal;\n\nuniform vec3 u_reverseLightDirection;\nuniform vec4 u_color;\n\nvoid main() {\n   // 由于 v_normal 是插值出来的，有可能不是单位向量，\n   // 可以用 normalize 将其单位化。\n   vec3 normal = normalize(v_normal);\n\n   float light = dot(normal, u_reverseLightDirection);\n\n   gl_FragColor = u_color;\n\n   // 将颜色部分（不包括 alpha）和光照相乘\n   gl_FragColor.rgb *= light;\n}`, `64573673038582820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 从顶点着色器中传入的值</span>\n<span class="token comment">// varying vec4 v_color;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_reverseLightDirection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 由于 v_normal 是插值出来的，有可能不是单位向量，</span>\n   <span class="token comment">// 可以用 normalize 将其单位化。</span>\n   <span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_normal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> u_reverseLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n\n   <span class="token comment">// 将颜色部分（不包括 alpha）和光照相乘</span>\n   gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后找到 <code class="language-text">u_color</code> 和 <code class="language-text">u_reverseLightDirection</code> 的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49469726017687800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 寻找全局变量\nvar matrixLocation = gl.getUniformLocation(program, \'u_matrix\');\nvar colorLocation = gl.getUniformLocation(program, \'u_color\');\nvar reverseLightDirectionLocation = gl.getUniformLocation(program, \'u_reverseLightDirection\');`, `49469726017687800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 寻找全局变量</span>\n<span class="token keyword">var</span> matrixLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_matrix\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> reverseLightDirectionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_reverseLightDirection\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为它们赋值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6314870972329034000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 设置矩阵\ngl.uniformMatrix4fv(matrixLocation, false, worldViewProjectionMatrix);\n\n// 设置使用的颜色\ngl.uniform4fv(colorLocation, [0.2, 1, 0.2, 1]); // green\n\n// 设置光线方向\ngl.uniform3fv(reverseLightDirectionLocation, m4.normalize([0.5, 0.7, 1]));`, `6314870972329034000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>matrixLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldViewProjectionMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 设置使用的颜色</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// green</span>\n\n<span class="token comment">// 设置光线方向</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>reverseLightDirectionLocation<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们之前用到的 normalize 会将原向量转换为单位向量。例子中的 x = 0.5 说明光线是从右往左照，y = 0.7 说明光线从上方往下照，z = 1 说明光线从在场景前方。对应的值表示光源大多指向场景，在靠右方和上方一点的位置。</p>\n<p>这是结果</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/vp33w2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果你旋转了 F 就会发现，F 虽然旋转了但是光照没变，我们希望随着 F 的旋转正面总是被照亮的。</p>\n<p>为了解决这个问题就需要在物体重定向时重定向法向量，和位置一样我们也可以将向量和矩阵相乘，这个矩阵显然是 world 矩阵，现在我们只传了一个矩阵 <code class="language-text">u_matrix</code>，所以先来改成传递两个矩阵，一个叫做 <code class="language-text">u_world</code> 的世界矩阵，另一个叫做 <code class="language-text">u_worldViewProjection</code> 也就是我们现在的 <code class="language-text">u_matrix</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14967540115626400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform mat4 u_worldViewProjection;\nuniform mat4 u_world;\n\nvarying vec3 v_normal;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_worldViewProjection * a_position;\n\n  // 重定向法向量并传递给片断着色器\n  v_normal = mat3(u_world) * a_normal;\n}`, `14967540115626400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldViewProjection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_world<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_worldViewProjection <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 重定向法向量并传递给片断着色器</span>\n  v_normal <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>u_world<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意到我们将 <code class="language-text">a_normal</code> 与 <code class="language-text">mat3(u_world)</code> 相乘，那是因为法向量是方向所以不用关心位移，矩阵的左上 3x3 部分才是控制姿态的。</p>\n<p>找到全局变量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15650724761028755000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 寻找全局变量\nvar worldViewProjectionLocation = gl.getUniformLocation(program, \'u_worldViewProjection\');\nvar worldLocation = gl.getUniformLocation(program, \'u_world\');`, `15650724761028755000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 寻找全局变量</span>\n<span class="token keyword">var</span> worldViewProjectionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_worldViewProjection\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> worldLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_world\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后更新它们</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31618168239584340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 设置矩阵\ngl.uniformMatrix4fv(worldViewProjectionLocation, false, worldViewProjectionMatrix);\ngl.uniformMatrix4fv(worldLocation, false, worldMatrix);`, `31618168239584340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldViewProjectionLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldViewProjectionMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/it9qvy?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>旋转后就会发现面对 F 的面总是被照亮的。</p>\n<p>这里有一个问题我不知道如何表述所以就用图解展示，我们用 normal 和 u_world 相乘去重定向法向量，如果世界矩阵被缩放了怎么办？事实是会得到错误的法向量。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/zzocr1?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>我从没想弄清为什么，但解决办法就是对世界矩阵求逆并转置，用这个矩阵就会得到正确的结果。</p>\n<p>在图解里中间的紫色球体是未缩放的，左边的红色球体用的世界矩阵并缩放了，你可以看出有些不太对劲。右边蓝色的球体用的是世界矩阵求逆并转置后的矩阵。</p>\n<p>点击图解循环观察不同的表示形式，你会发现在缩放严重时左边的（世界矩阵）法向量和表面没有保持垂直关系，而右边的（世界矩阵求逆并转置）一直保持垂直。最后一种模式是将它们渲染成红色，你会发现两个球体的光照结果相差非常大，基于可视化的结果可以得出使用世界矩阵求逆转置是对的。</p>\n<p>修改代码让示例使用这种矩阵，首先更新着色器，理论上我们可以直接更新 <code class="language-text">u_world</code> 的值，但是最好将它重命名以表示它真正的含义，防止混淆。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10872684497202756000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform mat4 u_worldViewProjection;\nuniform mat4 u_worldInverseTranspose;\n\nvarying vec3 v_normal;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_worldViewProjection * a_position;\n\n  // 重定向法向量并传递给片断着色器\n  v_normal = mat3(u_worldInverseTranspose) * a_normal;\n}`, `10872684497202756000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldViewProjection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldInverseTranspose<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_worldViewProjection <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 重定向法向量并传递给片断着色器</span>\n  v_normal <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>u_worldInverseTranspose<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后找到它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22584835117441780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// var worldLocation = gl.getUniformLocation(program, \'u_world\');\nvar worldInverseTransposeLocation = gl.getUniformLocation(program, \'u_worldInverseTranspose\');`, `22584835117441780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// var worldLocation = gl.getUniformLocation(program, \'u_world\');</span>\n<span class="token keyword">var</span> worldInverseTransposeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_worldInverseTranspose\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>更新它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48411287299993950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var worldViewProjectionMatrix = m4.multiply(viewProjectionMatrix, worldMatrix);\nvar worldInverseMatrix = m4.inverse(worldMatrix);\nvar worldInverseTransposeMatrix = m4.transpose(worldInverseMatrix);\n\n// 设置矩阵\ngl.uniformMatrix4fv(worldViewProjectionLocation, false, worldViewProjectionMatrix);\n// gl.uniformMatrix4fv(worldLocation, false, worldMatrix);\ngl.uniformMatrix4fv(worldInverseTransposeLocation, false, worldInverseTransposeMatrix);`, `48411287299993950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> worldViewProjectionMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>viewProjectionMatrix<span class="token punctuation">,</span> worldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> worldInverseMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span>worldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> worldInverseTransposeMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">transpose</span><span class="token punctuation">(</span>worldInverseMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldViewProjectionLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldViewProjectionMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// gl.uniformMatrix4fv(worldLocation, false, worldMatrix);</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldInverseTransposeLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldInverseTransposeMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是转置的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84352664985880970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  transpose: function(m) {\n    return [m[0], m[4], m[8], m[12], m[1], m[5], m[9], m[13], m[2], m[6], m[10], m[14], m[3], m[7], m[11], m[15]];\n  }\n\n  // ...\n};`, `84352664985880970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">transpose</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于我们并没有进行缩放，所以没有明显的变化，但防患于未然。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/vy56uh?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="mat3u_worldinversetranspose--a_normal-的可选方案"><a href="#mat3u_worldinversetranspose--a_normal-%E7%9A%84%E5%8F%AF%E9%80%89%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">mat3(u_worldInverseTranspose) * a_normal</code> 的可选方案</h2>\n<p>之前的着色器中出现了这样的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57193341200950166000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v_normal = mat3(u_worldInverseTranspose) * a_normal;`, `57193341200950166000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">v_normal <span class="token operator">=</span> <span class="token function">mat3</span><span class="token punctuation">(</span>u_worldInverseTranspose<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们也可以这样做</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6496259948144667000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v_normal = (u_worldInverseTranspose * vec4(a_normal, 0)).xyz;`, `6496259948144667000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">v_normal <span class="token operator">=</span> <span class="token punctuation">(</span>u_worldInverseTranspose <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>a_normal<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>由于 w 在相乘前被赋值为 0，所以在相乘后负责平移的部分与 0 相乘被移除了。我认为这可能是更常用的方式，mat3 的做法只是对我来说更简洁但我经常用前一种方法。</p>\n<p>当然另一种解决方案是将 <code class="language-text">u_worldInverseTranspose</code> 直接构造成 mat3。这有两个不能这么做的理由，第一个是我们可能需要一个完整的 <code class="language-text">u_worldInverseTranspose</code> 对象传递一个 mat4 给还要给其他地方使用，另一个是我们在 JavaScript 中的所有矩阵方法都是针对 4x4 的矩阵，如果没有其他特别的需求，没有必要构造一个 3x3 的矩阵，或者是把 4x4 转换成 3x3。</p>\n<h1 id="webgl-三维点光源"><a href="#webgl-%E4%B8%89%E7%BB%B4%E7%82%B9%E5%85%89%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维点光源</h1>\n<p>上篇中说到方向光统一来自一个方向，在渲染前设置好方向。</p>\n<p>如果代替方向而是从三维空间中选一个点当作光源，然后在着色器中根据光源和表面位置计算光照方向的话，就是点光源了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/i3grsj?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果旋转上方的表面会发现，每个点都有一个不同的面到光源的矢量，将这个矢量和法向量点乘后，表面上的每个点都会有一个不同的光照值。</p>\n<p>让我们实现它吧。</p>\n<p>首先需要一个光源位置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63419367417973160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`uniform vec3 u_lightWorldPosition;`, `63419367417973160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightWorldPosition<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后需要计算表面的世界坐标，我们可以将位置和世界矩阵相乘得到</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5775230843363666000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`uniform mat4 u_world;\n\n// ...\n\n// 计算表面的世界坐标\nvec3 surfaceWorldPosition = (u_world * a_position).xyz;`, `5775230843363666000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_world<span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 计算表面的世界坐标</span>\n<span class="token keyword">vec3</span> surfaceWorldPosition <span class="token operator">=</span> <span class="token punctuation">(</span>u_world <span class="token operator">*</span> a_position<span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后可以计算出一个从表面到光源的矢量，用来模拟之前的方向光，只是这次我们为表面上的每个点都计算了一个方向。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60005851858840910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;`, `60005851858840910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">v_surfaceToLight <span class="token operator">=</span> u_lightWorldPosition <span class="token operator">-</span> surfaceWorldPosition<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这是全部的内容</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21239228506640840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform vec3 u_lightWorldPosition;\n\nuniform mat4 u_world;\nuniform mat4 u_worldViewProjection;\nuniform mat4 u_worldInverseTranspose;\n\nvarying vec3 v_normal;\n\nvarying vec3 v_surfaceToLight;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_worldViewProjection * a_position;\n\n  // 重定向法向量并传递给片断着色器\n  v_normal = mat3(u_worldInverseTranspose) * a_normal;\n\n  // 计算表面的世界坐标\n  vec3 surfaceWorldPosition = (u_world * a_position).xyz;\n\n  // 计算表面到光源的方向\n  // 传递给片断着色器\n  v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;\n}`, `21239228506640840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{4,6,12,21-26}"\n              >\n                <span class="gatsby-code-button-language">glsl{4,6,12,21-26}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightWorldPosition<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_world<span class="token punctuation">;</span></span><span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldViewProjection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldInverseTranspose<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span></span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_worldViewProjection <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 重定向法向量并传递给片断着色器</span>\n  v_normal <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>u_worldInverseTranspose<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token comment">// 计算表面的世界坐标</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">vec3</span> surfaceWorldPosition <span class="token operator">=</span> <span class="token punctuation">(</span>u_world <span class="token operator">*</span> a_position<span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  <span class="token comment">// 计算表面到光源的方向</span></span><span class="gatsby-highlight-code-line">  <span class="token comment">// 传递给片断着色器</span></span><span class="gatsby-highlight-code-line">  v_surfaceToLight <span class="token operator">=</span> u_lightWorldPosition <span class="token operator">-</span> surfaceWorldPosition<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在片断着色器中需要将表面到光源的方向进行单位化，注意，虽然我们可以在顶点着色器中传递单位向量，但是 varying 会进行插值再传给片断着色器，所以片断着色器中的向量基本上不是单位向量了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70597350550007000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\n// 从顶点着色器中传入的值\nvarying vec3 v_normal;\nvarying vec3 v_surfaceToLight;\n\n// uniform vec3 u_reverseLightDirection;\nuniform vec4 u_color;\n\nvoid main() {\n  // 由于 v_normal 是可变量，所以经过插值后不再是单位向量\n  // 单位化后会成为单位向量\n  vec3 normal = normalize(v_normal);\n\n  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\n\n  -float light = dot(normal, u_reverseLightDirection);\n  +float light = dot(normal, surfaceToLightDirection);\n\n  gl_FragColor = u_color;\n\n  // 只将颜色部分（不包含 alpha）和光照相乘\n  gl_FragColor.rgb *= light;\n}`, `70597350550007000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{5,7}"\n              >\n                <span class="gatsby-code-button-language">glsl{5,7}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 从顶点着色器中传入的值</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line"><span class="token comment">// uniform vec3 u_reverseLightDirection;</span></span><span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 由于 v_normal 是可变量，所以经过插值后不再是单位向量</span>\n  <span class="token comment">// 单位化后会成为单位向量</span>\n  <span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_normal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">vec3</span> surfaceToLightDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToLight<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token operator">-</span><span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> u_reverseLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token operator">+</span><span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n\n  <span class="token comment">// 只将颜色部分（不包含 alpha）和光照相乘</span>\n  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后需要找到 <code class="language-text">u_world</code> 和 <code class="language-text">u_lightWorldPosition</code> 的位置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9136952989619274000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// var reverseLightDirectionLocation = gl.getUniformLocation(program, \'u_reverseLightDirection\');\nvar lightWorldPositionLocation = gl.getUniformLocation(program, \'u_lightWorldPosition\');\nvar worldLocation = gl.getUniformLocation(program, \'u_world\');`, `9136952989619274000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// var reverseLightDirectionLocation = gl.getUniformLocation(program, \'u_reverseLightDirection\');</span>\n<span class="token keyword">var</span> lightWorldPositionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightWorldPosition\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> worldLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_world\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>设置它们</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99082486626201570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 设置矩阵\ngl.uniformMatrix4fv(worldLocation, false, worldMatrix);\ngl.uniformMatrix4fv(worldViewProjectionLocation, false, worldViewProjectionMatrix);\n\n// ...\n\n// // 设置光照方向\n// gl.uniform3fv(reverseLightDirectionLocation, m4.normalize([0.5, 0.7, 1]));\n// 设置光源位置\ngl.uniform3fv(lightWorldPositionLocation, [20, 30, 50]);`, `99082486626201570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldViewProjectionLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldViewProjectionMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// // 设置光照方向</span>\n<span class="token comment">// gl.uniform3fv(reverseLightDirectionLocation, m4.normalize([0.5, 0.7, 1]));</span>\n<span class="token comment">// 设置光源位置</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>lightWorldPositionLocation<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是结果</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/xwmmsc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>现在我们可以加一个叫做镜面高光的东西。</p>\n<p>观察现实世界中的物体，如果物体表面恰好将光线反射到你眼前，就会显得非常明亮，像镜子一样。</p>\n<p>我们可以通过计算光线是否反射到眼前来模拟这种情况，点乘又一次起到了至关重要的作用。</p>\n<p>如何测试呢？如果入射角和反射角恰好与眼睛和和光源的夹角相同，那么光线就会反射到眼前。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/352uf4?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果我们知道了物体表面到光源的方向（刚刚已经计算过了），加上物体表面到视区/眼睛/相机的方向，再除以 2 得到 halfVector 向量，将这个向量和法向量比较，如果方向一致，那么光线就会被反射到眼前。那么如何确定方向是否一致呢？用之前的点乘就可以了。1 表示相符，0 表示垂直，-1 表示相反。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/yrs3bw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>所以首先我们需要传入相机位置，计算表面到相机的方向矢量，然后传递到片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65439632553535510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform vec3 u_lightWorldPosition;\nuniform vec3 u_viewWorldPosition;\n\nuniform mat4 u_world;\nuniform mat4 u_worldViewProjection;\nuniform mat4 u_worldInverseTranspose;\n\nvarying vec3 v_normal;\n\nvarying vec3 v_surfaceToLight;\nvarying vec3 v_surfaceToView;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_worldViewProjection * a_position;\n\n  // 重定向法向量并传递到片断着色器\n  v_normal = mat3(u_worldInverseTranspose) * a_normal;\n\n  // 计算表面的世界坐标\n  vec3 surfaceWorldPosition = (u_world * a_position).xyz;\n\n  // 计算表面到光源的方向\n  // 然后传递到片断着色器\n  v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;\n\n  // 计算表面到相机的方向\n  // 然后传递到片断着色器\n  v_surfaceToView = u_viewWorldPosition - surfaceWorldPosition;\n}`, `65439632553535510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{5,14,30-32}"\n              >\n                <span class="gatsby-code-button-language">glsl{5,14,30-32}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightWorldPosition<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_viewWorldPosition<span class="token punctuation">;</span></span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_world<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldViewProjection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldInverseTranspose<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToView<span class="token punctuation">;</span></span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_worldViewProjection <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 重定向法向量并传递到片断着色器</span>\n  v_normal <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>u_worldInverseTranspose<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span>\n\n  <span class="token comment">// 计算表面的世界坐标</span>\n  <span class="token keyword">vec3</span> surfaceWorldPosition <span class="token operator">=</span> <span class="token punctuation">(</span>u_world <span class="token operator">*</span> a_position<span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>\n\n  <span class="token comment">// 计算表面到光源的方向</span>\n  <span class="token comment">// 然后传递到片断着色器</span>\n  v_surfaceToLight <span class="token operator">=</span> u_lightWorldPosition <span class="token operator">-</span> surfaceWorldPosition<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token comment">// 计算表面到相机的方向</span></span><span class="gatsby-highlight-code-line">  <span class="token comment">// 然后传递到片断着色器</span></span><span class="gatsby-highlight-code-line">  v_surfaceToView <span class="token operator">=</span> u_viewWorldPosition <span class="token operator">-</span> surfaceWorldPosition<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在片断着色器中计算表面到光源和相机之间的 halfVector，将它和法向量相乘，查看光线是否直接反射到眼前。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87836867046351360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 从顶点着色器中传入的值\nvarying vec3 v_normal;\nvarying vec3 v_surfaceToLight;\nvarying vec3 v_surfaceToView;\n\nuniform vec4 u_color;\n\nvoid main() {\n  // 由于 v_normal 是可变量，所以经过插值后不再是单位向量，\n  // 单位化后会成为单位向量\n  vec3 normal = normalize(v_normal);\n\n  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\n  vec3 surfaceToViewDirection = normalize(v_surfaceToView);\n  vec3 halfVector = normalize(surfaceToLightDirection + surfaceToViewDirection);\n\n  float light = dot(normal, surfaceToLightDirection);\n  float specular = dot(normal, halfVector);\n\n  gl_FragColor = u_color;\n\n  // 只将颜色部分（不包含 alpha）和光照相乘\n  gl_FragColor.rgb *= light;\n\n  // 直接加上高光\n  gl_FragColor.rgb += specular;\n}`, `87836867046351360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{4,13-15,18,25-26}"\n              >\n                <span class="gatsby-code-button-language">glsl{4,13-15,18,25-26}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 从顶点着色器中传入的值</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToView<span class="token punctuation">;</span></span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 由于 v_normal 是可变量，所以经过插值后不再是单位向量，</span>\n  <span class="token comment">// 单位化后会成为单位向量</span>\n  <span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_normal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token keyword">vec3</span> surfaceToLightDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToLight<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">vec3</span> surfaceToViewDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToView<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">vec3</span> halfVector <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>surfaceToLightDirection <span class="token operator">+</span> surfaceToViewDirection<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n  <span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">  <span class="token keyword">float</span> specular <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n  gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n\n  <span class="token comment">// 只将颜色部分（不包含 alpha）和光照相乘</span>\n  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token comment">// 直接加上高光</span></span><span class="gatsby-highlight-code-line">  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">+</span><span class="token operator">=</span> specular<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后找到 <code class="language-text">u_viewWorldPosition</code> 并设置它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45121667292114354000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var lightWorldPositionLocation = gl.getUniformLocation(program, \'u_lightWorldPosition\');\nvar viewWorldPositionLocation = gl.getUniformLocation(program, \'u_viewWorldPosition\');\n\n// ...\n\n// 计算相机矩阵\nvar camera = [100, 150, 200];\nvar target = [0, 35, 0];\nvar up = [0, 1, 0];\nvar cameraMatrix = makeLookAt(camera, target, up);\n\n// 设置相机位置\ngl.uniform3fv(viewWorldPositionLocation, camera);`, `45121667292114354000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2,12-13}"\n              >\n                <span class="gatsby-code-button-language">js{2,12-13}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> lightWorldPositionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightWorldPosition\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> viewWorldPositionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_viewWorldPosition\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 计算相机矩阵</span>\n<span class="token keyword">var</span> camera <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> target <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> up <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> <span class="token function">makeLookAt</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> up<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token comment">// 设置相机位置</span></span><span class="gatsby-highlight-code-line">gl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>viewWorldPositionLocation<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/z123sf?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>但，亮瞎了!</p>\n<p>我们可以将点乘结果进行求幂运算来解决太亮的问题，它会把高光从线性变换变成指数变换。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/nd3lyv?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>红线越接近顶部，我们加的光照就越多，通过求幂可以将高光的部分向右移动。</p>\n<p>就把它叫做 shininess 并加到着色器中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2947682354636782600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`uniform vec4 u_color;\nuniform float u_shininess;\n\n// ...\n\n// float specular = dot(normal, halfVector);\nfloat specular = 0.0;\nif (light > 0.0) {\n   specular = pow(dot(normal, halfVector), u_shininess);\n}`, `2947682354636782600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{2,6-10}"\n              >\n                <span class="gatsby-code-button-language">glsl{2,6-10}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">float</span> u_shininess<span class="token punctuation">;</span></span>\n<span class="token comment">// ...</span>\n\n<span class="gatsby-highlight-code-line"><span class="token comment">// float specular = dot(normal, halfVector);</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">float</span> specular <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>light <span class="token operator">></span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">   specular <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>点乘结果有可能为负值，将负值求幂有可能会得到 undefined 的结果，所以我们只将点乘结果为正的部分进行计算，其他部分设置为 0.0。</p>\n<p>当然还要找到亮度的位置并设置它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58250200637528610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var shininessLocation = gl.getUniformLocation(program, \'u_shininess\');\n\n// ...\n\n// 设置亮度\ngl.uniform1f(shininessLocation, shininess);`, `58250200637528610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{1}"\n              >\n                <span class="gatsby-code-button-language">js{1}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="gatsby-highlight-code-line"><span class="token keyword">var</span> shininessLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_shininess\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 设置亮度</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>shininessLocation<span class="token punctuation">,</span> shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/lrej2i?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>最后想说的是光的颜色。</p>\n<p>在此之前我们都是将 light 和 F 的颜色直接相乘，如果想要有色光也可以为光照提供颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31058099827887985000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`uniform vec4 u_color;\nuniform float u_shininess;\nuniform vec3 u_lightColor;\nuniform vec3 u_specularColor;\n\n// ...\n\n// 只将颜色部分（不包含 alpha） 和光照相乘\ngl_FragColor.rgb *= light * u_lightColor;\n\n// 直接和高光相加\ngl_FragColor.rgb += specular * u_specularColor;`, `31058099827887985000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{3-4,9,12}"\n              >\n                <span class="gatsby-code-button-language">glsl{3-4,9,12}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">float</span> u_shininess<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightColor<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_specularColor<span class="token punctuation">;</span></span>\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 只将颜色部分（不包含 alpha） 和光照相乘</span>\n<span class="gatsby-highlight-code-line">gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light <span class="token operator">*</span> u_lightColor<span class="token punctuation">;</span></span>\n<span class="token comment">// 直接和高光相加</span>\n<span class="gatsby-highlight-code-line">gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">+</span><span class="token operator">=</span> specular <span class="token operator">*</span> u_specularColor<span class="token punctuation">;</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10276750995157969000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var lightColorLocation = gl.getUniformLocation(program, \'u_lightColor\');\nvar specularColorLocation = gl.getUniformLocation(program, \'u_specularColor\');`, `10276750995157969000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> lightColorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightColor\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> specularColorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_specularColor\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96282883670809300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 设置光照颜色\ngl.uniform3fv(lightColorLocation, m4.normalize([1, 0.6, 0.6])); // 红光\n// 设置高光颜色\ngl.uniform3fv(specularColorLocation, m4.normalize([1, 0.6, 0.6])); // 红光`, `96282883670809300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 设置光照颜色</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>lightColorLocation<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 红光</span>\n<span class="token comment">// 设置高光颜色</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>specularColorLocation<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 红光</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/fwn7lv?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="webgl-三维聚光灯"><a href="#webgl-%E4%B8%89%E7%BB%B4%E8%81%9A%E5%85%89%E7%81%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维聚光灯</h1>\n<p>在上篇文章中我们讲到点光源，计算光源到物体表面每一点的方向，然后做与方向光相同的运算，也就是对光线方向和表面法向量（表面面对的方向）做点乘运算。如果两个方向完全相同就会得到 1，应该被完全照亮。如果两个方向垂直会得到 0，相反会得到 -1。我们直接将这个值和表面的颜色相乘，实现光照效果。</p>\n<p>聚光灯只是做了少量修改，事实上如果你比较有创新能力的话，可能会根据之前学的东西知道聚光灯的实现方法。</p>\n<p>你可以把点光源想象成一个点，光线从那个点照向所有方向。实现聚光灯只需要以那个点为起点选择一个方向，作为聚光灯的方向，然后将其他光线方向与所选方向点乘，然后随意选择一个限定范围，然后判断光线是否在限定范围内，如果不在就不照亮。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/4nwjt1?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>在上方的图示中我们可以看到光线照向所有的方向，并且将每个方向的点乘结果显示在上面。然后指定一个方向表示聚光灯的方向，选择一个限定（上方以度为单位）。通过限定我们计算一个点乘限定，只需对限定值取余弦就可以得到。如果与选定聚光灯方向的点乘大于这个点乘限定，就照亮，否则不照亮。</p>\n<p>换一种方式解释，假设限定是 20 度，我们可以将它转换为弧度，然后取余弦值得到 -1 到 1 之间的数，暂且把它称作点乘空间。或者可以用这个表格表示限定值的转换。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52656715104790510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`          限制值\n   角度   |   弧度   | 点乘空间\n --------+---------+----------\n    0    |   0.0   |    1.0\n    22   |    .38  |     .93\n    45   |    .79  |     .71\n    67   |   1.17  |     .39\n    90   |   1.57  |    0.0\n   180   |   3.14  |   -1.0`, `52656715104790510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">          限制值\n   角度   |   弧度   | 点乘空间\n --------+---------+----------\n    0    |   0.0   |    1.0\n    22   |    .38  |     .93\n    45   |    .79  |     .71\n    67   |   1.17  |     .39\n    90   |   1.57  |    0.0\n   180   |   3.14  |   -1.0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们可以只需判断</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52534259481400250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dotFromDirection = dot(surfaceToLight, -lightDirection);\nif (dotFromDirection >= limitInDotSpace) {\n  // 使用光照\n}`, `52534259481400250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLight<span class="token punctuation">,</span> <span class="token operator">-</span>lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>dotFromDirection <span class="token operator">>=</span> limitInDotSpace<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 使用光照</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>让我们来实现它。</p>\n<p>首先修改上文的片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46091229771168285000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\n// 从顶点着色器传入的值\nvarying vec3 v_normal;\nvarying vec3 v_surfaceToLight;\nvarying vec3 v_surfaceToView;\n\nuniform vec4 u_color;\nuniform float u_shininess;\nuniform vec3 u_lightDirection;\nuniform float u_limit; // 在点乘空间中\n\nvoid main() {\n  // 因为 v_normal 是可变量，被插值过\n  // 所以不是单位向量，单位可以让它成为再次成为单位向量\n  vec3 normal = normalize(v_normal);\n\n  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\n  vec3 surfaceToViewDirection = normalize(v_surfaceToView);\n  vec3 halfVector = normalize(surfaceToLightDirection + surfaceToViewDirection);\n\n  // float light = dot(normal, surfaceToLightDirection);\n  float light = 0.0;\n  float specular = 0.0;\n\n  float dotFromDirection = dot(surfaceToLightDirection,\n                               -u_lightDirection);\n  if (dotFromDirection >= u_limit) {\n    light = dot(normal, surfaceToLightDirection);\n    if (light > 0.0) {\n      specular = pow(dot(normal, halfVector), u_shininess);\n    }\n  }\n\n  gl_FragColor = u_color;\n\n  // 只将颜色部分（不包含 alpha）和光照相乘\n  gl_FragColor.rgb *= light;\n\n  // 直接加上高光\n  gl_FragColor.rgb += specular;\n}`, `46091229771168285000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{10-11,22-23,26-33}"\n              >\n                <span class="gatsby-code-button-language">glsl{10-11,22-23,26-33}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 从顶点着色器传入的值</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToView<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">float</span> u_shininess<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightDirection<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">float</span> u_limit<span class="token punctuation">;</span> <span class="token comment">// 在点乘空间中</span></span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 因为 v_normal 是可变量，被插值过</span>\n  <span class="token comment">// 所以不是单位向量，单位可以让它成为再次成为单位向量</span>\n  <span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_normal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">vec3</span> surfaceToLightDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToLight<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">vec3</span> surfaceToViewDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToView<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">vec3</span> halfVector <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>surfaceToLightDirection <span class="token operator">+</span> surfaceToViewDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token comment">// float light = dot(normal, surfaceToLightDirection);</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span></span>  <span class="token keyword">float</span> specular <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token keyword">float</span> dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLightDirection<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                               <span class="token operator">-</span>u_lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>dotFromDirection <span class="token operator">>=</span> u_limit<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>light <span class="token operator">></span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      specular <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>\n  gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n\n  <span class="token comment">// 只将颜色部分（不包含 alpha）和光照相乘</span>\n  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light<span class="token punctuation">;</span>\n\n  <span class="token comment">// 直接加上高光</span>\n  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">+</span><span class="token operator">=</span> specular<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然我们需要找到刚才添加的全局变量的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26085398247492076000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var lightDirection = [0, 0, 0];\nvar limit = degToRad(20);\n\n// ...\n\nvar lightDirectionLocation = gl.getUniformLocation(program, \'u_lightDirection\');\nvar limitLocation = gl.getUniformLocation(program, \'u_limit\');`, `26085398247492076000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> lightDirection <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> limit <span class="token operator">=</span> <span class="token function">degToRad</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token keyword">var</span> lightDirectionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightDirection\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> limitLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_limit\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后设置它们</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75784015952990220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform3fv(lightDirectionLocation, lightDirection);\ngl.uniform1f(limitLocation, Math.cos(limit));`, `75784015952990220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>lightDirectionLocation<span class="token punctuation">,</span> lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>limitLocation<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/i7cotm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>一些需要注意的细节：一个是我们在上方对 <code class="language-text">u_lightDirection</code> 取负，这其实是一个等价的选择，我们希望两个方向匹配的时候能指向相同的方向，也就是需要将 <code class="language-text">surfaceToLightDirection</code> 和聚光灯的反方向相比，我们可以用很多种方式实现这个。可以在设置全局变量时传入反方向，那可能是我的首选，但是我觉得那样应该叫做 <code class="language-text">u_reverseLightDirection</code> 或 <code class="language-text">u_negativeLightDirection</code> 而不是 <code class="language-text">u_lightDirection</code>。</p>\n<p>另一件事，也许这个只是个人习惯，如果可能的话我尽量不在着色器中使用条件语句，原因是我认为着色器并不是真的使用条件语句，如果你在着色器中使用，编译器会在代码中扩展很多 0 和 1 的乘法运算来实现，所以这里并不是真的条件语句，它会将你的代码扩展成多种组合。我不确定现在是否还是这样，但是我们可以使用一些技巧来避免这种情况，你自己可以选择用或不用。</p>\n<p>有一个 GLSL 函数叫做 step，它获取两个值，如果第二个值大于或等于第一个值就返回 1.0，否则返回 0。用 JavaScript 大概可以这样表示。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76132777425702750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function step(a, b) {\n  if (b >= a) {\n    return 1;\n  } else {\n    return 0;\n  }\n}`, `76132777425702750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">step</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">>=</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>让我们使用 step 避免这种情况</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29837038755993260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float dotFromDirection = dot(surfaceToLightDirection, -u_lightDirection);\n// 如果光线在聚光灯范围内 inLight 就为 1，否则为 0\nfloat inLight = step(u_limit, dotFromDirection);\nfloat light = inLight * dot(normal, surfaceToLightDirection);\nfloat specular = inLight * pow(dot(normal, halfVector), u_shininess);`, `29837038755993260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLightDirection<span class="token punctuation">,</span> <span class="token operator">-</span>u_lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 如果光线在聚光灯范围内 inLight 就为 1，否则为 0</span>\n<span class="token keyword">float</span> inLight <span class="token operator">=</span> <span class="token function">step</span><span class="token punctuation">(</span>u_limit<span class="token punctuation">,</span> dotFromDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> light <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> specular <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看起来没有什么区别，这是结果</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/yd0rcc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>还有一件事，现在的聚光灯效果非常粗糙和僵硬。只有在聚光灯范围内或外，在外面就直接变黑，没有任何过渡。</p>\n<p>要修正它我们可以使用两个限定值代替原来的一个，一个内部限定一个外部限定。如果在内部限定内就使用 1.0，在外部限定外面就使用 0.0，在内部和外部限定之间就使用 1.0 到 0.0 之间的插值。</p>\n<p>这是我们实现这个的一种方式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33444709167254750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// uniform float u_limit; // 在点乘空间中\nuniform float u_innerLimit; // 在点乘空间中\nuniform float u_outerLimit; // 在点乘空间中\n\n// ...\n\nfloat dotFromDirection = dot(surfaceToLightDirection, -u_lightDirection);\n// float inLight = step(u_limit, dotFromDirection);\nfloat limitRange = u_innerLimit - u_outerLimit;\nfloat inLight = clamp((dotFromDirection - u_outerLimit) / limitRange, 0.0, 1.0);\nfloat light = inLight * dot(normal, surfaceToLightDirection);\nfloat specular = inLight * pow(dot(normal, halfVector), u_shininess);`, `33444709167254750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{1-3,8-10}"\n              >\n                <span class="gatsby-code-button-language">glsl{1-3,8-10}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="gatsby-highlight-code-line"><span class="token comment">// uniform float u_limit; // 在点乘空间中</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">float</span> u_innerLimit<span class="token punctuation">;</span> <span class="token comment">// 在点乘空间中</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">float</span> u_outerLimit<span class="token punctuation">;</span> <span class="token comment">// 在点乘空间中</span></span>\n<span class="token comment">// ...</span>\n\n<span class="token keyword">float</span> dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLightDirection<span class="token punctuation">,</span> <span class="token operator">-</span>u_lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token comment">// float inLight = step(u_limit, dotFromDirection);</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">float</span> limitRange <span class="token operator">=</span> u_innerLimit <span class="token operator">-</span> u_outerLimit<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">float</span> inLight <span class="token operator">=</span> <span class="token function">clamp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dotFromDirection <span class="token operator">-</span> u_outerLimit<span class="token punctuation">)</span> <span class="token operator">/</span> limitRange<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token keyword">float</span> light <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> specular <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样就行了</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/8rzoi2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>现在我们得到了聚光灯的效果。</p>\n<p>需要注意的是如果 <code class="language-text">u_innerLimit</code> 和 <code class="language-text">u_outerLimit</code> 相等那么 limitRange 就会是 0.0，除以 0 就会导致 undefined。这在着色器中没有什么解决办法，所以只需要在 JavaScript 中确保 <code class="language-text">u_innerLimit</code> 和 <code class="language-text">u_outerLimit</code> 永远不要相等。（注意：示例代码中并没有做这个。）</p>\n<p>GLSL 也有一个函数可以稍微做一些简化，叫做 smoothstep，和 step 相似返回一个 0 到 1 之间的值，但是它获取最大和最小边界值，返回该值在边界范围映射到 0 到 1 之间的插值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61977332088531560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float dotFromDirection = dot(surfaceToLightDirection, -u_lightDirection);\n// float limitRange = u_innerLimit - u_outerLimit;\n// float inLight = clamp((dotFromDirection - u_outerLimit) / limitRange, 0.0, 1.0);\nfloat inLight = smoothstep(u_outerLimit, u_innerLimit, dotFromDirection);\nfloat light = inLight * dot(normal, surfaceToLightDirection);\nfloat specular = inLight * pow(dot(normal, halfVector), u_shininess);`, `61977332088531560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLightDirection<span class="token punctuation">,</span> <span class="token operator">-</span>u_lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// float limitRange = u_innerLimit - u_outerLimit;</span>\n<span class="token comment">// float inLight = clamp((dotFromDirection - u_outerLimit) / limitRange, 0.0, 1.0);</span>\n<span class="token keyword">float</span> inLight <span class="token operator">=</span> <span class="token function">smoothstep</span><span class="token punctuation">(</span>u_outerLimit<span class="token punctuation">,</span> u_innerLimit<span class="token punctuation">,</span> dotFromDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> light <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> specular <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样也可以</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/5udeoe?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>不同之处是 smoothstep 使用 Hermite 插值而不是线型插值，也就是说 lowerBound 和 upperBound 之间的值插值后像下方右图所示，线型插值是左图。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-06-15-14-01-31-1095413faf7395ae3e2f26a6dc02fd83-7027d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 300px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABG0lEQVQoz32RO07DQBCGvzgviAm2IQkI8ZYQPSUFFRJCiCOko4XTcBYKzsAFaGmQaOACxPy7O1ZsE3uk2ZnV/P5mxssNHJ/ABMj6sEXNoxAn13D0CKe9cM+i/9pMPsXBclijxTqQKKTSdeWjFukGRuZLH7xA5PK5Z9gRLNVk2y75gP43xC6/qvT0NsbWxMHUPVlYMa92Tt1an3aRZqj6cIVujO1fCDsOmhv0uQYsA6QdLWyjy1XA+XKyCrQJaDr/Py+aJqyJk3ebYGDAmdV/l7pB7UErQD/Rg8VXwX7Cy7p7UjxKMfa9RWniN9/Tj7tZrNNoAsaHQZO2aSxdd8eB3G2zU/ZeiFMV9u7gXPm+fLesjUKcdRWfpLmFsz9PaTMX9FpEMQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 06 15 14 01 31" title="" data-src="/static/2022-06-15-14-01-31-1095413faf7395ae3e2f26a6dc02fd83-7027d.png" data-srcset="/static/2022-06-15-14-01-31-1095413faf7395ae3e2f26a6dc02fd83-55fa9.png 200w,\n/static/2022-06-15-14-01-31-1095413faf7395ae3e2f26a6dc02fd83-7027d.png 300w" data-sizes="(max-width: 300px) 100vw, 300px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果你觉得没什么关系的话，使用什么取决于你自己。</p>\n<p>还有一件事就是注意当 lowerBound 大于或等于 upperBound 时 smoothstep 方法会产生 undefined。它们值相等和之前的情况一样，多出的问题是 lowerBound 大于 upperBound 时，但是对于正常的聚光灯这种情况永远不会出现。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——光照/index.md absPath of file >>> MarkdownRemark",timeToRead:14,frontmatter:{date:"2022-06-07 14:38:03",path:"/webgl-fundamental-light/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——光照",draft:null}},{excerpt:"WebGL 三维正射投影 上一篇文章概述了二维矩阵的工作原理，我们讲到了如何平移，旋转，缩放甚至从像素空间投影到裁剪空间，并且将这些操作通过一个矩阵实现，做三维只需要再迈出一小步。 二维例子中的二维点 (x, y) 与 3x3 的矩阵相乘，在三维中我们需要三维点 (x, y, z) 与 4x4 的矩阵相乘。 让我们将上个例子改成三维的，这里会继续使用 F，但是这次是三维的 ‘F’ 。 首先需要修改顶点着色器以支持三维处理，这是原顶点着色器 这是新着色器 它甚至变简单了！在二维中我们提供 x…",html:'<h1 id="webgl-三维正射投影"><a href="#webgl-%E4%B8%89%E7%BB%B4%E6%AD%A3%E5%B0%84%E6%8A%95%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维正射投影</h1>\n<p>上一篇文章概述了二维矩阵的工作原理，我们讲到了如何平移，旋转，缩放甚至从像素空间投影到裁剪空间，并且将这些操作通过一个矩阵实现，做三维只需要再迈出一小步。</p>\n<p>二维例子中的二维点 (x, y) 与 3x3 的矩阵相乘，在三维中我们需要三维点 (x, y, z) 与 4x4 的矩阵相乘。</p>\n<p>让我们将上个例子改成三维的，这里会继续使用 F，但是这次是三维的 ‘F’ 。</p>\n<p>首先需要修改顶点着色器以支持三维处理，这是原顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32870085101357916000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   attribute vec2 a_position;\n\n   uniform mat3 u_matrix;\n\n   void main() {\n      // 将位置和矩阵相乘\n      gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n   }\n</script>`, `32870085101357916000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   attribute vec2 a_position<span class="token punctuation">;</span>\n\n   uniform mat3 u_matrix<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_matrix <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span>a_position<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是新着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1659309323767144200"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-3d&quot; type=&quot;x-shader/x-vertex&quot;>\n   attribute vec4 a_position;\n\n   uniform mat4 u_matrix;\n\n   void main() {\n      // 将位置和矩阵相乘\n      gl_Position = u_matrix * a_position;\n   }\n</script>`, `1659309323767144200`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2,4,8}"\n              >\n                <span class="gatsby-code-button-language">js{2,4,8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n<span class="gatsby-highlight-code-line">   attribute vec4 a_position<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line">   uniform mat4 u_matrix<span class="token punctuation">;</span></span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n<span class="gatsby-highlight-code-line">      gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span></span>   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它甚至变简单了！在二维中我们提供 x 和 y 并设置 z 为 1，在三维中我们将提供 x，y 和 z，然后将 w 设置为 1，而在属性中 w 的默认值就是 1，我们可以利用这点不用再次设置。</p>\n<p>然后提供三维数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54015900538299940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\n// 告诉属性怎么从 positionBuffer (ARRAY_BUFFER) 中读取位置\nvar size = 3; // 每次迭代使用 3 个单位的数据\nvar type = gl.FLOAT; // 单位数据类型是 32 位的浮点型\nvar normalize = false; // 不需要归一化数据\nvar stride = 0; // 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(positionAttributeLocation, size, type, normalize, stride, offset);\n\n// ...\n\n// 填充当前 ARRAY_BUFFER 缓冲\n// 使用组成 \'F\' 的数据填充缓冲.\nfunction setGeometry(gl) {\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([\n      // 左竖\n      0,\n      0,\n      0,\n      30,\n      0,\n      0,\n      0,\n      150,\n      0,\n      0,\n      150,\n      0,\n      30,\n      0,\n      0,\n      30,\n      150,\n      0,\n\n      // 上横\n      30,\n      0,\n      0,\n      100,\n      0,\n      0,\n      30,\n      30,\n      0,\n      30,\n      30,\n      0,\n      100,\n      0,\n      0,\n      100,\n      30,\n      0,\n\n      // 下横\n      30,\n      60,\n      0,\n      67,\n      60,\n      0,\n      30,\n      90,\n      0,\n      30,\n      90,\n      0,\n      67,\n      60,\n      0,\n      67,\n      90,\n      0\n    ]),\n    gl.STATIC_DRAW\n  );\n}`, `54015900538299940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4}"\n              >\n                <span class="gatsby-code-button-language">js{4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token comment">// 告诉属性怎么从 positionBuffer (ARRAY_BUFFER) 中读取位置</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用 3 个单位的数据</span></span><span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是 32 位的浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不需要归一化数据</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 填充当前 ARRAY_BUFFER 缓冲</span>\n<span class="token comment">// 使用组成 \'F\' 的数据填充缓冲.</span>\n<span class="token keyword">function</span> <span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n      <span class="token comment">// 左竖</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">150</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">150</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">150</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n\n      <span class="token comment">// 上横</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">100</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">100</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">100</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n\n      <span class="token comment">// 下横</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">60</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">67</span><span class="token punctuation">,</span>\n      <span class="token number">60</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">90</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">90</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">67</span><span class="token punctuation">,</span>\n      <span class="token number">60</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">67</span><span class="token punctuation">,</span>\n      <span class="token number">90</span><span class="token punctuation">,</span>\n      <span class="token number">0</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接下来把二维矩阵方法改成三维的</p>\n<p>这是二维（之前的）版本的 <code class="language-text">m3.translation</code>, <code class="language-text">m3.rotation</code>, 和 <code class="language-text">m3.scaling</code> 方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5856400907480807000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m3 = {\n  translation: function translation(tx, ty) {\n    return [1, 0, 0, 0, 1, 0, tx, ty, 1];\n  },\n\n  rotation: function rotation(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n    return [c, -s, 0, s, c, 0, 0, 0, 1];\n  },\n\n  scaling: function scaling(sx, sy) {\n    return [sx, 0, 0, 0, sy, 0, 0, 0, 1];\n  }\n};`, `5856400907480807000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m3 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">translation</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">translation</span><span class="token punctuation">(</span><span class="token parameter">tx<span class="token punctuation">,</span> ty</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">rotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">rotation</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">scaling</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">scaling</span><span class="token punctuation">(</span><span class="token parameter">sx<span class="token punctuation">,</span> sy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>sx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是升级到三维的版本。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55748380109120490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  translation: function(tx, ty, tz) {\n    return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tx, ty, tz, 1];\n  },\n\n  xRotation: function(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n\n    return [1, 0, 0, 0, 0, c, s, 0, 0, -s, c, 0, 0, 0, 0, 1];\n  },\n\n  yRotation: function(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n\n    return [c, 0, -s, 0, 0, 1, 0, 0, s, 0, c, 0, 0, 0, 0, 1];\n  },\n\n  zRotation: function(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n\n    return [c, s, 0, 0, -s, c, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n  },\n\n  scaling: function(sx, sy, sz) {\n    return [sx, 0, 0, 0, 0, sy, 0, 0, 0, 0, sz, 0, 0, 0, 0, 1];\n  }\n};`, `55748380109120490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">translation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">xRotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">yRotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">zRotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">scaling</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sx<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> sz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>sx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sz<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意到我们现在有三个旋转方法，在二维中只需要一个是因为我们只需要绕 Z 轴旋转，现在在三维中还可以绕 X 轴和 Y 轴旋转。它们看起来还是很简单，如果使用它们后你会发现和之前一样</p>\n<p>绕 Z 轴旋转</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86782641516385040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`newX = x * c + y * s;\nnewY = x * -s + y * c;`, `86782641516385040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">newX = x * c + y * s;\nnewY = x * -s + y * c;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>绕 Y 轴旋转</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53994250699743840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`newX = x * c + z * s;\nnewZ = x * -s + z * c;`, `53994250699743840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">newX = x * c + z * s;\nnewZ = x * -s + z * c;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>绕 X 轴旋转</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67168891693894480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`newY = y * c + z * s;\nnewZ = y * -s + z * c;`, `67168891693894480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">newY = y * c + z * s;\nnewZ = y * -s + z * c;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>它们提供这些旋转方式。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/bhlktz?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [axis-diagram](embedded-codesandbox://webgl-fundamental-3d/axis-diagram?view=preview) -->\n<p>同样的我们将实现一些简单的方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70303406804164580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`translate: function(m, tx, ty, tz) {\n   return m4.multiply(m, m4.translation(tx, ty, tz));\n},\n\nxRotate: function(m, angleInRadians) {\n   return m4.multiply(m, m4.xRotation(angleInRadians));\n},\n\nyRotate: function(m, angleInRadians) {\n   return m4.multiply(m, m4.yRotation(angleInRadians));\n},\n\nzRotate: function(m, angleInRadians) {\n   return m4.multiply(m, m4.zRotation(angleInRadians));\n},\n\nscale: function(m, sx, sy, sz) {\n   return m4.multiply(m, m4.scaling(sx, sy, sz));\n},`, `70303406804164580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">translate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">translation</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">xRotate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">xRotation</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">yRotate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">yRotation</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">zRotate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">zRotation</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">scale</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> sx<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> sz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">scaling</span><span class="token punctuation">(</span>sx<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> sz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们还需要更新投影方法，这是原代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65796129330222740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`projection: function (width, height) {\n   // 注意：这个矩阵翻转了 Y 轴，所以 0 在上方\n   return [\n      2 / width, 0, 0,\n      0, -2 / height, 0,\n      -1, 1, 1\n   ];\n},`, `65796129330222740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">projection</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 注意：这个矩阵翻转了 Y 轴，所以 0 在上方</span>\n   <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token number">2</span> <span class="token operator">/</span> width<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">/</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>\n   <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它将像素坐标转换到裁剪空间，在初次尝试三维时我们将这样做</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74131784019620130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`projection: function(width, height, depth) {\n   // 注意：这个矩阵翻转了 Y 轴，所以 0 在上方\n   return [\n      2 / width, 0, 0, 0,\n      0, -2 / height, 0, 0,\n      0, 0, 2 / depth, 0,\n      -1, 1, 0, 1,\n   ];\n},`, `74131784019620130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">projection</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 注意：这个矩阵翻转了 Y 轴，所以 0 在上方</span>\n   <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token number">2</span> <span class="token operator">/</span> width<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">/</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">/</span> depth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>就像 X 和 Y 需要从像素空间转换到裁剪空间一样，Z 也需要。在这个例子中我也将 Z 单位化了，我会传递一些和 width 相似的值给 depth，所以我们的空间将会是 0 到 width 像素宽，0 到 height 像素高，但是对于 depth 将会是 -depth / 2 到 +depth / 2 。</p>\n<p>最后需要更新计算矩阵的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61111634994682420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算矩阵\nvar matrix = m4.projection(gl.canvas.clientWidth, gl.canvas.clientHeight, 400);\nmatrix = m4.translate(matrix, translation[0], translation[1], translation[2]);\nmatrix = m4.xRotate(matrix, rotation[0]);\nmatrix = m4.yRotate(matrix, rotation[1]);\nmatrix = m4.zRotate(matrix, rotation[2]);\nmatrix = m4.scale(matrix, scale[0], scale[1], scale[2]);\n\n// 设置矩阵\ngl.uniformMatrix4fv(matrixLocation, false, matrix);`, `61111634994682420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 计算矩阵</span>\n<span class="token keyword">var</span> matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">xRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">zRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>matrixLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是结果</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/81z8xd?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step1](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step1?view=preview) -->\n<p>我们遇到的第一个问题是 F 在三维中过于扁平，所以很难看出三维效果。解决这个问题的方法是将它拉伸成三维几何体。现在的 F 是由三个矩形组成，每个矩形两个三角形。让它变三维需要 16 个矩形。三个矩形在正面，三个背面，一个左侧，四个右侧，两个上侧，三个底面。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-8917b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 225px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADdUlEQVQ4y12Te0xTVxzHL6L7SzNdFhfnK4ozi1gUQ3qhraXF1iuspaIwGAooKVuB1jBKi2DLQ2DAHQtUW4agtCnVVNGJraU+KCkqzAcPH5TVV0yMJvyjiYkxyu09P+GSy9jOP+d7fvn+Pud7cs7BsHkjaosYqz7qZrRGbQ5j62lpuq8ZYWvbGFFRs5itS8aC4VxLJ+NTAWBbSdO/sPTMMqy1dZTRFcbzC9j6sdaRhlqyz3tuNVF6SNs0Ibzse/59/4BmRduJZaxH/uR1eJzNORcAK1SbMadzktG/k/3hbN3051ibzfoMutPrIUAY4bZIB+17SkHXdBok53onN/sGGlb19Kxn/bEufxiWrNBg9+7CLMB0e+HM/BWGfXG845Hb3h6AHpmBeiDU0wPiXymH8GDo7+16+hFPS3mTDVBb1QlyR88H3OW3c1tObmQgALOw9o4AA8tPKfnG3PnPiN10D3p36qbGEvTosrQIOcoU9KAyFt2U70ZeohANxZfS47wS6ga/BFVaTgLuueqbO/KZs5MMzFhs3WyxPn5pr/PBdXHR1IOEMvCJipF91wGkqiGRvrEOrhcm04GDeOhmRhLySlXomiqL7vNIQN5eX/+fhLU1bqnFGnzfdfgC+OM1Uw9FBnBMN5zn56MAzwij8XpoTKuhE+r+gob0RvDnKND9bO6nW644GBzD70xTFs0l/KNpIPvEqSB0qTthUKihRvgGOJurRGrPLpTqykSk9hfo3qGlDXGXgMj1TnJlvUO7xX6okFuguagYFLLTT5cvq4tkYNq85uWWjnGw5plhNFZNDW83QEdhDiKDUlR+NSMkceqQ6FUKJTMZ6BxBEFK5ttSZPgHXIRII+p0Swa2QhOfu5kT+sJQBlpfavqyscpn3q/Mmqn8qoE2HMynyhQSMnuzQjyl9II1xgbzAAbKqFlAIrlA8vFUz/zPwt2k2sFrIbQnDBBly5kISy7P2EWW5D4s80o+GC/mhvYnDsAP3XIza8jNnZ5T3tyR+/5tE8ZW3/G3HiRk/IXQvVKZ/WsDeQwynevZhr8FIdoNFCbxTw/uUZ2BP0hCIYy62zU/CiVZ9GxlRsHJGH9j7jmmOjjyC4VvJsOhN5YwnhnN02rhJySzWRvCXiPCuQ0Scb0KEOypZEB7dEJ6WND73ewihi0nV1QzYd+uysP+Pz4/VkctcukeqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 16 13 50 21" title="" data-src="/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-8917b.png" data-srcset="/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-a6db4.png 200w,\n/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-8917b.png 225w" data-sizes="(max-width: 225px) 100vw, 225px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>需要列出的还有很多，16 个矩形每个有两个三角形，每个三角形有 3 个顶点，所以一共有 96 个顶点。如果你想看这些可以去示例的源码里找。</p>\n<p>我们需要绘制更多顶点所以</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28303807499526610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制几何体\nvar primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 16 * 6;\ngl.drawArrays(primitiveType, offset, count);`, `28303807499526610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4}"\n              >\n                <span class="gatsby-code-button-language">js{4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制几何体</span>\n<span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span></span>gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是对应结果</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/06sn49?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step2](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step2?view=preview) -->\n<p>拖动滑块很难看出它是三维的，让我们给矩形上不同的颜色。需要在顶点着色器中添加一个属性和一个可变量，将颜色值传到片断着色器中。</p>\n<p>这是新的顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50546642822304280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-3d&quot; type=&quot;x-shader/x-vertex&quot;>\n   attribute vec4 a_position;\n   attribute vec4 a_color;\n\n   uniform mat4 u_matrix;\n\n   varying vec4 v_color;\n\n   void main() {\n      // 将位置和矩阵相乘\n      gl_Position = u_matrix * a_position;\n\n      // 将颜色传递给片断着色器\n      v_color = a_color;\n   }\n</script>`, `50546642822304280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3,7,13-14}"\n              >\n                <span class="gatsby-code-button-language">js{3,7,13-14}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   attribute vec4 a_position<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">   attribute vec4 a_color<span class="token punctuation">;</span></span>\n   uniform mat4 u_matrix<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">   varying vec4 v_color<span class="token punctuation">;</span></span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n      gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">      <span class="token comment">// 将颜色传递给片断着色器</span></span><span class="gatsby-highlight-code-line">      v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span></span>   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在片断着色器中使用颜色</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54197593552581800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-3d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 从顶点着色器中传入\n   varying vec4 v_color;\n\n   void main() {\n      gl_FragColor = v_color;\n   }\n</script>`, `54197593552581800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4-5,8}"\n              >\n                <span class="gatsby-code-button-language">js{4-5,8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">   <span class="token comment">// 从顶点着色器中传入</span></span><span class="gatsby-highlight-code-line">   varying vec4 v_color<span class="token punctuation">;</span></span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">      gl_FragColor <span class="token operator">=</span> v_color<span class="token punctuation">;</span></span>   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们需要找到属性的位置，然后在另一个缓冲中存入对应的颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27037164415976235000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\nvar colorLocation = gl.getAttribLocation(program, \'a_color\');\n\n// ...\n// 给颜色创建一个缓冲\nvar colorBuffer = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n// 将颜色值传入缓冲\nsetColors(gl);\n\n// ...\n// 向缓冲传入 \'F\' 的颜色值\nfunction setColors(gl) {\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Uint8Array([\n      // 正面左竖\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n\n      // 正面上横\n      200,\n      70,\n      120,\n      200,\n      70,\n      120\n    ]),\n    // ...\n    // ...\n    gl.STATIC_DRAW\n  );\n}`, `27037164415976235000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n<span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token comment">// 给颜色创建一个缓冲</span>\n<span class="token keyword">var</span> colorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 将颜色值传入缓冲</span>\n<span class="token function">setColors</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token comment">// 向缓冲传入 \'F\' 的颜色值</span>\n<span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n      <span class="token comment">// 正面左竖</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n\n      <span class="token comment">// 正面上横</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token comment">// ...</span>\n    <span class="token comment">// ...</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在渲染时告诉颜色属性如何从缓冲中获取颜色值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87740384365592540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 启用颜色属性\ngl.enableVertexAttribArray(colorLocation);\n\n// 绑定颜色缓冲\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n\n// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值\nvar size = 3; // 每次迭代使用 3 个单位的数据\nvar type = gl.UNSIGNED_BYTE; // 单位数据类型是无符号 8 位整数\nvar normalize = true; // 标准化数据 (从 0-255 转换到 0.0-1.0)\nvar stride = 0; // 0 = 移动距离 * 单位距离长度sizeof(type)，每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);`, `87740384365592540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 启用颜色属性</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 绑定颜色缓冲</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用 3 个单位的数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是无符号 8 位整数</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 标准化数据 (从 0-255 转换到 0.0-1.0)</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们得到这个。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/ebud7i?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step3](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step3?view=preview) -->\n<p>它好像把 ‘F’ 的所有部分都按照提供的顺序显示出来了，正面，背面，侧面等等。有时候这并不是想要的结果，在背面的物体反而被绘制出来了。</p>\n<p><img src="/static/polygon-drawing-order-6f0c8bfb4a988b0b830d2a0fe618b6ad.gif"></p>\n<p>红色部分是 ‘F’ 的正面，但是因为它在数据的前部所以最先被绘制出来，然后它后面的面绘制后挡住了它。例如紫色部分实际上是 ‘F’ 的背面，由于它在数据中是第二个所以第二个被画出来。</p>\n<p>WebGL 中的三角形有正反面的概念，正面三角形的顶点顺序是逆时针方向，反面三角形是顺时针方向。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-6144b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 232px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.65517241379311%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAC5UlEQVQ4y2Ng42ZhqLkYzgACm/7XgGlZIxE3IMXJAAX8UlwwJoN99QwGJMDKKSxu0/v/PxOIoxmYzMAQ1G0JlsnZ7sMMorO3ervFzHH8D2Sqg/hyJqKMVedCwWq0glLBtG54DlitlImjo13F1D+efRtkQHyzrBZGsAKPKiNGqI1cNZfCb838n/0/dbU72NnFhwPBmvlkFMEKhNX04M4LXXp2X+7V///dOldlgfjhKy6C1TKs+F8KZhTs9Zsx+Uf6/0nf0v6XnwzeChK7838Wk322DoN751Kw2pTDn1nAjuhdX5d69Ov/tGPf/ocsOXMEJPb/P9BjUdPtwQqiZzl4d79O/N/7NulP3/vk/813o787FegpgV0ywQbsA/fuNWCLTdMbzGI23/uffOD9/6T97/7FbL7/3zy71RDudB5RLt7aS+GPQC4DGvqn503Sb5BLs7Z4F4PkG29FMZtl1sGChQnooovpJ378T9z7+nfSvje/00/++u8zdWcbzDxOYHhtnP4/63/P26TvQAN/A/FPkOGVZ0JOwLwSu+UuOCZDlpzuyTzzF+i6d99BBgLxz9QjX/6Hr7x8jQEai1HAmP3f+Tz+L8irU35l/J/8M/3/1N8Z//s/pvxPXOpiBrNZzSvG3KV16f+YLffB3s0Auiz95M//Gad+/wcZqhmQHMPgWWPM7lykLxM+2dY0bY17YNZmr5KiAwEzGm5Ebk5e7vrLp8G0A+LKjYzc4rK8QKalRV6HiXvXGn9gcinyn7lvWsji09vDV168r+4Tt4GBAJBj52WVg7IZCahlAyZ6QTCLmY1ZnoWDxYqNm9WBS4jdgIOfzZydh9WBnY/NHJRxQGp4JbgYmFhYGUzTGoBpUomblYvHko2Hz4qVm9eOnU/QAJsNIkDsAHQHCDsDsTsQq8IkGZkYQW6EuJKRURbI8oeq8wGKeDMyM4thM1QAqEAHiK1A3oWLMjEhVDDCaVEg1gWybIC0OEwaAF6MGEfnVjJKAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 18 11 30 35" title="" data-src="/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-6144b.png" data-srcset="/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-b0d34.png 200w,\n/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-6144b.png 232w" data-sizes="(max-width: 232px) 100vw, 232px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>WebGL 可以只绘制正面或反面三角形，可以这样开启</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81641009657963840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enable(gl.CULL_FACE);`, `81641009657963840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">CULL_FACE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>将它放在 drawScene 方法里，开启这个特性后 WebGL 默认“剔除”背面三角形，“剔除”在这里是“不用绘制”的花哨叫法。</p>\n<p>对于 WebGL 而言，一个三角形是顺时针还是逆时针是根据裁剪空间中的顶点顺序判断的，换句话说，WebGL 是根据你在顶点着色器中运算后提供的结果来判定的，这就意味着如果你把一个顺时针的三角形沿 X 轴缩放 -1，它将会变成逆时针，或者将顺时针的三角形旋转 180 度后变成逆时针。由于我们没有开启 CULL_FACE，所以可以同时看到顺时针（正面）和逆时针（反面）三角形。现在开启了，任何时候正面三角形无论是缩放还是旋转的原因导致翻转了，WebGL 就不会绘制它。这件事很有用，因为通常情况下你只需要看到你正面对的面。</p>\n<p>开启 CULL_FACE 后得到</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/lmtm5y?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step4](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step4?view=preview) -->\n<p>结果证明，大多数三角形朝向都是错的，旋转的时候你会看到背面的三角形，幸好它很容易解决，我们只需要看看哪些是三角形是反的，然后交换它们的两个顶点。例如一个反的三角形</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96656359011151360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  1,   2,   3,\n 40,  50,  60,\n700, 800, 900,`, `96656359011151360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">  1,   2,   3,\n 40,  50,  60,\n700, 800, 900,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>只需要交换后两个顶点的位置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93500390722682300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  1,   2,   3,\n700, 800, 900,\n 40,  50,  60,`, `93500390722682300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">  1,   2,   3,\n700, 800, 900,\n 40,  50,  60,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>通过修正朝向错误后得到</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/pfgtxt?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step5](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step5?view=preview) -->\n<p>这很接近实际效果了但是还有一个问题，即使所有三角形的朝向是正确的，然后背面的被剔除了，有些应该在背面的部分还是出现在了前面。</p>\n<p>深度缓冲有时也叫 Z-Buffer，是一个存储像素深度的矩形，一个深度像素对应一个着色像素，在绘制图像时组合使用。当 WebGL 绘制每个着色像素时也会写入深度像素，它的值基于顶点着色器返回的 Z 值，就像我们将 X 和 Y 转换到裁剪空间一样，Z 也在裁剪空间或者 (-1 到 +1)。这个值会被转换到深度空间( 0 到 +1)，WebGL 绘制一个着色像素之前会检查对应的深度像素，如果对应的深度像素中的深度值小于当前像素的深度值，WebGL 就不会绘制新的颜色。反之它会绘制片断着色器提供的新颜色并更新深度像素中的深度值。这也意味着在其他像素后面的像素不会被绘制。</p>\n<p>我们可以像这样开启这个特性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60408635206313760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enable(gl.DEPTH_TEST);`, `60408635206313760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在开始绘制前还需要清除深度缓冲为 1.0。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40113749612907350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制场景\nfunction drawScene() {\n  // ...\n\n  // 清空画布和深度缓冲\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n  // ...\n}`, `40113749612907350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制场景</span>\n<span class="token keyword">function</span> <span class="token function">drawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n\n  <span class="token comment">// 清空画布和深度缓冲</span>\n  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span> <span class="token operator">|</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在得到</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/ts2ymi?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step6](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step6?view=preview) -->\n<p>这才是三维！</p>\n<p>还有一件小事，在大多数三维数学库中没有负责像素空间与裁剪空间转换的 projection 方法。代替的是叫做 ortho 或 orthographic 的方法，它看起来像这样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31929736774037234000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  orthographic: function(left, right, bottom, top, near, far) {\n    return [\n      2 / (right - left),\n      0,\n      0,\n      0,\n      0,\n      2 / (top - bottom),\n      0,\n      0,\n      0,\n      0,\n      2 / (near - far),\n      0,\n\n      (left + right) / (left - right),\n      (bottom + top) / (bottom - top),\n      (near + far) / (near - far),\n      1\n    ];\n  }\n};`, `31929736774037234000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">orthographic</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> top<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>top <span class="token operator">-</span> bottom<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n\n      <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>left <span class="token operator">-</span> right<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span>bottom <span class="token operator">+</span> top<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bottom <span class="token operator">-</span> top<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span>near <span class="token operator">+</span> far<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">1</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>和我们简单的 projection 方法不同的是正射投影有更多的参数可以传递，左，右，上，下，近和远，给我们更灵活的选择。为了用这个方法实现之前的投影，需要这样调用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7044102115823025000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var left = 0;\nvar right = gl.canvas.clientWidth;\nvar bottom = gl.canvas.clientHeight;\nvar top = 0;\nvar near = 400;\nvar far = -400;\nm4.orthographic(left, right, bottom, top, near, far);`, `7044102115823025000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> right <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n<span class="token keyword">var</span> bottom <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token keyword">var</span> top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> near <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> far <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">400</span><span class="token punctuation">;</span>\nm4<span class="token punctuation">.</span><span class="token function">orthographic</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> top<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="webgl-三维透视投影"><a href="#webgl-%E4%B8%89%E7%BB%B4%E9%80%8F%E8%A7%86%E6%8A%95%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维透视投影</h1>\n<p>上一篇文章讲述了如何实现三维，那个三维用的不是透视投影，而是的所谓的“正射”投影，但那不是我们日常观看三维的方式。</p>\n<p>我们应使用透视投影代替它，但什么是透视投影？它的基础特性就是离得越远显得越小。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-222ff.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.38095238095239%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACjElEQVQoz5WPW0gUURzGT/RgdkMDU0vaHoIMsjAxC6yIQJIMr7nrKkllarigokEhle39Ioa2O7MzbjOmaRfR7K1eJAoXS11XYzWvac32UD3UU9Qw83Xc6C2IHn58f875853fIdefB7+b/DMy5afRPy1HGA7RnPkffphHZnHjxdQKcU2EZX2XGxV999Aa+gTb+BJckxJsgXeROZL/YnxJdb0Jw/xqNkzso8tykmE/UppOqe3TX9VrLwNqzZNB1TGxojoCK+rqsnVsUbWMztNciMx/QXFOfoBp5K1Eah4PyqSIYF3pZtU0MoOL/b1IrN6DlsmPqOy/j+bhKTgC7+EKSjSXYR+j1qMLlHnK3G9ezynO4DLM/pBEMpr1MskjIKeJqhVv4aizEiSboHrgEXbVH0IO04QCwQHDs6e46p+AcXwRlqkwLNNfYAl9/oNin/sGYzAskWjtenkNNSQFRI0v346NZbEghQSxFzQgurUgpZuw4UwUNCVxyDIcQUObGW08A8ZUA8ZaB8bWQLNe4Z2NaDfXSoR+VyZaWqglKsknWJtLEJMXhSRqnXk8GrqcONTp0+G8fA5MixUiz4Fra0VHYxk68zXoyt2GuwU7lZ5CDYTcHRIpLkqQM07EIDNri1qiS4ThZCKq0rai6/xh3L6khWAz0hIfOJ+Ih339EEQRLMfDK3aDbbHAV3EMojZZ6S5PRYd+n0Qe6FLkytQE1KfHq4NnD4Cvyob9igFedzs4QYT3jgC3243e3h4MDPTD4/GA46gly9JHBLCMB3xdkdKt2w1fcbJEuJK9sqn4IEwGvcq2WsFSG5/QCY6nFl4WLMtAEAQMDQ2Bj5x5I4Xe1VJ6v7rHdgiK72Yt+LI06Rcu/wbO8qWs0QAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 19 11 22 58" title="" data-src="/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-fee1c.png" data-srcset="/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-a67b7.png 200w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-0b187.png 400w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-fee1c.png 800w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-b1a91.png 1200w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-222ff.png 1344w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在上方的示例中，远处的物体会变小，想要实现例子中近大远小的效果，简单的做法就是将裁减空间中的 X 和 Y 值除以 Z 值。</p>\n<p>你可以这么想：如果一个线段是 (10, 15) 到 (20,15)，它长度为十个单位，在当前的代码中它就是 10 个像素长，但是如果我们将它除以 Z，且 Z 值 为 1</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62557236736550430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`10 / 1 = 10\n20 / 1 = 20\nabs(10-20) = 10`, `62557236736550430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">10 / 1 = 10\n20 / 1 = 20\nabs(10-20) = 10</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>它将是 10 个像素长，如果 Z 值为 2</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84406527264792220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`10 / 2 = 5\n20 / 2 = 10\nabs(5 - 10) = 5`, `84406527264792220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">10 / 2 = 5\n20 / 2 = 10\nabs(5 - 10) = 5</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>就是 5 像素了，当 Z 值为 3 时</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84674255496426500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`10 / 3 = 3.333\n20 / 3 = 6.666\nabs(3.333 - 6.666) = 3.333`, `84674255496426500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">10 / 3 = 3.333\n20 / 3 = 6.666\nabs(3.333 - 6.666) = 3.333</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>你可以看出随着 Z 变大距离就变远了，画的也会小一点。如果我们除以裁剪空间中的 Z，值可能会变大，因为 Z 是一个较小的值(-1 到 +1)。但是我们可以提供一个 fudgeFactor 因子和 Z 相乘，这样就可以调整缩放的程度。</p>\n<p>让我们来试试，首先修改顶点着色器，除以 Z 再乘以我们的 “fudgeFactor” 因子。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44044234502506940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-3d&quot; type=&quot;x-shader/x-vertex&quot;>\n  // ...\n  uniform float u_fudgeFactor;\n  // ...\n  void main() {\n    // 将位置和矩阵相乘\n    vec4 position = u_matrix * a_position;\n\n    // 调整除数\n    float zToDivideBy = 1.0 + position.z * u_fudgeFactor;\n\n    // x 和 y 除以调整后的除数\n    gl_Position = vec4(position.xy / zToDivideBy, position.zw);\n  }\n</script>`, `44044234502506940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3,9-10,12-13}"\n              >\n                <span class="gatsby-code-button-language">js{3,9-10,12-13}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n  <span class="token comment">// ...</span>\n<span class="gatsby-highlight-code-line">  uniform float u_fudgeFactor<span class="token punctuation">;</span></span>  <span class="token comment">// ...</span>\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 将位置和矩阵相乘</span>\n    vec4 position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">    <span class="token comment">// 调整除数</span></span><span class="gatsby-highlight-code-line">    float zToDivideBy <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">+</span> position<span class="token punctuation">.</span>z <span class="token operator">*</span> u_fudgeFactor<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line">    <span class="token comment">// x 和 y 除以调整后的除数</span></span><span class="gatsby-highlight-code-line">    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>xy <span class="token operator">/</span> zToDivideBy<span class="token punctuation">,</span> position<span class="token punctuation">.</span>zw<span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意，由于裁减空间中的 Z 值是 -1 到 +1 的，所以 +1 是为了让 zToDivideBy 变成 0 到 <code class="language-text">+2 * fudgeFactor</code></p>\n<p>还需要更新代码以设置 fudgeFactor。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72842062722075255000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\nvar fudgeLocation = gl.getUniformLocation(program, \'u_fudgeFactor\');\n\n// ...\nvar fudgeFactor = 1;\n// ...\nfunction drawScene() {\n  // ...\n  // 设置 fudgeFactor\n  gl.uniform1f(fudgeLocation, fudgeFactor);\n\n  // 绘制几何体\n  var primitiveType = gl.TRIANGLES;\n  var offset = 0;\n  var count = 16 * 6;\n  gl.drawArrays(primitiveType, offset, count);\n  // ...\n}`, `72842062722075255000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n<span class="token keyword">var</span> fudgeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_fudgeFactor\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">var</span> fudgeFactor <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">function</span> <span class="token function">drawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 设置 fudgeFactor</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>fudgeLocation<span class="token punctuation">,</span> fudgeFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 绘制几何体</span>\n  <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/pokxmd?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective?view=preview) -->\n<p>如果效果不明显，可以将 “fudgeFactor” 滑块从 1.0 拖到 0.0 来对比没添加这些代码之前的样子。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-24151.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 313px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.0223642172524%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+ElEQVQoz2P4////v/////77B6LA7K9/gDwwBwb+AQX+/oNz4OIMEAoo8PDf302fv9TffzX/Uu+ndwdAysDqIAb9+//n2bM1T54s/g+1Aqb52e/flZfvpK/ZX92+aF5k954Ox+t3KyGaITq/33t/ZXHD0TMWR45YvXq5DW4uSPO5naeX+teecq24aF1yw6f5afecXz8fw1346dK9s+GtR20KTsyOOHra9cmTrTC3gjX/e/PxamjrMY/ic81BN6/t3vj8/8WLX8HGg1RdKZh22DznlEfd6eScL2/OwK0Faf73F8R6feTKcfvS0/WxLUvmpWTvSPW69PbVL4iKX+8+XUqdfLoo7PoK+2MXNszf+PbZXYjR/xgggQkk73avOmhdetKz5pR5xczccx8+QxwOMvrn66/XK1r3tEXlN2/0Nr3cU/AQ4i5waIPd9/P9pwvhbYe9imcvC7/5ZD8itMFG/3z1+XzKlGPWJQ3uG5atOgfy9N9/0Kj69wek7u3hSyesS+cujZn2NP3L9/eIeALb//v1p/NFvdOWBU14GP7g43lEPMNV3Gtbdcg6p3u7++XP+0DG//uDLPv75Zfj7V1tW+3Pvd+Kohnq+DcfrmVNv7Z+3a//v/7/+//v/z/kdAbS//TTowsnfv//haoZqgRqCXbw7z8sFYMoAJqia9bsRhwAAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 23 11 12 31" title="" data-src="/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-24151.png" data-srcset="/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-8a062.png 200w,\n/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-24151.png 313w" data-sizes="(max-width: 313px) 100vw, 313px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>事实上 WebGL 会将我们提供给 <code class="language-text">gl_Position</code> 的 x, y, z, w 值自动除以 w 。</p>\n<p>我们可以通过修改着色器来证明，用 zToDivideBy 代替 <code class="language-text">gl_Position.w</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76407545534297230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   // ...\n   uniform float u_fudgeFactor;\n   // ...\n   void main() {\n      // 将位置和矩阵相乘\n      vec4 position = u_matrix * a_position;\n\n      // 调整除数\n      float zToDivideBy = 1.0 + position.z * u_fudgeFactor;\n\n      // 将 x y z 除以 zToDivideBy\n      gl_Position = vec4(position.xyz, zToDivideBy);\n\n      // 传递颜色到给片断着色器\n      v_color = a_color;\n   }\n</script>`, `76407545534297230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{13}"\n              >\n                <span class="gatsby-code-button-language">js{13}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   <span class="token comment">// ...</span>\n   uniform float u_fudgeFactor<span class="token punctuation">;</span>\n   <span class="token comment">// ...</span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n      vec4 position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n      <span class="token comment">// 调整除数</span>\n      float zToDivideBy <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">+</span> position<span class="token punctuation">.</span>z <span class="token operator">*</span> u_fudgeFactor<span class="token punctuation">;</span>\n\n      <span class="token comment">// 将 x y z 除以 zToDivideBy</span>\n<span class="gatsby-highlight-code-line">      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>xyz<span class="token punctuation">,</span> zToDivideBy<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n      <span class="token comment">// 传递颜色到给片断着色器</span>\n      v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看他们多像。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/1jhg42?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective-w](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective-w?view=preview) -->\n<p>为什么 WebGL 会自动除以 W ？因为使用矩阵的魔力，可以用把值从 z 传值到 w 。</p>\n<p>一个这样的矩阵</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60062343442099670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 0,`, `60062343442099670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 0,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>将会把 z 的值复制给 w，你可以把每列看作</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2304986891063376400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x_out = x_in * 1 +\n        y_in * 0 +\n        z_in * 0 +\n        w_in * 0 ;\n\ny_out = x_in * 0 +\n        y_in * 1 +\n        z_in * 0 +\n        w_in * 0 ;\n\nz_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;\n\nw_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;`, `2304986891063376400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x_out = x_in * 1 +\n        y_in * 0 +\n        z_in * 0 +\n        w_in * 0 ;\n\ny_out = x_in * 0 +\n        y_in * 1 +\n        z_in * 0 +\n        w_in * 0 ;\n\nz_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;\n\nw_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>简化后得到</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83646197071409000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x_out = x_in;\ny_out = y_in;\nz_out = z_in;\nw_out = z_in;`, `83646197071409000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x_out = x_in;\ny_out = y_in;\nz_out = z_in;\nw_out = z_in;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 w 原来就是 1.0 就会加 1</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3055920838475101000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 1,`, `3055920838475101000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 1,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>他会将 W 的运算变为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73262530905753270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 1 ;`, `73262530905753270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 1 ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为 w_in = 1.0 是已知的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15218215977644345000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = z_in + 1;`, `15218215977644345000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = z_in + 1;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>最后可以将 fudgeFactor 像这样放入矩阵中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30781243791432344000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, fudgeFactor,\n0, 0, 0, 1,`, `30781243791432344000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, fudgeFactor,\n0, 0, 0, 1,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>相当于</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36178895136442570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * fudgeFactor +\n        w_in * 1 ;`, `36178895136442570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * fudgeFactor +\n        w_in * 1 ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>简化后为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92134736718376350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = z_in * fudgeFactor + 1;`, `92134736718376350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = z_in * fudgeFactor + 1;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们来修改代码，使用这个矩阵。</p>\n<p>首先将顶点着色器还原，又变成简单的样子</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23672070326481730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   uniform mat4 u_matrix;\n\n   void main() {\n      // 位置和矩阵相乘\n      gl_Position = u_matrix * a_position;\n      // ...\n   }\n</script>`, `23672070326481730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   uniform mat4 u_matrix<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 位置和矩阵相乘</span>\n      gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n      <span class="token comment">// ...</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接下来定义一个方法实现 Z → W 的矩阵</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47600225417576645000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function makeZToWMatrix(fudgeFactor) {\n  return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, fudgeFactor, 0, 0, 0, 1];\n}`, `47600225417576645000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">makeZToWMatrix</span><span class="token punctuation">(</span><span class="token parameter">fudgeFactor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fudgeFactor<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后使用它。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63014681575365075000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n// 计算矩阵\nvar matrix = makeZToWMatrix(fudgeFactor);\nmatrix = m4.multiply(matrix, m4.projection(gl.canvas.clientWidth, gl.canvas.clientHeight, 400));\nmatrix = m4.translate(matrix, translation[0], translation[1], translation[2]);\nmatrix = m4.xRotate(matrix, rotation[0]);\nmatrix = m4.yRotate(matrix, rotation[1]);\nmatrix = m4.zRotate(matrix, rotation[2]);\nmatrix = m4.scale(matrix, scale[0], scale[1], scale[2]);\n\n// ...`, `63014681575365075000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3-4}"\n              >\n                <span class="gatsby-code-button-language">js{3-4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n<span class="token comment">// 计算矩阵</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> matrix <span class="token operator">=</span> <span class="token function">makeZToWMatrix</span><span class="token punctuation">(</span>fudgeFactor<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">xRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">zRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>和之前的很像。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/b0ky3t?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective-w-matrix](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective-w-matrix?view=preview) -->\n<p>这只是展示了除以 Z 值获可以实现透视投影，以及在 WebGL 中简单实现。</p>\n<p>但还有一些问题需要解决，比如将 Z 值设置为 -100 左右的时候会遇到下面的情形</p>\n<p><img src="/static/z-clipping-948d177dcce9ad96f72b6ddd71253aeb.gif"></p>\n<p>为什么会这样？为什么 F 提前消失了？WebGL 裁剪空间中的 X 和 Y 会被 +1 和 -1 裁剪，Z 也一样。我们看到的是 Z &#x3C; -1 的情况。</p>\n<p>我可以从数学方法深入探讨并寻找解决办法，但是你可以联想二维中的的解决方法。我们需要获取 Z 值，然后加上一些量，缩放一些量，就可以将任意范围映射到 -1 到 +1 的范围内。</p>\n<p>最有意思的是这件事可以在一个矩阵中完成，更方便的是，我们可以定义一个 fieldOfView 代替 fudgeFactor，计算出更合适的值。</p>\n<p>这是创建矩阵的方法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60985643162677340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  perspective: function(fieldOfViewInRadians, aspect, near, far) {\n    var f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewInRadians);\n    var rangeInv = 1.0 / (near - far);\n\n    return [f / aspect, 0, 0, 0, 0, f, 0, 0, 0, 0, (near + far) * rangeInv, -1, 0, 0, near * far * rangeInv * 2, 0];\n  }\n};\n\n// ...`, `60985643162677340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">perspective</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fieldOfViewInRadians<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> f <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> fieldOfViewInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> rangeInv <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>f <span class="token operator">/</span> aspect<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> f<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>near <span class="token operator">+</span> far<span class="token punctuation">)</span> <span class="token operator">*</span> rangeInv<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> near <span class="token operator">*</span> far <span class="token operator">*</span> rangeInv <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个矩阵会为我们完成所有转换。它可以调整单位以适应裁剪空间，它可以自定义视场角，选择 Z-裁剪面。假设有一个眼睛或者摄像机在原点(0, 0, 0)，根据 zNear 和 fieldOfView 可以将 zNear 对应到 Z = -1，在 zNear 平面上一半的 fieldOfView 长度对应画布中心到 Y = -1 或 Y = 1 的距离，X 的值通过乘以 aspect 获取，最后通过设置 zFar 对应 Z = 1，控制缩放的程度。</p>\n<p>这是矩阵的图解。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/5sl3lw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [frustum-diagram](embedded-codesandbox://webgl-fundamental-3d/frustum-diagram?view=preview) -->\n<p>正方体所在的有四个侧面的椎体叫做“视锥”，矩阵将视锥中的空间转换到裁剪空间中，zNear 决定了被正面切割的位置，zFar 决定被背面切割的位置。将 zNear 设置为 23 就会看到正方体正面被切割，将 zFar 设置为 24 就会看到正方体背面被切割。</p>\n<p>还有一个问题，矩阵假定观察位置为 0, 0, 0 并且看向 Z 轴负方向，Y 轴为上方向。这和我们目前为止做法不同，为了解决这个问题我们需要将物体放到视图范围内。</p>\n<p>我们在 (45, 150, 0) 绘制的 F，可以将它移动到 (-150, 0, -360)</p>\n<p>使用 m4.projection 方法代替之前的投影方法，可以调用 m4.perspective</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1348078700287058700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;\nvar zNear = 1;\nvar zFar = 2000;\nvar matrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);\nmatrix = m4.translate(matrix, translation[0], translation[1], translation[2]);\nmatrix = m4.xRotate(matrix, rotation[0]);\nmatrix = m4.yRotate(matrix, rotation[1]);\nmatrix = m4.zRotate(matrix, rotation[2]);\nmatrix = m4.scale(matrix, scale[0], scale[1], scale[2]);`, `1348078700287058700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> aspect <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token keyword">var</span> zNear <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> zFar <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">perspective</span><span class="token punctuation">(</span>fieldOfViewRadians<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> zNear<span class="token punctuation">,</span> zFar<span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">xRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">zRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果在这里。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/y9yucf?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective-matrix](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective-matrix?view=preview) -->\n<p>我们讲了矩阵乘法，视角和自定义 Z 范围。还有很多没讲完，但这篇文章已经很长了，所以接下来继续讲相机。</p>\n<blockquote>\n<p><strong>为什么将 F 移动到那么远的距离（Z = -360）?</strong></p>\n<p>在其他的例子中 F 都在 (45, 150, 0)，但在最后一个例子中它被移动到了 (-150, 0, -360)。为什么它被移动到那么远的地方？</p>\n<p>原因是在最后一个例子中用 m4.projection 方法将像素移动到裁减空间，我们的显示范围是 <code class="language-text">400 x 300</code> 像素，<code class="language-text">像素</code> 在三维中无法解释。所以新投影创建了一个视锥，它在 zNear 的距离时是 2 个单位高和 <code class="language-text">2 * aspect</code> 个单位宽。由于 <code class="language-text">F</code> 的大小是 150 个单位，在近平面的时候只能看到 2 个单位的高度，所以我们将它移到足够远的地方才能看到完整的它。</p>\n<p>同样的将 <code class="language-text">X</code> 从 45 移动到 -150。过去视图表示的范围是 0 到 400 个单位，现在它表示的 -1 到 +1 个单位。</p>\n</blockquote>\n<h1 id="webgl-三维相机"><a href="#webgl-%E4%B8%89%E7%BB%B4%E7%9B%B8%E6%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维相机</h1>\n<p>在上篇文章中我们将 F 移动到了视锥中，原因是 <code class="language-text">m4.perspective</code> 默认将相机放在了原点 <code class="language-text">(0, 0, 0)</code> 并且视锥的范围是 <code class="language-text">-zNear</code> 到 <code class="language-text">-zFar</code>。</p>\n<p>将物体移动到视场中可能并不是正确的方法，在实际生活中通常是移动相机去拍摄建筑物。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=0" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=0) -->\n<p>将物体移动到相机前面并不是常见做法。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=1" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=1) -->\n<p>但在上节中由于投影的原因物体需要在 -Z 轴上，我们通过将相机移动到原点，物体移动到相机前来保持原始的相对位置。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=2" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=2) -->\n<p>高效的将物体移动到相机前是非常重要的。最简单的方式是使用一个“逆向”矩阵，计算逆矩阵的数学原理比较复杂但概念很简单，逆就是你想通过一个值去抵消一个值。例如，123 的逆就是 -123，一个缩放为 5 的缩放矩阵的逆是缩放为 1/5 或 0.2 的缩放矩阵，一个绕 X 轴旋转 30° 的旋转矩阵的逆是绕 X 旋转 -30°。</p>\n<p>目前为止我们使用过平移，旋转和缩放去控制 ‘F’ 的位置和姿态，将这些矩阵相乘后得到一个矩阵，可以将物体从原始位置移动到期望的位置，大小和姿态。我们可以对相机进行同样的操作，一旦有了相机从原点移动旋转到目标位置的矩阵后，就可以计算出它的逆矩阵，利用这个逆矩阵可以不动相机，将物体从相反的方向移动到相机前。</p>\n<p>让我们来做一个三维场景，像上图一样有一圈 ‘F’ 。</p>\n<p>首先，由于 5 个物体使用的是同一个投影矩阵，所以我们将投影矩阵的计算放在循环外</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73100145986392450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算投影矩阵\nvar aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;\nvar zNear = 1;\nvar zFar = 2000;\nvar projectionMatrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);`, `73100145986392450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 计算投影矩阵</span>\n<span class="token keyword">var</span> aspect <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token keyword">var</span> zNear <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> zFar <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> projectionMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">perspective</span><span class="token punctuation">(</span>fieldOfViewRadians<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> zNear<span class="token punctuation">,</span> zFar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接着计算相机矩阵，这个矩阵代表的是相机在世界坐标中的位置和姿态。下方的代码计算的是看向原点，在半径为 <code class="language-text">radius * 1.5</code> 的圆上移动的相机。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=3" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=3) -->\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24778789584679630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var numFs = 5;\nvar radius = 200;\n\n// 计算相机的矩阵\nvar cameraMatrix = m4.yRotation(cameraAngleRadians);\ncameraMatrix = m4.translate(cameraMatrix, 0, 0, radius * 1.5);`, `24778789584679630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> numFs <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> radius <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 计算相机的矩阵</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotation</span><span class="token punctuation">(</span>cameraAngleRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\ncameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> radius <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后通过相机矩阵计算“视图矩阵”，视图矩阵是将所有物体以相反于相机的方向运动，尽管相机还是在原点但是相对关系是期望的。我们可以使用 inverse 方法计算逆矩阵（完全对立的转换矩阵），在这个例子中提供的是绕原点转动的矩阵，它的逆矩阵是移动相机以外的所有物体，好像相机在原点一样。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28027114080692716000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 通过相机矩阵计算视图矩阵\nvar viewMatrix = m4.inverse(cameraMatrix);`, `28027114080692716000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 通过相机矩阵计算视图矩阵</span>\n<span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>现在将视图矩阵和投影矩阵结合在一起</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27135076896930464000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算组合矩阵\nvar viewProjectionMatrix = m4.multiply(projectionMatrix, viewMatrix);`, `27135076896930464000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 计算组合矩阵</span>\n<span class="token keyword">var</span> viewProjectionMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>projectionMatrix<span class="token punctuation">,</span> viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>最后绘制一圈 F，将每个 F 乘以视图投影矩阵，然后旋转和向外平移 radius 个单位。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20234106131385390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for (var ii = 0; ii < numFs; ++ii) {\n  var angle = (ii * Math.PI * 2) / numFs;\n  var x = Math.cos(angle) * radius;\n  var y = Math.sin(angle) * radius;\n\n  // 从视图投影矩阵开始\n  // 计算 F 的矩阵\n  var matrix = m4.translate(viewProjectionMatrix, x, 0, y);\n\n  // 设置矩阵\n  gl.uniformMatrix4fv(matrixLocation, false, matrix);\n\n  // 获得几何体\n  var primitiveType = gl.TRIANGLES;\n  var offset = 0;\n  var count = 16 * 6;\n  gl.drawArrays(primitiveType, offset, count);\n}`, `20234106131385390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> numFs<span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> angle <span class="token operator">=</span> <span class="token punctuation">(</span>ii <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> numFs<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n\n  <span class="token comment">// 从视图投影矩阵开始</span>\n  <span class="token comment">// 计算 F 的矩阵</span>\n  <span class="token keyword">var</span> matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>viewProjectionMatrix<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置矩阵</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>matrixLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 获得几何体</span>\n  <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一个绕 F 旋转的相机。拖动 cameraAngle 滑块移动相机。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/2cxg3w?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-camera](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-camera?view=preview) -->\n<p>这样做没什么问题，但是有时利用旋转和平移去移动相机，让它到达期望的位置并看向期望的方向并不容易。例如你想让它总是看向一个特定的 F，而相机又在绕一圈 F 旋转，这时计算会变的相当复杂。</p>\n<p>幸好这有一个简单的方法，我们可以同时定义相机位置和朝向，然后矩阵就可以将相机放在那，基于矩阵这个工作就会变得非常简单。</p>\n<p>首先我们需要知道相机的期望位置，将它叫做 cameraPosition，然后需要知道看向或对准的目标位置，将它叫做 target。如果将 target 减去 cameraPosition 就会得到相机的朝向，将它叫做 zAxis。由于我们知道相机看向的是 -Z 方向，所以可以用另一种方式相减 <code class="language-text">cameraPosition - target</code>，将结果单位化后直接赋给矩阵的 z 区域。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48616386412312520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n| Zx | Zy | Zz |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+`, `48616386412312520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n| Zx | Zy | Zz |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>矩阵的这个区域代表的是 Z 轴。在这个例子中相机的 Z-axis 进行了单位化，单位化也就是一个做一个类似 1.0 的矢量，如果你回到二维旋转的文章，那里讲到的单位圆在二维旋转中用法，在三维中需要一个单位球，单位向量表示单位球上的点。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/d8lusx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=0" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [cross-product-diagram](embedded-codesandbox://webgl-fundamental-3d/cross-product-diagram?view=preview&initialpath=?mode=0) -->\n<p>这些信息还不够，只给了一个单位圆上点，如何来确定物体的姿态呢？这就需要填充矩阵的其他区域，尤其是 X 轴和 Y 轴。通常情况下我们知道它们互相垂直，如果再知道哪里是上方，在该例中是 <code class="language-text">(0, 1, 0)</code>，就可以使用“叉乘”去计算矩阵的 X 轴和 Y 轴。</p>\n<p>我不知道叉乘的数学意义是什么，但我知道将两个单位向量叉乘后可以得到一个和它们都垂直的向量。换句话说，如果你有一个向量指向东南方，一个向量指向上方，叉乘后会得到一个指向西南方或东北方的矢量，因为这两个矢量都和东南方和上方垂直，相乘的顺序不同得到结果相反。</p>\n<p>在任何情况下我们可以通过叉乘 zAxis 和 up 得到相机的 xAxis。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/d8lusx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=1" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [cross-product-diagram](embedded-codesandbox://webgl-fundamental-3d/cross-product-diagram?view=preview&initialpath=?mode=1) -->\n<p>现在我们有了 xAxis，可以叉乘 zAxis 和 xAxis 得到相机的 yAxis。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/d8lusx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=2" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [cross-product-diagram](embedded-codesandbox://webgl-fundamental-3d/cross-product-diagram?view=preview&initialpath=?mode=2) -->\n<p>现在将三个轴插入矩阵中，会给我们提供一个从 cameraPosition 指向 target 的转换，只需要再加上 position</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58607491104576770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`+----+----+----+----+\n| Xx | Xy | Xz |  0 |  <- x axis\n+----+----+----+----+\n| Yx | Yy | Yz |  0 |  <- y axis\n+----+----+----+----+\n| Zx | Zy | Zz |  0 |  <- z axis\n+----+----+----+----+\n| Tx | Ty | Tz |  1 |  <- 相机位置\n+----+----+----+----+`, `58607491104576770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">+----+----+----+----+\n| Xx | Xy | Xz |  0 |  &lt;- x axis\n+----+----+----+----+\n| Yx | Yy | Yz |  0 |  &lt;- y axis\n+----+----+----+----+\n| Zx | Zy | Zz |  0 |  &lt;- z axis\n+----+----+----+----+\n| Tx | Ty | Tz |  1 |  &lt;- 相机位置\n+----+----+----+----+</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是计算叉乘的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87356493057403670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function cross(a, b) {\n  return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\n}`, `87356493057403670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这是向量相减的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96895781898176090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function subtractVectors(a, b) {\n  return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\n}`, `96895781898176090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">subtractVectors</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这是单位化向量的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20934330143447167000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function normalize(v) {\n  var length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\n  // 确定不会除以 0\n  if (length > 0.00001) {\n    return [v[0] / length, v[1] / length, v[2] / length];\n  } else {\n    return [0, 0, 0];\n  }\n}`, `20934330143447167000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 确定不会除以 0</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0.00001</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> length<span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> length<span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> length<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是计算“朝向”矩阵的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38522034038355436000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  lookAt: function(cameraPosition, target, up) {\n    var zAxis = normalize(subtractVectors(cameraPosition, target));\n    var xAxis = normalize(cross(up, zAxis));\n    var yAxis = normalize(cross(zAxis, xAxis));\n\n    return [\n      xAxis[0],\n      xAxis[1],\n      xAxis[2],\n      0,\n      yAxis[0],\n      yAxis[1],\n      yAxis[2],\n      0,\n      zAxis[0],\n      zAxis[1],\n      zAxis[2],\n      0,\n      cameraPosition[0],\n      cameraPosition[1],\n      cameraPosition[2],\n      1\n    ];\n  }\n};`, `38522034038355436000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">lookAt</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cameraPosition<span class="token punctuation">,</span> target<span class="token punctuation">,</span> up</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> zAxis <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">subtractVectors</span><span class="token punctuation">(</span>cameraPosition<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> xAxis <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> zAxis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> yAxis <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>zAxis<span class="token punctuation">,</span> xAxis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      xAxis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      xAxis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      xAxis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      yAxis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      yAxis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      yAxis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      zAxis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      zAxis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      zAxis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      cameraPosition<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      cameraPosition<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      cameraPosition<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">1</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是在移动过程中朝向某个确切的 ‘F’ 的用法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44406804491205130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\n// 计算第一个 F 的位置\nvar fPosition = [radius, 0, 0];\n\n// 计算相机在圆上的位置矩阵\nvar cameraMatrix = m4.yRotation(cameraAngleRadians);\ncameraMatrix = m4.translate(cameraMatrix, 0, 0, radius * 1.5);\n\n// 获得矩阵中相机的位置\nvar cameraPosition = [cameraMatrix[12], cameraMatrix[13], cameraMatrix[14]];\n\nvar up = [0, 1, 0];\n\n// 计算相机的朝向矩阵\nvar cameraMatrix = m4.lookAt(cameraPosition, fPosition, up);\n\n// 通过相机矩阵获得视图矩阵\nvar viewMatrix = m4.inverse(cameraMatrix);\n\n// ...`, `44406804491205130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token comment">// 计算第一个 F 的位置</span>\n<span class="token keyword">var</span> fPosition <span class="token operator">=</span> <span class="token punctuation">[</span>radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 计算相机在圆上的位置矩阵</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotation</span><span class="token punctuation">(</span>cameraAngleRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\ncameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> radius <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获得矩阵中相机的位置</span>\n<span class="token keyword">var</span> cameraPosition <span class="token operator">=</span> <span class="token punctuation">[</span>cameraMatrix<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cameraMatrix<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cameraMatrix<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> up <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 计算相机的朝向矩阵</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>cameraPosition<span class="token punctuation">,</span> fPosition<span class="token punctuation">,</span> up<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 通过相机矩阵获得视图矩阵</span>\n<span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/9uxqkz?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-camera-look-at](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-camera-look-at?view=preview) -->\n<p>拖动滑块观察相机是如何追踪单个 ‘F’ 的。</p>\n<p>你也可以对其他东西使用 lookAt 方法而不只是相机。通常是让角色视线跟着某人，将炮塔指向目标，让物体沿着路径移动。你可以算出物体当前在路径上的位置和不久后的位置，然后将这两个值放入 lookAt 方法，可以让物体沿着路径移动并且朝着路径的方向。</p>\n<h2 id="lookat-标准"><a href="#lookat-%E6%A0%87%E5%87%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>lookAt 标准</h2>\n<p>大多数三维数学库都有 lookAt 方法，通常它是用于计算 <code class="language-text">视图矩阵</code> 而不是 <code class="language-text">相机矩阵</code>。换句话说这个矩阵将所有物体移动到相机前而不是将相机移动到物体前。</p>\n<p>我发现它并不好用，前面指出一个 lookAt 方法有很多用处，当你需要视图矩阵的时候只需要调用 inverse 方法，但当你想要让角色跟随另一个角色或者炮台跟随目标的时候，在我看来 lookAt 方法返回世界坐标中的朝向和位置转换会好一些。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/51gr6f?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-camera-look-at-heads](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-camera-look-at-heads?view=preview) -->',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——三维/index.md absPath of file >>> MarkdownRemark",timeToRead:16,frontmatter:{date:"2022-05-16 11:31:23",path:"/webgl-fundamental-3d/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——三维",draft:null}},{excerpt:"WebGL 图像处理 在 WebGL 中绘制图片需要使用纹理。和 WebGL 渲染时需要裁剪空间坐标相似，渲染纹理时需要纹理坐标，而不是像素坐标。无论纹理是什么尺寸，纹理坐标范围始终是 0.0 到 1.0 。 因为我们只用画一个矩形（其实是两个三角形），所以需要告诉 WebGL 矩形中每个顶点对应的纹理坐标。我们将使用一种特殊的叫做 varying 的变量将纹理坐标从顶点着色器传到片断着色器，它叫做“可变量” 是因为它的值有很多个，WebGL…",html:'<h1 id="webgl-图像处理"><a href="#webgl-%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 图像处理</h1>\n<p>在 WebGL 中绘制图片需要使用纹理。和 WebGL 渲染时需要裁剪空间坐标相似，渲染纹理时需要纹理坐标，而不是像素坐标。无论纹理是什么尺寸，纹理坐标范围始终是 0.0 到 1.0 。</p>\n<p>因为我们只用画一个矩形（其实是两个三角形），所以需要告诉 WebGL 矩形中每个顶点对应的纹理坐标。我们将使用一种特殊的叫做 varying 的变量将纹理坐标从顶点着色器传到片断着色器，它叫做“可变量” 是因为它的值有很多个，WebGL 会用顶点着色器中值的进行插值，然后传给对应像素执行的片断着色器。</p>\n<p>接着用顶点着色器，我们需要添加一个属性，用它接收纹理坐标然后传给片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47214452884967780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec2 a_texCoord;\n// ...\nvarying vec2 v_texCoord;\n\nvoid main() {\n   // ...\n   // 将纹理坐标传给片断着色器\n   // GPU 会在点之间进行插值\n   v_texCoord = a_texCoord;\n}`, `47214452884967780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_texCoord<span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec2</span> v_texCoord<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// ...</span>\n   <span class="token comment">// 将纹理坐标传给片断着色器</span>\n   <span class="token comment">// GPU 会在点之间进行插值</span>\n   v_texCoord <span class="token operator">=</span> a_texCoord<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后用片断着色器寻找纹理上对应的颜色</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91006668048640880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 纹理\n   uniform sampler2D u_image;\n\n   // 从顶点着色器传入的纹理坐标\n   varying vec2 v_texCoord;\n\n   void main() {\n      // 在纹理上寻找对应颜色值\n      gl_FragColor = texture2D(u_image, v_texCoord);\n   }\n</script>`, `91006668048640880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n   <span class="token comment">// 纹理</span>\n   uniform sampler2D u_image<span class="token punctuation">;</span>\n\n   <span class="token comment">// 从顶点着色器传入的纹理坐标</span>\n   varying vec2 v_texCoord<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 在纹理上寻找对应颜色值</span>\n      gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后我们需要加载一个图像，创建一个纹理然后将图像复制到纹理中。由于浏览器中的图片是异步加载的，所以我们需要重新组织一下代码，等待纹理加载，一旦加载完成就开始绘制。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29527525540912603000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function main() {\n  var image = new Image();\n  image.src = \'http://someimage/on/our/server\'; // 必须在同一域名下\n  image.onload = function() {\n    render(image);\n  };\n}\n\nfunction render(image) {\n  // ...\n  // 之前的代码\n  // ...\n  // 找到纹理的地址\n  var texCoordLocation = gl.getAttribLocation(program, \'a_texCoord\');\n\n  // 给矩形提供纹理坐标\n  var texCoordBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]),\n    gl.STATIC_DRAW\n  );\n  gl.enableVertexAttribArray(texCoordLocation);\n  gl.vertexAttribPointer(texCoordLocation, 2, gl.FLOAT, false, 0, 0);\n\n  // 创建纹理\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  // 设置参数，让我们可以绘制任何尺寸的图像\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n  // 将图像上传到纹理\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n  // ...\n}`, `29527525540912603000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'http://someimage/on/our/server\'</span><span class="token punctuation">;</span> <span class="token comment">// 必须在同一域名下</span>\n  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">render</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 之前的代码</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 找到纹理的地址</span>\n  <span class="token keyword">var</span> texCoordLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_texCoord\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 给矩形提供纹理坐标</span>\n  <span class="token keyword">var</span> texCoordBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> texCoordBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>texCoordLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>texCoordLocation<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 创建纹理</span>\n  <span class="token keyword">var</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置参数，让我们可以绘制任何尺寸的图像</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 将图像上传到纹理</span>\n  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是 WebGL 绘制的图像。注意：如果你想在本地运行，需要使用一个简单的 web 服务，使得 WebGL 可以加载本地图片。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/8f3085?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>这个图片没什么特别的，让我们来对它进行一些操作。把红和蓝调换位置如何？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90606540232529740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\ngl_FragColor = texture2D(u_image, v_texCoord).bgra;\n// ...`, `90606540232529740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// ...</span>\ngl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord<span class="token punctuation">)</span><span class="token punctuation">.</span>bgra<span class="token punctuation">;</span>\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>现在红色和蓝色调换位置了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/0gxj1r?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果我们的图像处理需要其他像素的颜色值怎么办？由于 WebGL 的纹理坐标范围是 0.0 到 1.0，那我们可以简单计算出移动一个像素对应的距离，onePixel = 1.0 / textureSize。</p>\n<p>这个片断着色器将每个像素的值设置为与左右像素的均值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53650984640869925000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 纹理\n   uniform sampler2D u_image;\n   uniform vec2 u_textureSize;\n\n   // 从顶点着色器传入的像素坐标\n   varying vec2 v_texCoord;\n\n   void main() {\n      // 计算 1 像素对应的纹理坐标\n      vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\n      // 对左中右像素求均值\n      gl_FragColor = (\n         texture2D(u_image, v_texCoord) +\n         texture2D(u_image, v_texCoord + vec2(onePixel.x, 0.0)) +\n         texture2D(u_image, v_texCoord + vec2(-onePixel.x, 0.0))\n      ) / 3.0;\n   }\n</script>`, `53650984640869925000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n   <span class="token comment">// 纹理</span>\n   uniform sampler2D u_image<span class="token punctuation">;</span>\n   uniform vec2 u_textureSize<span class="token punctuation">;</span>\n\n   <span class="token comment">// 从顶点着色器传入的像素坐标</span>\n   varying vec2 v_texCoord<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 计算 1 像素对应的纹理坐标</span>\n      vec2 onePixel <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> u_textureSize<span class="token punctuation">;</span>\n\n      <span class="token comment">// 对左中右像素求均值</span>\n      gl_FragColor <span class="token operator">=</span> <span class="token punctuation">(</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord<span class="token punctuation">)</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> <span class="token function">vec2</span><span class="token punctuation">(</span>onePixel<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span>onePixel<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们需要在 JavaScript 中传入纹理的大小。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5371708263447284000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\nvar textureSizeLocation = gl.getUniformLocation(program, \'u_textureSize\');\n\n// ...\n\n// 设置图像的大小\ngl.uniform2f(textureSizeLocation, image.width, image.height);\n\n// ...`, `5371708263447284000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token keyword">var</span> textureSizeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_textureSize\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 设置图像的大小</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>textureSizeLocation<span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以和上方没有模糊处理的图片对比一下。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/nrpkhw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>知道了怎么获取像素值，现在我们来做一些图片处理常用的卷积内核。在这个例子中我们将使用 3×3 的内核，卷积内核就是一个 3×3 的矩阵，矩阵中的每一项代表当前处理的像素和周围 8 个像素的乘法因子，相乘后将结果加起来除以内核权重（内核中所有值的和或 1.0，取二者中较大者），这有一个不错的<a href="https://docs.gimp.org/2.6/en/plug-in-convmatrix.html" target="_blank" rel="nofollow noreferrer noopener">相关文章</a>，这里是 C++ 实现的一些<a href="https://www.codeproject.com/KB/graphics/ImageConvolution.aspx" target="_blank" rel="nofollow noreferrer noopener">具体代码</a>。</p>\n<p>我们将在片断着色器中计算卷积，所以创建一个新的片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27730336616279572000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 纹理\n   uniform sampler2D u_image;\n   uniform vec2 u_textureSize;\n   uniform float u_kernel[9];\n   uniform float u_kernelWeight;\n\n   // 从顶点着色器传入的纹理坐标\n   varying vec2 v_texCoord;\n\n   void main() {\n      vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n      vec4 colorSum =\n         texture2D(u_image, v_texCoord + onePixel * vec2(-1, -1)) * u_kernel[0] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(0, -1)) * u_kernel[1] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(1, -1)) * u_kernel[2] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(-1, 0)) * u_kernel[3] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(0, 0)) * u_kernel[4] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(1, 0)) * u_kernel[5] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(-1, 1)) * u_kernel[6] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(0, 1)) * u_kernel[7] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(1, 1)) * u_kernel[8];\n\n      // 只把 rgb 值求和除以权重\n      // 将阿尔法值设为 1.0\n      gl_FragColor = vec4((colorSum / u_kernelWeight).rgb, 1.0);\n   }\n</script>`, `27730336616279572000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n   <span class="token comment">// 纹理</span>\n   uniform sampler2D u_image<span class="token punctuation">;</span>\n   uniform vec2 u_textureSize<span class="token punctuation">;</span>\n   uniform float u_kernel<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   uniform float u_kernelWeight<span class="token punctuation">;</span>\n\n   <span class="token comment">// 从顶点着色器传入的纹理坐标</span>\n   varying vec2 v_texCoord<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      vec2 onePixel <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> u_textureSize<span class="token punctuation">;</span>\n      vec4 colorSum <span class="token operator">=</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 只把 rgb 值求和除以权重</span>\n      <span class="token comment">// 将阿尔法值设为 1.0</span>\n      gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>colorSum <span class="token operator">/</span> u_kernelWeight<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 JavaScript 中我们需要提供卷积内核和它的权重</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14168395431638880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function computeKernelWeight(kernel) {\n  var weight = kernel.reduce(function(prev, curr) {\n    return prev + curr;\n  });\n  return weight <= 0 ? 1 : weight;\n}\n\n// ...\nvar kernelLocation = gl.getUniformLocation(program, \'u_kernel[0]\');\nvar kernelWeightLocation = gl.getUniformLocation(program, \'u_kernelWeight\');\n// ...\nvar edgeDetectKernel = [-1, -1, -1, -1, 8, -1, -1, -1, -1];\n\ngl.uniform1fv(kernelLocation, edgeDetectKernel);\ngl.uniform1f(kernelWeightLocation, computeKernelWeight(edgeDetectKernel));\n// ...`, `14168395431638880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">computeKernelWeight</span><span class="token punctuation">(</span><span class="token parameter">kernel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> weight <span class="token operator">=</span> kernel<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> curr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> prev <span class="token operator">+</span> curr<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> weight <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> weight<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">var</span> kernelLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_kernel[0]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> kernelWeightLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_kernelWeight\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">var</span> edgeDetectKernel <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1fv</span><span class="token punctuation">(</span>kernelLocation<span class="token punctuation">,</span> edgeDetectKernel<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>kernelWeightLocation<span class="token punctuation">,</span> <span class="token function">computeKernelWeight</span><span class="token punctuation">(</span>edgeDetectKernel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看！可以用下拉菜单选择不同的卷积内核。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/drq261?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="为什么-u_image-没有设置还能正常运行？"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-u_image-%E6%B2%A1%E6%9C%89%E8%AE%BE%E7%BD%AE%E8%BF%98%E8%83%BD%E6%AD%A3%E5%B8%B8%E8%BF%90%E8%A1%8C%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么 u_image 没有设置还能正常运行？</h2>\n<p>全局变量默认为 0 所以 <code class="language-text">u_image</code> 默认使用纹理单元 0。纹理单元 0 默认为当前活跃纹理，所以调用 bindTexture 会将纹理绑定到单元 0。</p>\n<p>WebGL 有一个纹理单元队列，每个 sampler 全局变量的值对应着一个纹理单元，它会从对应的单元寻找纹理数据，你可以将纹理设置到你想用的纹理单元。</p>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69404767769500040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var textureUnitIndex = 6; // 用单元 6\nvar u_imageLoc = gl.getUniformLocation(program, \'u_image\');\ngl.uniform1i(u_imageLoc, textureUnitIndex);`, `69404767769500040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> textureUnitIndex <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 用单元 6</span>\n<span class="token keyword">var</span> u_imageLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_image\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_imageLoc<span class="token punctuation">,</span> textureUnitIndex<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>为了将纹理设置在不同的单元你可以调用 gl.activeTexture。 例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62949550830028150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绑定纹理到单元 6\ngl.activeTexture(gl.TEXTURE6);\ngl.bindTexture(gl.TEXTURE_2D, someTexture);`, `62949550830028150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绑定纹理到单元 6</span>\ngl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> someTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这样也可以</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60439957363028740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var textureUnitIndex = 6; // 使用纹理单元 6\n// 绑定纹理到单元 6\ngl.activeTexture(gl.TEXTURE0 + textureUnitIndex);\ngl.bindTexture(gl.TEXTURE_2D, someTexture);`, `60439957363028740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> textureUnitIndex <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 使用纹理单元 6</span>\n<span class="token comment">// 绑定纹理到单元 6</span>\ngl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span> <span class="token operator">+</span> textureUnitIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> someTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所有支持 WebGL 的环境，在片断着色器中至少有 8 个纹理单元，顶点着色器中可以是 0 个。所以如果你使用超过 8 个纹理单元就应该调用 <code class="language-text">gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)</code> 查看单元个数，或者调用 <code class="language-text">gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)</code> 查看顶点着色器中可以用几个纹理单元。超过 99% 的机器在顶点着色器中至少有 4 个纹理单元。</p>\n<h2 id="在-glsl-中为什么变量的前缀都是-a_-u_-或-v_？"><a href="#%E5%9C%A8-glsl-%E4%B8%AD%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%98%E9%87%8F%E7%9A%84%E5%89%8D%E7%BC%80%E9%83%BD%E6%98%AF-a_-u_-%E6%88%96-v_%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 GLSL 中为什么变量的前缀都是 <code class="language-text">a_</code>, <code class="language-text">u_</code> 或 <code class="language-text">v_</code>？</h2>\n<p>那只是一个命名约定，不是强制要求的。但是对我来说可以轻松通过名字知道值从哪里来，<code class="language-text">a_</code> 代表属性，值从缓冲中提供；<code class="language-text">u_</code> 代表全局变量，直接对着色器设置；<code class="language-text">v_</code> 代表可变量，是从顶点着色器的顶点中插值来出来的</p>\n<h1 id="webgl-进一步处理图像"><a href="#webgl-%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%A4%84%E7%90%86%E5%9B%BE%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 进一步处理图像</h1>\n<p>图像处理的下一个问题是如何同时施加多种效果？</p>\n<p>当然，你可以试着在运行时创建着色器，根据用户从交互界面选择的一些效果，创建一个可以全部实现的着色器。尽管有人用过<a href="https://www.youtube.com/watch?v=cQUn0Zeh-0Q" target="_blank" rel="nofollow noreferrer noopener">在运行时创建渲染效果</a>，但是大部分情况下是不适合的。</p>\n<p>一个更灵活的方式是使用 2 个或以上的纹理，然后交替渲染它们，像乒乓球一样每次渲染一种效果，传给另一个渲染下一个效果，如下所示。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69952264239689900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`原始图像    -> [模糊]     -> 纹理 1\n纹理 1      -> [锐化]     -> 纹理 2\n纹理 2      -> [边缘检测] -> 纹理 1\n纹理 1      -> [模糊]     -> 纹理 2\n纹理 2      -> [平滑]     -> 画布`, `69952264239689900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">原始图像    -&gt; [模糊]     -&gt; 纹理 1\n纹理 1      -&gt; [锐化]     -&gt; 纹理 2\n纹理 2      -&gt; [边缘检测] -&gt; 纹理 1\n纹理 1      -&gt; [模糊]     -&gt; 纹理 2\n纹理 2      -&gt; [平滑]     -&gt; 画布</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个操作需要使用帧缓冲来实现。在 WebGL 和 OpenGL 中，帧缓冲事实上是一个糟糕的名字。WebGL/OpenGL 中的帧缓冲只是一系列状态（一列附加物）不是任何形式的缓冲。但是当我们给帧缓冲绑定一个纹理后，可以将渲染结果写入那个纹理。</p>\n<p>首先让我们把以前创建纹理的代码写到一个方法里</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45210996832694180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function createAndSetupTexture(gl) {\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  // 设置材质，这样我们可以对任意大小的图像进行像素操作\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n  return texture;\n}\n\n// 创建一个纹理并写入图像\nvar originalImageTexture = createAndSetupTexture(gl);\ngl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);`, `45210996832694180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createAndSetupTexture</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置材质，这样我们可以对任意大小的图像进行像素操作</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> texture<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 创建一个纹理并写入图像</span>\n<span class="token keyword">var</span> originalImageTexture <span class="token operator">=</span> <span class="token function">createAndSetupTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在让我们用这个方法生成两个纹理并绑定到两个帧缓冲。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79696452113609650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建两个纹理绑定到帧缓冲\nvar textures = [];\nvar framebuffers = [];\nfor (var ii = 0; ii < 2; ++ii) {\n  var texture = createAndSetupTexture(gl);\n  textures.push(texture);\n\n  // 设置纹理大小和图像大小一致\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, image.width, image.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n  // 创建一个帧缓冲\n  var fbo = gl.createFramebuffer();\n  framebuffers.push(fbo);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n\n  // 绑定纹理到帧缓冲\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n}`, `79696452113609650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建两个纹理绑定到帧缓冲</span>\n<span class="token keyword">var</span> textures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> framebuffers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> texture <span class="token operator">=</span> <span class="token function">createAndSetupTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  textures<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置纹理大小和图像大小一致</span>\n  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 创建一个帧缓冲</span>\n  <span class="token keyword">var</span> fbo <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createFramebuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  framebuffers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 绑定纹理到帧缓冲</span>\n  gl<span class="token punctuation">.</span><span class="token function">framebufferTexture2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COLOR_ATTACHMENT0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在让我们做一些卷积核并按使用顺序存入列表中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16041513474023184000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 定义一些卷积核\nvar kernels = {\n  normal: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n  gaussianBlur: [0.045, 0.122, 0.045, 0.122, 0.332, 0.122, 0.045, 0.122, 0.045],\n  unsharpen: [-1, -1, -1, -1, 9, -1, -1, -1, -1],\n  emboss: [-2, -1, 0, -1, 1, 1, 0, 1, 2]\n};\n\n// 将要使用的效果列表\nvar effectsToApply = [\'gaussianBlur\', \'emboss\', \'gaussianBlur\', \'unsharpen\'];`, `16041513474023184000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 定义一些卷积核</span>\n<span class="token keyword">var</span> kernels <span class="token operator">=</span> <span class="token punctuation">{</span>\n  normal<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  gaussianBlur<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.045</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.045</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.332</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.045</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.045</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  unsharpen<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  emboss<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 将要使用的效果列表</span>\n<span class="token keyword">var</span> effectsToApply <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'gaussianBlur\'</span><span class="token punctuation">,</span> <span class="token string">\'emboss\'</span><span class="token punctuation">,</span> <span class="token string">\'gaussianBlur\'</span><span class="token punctuation">,</span> <span class="token string">\'unsharpen\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后让我们使用所有渲染效果，像乒乓一样来回渲染</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26150738254880367000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 从原始图像开始\ngl.bindTexture(gl.TEXTURE_2D, originalImageTexture);\n\n// 在渲染效果时不翻转 y 轴\ngl.uniform1f(flipYLocation, 1);\n\n// 循环施加每一种渲染效果\nfor (var ii = 0; ii < effectsToApply.length; ++ii) {\n  // 使用两个帧缓冲中的一个\n  setFramebuffer(framebuffers[ii % 2], image.width, image.height);\n\n  drawWithKernel(effectsToApply[ii]);\n\n  // 下次绘制时使用刚才的渲染结果\n  gl.bindTexture(gl.TEXTURE_2D, textures[ii % 2]);\n}\n\n// 最后将结果绘制到画布\ngl.uniform1f(flipYLocation, -1); // 需要绕 y 轴翻转\nsetFramebuffer(null, canvas.width, canvas.height);\ndrawWithKernel(\'normal\');\n\nfunction setFramebuffer(fbo, width, height) {\n  // 设定当前使用帧缓冲\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n\n  // 告诉着色器分辨率是多少\n  gl.uniform2f(resolutionLocation, width, height);\n\n  // 告诉 WebGL 帧缓冲需要的视图大小\n  gl.viewport(0, 0, width, height);\n}\n\nfunction drawWithKernel(name) {\n  // 设置卷积核\n  gl.uniform1fv(kernelLocation, kernels[name]);\n\n  // 画出矩形\n  gl.drawArrays(gl.TRIANGLES, 0, 6);\n}`, `26150738254880367000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 从原始图像开始</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> originalImageTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在渲染效果时不翻转 y 轴</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 循环施加每一种渲染效果</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> effectsToApply<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 使用两个帧缓冲中的一个</span>\n  <span class="token function">setFramebuffer</span><span class="token punctuation">(</span>framebuffers<span class="token punctuation">[</span>ii <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token function">drawWithKernel</span><span class="token punctuation">(</span>effectsToApply<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 下次绘制时使用刚才的渲染结果</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> textures<span class="token punctuation">[</span>ii <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 最后将结果绘制到画布</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 需要绕 y 轴翻转</span>\n<span class="token function">setFramebuffer</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">drawWithKernel</span><span class="token punctuation">(</span><span class="token string">\'normal\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">setFramebuffer</span><span class="token punctuation">(</span><span class="token parameter">fbo<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 设定当前使用帧缓冲</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 告诉着色器分辨率是多少</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionLocation<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 告诉 WebGL 帧缓冲需要的视图大小</span>\n  gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">drawWithKernel</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 设置卷积核</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniform1fv</span><span class="token punctuation">(</span>kernelLocation<span class="token punctuation">,</span> kernels<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 画出矩形</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面是一个可交互示例，用了稍微灵活一点的用户交互。勾选表示开启对应效果，拖拽改变渲染顺序。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/1f3ywc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>有些东西需要回顾一下。</p>\n<p>调用 gl.bindFramebuffer 设置为 null 是告诉 WebGL 你想在画布上绘制，而不是在帧缓冲上。</p>\n<p>WebGL 需要从裁剪空间对应到屏幕像素，设置 gl.viewport 就是为了实现这个。因为我们的帧缓冲的大小和画布的大小不同，所以我们需要给帧缓冲设置一个合适的视图大小让它渲染到对应的纹理上，最后再渲染到画布上。</p>\n<p>原例中，我们在渲染时绕 y 轴翻转是因为 WebGL 的 0, 0 点在左下角而不是常见二维屏幕坐标的左上角。而在帧缓冲中绘制的时候不需要翻转，因为帧缓冲不用显示，谁上谁下无所谓，最重要的是我们计算中的 0, 0 也对应帧缓冲中的 0, 0 像素。为了解决这个问题，通过在着色器中添加一个输入来决定是否翻转。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36688474027112993000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   // ...\n   uniform float u_flipY;\n   // ...\n\n   void main() {\n      // ...\n\n      gl_Position = vec4(clipSpace * vec2(1, u_flipY), 0, 1);\n\n      // ...\n   }\n</script>`, `36688474027112993000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   <span class="token comment">// ...</span>\n   uniform float u_flipY<span class="token punctuation">;</span>\n   <span class="token comment">// ...</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...</span>\n\n      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> u_flipY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// ...</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在渲染的时候可以这样设置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76646680828235830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\nvar flipYLocation = gl.getUniformLocation(program, \'u_flipY\');\n\n// ...\n\n// 不翻转\ngl.uniform1f(flipYLocation, 1);\n\n// ...\n\n// 翻转\ngl.uniform1f(flipYLocation, -1);`, `76646680828235830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token keyword">var</span> flipYLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_flipY\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 不翻转</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 翻转</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为了让这个例子简单化，我只用了一个 GLSL 实现了多种渲染效果。如果专做图像处理可能需要多个 GLSL 程序，一个调节色彩、饱和度和明度，一个调节亮度和对比度，一个做反色，一个做色彩平衡，等等。你需要用代码更换 GLSL 程序，并更新程序对应的参数。我想过写一个类似的例子，但最好留给读者自己实现，因为多个 GLSL 程序和参数需要良好的重构，不然代码会一团糟，所以它是一个很好的练习机会。</p>\n<p>希望这个和之前的例子让你更了解 WebGL，从二维开始讲解是希望你更有利于对 WebGL 的理解。如果有时间我会试着写一些关于如何实现三维效果的文章，讲一些一些关于 WebGL 的底层原理和细节。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——图像处理/index.md absPath of file >>> MarkdownRemark",timeToRead:8,frontmatter:{date:"2022-04-29 11:05:21",path:"/webgl-fundamental-image-processing/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——图像处理",draft:null}},{excerpt:"基础概念 背景 WebGL 经常被当成 3D API，人们总想“我可以使用 WebGL 和一些神奇的东西做出炫酷的 3D 作品”。事实上 WebGL 仅仅是一个光栅化引擎，它可以根据你的代码绘制出点，线和三角形。想要利用 WebGL 完成更复杂任务，取决于你能否提供合适的代码，组合使用点，线和三角形代替实现。 WebGL 在电脑的 GPU 中运行。因此你需要使用能够在 GPU 上运行的代码。这样的代码需要提供成对的方法。每对方法中一个叫顶点着色器，另一个叫片断着色器，并且使用一种和 C 或 C…",html:'<h1 id="基础概念"><a href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基础概念</h1>\n<h2 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h2>\n<p>WebGL 经常被当成 3D API，人们总想“我可以使用 WebGL 和一些神奇的东西做出炫酷的 3D 作品”。事实上 WebGL 仅仅是一个光栅化引擎，它可以根据你的代码绘制出点，线和三角形。想要利用 WebGL 完成更复杂任务，取决于你能否提供合适的代码，组合使用点，线和三角形代替实现。</p>\n<p>WebGL 在电脑的 GPU 中运行。因此你需要使用能够在 GPU 上运行的代码。这样的代码需要提供成对的方法。每对方法中一个叫顶点着色器，另一个叫片断着色器，并且使用一种和 C 或 C++ 类似的强类型的语言 GLSL（GL 着色语言），每一对组合起来称作一个 program（着色程序）。</p>\n<p>顶点着色器的作用是计算顶点的位置。根据计算出的一系列顶点位置，WebGL 可以对点，线和三角形在内的一些图元进行光栅化处理。当对这些图元进行光栅化处理时需要使用片断着色器方法。片断着色器的作用是计算出当前绘制图元中每个像素的颜色值。</p>\n<p>几乎整个 WebGL API 都是关于如何设置这些成对方法的状态值以及运行它们。对于想要绘制的每一个对象，都需要先设置一系列状态值，然后通过调用 gl.drawArrays 或 gl.drawElements 运行一个着色方法对，使得你的着色器对能够在 GPU 上运行。</p>\n<p>这些方法对所需的任何数据都需要发送到 GPU，这里有着色器获取数据的 4 种方法。</p>\n<h3 id="属性（attributes）和缓冲"><a href="#%E5%B1%9E%E6%80%A7%EF%BC%88attributes%EF%BC%89%E5%92%8C%E7%BC%93%E5%86%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>属性（Attributes）和缓冲</h3>\n<p>缓冲是发送到 GPU 的一些二进制数据序列，通常情况下缓冲数据包括位置，法向量，纹理坐标，顶点颜色值等。你可以存储任何数据。</p>\n<p>属性用来指明怎么从缓冲中获取所需数据并将它提供给顶点着色器。例如你可能在缓冲中用三个 32 位的浮点型数据存储一个位置值。对于一个确切的属性你需要告诉它从哪个缓冲中获取数据，获取什么类型的数据（三个 32 位的浮点数据），起始偏移值是多少，到下一个位置的字节数是多少。</p>\n<p>缓冲不是随意读取的。事实上顶点着色器运行的次数是一个指定的确切数字，每一次运行属性会从指定的缓冲中按照指定规则依次获取下一个值。</p>\n<h3 id="全局变量（uniforms）"><a href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%EF%BC%88uniforms%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>全局变量（Uniforms）</h3>\n<p>全局变量在着色程序运行前赋值，在运行过程中全局有效。</p>\n<h3 id="纹理（textures）"><a href="#%E7%BA%B9%E7%90%86%EF%BC%88textures%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>纹理（Textures）</h3>\n<p>纹理是一个数据序列，可以在着色程序运行中随意读取其中的数据。大多数情况存放的是图像数据，但是纹理仅仅是数据序列，你也可以随意存放除了颜色数据以外的其它数据。</p>\n<h3 id="可变量（varyings）"><a href="#%E5%8F%AF%E5%8F%98%E9%87%8F%EF%BC%88varyings%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可变量（Varyings）</h3>\n<p>可变量是一种顶点着色器给片断着色器传值的方式，依照渲染的图元是点，线还是三角形，顶点着色器中设置的可变量会在片断着色器运行中获取不同的插值。</p>\n<h2 id="hello-world"><a href="#hello-world" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hello World</h2>\n<p>WebGL 只关心两件事：裁剪空间中的坐标值和颜色值。使用 WebGL 只需要给它提供这两个东西。你需要提供两个着色器来做这两件事，一个顶点着色器提供裁剪空间坐标值，一个片断着色器提供颜色值。</p>\n<p>无论你的画布有多大，裁剪空间的坐标范围永远是 -1 到 1。这里有一个简单的 WebGL 例子展示 WebGL 的简单用法。</p>\n<p>让我们从顶点着色器开始</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64901128934017335000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 一个属性值，将会从缓冲中获取数据\nattribute vec4 a_position;\n\n// 所有着色器都有一个 main 方法\nvoid main() {\n\n  // gl_Position 是一个顶点着色器主要设置的变量\n  gl_Position = a_position;\n}`, `64901128934017335000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 一个属性值，将会从缓冲中获取数据</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n\n<span class="token comment">// 所有着色器都有一个 main 方法</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n  <span class="token comment">// gl_Position 是一个顶点着色器主要设置的变量</span>\n  gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果用 JavaScript 代替 GLSL，当它运行的时候，你可以想象它做了类似以下的事情</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2719784283441084400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 伪代码\nvar positionBuffer = [0, 0, 0, 0, 0, 0.5, 0, 0, 0.7, 0, 0, 0];\nvar attributes = {};\nvar gl_Position;\n\nfunction drawArrays(_, offset, count) {\n  var stride = 4;\n  var size = 4;\n  for (var i = 0; i < count; ++i) {\n    // 从 positionBuffer 复制接下来 4 个值给 a_position 属性\n    const start = offset + i * stride;\n    attributes.a_position = positionBuffer.slice(start, start + size);\n    runVertexShader(); // 运行顶点着色器\n    // ...\n    doSomethingWith_gl_Position();\n  }\n}`, `2719784283441084400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 伪代码</span>\n<span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> attributes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> gl_Position<span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">drawArrays</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 从 positionBuffer 复制接下来 4 个值给 a_position 属性</span>\n    <span class="token keyword">const</span> start <span class="token operator">=</span> offset <span class="token operator">+</span> i <span class="token operator">*</span> stride<span class="token punctuation">;</span>\n    attributes<span class="token punctuation">.</span>a_position <span class="token operator">=</span> positionBuffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> start <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">runVertexShader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 运行顶点着色器</span>\n    <span class="token comment">// ...</span>\n    <span class="token function">doSomethingWith_gl_Position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际情况没有那么简单，因为 positionBuffer 将会被转换成二进制数据（见下文），所以真实情况下从缓冲中读取数据有些麻烦，但是希望这个例子能够让你想象出顶点着色器是怎么执行的。</p>\n<p>接下来我们需要一个片断着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35874332281988264000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 片断着色器没有默认精度，所以我们需要设置一个精度\n// mediump 是一个不错的默认值，代表 medium precision（中等精度）\nprecision mediump float;\n\nvoid main() {\n  // gl_FragColor 是一个片断着色器主要设置的变量\n  gl_FragColor = vec4(1, 0, 0.5, 1); // 返回“红紫色”\n}`, `35874332281988264000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 片断着色器没有默认精度，所以我们需要设置一个精度</span>\n<span class="token comment">// mediump 是一个不错的默认值，代表 medium precision（中等精度）</span>\n<span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// gl_FragColor 是一个片断着色器主要设置的变量</span>\n  gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回“红紫色”</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上方我们设置 gl_FragColor 为 <code class="language-text">1, 0, 0.5, 1</code>，其中 1 代表红色值，0 代表绿色值，0.5 代表蓝色值，最后一个 1 表示阿尔法通道值。WebGL 中的颜色值范围从 0 到 1 。</p>\n<p>现在我们有了两个着色器方法，让我们开始使用 WebGL 吧</p>\n<p>首先我们需要一个 HTML 中的 canvas（画布）对象</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4622646657023944000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<canvas id=&quot;c&quot;></canvas>`, `4622646657023944000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后可以用 JavaScript 获取它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51820804764350540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var canvas = document.querySelector(\'#c\');`, `51820804764350540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们创建一个 WebGL 渲染上下文（WebGLRenderingContext）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12410477985301770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var gl = canvas.getContext(\'webgl\');\nif (!gl) {\n  // 你不能使用 WebGL！\n  // ...\n}`, `12410477985301770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 你不能使用 WebGL！</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们需要编译着色器对然后提交到 GPU，先让我们通过字符串获取它们。 你可以利用 JavaScript 中创建字符串的方式创建 GLSL 字符串：用串联的方式（concatenating），用 AJAX 下载，用多行模板数据。或者在这个例子里，将它们放在非 JavaScript 类型的标签中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3156475578879036400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;notjs&quot;>\n\n  // 一个属性变量，将会从缓冲中获取数据\n  attribute vec4 a_position;\n\n  // 所有着色器都有一个 main 方法\n  void main() {\n\n    // gl_Position 是一个顶点着色器主要设置的变量\n    gl_Position = a_position;\n  }\n</script>\n\n<script id=&quot;fragment-shader-2d&quot; type=&quot;notjs&quot;>\n\n  // 片断着色器没有默认精度，所以我们需要设置一个精度\n  // mediump 是一个不错的默认值，代表 medium precision（中等精度）\n  precision mediump float;\n\n  void main() {\n    // gl_FragColor 是一个片断着色器主要设置的变量\n    gl_FragColor = vec4(1, 0, 0.5, 1); // 返回“红紫色”\n  }\n</script>`, `3156475578879036400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n  <span class="token comment">// 一个属性变量，将会从缓冲中获取数据</span>\n  attribute vec4 a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 所有着色器都有一个 main 方法</span>\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n    <span class="token comment">// gl_Position 是一个顶点着色器主要设置的变量</span>\n    gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n  <span class="token comment">// 片断着色器没有默认精度，所以我们需要设置一个精度</span>\n  <span class="token comment">// mediump 是一个不错的默认值，代表 medium precision（中等精度）</span>\n  precision mediump float<span class="token punctuation">;</span>\n\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// gl_FragColor 是一个片断着色器主要设置的变量</span>\n    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回“红紫色”</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>事实上，大多数三维引擎在运行时利用模板，串联等方式创建 GLSL。对于这个网站上的例子来说，没有复杂到要在运行时创建 GLSL 的程度。</p>\n<p>接下来我们使用的方法将会创建一个着色器，只需要上传 GLSL 数据，然后编译成着色器。你可能注意到这段代码没有任何注释，因为可以从方法名很清楚的了解方法的作用（这里作为翻译版本我还是稍微注释一下）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58908322877713640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建着色器方法，输入参数：渲染上下文，着色器类型，数据源\nfunction createShader(gl, type, source) {\n  var shader = gl.createShader(type); // 创建着色器对象\n  gl.shaderSource(shader, source); // 提供数据源\n  gl.compileShader(shader); // 编译 -> 生成着色器\n  var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (success) {\n    return shader;\n  }\n\n  console.log(gl.getShaderInfoLog(shader));\n  gl.deleteShader(shader);\n}`, `58908322877713640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建着色器方法，输入参数：渲染上下文，着色器类型，数据源</span>\n<span class="token keyword">function</span> <span class="token function">createShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建着色器对象</span>\n  gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提供数据源</span>\n  gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 编译 -> 生成着色器</span>\n  <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getShaderParameter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COMPILE_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> shader<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getShaderInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们可以使用以上方法创建两个着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95550353289687350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var vertexShaderSource = document.querySelector(\'#vertex-shader-2d\').text;\nvar fragmentShaderSource = document.querySelector(\'#fragment-shader-2d\').text;\n\nvar vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);\nvar fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);`, `95550353289687350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> vertexShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#vertex-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n<span class="token keyword">var</span> fragmentShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#fragment-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> vertexShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vertexShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> fragmentShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fragmentShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后我们将这两个着色器 link（链接）到一个 program（着色程序）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72410789423342130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function createProgram(gl, vertexShader, fragmentShader) {\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader); // 添加顶点着色器\n  gl.attachShader(program, fragmentShader); // 添加片元着色器\n  gl.linkProgram(program); // 连接 program 中的着色器\n  var success = gl.getProgramParameter(program, gl.LINK_STATUS);\n  if (success) {\n    return program;\n  }\n\n  console.log(gl.getProgramInfoLog(program));\n  gl.deleteProgram(program);\n}`, `72410789423342130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加顶点着色器</span>\n  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加片元着色器</span>\n  gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 连接 program 中的着色器</span>\n  <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getProgramParameter</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINK_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> program<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getProgramInfoLog</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">deleteProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后调用它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24057596637391020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var program = createProgram(gl, vertexShader, fragmentShader);`, `24057596637391020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们已经在 GPU 上创建了一个 GLSL 着色程序，我们还需要给它提供数据。WebGL 的主要任务就是设置好状态并为 GLSL 着色程序提供数据。在这个例子中 GLSL 着色程序的唯一输入是一个属性值 a_position。我们要做的第一件事就是从刚才创建的 GLSL 着色程序中找到这个属性值所在的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14393262689366315000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positionAttributeLocation = gl.getAttribLocation(program, \'a_position\');`, `14393262689366315000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>寻找属性值位置（和全局属性位置）应该在初始化的时候完成，而不是在渲染循环中。</p>\n<p>属性值从缓冲中获取数据，所以我们创建一个缓冲</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90434134046576210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positionBuffer = gl.createBuffer();`, `90434134046576210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>WebGL 可以通过绑定点操控全局范围内的许多数据，你可以把绑定点想象成一个 WebGL 内部的全局变量。首先绑定一个数据源到绑定点，然后可以引用绑定点指向该数据源。所以让我们来绑定位置信息缓冲（下面的绑定点就是 ARRAY_BUFFER）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76002311567834700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);`, `76002311567834700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们需要通过绑定点向缓冲中存放数据</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2434340633007825400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 三个二维点坐标\nvar positions = [0, 0, 0, 0.5, 0.7, 0];\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);`, `2434340633007825400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 三个二维点坐标</span>\n<span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这里完成了一系列事情，第一件事是我们有了一个 JavaScript 序列 positions。然而 WebGL 需要强类型数据，所以 <code class="language-text">new Float32Array(positions)</code> 创建了 32 位浮点型数据序列，并从 positions 中复制数据到序列中，然后 gl.bufferData 复制这些数据到 GPU 的 positionBuffer 对象上。它最终传递到 positionBuffer 上是因为在前一步中我们我们将它绑定到了 ARRAY_BUFFER（也就是绑定点）上。</p>\n<p>最后一个参数 <code class="language-text">gl.STATIC_DRAW</code> 是提示 WebGL 我们将怎么使用这些数据。WebGL 会根据提示做出一些优化。<code class="language-text">gl.STATIC_DRAW</code> 提示 WebGL 我们不会经常改变这些数据。</p>\n<p>在此之上的代码是初始化代码。这些代码在页面加载时只会运行一次。接下来的代码是渲染代码，而这些代码将在我们每次要渲染或者绘制时执行。</p>\n<h2 id="渲染"><a href="#%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染</h2>\n<p>在绘制之前我们应该调整画布（canvas）的尺寸以匹配它的显示尺寸。画布就像图片一样有两个尺寸。一个是它拥有的实际像素个数，另一个是它显示的大小。CSS 决定画布显示的大小。你应该尽可能用 CSS 设置所需画布大小，因为它比其它方式灵活的多。</p>\n<p>这里的例子中，有独立窗口显示的示例大多使用 400x300 像素大小的画布。但是如果像稍后展示的示例那样嵌在页面中，它就会被拉伸以填满可用空间。通过使用 CSS 调整画布尺寸可以轻松处理这些情况。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74283545930964030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`webglUtils.resizeCanvasToDisplaySize(gl.canvas);`, `74283545930964030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们需要告诉 WebGL 怎样把提供的 gl_Position 裁剪空间坐标对应到画布像素坐标，通常我们也把画布像素坐标叫做屏幕空间。为了实现这个目的，我们只需要调用 gl.viewport 方法并传递画布的当前尺寸。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44254032258682495000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);`, `44254032258682495000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这样就告诉 WebGL 裁剪空间的 -1 -> +1 分别对应到 x 轴的 0 -> gl.canvas.width 和 y 轴的 0 -> gl.canvas.height。</p>\n<p>我们用 <code class="language-text">0, 0, 0, 0</code> 清空画布，分别对应 r, g, b, alpha（红，绿，蓝，阿尔法）值，所以在这个例子中我们让画布变透明了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66065608264917610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 清空画布\ngl.clearColor(0, 0, 0, 0);\ngl.clear(gl.COLOR_BUFFER_BIT);`, `66065608264917610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 清空画布</span>\ngl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>我们需要告诉 WebGL 运行哪个着色程序</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82376844632099370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 告诉它用我们之前写好的着色程序（一个着色器对）\ngl.useProgram(program);`, `82376844632099370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 告诉它用我们之前写好的着色程序（一个着色器对）</span>\ngl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>接下来我们需要告诉 WebGL 怎么从我们之前准备的缓冲中获取数据给着色器中的属性。首先我们需要启用对应属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93230637416992060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enableVertexAttribArray(positionAttributeLocation);`, `93230637416992060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后指定从缓冲中读取数据的方式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7161187038876960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 将绑定点绑定到缓冲数据（positionBuffer）\ngl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n\n// 告诉属性怎么从 positionBuffer 中读取数据 (ARRAY_BUFFER)\nvar size = 2; // 每次迭代运行提取两个单位数据\nvar type = gl.FLOAT; // 每个单位的数据类型是 32 位浮点型\nvar normalize = false; // 不需要归一化数据\nvar stride = 0; // 0 = 移动单位数量 * 每个单位占用内存（sizeof(type)）\n// 每次迭代运行运动多少内存到下一个数据开始点\nvar offset = 0; // 从缓冲起始位置开始读取\ngl.vertexAttribPointer(positionAttributeLocation, size, type, normalize, stride, offset);`, `7161187038876960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 将绑定点绑定到缓冲数据（positionBuffer）</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉属性怎么从 positionBuffer 中读取数据 (ARRAY_BUFFER)</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代运行提取两个单位数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 每个单位的数据类型是 32 位浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不需要归一化数据</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动单位数量 * 每个单位占用内存（sizeof(type)）</span>\n<span class="token comment">// 每次迭代运行运动多少内存到下一个数据开始点</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从缓冲起始位置开始读取</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一个隐藏信息是 <code class="language-text">gl.vertexAttribPointer</code> 是将属性绑定到当前的 <code class="language-text">ARRAY_BUFFER</code>。换句话说就是属性绑定到了 positionBuffer 上。这也意味着现在利用绑定点随意将 <code class="language-text">ARRAY_BUFFER</code> 绑定到其它数据上后，该属性依然从 positionBuffer 上读取数据。</p>\n<p>从 GLSL 的顶点着色器中注意到 a_position 属性的数据类型是 vec4</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14939640306118273000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;`, `14939640306118273000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">attribute vec4 a_position;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>vec4 是一个有四个浮点数据的数据类型。在 JavaScript 中你可以把它想象成 <code class="language-text">a_position = {x: 0, y: 0, z: 0, w: 0}</code>。之前我们设置的 size = 2， 属性默认值是 <code class="language-text">0, 0, 0, 1</code>，然后属性将会从缓冲中获取前两个值（ x 和 y ）。z 和 w 还是默认值 0 和 1 。</p>\n<p>我们终于可以让 WebGL 运行我们的 GLSL 着色程序了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49435385794871840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 3;\ngl.drawArrays(primitiveType, offset, count);`, `49435385794871840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为 count = 3，所以顶点着色器将运行三次。第一次运行将会从位置缓冲中读取前两个值赋给属性值 <code class="language-text">a_position.x</code> 和 <code class="language-text">a_position.y</code>。第二次运行 <code class="language-text">a_position.x</code> 和 <code class="language-text">a_position.y</code> 将会被赋予后两个值，最后一次运行将被赋予最后两个值。</p>\n<p>因为我们设置 primitiveType（图元类型）为 <code class="language-text">gl.TRIANGLES</code>（三角形），顶点着色器每运行三次 WebGL 将会根据三个 gl_Position 值绘制一个三角形，不论我们的画布大小是多少，在裁剪空间中每个方向的坐标范围都是 -1 到 1。</p>\n<p>由于我们的顶点着色器仅仅是传递位置缓冲中的值给 gl_Position，所以三角形在裁剪空间中的坐标如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20870770471820910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`0, 0,\n0, 0.5,\n0.7, 0,`, `20870770471820910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">0, 0,\n0, 0.5,\n0.7, 0,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>WebGL 将会把它们从裁剪空间转换到屏幕空间并在屏幕空间绘制一个三角形，如果画布大小是 400×300 我们会得到类似以下的转换</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38632749856182550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(` 裁剪空间            屏幕空间\n   0, 0       ->   200, 150\n   0, 0.5     ->   200, 225\n 0.7, 0       ->   340, 150`, `38632749856182550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text"> 裁剪空间            屏幕空间\n   0, 0       -&gt;   200, 150\n   0, 0.5     -&gt;   200, 225\n 0.7, 0       -&gt;   340, 150</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在 WebGL 将渲染出这个三角形。绘制每个像素时 WebGL 都将调用我们的片断着色器。我们的片断着色器只是简单设置 gl_FragColor 为 <code class="language-text">1, 0, 0.5, 1</code>， 由于画布的每个通道宽度为 8 位，这表示 WebGL 最终在画布上绘制<code class="language-text">[255, 0, 127, 255]</code>。</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-triangle.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// an attribute will receive data from a buffer</span>\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      <span class="token comment">// all shaders have a main function</span>\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n        <span class="token comment">// gl_Position is a special variable a vertex shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// fragment shaders don\'t have a default precision so we need</span>\n      <span class="token comment">// to pick one. mediump is a good default</span>\n      precision mediump float<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// gl_FragColor is a special variable a fragment shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return redish-purple</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">function</span> <span class="token function">createShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getShaderParameter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COMPILE_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> shader<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getShaderInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getProgramParameter</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINK_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> program<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getProgramInfoLog</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">deleteProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Get the strings for our GLSL shaders</span>\n        <span class="token keyword">var</span> vertexShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#vertex-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> fragmentShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#fragment-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n\n        <span class="token comment">// create GLSL shaders, upload the GLSL source, compile the shaders</span>\n        <span class="token keyword">var</span> vertexShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vertexShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> fragmentShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fragmentShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Link the two shaders into a program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer and put three 2d clip space points in it</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// code above this line is initialization code.</span>\n        <span class="token comment">// code below this line is rendering code.</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw</span>\n        <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>在上例中可以发现顶点着色器只是简单的传递了位置信息。由于位置数据坐标就是裁剪空间中的坐标，所以顶点着色器没有做什么特别的事。如果你想做三维渲染，你需要提供合适的着色器将三维坐标转换到裁剪空间坐标，因为 WebGL 只是一个光栅化 API。</p>\n<p>你可能会好奇为什么这个三角形从中间开始然后朝向右上方。裁剪空间的 x 坐标范围是 -1 到 +1. 这就意味着 0 在中间并且正值在它右边。</p>\n<p>至于它为什么在上方，是因为裁剪空间中 -1 是最底端 +1 是最顶端，这也意味值 0 在中间，正值在上方。</p>\n<p>对于描述二维空间中的物体，比起裁剪空间坐标你可能更希望使用屏幕像素坐标。所以我们来改造一下顶点着色器，让我们提供给它像素坐标而不是裁剪空间坐标。这是我们新的顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48001539004288320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;notjs&quot;>\n  // attribute vec4 a_position;\n  attribute vec2 a_position;\n\n  uniform vec2 u_resolution;\n\n  void main() {\n    // 从像素坐标转换到 0.0 到 1.0\n    vec2 zeroToOne = a_position / u_resolution;\n\n    // 再把 0->1 转换 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n\n    // 把 0->2 转换到 -1->+1 (裁剪空间)\n    vec2 clipSpace = zeroToTwo - 1.0;\n\n    gl_Position = vec4(clipSpace, 0, 1);\n  }\n</script>`, `48001539004288320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  <span class="token comment">// attribute vec4 a_position;</span>\n  attribute vec2 a_position<span class="token punctuation">;</span>\n\n  uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 从像素坐标转换到 0.0 到 1.0</span>\n    vec2 zeroToOne <span class="token operator">=</span> a_position <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n    <span class="token comment">// 再把 0->1 转换 0->2</span>\n    vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 把 0->2 转换到 -1->+1 (裁剪空间)</span>\n    vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里有些变化需要注意，我们将 a_position 改成 vec2 类型是因为我们只需要用 x 和 y 值。vec2 和 vec4 有些类似但是仅有 x 和 y 值。</p>\n<p>接着我们添加了一个 uniform（全局变量）叫做 u_resolution，为了设置它的值我们需要找到它的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99597932184418070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var resolutionUniformLocation = gl.getUniformLocation(program, \'u_resolution\');`, `99597932184418070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其余变化的应该能从注释中理解。通过设置 u_resolution 为画布的分辨率，着色器将会从 positionBuffer 中获取像素坐标将之转换为对应的裁剪空间坐标。</p>\n<p>现在我们可以将位置信息转换为像素坐标。这次我们将通过绘制两个三角形来绘制一个矩形，每个三角形有三个点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71970245912621670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positions = [10, 20, 80, 20, 10, 30, 10, 30, 80, 20, 80, 30];\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);`, `71970245912621670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>在我们设置好使用这个着色程序后，可以设置刚才创建的全局变量的值。gl.useProgram 就与之前讲到的 gl.bindBuffer 相似，设置当前使用的着色程序。之后所有类似 gl.uniformXXX 格式的方法都是设置当前着色程序的全局变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87617268350389570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.useProgram(program);\n\n// ...\n\n// 设置全局变量分辨率\ngl.uniform2f(resolutionUniformLocation, gl.canvas.width, gl.canvas.height);`, `87617268350389570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 设置全局变量分辨率</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>显然我们需要告诉 WebGL 要运行六次顶点着色器来画两个三角形。所以我们将 count 改成 6。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62696603360323500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制\nvar primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 6;\ngl.drawArrays(primitiveType, offset, count);`, `62696603360323500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制</span>\n<span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-two-triangle.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// convert the position from pixels to 0.0 to 1.0</span>\n         vec2 zeroToOne <span class="token operator">=</span> a_position<span class="token punctuation">.</span>xy <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->1 to 0->2</span>\n         vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->2 to -1->+1 (clipspace)</span>\n         vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n         gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// fragment shaders don\'t have a default precision so we need</span>\n      <span class="token comment">// to pick one. mediump is a good default</span>\n      precision mediump float<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// gl_FragColor is a special variable a fragment shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return redish-purple</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Use our boilerplate utils to compile the shaders and link into a program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> webglUtils<span class="token punctuation">.</span><span class="token function">createProgramFromScripts</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'vertex-shader-2d\'</span><span class="token punctuation">,</span> <span class="token string">\'fragment-shader-2d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up uniform locations</span>\n        <span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer to put three 2d clip space points in</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// set the resolution</span>\n        gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw</span>\n        <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>你可能注意到矩形在区域左下角，WebGL 认为左下角是 0，0。想要像传统二维 API 那样起点在左上角，我们只需翻转 y 轴即可。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60644264884852950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);`, `60644264884852950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在矩形在我们期望的位置了</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-two-triangle-revert.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// convert the position from pixels to 0.0 to 1.0</span>\n         vec2 zeroToOne <span class="token operator">=</span> a_position<span class="token punctuation">.</span>xy <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->1 to 0->2</span>\n         vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->2 to -1->+1 (clipspace)</span>\n         vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n         gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// fragment shaders don\'t have a default precision so we need</span>\n      <span class="token comment">// to pick one. mediump is a good default</span>\n      precision mediump float<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// gl_FragColor is a special variable a fragment shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return redish-purple</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Use our boilerplate utils to compile the shaders and link into a program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> webglUtils<span class="token punctuation">.</span><span class="token function">createProgramFromScripts</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'vertex-shader-2d\'</span><span class="token punctuation">,</span> <span class="token string">\'fragment-shader-2d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up uniform locations</span>\n        <span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer to put three 2d clip space points in</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// set the resolution</span>\n        gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw</span>\n        <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>让我们来定义一个可以生成矩形的方法，这样我们就可以调用它定义形状不一的多个矩形。同时我们需要矩形的颜色是可设置的。</p>\n<p>首先我们定义一个片断着色器，可以通过全局变量接收自定义颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81016350815520330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;notjs&quot;>\n  precision mediump float;\n\n  uniform vec4 u_color;\n\n  void main() {\n    gl_FragColor = u_color;\n  }\n</script>`, `81016350815520330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  precision mediump float<span class="token punctuation">;</span>\n\n  uniform vec4 u_color<span class="token punctuation">;</span>\n\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里是一段新代码，可以随机绘制 50 个随机位置，随机大小，随机颜色的矩形。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52713742073279130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var colorUniformLocation = gl.getUniformLocation(program, \'u_color\');\n{\n  // ...\n  // 绘制 50 个随机颜色矩形\n  for (var ii = 0; ii < 50; ++ii) {\n    // 创建一个随机矩形并将写入位置缓冲\n    // 因为位置缓冲是我们绑定在 ARRAY_BUFFER 绑定点上的最后一个缓冲\n    setRectangle(gl, randomInt(300), randomInt(300), randomInt(300), randomInt(300));\n\n    // 设置一个随机颜色\n    gl.uniform4f(colorUniformLocation, Math.random(), Math.random(), Math.random(), 1);\n\n    // 绘制矩形\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}\n\n// 返回 0 到 range 范围内的随机整数\nfunction randomInt(range) {\n  return Math.floor(Math.random() * range);\n}\n\n// 用参数生成矩形顶点并写进缓冲\nfunction setRectangle(gl, x, y, width, height) {\n  var x1 = x;\n  var x2 = x + width;\n  var y1 = y;\n  var y2 = y + height;\n\n  // 注意: gl.bufferData(gl.ARRAY_BUFFER, ...) 将会影响到当前绑定点 ARRAY_BUFFER 的绑定缓冲\n  // 目前我们只有一个缓冲，如果我们有多个缓冲，我们需要先将所需缓冲绑定到 ARRAY_BUFFER\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), gl.STATIC_DRAW);\n}`, `52713742073279130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> colorUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 绘制 50 个随机颜色矩形</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 创建一个随机矩形并将写入位置缓冲</span>\n    <span class="token comment">// 因为位置缓冲是我们绑定在 ARRAY_BUFFER 绑定点上的最后一个缓冲</span>\n    <span class="token function">setRectangle</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 设置一个随机颜色</span>\n    gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>colorUniformLocation<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 绘制矩形</span>\n    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 返回 0 到 range 范围内的随机整数</span>\n<span class="token keyword">function</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token parameter">range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 用参数生成矩形顶点并写进缓冲</span>\n<span class="token keyword">function</span> <span class="token function">setRectangle</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> x1 <span class="token operator">=</span> x<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> x2 <span class="token operator">=</span> x <span class="token operator">+</span> width<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y1 <span class="token operator">=</span> y<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y2 <span class="token operator">=</span> y <span class="token operator">+</span> height<span class="token punctuation">;</span>\n\n  <span class="token comment">// 注意: gl.bufferData(gl.ARRAY_BUFFER, ...) 将会影响到当前绑定点 ARRAY_BUFFER 的绑定缓冲</span>\n  <span class="token comment">// 目前我们只有一个缓冲，如果我们有多个缓冲，我们需要先将所需缓冲绑定到 ARRAY_BUFFER</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里是 50 个矩形。</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-many-triangle.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// convert the position from pixels to 0.0 to 1.0</span>\n         vec2 zeroToOne <span class="token operator">=</span> a_position<span class="token punctuation">.</span>xy <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->1 to 0->2</span>\n         vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->2 to -1->+1 (clipspace)</span>\n         vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n         gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      precision mediump float<span class="token punctuation">;</span>\n\n      uniform vec4 u_color<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token comment">/** @type {HTMLCanvasElement} */</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// setup GLSL program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> webglUtils<span class="token punctuation">.</span><span class="token function">createProgramFromScripts</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'vertex-shader-2d\'</span><span class="token punctuation">,</span> <span class="token string">\'fragment-shader-2d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up uniform locations</span>\n        <span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> colorUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer to put three 2d clip space points in</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// set the resolution</span>\n        gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw 50 random rectangles in random colors</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// Setup a random rectangle</span>\n          <span class="token comment">// This will write to positionBuffer because</span>\n          <span class="token comment">// its the last thing we bound on the ARRAY_BUFFER</span>\n          <span class="token comment">// bind point</span>\n          <span class="token function">setRectangle</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token comment">// Set a random color.</span>\n          gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>colorUniformLocation<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token comment">// Draw the rectangle.</span>\n          <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n          <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n          <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\n          gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// Returns a random integer from 0 to range - 1.</span>\n      <span class="token keyword">function</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token parameter">range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// Fill the buffer with the values that define a rectangle.</span>\n      <span class="token keyword">function</span> <span class="token function">setRectangle</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> x1 <span class="token operator">=</span> x<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> x2 <span class="token operator">=</span> x <span class="token operator">+</span> width<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> y1 <span class="token operator">=</span> y<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> y2 <span class="token operator">=</span> y <span class="token operator">+</span> height<span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n          gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n          <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>WebGL 其实是一个非常简单的 API。好吧，“简单”可能是一个不恰当的描述。它做的是一件简单的事，它仅仅运行用户提供的两个方法，一个顶点着色器和一个片断着色器，去绘制点，线和三角形。虽然做三维可以变得很复杂，但是这种复杂只是作为程序员的你，是一种复杂形式的“着色器”。WebGL API 只做光栅化处理并且在概念上十分容易理解。</p>\n<p>我们简单的示例向你展示了怎么给属性和两个全局变量提供数据。它和多个属性以及多个全局变量的原理一致。在这篇文章的开始部分，我们还提到了 varyings（可变量）和 textures（纹理），这些将会在随后的课程中出现。</p>\n<p>上例中用 setRectangle 更新缓冲数据的方式在大多数程序中并不常见。我这么用只是因为在这个例子中，为了解释 GLSL 接收像素坐标并通过少量数学运算得到期望结果，这可能是最简单的方式，不是常规做法。</p>\n<h1 id="工作原理"><a href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工作原理</h1>\n<p>在继续学习之前，我们需要探讨一下 WebGL 在 GPU 上究竟做了什么。WebGL 在 GPU 上的工作基本上分为两部分，第一部分是将顶点（或数据流）转换到裁剪空间坐标，第二部分是基于第一部分的结果绘制像素点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71815800324096710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 9;\ngl.drawArrays(primitiveType, offset, count);`, `71815800324096710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里的 9 表示“处理 9 个顶点”，所以将会有 9 个顶点被转换。</p>\n<p><img src="/static/vertex-shader-anim-33263e801ba33d7a89d6af77129031ac.gif"></p>\n<p>左侧是你提供的数据。顶点着色器（Vertex Shader）是你写进 GLSL 中的一个方法，每个顶点调用一次，在这个方法中做一些数学运算后设置了一个特殊的 gl_Position 变量，这个变量就是该顶点转换到裁剪空间中的坐标值，GPU 接收该值并将其保存起来。</p>\n<p>假设你正在画三角形，顶点着色器每完成三次顶点处理，WebGL 就会用这三个顶点画一个三角形。它计算出这三个顶点对应的像素后，就会光栅化这个三角形，“光栅化”其实就是“用像素画出来”的花哨叫法。对于每一个像素，它会调用你的片断着色器询问你使用什么颜色。你通过给片断着色器的一个特殊变量 gl_FragColor 设置一个颜色值，实现自定义像素颜色。</p>\n<p>使用它们可以做出非常有趣的东西，但如你所见，到目前为止的例子中，处理每个像素时片断着色器可用信息很少，幸运的是我们可以给它传递更多信息。想要从顶点着色器传值到片断着色器，我们可以定义“可变量（varyings）”。</p>\n<p>一个简单的例子，将顶点着色器计算出的裁剪空间坐标从顶点着色器传递到片断着色器。</p>\n<p>我们来画一个简单的三角形，从之前的例子继续，让我们把矩形改成三角形。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10862829126274542000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 定义一个三角形填充到缓冲里\nfunction setGeometry(gl) {\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, -100, 150, 125, -175, 100]), gl.STATIC_DRAW);\n}`, `10862829126274542000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 定义一个三角形填充到缓冲里</span>\n<span class="token keyword">function</span> <span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们只需要画三个顶点</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62007859745686190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制场景\nfunction drawScene() {\n  // ...\n  // 绘制几何体\n  var primitiveType = gl.TRIANGLES;\n  var offset = 0;\n  var count = 3;\n  gl.drawArrays(primitiveType, offset, count);\n}`, `62007859745686190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制场景</span>\n<span class="token keyword">function</span> <span class="token function">drawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 绘制几何体</span>\n  <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在我们的顶点着色器中定义一个 varying（可变量）用来给片断着色器传值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32344149646937768000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`varying vec4 v_color;\n// ...\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n\n  // 从裁减空间转换到颜色空间\n  // 裁减空间范围 -1.0 到 +1.0\n  // 颜色空间范围 0.0 到 1.0\n  v_color = gl_Position * 0.5 + 0.5;\n}`, `32344149646937768000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{10}"\n              >\n                <span class="gatsby-code-button-language">glsl{10}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_matrix <span class="token operator">*</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span>a_position<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 从裁减空间转换到颜色空间</span>\n  <span class="token comment">// 裁减空间范围 -1.0 到 +1.0</span>\n  <span class="token comment">// 颜色空间范围 0.0 到 1.0</span>\n<span class="gatsby-highlight-code-line">  v_color <span class="token operator">=</span> gl_Position <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在片断着色器中定义同名 varying 变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44443335894364640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}`, `44443335894364640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{3,6}"\n              >\n                <span class="gatsby-code-button-language">glsl{3,6}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span></span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">  gl_FragColor <span class="token operator">=</span> v_color<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>WebGL 会将同名的可变量从顶点着色器输入到片断着色器中。</p>\n<p>下面是运行结果</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/7xbtl?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [draw-colorful-triangle](embedded-codesandbox://webgl-fundamental-base-concept/draw-colorful-triangle) -->\n<p>当你移动、缩放、旋转三角形时，发现颜色随位置变化，不跟着三角形移动。</p>\n<p>回想一下，我们只计算了三个顶点，调用了三次顶点着色器，所以也只计算出了三个颜色值，但是我们的三角形却有很多颜色，这就是称之为可变量的 varying 的原因啦！</p>\n<p>WebGL 先获得顶点着色器中计算的三个颜色值，在光栅化三角形时将会根据这三个值进行插值。 每一个像素在调用片断着色器时，可变量的值是与之对应的插值。</p>\n<p>让我们从上例的三个顶点开始分析</p>\n<table>\n   <tbody>\n      <tr>\n         <th colspan="2">顶点</th>\n      </tr>\n      <tr>\n         <td>0</td>\n         <td>-100</td>\n      </tr>\n      <tr>\n         <td>150</td>\n         <td>125</td>\n      </tr>\n      <tr>\n         <td>-175</td>\n         <td>100</td>\n      </tr>\n   </tbody>\n</table>\n<p>我们的给顶点着色器施加了一个包含平移，旋转和缩放的的矩阵，并将结果转换到裁剪空间。默认平移，旋转和缩放值为：平移 = 200, 150，旋转 = 0，缩放 = 1，所以这里只进行了平移。画布大小（背景缓冲）为 400×300，所以三个顶点在裁剪空间中为以下坐标值。</p>\n<table>\n   <tbody>\n      <tr>\n         <th colspan="2">写入 gl_Position 的值</th>\n      </tr>\n      <tr>\n         <td>0.000</td>\n         <td>0.660</td>\n      </tr>\n      <tr>\n         <td>0.750</td>\n         <td>-0.830</td>\n      </tr>\n      <tr>\n         <td>-0.875</td>\n         <td>-0.660</td>\n      </tr>\n   </tbody>\n</table>\n<p>同时将这些值转换到颜色空间中赋给我们定义的可变量 v_color。</p>\n<table>\n   <tbody>\n      <tr>\n         <th colspan="3">写入 v_color 的值</th>\n      </tr>\n      <tr>\n         <td>0.5000</td>\n         <td>0.830</td>\n         <td>0.5</td>\n      </tr>\n      <tr>\n         <td>0.8750</td>\n         <td>0.086</td>\n         <td>0.5</td>\n      </tr>\n      <tr>\n         <td>0.0625</td>\n         <td>0.170</td>\n         <td>0.5</td>\n      </tr>\n   </tbody>\n</table>\n<p>利用这三个值进行插值后传进每个像素运行的片断着色器中。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/zi15x?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [fragment-shader-anim](embedded-codesandbox://webgl-fundamental-base-concept/fragment-shader-anim?view=preview) -->\n<p>想要给片断着色器传值，我们可以先把值传递给顶点着色器然后再传给片断着色器。让我们来画一个由两个不同颜色三角形组成的矩形。我们需要给顶点着色器添加一个属性值，把值通过属性传递给它后它再直接传递给片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80181111837663920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec2 a_position;\nattribute vec4 a_color;\n// ...\nvarying vec4 v_color;\n\nvoid main() {\n  // 直接把属性值中的数据赋给可变量\n  v_color = a_color;\n}`, `80181111837663920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{2,8}"\n              >\n                <span class="gatsby-code-button-language">glsl{2,8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_position<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_color<span class="token punctuation">;</span></span><span class="token comment">// ...</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 直接把属性值中的数据赋给可变量</span>\n<span class="gatsby-highlight-code-line">  v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在要给 WebGL 提供要用的颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32706557634105080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 寻找顶点着色器中需要的数据\nvar positionLocation = gl.getAttribLocation(program, \'a_position\');\nvar colorLocation = gl.getAttribLocation(program, \'a_color\');\n// ..\n// 给颜色数据创建一个缓冲\nvar colorBuffer = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n// 设置颜色\nsetColors(gl);\n// ..\n\n// 给矩形的两个三角形\n// 设置颜色值并发到缓冲\nfunction setColors(gl) {\n  // 生成两个随机颜色\n  var r1 = Math.random();\n  var b1 = Math.random();\n  var g1 = Math.random();\n\n  var r2 = Math.random();\n  var b2 = Math.random();\n  var g2 = Math.random();\n\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([r1, b1, g1, 1, r1, b1, g1, 1, r1, b1, g1, 1, r2, b2, g2, 1, r2, b2, g2, 1, r2, b2, g2, 1]),\n    gl.STATIC_DRAW\n  );\n}`, `32706557634105080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3,5-9,12-29}"\n              >\n                <span class="gatsby-code-button-language">js{3,5-9,12-29}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 寻找顶点着色器中需要的数据</span>\n<span class="token keyword">var</span> positionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token comment">// ..</span>\n<span class="gatsby-highlight-code-line"><span class="token comment">// 给颜色数据创建一个缓冲</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">var</span> colorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// 设置颜色</span></span><span class="gatsby-highlight-code-line"><span class="token function">setColors</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token comment">// ..</span>\n\n<span class="gatsby-highlight-code-line"><span class="token comment">// 给矩形的两个三角形</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// 设置颜色值并发到缓冲</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token comment">// 生成两个随机颜色</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> r1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> b1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> g1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> r2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> b2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> g2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>r1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> g1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> g1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> g1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在渲染的时候设置颜色属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3316277271172829700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enableVertexAttribArray(colorLocation);\n\n// 绑定颜色缓冲\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n\n// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值\nvar size = 4; // 每次迭代使用4个单位的数据\nvar type = gl.FLOAT; // 单位数据类型是32位的浮点型\nvar normalize = false; // 不需要归一化数据\nvar stride = 0; // 0 = 移动距离 * 单位距离长度sizeof(type)\n\n// 每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);`, `3316277271172829700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 绑定颜色缓冲</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用4个单位的数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是32位的浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不需要归一化数据</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度sizeof(type)</span>\n\n<span class="token comment">// 每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调整顶点的数量为 6 用来画两个三角形</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94634577338217200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 画几何体\nvar primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 6;\ngl.drawArrays(primitiveType, offset, count);`, `94634577338217200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4}"\n              >\n                <span class="gatsby-code-button-language">js{4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 画几何体</span>\n<span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span></span>gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/fi4uh?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-2d-rectangle-with-2-colors](embedded-codesandbox://webgl-fundamental-base-concept/webgl-2d-rectangle-with-2-colors) -->\n<p>你可能注意到这两个三角形是纯色的。我们传递给每个三角形的顶点的颜色值是相同的，所以我们传递的 varying 会被插值成相同的颜色，如果我们传递不同的颜色，就会看到插值的颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12168570141873891000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 给矩形的两个三角形\n// 设置颜色值并发到缓冲\nfunction setColors(gl) {\n  // 给每个顶点定义不同的颜色\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1\n    ]),\n    gl.STATIC_DRAW\n  );\n}`, `12168570141873891000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{8-31}"\n              >\n                <span class="gatsby-code-button-language">js{8-31}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 给矩形的两个三角形</span>\n<span class="token comment">// 设置颜色值并发到缓冲</span>\n<span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 给每个顶点定义不同的颜色</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n<span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span></span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在看到的是插值的 varying</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/5ohcj?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!--\n[webgl-2d-rectangle-with-random-colors](embedded-codesandbox://webgl-fundamental-base-concept/webgl-2d-rectangle-with-random-colors) -->\n<p>上例还演示了使用多个属性并且通过顶点着色器向片断着色器传值。如果你看了处理图片的例子，那里面还用了另外一个属性传递纹理坐标。</p>\n<h2 id="关于-buffer-和-attribute-的代码是干什么的？"><a href="#%E5%85%B3%E4%BA%8E-buffer-%E5%92%8C-attribute-%E7%9A%84%E4%BB%A3%E7%A0%81%E6%98%AF%E5%B9%B2%E4%BB%80%E4%B9%88%E7%9A%84%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 buffer 和 attribute 的代码是干什么的？</h2>\n<p>缓冲操作是在 GPU 上获取顶点和其他顶点数据的一种方式。gl.createBuffer 创建一个缓冲；gl.bindBuffer 是设置缓冲为当前使用缓冲；gl.bufferData 将数据拷贝到缓冲，这个操作一般在初始化完成。</p>\n<p>一旦数据存到缓冲中，还需要告诉 WebGL 怎么从缓冲中提取数据传给顶点着色器的属性。</p>\n<p>要做这些，首先需要获取 WebGL 给属性分配的地址，如下方代码所示</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78227965779663680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 询问顶点数据应该放在哪里\nvar positionLocation = gl.getAttribLocation(program, \'a_position\');\nvar colorLocation = gl.getAttribLocation(program, \'a_color\');`, `78227965779663680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 询问顶点数据应该放在哪里</span>\n<span class="token keyword">var</span> positionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这一步一般也是在初始化部分完成。</p>\n<p>一旦知道了属性的地址，在绘制前还需要发出三个命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5365556530726301000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enableVertexAttribArray(location); // 这个命令是告诉 WebGL 我们想从缓冲中提供数据。\ngl.bindBuffer(gl.ARRAY_BUFFER, someBuffer); // 这个命令是将缓冲绑定到 ARRAY_BUFFER 绑定点，它是 WebGL 内部的一个全局变量。\ngl.vertexAttribPointer(location, numComponents, typeOfData, normalizeFlag, strideToNextPieceOfData, offsetIntoBuffer);`, `5365556530726301000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个命令是告诉 WebGL 我们想从缓冲中提供数据。</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> someBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个命令是将缓冲绑定到 ARRAY_BUFFER 绑定点，它是 WebGL 内部的一个全局变量。</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> numComponents<span class="token punctuation">,</span> typeOfData<span class="token punctuation">,</span> normalizeFlag<span class="token punctuation">,</span> strideToNextPieceOfData<span class="token punctuation">,</span> offsetIntoBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>最后一条命令告诉 WebGL 从 <code class="language-text">ARRAY_BUFFER</code> 绑定点当前绑定的缓冲获取数据。每个顶点有几个单位的数据(1 - 4)，单位数据类型是什么(BYTE, FLOAT, INT, <code class="language-text">UNSIGNED_SHORT</code>, 等等…)，stride 是从一个数据到下一个数据要跳过多少位，最后是数据在缓冲的什么位置。</p>\n<p>单位个数永远是 1 到 4 之间。</p>\n<p>如果每个类型的数据都用一个缓冲存储，stride 和 offset 都是 0。对 stride 来说 0 表示 “用符合单位类型和单位个数的大小”。对 offset 来说 0 表示从缓冲起始位置开始读取。它们使用 0 以外的值时会复杂得多，虽然这样会取得一些性能能上的优势，但是一般情况下并不值得，除非你想充分压榨 WebGL 的性能。</p>\n<h2 id="vertexattribpointer-中的-normalizeflag-参数是什么意思？"><a href="#vertexattribpointer-%E4%B8%AD%E7%9A%84-normalizeflag-%E5%8F%82%E6%95%B0%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vertexAttribPointer 中的 normalizeFlag 参数是什么意思？</h2>\n<p>标准化标记（normalizeFlag）适用于所有非浮点型数据。如果传递 false 就解读原数据类型。 BYTE 类型的范围是从 -128 到 127，UNSIGNED_BYTE 类型的范围是从 0 到 255， SHORT 类型的范围是从 -32768 到 32767，等等…</p>\n<p>如果标准化标记设为 true，BYTE 数据的值(-128 to 127)将会转换到 -1.0 到 +1.0 之间， UNSIGNED_BYTE (0 to 255) 变为 0.0 到 +1.0 之间，SHORT 也是转换到 -1.0 到 +1.0 之间， 但比 BYTE 精确度高。</p>\n<p>最常用的是标准化颜色数据。大多数情况颜色值范围为 0.0 到 +1.0。 使用 4 个浮点型数据存储红，绿，蓝和阿尔法通道数据时，每个顶点的颜色将会占用 16 字节空间， 如果你有复杂的几何体将会占用很多内存。代替的做法是将颜色数据转换为四个 UNSIGNED_BYTE ， 其中 0 表示 0.0，255 表示 1.0。现在每个顶点只需要四个字节存储颜色值，省了 75% 空间。</p>\n<p>我们来修改之前代码实现。当我们告诉 WebGL 如何获取颜色数据时将这样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64010150740579740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 告诉颜色属性如何从 colorBuffer 中提取数据 (ARRAY_BUFFER)\nvar size = 4; // 每次迭代使用四个单位数据\nvar type = gl.UNSIGNED_BYTE; // 数据类型是 8 位的 UNSIGNED_BYTE 类型。\nvar normalize = true; // 标准化数据\nvar stride = 0; // 0 = 移动距离 * 单位距离长度 sizeof(type)\n// 每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从缓冲的起始处开始\ngl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);`, `64010150740579740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3-4}"\n              >\n                <span class="gatsby-code-button-language">js{3-4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 告诉颜色属性如何从 colorBuffer 中提取数据 (ARRAY_BUFFER)</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用四个单位数据</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">;</span> <span class="token comment">// 数据类型是 8 位的 UNSIGNED_BYTE 类型。</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 标准化数据</span></span><span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度 sizeof(type)</span>\n<span class="token comment">// 每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如下向缓冲添加数据</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4514866872372791300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 给矩形的两个三角形\n// 设置颜色值并发到缓冲\nfunction setColors(gl) {\n  // 设置两个随机颜色\n  var r1 = Math.random() * 256; // 0 到 255.99999 之间\n  var b1 = Math.random() * 256; // 这些数据\n  var g1 = Math.random() * 256; // 在存入缓冲时\n  var r2 = Math.random() * 256; // 将被截取成\n  var b2 = Math.random() * 256; // Uint8Array 类型\n  var g2 = Math.random() * 256;\n\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Uint8Array([\n      // Uint8Array\n      r1,\n      b1,\n      g1,\n      255,\n      r1,\n      b1,\n      g1,\n      255,\n      r1,\n      b1,\n      g1,\n      255,\n      r2,\n      b2,\n      g2,\n      255,\n      r2,\n      b2,\n      g2,\n      255,\n      r2,\n      b2,\n      g2,\n      255\n    ]),\n    gl.STATIC_DRAW\n  );\n}`, `4514866872372791300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 给矩形的两个三角形</span>\n<span class="token comment">// 设置颜色值并发到缓冲</span>\n<span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 设置两个随机颜色</span>\n  <span class="token keyword">var</span> r1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 0 到 255.99999 之间</span>\n  <span class="token keyword">var</span> b1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 这些数据</span>\n  <span class="token keyword">var</span> g1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 在存入缓冲时</span>\n  <span class="token keyword">var</span> r2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 将被截取成</span>\n  <span class="token keyword">var</span> b2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// Uint8Array 类型</span>\n  <span class="token keyword">var</span> g2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span>\n\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n      <span class="token comment">// Uint8Array</span>\n      r1<span class="token punctuation">,</span>\n      b1<span class="token punctuation">,</span>\n      g1<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r1<span class="token punctuation">,</span>\n      b1<span class="token punctuation">,</span>\n      g1<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r1<span class="token punctuation">,</span>\n      b1<span class="token punctuation">,</span>\n      g1<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r2<span class="token punctuation">,</span>\n      b2<span class="token punctuation">,</span>\n      g2<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r2<span class="token punctuation">,</span>\n      b2<span class="token punctuation">,</span>\n      g2<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r2<span class="token punctuation">,</span>\n      b2<span class="token punctuation">,</span>\n      g2<span class="token punctuation">,</span>\n      <span class="token number">255</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/x51g6?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-2d-rectangle-with-2-byte-colors](embedded-codesandbox://webgl-fundamental-base-concept/webgl-2d-rectangle-with-2-byte-colors) -->\n<h1 id="webgl-着色器和-glsl"><a href="#webgl-%E7%9D%80%E8%89%B2%E5%99%A8%E5%92%8C-glsl" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 着色器和 GLSL</h1>\n<p>我们之前提到过着色器和 GLSL，但是没有涉及细节，你可能已经对此有所了解，但以防万一，这里将详细讲解着色器和 GLSL。</p>\n<p>在工作原理中我们提到，WebGL 每次绘制需要两个着色器，一个顶点着色器和一个片断着色器，每一个着色器都是一个方法。一个顶点着色器和一个片断着色器链接在一起放入一个着色程序中（或者只叫程序）。一个典型的 WebGL 应用会有多个着色程序。</p>\n<h2 id="顶点着色器"><a href="#%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点着色器</h2>\n<p>一个顶点着色器的工作是生成裁剪空间坐标值，通常是以下的形式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94491953281562480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`void main() {\n   gl_Position = doMathToMakeClipspaceCoordinates\n}`, `94491953281562480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_Position <span class="token operator">=</span> doMathToMakeClipspaceCoordinates\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>每个顶点调用一次（顶点）着色器，每次调用都需要设置一个特殊的全局变量 gl_Position， 该变量的值就是裁减空间坐标值。</p>\n<p>顶点着色器需要的数据，可以通过以下三种方式获得</p>\n<ol>\n<li>Attributes 属性 (从缓冲中获取的数据)</li>\n<li>Uniforms 全局变量 (在一次绘制中对所有顶点保持一致值)</li>\n<li>Textures 纹理 (从像素或纹理元素中获取的数据)</li>\n</ol>\n<h3 id="attributes-属性"><a href="#attributes-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Attributes 属性</h3>\n<p>最常用的方法是缓冲和属性，在工作原理中讲到了缓冲和属性，你可以创建缓冲</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95823312258545500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var buf = gl.createBuffer();`, `95823312258545500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> buf <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>将数据存入缓冲</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43862145196751950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.bindBuffer(gl.ARRAY_BUFFER, buf);\ngl.bufferData(gl.ARRAY_BUFFER, someData, gl.STATIC_DRAW);`, `43862145196751950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> someData<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然后初始化的时候，在你制作的（着色）程序中找到属性所在地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76909593380018140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positionLoc = gl.getAttribLocation(someShaderProgram, \'a_position\');`, `76909593380018140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positionLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>someShaderProgram<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在渲染的时候告诉 WebGL 怎么从缓冲中获取数据传递给属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51601134927977420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 开启从缓冲中获取数据\ngl.enableVertexAttribArray(positionLoc);\n\nvar numComponents = 3; // (x, y, z)\nvar type = gl.FLOAT; // 32 位浮点数据\nvar normalize = false; // 不标准化\nvar offset = 0; // 从缓冲起始位置开始获取\nvar stride = 0; // 到下一个数据跳多少位内存\n// 0 = 使用当前的单位个数和单位长度（3 * Float32Array.BYTES_PER_ELEMENT）\n\ngl.vertexAttribPointer(positionLoc, numComponents, type, false, stride, offset);`, `51601134927977420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 开启从缓冲中获取数据</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionLoc<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> numComponents <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// (x, y, z)</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 32 位浮点数据</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不标准化</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从缓冲起始位置开始获取</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 到下一个数据跳多少位内存</span>\n<span class="token comment">// 0 = 使用当前的单位个数和单位长度（3 * Float32Array.BYTES_PER_ELEMENT）</span>\n\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionLoc<span class="token punctuation">,</span> numComponents<span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 <code class="language-text">WebGL 基础概念</code> 中示范了不做任何运算直接将数据传递给 <code class="language-text">gl_Position</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="935301122294429700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\n\nvoid main() {\n   gl_Position = a_position;\n}`, `935301122294429700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果缓冲中存的是裁剪空间坐标就没什么问题。</p>\n<p>属性可以用 float, vec2, vec3, vec4, mat2, mat3 和 mat4 数据类型。</p>\n<h3 id="uniforms-全局变量"><a href="#uniforms-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uniforms 全局变量</h3>\n<p>全局变量在一次绘制过程中传递给着色器的值都一样，在下面的一个简单的例子中，用全局变量给顶点着色器添加了一个偏移量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29949357191347660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nuniform vec4 u_offset;\n\nvoid main() {\n   gl_Position = a_position + u_offset;\n}`, `29949357191347660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_offset<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_Position <span class="token operator">=</span> a_position <span class="token operator">+</span> u_offset<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在可以把所有顶点偏移一个固定值，首先在初始化时找到全局变量的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66313625731308350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var offsetLoc = gl.getUniformLocation(someProgram, \'u_offset\');`, `66313625731308350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> offsetLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_offset\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后在绘制前设置全局变量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65260491023007105000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform4fv(offsetLoc, [1, 0, 0, 0]); // 向右偏移一半屏幕宽度`, `65260491023007105000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>offsetLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 向右偏移一半屏幕宽度</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>要注意的是全局变量属于单个着色程序，如果多个着色程序有同名全局变量，需要找到每个全局变量并设置自己的值。 我们调用 <code class="language-text">gl.uniform???</code> 的时候只是设置了当前程序的全局变量，当前程序是传递给 <code class="language-text">gl.useProgram</code> 的最后一个程序。</p>\n<p>全局变量有很多类型，对应的类型有对应的设置方法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21645475511234970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform1f(floatUniformLoc, v);                 // float\ngl.uniform1fv(floatUniformLoc, [v]);              // float 或 float array\ngl.uniform2f(vec2UniformLoc, v0, v1);             // vec2\ngl.uniform2fv(vec2UniformLoc, [v0, v1]);          // vec2 或 vec2 array\ngl.uniform3f(vec3UniformLoc, v0, v1, v2);         // vec3\ngl.uniform3fv(vec3UniformLoc, [v0, v1, v2]);      // vec3 或 vec3 array\ngl.uniform4f(vec4UniformLoc, v0, v1, v2, v4);     // vec4\ngl.uniform4fv(vec4UniformLoc, [v0, v1, v2, v4]);  // vec4 或 vec4 array\n\ngl.uniformMatrix2fv(mat2UniformLoc, false, [4x element array])    // mat2 或 mat2 array\ngl.uniformMatrix3fv(mat3UniformLoc, false, [9x element array])    // mat3 或 mat3 array\ngl.uniformMatrix4fv(mat4UniformLoc, false, [16x element array])   // mat4 或 mat4 array\n\ngl.uniform1i(intUniformLoc, v);                   // int\ngl.uniform1iv(intUniformLoc, [v]);                // int 或 int array\ngl.uniform2i(ivec2UniformLoc, v0, v1);            // ivec2\ngl.uniform2iv(ivec2UniformLoc, [v0, v1]);         // ivec2 或 ivec2 array\ngl.uniform3i(ivec3UniformLoc, v0, v1, v2);        // ivec3\ngl.uniform3iv(ivec3UniformLoc, [v0, v1, v2]);     // ivec3 or ivec3 array\ngl.uniform4i(ivec4UniformLoc, v0, v1, v2, v4);    // ivec4\ngl.uniform4iv(ivec4UniformLoc, [v0, v1, v2, v4]); // ivec4 或 ivec4 array\n\ngl.uniform1i(sampler2DUniformLoc, v);             // sampler2D (textures)\ngl.uniform1iv(sampler2DUniformLoc, [v]);          // sampler2D 或 sampler2D array\n\ngl.uniform1i(samplerCubeUniformLoc, v);           // samplerCube (textures)\ngl.uniform1iv(samplerCubeUniformLoc, [v]);        // samplerCube 或 samplerCube array`, `21645475511234970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>floatUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// float</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1fv</span><span class="token punctuation">(</span>floatUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// float 或 float array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>vec2UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// vec2</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>vec2UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// vec2 或 vec2 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3f</span><span class="token punctuation">(</span>vec3UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// vec3</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>vec3UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// vec3 或 vec3 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>vec4UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// vec4</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>vec4UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// vec4 或 vec4 array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix2fv</span><span class="token punctuation">(</span>mat2UniformLoc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span>x element array<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// mat2 或 mat2 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix3fv</span><span class="token punctuation">(</span>mat3UniformLoc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span>x element array<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// mat3 或 mat3 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>mat4UniformLoc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span>x element array<span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment">// mat4 或 mat4 array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>intUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// int</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1iv</span><span class="token punctuation">(</span>intUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// int 或 int array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2i</span><span class="token punctuation">(</span>ivec2UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ivec2</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2iv</span><span class="token punctuation">(</span>ivec2UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// ivec2 或 ivec2 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3i</span><span class="token punctuation">(</span>ivec3UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ivec3</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3iv</span><span class="token punctuation">(</span>ivec3UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// ivec3 or ivec3 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4i</span><span class="token punctuation">(</span>ivec4UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ivec4</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4iv</span><span class="token punctuation">(</span>ivec4UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ivec4 或 ivec4 array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>sampler2DUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// sampler2D (textures)</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1iv</span><span class="token punctuation">(</span>sampler2DUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// sampler2D 或 sampler2D array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>samplerCubeUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// samplerCube (textures)</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1iv</span><span class="token punctuation">(</span>samplerCubeUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// samplerCube 或 samplerCube array</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有一些类型 bool, bvec2, bvec3, bvec4。它们可用 <code class="language-text">gl.uniform?f?</code> 或 <code class="language-text">gl.uniform?i?</code>。</p>\n<p>一个数组可以一次设置所有的全局变量，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58062553603515245000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 着色器里\nuniform vec2 u_someVec2[3];\n\n// JavaScript 初始化时\nvar someVec2Loc = gl.getUniformLocation(someProgram, &quot;u_someVec2&quot;);\n\n// 渲染的时候\ngl.uniform2fv(someVec2Loc, [1, 2, 3, 4, 5, 6]);  // 设置数组 u_someVec2`, `58062553603515245000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 着色器里</span>\nuniform vec2 u_someVec2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// JavaScript 初始化时</span>\n<span class="token keyword">var</span> someVec2Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">"u_someVec2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 渲染的时候</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置数组 u_someVec2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果你想单独设置数组中的某个值，就要单独找到该值的地址。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95851558858622830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// JavaScript 初始化时\nvar someVec2Element0Loc = gl.getUniformLocation(someProgram, \'u_someVec2[0]\');\nvar someVec2Element1Loc = gl.getUniformLocation(someProgram, \'u_someVec2[1]\');\nvar someVec2Element2Loc = gl.getUniformLocation(someProgram, \'u_someVec2[2]\');\n\n// 渲染的时候\ngl.uniform2fv(someVec2Element0Loc, [1, 2]); // set element 0\ngl.uniform2fv(someVec2Element1Loc, [3, 4]); // set element 1\ngl.uniform2fv(someVec2Element2Loc, [5, 6]); // set element 2`, `95851558858622830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// JavaScript 初始化时</span>\n<span class="token keyword">var</span> someVec2Element0Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someVec2[0]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> someVec2Element1Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someVec2[1]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> someVec2Element2Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someVec2[2]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 渲染的时候</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Element0Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set element 0</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Element1Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set element 1</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Element2Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set element 2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样的，如果你创建了一个结构体</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53460158007629020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct SomeStruct {\n  bool active;\n  vec2 someVec2;\n};\n\nuniform SomeStruct u_someThing;`, `53460158007629020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">struct</span> SomeStruct <span class="token punctuation">{</span>\n  <span class="token keyword">bool</span> <span class="token keyword">active</span><span class="token punctuation">;</span>\n  <span class="token keyword">vec2</span> someVec2<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> SomeStruct u_someThing<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你需要找到每个元素的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15675907705096150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var someThingActiveLoc = gl.getUniformLocation(someProgram, \'u_someThing.active\');\nvar someThingSomeVec2Loc = gl.getUniformLocation(someProgram, \'u_someThing.someVec2\');`, `15675907705096150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> someThingActiveLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someThing.active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> someThingSomeVec2Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someThing.someVec2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="纹理（顶点着色器中）"><a href="#%E7%BA%B9%E7%90%86%EF%BC%88%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8%E4%B8%AD%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>纹理（顶点着色器中）</h3>\n<p>同 Textures 纹理（在片断着色器中）。</p>\n<h2 id="片断着色器"><a href="#%E7%89%87%E6%96%AD%E7%9D%80%E8%89%B2%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>片断着色器</h2>\n<p>一个片断着色器的工作是为当前光栅化的像素提供颜色值，通常是以下的形式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58120773160766360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nvoid main() {\n   gl_FragColor = doMathToMakeAColor;\n}`, `58120773160766360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_FragColor <span class="token operator">=</span> doMathToMakeAColor<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>每个像素都将调用一次片断着色器，每次调用需要从你设置的特殊全局变量 gl_FragColor 中获取颜色信息。</p>\n<p>片断着色器所需的数据，可以通过以下三种方式获取</p>\n<ol>\n<li>Uniforms 全局变量 (values that stay the same for every pixel of a single draw call)</li>\n<li>Textures 纹理 (data from pixels/texels)</li>\n<li>Varyings 可变量 (data passed from the vertex shader and interpolated)</li>\n</ol>\n<h3 id="uniform-全局变量（片断着色器中）"><a href="#uniform-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%EF%BC%88%E7%89%87%E6%96%AD%E7%9D%80%E8%89%B2%E5%99%A8%E4%B8%AD%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uniform 全局变量（片断着色器中）</h3>\n<p>同 Uniforms 全局变量</p>\n<h3 id="textures-纹理（片断着色器中）"><a href="#textures-%E7%BA%B9%E7%90%86%EF%BC%88%E7%89%87%E6%96%AD%E7%9D%80%E8%89%B2%E5%99%A8%E4%B8%AD%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Textures 纹理（片断着色器中）</h3>\n<p>在着色器中获取纹理信息，可以先创建一个 sampler2D 类型全局变量，然后用 GLSL 方法 texture2D 从纹理中提取信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51692292750429220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nuniform sampler2D u_texture;\n\nvoid main() {\n   vec2 texcoord = vec2(0.5, 0.5)  // 获取纹理中心的值\n   gl_FragColor = texture2D(u_texture, texcoord);\n}`, `51692292750429220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">sampler2D</span> u_texture<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">vec2</span> texcoord <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>  <span class="token comment">// 获取纹理中心的值</span>\n   gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_texture<span class="token punctuation">,</span> texcoord<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从纹理中获取的数据取决于很多设置，至少要创建并给纹理填充数据，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32833226345450360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var tex = gl.createTexture();\ngl.bindTexture(gl.TEXTURE_2D, tex);\nvar level = 0;\nvar width = 2;\nvar height = 1;\nvar data = new Uint8Array([\n  255,\n  0,\n  0,\n  255, // 一个红色的像素\n  0,\n  255,\n  0,\n  255 // 一个绿色的像素\n]);\ngl.texImage2D(gl.TEXTURE_2D, level, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\ngl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);`, `32833226345450360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> tex <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> tex<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> level <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> width <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> height <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token number">255</span><span class="token punctuation">,</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">255</span><span class="token punctuation">,</span> <span class="token comment">// 一个红色的像素</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">255</span><span class="token punctuation">,</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">255</span> <span class="token comment">// 一个绿色的像素</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在初始化时找到全局变量的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56443986468631290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var someSamplerLoc = gl.getUniformLocation(someProgram, \'u_texture\');`, `56443986468631290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> someSamplerLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_texture\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在渲染的时候 WebGL 要求纹理必须绑定到一个纹理单元上</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70481531522133160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var unit = 5; // 挑选一个纹理单元\ngl.activeTexture(gl.TEXTURE0 + unit);\ngl.bindTexture(gl.TEXTURE_2D, tex);`, `70481531522133160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> unit <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 挑选一个纹理单元</span>\ngl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span> <span class="token operator">+</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> tex<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后告诉着色器你要使用的纹理在那个纹理单元</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87940164681293170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform1i(someSamplerLoc, unit);`, `87940164681293170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>someSamplerLoc<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="varyings-可变量"><a href="#varyings-%E5%8F%AF%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Varyings 可变量</h3>\n<p>在工作原理提到过，可变量是一种顶点着色器给片断着色器传值的方式。</p>\n<p>为了使用可变量，要在两个着色器中定义同名的可变量。给顶点着色器中可变量设置的值，会作为参考值进行内插，在绘制像素时传给片断着色器的可变量。</p>\n<p>顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48064052267767510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\n\nuniform vec4 u_offset;\n\nvarying vec4 v_positionWithOffset;\n\nvoid main() {\n  gl_Position = a_position + u_offset;\n  v_positionWithOffset = a_position + u_offset;\n}`, `48064052267767510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_offset<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_positionWithOffset<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl_Position <span class="token operator">=</span> a_position <span class="token operator">+</span> u_offset<span class="token punctuation">;</span>\n  v_positionWithOffset <span class="token operator">=</span> a_position <span class="token operator">+</span> u_offset<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>片断着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80552051683771970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nvarying vec4 v_positionWithOffset;\n\nvoid main() {\n  // 从裁剪空间 (-1 <-> +1) 转换到颜色空间 (0 -> 1).\n  vec4 color = v_positionWithOffset * 0.5 + 0.5\n  gl_FragColor = color;\n}`, `80552051683771970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_positionWithOffset<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 从裁剪空间 (-1 &lt;-> +1) 转换到颜色空间 (0 -> 1).</span>\n  <span class="token keyword">vec4</span> color <span class="token operator">=</span> v_positionWithOffset <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token number">0.5</span>\n  gl_FragColor <span class="token operator">=</span> color<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上方的示例几乎没有意义，通常情况下直接将裁剪空间的值传给片断着色器当作颜色值是没有意义的，虽然它可以运行并且可以生成颜色值。</p>\n<h2 id="glsl"><a href="#glsl" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GLSL</h2>\n<p>GLSL 全称是 Graphics Library Shader Language（图形库着色器语言），是着色器使用的语言。它有一些不同于 JavaScript 的特性，主要目的是为栅格化图形提供常用的计算功能。所以它内建的数据类型例如 vec2, vec3 和 vec4 分别代表两个值，三个值和四个值，类似的还有 mat2, mat3 和 mat4 分别代表 2x2, 3x3 和 4x4 矩阵。你可以做一些运算例如常量和矢量的乘法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73975592373426490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 a = vec4(1, 2, 3, 4);\nvec4 b = a * 2.0;\n// b 现在是 vec4(2, 4, 6, 8);`, `73975592373426490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> a <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">vec4</span> b <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n<span class="token comment">// b 现在是 vec4(2, 4, 6, 8);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>它同样可以做矩阵乘法以及矢量和矩阵的乘法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56511442419312980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mat4 a = ???\nmat4 b = ???\nmat4 c = a * b;\n\nvec4 v = ???\nvec4 y = c * v;`, `56511442419312980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">mat4</span> a <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>\n<span class="token keyword">mat4</span> b <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>\n<span class="token keyword">mat4</span> c <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>\n\n<span class="token keyword">vec4</span> v <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>\n<span class="token keyword">vec4</span> y <span class="token operator">=</span> c <span class="token operator">*</span> v<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>他还为矢量数据提供多种分量选择器，例如 vec4</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24360769286333020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 v;`, `24360769286333020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> v<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<ul>\n<li>v.x 和 v.s 以及 v.r ， <code class="language-text">v[0]</code> 表达的是同一个分量。</li>\n<li>v.y 和 v.t 以及 v.g ， <code class="language-text">v[1]</code> 表达的是同一个分量。</li>\n<li>v.z 和 v.p 以及 v.b ， <code class="language-text">v[2]</code> 表达的是同一个分量。</li>\n<li>v.w 和 v.q 以及 v.a ， <code class="language-text">v[3]</code> 表达的是同一个分量。</li>\n</ul>\n<p>它还支持矢量调制，意味者你可以交换或重复分量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34929452225276280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v.yyyy`, `34929452225276280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">v<span class="token punctuation">.</span>yyyy</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68399684579510090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.y, v.y, v.y, v.y)`, `68399684579510090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是一样的。同样的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51677550822896710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v.bgra`, `51677550822896710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">v<span class="token punctuation">.</span>bgra</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67353143282902940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.b, v.g, v.r, v.a)`, `67353143282902940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>b<span class="token punctuation">,</span> v<span class="token punctuation">.</span>g<span class="token punctuation">,</span> v<span class="token punctuation">.</span>r<span class="token punctuation">,</span> v<span class="token punctuation">.</span>a<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>等价。当构造一个矢量或矩阵时可以一次提供多个分量，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57268002821047935000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.rgb, 1)`, `57268002821047935000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68691172579633800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.r, v.g, v.b, 1)`, `68691172579633800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>r<span class="token punctuation">,</span> v<span class="token punctuation">.</span>g<span class="token punctuation">,</span> v<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是一样的。同样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68651253750495410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(1)`, `68651253750495410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80712364160420130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(1, 1, 1, 1)`, `80712364160420130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>相同。值得注意的是 GLSL 是一个强类型的语言。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71375173859737200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float f = 1;  // 错误，1 是 int 类型，不能将 int 型赋值给 float`, `71375173859737200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 错误，1 是 int 类型，不能将 int 型赋值给 float</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>正确的方式是</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="159676223288451870"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float f = 1.0;      // 使用 float\nfloat f = float(1)  // 转换 integer 为 float`, `159676223288451870`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>      <span class="token comment">// 使用 float</span>\n<span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// 转换 integer 为 float</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>上例中 <code class="language-text">vec4(v.rgb, 1)</code> 不会因为 1 报错，因为 vec4 内部进行了转换类似 <code class="language-text">float(1)</code> 。</p>\n<p>GLSL 有一系列内置方法，其中大多数运算支持多种数据类型，并且一次可以运算多个分量，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97227112289901350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`T sin(T angle)`, `97227112289901350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">T <span class="token function">sin</span><span class="token punctuation">(</span>T angle<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>T 可以是 float, vec2, vec3 或 vec4。如果你传的是 vec4 返回的也是 vec4, 返回结果对应每个分量的正弦值。换句话说如果 v 是 vec4 类型。那么</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29966960724109648000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 s = sin(v);`, `29966960724109648000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> s <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67436160093461960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 s = vec4(sin(v.x), sin(v.y), sin(v.z), sin(v.w));`, `67436160093461960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> s <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是一样的。有时一个参数是浮点型而剩下的都是 T，意思是那个浮点数据会作为所有其他参数的一个新分量。例如如果 v1 和 v2 是 vec4 同时 f 是浮点型，那么</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86917907010199700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 m = mix(v1, v2, f);`, `86917907010199700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> m <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74932464633486150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 m = vec4(\n  mix(v1.x, v2.x, f),\n  mix(v1.y, v2.y, f),\n  mix(v1.z, v2.z, f),\n  mix(v1.w, v2.w, f));`, `74932464633486150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> m <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>z<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>z<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>w<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>w<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>等价。你可以在 <a href="https://www.khronos.org/files/webgl/webgl-reference-card-1_0.pdf" target="_blank" rel="nofollow noreferrer noopener">WebGL 引用表</a> 最后一页看到所有 GLSL 方法的列表。如果你喜欢干货以更详细的东西你可以看看 <a href="https://www.khronos.org/files/opengles_shading_language.pdf" target="_blank" rel="nofollow noreferrer noopener">GLSL 规范</a>。</p>\n<h2 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>\n<p>这是当前系列文章的重点。WebGL 的全部内容就是创建不同的着色器，向着色器提供数据然后调用 gl.drawArrays 或 gl.drawElements 让 WebGL 调用当前顶点着色器处理每个顶点，调用当前片断着色器渲染每个像素。</p>\n<p>实际上创建着色器需要为数不多的几行代码，并且在大多数 WebGL 应用程序中都相似， 因此一旦写完几乎可以不再关心它们了。</p>\n<h1 id="webgl-state-diagram"><a href="#webgl-state-diagram" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL State Diagram</h1>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/8gqf5w?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-state-diagram](embedded-codesandbox://webgl-fundamental-base-concept/webgl-state-diagram) -->',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——基础概念/index.md absPath of file >>> MarkdownRemark",timeToRead:34,frontmatter:{date:"2022-04-26 11:03:10",path:"/webgl-fundamental-base-concept/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——基础概念",draft:null}},{excerpt:"本章介绍 CSS 渐变、CSS 3D 变换、CSS 过渡和 CSS 动画这 4 部分内容，如果没有专门说明，相关 CSS 属性均是被 IE10+ 浏览器支持的。本章介绍的这些 CSS 属性都非常实用，且细节众多，读者需要反复阅读才能理解。 CSS 渐变 CSS 渐变是 CSS 世界中第一次真正意义上使用纯 CSS 代码创建的图像。它可以应用在任何需要使用图像的场景，因此非常常用，读者一定要牢记相关语法。如果 CSS 的学习有期末考试的话，那么 CSS…",html:'<p>本章介绍 CSS 渐变、CSS 3D 变换、CSS 过渡和 CSS 动画这 4 部分内容，如果没有专门说明，相关 CSS 属性均是被 IE10+ 浏览器支持的。本章介绍的这些 CSS 属性都非常实用，且细节众多，读者需要反复阅读才能理解。</p>\n<h1 id="css-渐变"><a href="#css-%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 渐变</h1>\n<p>CSS 渐变是 CSS 世界中第一次真正意义上使用纯 CSS 代码创建的图像。它可以应用在任何需要使用图像的场景，因此非常常用，读者一定要牢记相关语法。如果 CSS 的学习有期末考试的话，那么 CSS 渐变一定是必考内容。我们先从最简单的线性渐变学起。</p>\n<h2 id="深入了解-linear-gradient-线性渐变"><a href="#%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3-linear-gradient-%E7%BA%BF%E6%80%A7%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入了解 linear-gradient() 线性渐变</h2>\n<p>我们从最简单的表示自上而下、从白色到天蓝色的渐变的语法开始：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58274479602458150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white, skyblue);`, `58274479602458150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果渐变方向是自上而下的，就无须专门指定角度，所以在所有线性渐变语法中，to bottom 一定是多余的，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74099062902129460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* to bottom 是多余的 */\nlinear-gradient(to bottom, white, skyblue);`, `74099062902129460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* to bottom 是多余的 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>to bottom<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果是其他渐变方向，则需要专门指定。渐变的方向共有两种表示方法，一种是使用关键字 to 加方位值，另一种是直接使用角度值，示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78548573231930870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用关键字 to 表示渐变方向 */\nlinear-gradient(to right, white, skyblue);\nlinear-gradient(to right bottom, white, skyblue);\n/* 使用角度值表示渐变方向 */\nlinear-gradient(45deg, white, skyblue);\nlinear-gradient(0.25turn, white, skyblue);`, `78548573231930870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 使用关键字 to 表示渐变方向 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right bottom<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 使用角度值表示渐变方向 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>45deg<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>0.25turn<span class="token punctuation">,</span> white<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>日常开发更多使用 <code class="language-text">to 方位值</code> 表示法，一方面是因为语义清晰，容易理解与记忆；另一方面是因为项目中的渐变效果要么是对角渐变，要么就是水平或垂直渐变，更适合使用 <code class="language-text">to 方位值</code> 表示法，这种方法实现的渐变不会受到元素的尺寸限制，适用性更广，也无须专门计算角度。例如，使用 CSS 渐变绘制两条对角线来表示没有数据的时候的占位效果，此时只有使用 <code class="language-text">to 方位值</code> 表示法才能适配任意尺寸，CSS 代码示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44308539280384890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img:not([src]) {\n   background-color: #eee;\n   background-image: linear-gradient(\n         to right bottom,\n         transparent calc(50% - 1px),\n         #ccc calc(50% - 1px),\n         #ccc,\n         transparent calc(50% + 1px)\n      ), linear-gradient(to top right, transparent calc(50% - 1px), #ccc calc(50% - 1px), #ccc, transparent calc(50% +\n                  1px));\n}`, `44308539280384890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img:not([src])</span> <span class="token punctuation">{</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>\n         to right bottom<span class="token punctuation">,</span>\n         transparent <span class="token function">calc</span><span class="token punctuation">(</span>50% - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span>\n         #ccc <span class="token function">calc</span><span class="token punctuation">(</span>50% - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span>\n         #ccc<span class="token punctuation">,</span>\n         transparent <span class="token function">calc</span><span class="token punctuation">(</span>50% + 1px<span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to top right<span class="token punctuation">,</span> transparent <span class="token function">calc</span><span class="token punctuation">(</span>50% - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span> #ccc <span class="token function">calc</span><span class="token punctuation">(</span>50% - 1px<span class="token punctuation">)</span><span class="token punctuation">,</span> #ccc<span class="token punctuation">,</span> transparent <span class="token function">calc</span><span class="token punctuation">(</span>50% +\n                  1px<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，无论元素的尺寸是多少，对角线都有符合预期的表现，如图 5-1 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-4767d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.995337995338%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAAvklEQVQY012QAQ6CMAxFd/9zGTLIFFGJAkG8gWwDDNsCljXWhh8Cf+1/a4Mwxlhrh2GwTHiEltY6hLAsC69TWGAISyR+EcJQ5GPAgxGUxt7uLg4Tj+QfxpyO4lvsYDj2fU8BwffcbcHhcRwxQ2aD41/ZHvjicBP1/sk5BzwMBE+rYUbM8+yivPeY81EhCgyMXdeVFxGBt8BeVTfP7jVNn1NeVFXTtt25uCYySzN1SKQ65pdbKVMlM3V/1JBH6gshScYDLjmCNQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 09 41 19" title="" data-src="/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-fee1c.png" data-srcset="/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-a67b7.png 200w,\n/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-0b187.png 400w,\n/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-fee1c.png 800w,\n/static/2022-02-14-09-41-19-46ae267a6d499ab5fcaf9e52fc153405-4767d.png 858w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/qgd68x?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>下面着重讲一讲不少人会比较困惑的角度值表示法。先看代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49905447946296540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   width: 300px;\n   height: 150px;\n   border: solid deepskyblue;\n   background-image: linear-gradient(45deg, skyblue, white);\n}`, `49905447946296540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>45deg<span class="token punctuation">,</span> skyblue<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>请问这段代码中的 45deg 表示的渐变起始方向是左上角、右上角、左下角还是右下角呢？正确答案是：45deg 表示的渐变的起始方向是左下角。上面代码对应的效果如图 5-2 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-54e16.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 599px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.93656093489148%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACNElEQVQoz13R7UvbQBwH8PzdezfGkL3YhrAHxybomJMpU1CpYzoFFXVuamub58e2adM2TXLJPeQuSZOdrWVjx4/jXtyH+/I9YckgNQvsO/FhJzl24VkP/vTQ9RA3fCyOiRamFqCdhHqQjUkGaI5YkWZFVU5MXAqvdPzVAFtWsuMktTb83kU/XHTSx+cDfDUiN37aDKgUUR0wO2FdlHkkH5GcsKIFS2FRw1+0aMOIt61410727z087qHTProY4F8jUvfTVpAqETUAc5LM5R7nkObNZCK81PCaGn7WweY//mDmPXT5n4+ZA7MuzMI0r8cT4bmCVuTgoxqtz/2e89efefhyQOaezrwNsxHOrkEhPJPRezFYViLu+fsP+bnvzPN7eJb/lvuQyhHVAOtBdhUVwoKE3jbH78SQ+1U1Wpv6LSue9wePpv1dePhqeN/fHe8vpE5Mz4NcWBDhmzt/qRUsS+GqEq6p0YYOtkywY8c1JznoJEcuPO2hSw/9HuJbnzTHqRykbZBecPyohR7fBE/q4dN68OwufCGCRRG8lsCSAj5o8YqefDLhug03HbTdRrtdXHPJgUdPhnR3kAsSKhvJhPcup5WEK/57Eqk0Wqnz4Wd9uhvsYRRUyqg0SSlU01XkuS5J436vZCwcDjum4fd7tqa5tm0osqkoXcsUG422YViqWmTZTAlFWZZVRVkmypo38lOWjcPI7Q/2vh3eNJqW02nJiqRoLVmVNd2wHUUz+GVOJlX1B/8wd5O68xLJAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 09 56 39" title="" data-src="/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-54e16.png" data-srcset="/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-e3250.png 200w,\n/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-a3cce.png 400w,\n/static/2022-02-14-09-56-39-a2adbdeec0c275a6f5b1c33c605966e3-54e16.png 599w" data-sizes="(max-width: 599px) 100vw, 599px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这个问题回答错了不怪大家，因为 CSS 渐变中的角度值表示的方向和常见的各种设计软件中的渐变的角度值表示的方向不一样。</p>\n<p>假设有一个圆盘，圆盘有一个中心点，以这个中心点为起点创建一个指针，在各类设计软件（如 Adobe Photoshop 或者 Keynote）中，指针水平向右表示渐变角度是 0 度，逆时针旋转表示角度值递增，因此指针垂直朝上表示 90 度。图 5-3 所示的是 Adobe Photoshop 软件中渐变方位值和角度值之间的关系，可以看到垂直朝上是 90 度，朝右上方是 45 度，朝右下方是 −45 度。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-2936c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAA20lEQVQY042QjW6EIBCEff+nu/aEepxtAeGwxB9YQKuJ2jWXNE1q05vAssPmyxCy7YfWdcUKAJRSpbSU0n5YrXXf99uRst+w954QUlWVEMIYg03XdY/CzrnT00lIyTlHGPObpvme/p+Mz0bmnoy1bdtHk0MIjDFj6ro21lo8APwxPM/zNE0QwjCMKQ0J97g3MQ4x7Q5HEKL3gCvGNI6fIUSAgDbzENquZ+Wrvhmlb1xIpTUhxTuXWu83OS2ez+ScU1pcistVVupavhE0rMy2P7QsS05enPOHX3XXF8eIyRD+oetCAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 09 59 06" title="" data-src="/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-fee1c.png" data-srcset="/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-a67b7.png 200w,\n/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-0b187.png 400w,\n/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-fee1c.png 800w,\n/static/2022-02-14-09-59-06-52c63f3b098a4e0b636fe8a82a49e063-2936c.png 850w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>CSS 中有着截然不同的渐变角度和渐变方位关系，规范中对此有专门的描述：</p>\n<p>using angles</p>\n<p>For the purpose of this argument, “0deg” points upward, andpositive angles represent clockwise rotation, so “90deg” pointtoward the right.（在这个参数中，0deg 表示向上，顺时针旋转是正角度，所以 90deg 表示向右。）</p>\n<p>为了便于读者理解，我整理了一个常规渐变和 CSS 渐变角度方位关系对比表，参见表 5-1。</p>\n<table>\n<thead>\n<tr>\n<th align="left">角度</th>\n<th align="left">常规渐变</th>\n<th align="left">css 渐变</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">0 度</td>\n<td align="left">向右</td>\n<td align="left">向上</td>\n</tr>\n<tr>\n<td align="left">正角度</td>\n<td align="left">逆时针</td>\n<td align="left">顺时针</td>\n</tr>\n</tbody>\n</table>\n<p>借助图 5-2 所示的效果，我们可以把 CSS 渐变角度和方位关系标注一下，图 5-4 所示的箭头指向的位置就是 CSS 渐变中 45deg 渐变和 −45deg 渐变角度示意。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-08a1b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 657px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.404870624048705%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABsUlEQVQoz31SXXOaQBT1/z/1tU+d6UMb03bamJhJFdRojLIgEBAlRr4XlBCRhAJKZLcb86I26Zm9D7vnnnvvnLslvIvnZ+z76OmpyDJsmIkghgAg10UEeY5XK7yP0t5tvcZRhGUJ0RQeymm/l7IA8zymKGzb2DRfqr8rJr3X+V2H1b+fec3ubQdonX5YawTn9WiiE5ZM8Lb4lYgteHpyRdcAf1QdfKsq5ROPavvCcNbjcJahd8dGKF1lkL8pf7n4dfy7XmlWPnykP32V6atRraWeU/PpNIrj3f6HnSPd+nzUKP+4rFa6Zz8b9GlLajBKi5leMksIw8fHt8V4+7T6k7C1HtvkpLbA1bsCda31pWmbnYnjl5T/uf1a0p+jAUc8zwCTAYBFAYsiThL0r2HoAEWxQWgTBHg8jgGIGQZrWpGkBVEWRUECbWOLw1XtYpPnm/3FHn4S3TCD4CFN08UitGyHHAe6nje7vw/c2dy0HNf1omUEofewWBDWMO07TbcdaBhWSbyR575PxJbjqOpEkhWdKKAnD0e9PisNFfV2EoZL07QByzPsQBmpLMeP1QlJ+AuWiZX6dwgGQAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 10 49 50" title="" data-src="/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-08a1b.png" data-srcset="/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-45750.png 200w,\n/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-c4772.png 400w,\n/static/2022-02-14-10-49-50-4b3340a3d610d69d3d410cc7fa0d3e3c-08a1b.png 657w" data-sizes="(max-width: 657px) 100vw, 657px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>从图 5-4 中可以明显看出，45deg 渐变的方向是自左下方而来、往右上方而去的，图 5-2 所示的渐变角度也就一目了然了。</p>\n<p>另外，如果渐变角度是 0deg，不建议简写成 0。例如，linear-gradient(0, skyblue, white) 这样的写法是不推荐的，因为 IE 浏览器和 Edge 浏览器会认为这是不合法的。</p>\n<h3 id="渐变的起点和终点"><a href="#%E6%B8%90%E5%8F%98%E7%9A%84%E8%B5%B7%E7%82%B9%E5%92%8C%E7%BB%88%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渐变的起点和终点</h3>\n<p>明白了 CSS 线性渐变的角度值对应的方位，再弄清楚线性渐变的起点和终点的位置，理解线性渐变渲染表现就不成问题了。下面举例说明。例如，想一下下面的 CSS 渐变中 skyblue 100px 200px 对应的起止位置在哪里：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58428483530550630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   width: 300px;\n   height: 150px;\n   border: solid deepskyblue;\n   background-image: linear-gradient(45deg, white 100px, skyblue 100px 200px, white 200px);\n}`, `58428483530550630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>45deg<span class="token punctuation">,</span> white 100px<span class="token punctuation">,</span> skyblue 100px 200px<span class="token punctuation">,</span> white 200px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个 100px 的起点位置不是从端点开始的，也不是从元素的某一条边开始的，而是沿着渐变角度所在直线的垂直线开始的，该垂直线就是图 5-5 所示的虚线。因此，最终的线性渐变效果如图 5-6 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-cb87a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 424px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 141.7452830188679%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAAsSAAALEgHS3X78AAAD9klEQVQ4y41UW3PbRBTWL+aB4dLSuiEpjd2E6fDA8AAP4JkGptALyTAhpEBpkzCpLcmW7fgi25JlR7Ys2ZJW1sWWpV12V7ITSpnpzjdnzkr77Tl7zrfLoNWAEMX/AUTYYoNms5k2nWInwl+jCC0W2DLoHQak/Mpx42SvgWwt7g+QICDTvCLPImgv0RrWEn8hjrmAFv6rG/aPB+Vyp6OOyHY4OISEHJN90c/DxWbZ/Lxm71St3aq1LVjfis4wgBpCqqpPXpe0ZYTz/qOr9UZjyoIMTHJCSArQkeJsFMY5dpzljBynb7H6L8M5nFqI59BySZfBwQJJQ03X8J6IWR+p6xPneBQ8OBTyP/z5MH+U33u+c9Q6PPg6DANSKrpM9qEXo4k+VlWVcV03XC4TckQ3f96fbZ0qD7jxzncv3su8v1n8fV8JYZwmqATIJesgcBzGcZyeouCgmIwzI0sg/FUPd18OvnqYv332zZ1C7aPTxhPJSkrTC5AXkXTTtG0A+ooiBTBO2o2HCQ6fZTOn+1vs5Y1XLz9+dZw57+3LM/xbmePIaf+Y5MAuAEd1ZbiIcR+A7onHe2Xt/KmKNnl7u+JuC+49wbrJTp4pXsVNIpPQTNo0hDQLlJXL2dAWf8v/LT2uWaOGOdCCOel5CC3afGNBtABX0mBQGKJSCUoycibDE/Fp/tHQOAkRlCati7HgzAENAt+qPIYcMgjwFjGNPwVAVbXrwowpVgOtqo7Sgr0x5vN5HMfvonlmHaHZaktyz7Jsz/d7Sr/RFEtCtSm2axeNVqvT7khC9aIldiu1ekRzvBYZQkWWx8NR4HmB749Ho54kd8S23JWajWa/p+DpRa1+2R/IkhxF8RUZLKG5RC6+OhDZEQFuKJ4uEPIoXAqfWg+SCwdozZkQoi87wYfF6S3evMGZN/kUHxSn3/d8eY6aLmz7SPSh6BG0PKLFFxbpNoP3qM/gQdfeKGi7vJHj9QRZbDm9MglSKa7rT23LIzpjcNNbPpk/6oCNon6/ZGzzBFneuMcZm6xeNHx6pQiNvEqUXF+Tmx6Z41vxUxd8SvlZSs5Re5fVOcpPLkYSuXEV2Uu/4hv7uEvi567zOQO/CmzC/z9ysjHmP6Hxc2/E53RWT/P/FzlJO6Z8LL5lDHH+dwq4Zlfnx5acn/LfcubrJcUC3pfAXXZ8f1V84nDGZ6zOU34zIYMwOrNiyYdt3EY3btNmtr247kRf1MEtzszw09sUGZ74n3DTv8bzEws6IX30A4hARIAF5MQEs0Rb2IdUXjBFojZAHSJPliu1RRFYtmPbQqmMVT01jFq1VnhdMCeT0aVaq1Qb9XpVqJS4EvbxL7bIdsTO6dn5P8Tl+Ewlt4qOAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 10 56 15" title="" data-src="/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-cb87a.png" data-srcset="/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-24421.png 200w,\n/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-e4320.png 400w,\n/static/2022-02-14-10-56-15-6e48d95414d87a1b3c6e0cdffb5a1b66-cb87a.png 424w" data-sizes="(max-width: 424px) 100vw, 424px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果渐变断点中出现了百分比值，那么这个百分比值就是相对渐变的起点到终点的这段距离计算的。</p>\n<h3 id="关于渐变断点"><a href="#%E5%85%B3%E4%BA%8E%E6%B8%90%E5%8F%98%E6%96%AD%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于渐变断点</h3>\n<p><code class="language-text">&lt;color-stop-list&gt;</code> 数据类型也就是我们常说的渐变断点，包括众多你可能不知道的细节知识，这些细节知识对所有渐变类型均适用。</p>\n<ol>\n<li>\n<p>渐变断点至少有 2 个颜色值，因此下面这种写法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3750000035703160300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nlinear-gradient(white);`, `3750000035703160300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>断点语法中的颜色值和位置值的前后顺序是有要求的，位置值必须在颜色值的后面，因此下面这种写法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95824736231450980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nlinear-gradient(white, 50% skyblue);`, `95824736231450980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> 50% skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>需要使用下面这种写法才可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39532262376230070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nlinear-gradient(white, skyblue 50%);`, `39532262376230070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> skyblue 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>没有指定具体断点位置的时候，各个渐变颜色所形成的色块大小是自动等分的。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72664793962716900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(red, orange, yellow, green);`, `72664793962716900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>red<span class="token punctuation">,</span> orange<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，red、orange、yellow、green 这 4 种颜色形成了 3 个渐变色块，因此等同于下面的写法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35951531200164700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(red 0%, orange 33.33%, yellow 66.66%, green 100%);`, `35951531200164700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>red 0%<span class="token punctuation">,</span> orange 33.33%<span class="token punctuation">,</span> yellow 66.66%<span class="token punctuation">,</span> green 100%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>如果起点和终点的颜色与相邻断点的颜色值一样，则起点色值和终点色值是可以省略的。例如 25% ～ 75% 的渐变效果，不少人是这么写的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35246917896135830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white, white 25%, skyblue 75%, skyblue);`, `35246917896135830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> white 25%<span class="token punctuation">,</span> skyblue 75%<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其实前后两个色值可以不用写，直接用下面的 CSS 代码即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97606587615697030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white 25%, skyblue 75%);`, `97606587615697030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white 25%<span class="token punctuation">,</span> skyblue 75%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>渐变的断点位置可以是负数，也可以大于 100%。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49862851080485134000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white -50%, skyblue, white 110%)`, `49862851080485134000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white -50%<span class="token punctuation">,</span> skyblue<span class="token punctuation">,</span> white 110%<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>在同一个渐变中，不同类型的断点位置值是可以同时使用的。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92566210306505130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white 100px, skyblue 50%);`, `92566210306505130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white 100px<span class="token punctuation">,</span> skyblue 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时，如果渐变范围小于 200px，假设是 160px，则白色的位置（100px）反而会比天蓝色的位置（50% × 160px）靠后，不符合渐变逻辑，那么究竟该如何渲染呢？继续往下看。</p>\n</li>\n<li>\n<p>当存在多个渐变断点的时候，前面的渐变断点设置的位置值有时候比后面的渐变断点设置的位置值要大，这时后面的渐变断点位置值会按照前面的断点位置值计算。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81208841568890850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(skyblue 20px, white 0px, skyblue 40px);`, `81208841568890850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>skyblue 20px<span class="token punctuation">,</span> white 0px<span class="token punctuation">,</span> skyblue 40px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>会按照下面的语法渲染：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87167048857086200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(skyblue 20px, white 20px, skyblue 40px);`, `87167048857086200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>skyblue 20px<span class="token punctuation">,</span> white 20px<span class="token punctuation">,</span> skyblue 40px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>渐变断点还支持一次性设置两个位置值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78857031866627490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white 40%, skyblue 40% 60%, white 50%);`, `78857031866627490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white 40%<span class="token punctuation">,</span> skyblue 40% 60%<span class="token punctuation">,</span> white 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示 40%～ 60% 这个范围内的颜色都是天蓝色。需要注意的是，这个语法是新语法，IE 浏览器和 Edge 浏览器是不支持的，其他现代浏览器也刚支持没多久，因此，建议大家在生产环境中还是使用传统语法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55102540856104755000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white 40%, skyblue 40%, skyblue 60%, white 50%);`, `55102540856104755000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white 40%<span class="token punctuation">,</span> skyblue 40%<span class="token punctuation">,</span> skyblue 60%<span class="token punctuation">,</span> white 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>除渐变断点之外，我们还可以设置颜色的转换点位置，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77314818006118900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(white, 70%, skyblue);`, `77314818006118900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> 70%<span class="token punctuation">,</span> skyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示白色和天蓝色渐变的中心转换点位置在 70% 这里，上面代码的效果如图 5-7 所示。该方法可以用来模拟更符合真实世界的立体效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-11-29-57-4e609b95d9ce6db64b30af16525a8500-d9a94.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 386px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.76683937823834%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABUUlEQVQoz5WSTU/CQBCG968b5Wb8DyZelMSDNzRo8COhQOkHJSAQRCSBVJZ2t9122+3sukW9t5Mnb96ZvHOaQe2D6hFl1KcTKGQQqRToUrIqUquCKQP0FkguIMyBVobkwAQ4FNDLAVhWHHgRVEaHKS8sAugJA07yLRO7yuiwz0Q/ANTyi1XI52G2qMMyzJ73At1tc9tnAz8x6zD0WWuXoetN1l7T+6/ooRZrertJ0eUqbc6C5jysxc0suFoydDFLTof7ho3P7IOmodXCJWV71NLj/yE+ZvDJEJ9PY7Rg0iKFx6QXKzeSbgSjWI5i9aeRnsujlx4rW53RRt/pPQakjpUQwiMKOYdCZDHNIiKSuNSUcRrmLBIxTcNAsAh4kpDwdwsVoN9Tuc7IGDi7b8xS/rH6dMcTy/YeO6+ON+n2h13THNiO0Tf7tmu5455p6xX9pT8ENMCin8Y7YgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 11 29 57" title="" data-src="/static/2022-02-14-11-29-57-4e609b95d9ce6db64b30af16525a8500-d9a94.png" data-srcset="/static/2022-02-14-11-29-57-4e609b95d9ce6db64b30af16525a8500-300a8.png 200w,\n/static/2022-02-14-11-29-57-4e609b95d9ce6db64b30af16525a8500-d9a94.png 386w" data-sizes="(max-width: 386px) 100vw, 386px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>需要注意的是，IE 浏览器是不支持这个语法的，因此，在生产环境中要谨慎使用。</p>\n</li>\n<li>\n<p>如果不是高清显示器，则在 Chrome 浏览器中，不同颜色位于同一断点位置的时候，两个颜色连接处可能会有明显的锯齿。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11552263741176770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(30deg, red 50%, skyblue 50%);`, `11552263741176770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>30deg<span class="token punctuation">,</span> red 50%<span class="token punctuation">,</span> skyblue 50%<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>  锯齿效果如图 5-8 所示。</p>\n<p>  <html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-d9352.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.585730724971235%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABvUlEQVQY02O4HBi9r6Ch5cqnuvt/2y6+a7/wru3SeyBqv/y+7vy7Q69/f/vxe9Kd7713f0y7+HrK5bfIiOGptuF/BobnGrorpqxsvPG96drXztMv2s++7Dj3quHE890f/v+/ce2yX+TUdSdq7v1tvvi+7fSL1rOvIYjhiZ4pUPM/JiYgecvBc/aaow23f7Ve+tB15mXDyed7wJr/sbP94uA4mlLYd/geULb93OuOs6+AJMMzIwuQZk7O/+xsQMYfbp4zyQWTj9xru/+n9fzb/R///7957R8X5z8GBqDsDynpAw39k88+77vyfsL5Vwy3NQ1/MjB8YWL6CiQZGL4zMgLVvRIQXZpdm7vm5NoHH96dOXNBXvusiMJZSdXLvBJXOYU3u4SXrruYcuYTw+Md+1+vWPNq1Xogerly3YuV656v2fRmyYrnM+fs2nlo74Vrxy9cmXzry9QHv6fe/znl4e+pj//OufZ+xt1vk5/+Z/iPG/z78/vrxw9fPn0EMrAqYPj35w8Q/f0Nkn788OH16zdfPn9x9vTZEydOXbx09dqNW+cvXj5x+vzx0+dOnbtw8+4DoLJff//9/vcfiABHuFfyBzNmFQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 11 37 08" title="" data-src="/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-fee1c.png" data-srcset="/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-a67b7.png 200w,\n/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-0b187.png 400w,\n/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-fee1c.png 800w,\n/static/2022-02-14-11-37-08-ca3f1a7f32a37ce2e660b4772f13b22e-d9352.png 869w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>  此时，可以在颜色连接处留 1px 的过渡区间，优化视觉表现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18773354157336720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(30deg, red 50%, skyblue calc(50% + lpx));`, `18773354157336720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>30deg<span class="token punctuation">,</span> red 50%<span class="token punctuation">,</span> skyblue <span class="token function">calc</span><span class="token punctuation">(</span>50% + lpx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>  优化后的效果如图 5-9 所示。</p>\n<p>  <html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-01cf0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.404352806414664%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABxklEQVQY03WLzWvTYBzHn3XIcINefNm8DAaibFePetL/w5MnX/CwXQYinW1ZaRFfdpgyU9jarXTKXthAZQcRqaNbmiZPkm6mraUM2zxJTJOshaZpnsdn4HU/vnz5wu/zAblHs3HZelHHcdFKwFZcsmgSkhUWWp+RR9rtbL768gQvHjvvReOdbNIsyuZSyaw7PUAAQNcnP75KzR115kqd2KE6z6IYp4XyzS3UJ39O7JtTX588jxb0Z4obZbUoi8IFfZ7TFcs9k/HgIO3q7XtM5ltIcSOiHWfV0IG6TeVmwx8do1/txtSn1+mI7ISP2jEWJYp6+b88PEKGhujwLw5z9x8ufC9Ha36EN3c1n8p49OoZEwjQbty5m13bS5Tst9D4bXcBBsANBHoAdAHwBgYoYY8ENx7MTK/vr1atdqUiT94SgtfglQl4aVy5EISXx5nHkae5Jmx5QE+mtVQWLWfQ8hpayTTS6zqzor5Z2Nv8ssNKB4VismQw5dMPis0ozlKlk1ScFN9k6m6tSwA577DfcayW+bfv9c5DAO55BBNDRZAXDVUTeTH3Y1+GEseLBV6AkiyIx0Uo/8yzh5zwq1qjjufjPqYS+Qex8FvHHbxAJQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 14 11 55 20" title="" data-src="/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-fee1c.png" data-srcset="/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-a67b7.png 200w,\n/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-0b187.png 400w,\n/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-fee1c.png 800w,\n/static/2022-02-14-11-55-20-42531e43f52db7fcf4a187a0a1045641-01cf0.png 873w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ol>\n<h3 id="渐变与动画"><a href="#%E6%B8%90%E5%8F%98%E4%B8%8E%E5%8A%A8%E7%94%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渐变与动画</h3>\n<p>CSS 渐变中虽然有很多数值，例如角度值、断点位置值等，但是很遗憾，CSS 渐变本质上是一个 <code class="language-text">&lt;image&gt;</code> 图像，因此无法使用 transition 属性实现过渡效果，也无法使用 animation 属性实现动画效果。虽然我们无法直接让渐变背景不停地旋转，但是有间接的方法可以实现 CSS 渐变的动画效果，这个在最后有介绍，这里就不展开了。</p>\n<h2 id="深入了解-radial-gradient-径向渐变"><a href="#%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3-radial-gradient-%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入了解 radial-gradient() 径向渐变</h2>\n<p>径向渐变指的是从一个中心点向四周扩散的渐变效果，光的扩散、波的扩散等都有径向渐变的特性。</p>\n<p>在 CSS 中，使用 radial-gradient() 函数表示径向渐变，其语法比较复杂，所以我就琢磨如何让大家比较容易地学习径向渐变的语法。最后我决定通过一个接一个的案例带领大家深入径向渐变的语法，因为每个案例都有对应的效果示意，更加直观，自然更加轻松易懂。</p>\n<p>学习这些案例还有一个好处，那就是非常实用。因为本节的径向渐变案例覆盖了几乎所有常见的径向渐变应用场景，所以如果大家在项目中需要使用径向渐变，但又记不清径向渐变的语法细节，就可以翻到本节，找个案例套用一下，就可以实现了。</p>\n<p>接下来介绍的这些案例，如果没有专门说明，径向渐变效果就都是作为 background-image 的属性值呈现的。</p>\n<h3 id="最简单的径向渐变语法"><a href="#%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最简单的径向渐变语法</h3>\n<p>先从最简单的径向渐变说起，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92972001913602260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   width: 300px;\n   height: 150px;\n   background-image: radial-gradient(white, deepskyblue);\n}`, `92972001913602260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-10 所示，是一个椭圆渐变效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-e07da.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 611px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.53846153846154%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACE0lEQVQoz02S2WsTURTG55/Rt7747oIPYooIBjesWKu2aFtxV0yfFKzg8qLg/iA+iPrsAiouILjEpM0ymcxkUtqYVMcmaRPNYmrn5zlTKw7fw3fvPd893z3fGNtNVkRZN87GJNtMdmXoz3LA5qDDoZxCyKCjm70ZLZAyKRbJ1jTGhiTLPrAyzvoEm9P0Wuy3VXPC5VReIeRwTq+Toy1pQglWxVXSncDos1g7xg6TgSzHXc5McrnAtSJ3prn7VSFElrJ5dpKTrl7dY6pEjBjDDptSDNpE8lyY4maJBx6Py7yq8m5O8brKkzIPPW5Pc7GgZUMO4RRDNsYxV9tKz3OTXC9p0Ysq0TpuE+8XXod8k1idl1UefedGidEp7d+T4UguEAv7Ky6q+HmFaA23xUyHcoeJ1pLYU1+jgfmdi+LhRQ8OkQm1fSto/rTCm1ne1xRvZ3lW0bby+EsFRiYY/md7X1ZHLwnJs0/n9eIrX/R5975xP4AQWV4tcn6KkbwqZewi2WsFUS3/qNOX0Ut0MnxJVSxJSJEAQo66am2PpTlL2eq4SrqTGJJtV5Q1Y4TG/XDKl+Httvx+a2HQ9ocCCBnI+n0ZOdKCUMKXnLo+EZafpP6b2Xlq8zThxwI/fUUbWkto/oeGTwNqgUSEBsHXbrdSieRcpVytVGc8L/Y5lrNsR2DbuawjxLYsM5kWYplmsyH34Pv+H7z+Q05S0SLhAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 19 56" title="" data-src="/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-e07da.png" data-srcset="/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-20936.png 200w,\n/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-da2be.png 400w,\n/static/2022-02-16-11-19-56-4d148cacbfdf2eb01fa45d035876388f-e07da.png 611w" data-sizes="(max-width: 611px) 100vw, 611px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>从图 5-10 可以看出，径向渐变的方向是由中心往外部的，默认终止于元素的边框内边缘，如图 5-11 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-5e5c6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.49707602339181%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACOElEQVQoz1WS30tTYRzG/Qu67bLb7oNu7KbL8iKkiDCiCBMkg0iyEgqKKAKJIKgLTa1gGBb+CgdhZKXI3Fw7a3r8sbYz9Wxsc+qOOzubZ+/76d0mQV94Xr4vL+/D8zzfbwOq8q7klAZNCi1amWuazY1wgc6wRZe2S1dom9uqv6lZtGsFLmsO538LGoMwmBSKQVKR6pSShupl14XjfsGJGYuzAZvWxQqda5IHcXiyAU8VHqn+XhSuL7lcDDk0zVkc/VnidYpauRVFLESVECyl8Jx/jysRl+4YPF+HtynJ+BZMJPKMxnJ48zCUg1dpeLgJHQnlaCZLfyDMdi6rZFFDnbC0z6VggY41pcaQDCQl3qxAL8P3VYM3vf2Yi3/w+5bwzuq8n9Z5MbVMx5jO3Z4ViqEQ0udDfps+ICxXaAns0a4IH8clvaZkLCPw2RAJRPCPetHNXb6aNh9iBV4u73Ffd7gz/AvPoArSKSIyGWTcUIRSsFMWnPHbXFgocKtKaihrytY7Ze+zvsUXPcuQCr8vAz0mdKv3tmVB85TJyEo1REGlHiUNES3E9HyQwwMLHPkYpXGuyOl5Ra7tczWsJr4iaVuF1oiKRSvRHCxxctbi2A+LQzPwzDwYipD1KTu2zU7Bptdw6Ntw8ShVn9KCkc0i46bDZLLIpLI6mSoxoTCS2mdYKfVk6y4C+fraiNpUZD3D/6pSJm2oHSk7uAWLZDyGGY2SMgzS6wnSCYOtjQQ5BSql2hch5b/vfwGQpXOzYACRmQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 21 55" title="" data-src="/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-fee1c.png" data-srcset="/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-a67b7.png 200w,\n/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-0b187.png 400w,\n/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-fee1c.png 800w,\n/static/2022-02-16-11-21-55-971c333df20e77180920c04ee3a386b7-5e5c6.png 855w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>所有径向渐变语法都是围绕改变径向渐变的半径值、中心点坐标，以及渐变颜色的起点和终点位置展开的。</p>\n<h3 id="设置渐变半径的大小"><a href="#%E8%AE%BE%E7%BD%AE%E6%B8%90%E5%8F%98%E5%8D%8A%E5%BE%84%E7%9A%84%E5%A4%A7%E5%B0%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置渐变半径的大小</h3>\n<p>如果希望图 5-10 所示的径向渐变的水平半径只有 50px，垂直半径还是默认大小，则可以设置 50px 50% 作为第一个参数，渐变代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12678854447967457000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(50px 50%, white, deepskyblue);`, `12678854447967457000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>50px 50%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-12 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-e5c7b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 612px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.274509803921575%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABj0lEQVQoz42Ry0pCURSGt0d7gUgCu1MQlFFhiTWrYQVNoh4jSGjWrEHvUZPoDbpooJ68YupRM49moZWFlzQa6f5b+5hgkBD8HNZe6//W/jmbbccx4cWMH9MdmvLB7IMtiKUQzHT8PSXzuBcEsvkA2AWkK7BOOdDvgS0kYJPn9+hKM5/D4gdbCIqz3gmdJskJ5kSvCxsR2NOwq9iMwugS66S2h8zsEosEWjS4xfzIgUkvdtM4fsHJK/ZUEZV1GCQNXvgTpt209TCHUA23dRw9ivDS/2ErwQ+CjH0KePn/MMWmv01pT4s4K2JfxUygS2xrSLh7rqHXZLgWN/e7saXgICu0E4dJFk1D20NmQihd16cakbESxmoYYzfQObo81VqEG92crEMyH/QItYpRmc/6+ZxfFAPUb09JwzLvc/H1CFi9iQ+OShOVBqpN1IAqF52q1iw3RN0SjWrat3UkkJXfiwklViuXvj7rz/l8NBx+ymZzmTRJTaXeCoVM6p4KNZlMKspdXElEoqlE4i6mVErlb3+56yeZ8UKWAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 32 40" title="" data-src="/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-e5c7b.png" data-srcset="/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-ec56c.png 200w,\n/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-73c25.png 400w,\n/static/2022-02-16-11-32-40-85dde8410900c56b62caacc45ae2931e-e5c7b.png 612w" data-sizes="(max-width: 612px) 100vw, 612px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果希望径向渐变的水平半径和垂直半径都是 50px，则无须设置为 50px 50px，直接设置为 50px，当作圆形径向渐变处理即可，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60807780282816570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(50px, white, deepskyblue);`, `60807780282816570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>50px<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-13 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-d67a7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 718px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.64623955431754%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQoz42QzUrDUBCF0+pGRV/AVdWNdmcRRMS1iDtfSFyJ7yGCP+BOaPPbNvGmSZMmupXa4MIqaosuXLQ5Tu5t2goKvXwZzsycQ2CkmzcsWlhmWPpN7nbA+FDYcgz+J+hJF21IMjIqpHEUXjUulNF8aLO6PHz1kqyzGjIplFmoYKuO/RAbLuaMZCJW2dTARPiSh8VIQI5tD8ctnLVx2MS6O1oNbX+ERZ0xcHCP61c8feP0GbsBpvUJwoIpDTseTlqgcxw9ojDhnweomC9js469AAUHs8b/4XO6dglZJT2sQOaoqUjnGQ4Js8PDxXesMORrCWucvJPoVcLmbSJisR3agi8ejuMYBH39PlUakaAG4vEVBh6M6bjX60kPzeij042iyA9Du+6bFlM0Q69YrucXS4qsVRvBneN5ZZPVHFer0N7WqWE1Ra/+AAaa0b6puhgxAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 34 24" title="" data-src="/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-d67a7.png" data-srcset="/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-8a0cc.png 200w,\n/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-ca50d.png 400w,\n/static/2022-02-16-11-34-24-023abacfa3b9fd6e766cf3fc6f8b71f0-d67a7.png 718w" data-sizes="(max-width: 718px) 100vw, 718px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>但是要注意，水平半径和垂直半径合写的时候，只能是长度值，不能是百分比值，也就是说下面的语法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6079297420536544000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nradial-gradient(50%, white, deepskyblue);`, `6079297420536544000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>50%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果想要使用百分比值，就必须给出两个值。例如，下面的语法就是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16864529597806620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nradial-gradient(50% 50%, white, deepskyblue);`, `16864529597806620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>50% 50%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="设置渐变中心点的位置"><a href="#%E8%AE%BE%E7%BD%AE%E6%B8%90%E5%8F%98%E4%B8%AD%E5%BF%83%E7%82%B9%E7%9A%84%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置渐变中心点的位置</h3>\n<p>如果想要改变中心点的位置，我们可以使用 <code class="language-text">at &lt;position&gt;</code> 语法。<code class="language-text">&lt;position&gt;</code> 这个数据类型在 background-position 那里已经详细介绍过了，已经忘记的读者可以翻回去再看看。</p>\n<p>例如，如果想让渐变的中心点在左上角，则下面两种写法都是可以的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96923516666912330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(100px at 0 0, white, deepskyblue);\nradial-gradient(100px at left top, white, deepskyblue);`, `96923516666912330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>100px at 0 0<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>100px at left top<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>效果如图 5-14 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-e07da.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 611px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.374795417348615%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABT0lEQVQoz42Su0oDQRSGJxtFbCwEBSFGCxEFK1GxUyxM4eUZbG0kT+AL2Aj6GhZip8Y16m4WL8leErOXJEUSCGxitSaFMPM7u0VgEZOFj5+ZM/MNM4chXz/Ie7hq46yOYwspDYsKZnNI/s98DlMSDnQQ1cNNB5dNpB3saVhQMCKCPAxC4HmH9XeQ6zYumjit4aiM7TwSEgQRsYHE+en32ODyeQMntm/uqlhWMJ4FEYcg9OW0jZSKrTyWFEw8DTdD8qGOORkzEsaykcyQvPoW9ECMaobklVdfHn1EPDJ8M8lg8wOEP5X3PZbx5xEReN5ijV95p4DpF5aUkZAx6ydLSH8IF5Mym3xm+/yTdCl6wDfz8YJxny6HBRkMQku8TkEYpVpB67hux233PM8yzbJR+jRKRdWoORW31ao6Fccym/VG1XYMTS+qulU2bdOklP4CqE3jv719hP4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 41 50" title="" data-src="/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-e07da.png" data-srcset="/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-20936.png 200w,\n/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-da2be.png 400w,\n/static/2022-02-16-11-41-50-0df4fc4ce1ffca627fe339840ca0760d-e07da.png 611w" data-sizes="(max-width: 611px) 100vw, 611px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果想让渐变的中心点在距离右边缘和下边缘 100px 的位置，则可以使用下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90672729384660830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(100px at right 100px bottom 100px, white, deepskyblue);`, `90672729384660830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>100px at right 100px bottom 100px<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-042f3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.44607843137255%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABnklEQVQoz32Q30tTURzAT6skKuw9X7SXhJJC6B/orSCEwEfxpR9PEvhUIhUUvvQSQQ8RaaAPEgjik9nscgs1t8GYiWlC23S7d/dud2ObbnnXzqdzNhgG4eHzcL6c7+f744g/EnVms1xcpTfM1QZXwlyPcn+LsSQTNtMO7yyeJbi7ybUIczmtKFHUGvJbC7FAYBHR5DOdK/Sv8zzOjItR4IPL0zi31zn3lQnrX3lcyUFOGAQMjhm0mfRGdOc3aaIl8j6hIq9T3Nmka4WpzP9kZYoGxw0urzL4g5e7BPN8L/PR48UOAxt0LDFpHykrzi9xM8bwNq9S+lVVebDNjRinTd635OaHqVjtecrUAytOmpwx6QnRt8a9LYZ+6oFvrXEppNMmW2P7dWVLtZuYl4FPUhwmKNu/yAvLsvub7FqWZ00ZWJQqbTytlVpdirquQrjE8C9GEjxK8DCu0ZfG/XGSJ0lGm2FCp0X3taKaCsuy9vb2/WrlwHMruUzZsWpFT5YK1ZxbstO/Pbfs2FXP9Qu5StapFfN+0ctmMmnLdtzsX5/9qhG8oS7LAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 45 04" title="" data-src="/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-fee1c.png" data-srcset="/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-a67b7.png 200w,\n/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-0b187.png 400w,\n/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-fee1c.png 800w,\n/static/2022-02-16-11-45-04-38c2929accf3d5064f2eaed38d137fab-042f3.png 816w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="设置渐变终止点的位置"><a href="#%E8%AE%BE%E7%BD%AE%E6%B8%90%E5%8F%98%E7%BB%88%E6%AD%A2%E7%82%B9%E7%9A%84%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置渐变终止点的位置</h3>\n<p>如果渐变的中心点不在元素的中心位置，又希望渐变的结束位置在元素的某一侧边缘或某一个边角，那么渐变终止点该怎么设置呢？</p>\n<p>CSS 径向渐变语法中提供了专门的数据类型 <code class="language-text">&lt;extent-keyword&gt;</code>，该数据类型包含 4 个关键字，可以指定渐变终止点的位置，如表 5-2 所示。</p>\n<table>\n<thead>\n<tr>\n<th align="left">关键字</th>\n<th align="left">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">closest-side</td>\n<td align="left">渐变中心距离容器最近的边作为终止位置</td>\n</tr>\n<tr>\n<td align="left">closest-corner</td>\n<td align="left">渐变中心距离容器最近的角作为终止位置</td>\n</tr>\n<tr>\n<td align="left">farthest-side</td>\n<td align="left">渐变中心距离容器最远的边作为终止位置</td>\n</tr>\n<tr>\n<td align="left">farthest-corner</td>\n<td align="left">默认值，渐变中心距离容器最远的角作为终止位置</td>\n</tr>\n</tbody>\n</table>\n<p>各个关键字对应的位置如图 5-16 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-932f0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.18288393903869%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABtElEQVQoz41RTUsbURR9NLQIXXTnHyil2H9QXNid2G5EbFyEiv4AwV9QsumqhZS2dN+lP6AIGjRpKmT8mmjSiWPiJJmZTDITsJnR+cpk3unLhwmkGw8HLu/y7j33nktwBwoEdMhOSEOgIisH3OExf5YvXvgh1Q2j3W7btu26ruM4nucR9GsYPoo307/pcw5Ps5jhsCIgfuklckriTI2L7ptzxPZrDUWuVKuapqmqqus6uWYwLTjW+o5IfgYP90GSeJzGQg7fmsg08UvDdx2zJ4gW2DSU9mccgLA2DaMV/G2t7YpkO3iUBtnDkwwWC/hUtn6kpK0j47N0+4pHTOgtF9IxxmO/Fx2SpFNpRFKYSuHlKTaKQUKyv8jeZrHzgsNSfmjNWJk1YPYAYbwUkG0aSYLs9vhgD8+yYIJzPJgRLPOa/6948EbX/8qVF47stwKWzikTWcxjuYBVAe8ERP9gPocP1WHxCMT3fWadrChqtWJpcuDamPwzOuVkknS7XdM0Lcti1zOtm47fwb3R25kFw2jVtcatbdfrmlAUVZXFRk1WLsRS+UoqMZaly9IVo+O4GFwM+Ac9QAbA6pYnbAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 11 59 01" title="" data-src="/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-fee1c.png" data-srcset="/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-a67b7.png 200w,\n/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-0b187.png 400w,\n/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-fee1c.png 800w,\n/static/2022-02-16-11-59-01-3dde9f09970f78475c63448d2a0a8396-932f0.png 853w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>我们试一下，看看使用关键字 farthest-corner 的渲染效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80494071524824970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(farthest-corner circle at right 100px bottom 100px, white, deepskyblue);`, `80494071524824970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner circle at right 100px bottom 100px<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-17 所示，可以看到白色到深天蓝色的渐变一直过渡到左下角。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-284ba.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 653px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.949464012251156%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACSUlEQVQoz12RWWtTURSF75/wDyiKoL74qBbHBxEfhAqCKCgo6EMRH7QoCmJxqgPUFuxobbWCI1JxqoqK1jatTdvMSZvm3uTmZmim3jTpZM/nOcEHETabw4Fvr73W1g772D3OIR8ng9SGuaJzN0anxfM077N8z/PLxlXEM8t4EYfNlzxvMvSkeJpCq3KyapAtTva6kINOhbgUoSFGV5Leab7mcdoESkyU8ZUYmuFTjhdpWkw6LLRdY6x3IPt+D8cD1E5yXac5zpM0fTmGbYWlFsgtEp/HW6J/hrdZuhI8TFTgdf/BBi1xnqX5mGPEZmqOwhLzgvSiWmFghndZupM8SqLtrMCyV7s5FuDMJNd07knlFH1ZtWeoRGKBzCKmVJ6lv6A8P0jQLZW3j7LWwbZR9rk54uf0BHURGmNqq9cZvknPRfwlgiVFOiqeX07TaqlQta1OVg9SVQlMZl4T4uIUtwzaLCUu7UleriqxnwU+51SKPUkaTWVNkzmvHGDTiDrYAS8ngpz952DyHr0ZdbMPWTXo1TSPU7TFqTcUr20cZsUPNgyxeYQ94xys8NL55Qh3oir2ThlsUqnJ3m7RZHIzyvkwV3W0HU6xZlBIfalc7RZHfaImJM6FRV1E3DZEkyla46IjLu5bot0SzaZoiIl6Q1yYEjcMoWV+k1pSlV4iL8gvU1jGrlRxmVlBSVDmb5UqJT9tQVGgRcJhXTfsQmGuXHaNuULBiVjUNKNmJpNJJpIJK6HrUZfL43F7A4GQ3x/wev1et08+DCP6B+EeWEsrxRTzAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 12 01 04" title="" data-src="/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-284ba.png" data-srcset="/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-b5223.png 200w,\n/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-dce0f.png 400w,\n/static/2022-02-16-12-01-04-0c8b5a129f8b0246a226bb023f676973-284ba.png 653w" data-sizes="(max-width: 653px) 100vw, 653px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果图 5-17 看得不是很清晰，我们可以稍微改变下，将渐变转换点位置调整到接近渐变结束点的位置，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11850217424698894000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(farthest-corner circle at right 100px bottom 100px, white, 99%, deepskyblue);`, `11850217424698894000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner circle at right 100px bottom 100px<span class="token punctuation">,</span> white<span class="token punctuation">,</span> 99%<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时效果如图 5-18 所示，可以明显看到白色一直延伸到元素左下角位置，表明在这个例子中，farthest-corner 对应的位置就是左下角。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-c84fc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 685px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.78102189781022%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABGElEQVQoz5WRzU6DQBCAeVQfwMTwAHAUUoxXeuDkRSQSLn0B/6BdtJYgh1JaxFZ74G8hHpoWWIeiMTUhkS+7m9md+bKTXaqqKkKI67oMw0iSJIpivwVIQQHLso7jgFKWJQUTIoSQLMsQFEVBWmhSqqrqun4gm6apKMqvvG/nD02lpmmGYbTIu13bzf+Qt1uCMVmvu8mX12otDwbE98lm00VG6Pziqj7Ks84P5k6nR8cnp8IZ3+vxHMf/wB0iCAJN07Ztf8tVCT9dL595HkdxHEdAGIVhVG/SNEn3YIyTJIFUlmVNC2BR9w968LaC+tl8jp4mluXc3N4NR+PxxPIWvjtbBMv35erDfw08zzfNZ8t6GaJHGMYIfQGT5QwY8ayQ0gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 16 12 04 07" title="" data-src="/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-c84fc.png" data-srcset="/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-18514.png 200w,\n/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-82fbc.png 400w,\n/static/2022-02-16-12-04-07-161da4b77bbee27eb27896ce5348247d-c84fc.png 685w" data-sizes="(max-width: 685px) 100vw, 685px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>上面的例子中出现了一个关键字 circle，它表示一个圆。与之对应的还有一个关键字 ellipse，它表示椭圆。由于径向渐变的默认形状就是椭圆，因此，没有任何一个场景必须要使用 ellipse 关键字。</p>\n<p>circle 关键字必须要出现的场景也不多，多用在需要使用 closest-side、closest-corner、farthest-side 或者 farthest-corner 关键字的场景。</p>\n<h3 id="径向渐变中的语法细节"><a href="#%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98%E4%B8%AD%E7%9A%84%E8%AF%AD%E6%B3%95%E7%BB%86%E8%8A%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>径向渐变中的语法细节</h3>\n<p>上面这些示例已经覆盖了常见的径向渐变的语法，是时候给出径向渐变的正式语法了，再看看是否还有遗漏的细节：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83536716992354760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(\n   [\n      [ circle || <length> ] [ at <position> ]?, | [ ellipse || [ <length> | <percentage> ]{2} ] [ at <position> ]?, | [ [circle | ellipse ] || [ extent-keyword ] ] [ at <position> ]?, | at <position>,\n   ]?\n   <color-stop-list> [ , <color-stop-list> ]+\n)`, `83536716992354760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">radial-gradient(\n   [\n      [ circle || &lt;length&gt; ] [ at &lt;position&gt; ]?, | [ ellipse || [ &lt;length&gt; | &lt;percentage&gt; ]{2} ] [ at &lt;position&gt; ]?, | [ [circle | ellipse ] || [ extent-keyword ] ] [ at &lt;position&gt; ]?, | at &lt;position&gt;,\n   ]?\n   &lt;color-stop-list&gt; [ , &lt;color-stop-list&gt; ]+\n)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面说明一下具体细节。</p>\n<ol>\n<li>\n<p>从 <code class="language-text">[ circle || &lt;length&gt; ]</code> 可以看出，如果只有 1 个值，或者出现了 circle 关键字，后面的值只能是长度值，不能是百分比值，因此下面的语法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29859492007294874000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nradial-gradient(circle 50%, white, deepskyblue);`, `29859492007294874000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle 50%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>circle 关键字和 ellipse 关键字在与半径值或者 <code class="language-text">&lt;extent-keyword&gt;</code> 一起使用的时候，前后顺序是没有要求的，也就是下面的语法都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43762815611105550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nradial-gradient(50px circle, white, deepskyblue);\nradial-gradient(circle farthest-side, white, deepskyblue);`, `43762815611105550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>50px circle<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle farthest-side<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但是 <code class="language-text">at &lt;position&gt;</code> 的位置是固定的，其一定是在半径值的后面、渐变断点的前面，否则语法就不合法。例如下面的语法都是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61834305623631995000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nradial-gradient(circle, white, deepskyblue, at center);\nradial-gradient(at 50%, farthest-side, white, deepskyblue);`, `61834305623631995000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">,</span> at center<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>at 50%<span class="token punctuation">,</span> farthest-side<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>最后，如果能一眼就看出下面这些径向渐变代码的效果都是一样的，说明对径向渐变语法的学习合格了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85485825661620240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`radial-gradient(white, deepskyblue);\nradial-gradient(ellipse, white, deepskyblue);\nradial-gradient(farthest-corner, white, deepskyblue);\nradial-gradient(ellipse farthest-corner, white, deepskyblue);\nradial-gradient(at center, white, deepskyblue);\nradial-gradient(ellipse at center, white, deepskyblue);\nradial-gradient(farthest-corner at center, white, deepskyblue);\nradial-gradient(ellipse farthest-corner at center, white, deepskyblue);`, `85485825661620240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">radial-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>ellipse<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>ellipse farthest-corner<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>at center<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>ellipse at center<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner at center<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">radial-gradient</span><span class="token punctuation">(</span>ellipse farthest-corner at center<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="径向渐变在实际开发中的应用举例"><a href="#%E5%BE%84%E5%90%91%E6%B8%90%E5%8F%98%E5%9C%A8%E5%AE%9E%E9%99%85%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>径向渐变在实际开发中的应用举例</h3>\n<p>在实际项目中，径向渐变除了用来实现元素本身的渐变效果，还被用来绘制各类圆形图案。例如，给按钮增加白色高光：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98368302048690650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`button {\n   color: #fff;\n   background-color: #2a80eb;\n   background-image: radial-gradient(160% 100% at 50% 0%, hsla(0, 0%, 100%, 0.3) 50%, hsla(0, 0%, 100%, 0) 52%);\n}`, `98368302048690650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #2a80eb<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>160% 100% at 50% 0%<span class="token punctuation">,</span> <span class="token function">hsla</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0%<span class="token punctuation">,</span> 100%<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span> 50%<span class="token punctuation">,</span> <span class="token function">hsla</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0%<span class="token punctuation">,</span> 100%<span class="token punctuation">,</span> 0<span class="token punctuation">)</span> 52%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-19 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-310ee.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 415px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.554216867469876%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACPUlEQVQoz61RS08TYRSd3+AWJD6iUSu48CeYuFI3xsSFCQUVX2gimypGLBQXgmKMhNQmFinFViwILa21jaMClYSYqDtUCNY+6LS0nXamFInmeO9MlOrKGCc5Od+95977ne+O0DpWRPuEArPv33HNq6AzoCCe+wahvl/GKaeMpkEZJyvQ9Cec61xZw8z9x+x5ROa/Qjg9JOO8u4BzDwtodhW0MzPHrDHO0pmbfsZanWu954Jb12cX1yActuZw3CHjBKFluID7kRL6Xqno9Cu4N1PC3Rcq7jxXMcBnUYWV4l6xBBvVXXwko3FARsODPA705iDOrULY3JrGHksGBnMaR/vzuBVW0R1S0OyWqVGFhXbcRjuyT5dwO6ygJ6TrXcEi9nctw9CeQS1h4yUJT96WIWy5ksZuSmwlPmjLoYF2coaeZaRb9/VkccSa115QT7GRLjzUl4PRkUcj7WxvRwbb2/T+TWRs/B0N3HaVHJJQS2BhBxXsMmc018ycr+vQXeykmB0ZiOssusZ5rmVj2sANLSnUXJZQbdLB1qsJVSadOVdVqZl+zzFqKM9zvO9p4PVAETdpJ4zuZ8z6jvj8V6DaG0FF+2FZ9TsE/OdPmPu4gMRSGivlMuLJFMqraygqJcQTKcISFqMxxIil9DKiXxKIxpKaJmWyv7TP0ThiSUkfaLM7IE6+RlZKYWb2DQrKCj58moc/EIZnZAyPPV5MBIIQX07DOejC8Mg4Rn1P4Rn1wjHkxtRkBD5/CGFxShv4AzhC7jPj+4nLAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 18 11 31 31" title="" data-src="/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-310ee.png" data-srcset="/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-b3bb4.png 200w,\n/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-9106d.png 400w,\n/static/2022-02-18-11-31-31-5fa71221b0668887dd9717edea22fbe2-310ee.png 415w" data-sizes="(max-width: 415px) 100vw, 415px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>径向渐变也可以让按钮背景呈现多彩的颜色融合效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98711349140824980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`button {\n   color: #fff;\n   background-color: #2a80eb;\n   background-image: radial-gradient(farthest-side at bottom left, rgba(255, 0, 255, 0.5), transparent), radial-gradient(farthest-corner\n            at bottom right, rgba(255, 255, 50, 0.5), transparent);\n}`, `98711349140824980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #2a80eb<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-side at bottom left<span class="token punctuation">,</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">,</span> transparent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner\n            at bottom right<span class="token punctuation">,</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 50<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">,</span> transparent<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-20 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-96dff.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 494px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.797570850202426%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACi0lEQVQoz02P+y/bYRTG/Wv7cSoRZNklwkwWlpjMxOI2lrjNxDATVS3Slky0WNa5VKpal9SwatFWVctci7Yo36rbZ1+SpTvJc54n5ySf97xxiOXZvySp0Y+kfpfExi2SmjdJbvGR0rrOozY3j9tdPJE7eaZYIVWxTFrHEmmddtI7baIvkqm04T08v0MRd9cszggP8jeJL/YhKfXwsMRFfNkKkgo78VVWJJ/mia+fRdI0Q0LzFAlfzSS2mEiRmsUH77KRWd9hDGhzCqS+8fHi3TqZRW6KGzyUflmjsMlBucxBscxOcYeVQtU8BSoL77W/KNBOkdE1Kl43Kl46zOKWPwZ0LAvkZnvJz/WQl+vi+8AeRsM+cqWXEcMWKu0qPwwbDE646dU7GJxxoTTNkaMc4PW3QV51a1na3o0B15YEyjO8VGZ5qMheRV7rRdOxgVLmRtPjRi5bpEtlR62x0tozjXLIgkJnpFTdR4mmlwKNGsfedgzoXRCoS/bR8HSdxjQ39c9XqHtpoy5ngdo8C7VFk3z8ME5N9Sg1n3VUt/RTreilWq2mqq+LsgEprn1fDHiwFqU7fQdVxibKLC9dOW463jqQF9ppL1tAVjlLW90U0iYjUqkeaacOaU8/Um0vrTolrWMKdkL/ffmuoie3CIEbzgPXXIj54lTU2S2R8A1C+IrI+TUR4QpBuESIREVdEImKuoxweRP9hyHO7/dzGj4TlwKCqJvba0InIYLHAQ6PDu7z2fkZgVCQQOCI4+OTe4XD4XsPBUPiXNwFg/j9B8SN6PXYlh04nat4fX84OgowYZ7GaDYzNKJn2jLHwm8b+nETup/DTE7NYJ60YDRNMjZuZkJ0g9GM1WpnzGDiL2SPhxzx3qYqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 18 11 43 35" title="" data-src="/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-96dff.png" data-srcset="/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-1a6e9.png 200w,\n/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-b9533.png 400w,\n/static/2022-02-18-11-43-35-6fdb4e56bb36592795ca8f63c8d21a91-96dff.png 494w" data-sizes="(max-width: 494px) 100vw, 494px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>径向渐变还可以实现点击按钮的时候，出现一个圆形扩散的效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21525046739848987000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`button {\n   color: #fff;\n   background-color: #2a80eb no-repeat center;\n   background-image: radial-gradient(\n      closest-side circle,\n      rgba(255, 70, 70, 0.9),\n      rgba(255, 70, 70, 0.9) 99%,\n      rgba(255, 70, 70, 0) 100%\n   );\n   background-size: 0% 0%;\n   transition: background-size 0.2s;\n}\n\nbutton:active {\n   background-size: 250% 250%;\n}`, `21525046739848987000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #2a80eb no-repeat center<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>\n      closest-side circle<span class="token punctuation">,</span>\n      <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 0.9<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 0.9<span class="token punctuation">)</span> 99%<span class="token punctuation">,</span>\n      <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 70<span class="token punctuation">,</span> 0<span class="token punctuation">)</span> 100%\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">background-size</span><span class="token punctuation">:</span> 0% 0%<span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> background-size 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">button:active</span> <span class="token punctuation">{</span>\n   <span class="token property">background-size</span><span class="token punctuation">:</span> 250% 250%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-21 所示，这里为了方便示意，扩散的圆形使用了红色。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-08a78.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 574px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.09756097560976%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABvUlEQVQoz2P4jwf8+wci9+z5f+DA//Pn/5879//Wrf87d/6/efP/sWNAGYa/f///QaB///8CwT8o98+/P0Ald+78f/z4/6NHIMaXL/+vXv3/9u3/jx//f//O8B8/gFgOVPrgAdAwNEmGhce/Va7/1LD5c9WWH0tXXLsye+O6ZReqt34Hiaz7OPHwrx/HT/0/d/YfxCAIghnK4NT3VqjgOX/Fh9j4DfesfR5beTyy8iyMWMBX/l6k6LlO0+vnzz//B3rmHxZnMQTPeKdW/9qg6eX55lk/snLfVjR8zSl8O22Od/dz5brXDr1vXn76C3c+Fs0qta8t2l/da5/xs7b+xYy5z1q6vk6fEzrhmVLtG0f8mt0nvpUqfSFZ+7E4edUbe88HAdHHy2tbQidJ1H6UKXth1PrmxUeQZuzOnnnoa+6Kj8VrPuWs+bZyzvHrPQtWztiXv+ZL4epPeSs+tO/4/P0XOLCwxMM/SFT9wxNXQPQHmACQ3A1KCZDQfvP27eHjpx8+fv70xesvHz+dO3fh2LGTx0+ePXL89IUr10+eOXv4+MmjQJFTZ2/eun3y1JlTZ84eO3n64sXLl65cBwCbajIjgKZIKwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 18 11 46 57" title="" data-src="/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-08a78.png" data-srcset="/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-683d3.png 200w,\n/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-6bdc6.png 400w,\n/static/2022-02-18-11-46-57-d631ccb9477eadac1c5f4f2127a57818-08a78.png 574w" data-sizes="(max-width: 574px) 100vw, 574px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/khz3c4?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>径向渐变还可以用来绘制各种波形效果，例如绘制优惠券边缘的波形效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99944875061492380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;radial-wave&quot;></div>\n<style>\n   .radial-wave {\n      width: 200px;\n      height: 100px;\n      background: linear-gradient(to top, transparent 10px, red 10px) no-repeat, radial-gradient(\n            20px 15px at left 50% bottom 10px,\n            red 10px,\n            transparent 11px\n         );\n      background-size: auto, 20px 10px;\n   }\n</style>`, `99944875061492380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radial-wave<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.radial-wave</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to top<span class="token punctuation">,</span> transparent 10px<span class="token punctuation">,</span> red 10px<span class="token punctuation">)</span> no-repeat<span class="token punctuation">,</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>\n            20px 15px at left 50% bottom 10px<span class="token punctuation">,</span>\n            red 10px<span class="token punctuation">,</span>\n            transparent 11px\n         <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">background-size</span><span class="token punctuation">:</span> auto<span class="token punctuation">,</span> 20px 10px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-22 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-18-11-51-10-8c5d54dfe2bbb5fea0f8c99f6f0775c0-58792.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 385px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.18181818181818%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABLklEQVQoz6VRy2rCUBANvtbuXPsEt4L/of6EH+Af6RcIUkqTam0MUdI8xKiJ0UQhqfhEslS50ztaSleVkmE4c84wh7ncYYBGrQa5HBSLUCg8SDqTyUCrha7rlcFSKgHDQDiM+HdGIoj1Oroul5u5UsFWNAqh0IOMxXCy0fhlLpcDbA5kDvTsQB9WrUIiAdksHiyVgnQaeTKJkh7mTihSns9DPA7N5vepCC2nE9nvyW4HxyNF5JRsNuRwQL7doqR476/XcD6ji5Db5p8gBP4TjKyNfN/3XM/zPqm2rLmiqIZpOfZqOjFUVbMXznikq+rQNGayrEjSx8yay4pm2UuGFyXX9fTxZOEsqVkQBy/s60Ad9vsS13l7eua4drfXE7jOe5cXKOUF0ZiaLNuWNf0Lc+PBGza3UXIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 18 11 51 10" title="" data-src="/static/2022-02-18-11-51-10-8c5d54dfe2bbb5fea0f8c99f6f0775c0-58792.png" data-srcset="/static/2022-02-18-11-51-10-8c5d54dfe2bbb5fea0f8c99f6f0775c0-f436a.png 200w,\n/static/2022-02-18-11-51-10-8c5d54dfe2bbb5fea0f8c99f6f0775c0-58792.png 385w" data-sizes="(max-width: 385px) 100vw, 385px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/8sn1v1?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>径向渐变可以实现的图形效果非常多，就不一一举例了。总而言之，要想将径向渐变用得出神入化，一定要牢牢掌握其语法。</p>\n<h2 id="了解-conic-gradient-锥形渐变"><a href="#%E4%BA%86%E8%A7%A3-conic-gradient-%E9%94%A5%E5%BD%A2%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 conic-gradient() 锥形渐变</h2>\n<p>锥形渐变是 CSS Images Module Level 4 规范中新定义的一种渐变，也很实用，但其兼容性不太好，IE 浏览器和 Edge 浏览器并不支持，因此只适合在移动端项目和中后台项目中使用。</p>\n<p>锥形渐变的语法比径向渐变要简单不少，正式语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="701925632349764700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`conic-gradient([ from <angle> ]? [ at <position> ]?, <angular-color-stop-list>)`, `701925632349764700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">conic-gradient</span><span class="token punctuation">(</span>[ from &lt;angle> ]? [ at &lt;position> ]?<span class="token punctuation">,</span> &lt;angular-color-stop-list><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>可以看出锥形渐变由以下 3 部分组成：</p>\n<ul>\n<li>起始角度；</li>\n<li>中心位置；</li>\n<li>角渐变断点。</li>\n</ul>\n<p>其中起始角度和中心位置都是可以省略的，因此，最简单的锥形渐变用法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88727165954039970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   width: 300px;\n   height: 150px;\n   background-image: conic-gradient(white, deepskyblue);\n}`, `88727165954039970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-23 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-42e87.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.16917728852838%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACMUlEQVQozzWSSWhTURSG38KFK3cu1IU4oSI4YKWO4FyV4oCCIG7sRnSl4M6Vols3ohtRQa1IBWdxrNROSZo5L0l9ea1JQ5O0GdrmpelLS5vPc1/t5efyFv/3n/PuOdrRECfCNIU5HOJAkH0Bdvlp8LHWzacickoz5GfI1EjXSNoMTmFWMar8tdHEtMHDOjdrXKx0saKXpd0s6UJr58WIgjPTDNmYU/RXiU4SrhCqELCIT6Jt8dLgZauXzX1s6mO9h1UulvewqIPWEWbrpGwGqsqqL2A+C6+FLvB2Hzv97PAhH9skwstGD6tdLP7N8xEmZ1VBfYHpK+Mp4yrTWyZooTX62Rtgt8iv/rbRCZKUZT08zZG2ldst7gm6J+hy1CkaV1nanoB6p/1BdYsOBjkU5EiIY2HupfkxxreSun86al/QrzEVqgnWFFIS9/EwzRFO65yPctngTorHWdryvC3wscjnIl9KfC2pOJH0osmEmh3mpIOdi3IhRssfrpncTnF/mCc5Wkd5PcqbAu8KfCiqEUpQ1ziaVDujKwkmBS/GaennaoIbA9xKqs4fZhQvj/dKIvIqQhp5X6BDYGn4lFPzrP4fvtTPFYPrJjcHuZtS/INhHklElmc5XjopbaN8L6F1Os/YM4G7gtvCY+GvEqoSkdnaGDXMGoOyW7IqMww5SyY7I1PITaMxf+bm0qZZymbsipVKGImInjQMI6LHw5FEPG7EYkY0Fo/oxXxevPV6fR76B1EvTEObwQzwAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 15 53" title="" data-src="/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-fee1c.png" data-srcset="/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-a67b7.png 200w,\n/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-0b187.png 400w,\n/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-fee1c.png 800w,\n/static/2022-02-19-11-15-53-27b88bd7a4d68eda3056dedfb1057dfc-42e87.png 863w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 5-23 所示的锥形渐变渲染的关键要素如图 5-24 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-1093f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 553px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.72694394213381%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACkUlEQVQoz6WSTWgTURDHcxAUPHpRsAcpeBGlQsUiimKL2F60VBQ86FUUBUVPvaqIIIIHixhr1WKLVsS0NmkbGk2zSbqbbLJp2jRJzUebbL42yWbz0TTZzt8kggevzmHe4837zX9m3tPgXyMQNVevh4xzWFqCx0OCAIZBINCK09+rGkMWWhFvE3gj4rWIVyKG1usvAspzPu4NhqVMJisrm/XtQrmaK5SzKqQa0jVUt1vw1WXsY3DAhv0M9jLYY1Z3DQs7dJLGiIkU1VVVELNmX8i/ScsVeIpwK2BlyteaNWhurOIwi2MOHOVwhMNBfaJ9odpmx84f9CWNOmG9BpMvYovnvGXwCjlLsJeRq7eUb/rRwaHLQZ08OhZKh+fzhxxot9FuM02kqajCWyRvhYzh9GKRFmVikxVuNZ6NpRAOa24HmrKneDrpRpeleNxa6nKi04226dRTy6pX3rIqsBYwE1MYdoUNJJl4kQmkpI0kxLjmbhAnnOhxUbeAM9bS2cXyOQEDXHVgyj+o57+GlZmUOitDt17Qr0nzeRhlGArNmTXLvr+G0y70uqlvBd1GsWc2csWHZyMm7fCM9juvm3NPcuHPOXzwpXTZ7WkJBglTGUputQY2GML5htQSLnlx2aP2m2LXl9VbfjwIbj+K0stIfTSLIY845AhN5qBL05SEbxm0YGjuBRsNo1dAn4ALXvTz1Ys/xWtC5U4QjbwPI/R4Of/EndSK9C6B0STGUk0fq7ZgvdT8GyMivU/QaILG0hiPbX0MSOPB7KdQXvcrY4jmrTLZZeIK5FSIb/gCyX+eCv9hTTidkSxWNrIeC0WiuYJiMltc7iXbooN18KzTZbOxnEOws06msXG6God2lgtHNxrgb0PMidryIbZRAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 16 27" title="" data-src="/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-1093f.png" data-srcset="/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-7baba.png 200w,\n/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-2a76e.png 400w,\n/static/2022-02-19-11-16-27-b74fc2876f84f31fc0d93af9cb4c977d-1093f.png 553w" data-sizes="(max-width: 553px) 100vw, 553px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>我们可以改变起始角度和中心位置，让图 5-23 所示的锥形渐变效果发生变化，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96198966128581920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`conic-gradient(from 45deg at 25% 25%, white, deepskyblue);`, `96198966128581920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">conic-gradient</span><span class="token punctuation">(</span>from 45deg at 25% 25%<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>渐变起始角度改成 45 度，中心点位置移动到了相对元素左上角 25% 的位置，效果如图 5-25 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-4c6f5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 607px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.94398682042834%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+klEQVQoz12SS2sTURiGZ+8f8VeIK8GNaxF0IbhrF4IuBBfqQkVESEWo4AWvoNCFBalQi7bE2quZJJ3JXFJzm9xnMplbkiY58/qdk+miwsPhHIb3+d5zGGnBwpyOeQPXNFxScU7GmQyyARjgTTjuBM6YYwu6go5AulHkgfNZnM3g9DZObeBFA2OGzhFaYzRHqI9gjVATVIlhQmUI6W4JFxVcUXFZxYUcT4ZTlMU3onyS0smj9KCCqxrmDFw3cb+MFQdbHq+thCiE0AbQIxgDmFFCcZBwOID0pIp5E7cOca+EVA0fWvjmIN3HroeMj1yAfMhFKrkiaAI9SozSUws3i6Dyj6p4ZuF9C1+6WO1hw8Vvjyv++JADYQlwMBNFwhVCWqzj9l88rIAq0P5tC0sdfLXxvYd1F7/62CaFzxWZILHM6pBIohe6U8LjKlIWntfxpoXPbT6cLr/Ww08XaVFhx8Oej/1jS1YgvWzwzhReqPHJr5v42ObDl0We+v+gK/T5K5Bi1mJ3ZqEwzUnV4kWLvWrE75rxp3a81GbLHbbSZas2W3Om6z2Wdtmmy7b6bKfP9jy27zF5NnnEMGSYAEdEzKF/K0ay/geO12mMSQyJdmHgK4rq2LZjO1EYaropyzlDNw/yCm1kOavphlrQdN3I5RXdMAsFPYoGFPwHc7SAhbiBX7sAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 18 45" title="" data-src="/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-4c6f5.png" data-srcset="/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-3bd24.png 200w,\n/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-52f0c.png 400w,\n/static/2022-02-19-11-18-45-cc319597309d31cfb85ab6a5c6d62198-4c6f5.png 607w" data-sizes="(max-width: 607px) 100vw, 607px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>最后说一下角渐变断点，它的数据类型是 <code class="language-text">&lt;angular-color-stop-list&gt;</code>。角渐变断点与线性渐变和径向渐变的区别在于角渐变断点不支持长度值，支持的是角度值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37779281062345320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`conic-gradient(white, deepskyblue 45deg, white)`, `37779281062345320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue 45deg<span class="token punctuation">,</span> white<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-26 所示，可以明显看到 1 点钟方向的颜色最深。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-3e989.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 605px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.48760330578512%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACMUlEQVQoz32QSWhTURSG30ZFUSoOVKt1BMV5KIqCLsSN4kpUBBeCw8ZuxI0LCy5cuBHB6kIEJ6pViwMiKGqlthlt+jI1STOHmKYZ2qZNmra2ltzPe1+rSy8/l7M43/n/c7TwGK4RussERpF1bJyfv8hNUpxiSpCa4GmW+jD7dWqsLLOy0sZqG+vsrLejectYinSW0Edwj+AzRiTH6Z/kt6BnlOsJ9ujMakdrY3Y7czuYb6LKzEIzmgQ6hrEWsZfUCKeRQvLpCSYq/Chx3Mc8k4IXmBSw2MJSC9VGCq2rxLchvg/TPjwzRQJykdCYgp/lqDIxp4NFZpaYqbaw3EqNjRU2am1o0vDjIJ8LfCnwtUDrkJrVNoS5SHRc2Uqy1mhdJbe1s8bQWkOabHo/wIe/kvW7Ad708yrPnV6OeNmts83BZgebHGzsnNEGQ5oM/DrP2371t+R5kVNRH2VoTNOQ4FyQox4OutirU9fFzi62O9SsrQ62SLi1QHOOl3me52jK8jjDgz4ae7mZ5Gqci2FO+ZX/ITcHXOxzqsvX6ewyBmmfBnmY4UlW/ff7uNfL7ZQiG+JcjnI+qOBjXg67lf80LBfZISNIWN6mRQUWzTnRlBXKOS3upsStpLiRENfi4kpEXApVLgTF2R5xxl857RcnfeKEX91SEzCt6fev+P+rCCVNCNUfiyWisUS6L1Muj0bCEafb4/J4XR6fLxDs7vY7dXc4Eg8EQh63PxSOxhNJw0f8AdkrQWU/77/GAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 33 25" title="" data-src="/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-3e989.png" data-srcset="/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-4bd12.png 200w,\n/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-7acd9.png 400w,\n/static/2022-02-19-11-33-25-ba992e9859b64d4db0766e759f2369d5-3e989.png 605w" data-sizes="(max-width: 605px) 100vw, 605px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>需要注意的是，角渐变断点中设置的角度值是一个相对角度值，最终渲染的角度值是设置的角度值和起始角度累加的值，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45747220055291190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`conic-gradient(from 45deg, white, deepskyblue 45deg, white);`, `45747220055291190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">conic-gradient</span><span class="token punctuation">(</span>from 45deg<span class="token punctuation">,</span> white<span class="token punctuation">,</span> deepskyblue 45deg<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时 deepskyblue 实际渲染的坐标角度是 90deg（45deg + 45deg），效果如图 5-27 所示，可以明显看到 3 点钟方向的颜色最深。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-87f29.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 602px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.79401993355482%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACVElEQVQozzWSWUjUURTG/xU9hLRZtPlg0EJBFNVD1ItRj/UUFBSEUNBLGRQJlYWRlEUbRGVgi+2kD0JQtEgu48xok5rj/Gd1NkdnRscZTR3H0Zn7696R4ONwDvd+53znu1f7keBTjC9xvsZpSNA0gnEUyxjWcdyThKaITTOWYVownVWlPPqeoHaIt1G0uiFqIryL8iFK7SD1MT4P0xDHNIp1An+KWJpUlnQWz6SivY7wIMRVH2U+tI+DPA/zKsKbXAtZ1g8pIc0jdI8TTJHMKHLnGO+j3OvjkpfTLo7bKXagyelV/VQP8CzMizA1YaWnLseXCv/OMJHhW5zKIGfcHNM5aGX/H3Z3sLcLTWp+GOJxv8KTftXo6QDVYV5GkHYYRjnnUbe3W9jYRqGJNUZWtrLUQKEZTQ6828f9HKQqmd/p43aQGwHO97KpnflNCvMamdvInP/QfrK4Ba1qgMoAt4JK2M0AFX7KfWqxs26O6OzqYF0bq1rJN7DQQF4LCySaVbvlBrRHIa77qQhwza88vOyl1EOJixMODvVQ1MU2i+IXmFhhJL+VJQYWtZDXzGojmlQrTb+Sm1baqzaUZp50cDTnTVEnOyxK/FozBUbFX5bjSwlyeU26Ve4TEmVecdErLnhEiUuccmaL7eJwjzjQLfZ1ij2/xU6L2NouNreLDebserMoNIktv9DkG84IMpCGlPxGqHwGlczGdA5T/+MskkK9ogYE/QGf158YHp5MJmWu23Sn7uz1eHSbTe+x23W73WrzOl0Om8PtcDltdo/LGQ1HJPEfFI4/qBGYHG4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 36 35" title="" data-src="/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-87f29.png" data-srcset="/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-38577.png 200w,\n/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-26124.png 400w,\n/static/2022-02-19-11-36-35-dfc9df035a0c7c14c7cce27fdd7931be-87f29.png 602w" data-sizes="(max-width: 602px) 100vw, 602px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由此可见，锥形渐变中颜色断点角度值和百分比值没有什么区别，两者可以互相转换。一个完整的旋转总共 360 度， 45deg 就等同于 12.5%，因此，下面两段 CSS 代码的效果是一模一样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27300210434765427000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 下面两段语句效果一样 */\nconic-gradient(white, deepskyblue 45deg, white);\nconic-gradient(white, deepskyblue 12.5%, white);`, `27300210434765427000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 下面两段语句效果一样 */</span>\n<span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue 45deg<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> deepskyblue 12.5%<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果作为渐变转换点，角度值和百分比值也可以互相转换。例如，下面的两条语句都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44406543507585860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nconic-gradient(white, 12.5%, deepskyblue);\n/* 合法 */\nconic-gradient(white, 45deg, deepskyblue);`, `44406543507585860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> 12.5%<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/* 合法 */</span>\n<span class="token function">conic-gradient</span><span class="token punctuation">(</span>white<span class="token punctuation">,</span> 45deg<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-28 所示。由于把渐变转换点移动到了 12.5% 的位置（原来是在 50% 位置处），因此渐变的后半部分颜色就比较深。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-58f3c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 627px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.96810207336522%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACPklEQVQoz02SWWgTURSGR5Raq6WIda+1uCGiID4I9kHRgvVBQa0WFyx1waXWKohFQbG4gD67IWpVBJcX8c0HaTIzma1Js9gkTZomJsU0tS3WB1+bfN47Igg/d869M99/7pxzlE8T1AdpjNAQYUeY7WG2hdkaYktQruHffJnk/RivR3lW4MkID/M8yHN/GM8kyuMRFA+VOhUa5RplKjNUpnlReijz8vknzwvczXE9w5U0l4ZoT0m1DPBuDEX4lassMplvUG0wz8dcH1U+ZmrM0fk4LlN1Zbma4XKaiykuuGod4IOAhfEslSUmC4x/vCH5Cl3CLwrcyUmsI0XbIGeTnE5yJsnROG9/uPBsjRqLxabM/1cLhYtPqjPN+RSnkpxMcNxVa4ITCZpjvBGw8K7UqLVYakoJF6FlFsstVjs0hGmK0hzncJwjrkTOYwPsi8oSKt0FqnTqbAnUukydxQqbNQ4beqkPsTPCnn75dVOMgzGZUxiJk5cCfjUqryeSrLRZZctAYGt7We9nU0DCon+7IuzuZ2+U/VEOxDgUk9tuAT8dYbpXVqvaLZgIxM/XmPIKqxzW+dkYYHOfdBFtF1MgxqHxqxyNR3nR41+0JGhLcW5Qru1uJzqGZEtFkTszXPvGjSw3s9zKcTsne35vmK6cHB6lVCpSKoErGbv6PxZvi+IEGbjbUnGK4pR4KD2qls4ODw5lxicmVMPy6oZmOo4/6NEt1Wc4geD3/Gg0nvQHQj2qTzNt0+716IY/GLKdvj/gnxVaLctVngAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 47 07" title="" data-src="/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-58f3c.png" data-srcset="/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-a8bea.png 200w,\n/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-f4947.png 400w,\n/static/2022-02-19-11-47-07-38dcff1b82aa8b385eb7676aeb81b8e0-58f3c.png 627w" data-sizes="(max-width: 627px) 100vw, 627px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="锥形渐变的应用举例"><a href="#%E9%94%A5%E5%BD%A2%E6%B8%90%E5%8F%98%E7%9A%84%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>锥形渐变的应用举例</h3>\n<p>用锥形渐变可以非常方便地实现饼状图效果，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46540090828622810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.pie {\n   width: 150px;\n   height: 150px;\n   border-radius: 50%;\n   background: conic-gradient(yellowgreen 40%, gold 0deg 75%, deepskyblue 0deg);\n}`, `46540090828622810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.pie</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>yellowgreen 40%<span class="token punctuation">,</span> gold 0deg 75%<span class="token punctuation">,</span> deepskyblue 0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-29 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-fee7b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 547px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.87751371115174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABx0lEQVQoz3WSz0tbQRDHV1MrRehZD1JoEVTqD7BSCh6K51Joe/NUvHvqpYfixYOHQkEwirGt2v+g9tZIEvvS5r3dvMUYzTMxETQ5iIrRxh/V/THu2wdWn2YYlu8y85md2V0E103q9ZDJsSK8XBYz2VG79LF8uqlD0peMrm6EjhZOoBNLFIbAgnhvvp7CzV9oX2E/rHlxO+yV5VI+pxyF2d2YqI+dD5OBOdoVJB3Tdm/5dMPH/4e5puf3AC1AICpRBGoi4gMemLXbQ/TpOG4xNkddWPJbYZee3Nptijpt8WyLkWs1nBHy5qv9OGT3BnHr97W3vsmvzKxL/tv9VEmjo8z9SqbhLHMvtdwYtJ98pj1B3DafHazatgfDcQxWETi14CDPfy49nKDPxvEjqzRWtW2vgOpJFl/JNJLOHeHUwVrgxKn/Rh7MLPUfn21Xb/vyyvk+FF+456/UyJVaJUq57mIlffOpfbDHC5DnUPkBO+9gewjKIRB7OsD9n4QxLrRJbVpyZcKt4boiGJeMMZXBdEQhKlMplLCsXL6Qz28cHP5dXy9EY/FoZNGyqUWSJsFJO5lImBYhSZpSetEwMaG/4n9S6VXjt3kBUOFpYksp+sAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 50 20" title="" data-src="/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-fee7b.png" data-srcset="/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-9b56f.png 200w,\n/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-18701.png 400w,\n/static/2022-02-19-11-50-20-306bef24a2e7a7457d1492b455b83717-fee7b.png 547w" data-sizes="(max-width: 547px) 100vw, 547px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/b0kpx2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>其中，可能有人会以为代码部分的 <code class="language-text">gold 0deg 75%</code> 是什么新语法，其实不是的，这个语法在线性渐变那里介绍过（渐变断点第八个细节点），就是颜色值后面紧跟着的两个值表示颜色范围，另外这里 0deg 换成 0% 也是一样的效果，并非必须使用角度值。</p>\n<p>注意，重点来了！理论上，这里设置的数值应该是 40%，或者 144deg，而不是 0deg，那为何这里设置 0deg 效果也是正常的呢？至于原因，同样在线性渐变那里介绍过（渐变断点第七个细节点），后面的渐变断点位置值比前面的渐变断点位置值小的时候，后面的渐变断点的位置值会按照前面较大的渐变断点位置值渲染。于是 <code class="language-text">gold 0deg 75%</code> 这里的 0deg 就会使用 <code class="language-text">yellowgreen 40%</code> 中的 40% 位置值进行渲染，同理，<code class="language-text">deepskyblue 0deg</code> 实际是按照 <code class="language-text">deepskyblue 75%</code> 渲染的。也就是说，如果我们想要 A、B 两种渐变颜色界限分明，只要设置 B 颜色的起始位置值为 0% 就可以了，无须动脑子去计算，这算是一个 CSS 实用小技巧。</p>\n<p>图 5-30 所示是使用锥形渐变实现的基于色相和饱和度的取色盘，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15116285209577996000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.hs-wheel {\n   width: 150px;\n   height: 150px;\n   border-radius: 50%;\n   background: radial-gradient(closest-side, gray, transparent), conic-gradient(red, magenta, blue, aqua, lime, yellow, red);\n}`, `15116285209577996000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.hs-wheel</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>closest-side<span class="token punctuation">,</span> gray<span class="token punctuation">,</span> transparent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>red<span class="token punctuation">,</span> magenta<span class="token punctuation">,</span> blue<span class="token punctuation">,</span> aqua<span class="token punctuation">,</span> lime<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> red<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-94f8a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 546px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.172161172161175%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB2UlEQVQoz2P4jwb+/QOR39782dr3I9Xvh1fU75ol/+++RUghAQZUnX+B8n+/XfmyWv9ZMts9E+G7YjpPOCM/Ss/6s+UNSMHff7g0//sPkvry7bnpw82857rMDkfZHLYNOm3ReFdi1WfRu//uglX9xab53/8/QPLN3+UnX7GcPGu8a6nrypKQ5eE52z1nH7c8dpLj6aPK3yBlf3BrPvK7tPcR37Tj1tPWBff3ZPbmtU6NWDHd4XCf6J0Nnt/BPsOm+S9Y84rf5WGPeRKOW8WtDcycWZ5TNzUhYmW83aEIkbtdXj9AyvBo3v9vo/xrFtOLZk67Y4PW9oVMW+2att3S/qwM69MZLSBn/8HhbFBw/fn/y+V7KMsjK8ML1TYnVtpuOmbSek7A856i1ZfnT//jtBmu/9n/N24/ethf9XE9Ocx95hH7jBd6LV9P3/yHEVNgzf+QYv8vSMHfn///rPv7qPT3y8J3v+Y/+PseFFL///xFT1AMv3//+fsPAf7+/fvnLwiAHPEP7BqgcSAxkBRQHqjmz58/EJUMBw8devj46c2btz9/+XLz1u39+48eOHD05Jmzp86ePX7u3OkLl46dOnP81Okjx0+ePX8RyDhz7sLBI8cuXb4CFAAAneRYrMeAI+MAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 11 58 01" title="" data-src="/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-94f8a.png" data-srcset="/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-e2b97.png 200w,\n/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-db056.png 400w,\n/static/2022-02-19-11-58-01-483a0fdc33af722d14525afbc4c3915b-94f8a.png 546w" data-sizes="(max-width: 546px) 100vw, 546px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/o3i6ck?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>之前演示过使用 CSS 多背景实现灰白网格效果（棋盘效果），如果使用锥形渐变来实现，只需要一行 CSS 代码就足够了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95915875188969440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.checkerboard {\n   width: 200px;\n   height: 160px;\n   background: conic-gradient(#eee 25%, white 0deg 50%, #eee 0deg 75%, white 0deg) 0 / 20px 20px;\n}`, `95915875188969440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.checkerboard</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 160px<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>#eee 25%<span class="token punctuation">,</span> white 0deg 50%<span class="token punctuation">,</span> #eee 0deg 75%<span class="token punctuation">,</span> white 0deg<span class="token punctuation">)</span> 0 / 20px 20px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-31 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-f5f2a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 683px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.19472913616398%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAn0lEQVQoz8WRzQoCIQCEff9nqkOHsl01Xdq6WgQtVIfdg2n+bcJiPxoRdeg7iCMzDDigf8YYo5S6ZIRHrXViBokODiHE+RVSSu/9u3BoHnw5ofzT8P+avwn/9GHO2vtU2WbpVM45H7HWRtnHi7sxiIfTg6LEm+2ubTvOOSwwIQwhijGdzlC9WuNqCecIQsRYvW+a0XhSogXB7HA8EVpdAbgaQ+MtNlH1AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 19 13 42 29" title="" data-src="/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-f5f2a.png" data-srcset="/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-d96b4.png 200w,\n/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-b52f8.png 400w,\n/static/2022-02-19-13-42-29-9bffef776e1705e9a13747492182762c-f5f2a.png 683w" data-sizes="(max-width: 683px) 100vw, 683px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/72su1v?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>最后一个例子，演示如何借助锥形渐变实现很实用的加载效果，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73347722373298690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.loading {\n   width: 100px;\n   height: 100px;\n   border-radius: 50%;\n   background: conic-gradient(deepskyblue, 30%, white);\n   --mask: radial-gradient(closest-side, transparent 75%, black 76%);\n   -webkit-mask-image: var(--mask);\n   mask-image: var(--mask);\n   animation: spin 1s linear infinite reverse;\n}\n\n@keyframes spin {\n   from {\n      transform: rotate(0deg);\n   }\n\n   to {\n      transform: rotate(360deg);\n   }\n}`, `73347722373298690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">conic-gradient</span><span class="token punctuation">(</span>deepskyblue<span class="token punctuation">,</span> 30%<span class="token punctuation">,</span> white<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--mask</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>closest-side<span class="token punctuation">,</span> transparent 75%<span class="token punctuation">,</span> black 76%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">-webkit-mask-image</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--mask<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">mask-image</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--mask<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s linear infinite reverse<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-32 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-bb96f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 512px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.0234375%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABEUlEQVQoz42Qy07DMBBF88Xs+QSW/AUrFkioArWhL2hpUrWqAEF4lAJqRYkaV7GTOLFnsJ2oAYkonMXozniur2wLfwOm3lI8+sTjNU5ClIBVWD+bfO98gwcL7X+Nte4E/zDnAX6K+y8YZOWkR/AtKdu/zXmsvcE9T4sMUJq5yr9jtWZTZxQP34u78u3nSPtrzDsEYCKLVZLhDUUuq9+s9gCKe5UQAFSAn8KSwzxGJspYMBhRkbz7P4k1WFEUMxZxniqIZqsICKFhuDVNwrkQIk4SKSVjLAjULFQHymHde08P3uP6y18tVyenZ8PrUe9y0O5fDYZus2W3ul1nPBm5U1dVx73o9BsN2xlPm3Z7vvj4BjzmP2nrDPG7AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 23 09 54 56" title="" data-src="/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-bb96f.png" data-srcset="/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-7728b.png 200w,\n/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-23f96.png 400w,\n/static/2022-02-23-09-54-56-6b1305ca5dbee0c1eb122114c25b54ce-bb96f.png 512w" data-sizes="(max-width: 512px) 100vw, 512px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>原理很简单，图 5-32 所示的其实就是一个锥形渐变，使用 CSS 遮罩属性只让外圈 25% 的范围显示，于是 loading 的圆环效果就出现了。如果想要小尺寸的 loading 效果，直接修改上述 CSS 代码中的 width 属性值和 height 属性值即可。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/scjz23?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>本例 CSS 代码中出现了 CSS 自定义属性（指 —mask）、CSS 遮罩属性 mask-image 和 CSS 动画属性 animation，它们都是非常实用的 CSS 属性，均会在本书的后面着重介绍，敬请期待。</p>\n<h2 id="重复渐变"><a href="#%E9%87%8D%E5%A4%8D%E6%B8%90%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重复渐变</h2>\n<p>线性渐变、径向渐变和锥形渐变都有对应的重复渐变函数，就是在各自的函数名前面添加 repeating- 前缀，示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13029645292493130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`repeating-linear-gradient(transparent, deepskyblue 40px);\nrepeating-radial-gradient(transparent, deepskyblue 40px);\nrepeating-conic-gradient(transparent, deepskyblue 40deg);`, `13029645292493130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>transparent<span class="token punctuation">,</span> deepskyblue 40px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">repeating-radial-gradient</span><span class="token punctuation">(</span>transparent<span class="token punctuation">,</span> deepskyblue 40px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">repeating-conic-gradient</span><span class="token punctuation">(</span>transparent<span class="token punctuation">,</span> deepskyblue 40deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>假设上面的语句是作为 background-image 应用在尺寸为 200px×100px 的元素上的，则最终的效果如图 5-33 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-0204f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 28.222996515679437%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABSUlEQVQY01WQSU8CQRCF+b8aDwSBiBGJUePNg3GJ8ejBuJw8Q1ATOMgiCDrADAjDbmQbMCj0Zw3DxUpeXnW9el3V7bpuw20HboTvhC9boE8g/AV7FTg24VRwIjioOH2DX7gS3pfzWR0Oq3AuHNDBtV5U+JfYKClWNcVjTxHtgVtqIUM0qW/pDtsLpIaKFQ12DMezLZpXeo9qcuGmTAlKEpQpIYGnCPG+4r6rWCuAT3RvWSDsLsFFXWHIC3bLCo/UA+Lxi+aT3F7GpVW7FHJltKJJwWiStxS9H4U5hWh7Sva1zLveJPf2wYM5QvsG1JzsGCL5BpmMQTxvolc7RPqyIRML+vJhoyFYgn8xh/GIRY/NzP7L1sDx2jy2FiXX3LEtYMfIGpNIpWl3utQaLcJPMRLZHPFkmthzSrQXkqkMrc7non+2hO2fKcUfAOKxBG1dREkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 23 13 37 26" title="" data-src="/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-fee1c.png" data-srcset="/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-a67b7.png 200w,\n/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-0b187.png 400w,\n/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-fee1c.png 800w,\n/static/2022-02-23-13-37-26-f7b7d86c4b337d596ad192091e236f1d-0204f.png 861w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>无论是重复线性渐变、重复径向渐变还是重复锥形渐变，其语法和对应的非重复渐变语法是一模一样的，区别在渲染表现上，非重复渐变的起止颜色位置如果是 0% 和 100%，则可以省略，但是对于重复渐变，起止颜色位置需要明确定义。</p>\n<p>重复渐变就这么点内容，很多人会觉得重复渐变复杂难懂，这只是因为对基本的渐变特性了解还不够深入而已。</p>\n<p>重复渐变非常适合实现条纹效果。例如，使用 border-image 属性和重复线性渐变实现条纹边框效果，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33287171235429900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.stripe-border {\n   width: 150px;\n   height: 200px;\n   border: 20px solid;\n   /* IE 旧语法 */\n   border-image: repeating-linear-gradient(135deg, deepskyblue, deepskyblue 6px, white 7px, white 12px) 20;\n   /* 新语法 */\n   border-image: repeating-linear-gradient(135deg, deepskyblue 0 6px, white 7px 12px) 20;\n}`, `33287171235429900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.stripe-border</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> 20px solid<span class="token punctuation">;</span>\n   <span class="token comment">/* IE 旧语法 */</span>\n   <span class="token property">border-image</span><span class="token punctuation">:</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>135deg<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">,</span> deepskyblue 6px<span class="token punctuation">,</span> white 7px<span class="token punctuation">,</span> white 12px<span class="token punctuation">)</span> 20<span class="token punctuation">;</span>\n   <span class="token comment">/* 新语法 */</span>\n   <span class="token property">border-image</span><span class="token punctuation">:</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>135deg<span class="token punctuation">,</span> deepskyblue 0 6px<span class="token punctuation">,</span> white 7px 12px<span class="token punctuation">)</span> 20<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-34 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-23-13-40-53-7e002c52bce34fab59b4072d7aa3235e-d7cef.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 329px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 133.1306990881459%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsSAAALEgHS3X78AAACwUlEQVRIx61VWW8SURSe/+lW17o91j3GBxM17tr44hKNS3yxVksQyhIpIAMF0VrZaoEWKKWlWAqtbS3cz3O4MzA1JsLoTU7OmXvvfPN995w5VwGNSA24Pwc8L3X84yLwiOxFSfon8zJ+QOvPKH5K9pDmX5bkGs8tbAIKA75aBHbEgH0J4FgKOJAEjqSkcXyU/GGyQxQfnwL6k/KZ44Pa3lPTQL2hAb5bAnbFAXsFKNFXZtaB6R9Abl3GaYoLG0CWfJae8xtyndd4/l4BGPgGVLcMDJldYg2mxuUZ4FwaWNYBrcRwJzH8uio3bAmg2aXxuJkDTholj5SBPmIYrckNDfF3VsKw51YeOEGA339qgEMkeW+iw7DZJaAOemVWSm6foZ6USZOAd4jhADGs6YDDZZkUs5Jv5GTZtCW/0c4wbpLhVU1ym6GNJO8myV/q5gDvapJXdMDXi/KP+NwjoD6uaQyXdckWkryHGCZMSr5OZ3iWAFcbhsLmM/xkkuFgXhZ2u2yGNMlmz5CTcj5j+PW4Dlmy2SzfJoZn0oZfz/KPdchZPp021OEwSd5PgDEDQ9Gl6Vm+kDGUja0iJU/20G0aoqNkUGPYlvy2LDuvDtjrYMnb+uGIdoaBqpSdpEY7Ue/EXPDsOWk8n1qTnYmrgrv6JWqwF7PE8Pduw3cH1yODcxn1aZ7Zc3vr12I+b75TOOZ7hu8hQx0KfKgKki2oSQiMVgRlXbRYOyrsBX1QzvMee0UazzvJ25bke6EVgU06XKXZStX/McZSttWWwf+puLsoTyhWqwVWuxNTmVkUi0WMh6MolhZai6MuN0Lhj2RRRCITCASCsLtc8PpVjHkDcL8fg83hRiwWhxoMw2K1Q3G7HPD4VGRzBZTLZQRDEczNl1qA/AID8lwoFIXX54dfVaGOR+AjULfH29oTiycQUiNwujz4BbYw7woJkVSaAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 23 13 40 53" title="" data-src="/static/2022-02-23-13-40-53-7e002c52bce34fab59b4072d7aa3235e-d7cef.png" data-srcset="/static/2022-02-23-13-40-53-7e002c52bce34fab59b4072d7aa3235e-00827.png 200w,\n/static/2022-02-23-13-40-53-7e002c52bce34fab59b4072d7aa3235e-d7cef.png 329w" data-sizes="(max-width: 329px) 100vw, 329px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/3jntrm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="css-3d-变换"><a href="#css-3d-%E5%8F%98%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 3D 变换</h1>\n<p>在所有 3D 成像技术中，最容易学习且最容易上手的技术一定是 CSS 3D 变换技术，即使你不懂 JavaScript 也能实现 3D 效果。因此，不少优秀的设计师能使用 CSS 3D 变换实现很多酷酷的 3D 效果。</p>\n<h2 id="从常用的-3d-变换函数说起"><a href="#%E4%BB%8E%E5%B8%B8%E7%94%A8%E7%9A%84-3d-%E5%8F%98%E6%8D%A2%E5%87%BD%E6%95%B0%E8%AF%B4%E8%B5%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从常用的 3D 变换函数说起</h2>\n<p>CSS 位移变换函数包括 translateX()、translateY() 和 translateZ()，其中 translateX() 和 translateY() 属于 2D 变换，translateZ() 属于 3D 变换。此外，CSS 缩放变换函数包括 scaleX()、scaleY() 和 scaleZ()，其中 scaleX() 和 scaleY() 属于 2D 变换，scaleZ() 属于 3D 变换。</p>\n<p>于是，就有不少人想当然地认为 CSS 斜切变换函数也包括 skewX()、skewY() 和 skewZ()，其中 skewZ() 属于 3D 函数。这种想法是不正确的，事实上，CSS 斜切变换没有 3D 函数，也就是说 skewZ() 函数是不存在的，自然也不存在 skew3d() 函数，因此下面的写法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74490839816312260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\ntransform: skewZ(45deg);\ntransform: skew3d(0deg, 0deg, 45deg);`, `74490839816312260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skewZ</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew3d</span><span class="token punctuation">(</span>0deg<span class="token punctuation">,</span> 0deg<span class="token punctuation">,</span> 45deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>也有不少人想当然地认为 CSS 旋转变换函数包括 rotateX()、rotateY() 和 rotateZ()，其中 rotateX() 和 rotateY() 属于 2D 变换，rotateZ() 则属于 3D 变换。这种想法也是不正确的，这回倒不是不存在上面 3 种函数，而是 rotateX()、rotateY() 和 rotateZ() 均属于 3D 变换。</p>\n<p>加上各种变换的 3D 合法语法，可以得到下面这些属于 3D 变换的 CSS 函数（这些函数不区分大小写）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69572439454159870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`translateZ(0);\ntranslate3d(0, 0, 0);\nrotateX(0deg)\nrotateY(0deg)\nrotateZ(0deg);\nrotate3d(1, 1, 1, 45deg);\nscaleZ(1);\nscale3d(1, 1, 1);\nmatrix3d(\n   1, 0, 0, 0,\n   0, 1, 0, 0,\n   0, 0, 1, 0,\n   0, 0, 0, 1\n);`, `69572439454159870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">translateZ</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">translate3d</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">rotateX</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span>\n<span class="token function">rotateY</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span>\n<span class="token function">rotateZ</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">rotate3d</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">scaleZ</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">scale3d</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">matrix3d</span><span class="token punctuation">(</span>\n   1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span>\n   0<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span>\n   0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span>\n   0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，matrix3d() 函数表示使用 3D 矩阵表示 3D 变换效果，共需要 16 个参数，由于过于复杂且使用概率较小，因此本书不做介绍。rotate3d() 函数的语法比较特别，这里专门讲一下。</p>\n<p>在展开介绍 rotate3d() 函数之前，我们有必要先了解一下 CSS 中的 3D 坐标。CSS 中的 3D 坐标如图 5-35 所示，横向为 x 轴，垂直为 y 轴，纵向为 z 轴，箭头所指的方向为偏移正值对应的方向。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-31-51-784e8a2f1deaffbff364497c123c6276-79f9e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 372px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 86.02150537634408%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsSAAALEgHS3X78AAABHklEQVQ4y6WSbUvDMBDH8/2/huBgojDEKXOzmwiKMK34RrY3a+fsmrTpUzJr21y9dejck7TbnyNcwv24P3ch+aosm37GcV5OZJkC4JGNTJCyOlxI2RTSdF/Y8xcW9oI5z5U6AM6yefNtsdA/sHeAbceBMAIh10IFIVAWF9oJZ5RugeUM4dymfhDIP4tcgSH+Ui4vsuq28XuAEIV7VXFgAOlgOB91aS3hWMrZ1M6riPw6EUJExTDWvMHG5n7sA9lVUaqzYYzN8XuSJC7n3PPwKQqjD2uKW4mEoJQxx7Upw/CDECscl1Pm4HUysUitfnpx2cLq/pOuv7wi/DYYdrRe/1kfGWbz6rp9022cN0/OGq22hqH17u4fHjvd26Pj+jegeuD0Y343bAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 31 51" title="" data-src="/static/2022-02-25-14-31-51-784e8a2f1deaffbff364497c123c6276-79f9e.png" data-srcset="/static/2022-02-25-14-31-51-784e8a2f1deaffbff364497c123c6276-bedfe.png 200w,\n/static/2022-02-25-14-31-51-784e8a2f1deaffbff364497c123c6276-79f9e.png 372w" data-sizes="(max-width: 372px) 100vw, 372px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>下面正式开始介绍 rotate3d() 函数，rotate3d() 函数的语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41163820351774260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`rotate3d(x, y, z, angle);`, `41163820351774260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">rotate3d</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> angle<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，参数 x、y、z 分别表示旋转向量的 x 轴、y 轴、z 轴的坐标。参数 angle 表示围绕该旋转向量旋转的角度值，如果为正，则顺时针方向旋转；如果为负，则逆时针方向旋转。有不少人看到“向量”就想起了大学时候被数学支配的恐惧，不过这里 3D 旋转的向量很简单，就是一条以坐标原点为起点，以坐标 (x, y, z) 为终点的直线，所谓 3D 旋转就是元素绕着这条直线旋转而已，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38467924630445240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: rotate3d(1, 1, 1, 45deg);`, `38467924630445240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate3d</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 45deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示元素绕着坐标 (0, 0, 0) 和坐标 (1, 1, 1) 连成的向量线旋转 45 度，图 5-36 中蓝色箭头所示即向量。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-58f3c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 627px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.355661881977674%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAAxklEQVQoz52R6wqCQBSEe/83K+2imWVBUdlFRNPdZN3bbFtCRAVa36/D2Z0zMNMzHwCgWWY60DPf1KYo/hfrsjRCGsHvh5pzHcWQEnkupUqPGZT+0VnK+pSUaZHvE8MYOFeE1Ix1c+Zc5xfUzJQFhIQQYExw3k1MCKoKGlCqJTCbBR40JVmYjVrrZ21vvC6/OCvo5kd7VQNnuNvH682WUNp3huOJH86jOD5Qej2fk3ARLaKV5wcDd2QHP7CPS3c0mQahN53dAAGNSchFxx9LAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 39 50" title="" data-src="/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-58f3c.png" data-srcset="/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-a8bea.png 200w,\n/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-f4947.png 400w,\n/static/2022-02-25-14-39-50-eceee8a00410ae7cb0b264dd271b7f48-58f3c.png 627w" data-sizes="(max-width: 627px) 100vw, 627px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果此时有一个正面印有数字 1、上下分别印有数字 5 和 6、左右分别印有数字 4 和 3 的立方体应用 rotate3d(1, 1, 1, 45deg)，那么它的 3D 旋转效果如图 5-37 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-cd472.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 557px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.707360861759426%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABsElEQVQoz2P4jwH+/fsLJLdu3X/48FogDyzy7z82wIChE0RMn3ElMSm/rs5j3rz6p09v49KPovnvX5CKidMv2dvMqa+LbWtLrKoKaWgI3bN3yY9fXzGNYEDTefvRe/3gHR7xXS2tIY31MbNm1bR2RBcXuqya24tP8x+w5gnLrkp6rnWtTI9uCqjrSl28qKmxKKw6xP/4ps1gC/5i0Qwx8duvP7YpO6Jtl/WndofUh0X3x3WW5dT7B3XGJ3x4/QqnzRA3X7v+ptZy8RabNfu9D8wKnpWTk1aVHFoVHrSmrw+kE9VaFGeDdP/993Tfg02RW/ak796ZuueA3uqtel3N7uG3z5/DdDNGVIEd9ePjjzNTz6x2XXVGesUTu/1P5l748+83UfEM0g824t2FV1/PvfmPI3lANf/58+f3799AJ/398+fnz18/geDHz2+fv/359/fXvz8/vv348eX7t+/ff/3+/eMnRBKo6heY/Yvh9t17t+/c/fTp881bd44eO3ng0JENm7aeOXthz96Du/bsP3Do8J59B9dv3LJz914gd8fuves3bt23/9DuvQeOHD8JAE8MZ0Rf7y6gAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 42 28" title="" data-src="/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-cd472.png" data-srcset="/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-8e829.png 200w,\n/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-2b773.png 400w,\n/static/2022-02-25-14-42-28-44dfcaa06a8552a538007ccdee8b7e12-cd472.png 557w" data-sizes="(max-width: 557px) 100vw, 557px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>按照我多年实践的经验，rotate3d() 函数很少会被用到，因为大多数的 3D 效果都是很简单的旋转效果，开发者往往使用更简单的 rotateX()、rotateY() 和 rotateZ() 函数。其中 rotateY() 函数是所有 3D 变换函数中最高频使用的函数之一，因此，本书就以 3D 旋转为切入点，带领大家快速进入 3D 变换的世界。</p>\n<p>3D 旋转变换有下面 3 个函数：</p>\n<ul>\n<li>rotateX(angle)；</li>\n<li>rotateY(angle)；</li>\n<li>rotateZ(angle)。</li>\n</ul>\n<p>它们分别表示绕着三维坐标的 x 轴、y 轴和 z 轴旋转。其中，rotateX() 函数的表现反映在现实世界中，就如体操运动员的单杠旋转；rotateY() 函数的表现反映在现实世界中，就如旋转木马围绕中心柱旋转；rotateZ() 函数的表现反映在现实世界中，就如正面观察摩天轮的旋转。</p>\n<p>使用简单的图形演示以上 3 个旋转函数，就有图 5-38 所示的效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-e2f03.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 42.19653179190751%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABgElEQVQY012QyU7DMBCG81xwoCyVoGURLQha4AgH6A0IAsqNwhMgUDkhUZYLbwHcWFr12BOljd3EcWITOw0OjNkEWCNZ+jz//J7fiN/+nDjWQHEetduxUpp8P2hOqV8+fu10NFHKCKWMoNX3obqMv0YR8KBet+YX7O0iPTySMOVDHjJmF3daQ0myW+pSCtBg19dkpUDMDbK65pgbkWVBn6jVUHoUT03j4RFZq2kbz3OKO2gkhWdm8fiEW9qLHMdwTysolcb5uU4ub2Wy4u5ei6tVNDqGZ3N4MiPqdSB+ufw8MIhzeZzJgt5Kpd29fQOtmyjRr0em0q2eXnZ5+SUG58kMGkqKT2fHsU0T2sADzOzlQrfZNOjVFatU/LMzdn7hnZwEN7d654fHNnxnccnZ3JJPTfURW0iIvbb+3JfogBIhvXP8k+fvVBmLGo23MPzPCeEHB6rV0gDShksKSV0qg0AKQSl9eQm6SnEoITzPZ5wzxqnn2bbt+owI6XIOEhC+A8SwiJXXBaTIAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 44 10" title="" data-src="/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-fee1c.png" data-srcset="/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-a67b7.png 200w,\n/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-0b187.png 400w,\n/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-fee1c.png 800w,\n/static/2022-02-25-14-44-10-56034bcb95127e9e06574c4f3d9fff4c-e2f03.png 865w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="必不可少的-perspective-属性"><a href="#%E5%BF%85%E4%B8%8D%E5%8F%AF%E5%B0%91%E7%9A%84-perspective-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>必不可少的 perspective 属性</h2>\n<p>perspective 的中文意思是透视、视角。perspective 属性的存在与否决定了你所看到的画面是二维的还是三维的，这不难理解，即没有透视，不成 3D。学美术或者学建筑的读者肯定接触过透视的一些东西。例如，图 5-39 所示的透视效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-2ab3c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 676px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.585798816568044%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABTUlEQVQoz32SS2+CQBSF+f8/pt24ctXEVqNp97aaVEERcHjNIAzvfmEC1qTpWQyXc8+ZOXfASpIkCIIwDOM4tm37fD73fS+l9H0/HkA3TVNIGMdxkhG0LB51XfcDiqLArEudqYzakGVZKqXqpnFdN89zQzZNE0XRg/l2u6GDhdRaG7KqKpOOFoIHM5HIQ6PUmiS8UhOPnh6A0724rMxiSLYQQsBYbdtiPp1OnuexPdlwEm+323ERURhut1slFeOgEQPQoySR1Y8oh3jX65VeXhSsmKVS3CKnocZGNDyTxeq6jsO7AdM8WZaJKDrYzvd+fwl8JSX3Mgkmi4VODZAjqCHTJHHm8+NsxpxG81tgcI99hzmBr/L81L8ueiHu5CP+MDfjFG1VNVq3dQ0D/jObkfg3lqv14Wi7F+/za/+yWC7eVpv3j/XmI03lJDP4AT+ycxi/gg87AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 46 31" title="" data-src="/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-2ab3c.png" data-srcset="/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-8739e.png 200w,\n/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-cfbeb.png 400w,\n/static/2022-02-25-14-46-31-956b429ea63086610bf6d50cea39b0a3-2ab3c.png 676w" data-sizes="(max-width: 676px) 100vw, 676px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>不过，CSS 3D 变换的透视点与图 5-39 所示的有所不同，CSS 3D 变换的透视点在显示器的前方。例如，显示器宽度是 1680px，浏览器中有一个 <code class="language-text">&lt;img&gt;</code> 元素设置了下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68187514680808284000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   perspective: 2000px;\n}`, `68187514680808284000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">perspective</span><span class="token punctuation">:</span> 2000px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这就意味着这张图片的 3D 视觉效果和本人在距离 1.2 个显示器宽度远的地方（1680×1.2≈2000）所看到的真实效果是一致的，如图 5-40 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-ca80e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 595px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.18487394957983%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABR0lEQVQoz51Sy26CQBTlS/kBv4IFWxJNDLFpeKw0bFzbQMKOlRsWAiURGQpYpi54xQiCvTKW0qZpY89iMnPunHsuZ6AuA7Rte/kVTdPAulo9bbdb2FCXe3A+n2GdzR6Wy+VVDG5NB9jkeU7K/SA9hmJRFDmO+3QmZYzx6XT601mUpMlkchWnaWoYhqqqnuclSVJVVd/OcZz1em2a5uFwIAwRy7I8nU6vYkVRxuMxwzCLxULX9TiO3zrAFJCK67qbzQYhBHpgoHtRFDzP38TgrGnafD6Hq1DOsqyu66oDCYJMS5jj8QjHxw7//GZJkliWvaVddwAfGGmY9jcQg7IsIerRaBSGIfXlYT5utD+B9IWMQEzTtCAId/wkpG8UhfAKlmVBilTP7vzAR0EU72GwJMG285xgDIxlOyh48XbIdlxv58f7117yDqAymrQSr8mdAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 25 14 48 02" title="" data-src="/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-ca80e.png" data-srcset="/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-54e17.png 200w,\n/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-1e5c4.png 400w,\n/static/2022-02-25-14-48-02-0c1c11fc354aa823602fe8a172b422d9-ca80e.png 595w" data-sizes="(max-width: 595px) 100vw, 595px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="用-translatez-函数寻找透视位置"><a href="#%E7%94%A8-translatez-%E5%87%BD%E6%95%B0%E5%AF%BB%E6%89%BE%E9%80%8F%E8%A7%86%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用 translateZ() 函数寻找透视位置</h2>\n<p>如果说 rotateX()、rotateY() 和 rotateZ() 可以帮你理解三维坐标，那么 translateZ() 则可以帮你理解透视位置。我们都知道“近大远小”的道理，translateZ() 函数的功能就是控制元素在视觉上的远近距离。例如，如果我们设置容器元素的 perspective 属性值为 201px：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66480860002811480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   perspective: 201px;\n}`, `66480860002811480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">perspective</span><span class="token punctuation">:</span> 201px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>那么就会有以下几种情况。</p>\n<ul>\n<li>子元素设置的 translateZ() 函数值越小，则子元素的视觉大小越小，因为子元素在视觉上远去，我们眼睛看到的子元素的视觉尺寸就会变小。</li>\n<li>子元素设置的 translateZ() 函数值越大，该元素的视觉大小也会越大，因为元素在视觉上越近，看上去也就越大。</li>\n<li>当子元素设置的 translateZ() 函数值非常接近 201 像素，但是不超过 201 像素的时候（如 200 像素），该元素就会撑满整个屏幕（如果父元素没有类似 overflow: hidden 的限制的话）。因为这个时候，子元素正好移到了你的眼睛前面，看起来非常大，所谓“一叶障目，不见泰山”，就是这么回事。</li>\n<li>当子元素设置的 translateZ() 函数值再变大，即超过 201 像素的时候，就看不见该元素了——这很好理解，我们是看不见眼睛后面的东西的！</li>\n</ul>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/y25bfm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>拖动滑杆控制子元素的 translateZ() 函数值，大家会发现当值为 −100 的时候视觉尺寸最小；随着值慢慢变大（例如值为 40 的时候），子元素的视觉尺寸明显变大；等到值继续增加到 200 的时候，会发现子元素充满了整个屏幕；而值是 250 的时候，由于子元素已经在透视点之外，因此是看不见子元素的，子元素如消失一般。整个视觉变化过程如图 5-41 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-40f0e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 31.25734430082256%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAABTklEQVQY0xVPS0vDQBjML9P/YO3Bil7UXKx4UQT1TwiKVw8KHnposUIr6kFa8CQo9lChj7wfm5im2c1md7P7GS8DM8yD0XqvwyBOmJSkYAXnhMnBtzEy3RIgzzDrPuLb+/jm7u3kXHbaWbyYRIWblr3h13hqaJUrYNIjwiuUQ6XBwDX8aPDuu8hOC3JwmK3VcWOLb27ne7plhRMKs2VpM+ULpXkKiOUUV9dYlH4hQwDeasnVFdp/CiTQ07NS10WzyXSdHh2j4DcDwFJhCUkJmskhzij6mUZc2VQ6AMnH5+LiMh6NbSzwfjOv1fKNBlmvk51d10GBAsQkEhBw0BYClgowQCqrSiDqn/7XV5+FUM8vst2RD90KVa+PSV7pRKm0hKxaBoCCUsswcZYRgiMUoiAMPG8+m5mGZUXRHMUGiq04mXp+GCLTNF3H4ZxXwT/LhziANQ9NVQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 03 10" title="" data-src="/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-fee1c.png" data-srcset="/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-a67b7.png 200w,\n/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-0b187.png 400w,\n/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-fee1c.png 800w,\n/static/2022-02-28-14-03-10-bd383a0001897f258bf1568fd214531a-40f0e.png 851w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>此时，我们再换一个视角，从侧面观察 translateZ() 函数的作用原理，如图 5-42 所示，可以更清楚地明白为什么 translateZ() 函数值会影响元素的视觉尺寸。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-0f06a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 643px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 84.44790046656298%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB4UlEQVQ4y31S227aQBD1n/elD/mPPvWxD01VoabFSaAkKCqxDRsMLlGJr8RgfAHfdnPwBBe7Skcra3Z9zlzOjCTeNs45voZlPRjGA2OGYeR5fgqQCGHb9mKxME0zTVOilWWZFwX8D7athaEoiizPCdwmO44zm808zwMfL2EYIklZId6Pxze+D6dsMv+Sd7udpmlZltF1u93CJ/I7Rfn5+ChWq3K1EqYpLEs8P7+S6zDgF0XBK4uiqM58puu3hgFOCWYcC/SVZW0yCOiT/LSyDD1z/tE0p0lyEOIfRaVa1c1ms9/vi0qk9XoNFZIkicJwwhh+HWAIDSSdFhkiQbAgCDCS+Xyuqqqu63Ec46U1oUbmlmWVgYZCDoPwvJh0cl2xXIqnJxT2Jrm1JK7r7kDACB2nJMGOhUg1Dh1CMH5i1P+tqlrVbBApjGN6bMwZRSqKgmnlRwOINuzTaKR7HqHRf3acU6NsdNjaPrqOGHOrDaMcjcw1yPd9TAjFAwHlo8r2acomE8s0SULLstrkOjOYtB7w8cEB9M9yibiQA+8Id1qdxDkX/zUC8OaVXKnzrTudzua/F8E2uPt1r03YzfBOHbPvcvfzl86P7rV81etcdHuDoSz3e/2BfHl9/vUCTn8wfAHZ99CL5LAROwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 04 15" title="" data-src="/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-0f06a.png" data-srcset="/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-66246.png 200w,\n/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-2dbe7.png 400w,\n/static/2022-02-28-14-04-15-a614c5f45a8812cabb934e65e632c953-0f06a.png 643w" data-sizes="(max-width: 643px) 100vw, 643px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="指定-perspective-透视点的两种写法"><a href="#%E6%8C%87%E5%AE%9A-perspective-%E9%80%8F%E8%A7%86%E7%82%B9%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%86%99%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>指定 perspective 透视点的两种写法</h2>\n<p>有两种书写形式可以指定元素的透视点，一种设置在舞台元素上，也就是设置在 3D 渲染元素的共同父元素上；第二种是设置在当前 3D 渲染元素上，与 transform 其他变换属性值写在一起，代码示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21150859446635550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.stage {\n   perspective: 600px;\n}\n\n.box {\n   transform: rotateY(45deg);\n}`, `21150859446635550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.stage</span> <span class="token punctuation">{</span>\n   <span class="token property">perspective</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.box</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>第二种：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27208193512711110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.stage .box {\n   transform: perspective(600px) rotateY(45deg);\n}`, `27208193512711110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.stage .box</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">perspective</span><span class="token punctuation">(</span>600px<span class="token punctuation">)</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/zjp7lo?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>看到的效果如图 5-43 所示，其中左侧的是 perspective 属性写法，右侧的是 perspective() 函数写法。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-08a78.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 574px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 65.33101045296168%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACGUlEQVQoz9WRW08TQRiG99d4UUMkLdsDtLulXLUJhmhCMCb+AO6JRLSJ8VIDKW1tVVroVjFB8QpqSjSGQ2lLW6yGmIJQD0tIiglkd9mdw87uOi1GEv+BX96rmXm+N3mGQRim0qX7D/Iv5qu5t18KmwfN5i9ZVhGCCELdsnYWF9+Hwx8FobG83FxbP97bOzs5RQgDABgItbHx3KXLD+3OiMMVcXvjHm/85q2XkgwwBNA0S1NTj222Zyw7w7Jpj2eO4+eDQeXoSEOIwRhO3MvbndP8wBOvP0nT444NDmUkCRKMkGVVYrEUy2YDAYHnaea8Xhrl8BAS0obv3M1390R8/ck+PkFhZ29s6LpwAUejMw6H4PdnOK4dny/D821Y1/97mOunthJ0BRV+bTgryVD/B+b5TMeZEAj8gXVqO7xid0b5gad9fLKXS3Sz08HBWUkCtBlTOB7/a5vWzrrdaZdLFkVEbQOgjt1esl155PHFuEAidDU1fCM7PpGTZQ1qGiDG5uRkoqsrRX+I9z8PhV6NjCyNjiqt1pmmMYToK+8ar998qm2Lu7stUTxRFGCZJj3XsW5allgs7iwsiOXycaNx+uOnJknEMAghGGPGuhj60jwfCLFOCEIIAKjTRZ1rwzR1YlDGNIxzgOkwliIrq+ul/YPvX/e/qaq6tlEsV7a3qrVCoVip1iuVWrVaXf2wUa9/Lpa3VE2zOj2/Ady1CXHMBZvtAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 10 21" title="" data-src="/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-08a78.png" data-srcset="/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-683d3.png 200w,\n/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-6bdc6.png 400w,\n/static/2022-02-28-14-10-21-29e80f106500a86d13e4988f4564d980-08a78.png 574w" data-sizes="(max-width: 574px) 100vw, 574px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>仔细对比图 5-43 左右两侧图形的效果，会发现虽然透视点设置的方法不一样，但是效果貌似是一样的。果真是这样吗？其实不然，图 5-43 左右两侧图形的效果之所以会一样，是因为舞台上只有一个元素，因此，两种书写形式的表现正好一样。如果舞台上有多个元素，那么两种书写形式的表现差异就会立刻显示出来，如图 5-44 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-7517b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 756px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.13756613756614%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAC90lEQVQozz2RWU8TURSA54/44BKUAhW6Ca0p0NKQSOQFTQhQi2BA1BgjCpFgiIpKjLKUglJQthZkadgKLZVVlhiIKEuhpaVM9wGm0zJ02qFF8PYB7tP9zjnfPefeCz19Pnjvfs+L0pFX5Zq+/lVZx2/h3c7SMtW7ijGdDrHZsNy87uKS4db2RZI8PDk5efP2R2HRkE6PHB8fQRlCOZVew4irvRzx6Va6TCyZi4yuYrIl58M+dPeuoCjBYteFUytvpDb7fAEg5xUozl14PzC4DvaQMLvzGqcugd/AYkty83sln+cZsbWJAimNJR5Uru/tebm8LyCVntnh9weB8PBxf8TVKtWoPiSLcr6H5KQG4NzJ6a4/lcE4fQNaNCSHzr2dLj+TKdTKYZUuJKdnyqIZNaw4MZ1ZVfBIUSOZjYyujOWIacwq5YjWieyz2LXUmI8ZWTKCIIGQm98TdqVCpQZjH0NjY7rx0ZXVjd1N8z7q9q38NauHl7V61GTDCTK460Q16jWt3uV0+QNH/0jvwfycYW3T5QscB4NByIvY1Q/yxgufTJUUu00mbMs4JMqcKCr8WfYSRxB4ZkaZLZwsfjZT/ppwe3TK4UFRFsBf1dXEwQG0t2X6xrneyGCKL17anphANzfrKZGNTFY9JQJZXgYRgFIGUxpD85jNGwpFXTilITpGnpzsdWGQC4blAkEbj9dIp1tmZ10Gw1cWqz0pqZnN3tNq4cnJEPJ4bQkJuNWq6+trYjBa4+N70tIItxvCYFjG57dyuQ1RUebpacxobKLTQSko2lldhaemAIJsC5u9b7EAuZFGa+FwulJvEhgGoSZTW2IiaNXC5doWFnbX16U0WrtAACLgCkaNRkqnA+xIScGdzrWuLjBgO58/IBIRHg/kx3Hb4iJqNHpdKPgJH4ZZFxZAE7/HA9CLIM4/S/tWK4njAHGrzb605AZZHA+99snpIklyG7agbo8/EIDtDrsTMRhN2xabA3VZEcSB7NjtTrPdcRgMnin/ARLJ/SPw8X9kAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 11 13" title="" data-src="/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-7517b.png" data-srcset="/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-0f6be.png 200w,\n/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-091cf.png 400w,\n/static/2022-02-28-14-11-13-56ca0fa6a9d163c87d8d9ad65e2d87bc-7517b.png 756w" data-sizes="(max-width: 756px) 100vw, 756px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 5-44 所示的效果其实不难理解。图 5-44 上面一排元素把整个舞台作为透视元素，也就是我们看到的每个子元素都共用同一个透视点，因此每一个子元素的视觉形状都不一样，这个效果比较符合现实世界的 3D 透视效果。例如视线前方有一排人，远处的人只能被看到侧脸，近处的人可以被看到正脸。而图 5-44 下面一排元素中的每个子元素都有一个自己独立的透视点，加上旋转的角度又是一样的，因此每个元素看上去也就一模一样了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/soqnjm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="理解-perspective-origin-属性"><a href="#%E7%90%86%E8%A7%A3-perspective-origin-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>理解 perspective-origin 属性</h2>\n<p>perspective-origin 属性很好理解，表示我们的眼睛相对 3D 变换元素的位置，你可以通过改变眼睛的位置来改变元素的 3D 渲染效果，原理如图 5-45 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-c7bf1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.5774647887324%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABT0lEQVQoz3VRSW6DQBDk//f8Im/g4iWHYGRWEQwBIwEGs+9rSJmxcBySPoxmurumuqqpMAwFQaiqapqmrzmm5xiGwbZtXddFUVQURZbltm1JiYqiSJKkPM/7vu+6bphjHEdywV9N01wuF8/zcKZpCjJ03sGEkDxwAQA1gif5vm33uh4kydIJDoKnplWgY2EGNeZ+2e3sMEQJeZzQiBF+M69/QaGr69ft1pvBpLMsS8j8m3lt2H6zCa7Xm4S+Bx7gZFZxA9d1Teb5DwxHkx+a4XZRFHcwbIzjGDYgS5Tigj7wwGrwYJdBEBAYzizLHpqxLcuykHIcByTYJMdxLMuqqoqk7/sMw/A8jyVLc9A0jZ2bpvmkGVTggZnDzLnscxxGJIlP+A4zQwXIH24bhqGoWprljuuqJ90wz7bjap+GKMqHI/9x0t7eD+yRM87WQvYNafp0Uo+8UZ0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 13 19" title="" data-src="/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-fee1c.png" data-srcset="/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-a67b7.png 200w,\n/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-0b187.png 400w,\n/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-fee1c.png 800w,\n/static/2022-02-28-14-13-19-4e82aaafd45866aeacff26e75e462f7d-c7bf1.png 852w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>正式语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85168862662569750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`perspective-origin: <position>;`, `85168862662569750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">perspective-origin</span><span class="token punctuation">:</span> &lt;position><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>一看到 <code class="language-text">&lt;position&gt;</code> 数据类型，就应该赶快回想起 background-position 属性支持哪些值，也就知道了 perspective-origin 属性支持哪些值。例如，下面这些语句都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82128736502342220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`perspective-origin: top left;\nperspective-origin: right 20px bottom 40%;\nperspective-origin: 50% 50%;\nperspective-origin: -200% 200%;\nperspective-origin: 20cm 100ch;`, `82128736502342220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">perspective-origin</span><span class="token punctuation">:</span> top left<span class="token punctuation">;</span>\n<span class="token property">perspective-origin</span><span class="token punctuation">:</span> right 20px bottom 40%<span class="token punctuation">;</span>\n<span class="token property">perspective-origin</span><span class="token punctuation">:</span> 50% 50%<span class="token punctuation">;</span>\n<span class="token property">perspective-origin</span><span class="token punctuation">:</span> -200% 200%<span class="token punctuation">;</span>\n<span class="token property">perspective-origin</span><span class="token punctuation">:</span> 20cm 100ch<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>perspective-origin 属性初始值是 50% 50%，表示默认的透视点是舞台或元素的中心。但是有时候，需要让变换的元素不在舞台的中心，或让透视角度偏上或者偏下，此时就可以通过设置 perspective-origin 属性值实现。</p>\n<p>图 5-46 所示的就是一个立方体应用 perspective-origin: 25% 75% 声明后的透视效果图。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-f79be.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 567px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.4973544973545%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABfUlEQVQoz2P4jwT+/vkDJG8sWb/HNOKoW/phl9TDLilHXNIPWEac6WoHqfj3D1k9A4rm37+B5LUJ8w4zWJwR9jnJ4XSKy+W0oM8JZbEzNfF/idF8fe6iQzy256W9b4VV38rsPm6oetKT80xDGkHNIGdfX7TkAK/dfXXfF21Ln22Yc9yV55Qr75n6VAKa/0E0L1lyUcnovorpFV/fZxsmnXDjP+XKQ4TmPyBn31i69I2z9P9AyfsJBvfKg0/6ip524z3bmEbQZpDmK3PnP5WR+2OsfUdL8Zyu8Ak70cPmjMcrIQH2F7fmvyCD3924/Wrx9ver9r9fufftmt2v1+54uG7V07PHIUpwaiYVMPz48eMPCPz+B/bPPzD48+sXKOT/Ahm///358+vHj+/fvwMV/QKDnz+B6OevX78ZNm7afvP2nQsXL335+u3S1SsXL189dx5IXL9y7fq9+w+v37p58dLlAwcPb9+979ix4zv3Hti3/8D2HfuOnTi978BhAB1VKWCTQfmVAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 18 33" title="" data-src="/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-f79be.png" data-srcset="/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-5ae21.png 200w,\n/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-d9cbe.png 400w,\n/static/2022-02-28-14-18-33-e55962f5e6ad49aa940dc30a9dc21807-f79be.png 567w" data-sizes="(max-width: 567px) 100vw, 567px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="transform-style-preserve-3d-声明的含义"><a href="#transform-style-preserve-3d-%E5%A3%B0%E6%98%8E%E7%9A%84%E5%90%AB%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transform-style: preserve-3d 声明的含义</h2>\n<p>transform-style 支持两个关键字属性值，分别是 preserve-3d 和 flat，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61112381618718570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform-style: preserve-3d;\ntransform-style: flat;`, `61112381618718570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>\n<span class="token property">transform-style</span><span class="token punctuation">:</span> flat<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>先讲一下这一语法中的几个关键点。</p>\n<ul>\n<li>preserve-3d 表示应用 3D 变换的元素位于三维空间中，preserve-3d 属性值的渲染表现更符合真实世界的 3D 表现。</li>\n<li>flat 是默认值，表示应用 3D 变换的元素位于舞台或元素的平面中，其渲染表现类似“二向箔”，把三维空间压缩在舞台元素的二维空间中。</li>\n</ul>\n<p>我们通过一个例子直观地了解一下 preserve-3d 和 flat 这两个属性值的区别，HTML 和 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52474292858410230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<section class=&quot;stage preserve-3d&quot;>\n   <div class=&quot;box&quot;></div>\n</section>\n\n<section class=&quot;stage&quot;>\n   <div class=&quot;box&quot;></div>\n</section>\n\n<style>\n   .stage {\n      width: 150px;\n      height: 150px;\n      background-color: rgba(0, 191, 255, 0.75);\n      perspective: 600px;\n   }\n\n   .box {\n      height: 100%;\n      opacity: 0.75;\n      background-color: darkred;\n      transform: rotateY(45deg);\n   }\n\n   .preserve-3d {\n      transform-style: preserve-3d;\n   }\n</style>`, `52474292858410230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage preserve-3d<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.stage</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 191<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.75<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">perspective</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0.75<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> darkred<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.preserve-3d</span> <span class="token punctuation">{</span>\n      <span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>应用了 transform-style: preserve-3d 声明的 3D 变换元素有部分区域藏到了舞台元素的后面，因为此时整个舞台按照真实的三维空间渲染，自然看不到旋转到后面的图形区域，如图 5-47 左侧图形所示。默认情况下，元素无论怎么变换，其 3D 效果都会被渲染在舞台元素所在的二维平面之上，因此没有视觉上的穿透效果，如图 5-47 右侧图形所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-6f9e6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 692px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.312138728323696%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+klEQVQoz2P4DwS/fv2/ceP/lSv/bt74ffXK/4sX/9+5/f/2rf8PH/y/eeP/o0d/Llz4e/bs/4cP/z9+/P/h4/9Xr/7/9g2ojwGI//37///Pn1///088/qDDLWBOaHTL1NXZh5/lnnwz4+n/Da//NSYWTvMNnpdbOq+qderkJeVXvj3+CdIH1gzCf7/+/x+/+0GOoX2lqr57apvUvEsyS28l3/rf/uh/dEBGhbphga5VsaphnqmLya5XV9A0A92RsfdBkYlTg555YG6PxpJrWqvv5Nz+3/f4f1JwVp2eRYWFa5WxfalLsMPe19cwNafvfVBo4lSvaxaQ0622+KrGqjvZt//3Pv6fGJxVq2tebuZcaWhT6hhgh1UzyGZTZJvvkmLzvofFVh4N+hZgm69orLwNsTk5PK/e0LrC3KXKwLrM3td+D0zzv3///gKDG6w5Z/edPE2zBj2ziKIJRqtumm58WHTn/ySgsz3jazSNauw86xz9SqOy3Q+/v/EdqPkvyOb/0Oj6//rT1wdHjr68eu3V208v//x/+fffuz//gbHw4NyF5+cvfHjy9P2XH6//A8X//wYp/8/w5OnTt+/ef/v27ceP71+/fP729y8wwn/++PHlw/u3r15+/vD+xbNnbz98fPnuwxsg+erli6dPPr178+bN25cvXwEAENOz9kiP6XMAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 02 28 14 24 42" title="" data-src="/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-6f9e6.png" data-srcset="/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-2b38f.png 200w,\n/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-438f0.png 400w,\n/static/2022-02-28-14-24-42-9364bfca5fc8a9bcb9f9c514c6439bc0-6f9e6.png 692w" data-sizes="(max-width: 692px) 100vw, 692px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/zgw557?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>需要注意的是，transform-style 属性需要用在 3D 变换元素的父元素上，也就是舞台元素上才有效果。</p>\n<h2 id="backface-visibility-属性的作用"><a href="#backface-visibility-%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BD%9C%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>backface-visibility 属性的作用</h2>\n<p>在 CSS 世界中，一个元素的背面表现为其正面图像的镜像，因此，当我们使用翻转效果使其背面展示在用户面前的时候，显示的是该元素正面图像的镜像。</p>\n<p>这一特性和现实中的 3D 效果并不一致，例如我们要实现扑克牌翻转的 3D 效果，很显然，扑克牌的背面一定是花纹，不可能是正面的牌号。因此，当我们对扑克牌进行翻转使其背面展示在用户面前的时候，显示扑克牌的正面镜像显然是不合理的。我们需要隐藏扑克牌元素的背面，至于扑克牌背面花纹的效果，我们可以使用其他元素进行模拟，然后让前后两个元素互相配合来实现 3D 扑克牌翻转效果。这个控制扑克牌的背面不显示的 CSS 属性就是 backface-visibility。</p>\n<p>backface-visibility 属性语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98381184917275280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`backface-visibility: hidden;\nbackface-visibility: visible;`, `98381184917275280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">backface-visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n<span class="token property">backface-visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>其中，visible 是默认值，也就是元素翻转时背面是可见的；如果 backface-visibility 的属性值是 hidden，则表示元素翻转时背面是不可见的。</p>\n<p>我们通过一个例子直观地了解一下 hidden 和 visible 这两个属性值的区别，HTML 和 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50692606312043710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<section class=&quot;stage backface-hidden&quot;>\n   <div class=&quot;box&quot;></div>\n   <div class=&quot;box&quot;></div>\n</section>\n\n<section class=&quot;stage&quot;>\n   <div class=&quot;box&quot;></div>\n   <div class=&quot;box&quot;></div>\n</section>\n\n<style>\n   .stage {\n      width: 150px;\n      height: 150px;\n      border: 1px solid darkgray;\n      perspective: 600px;\n      transform-style: preserve-3d;\n   }\n\n   .box {\n      width: inherit;\n      height: inherit;\n      opacity: 0.75;\n      background-color: darkred;\n      transform: rotateY(225deg);\n   }\n\n   .box:first-child {\n      transform: rotateY(-45deg);\n      background-color: darkblue;\n      position: absolute;\n   }\n\n   .backface-hidden .box {\n      backface-visibility: hidden;\n   }\n</style>`, `50692606312043710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage backface-hidden<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.stage</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid darkgray<span class="token punctuation">;</span>\n      <span class="token property">perspective</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>\n      <span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0.75<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> darkred<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>225deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.box:first-child</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>-45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> darkblue<span class="token punctuation">;</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.backface-hidden .box</span> <span class="token punctuation">{</span>\n      <span class="token property">backface-visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>设置了 backface-visibility: hidden 后，绕 y 轴旋转 225 度后元素被隐藏了，因为 rotateY 值在大于 180 度、小于 360 度的时候，我们看到的就是元素的背面了，如图 5-48 左侧所示；而 backface-visibility 属性值是 visible 的元素绕 y 轴旋转 225 度后依然清晰可见，效果如图 5-48 右侧所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-95b2a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 724px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABsklEQVQoz2P4DwGPHv27evX/00f/Hz34ffb8p/PXnu49/efO3b8PH3zZt/f3lUu/b9/5eur8s6OXfly88v/pE4gmBgj19+/ff///rFt/KzdvT1LKDg+vtcEhGz9/+/Xz04f5rv696mZFVjmW2v2uVrPuP3gPVP/v3z+E5j9//gLJqqrD2trzbG2XW1gs8fdf/+Xrrz/fPk0ycS1hkgri9pJhKbFS73rw8ANWzf+am4+bmS1xcVllY7MsMGADSPPXT1Mt3Cu45CNEApV4Km20e3Fp/t/UdMzEZLGzM4rmKebuFRzy4cIBStwVNlo9+Gw2N1/i6rra1haoeT3MZo9KLoVI0UAVXrw2V1QcUlGZDdRvaLjQy2sNRHO/vkM+g7APs4soQ4GJYtuDBxiagYH99+/vY8ceT558urn5aGbmrtTUHV++/vz5+ePamOSlgTETU3sSQpfFhKx8iGwzhMIEYOP+/f3z59+f32iCQL0Q/Qynz5y7ffveixcvHz16fPnKtes37jx6/PTWndvXb968cu3azTt3z56/dOr0OSA6efrMqdOnT5w6c+HS5avXbhw/cRoAN5zBJ/MzfR0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 02 14 02 45" title="" data-src="/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-95b2a.png" data-srcset="/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-9e4f1.png 200w,\n/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-4a316.png 400w,\n/static/2022-03-02-14-02-45-88106d15a0d51892d082e675caf22edc-95b2a.png 724w" data-sizes="(max-width: 724px) 100vw, 724px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/3ty0kq?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="值得学习的旋转木马案例"><a href="#%E5%80%BC%E5%BE%97%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%97%8B%E8%BD%AC%E6%9C%A8%E9%A9%AC%E6%A1%88%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>值得学习的旋转木马案例</h2>\n<p>这里举一个图片列表旋转木马效果案例，它可以用来替换常见的 2D 轮播效果，如果读者能弄明白这个例子，那么对 CSS 3D 变换的学习就算是合格了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/mnzyke?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>实现的效果如图 5-49 所示，点击任意图片可以看到图片列表的旋转木马效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-31a59.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.951105937136205%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAACQElEQVQoz12NW0gTcBSH/wnRW1FBRUUIoiBqKApmZXlhleEwyua84KUcoTPbJvM2LYvaKJpiypLykteZEuREtHxJKEKhhW7anGKmi64PiRk5YV/THoI+OPwOPzjfETp9I2pdDakXS5HKlLy1zfLd/pT5V/WMmfN5bkzB8ewuM4MGLNX5qJOjGW42MDT6miOpWWTkFXNZf5tSkwlzvwUhRBhiSzhiWzgBkSlYRy24hrUMVEYyUnuSCXMm0+ZcPg+V8aT4GIl+PjSqUtE+7EWE+HvvAhH+wd49kGDZKa8wSIGvRE3RnWZqWyz0dV3B9ULFRFsBXYVRvLx3noGbiYzWp9GqPErawe20FiWjqTMhFBI2SxLxiU1CXDiDpCIHkXGtCYP3m8rYib6hj1xtAt3GE4zVZjN4XUpDoQStPJIxUzqdqjjOBmylWXMaza0SRHQYPnmx+Bmk7KyMIV4mRZTrTTS2dFB9vwVzx2OSciXU6Y4zYkinvyoZZdJhSuQSesrSqcmKJT3Cn4qcOBTl8Yjd+9gUfoD9yj2IQ3sJTfB2Te3d9PZ00/KojYobRiyDQ7Qbr6KTn6TqUgYaRSYKuYxzMdEkREUQFRRAQW4WD8zNXuEOdsWE4KcOwlcdSnZZMQI8rLrdLC3/5MPHr/xedeNaWMRuszM1NYXT6WR2xsmkfQK7d6zWN7yfm+PH0jL2GQefvn1heekXHo+HdcTf+IfbvYpjeoaFRRcrKyu8czixjtuYX3Bt9OO2yY10r63xP+vSPzvOpo0x1mKvAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 02 14 12 33" title="" data-src="/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-fee1c.png" data-srcset="/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-a67b7.png 200w,\n/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-0b187.png 400w,\n/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-fee1c.png 800w,\n/static/2022-03-02-14-12-33-28765ec2ba96025d7a9c970bf5dbb253-31a59.png 859w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="实现原理"><a href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现原理</h3>\n<p>这个案例用到的 CSS 属性就是前面提到的几个常用 CSS 属性，包括透视、3D 变换和三维空间设置。</p>\n<p>首先，HTML 代码结构如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32919826639251436000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`舞台\n   容器\n      图片\n      图片\n      图片\n      ......`, `32919826639251436000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">舞台\n   容器\n      图片\n      图片\n      图片\n      ......</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>相关 HTML 代码是：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="79154932749130860000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<div class=&quot;stage&quot;>\n   <div id=&quot;container&quot; class=&quot;container&quot;>\n      <img class=&quot;piece&quot; data-src=&quot;1.jpg&quot; style=&quot;--index:0;&quot; />\n      <img class=&quot;piece&quot; src=&quot;2.jpg&quot; style=&quot;--index:1;&quot; />\n      <img class=&quot;piece&quot; src=&quot;3.jpg&quot; style=&quot;--index:2;&quot; />\n      <img class=&quot;piece&quot; src=&quot;4.jpg&quot; style=&quot;--index:3;&quot; />\n      <img class=&quot;piece&quot; src=&quot;5.jpg&quot; style=&quot;--index:4;&quot; />\n      <img class=&quot;piece&quot; src=&quot;6.jpg&quot; style=&quot;--index:5;&quot; />\n      <img class=&quot;piece&quot; src=&quot;7.jpg&quot; style=&quot;--index:6;&quot; />\n      <img class=&quot;piece&quot; src=&quot;8.jpg&quot; style=&quot;--index:7;&quot; />\n      <img class=&quot;piece&quot; src=&quot;9.jpg&quot; style=&quot;--index:8;&quot; />\n   </div>\n</div>`, `79154932749130860000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>2<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>3<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>5.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>4<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>5<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>7.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>6<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>7<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>piece<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>9.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">--index</span><span class="token punctuation">:</span>8<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于舞台，需要为其设置视距，例如设置为 800px：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49922001593089700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.stage {\n   perspective: 800px;\n}`, `49922001593089700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.stage</span> <span class="token punctuation">{</span>\n   <span class="token property">perspective</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>对于容器，需要为其添加 3D 视图声明：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69513047084434270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   transform-style: preserve-3d;\n}`, `69513047084434270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后就是图片元素了，为了方便定位，我们让所有图片应用 position: absolute 声明，共用一个 3D 变换中心点。</p>\n<p>显然，图片旋转木马的运动方式需要应用的 3D 变换函数是 rotateY() 函数。因此，图片元素需要设置的 rotateY() 函数值就是 360 度除以图片数量后的计算值，这里有 9 张图片，则每张图片的旋转角度比前一张图片多 40 度（360 / 9 = 40）。如果需要兼容 IE 浏览器，我们可以这样书写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8255502338173714000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img:nth-child(1) {\n   transform: rotateY(0deg);\n}\n\nimg:nth-child(2) {\n   transform: rotateY(40deg);\n}\n\nimg:nth-child(3) {\n   transform: rotateY(80deg);\n}\n\nimg:nth-child(4) {\n   transform: rotateY(120deg);\n}\n\nimg:nth-child(5) {\n   transform: rotateY(160deg);\n}\n\nimg:nth-child(6) {\n   transform: rotateY(200deg);\n}\n\nimg:nth-child(7) {\n   transform: rotateY(240deg);\n}\n\nimg:nth-child(8) {\n   transform: rotateY(280deg);\n}\n\nimg:nth-child(9) {\n   transform: rotateY(320deg);\n}`, `8255502338173714000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img:nth-child(1)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(2)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>40deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(3)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>80deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(4)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>120deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(5)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>160deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(6)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>200deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(7)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>240deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(8)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>280deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">img:nth-child(9)</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>320deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果无须兼容 IE 浏览器，我们可以使用 CSS 自定义属性实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91017121520249540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   transform: rotateY(calc(var(--index) * 40deg));\n}`, `91017121520249540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--index<span class="token punctuation">)</span> * 40deg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>虽然 9 张图片的方位都不一样，但由于它们共用一个 3D 变换中心点，因此一定会挤成一团，如图 5-50 所示，图片挤成一团的效果显然不是我们需要的，我们需要拉开图片之间的距离。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-4fbc8.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 431px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 84.68677494199537%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAAETElEQVQ4y63T+1PUVRjHcWpyYrqhIjgTJF5Wd2VZBAQCg1UTRJFgKAgEQ/EGiRAjBGRIEQiiNpIiFw1QaxFIwcu6uwa73FwFtUYTjQQzLgvCAgpMeWGmd1+bafYf6PnhnJnznHnNOWfOxwyheoYGqVXqUDb1o7/1jPOKY1Tlp1FdlM9A+3EmH9/gQIWChF25VJUrSU8vYl/WXh5equT+2SK62xoYeWh8TmH2fKiqbyYjt4T8E79RVPOIzG0xBM4xY72rNUMtWzHcy+WFd1yYIZGzzisGV0kIMavWYDwUzC9JblzO3o6uvdUEKhv0fF+tEuY+zjWNUrQzjsjFlmSGOjLZnkZfZw5TA31wXRNMYXQ6W/xi2RUWxtVUVwqiHVBlxaO9qTeBlcpmCspqadTfR9XYS0lSOBvdrUj2FTHaGE1vewqvBPkiDw1EE5/I/pAYkpd7cSrOmZKMAMoSwlG36Uyguq6F4xVnuHatnavXfxLAMD7xnknC0lkYlCH0XI/n5XA/Vm8IwJAYTmlgKGlyVzqL13H1m0gOfuTPqSaNCTx7oYmS8hp+btNzXnMMReZWNrlYkOznwI0KL1pr32bKtmAiNvlwJ8gbucNSlro78W2sjENbpaSGrURRrzaB1SotB49U0NZYz5m6M5RlbmSjswU7fKSoSlxQlIt5KSkYN18P0lyWCOAyxFIZqyNsiYi1x89FSuHpShOYuucAMUlZ6LU1aLQKDqd8SLTzdNIDnCnb70jOURH2xwJwcHFlxUJfbOf7IhY7InafyhyZNYtm23Gg8jsTuD4pg+2pX6FTl3Pyh1xKPhWuJxNA/0Xs3ikl5YgV/sUSxBJ34hx8iFj4LitlDljYmCMSWSKZZUPuiVITmL73IDsz86ivy6JG+TkZ20IIktmSskJGfJyI0M8shX+4AP+5Mlocvdkn9SZ8ngTzGS8ye8E05tq8SXbpUROYnV9AVOwO8o4EUV0bRVzUKrb4eJC9NoDIKAn+ia9jHrQAT5kbp6VeHBUvYbOdCEu7KUgdp2M/5y3hWYpN4NcFhazftIUTVctQnPZhQ7gcT+lCVi/xQO5nw7J4c2bseoOZTh68b+/NByIPIt1kfBw1j4S181ksmkVe8WETeLKqmi+z00n8wpbdpWLeWyPFztoaJ8l8nLxeY/kGK17dPJNpEjFykSciKxkrvRdxKM+TnCRnIYrz2FtU+B/4NxMTf9JtMHCz6xJ3+66j1aqo//EiHXfu0Nyq4Y++Dn7t7OScTsft9g40ai1anRaD4Rbdv1+j+/49Ho2Nm074f5aZoX+AIeMwT54+xThsZHLyGWNjYwwMDtE/8ICBB4OMjAwLvREGh4yMj08I/XF6ew2MjI7S19f77z7j8DDDI6OYqTV16C+30dPTi7ahmb8eP6GrswtVXb2QcR26hhautLZxqeUKF9QXud1xl667XWiEdDULa+cvqNA26WkVDE1dA/8AlJahf5l2tPUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 02 14 29 42" title="" data-src="/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-4fbc8.png" data-srcset="/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-3b445.png 200w,\n/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-b6b36.png 400w,\n/static/2022-03-02-14-29-42-aaa3cd414cbe32d657bf2c74d2de1afa-4fbc8.png 431w" data-sizes="(max-width: 431px) 100vw, 431px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如何拉开距离呢？其实很简单。我们可以把 9 张图片想象成 9 个人，现在这 9 个人站在一起分别面朝不同的方位，这 9 个人是不是只要每个人向前走 4 ～ 5 步，彼此之间的距离就拉开了？不妨想象一下夜空中礼花绽开的场景。这里的向前走 4 ～ 5 步的行为，就相当于应用 translateZ() 函数的行为，当 translateZ() 函数值为正值的时候，元素会向其面对的方向走去。</p>\n<p>现在只剩下一个问题了：要向前走多远呢？这个距离是有计算公式的！这 9 张图片宽度均是 128px，因此就有图 5-51 所示的理想方位效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-284ba.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 653px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 83.46094946401224%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB40lEQVQ4y3WT3XLaMBCF/f6v1DSZppm2TOiQ0GlnyvQG0hCDjbFk4/hHMv2ktRRyUV2AvN6ze/acdXIOx1rbtq1SKsuyoii01l3XjeN4/v9J5I/U4/FYVdUwDMYYMH3fS/B0OrkMX2XsOmvMO3DTNHmemxAFHxvSHCIUkkdTlkPbvoHJOxwO/A7+XILBMAuPTCHZo9aGWSIYqnVdy4NkQ2EIJw4l5AE3VdWHeLLf7+kDRroBoMRms2EWP6k7lDvkuaOt1N/1+jUwT4QzAJGKQx/oXPYnoWRaGlTVmbhX1IGJvrkFwlqVprVS/mqjhFR0CSQT9wI5MMbKjeweJ2BRFEhqvFSCh1eplANDPkRo7sD4IZzdayak3GtrgwTEmV8Es1qPPk3iCVuFydFY1w0VkCDYTtJut5tKQ95fxNppSXBSBHeqwHAwQ+iAonFJrPc5Fp3Wk/7gqTIgWllar/6prkFOm+epWaW2T09iCpAkSk0T+Cut98/PeZbhAsgo+Dm0w/DVasUrVmsCy8yNP+vNZrvdcmkv1vjy40vTVF4lMWSNjbLJJazX5JlfRBw07z4M/h4elssfv7YvaaX11fWnxWL5e/Vndj+/uf3y4erm4/Xt4/Ln9/ni893Xb7P72WyudAXqH4BC288YhxSsAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 02 14 33 56" title="" data-src="/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-284ba.png" data-srcset="/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-b5223.png 200w,\n/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-dce0f.png 400w,\n/static/2022-03-02-14-33-56-bb7cdc086a5e1169431b6962c6520539-284ba.png 653w" data-sizes="(max-width: 653px) 100vw, 653px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 5-51 中使用红色标注的 r 就是图片需要设置的 translateZ() 函数的理想值，使用该值可以让所有图片无缝围在一起。</p>\n<p>r 的计算比较简单：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mo>=</mo><mn>6</mn><mn>4</mn><mi mathvariant="normal">/</mi><mi>t</mi><mi>a</mi><mi>n</mi><mo>(</mo><mn>2</mn><msup><mn>0</mn><mo>∘</mo></msup><mo>)</mo><mo>≈</mo><mn>1</mn><mn>7</mn><mn>5</mn><mi mathvariant="normal">.</mi><mn>8</mn></mrow><annotation encoding="application/x-tex">r = 64 / tan(20 ^ \\circ) \\approx 175.8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">6</span><span class="mord">4</span><span class="mord">/</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.674115em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≈</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">1</span><span class="mord">7</span><span class="mord">5</span><span class="mord">.</span><span class="mord">8</span></span></span></span></p>\n<p>为了好看，图片左右两边可以留点间距，例如 20px，最终得到需要使用的 translateZ() 函数值为 175.8 + 20 = 195.8。于是，最终图片元素设置的 transform 属性值是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53192885806886440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: rotateY(calc(var(--index) * 40deg)) translateZ(195.839px);`, `53192885806886440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--index<span class="token punctuation">)</span> * 40deg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">translateZ</span><span class="token punctuation">(</span>195.839px<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>最后，要让图片旋转起来，只要让容器每次旋转 40 度就可以了，这个可以使用 CSS 动画完成，或者使用 JavaScript 设置也是可以的。理解了旋转木马 3D 效果实现原理，其他 3D 效果基本上就都可以轻松驾驭了。</p>\n<h2 id="3d-变换与-gpu-加速"><a href="#3d-%E5%8F%98%E6%8D%A2%E4%B8%8E-gpu-%E5%8A%A0%E9%80%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3D 变换与 GPU 加速</h2>\n<p>3D 变换除了用来实现 3D 效果，还经常被用来开启 GPU 加速，例如实现左位移 100px，下面两种写法都是有效的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70867238366389530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: translate(-100px, 0);\ntransform: translate3d(-100px, 0, 0);`, `70867238366389530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-100px<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>-100px<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是，使用 translate3d() 函数的变换效果性能要更高，因为使用该函数会开启 GPU 加速。然后问题就来了，很多开发者一看到“性能更好”就激动了，遇到了元素变换效果就使用 3D 变换，甚至实现其他简单的图形表现时也会添加一段无关紧要的 CSS 3D 变换代码，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86849420233556180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transform: translateZ(0);`, `86849420233556180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateZ</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这是一个很糟糕的做法，Web 网页是如此简单，2D 变换原本的性能就很高，根本就没有任何必要去开启 GPU 加速，没有遇到任何一个场景非得使用 3D 变换才不卡顿的。要知道，不必要的 GPU 加速会增加内存的使用，这会影响移动设备的电池寿命。因此，我直接就下结论了：单纯的 2D 变换请一定使用 2D 变换函数，没有任何理由需要使用 3D 变换函数，此时让 GPU 加速是一种糟糕的做法。</p>\n<h1 id="css-过渡"><a href="#css-%E8%BF%87%E6%B8%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 过渡</h1>\n<p>使用 transition 属性可以实现元素 A 状态到 B 状态的过渡效果，经常使用 :hover 伪类或者 :active 伪类触发。</p>\n<p>目前，我们已经无须给 transition 属性增加私有前缀了，无论是什么项目都不需要。IE 浏览器从 IE10 版本开始，就从未支持过 -ms- 私有前缀，完全没有任何需要添加 -ms- 私有前缀的理由。</p>\n<p>至于添加 -moz- 和 -webkit- 私有前缀也是很多年以前的事情了，目前已经无须再添加。即使有个别用户使用的是非常古老的浏览器也没有关系，因为 transition 是一个体验增强的 CSS 属性，即使浏览器不支持，也只会导致一些交互效果生硬一点，对页面功能没有任何影响。</p>\n<p>transition 是一个常用属性，相信基础的知识大家都比较了解，因此，接下来我只会介绍一些我认为读者可能不知道的关于 transition 属性的知识。</p>\n<h2 id="你可能不知道的-transition-属性知识"><a href="#%E4%BD%A0%E5%8F%AF%E8%83%BD%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84-transition-%E5%B1%9E%E6%80%A7%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>你可能不知道的 transition 属性知识</h2>\n<p>transition 属性是一个缩写属性，它是 transition-duration、transition-delay、transition-property、transition-timing-function 这 4 个 CSS 属性的缩写，每一个 CSS 属性的背后都有大家所不知道的细节。</p>\n<h3 id="transition-duration-属性"><a href="#transition-duration-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition-duration 属性</h3>\n<p>transition-duration 属性表示过渡时间，它的值可以是 0，但是不能是负值，其他就没什么好说的……真的是这样吗？请看下面这段 CSS 声明：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20473956763474854000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition: 1s 0.5s;`, `20473956763474854000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition</span><span class="token punctuation">:</span> 1s 0.5s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>很多开发者都知道，第一个时间值 1s 表示过渡时间，第二个时间值表示延时时间（transition-delay），这两个时间值的顺序是固定的，绝对不能调换，否则含义会颠倒过来。久而久之大家容易陷入一个误区，认为 transition 属性如果设置了两个时间值，其顺序必须是固定的，其实不然！有一种场景下 transition 属性的两个时间值的顺序是可以任意调换的。什么场景呢？就是其中一个时间值是负值的时候。例如，下面两句 CSS 声明都是合法的，且含义一模一样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82958167641234590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 效果一样 */\ntransition: 2s -1s;\ntransition: -1s 2s;`, `82958167641234590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 效果一样 */</span>\n<span class="token property">transition</span><span class="token punctuation">:</span> 2s -1s<span class="token punctuation">;</span>\n<span class="token property">transition</span><span class="token punctuation">:</span> -1s 2s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>原因就在于不起眼的“transition-duration 不能是负值”的特性，所以上面代码中的 −1s 只能是 transition-delay 的属性值，两个值就可以无序排列。</p>\n<h3 id="transition-delay-属性"><a href="#transition-delay-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition-delay 属性</h3>\n<p>transition-delay 属性用来指定延时过渡效果执行的时间，单位是 s（秒）或者 ms（毫秒），其值可以是负值，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68700838655452710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition-delay: 200ms;\ntransition-delay: 2s;\ntransition-delay: -0.5s;`, `68700838655452710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition-delay</span><span class="token punctuation">:</span> 200ms<span class="token punctuation">;</span>\n<span class="token property">transition-delay</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span>\n<span class="token property">transition-delay</span><span class="token punctuation">:</span> -0.5s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当 transition-delay 属性值为负值的时候，会带来一个很有意思的现象，那就是可以省略部分动画进程，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53208383072272245000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   transform: translateX(0);\n   transition-duration: 1s;\n   transition-delay: -0.5s;\n}\n\n.example:hover {\n   transform: translateX(100px);\n}`, `53208383072272245000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 1s<span class="token punctuation">;</span>\n   <span class="token property">transition-delay</span><span class="token punctuation">:</span> -0.5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.example:hover</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>100px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时当鼠标经过 .example 元素的时候，元素的 transform 位移位置不是从 0 开始，而是从靠近 50px 的位置开始的，且过渡效果执行的时间不是 1s，而是 0.5s，因为最终过渡执行的时间等于动画过程时间加动画延时时间，也就是 <code class="language-text">1s + (−0.5s) = 0.5s</code>。</p>\n<p>transition-delay 属性有一个隐蔽的但却很实在的作用，那就是可以提高用户的交互体验。例如，使用 :hover 伪类实现的浮层是一种很常见的交互效果，传统的效果都是鼠标指针一旦经过元素，浮层立即出现。这其实是有问题的，因为鼠标非常容易误触该交互效果。优秀的交互体验是会增加一定的延时判断的，也就是如果鼠标指针快速经过元素，会被认为是不小心经过，浮层就不会出现。</p>\n<p>想要实现这个交互效果，目前只能使用 transition-delay 属性，请看下面这个具体的案例：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="69292797319940760000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<a href class=&quot;target&quot;>显示图片</a> <img data-src=&quot;1.jpg&quot; />`, `69292797319940760000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>target<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>显示图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>当鼠标指针经过“显示图片”这个链接的时候，浮层图片在鼠标指针停留在元素上一定的时间后才会显示，使用的 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26546101184965677000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.target + img {\n   transition-delay: 0.2s;\n   visibility: hidden;\n}\n\n.target:hover + img {\n   visibility: visible;\n}`, `26546101184965677000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.target + img</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-delay</span><span class="token punctuation">:</span> 0.2s<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.target:hover + img</span> <span class="token punctuation">{</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时鼠标指针悬停在 <code class="language-text">显示图片</code> 上 200ms 之后浮层图片才会显示，效果如图 5-52 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-66417.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 441px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 72.56235827664399%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADcElEQVQ4y62Ta0zbVRiHm0F0cTG2UC6lt3+bjLmJyfhiom5LjB80qItDTdRs8bKNiYuMjOEHXUxWndAGMhZx0SDoZJNYRwU67KjAuI2bTq4rA9aWi20ZMAbIACnt459CTEbwmyd5c07ec35Pfu8555UEg0FWhn/xHotzd5n/a5rFe9MEl2aZm5mgq6uXxtZuevoGxdxMaG9udprZmWnx7F2WlxZD+hXOSkgCAX8o0Ws5xoU0DfnvP471VALu4p24ihMZPBdPW1Eq9pw36MyN50ZeInmv7CBrbwInk5TYSvJD+sDy8iowuAYcKHuX8hNbKMlQUmOIw/mNmltfqxj4QsUfp5WYU2IpTVNw6Fk5T2llpO+KYd/2cPLPZIf0y8v++4FO62HsJ2VUntLRZNTS/5WOvrMCPUaBrmwBS5qat5+MRR8TycPSCNSKaOSbw8k1mVaB/nUOR64cptkgpdogUGvQcF2E3soXGBChDoMW+zE1P72sovE1DW8lxCCXR7FJsomsz42rb7ARsMMko/OMns48LT0iqP87AU+FDo84N2dq+D5JxQ8vqCh+TklyvILo8DBO/xdwpeS2bBkdX+pxFIjOftTR/akWx8cCo3k6OlK12JLV1L2uoeZVDcan1WgeCsOQvXqH/vV3eLPskFiqlFZR3HtR4MZHAu0xamzbRFdvqkLuCvYoqd2n5uKLKg7siSNCFkau0bj2KOscdpoPUvXJI7QX6ulOE0veoqFIquTAzjje2a7gGWUUu4Uo3kuM5aVHo9krAuM1D2AymjYG9v6cQtO5SLo/3Erfg3qqY7VUHhEwH9FRsENNujqOJ/QKnt+qZJdWwe7HlCikm8nJytkYOFi1n5bPwuiJjMahisScLMWcKmWyUE5LegS/fRDB1aOy0NqaIqXioJzzSRI6zmetfWz//Z1y21FEv+Uow2czmbJl0FCYTsuFdGbbTuC0HGe0PIMxMXzlx/FYMhi9lMnNb1P587rt304JBAJI+J+HxOv1Mb+wwMTkBP6lv8Wmn8HlcjE0NITT6WJszMf4+G18Xi8+nw+3282dyUkxN47X4wmduTM1hUfkuIeGkdRebWB4ZJTW9t+Zn19gaHiESpudy79UUWIupa6+ifrGZixll7nW3EZpmZXq2noar7VwxV7DJUsFdQ1N/FpTh1XU/ANuEnjd33+l7wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 15 29 22" title="" data-src="/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-66417.png" data-srcset="/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-d16fa.png 200w,\n/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-9fd5a.png 400w,\n/static/2022-03-03-15-29-22-ac150c826ba43146fc8f6cc92b188e42-66417.png 441w" data-sizes="(max-width: 441px) 100vw, 441px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/hnvu1d?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="transition-property-属性"><a href="#transition-property-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition-property 属性</h3>\n<p>transition-property 属性用来设置应用过渡效果的 CSS 属性，其初始值是 all，表示默认所有 CSS 属性都应用过渡效果。</p>\n<p>不知道“初始值是 all”有没有让你意识到什么。我已经记不清有多少次见到过下面的 CSS 代码了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25794669325050544000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition: all 0.2s;`, `25794669325050544000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition</span><span class="token punctuation">:</span> all 0.2s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>上面这段 CSS 代码的语法和功能都没有问题，表示所有 CSS 属性都执行 0.2s 的过渡效果，那问题在哪里呢？问题就在于其中的 all 完全是多余的，直接写成下面的 CSS 代码就可以了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42651838820585030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition: 0.2s;`, `42651838820585030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition</span><span class="token punctuation">:</span> 0.2s<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>也就是我们只需要指定过渡时间就可以了。</p>\n<p>不过不是所有 CSS 属性都支持过渡效果，例如 display 属性就不支持过渡效果，而且，不支持也就罢了，有时候还会“搞破坏”。例如设置了 transition 过渡效果的元素应用 display: none 时，过渡效果会被瞬间中断，导致 transitionend 事件不会被触发。</p>\n<p>因此，如果希望元素有过渡效果，同时可以隐藏，请使用 visibility 属性，visibility 属性在 CSS Transition 过渡效果中很实用，后面会专门对此进行介绍。</p>\n<p>transition-property 支持任意 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型值，不需要是合法的 CSS 属性名称，例如下面语句也是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1278887512740723000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\ntransition-property: 笑脸-©;`, `1278887512740723000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token property">transition-property</span><span class="token punctuation">:</span> 笑脸-©<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是该属性不支持以数字或引号开头的数据类型，关于 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型的深入介绍参见之后章节。</p>\n<p>最后，我们可以同时设置多个参与过渡效果的 CSS 属性，使用逗号分隔，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89124497689893270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`transition-property: color, background-color, opacity, transform;`, `89124497689893270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">transition-property</span><span class="token punctuation">:</span> color<span class="token punctuation">,</span> background-color<span class="token punctuation">,</span> opacity<span class="token punctuation">,</span> transform<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>下面讲一下属性值列表的长度不同时的样式计算规则。用一句话概括就是“有缺则补，多之则除”。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97059812348495790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   transition-property: opacity, left, top;\n   transition-duration: 3s, 5s;\n}\n\ndiv {\n   transition-property: opacity, left, top, height;\n   transition-duration: 3s, 5s;\n}`, `97059812348495790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> height<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45709140729787580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   transition-property: opacity, left, top;\n   transition-duration: 3s, 5s, 3s;\n}\n\ndiv {\n   transition-property: opacity, left, top, height;\n   transition-duration: 3s, 5s, 3s, 5s;\n}`, `45709140729787580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">,</span> 3s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> height<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">,</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 transition-property 的属性值列表长度过短，则其他过渡属性多余的列表值会被忽略。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70836671912370180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   transition-property: opacity, left;\n   transition-duration: 3s, 5s, 2s, 1s;\n}`, `70836671912370180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">,</span> 2s<span class="token punctuation">,</span> 1s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25812662174431412000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   transition-property: opacity, left;\n   transition-duration: 3s, 5s;\n}`, `25812662174431412000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">,</span> left<span class="token punctuation">;</span>\n   <span class="token property">transition-duration</span><span class="token punctuation">:</span> 3s<span class="token punctuation">,</span> 5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>子属性支持逗号分隔，自然 transition 缩写属性也支持逗号分隔多个独立的过渡效果设置。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79684475169207140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   transition: opacity 0.2s, transform 0.5s;\n}`, `79684475169207140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> opacity 0.2s<span class="token punctuation">,</span> transform 0.5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="transition-timing-function-属性"><a href="#transition-timing-function-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition-timing-function 属性</h3>\n<p>transition-timing-function 属性通过设置过渡时间函数来影响过渡效果的过渡速率，transition-timing-function 属性和 animation-timing-function 支持的属性值类型一致，总共分为三大类。</p>\n<ul>\n<li>线性运动类型：使用 linear 表示。</li>\n<li>三次贝塞尔时间函数类型：ease、ease-in、ease-out、ease-in-out 等关键字和 cubic-bezier() 函数。</li>\n<li>步进时间函数类型：step-start、step-start 等关键字和 steps() 函数。</li>\n</ul>\n<p>transition-timing-function 属性平常用得很少，因为默认值 ease 就可以应付几乎所有场景了。</p>\n<p>例如我写了 10 多年 CSS 代码，在 CSS Transition 过渡效果中从未使用过线性运动类型和步进时间函数类型（对天发誓一次都没有用过），不过我倒是在 CSS 动画效果中经常用到它们，因此这部分内容会在 5.4 节深入介绍。至于贝塞尔时间函数类型，则偶尔会在 CSS Transition 过渡效果中用到，因此，可以在这里详细介绍一下。</p>\n<h2 id="了解三次贝塞尔时间函数类型"><a href="#%E4%BA%86%E8%A7%A3%E4%B8%89%E6%AC%A1%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解三次贝塞尔时间函数类型</h2>\n<p>“贝塞尔”源于著名的法国工程师 Pierre Bézier 的名字，Pierre Bézier 最杰出的贡献是发明了贝塞尔曲线，奠定了计算机矢量图形学的基础，因为有了贝塞尔曲线之后，无论是直线或曲线都能在数学上予以描述。</p>\n<p>三次贝塞尔时间函数类型写作 <code class="language-text">&lt;cubic-bezier-timing-function&gt;</code>，其正式语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57572054502237300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<cubic-bezier-timing-function> = ease | ease-in | ease-out | ease-in-out | cubic-bezier(<number>, <number>, <number>, <number>)`, `57572054502237300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css">&lt;cubic-bezier-timing-function> = ease | ease-in | ease-out | ease-in-out | <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>&lt;number><span class="token punctuation">,</span> &lt;number><span class="token punctuation">,</span> &lt;number><span class="token punctuation">,</span> &lt;number><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，ease、ease-in、ease-out、ease-in-out 这几个关键字是计算机领域通用的运动函数关键字，其贝塞尔函数值是固定的，在其他图形语言中也是适用的，具体分析如下。</p>\n<ul>\n<li>\n<p>ease：等同于 cubic-bezier(0.25, 0.1, 0.25, 1.0)，是 transition-timing-function 属性的默认值，表示过渡的时候先加速再减速。该时间函数曲线如图 5-53 所示，横坐标是时间，纵坐标是进程，曲线越陡速率越快，曲线越缓速率越慢。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-1857e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 448px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 83.92857142857143%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABv0lEQVQ4y51Sa0/CMBTl//8NozEmM8IY88Ujg4kiMSQMmZion4TSbcDeK9vwuAaismniydbc297Tc3rb0maLNE3jJEGgr9yDyRtz3aVtr1arKIqWy6Wu6+12u9frua67o5R2UZIktm2zMDQd99W0PMdBCqamadVqtdFovGTwfT+f7DhOGIZRGMUMm4SbdNPpdBRF8TwPBXw1ydzlK/sZ4A2pqqrdbhdLmCGEgIxgvV7nk8FhjAVBgHQ8HrdaLc60LAviLLMTx3GhbTBRAQuiKIKG1DRNMHF4xL8pc2OI4XY4HCKglMIOtgsy/EGGN1yMLMso5W6hGW6ByULboCHo9/uDwQCCuGSutgP2yldGHb/YmlSbE4LSr5qFynhbGNEYLI80raUquErf84M95JyZk2HSoPRUKtObCTsZ+SkL9viFZMyey+fqbdebLdzHdz8KIP4DP8+cZuAJxNHtz+alaVKAXfG3hv0DpemM4IMfapjYlbcUDmczQuZzahj4MWIVGV74dEoWi4VhWJSaJbEqX9cVlN7dP4CsPz3Xm0pbvb24vD6rSFLtoiJfCeXKZV1pNpVTQTw8Ek4E4Vgon5WlDyJRwvVhonrbAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 13 36" title="" data-src="/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-1857e.png" data-srcset="/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-15195.png 200w,\n/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-82e6d.png 400w,\n/static/2022-03-03-16-13-36-6ab767735806636e91329bc072e4935d-1857e.png 448w" data-sizes="(max-width: 448px) 100vw, 448px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>ease-in：等同于 cubic-bezier(0.42, 0, 1.0, 1.0)，表示过渡速度刚开始慢，然后过渡速度逐渐加快。单词 in 表示进入的意思，非常符合先慢后快，例如剑插入剑鞘，线穿进针里，都是先慢慢瞄准，再快速进入的。该时间函数曲线如图 5-54 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-7ace1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 483px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 76.39751552795032%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABTElEQVQoz41Qf0/CMBTk+38ZEv+AZTMoIGUVMIvBsSEmrsA0bBNRxmQ/PWwGNVnFW9I1r3fv7r1aUSLP8zRNCzmSJFm4L4nAqYniMAx3Vdhut+g7Go36us6ZFWLwvqoQx/FqtWo0GriIWc6LUUSiVqvlOI5oWxE7+g0+iGEYlFIQ0EvqLIq5J6Z1XVdV1f1+jyLOf8UGdfMDRVHW6zVWjcqZmbknTghwapqGUbMs42uXOqM3fPAMEr9gSZZl4enYUeqMZ8/z+JLeNxt4WqaJ+nERfzlD7Ps+qHA7pGVMVJ4RY2bGWL1eV5rNpf/6eT/fXTxERRKFu6NYGhtA4yAIcMmKPH4Ls8VHzruWKA5fWYD49CABVn3KVvL4v9bu9MzJ47PDprMn5BuPTXs6my9d2572CL3uEqLftok+GAyHd0af0Eut3bkhOh1cdfVvymlbGaVQRUwAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 18 42" title="" data-src="/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-7ace1.png" data-srcset="/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-7e8e5.png 200w,\n/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-0f3db.png 400w,\n/static/2022-03-03-16-18-42-460ea4451f59caad135ce514fabefd60-7ace1.png 483w" data-sizes="(max-width: 483px) 100vw, 483px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>ease-out：等同于 cubic-bezier(0, 0, 0.58, 1.0)，表示过渡刚开始速度快，然后速度逐渐变慢。单词 out 表示移出的意思，非常符合先快后慢，例如拔剑是先快后慢。该时间函数曲线如图 5-55 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-28759.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 500px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABc0lEQVQoz41SaW+CQBT0//+LfmzStJVqLJdS75K2pvaiar+QBnBVLkXktCNEQi90Asvj7U5m3ttX2uYQhmEWR3GMtSprdyqJvc3DYNBoNEzTRDJOtoBSnuwkWO/hrFaO55HZnOc4URRlWfY8L3/+GxkE13U3CRBHUTQnhKFpRVGQATNv7V9yyiSE1Go1WF3BguMgf4CcAiKWZTEMo+v6crlMmcgHQXCAnNpmWVZV1UwTjg6QcQJHEfT7fUmS0v6lzHQtsg0dlDoajbrd7q7bCTNDERkbtmWjPTRNG4aR+ndzKLLt+761XvF1fjKZhFGY3dlRysCjcNu+aYEJ/+tfQBU/lfejtsVXPxHNTxLEoe/5f6JIOT+3x6CkaVPbXuJBVVEYuUmtGBJoo22z+cIyMS/2QjcME7/zhb6L8Nq2XSpT1eHT65v0rmhTtLoutIfPL+Pxh3g/aLW7VOWaYXiOFSoVrtfrcELzkro6PSufX1DNTu8L9G1XAoeUOgoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 19 34" title="" data-src="/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-28759.png" data-srcset="/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-6ac48.png 200w,\n/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-4b8bf.png 400w,\n/static/2022-03-03-16-19-34-d25d89e23d0100cf9f92a00d089df640-28759.png 500w" data-sizes="(max-width: 500px) 100vw, 500px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>ease-in-out：等同于 cubic-bezier(0.42, 0, 0.58, 1.0)，表示过渡刚开始速度慢，然后速度逐渐加快，最后再变慢。该时间函数曲线如图 5-56 所示。ease-in-out 是一个对称曲线，因此非常适合用在钟摆运动中。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-8163f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 537px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.45996275605214%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABT0lEQVQoz42Si2qDMBSGff83kmy4KvVSpWvHhsiQWsvGYDpdovUe99dUcWO0/VFIDuc7txypn4lz3rYtH9R2HSzqR2Qc3vu6etxsVFUty1K4CX9pDoNkjBUzZXmOKNvt1jCMKIq6IeKkv3CWZeUowEjieZ6u61VV1XV9HRY5j8cjgDiOCSEiIoxX4KlswHBVFCUMQ9hxvRXO8xwF+76PVmEX5K0wikSpsizjiuKn+V2C4Qdv5GmaBjkxKpF2GuElOE1TSik8gAHmHRdV3ApDrutiTnjhsqmLsdv/y57WBcJLmqZ5R8hnEievb7nsFW0157EwfNgwoV+ZxczO4eq2p1V/UVIcf6EZBD9hI4+BDXiTpGly+tHNN6UMH2PZeKYSIUoQhC+uR1mGg2U7u2C/2x98f7d5erbt9ULTrZVj6I7jrFe2pWjL+wdNWxoLdfkDOFchEq0BVhgAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 20 28" title="" data-src="/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-8163f.png" data-srcset="/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-e0dce.png 200w,\n/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-184d7.png 400w,\n/static/2022-03-03-16-20-28-2bc3e878a98139817e34e1adbee3fdb6-8163f.png 537w" data-sizes="(max-width: 537px) 100vw, 537px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ul>\n<h3 id="cubic-bezier-函数"><a href="#cubic-bezier-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cubic-bezier() 函数</h3>\n<p>贝塞尔曲线种类很多，包括线性贝塞尔曲线、二次方贝塞尔曲线、三次方贝塞尔曲线、四次方贝塞尔曲线、五次方贝塞尔曲线等。cubic-bezier() 函数是三次方贝塞尔曲线函数。所有三次方贝塞尔曲线都是由起点、终点和两个控制点组成，在 SVG 或者 Canvas 中，三次方贝塞尔曲线的所有控制点都是不固定的。但是在 CSS 的 cubic-bezier() 函数中，起点和终点的坐标是固定的，分别是 (0, 0) 和 (1, 1)，因此，cubic-bezier() 函数支持的参数值只有 4 个，代表了两个控制点的坐标，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16846890167419271000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cubic-bezier(x1, y1, x2, y2);`, `16846890167419271000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">cubic-bezier</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中坐标 (x1, y1) 表示控制点 1 的坐标，坐标 (x2, y2) 表示控制点 2 的坐标。</p>\n<p>例如 ease 关键字对应的贝塞尔曲线函数 cubic-bezier(0.25, 0.1, 0.25, 1.0) 的曲线图就是根据 (0.25, 0.1) 和 (0.25, 1.0) 这两个控制点坐标生成的，如图 5-57 所示。</p>\n<p>有一个网站（cubic-bezier）专门用来调试 CSS 的贝塞尔曲线函数值，图 5-57 所示的曲线图就是使用这个网站生成的。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-8682f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 556px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 67.62589928057554%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABlklEQVQoz42S+0/CMBDH+f//I3/wkel0AntJphAC2gFOwOlgfazb2vodiw+iAS/X5nK9T+96vY6BaN3sjBnLMv2+GQxMFJn53Ewme6dQKU1dm0/pfFkKXs7es03vacbSVOR5miR3g4HneevXVzMe6zA0cWwo/brxG67rmgnBpExzKqtqMp3edruEkMVikef5Ll6bfdmHGROcG6VIHLuuW5Yl57woivpHqYdgKWWWZY7jgISBnIBhH4GVUpRS7EEQJElCdwISyY/DyIzQNH3zXI/RnCKnEHhFA6PJh2GQqDl6uJ/Ej1IpUZatcinLA29um8gZWy5fHMsWZCVncfGyLFYrqEjTarM5VrY2ttsfhcOiNxX2pfB9EYZQPhqV+N6/4fb3CMFgZb1e9fxcNxfpZm9Va/UL07v1CaOw9dpkWTOD/5YO5qL9XlxfaY0Obbd5I5QyzjGtm+2WY/I4h1KEMo5zeOHsDIdjMpszymaEuF7geuHZhXVp31g3jusHMC4su+/5J6fn1tX1tXPr+2FwFzlONxqOPwBExh/GtYqV3AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 30 38" title="" data-src="/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-8682f.png" data-srcset="/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-7747b.png 200w,\n/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-f30a5.png 400w,\n/static/2022-03-03-16-30-38-05a53b80cdb4da3cd52fb9fc9b2f1520-8682f.png 556w" data-sizes="(max-width: 556px) 100vw, 556px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在初期的时候，cubic-bezier() 函数值的取值范围是 0 ～ 1，如果超过 1 会被认为是不合法的，不过现在浏览器早已放开了这个限制，因此，我们可以使用 cubic-bezier() 函数实现回弹效果。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91932193318487030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.target {\n   transition: 1s cubic-bezier(0.16, 0.67, 0.28, 1.46);\n}\n\n.target.run {\n   transform: translateX(200px);\n}`, `91932193318487030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.target</span> <span class="token punctuation">{</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> 1s <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.16<span class="token punctuation">,</span> 0.67<span class="token punctuation">,</span> 0.28<span class="token punctuation">,</span> 1.46<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.target.run</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>200px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>.target 元素的运动轨迹如图 5-58 所示，元素会运动到超出 200px 的位置，然后回到 200px 的位置，形成回弹效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-715c5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 658px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.99088145896657%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABL0lEQVQoz42RuU7DQBCG/QrQ8Ez08ABI1KkjngKJAhqoIDQIahqEoCMREjQkXjvEweeydhJfi7MXXid2HCQM/zSrmf+bQ6uIUjwPISZxGJGvuFAURRhjx3EghNLAuViXUqKywKyZ37qanTwyISghtJT4RSXMJEz0T3OzjXZOq0zZmTfCCxMmWXdMgFySGoG/fxke3i8b5Txh9Y4/4foWcwCtrQO0e7aCeePkpa+AeUbnfY/a0wWTXL/A7WN8+1a/SBF/qrDGnZ650U46PZmh7B8wkSZ8p6K9i/TmlQUJT7K1tXmDiPyk6PzJUFrh0YO8hbCqmL8aJxen8QkmzyZHcZVZTdb0oeN5EKE0xaZt+0HgOnl4eU7T3wcq+HBcGE4t1wW5dTjqD1QVaCNjDID+De/1dAyxYZ6HAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 16 33 28" title="" data-src="/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-715c5.png" data-srcset="/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-c456f.png 200w,\n/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-60786.png 400w,\n/static/2022-03-03-16-33-28-ea743ce7136bf50babd83cb976e93219-715c5.png 658w" data-sizes="(max-width: 658px) 100vw, 658px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>最后，附上其他一些非 CSS 标准，但也属于常用缓动类型的贝塞尔曲线值，为了方便调用，这里使用了 CSS 自定义属性表示，具体如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3302153473068259000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`:root {\n   --ease-in-quad: cubic-bezier(0.55, 0.085, 0.68, 0.53);\n   --ease-in-cubic: cubic-bezier(0.55, 0.055, 0.675, 0.19);\n   --ease-in-quart: cubic-bezier(0.895, 0.03, 0.685, 0.22);\n   --ease-in-quint: cubic-bezier(0.755, 0.05, 0.855, 0.06);\n   --ease-in-expo: cubic-bezier(0.95, 0.05, 0.795, 0.035);\n   --ease-in-circ: cubic-bezier(0.6, 0.04, 0.98, 0.335);\n   --ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94);\n   --ease-out-cubic: cubic-bezier(0.215, 0.61, 0.355, 1);\n   --ease-out-quart: cubic-bezier(0.165, 0.84, 0.44, 1);\n   --ease-out-quint: cubic-bezier(0.23, 1, 0.32, 1);\n   --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);\n   --ease-out-circ: cubic-bezier(0.075, 0.82, 0.165, 1);\n   --ease-in-out-quad: cubic-bezier(0.455, 0.03, 0.515, 0.955);\n   --ease-in-out-cubic: cubic-bezier(0.645, 0.045, 0.355, 1);\n   --ease-in-out-quart: cubic-bezier(0.77, 0, 0.175, 1);\n   --ease-in-out-quint: cubic-bezier(0.86, 0, 0.07, 1);\n   --ease-in-out-expo: cubic-bezier(1, 0, 0, 1);\n   --ease-in-out-circ: cubic-bezier(0.785, 0.135, 0.15, 0.86);\n}`, `3302153473068259000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">:root</span> <span class="token punctuation">{</span>\n   <span class="token property">--ease-in-quad</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.55<span class="token punctuation">,</span> 0.085<span class="token punctuation">,</span> 0.68<span class="token punctuation">,</span> 0.53<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-cubic</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.55<span class="token punctuation">,</span> 0.055<span class="token punctuation">,</span> 0.675<span class="token punctuation">,</span> 0.19<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-quart</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.895<span class="token punctuation">,</span> 0.03<span class="token punctuation">,</span> 0.685<span class="token punctuation">,</span> 0.22<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-quint</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.755<span class="token punctuation">,</span> 0.05<span class="token punctuation">,</span> 0.855<span class="token punctuation">,</span> 0.06<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-expo</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.95<span class="token punctuation">,</span> 0.05<span class="token punctuation">,</span> 0.795<span class="token punctuation">,</span> 0.035<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-circ</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.6<span class="token punctuation">,</span> 0.04<span class="token punctuation">,</span> 0.98<span class="token punctuation">,</span> 0.335<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-quad</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.25<span class="token punctuation">,</span> 0.46<span class="token punctuation">,</span> 0.45<span class="token punctuation">,</span> 0.94<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-cubic</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.215<span class="token punctuation">,</span> 0.61<span class="token punctuation">,</span> 0.355<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-quart</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.165<span class="token punctuation">,</span> 0.84<span class="token punctuation">,</span> 0.44<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-quint</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.23<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0.32<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-expo</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.19<span class="token punctuation">,</span> 1<span class="token punctuation">,</span> 0.22<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-out-circ</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.075<span class="token punctuation">,</span> 0.82<span class="token punctuation">,</span> 0.165<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-quad</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.455<span class="token punctuation">,</span> 0.03<span class="token punctuation">,</span> 0.515<span class="token punctuation">,</span> 0.955<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-cubic</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.645<span class="token punctuation">,</span> 0.045<span class="token punctuation">,</span> 0.355<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-quart</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.77<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.175<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-quint</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.86<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.07<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-expo</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">--ease-in-out-circ</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.785<span class="token punctuation">,</span> 0.135<span class="token punctuation">,</span> 0.15<span class="token punctuation">,</span> 0.86<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="transition-与-visibility-属性的应用指南"><a href="#transition-%E4%B8%8E-visibility-%E5%B1%9E%E6%80%A7%E7%9A%84%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transition 与 visibility 属性的应用指南</h2>\n<p>如果希望元素在出现和隐藏时有淡入淡出或者移入移出效果，则建议使用 visibility 属性对元素进行隐藏与控制。原因很简单，因为 visibility 属性是支持 CSS 过渡效果和 CSS 动画效果的。</p>\n<p>这里举一个移动端经常使用的底部 Popup 浮层的案例，实现遮罩层淡入淡出，底部内容移入移出的效果，HTML 代码结构如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1282582894264172500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;popup&quot;>\n   <div class=&quot;content&quot;>底部浮层</div>\n</div>`, `1282582894264172500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>popup<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>底部浮层<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>淡入淡出效果是使用 opacity 属性实现的，但是 opacity: 0 仅仅是在视觉上让浮层元素不可见，浮层元素依然覆盖在页面上，影响正常的交互，因此，需要使用其他方法来真正隐藏浮层元素。由于 display: none 不支持过渡效果，因此只能使用 visibility: hidden 声明来实现，核心 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91041470315573230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.popup {\n   position: fixed;\n   left: 0;\n   right: 0;\n   bottom: 0;\n   top: 0;\n   background: rgba(0, 0, 0, 0.5);\n   overflow: hidden;\n   /* 显隐控制关键 css 代码 */\n   opacity: 0;\n   visibility: hidden;\n   transition: opacity 0.2s, visibility 0.2s;\n}\n\n.content {\n   /* 底部浮层移入移出控制关键 css 代码 */\n   transform: translateY(100%);\n   transition: transform 0.2s;\n}\n\n/* 通过切换 “active” 类名实现交互效果 */\n.popup.active {\n   transition-property: opacity;\n   opacity: 1;\n   visibility: visible;\n}\n\n.active > .content {\n   transform: translateY(0%);\n}`, `91041470315573230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.popup</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token comment">/* 显隐控制关键 css 代码 */</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> opacity 0.2s<span class="token punctuation">,</span> visibility 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.content</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* 底部浮层移入移出控制关键 css 代码 */</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>100%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> transform 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* 通过切换 “active” 类名实现交互效果 */</span>\n<span class="token selector">.popup.active</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">;</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.active > .content</span> <span class="token punctuation">{</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>0%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>淡入淡出和移入移出没什么好讲的，就是属性的变化，这里比较有意思的是 visibility 对元素显隐的控制。根据定义，当过渡时间函数的值在 0 ～ 1 的时候，visibility 的计算值是 visible，也就是显示；如果时间函数大于 1 或者小于 0，则 visibility 属性的计算值由设置的起止点值决定，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56240037907467256000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.popup {\n   visibility: hidden;\n   transition: visibility 2s cubic-bezier(0.25, 0.5, 0, -1);\n}\n\n.popup.active {\n   visibility: visible;\n}`, `56240037907467256000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.popup</span> <span class="token punctuation">{</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> visibility 2s <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.25<span class="token punctuation">,</span> 0.5<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> -1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.popup.active</span> <span class="token punctuation">{</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，.popup 元素会出现先显示，再隐藏，再显示的过渡效果。因为 <code class="language-text">cubic-bezier(0.25, 0.5, 0, -1)</code> 时间函数曲线的一部分在时间轴的下方，这段时间内会按照设置的过渡效果的起始状态，也就是 visibility: hidden 渲染，如图 5-59 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-f1168.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 796px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.321608040201%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAtUlEQVQY05WQXwuCMBTF/f6fKMjSlLQ5zELKIp+KiaDsIaOx/y2rl5hkh8HutvO7h11HD0hKSSklhDRNM+Rxhh6ElOR6r+saY2yOSqlR8Mt36zp0KiuEGOd/J0vO8eVM21bbMn/AT54xTYgWYiysepmCCcF67HOhv35uaqffLF25UmZmRtaJvJMBhMWxRKja5jvfC92ZP50vwmiVJGm4jPbFIYhBFIN0nQFoFsw2uesFxjZxvQfAJ87Z028zJwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 17 47 20" title="" data-src="/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-f1168.png" data-srcset="/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-ad772.png 200w,\n/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-4f4c3.png 400w,\n/static/2022-03-03-17-47-20-7a5c4d677857bef9ef4d5abf418dca4c-f1168.png 796w" data-sizes="(max-width: 796px) 100vw, 796px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由于在实际开发中时间函数的值小于 0 的情况很罕见，因此，我们可以认定 visibility 属性的过渡效果是显示的时候立即显示，隐藏的时候遵循 transition-duration 设置的时间延时隐藏。于是理论上，我们只需要一行 transition 属性代码就可以实现想要的效果，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95592001992913530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.popup {\n   opacity: 0;\n   visibility: hidden;\n   /* transition 如下设置即可 */\n   transition: opacity 0.2s, visibility 0.2s;\n}\n\n.popup.active {\n   opacity: 1;\n   visibility: visible;\n}`, `95592001992913530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.popup</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token comment">/* transition 如下设置即可 */</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> opacity 0.2s<span class="token punctuation">,</span> visibility 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.popup.active</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，不知道是浏览器故意为之还是其他什么原因，在过去的 Chrome 浏览器和现在的 Firefox 浏览器中，通过类名增减触发 transition 过渡效果的时候，元素是在 transition-duration 设置的时间结束的时候才突然显示，而通过 :hover 伪类触发的过渡行为则没有此问题。</p>\n<p>因此，在实际开发的时候，为了安全考虑，需要在触发结束状态的 CSS 代码那里重置下 transition-property 值，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2653245670998028000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.popup.active {\n   /* visibility 属性不参与过渡效果，因此元素会立即显示 */\n   transition-property: opacity;\n   opacity: 1;\n   visibility: visible;\n}`, `2653245670998028000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.popup.active</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* visibility 属性不参与过渡效果，因此元素会立即显示 */</span>\n   <span class="token property">transition-property</span><span class="token punctuation">:</span> opacity<span class="token punctuation">;</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>点击演示页面中心的按钮即可体验，效果如图 5-60 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-effe6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 421px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 85.03562945368171%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB5klEQVQ4y5WQ3WvTUBjG87cJ3viBiOiFsgt10AvbtN1Jcprs5CRFUObUKW4mYVQG4tQEBFH2gZu2xLUUhsPhzZq7ki4fqwPXSZNiMw8pjurFUn8cXs457/vwPOdQR0NEUUTqu6WPd6aVmdln9x+Xph7O33tUuj31dOHFm+OBY6jhQ7/fJ/XBk9LpC2MXr6bOXxk/e3n8zKXrp85dm5i8Gw8kiReeL95I3cqzfI7h86yQBfBmKjM9MzuSs67rEEKMMcMwAACERAgLiqIkiAc9wzB4nkcIZTKZdDpN9oIgaJo2kvPiy1d0No+QPIkkFC8AuLk5ZdTYYALIskySY1GSJJmYq2qycxSLjVyO46DAQshBHkCGztKaqo3obNA0+TBZFLGIkYgxy7KqqiaJ455uGCwHi8WiFEPy/8eH6a91Js/IUvxmjIm+UCgkOw96ruM2vjWshrXT2CFYlkVqs9lMEP9DGIZBEJwwQJGog6dGMYPww/z6s4n+hlyc5JwIZdv2ruP1ej3H9YKwRxw6ncNutxsE4Y+Dg13HJcv329/b+67ne96e3Wq5/p7n+XbLoZZXV8pmzbZby6trncOf++32h/XK1va2uVGtb26WKxvkvmJWv2x9Nat183Pt7ful9U+VWrW+slb+DYziYXDRq6yqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 03 17 54 04" title="" data-src="/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-effe6.png" data-srcset="/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-94cd7.png 200w,\n/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-851bf.png 400w,\n/static/2022-03-03-17-54-04-721f145409e12926e43b8c32e0cbd7e7-effe6.png 421w" data-sizes="(max-width: 421px) 100vw, 421px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/821nfn?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="css-动画"><a href="#css-%E5%8A%A8%E7%94%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 动画</h1>\n<p>本节深入介绍 CSS 动画相关知识，知识量较大，但都很重要，相信大家一定可以学到很多东西。</p>\n<p>先从常用的淡出动画效果说起：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92641605665392600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.fade-in {\n   animation: fadeIn 0.25s;\n}\n\n@keyframes fadeIn {\n   from {\n      opacity: 0;\n   }\n\n   to {\n      opacity: 1;\n   }\n}`, `92641605665392600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.fade-in</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.25s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面逐一分析上述代码中的项。</p>\n<ul>\n<li>fadeIn 是开发者自己定义的动画名称，命名限制不多，具体命名规则在下面有介绍。</li>\n<li>.25s 是 0.25s 的简写，表示动画执行的时间。</li>\n<li>animation 是调用自定义动画规则的 CSS 属性。</li>\n<li>@keyframes 规则用来定义动画的关键帧。</li>\n</ul>\n<p>一个 CSS 动画效果要想出现，动画名称、动画时间、animation 属性和 @keyframes 规则是必不可少的基本单元。CSS 动画自然还包括其他特性，例如动画次数、动画顺序的控制等，但是这些特性不是必需的，因此，单从入门和上手这个角度看，CSS 动画算是简单的。但是，上手简单并不代表 CSS 动画是简单的，随着本节学习内容的逐渐深入，你一定会发现 CSS 动画可以做的事情远远超出了你的想象。下面就先从最基本的 animation 属性说起。</p>\n<h2 id="初识-animation-属性"><a href="#%E5%88%9D%E8%AF%86-animation-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>初识 animation 属性</h2>\n<p>animation 属性是多个 CSS 属性的缩写，这些属性包括 animation-name、animation-duration、animation-timing-function、animation-delay、animation-iteration-count、animation-direction、animation-fill-mode 和 animation-play-state。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91772521847651040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* animation: name | duration | timing-function | delay | iteration-count | direction | fill-mode | play-state */\nanimation: fadeIn 3s ease-in 1s 2 reverse both paused;`, `91772521847651040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* animation: name | duration | timing-function | delay | iteration-count | direction | fill-mode | play-state */</span>\n<span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 3s ease-in 1s 2 reverse both paused<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>animation 属性支持同时应用多个动画规则，例如实现元素淡出和右侧划入同时进行的动画效果。正确做法是分隔设置，而不是设置在一个动画规则中，也就是不推荐使用下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92929970673153360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: fadeInSlideInRight 0.2s;\n}\n\n@keyframes fadeInSlideInRight {\n   from {\n      opacity: 0;\n      transform: translateX(100%);\n   }\n\n   to {\n      opacity: 1;\n      transform: translateX(0%);\n   }\n}`, `92929970673153360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeInSlideInRight 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeInSlideInRight</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>100%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而是推荐将代码分隔成多个独立的动画规则，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46164589067291350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: fadeIn 0.2s, slideInRight 0.2s;\n}\n\n@keyframes fadeIn {\n   from {\n      opacity: 0;\n   }\n\n   to {\n      opacity: 1;\n   }\n}\n\n@keyframes slideInRight {\n   from {\n      transform: translateX(100%);\n   }\n\n   to {\n      transform: translateX(0%);\n   }\n}`, `46164589067291350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.2s<span class="token punctuation">,</span> slideInRight 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> slideInRight</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>100%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样做的好处在于我们自定义的动画规则可以在其他场合重复利用，例如希望弹框在出现的时候有淡出动画效果，并且我们无须再额外定义淡出动画规则，直接复用即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88918201387007540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dialog {\n   animation: fadeIn 0.2s;\n}`, `88918201387007540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">dialog</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h2 id="keyframes-规则的语法和特性"><a href="#keyframes-%E8%A7%84%E5%88%99%E7%9A%84%E8%AF%AD%E6%B3%95%E5%92%8C%E7%89%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>@keyframes 规则的语法和特性</h2>\n<p>首先 @keyframes 的后面有个“s”，因为动画效果不可能只有 1 个关键帧。@keyframes 规则的语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13285876413754450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes <keyframes-name> {\n   <keyframe-block-list>\n}`, `13285876413754450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> &lt;keyframes-name></span> <span class="token punctuation">{</span>\n   &lt;keyframe-block-list>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>其中 <code class="language-text">&lt;keyframe-block-list&gt;</code> 指的是定义的关键帧列表，每个关键帧由关键帧选择器和对应的 CSS 样式组成。</p>\n<p>关键帧选择器用来指定当前关键帧在整个动画过程中的位置，其支持 from、to 这两个关键字和百分比值。from 关键字等同于 0%，to 关键字等同于 100%。</p>\n<p>也就是说，下面两段 CSS 代码的作用是一样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58075645120904110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes fadeIn {\n   from {\n      opacity: 0;\n   }\n\n   to {\n      opacity: 1;\n   }\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `58075645120904110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面讲一下 @keyframes 规则中你可能不知道的一些特性。</p>\n<h3 id="起止关键帧可以不设置"><a href="#%E8%B5%B7%E6%AD%A2%E5%85%B3%E9%94%AE%E5%B8%A7%E5%8F%AF%E4%BB%A5%E4%B8%8D%E8%AE%BE%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>起止关键帧可以不设置</h3>\n<p>例如定义淡出效果，可以这样设置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46407127481599566000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes fadeInBy {\n   100% {\n      opacity: 1;\n   }\n}`, `46407127481599566000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> fadeInBy</span> <span class="token punctuation">{</span>\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时动画初始状态的透明度就是当前元素的透明度，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89142072359067290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n}\n\n.element.active {\n   animation: fadeInBy 0.2s;\n}`, `89142072359067290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.element.active</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeInBy 0.2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>.element 元素在匹配 .active 类名之后会有透明度从 0.5（初始状态的透明度）变化到透明度 1 的效果。</p>\n<p>但是，这种做法在实际开发的时候并不常见，因为通常会使用更加方便快捷的 transition 属性实现类似的效果。</p>\n<h3 id="关键帧列表可以合并"><a href="#%E5%85%B3%E9%94%AE%E5%B8%A7%E5%88%97%E8%A1%A8%E5%8F%AF%E4%BB%A5%E5%90%88%E5%B9%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关键帧列表可以合并</h3>\n<p>如果关键帧对应的 CSS 样式是一样的，则可以合并在一起书写，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63688505591736600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes blink {\n   0%,\n   50%,\n   100% {\n      opacity: 0;\n   }\n\n   25%,\n   75% {\n      opacity: 1;\n   }\n}`, `63688505591736600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> blink</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%,\n   50%,\n   100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">25%,\n   75%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="不同的关键帧选择器是无序的"><a href="#%E4%B8%8D%E5%90%8C%E7%9A%84%E5%85%B3%E9%94%AE%E5%B8%A7%E9%80%89%E6%8B%A9%E5%99%A8%E6%98%AF%E6%97%A0%E5%BA%8F%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不同的关键帧选择器是无序的</h3>\n<p>虽然动画的执行是有顺序的，从 0% 到 100%，但是在代码层面，不同的关键帧选择器是不分先后顺序的。例如，下面两段 CSS 的效果是一样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73506748747920290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}\n\n@keyframes fadeIn {\n   100% {\n      opacity: 1;\n   }\n\n   0% {\n      opacity: 0;\n   }\n}`, `73506748747920290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="重复定义的关键帧不是完全被覆盖的"><a href="#%E9%87%8D%E5%A4%8D%E5%AE%9A%E4%B9%89%E7%9A%84%E5%85%B3%E9%94%AE%E5%B8%A7%E4%B8%8D%E6%98%AF%E5%AE%8C%E5%85%A8%E8%A2%AB%E8%A6%86%E7%9B%96%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重复定义的关键帧不是完全被覆盖的</h3>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4592335863435437000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes identifier {\n   50% {\n      top: 30px;\n      left: 20px;\n   }\n\n   50% {\n      top: 10px;\n   }\n}`, `4592335863435437000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> identifier</span> <span class="token punctuation">{</span>\n   <span class="token selector">50%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">50%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最终在 50% 这一帧用来动画的 CSS 样式是 top: 10px 和 left: 20px。也就是说，如果关键帧重复定义，则不同的 CSS 样式是累加的，而相同的 CSS 样式是后面的样式覆盖前面的样式，和普通的 CSS 选择器的样式计算规则一致。</p>\n<h3 id="关键帧中的样式可以不连续"><a href="#%E5%85%B3%E9%94%AE%E5%B8%A7%E4%B8%AD%E7%9A%84%E6%A0%B7%E5%BC%8F%E5%8F%AF%E4%BB%A5%E4%B8%8D%E8%BF%9E%E7%BB%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关键帧中的样式可以不连续</h3>\n<p>前后关键帧的 CSS 属性无须保持一致，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84927351242755950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes identifier {\n   0% {\n      top: 0;\n      left: 0;\n   }\n\n   30% {\n      top: 50px;\n   }\n\n   60%,\n   90% {\n      left: 50px;\n   }\n\n   100% {\n      top: 100px;\n      left: 100%;\n   }\n}`, `84927351242755950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> identifier</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">30%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">60%,\n   90%</span> <span class="token punctuation">{</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里，top 属性应用动画的帧是 0%、30% 和 100%，left 属性应用动画的帧是 0%、60%、90% 和 100%。</p>\n<h3 id="important-无效"><a href="#important-%E6%97%A0%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>!important 无效</h3>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91294987764682570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes identifier {\n   0% {\n      top: 30px;\n      /* 无效 */\n      left: 20px !important;\n   }\n\n   100% {\n      top: 10px;\n   }\n}`, `91294987764682570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> identifier</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n      <span class="token comment">/* 无效 */</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 20px <span class="token important">!important</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中 left: 20px 这句 CSS 声明是没有任何效果的。其实，根本就没有必要在 @keyframes 规则语句中使用 !important 提高权重，因为当 CSS 动画执行的时候，关键帧中定义的 CSS 优先级就是最高的。</p>\n<h3 id="优先级最高"><a href="#%E4%BC%98%E5%85%88%E7%BA%A7%E6%9C%80%E9%AB%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优先级最高</h3>\n<p>请看下面这个例子：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="48979669215458484000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<img data-src=&quot;1.jpg&quot; style=&quot;opacity: 0.5;&quot; />\n<style>\n   img {\n      animation: fadeIn 1s;\n   }\n\n   @keyframes fadeIn {\n      0% {\n         opacity: 0;\n      }\n\n      100% {\n         opacity: 1;\n      }\n   }\n</style>`, `48979669215458484000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">img</span> <span class="token punctuation">{</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n      <span class="token selector">0%</span> <span class="token punctuation">{</span>\n         <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token selector">100%</span> <span class="token punctuation">{</span>\n         <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">&lt;img&gt;</code> 元素出现了透明度从 0 到 1 的动画效果，这就表明 @keyframes 规则中的 CSS 优先级要比 style 属性设置的 CSS 属性的优先级要高。接下来我们更进一步，使用 CSS 世界中优先级最高的 !important 语法：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="90165825716931900000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<img data-src=&quot;1.jpg&quot; style=&quot;opacity: 0.5!important&quot; />`, `90165825716931900000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.jpg<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token important">!important</span></span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>结果是 Chrome 浏览器、IE 浏览器、Edge 浏览器和 Safari 浏览器均出现了透明度动画效果，只有 Firefox 浏览器中的 <code class="language-text">&lt;img&gt;</code> 元素一直保持 0.5 的透明度。这表明在 Firefox 浏览器中，@keyframes 规则中的 CSS 优先级大于 style 设置的 CSS 属性，小于 !important 语法中的 CSS 属性，而其他所有浏览器 @keyframes 规则中的 CSS 优先级最高。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/0dpt35?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>根据以往的经验，规范中没有定义到的特性会随着浏览器版本的升级而进行调整，因此说不定过几年 Firefox 浏览器也会把 @keyframes 规则中的 CSS 优先级调至最高。</p>\n<p>@keyframes 规则优先级最高的这个特性为重置页面中第三方 JavaScript 设置的内联样式提供了一种新的思路。不过，此方法也有局限，就是不支持动画的 CSS 属性是无法重置的，例如我们无法在 @keyframes 规则中设置 display: block 去重置 display: none，因此对于 Adblock 这类去广告插件还是无解。</p>\n<h2 id="动画命名与-custom-ident-数据类型"><a href="#%E5%8A%A8%E7%94%BB%E5%91%BD%E5%90%8D%E4%B8%8E-custom-ident-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动画命名与 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型</h2>\n<p>按照规范，动画的名称可以是下面两种数据类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36189916639194796000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<custom-ident> | <string>`, `36189916639194796000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css">&lt;custom-ident> | &lt;string></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中，<code class="language-text">&lt;string&gt;</code> 数据类型表示需要带引号的字符串，例如，下面 CSS 代码中的 <code class="language-text">&#39;...&#39;</code> 和 <code class="language-text">&#39;Microsoft Yahei&#39;</code> 就是 <code class="language-text">&lt;string&gt;</code> 数据类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44453609493871985000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`content: \'...\';\nfont-family: \'Microsoft Yahei\';`, `44453609493871985000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'...\'</span><span class="token punctuation">;</span>\n<span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'Microsoft Yahei\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>因此，理论上 CSS 动画也是支持使用引号命名的动画效果的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37518207110812420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: \'hello world\' 2s;\n}\n\n@keyframes \'hello world\' {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `37518207110812420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> <span class="token string">\'hello world\'</span> 2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> <span class="token string">\'hello world\'</span></span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际测试下来，仅 Firefox 浏览器支持 <code class="language-text">&lt;string&gt;</code> 数据类型的 CSS 动画名称，Chrome 浏览器和 IE 浏览器均认为这是不合法的语法。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/20bshq?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>因此，我们的注意力还是放在兼容性更好的 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型上。CSS 中可以自定义的名称均是 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型，例如 counter-reset 和 counter-increment 属性中自定义的计数器，CSS 网格布局中对行和列的命名等。故 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型是一学百用的。</p>\n<h3 id="custom-ident-数据类型语法"><a href="#custom-ident-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">&lt;custom-ident&gt;</code> 数据类型语法</h3>\n<p><code class="language-text">&lt;custom-ident&gt;</code> 数据类型的语法和 CSS 的标识符（例如，CSS 属性就属于 CSS 标识符）很相似，区别就在于 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型是区分大小写的。<code class="language-text">&lt;custom-ident&gt;</code> 数据类型可以由下面这些字符进行组合：</p>\n<ul>\n<li>任意字母（a ～ z 或 A ～ Z）；</li>\n<li>数字（0 ～ 9）；</li>\n<li>短横线（-）；</li>\n<li>下划线（_）；</li>\n<li>转义字符（使用反斜杠 \\ 转义）；</li>\n<li>Unicode 字符（反斜杠 \\ 后面跟十六进制数字）。</li>\n</ul>\n<p>由于 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型区分大小写，因此 id1、Id1、ID1 和 iD1 是不同的名称。而一些看起来差异很大的名称却是相同的，例如，☺ 和 \\263a 其实是相同的，因此，下面 CSS 代码中的 CSS 动画是可以执行的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62328780575751110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: ☺ 2s;\n}\n\n@keyframes \\263a {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `62328780575751110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> ☺ 2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> \\263a</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面通过案例说一说 <code class="language-text">&lt;custom-ident&gt;</code> 数据类型的合法性。</p>\n<ol>\n<li>\n<p>不能是 CSS 属性本身支持的关键字，例如 animation 属性支持关键字 none，也支持全局关键字 unset、initial 和 inherit。因此，在 CSS 动画中，不能把动画名称定义为 none、unset、initial 或 inherit。</p>\n</li>\n<li>\n<p>不能以十进制数字开头。例如，下面的名称就是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20437609761783394000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\n2333fadeIn`, `20437609761783394000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 不合法 */</span>\n<span class="token number">2333</span>fadeIn</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>可以使用短横线作为开头，但是短横线后面不能是十进制数字，也就是说，下面的名称是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32251907819525472000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\n-fadeIn;`, `32251907819525472000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 合法 */</span>\n<span class="token operator">-</span>fadeIn<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>而下面这个名称就不合法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16301178802503346000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\n-2333fadeIn`, `16301178802503346000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 不合法 */</span>\n<span class="token operator">-</span><span class="token number">2333</span>fadeIn</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>除短横线和下划线之外的英文标点字符（包括空格）都需要转义。例如，下面的名称是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91982486358500330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nexample\\.png\nhello\\ world`, `91982486358500330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 合法 */</span>\nexample\\<span class="token punctuation">.</span>png\nhello\\ world</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>而下面这个名称就不合法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80506505849531430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nexample.png\nhello world`, `80506505849531430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/* 不合法 */</span>\nexample<span class="token punctuation">.</span>png\nhello world</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>连续短横线开头的名称在 MDN 文档中被认为是不合法的，但是根据我的测试，除了 IE 浏览器不支持，其他浏览器都认为连续短横线的动画名称是合法的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98689341814044300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 除 IE 浏览器外均合法，即使和 CSS 自定义属性名称一致 */\n.element {\n  --fadeIn: 2;\n  animation: --fadeIn 2s;\n}\n\n@keyframes --fadeIn {\n  0% {\n     opacity: 0;\n  }\n\n  100% {\n     opacity: 1;\n  }\n}`, `98689341814044300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 除 IE 浏览器外均合法，即使和 CSS 自定义属性名称一致 */</span>\n<span class="token selector">.element</span> <span class="token punctuation">{</span>\n  <span class="token property">--fadeIn</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n  <span class="token property">animation</span><span class="token punctuation">:</span> --fadeIn 2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> --fadeIn</span> <span class="token punctuation">{</span>\n  <span class="token selector">0%</span> <span class="token punctuation">{</span>\n     <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">100%</span> <span class="token punctuation">{</span>\n     <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因此，我认为连续短横线开头的名称是合法的。</p>\n</li>\n<li>\n<p>如果是 Unicode 编码转义字符，记得在后面添加一个空格，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31769774843655553000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\n\\233 haha`, `31769774843655553000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n\\233 haha</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h2 id="负延时与即时播放效果"><a href="#%E8%B4%9F%E5%BB%B6%E6%97%B6%E4%B8%8E%E5%8D%B3%E6%97%B6%E6%92%AD%E6%94%BE%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>负延时与即时播放效果</h2>\n<p>animation-delay 可以让动画延时播放，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28989207959788786000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation-delay: 300ms;`, `28989207959788786000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation-delay</span><span class="token punctuation">:</span> 300ms<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>表示动画延时 300ms 播放。</p>\n<p>需要注意的是，如果动画是无限循环的，设置的延时不会跟着循环，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96060299554076260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.loading {\n   animation: spin 1s infinite;\n   animation-delay: 300ms;\n}\n\n@keyframes spin {\n   0% {\n      transform: rotate(0deg);\n   }\n\n   100% {\n      transform: rotate(360deg);\n   }\n}`, `96060299554076260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s infinite<span class="token punctuation">;</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> 300ms<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时 .loading 元素会在延时 300ms 后不断旋转，而不是在延时 300ms 后旋转一圈，再在延时 300ms 后旋转一圈，不断循环。</p>\n<p>想要实现每次动画循环都有延时效果，常用的方法是在自定义动画关键帧处进行设置，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65666043235900195000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.loading {\n   animation: spin 1s infinite;\n}\n\n@keyframes spin {\n   0%,\n   30% {\n      transform: rotate(0deg);\n   }\n\n   100% {\n      transform: rotate(360deg);\n   }\n}`, `65666043235900195000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%,\n   30%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>animation-delay 属性比较经典的应用就是通过设置负值让动画即时播放，播放的位置为动画中间的某一阶段。</p>\n<p>举一个音频波形动画的案例，实现图 5-61 所示的效果，可以用来表示音频文件处于加载态或者播放态。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-45fc4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 522px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.4176245210728%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB70lEQVQoz42S304TQRTGJ9ELJRETrgg+gRpCBK6Ib8FLkJiIBjXRxHtfwIRwwYXSSiu2UhBITKGsQem2JoSi2BZKiOXfbrHtzG63hd1+znEr2NCanmwmc/bM75w5Zz7mVCHth4mbUaRKWBcI5XBmMmhX0cyYT4PKCWaL2LHwKI3bUQqUHZw2x2RJmZTd+oLhJLIVsCWCn2yhN0bh/jgCOvYreJmty/JvQtYTw4M0suUa/HgLd2J0oi0CzyGCGi4vwnBw4sByCHC7mNLwLAPWrWK4EXxdweQRQjraFEhqcINC0tYErfeS6FCaw+0K3hxhWseVZXLvfiVAdsHCNNfnGdz43AJ8dZkqD8QxtIn8KUUPKni6ja6V1iqfVPFiF+P7dGHLpvV+Cp0S7lEbD+zaH3g2R1lM53zOri4SBhaO/z7Vz7On2kZfvFZ5dI/OfTdrwMVXZ0NJjO0hY9XgkRRkOmmfCnSdhsy5SNysawYuRUhn3kM8TNdJornMwNyYYWOlAGHX9Vb9D+fCF0XXujFN0zkXtm2bJct2HLnhnBc5LxSLRS5MsyQ/LoR0hTDkv1/5vGEa0i2XK8zj9YfDkfXEt+iqyo3ScU5/5fG9C868DUzPzM5/WPgYXlKCobkJr1/ufFPvA8HQqhp77fUnNjZ/A5chSyDyMFyYAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 00 29 19" title="" data-src="/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-45fc4.png" data-srcset="/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-31b3a.png 200w,\n/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-60bb2.png 400w,\n/static/2022-03-12-00-29-19-2322d0818e8c1b04bda974a3e623ae83-45fc4.png 522w" data-sizes="(max-width: 522px) 100vw, 522px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>音频波形由一个一个的矩形组成，每一个矩形都会有垂直缩放的动画效果。想要形成此起彼伏的波形运动效果，最好的方法就是给每一个矩形的动画设置延时，例如（这里使用 4 个矩形示意）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85097937712258660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;loading&quot;>\n   <i></i>\n   <i></i>\n   <i></i>\n   <i></i>\n</div>\n<style>\n   .loading i {\n      display: inline-block;\n      border-left: 2px solid deepskyblue;\n      height: 2px;\n      animation: scaleUp 4s linear infinite alternate;\n      margin: 0 1px;\n   }\n\n   .loading i:nth-child(2) {\n      animation-delay: 1s;\n   }\n\n   .loading i:nth-child(3) {\n      animation-delay: 2s;\n   }\n\n   .loading i:nth-child(4) {\n      animation-delay: 3s;\n   }\n\n   @keyframes scaleUp {\n      to {\n         transform: scaleY(10);\n      }\n   }\n</style>`, `85097937712258660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.loading i</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n      <span class="token property">border-left</span><span class="token punctuation">:</span> 2px solid deepskyblue<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> scaleUp 4s linear infinite alternate<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0 1px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.loading i:nth-child(2)</span> <span class="token punctuation">{</span>\n      <span class="token property">animation-delay</span><span class="token punctuation">:</span> 1s<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.loading i:nth-child(3)</span> <span class="token punctuation">{</span>\n      <span class="token property">animation-delay</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.loading i:nth-child(4)</span> <span class="token punctuation">{</span>\n      <span class="token property">animation-delay</span><span class="token punctuation">:</span> 3s<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@keyframes</span> scaleUp</span> <span class="token punctuation">{</span>\n      <span class="token selector">to</span> <span class="token punctuation">{</span>\n         <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>10<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然而，真正运行的时候却发现一个比较严重的问题，由于设置了延时，动画开始执行的时候，后面的矩形都是默认的高度，如图 5-62 所示。这显然不符合预期，矩形的初始高度应该参差不齐才对。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-ba470.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 649px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 67.64252696456087%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABjklEQVQoz42Se0vCUBTA/d4RQR+k/jGhxAiiUvOBEBVWVKAOndbS3O5ed8tlbvfZvXO+yKzL4XDO2f3tvG6KcyaFUc457msEGEhpkuFAaNRRUKuB1DYBQ6y90GCEX3tCs3EQPT9S10otw8S2iG3Kex4kgzc8HAgREepD6nvsMxAGw4ihCPVUAp0ZnMj8iN9Jl7oO7qpxYPlrclZhmT/WlEjS8yaVsqgzhunPmynG2GrypAVR+aRcFKWuIWeSWhNlNLq+CqsV+uFvICU8inDckHTYdGzA8La3ULMhSVk/+xXOKbYEGF/MLPziDuAUb8iZwMeKYwTRTq0fEnrUcg4a1oSy3VtThZN4xhvhbMv2Q7z3ZCJKq5p/+eKHhOw/gsFH+Dec70LZWlL2bMnTzTIaTyEx5vYCZuu2/88jVsXFa9O0/ij4hJ4fhhHB2IHQMIBuAMuyx+OxrgMATMd1hWua9grsQTedyaq913r93nE9XX/PnZyeXRRLldrd/YPS7uTz5XTm8LxQur65vSiU5vA3ysgiwQEEb/oAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 00 35 12" title="" data-src="/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-ba470.png" data-srcset="/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-47540.png 200w,\n/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-ee316.png 400w,\n/static/2022-03-12-00-35-12-7115b36ecdad88df51252e6af9b6e313-ba470.png 649w" data-sizes="(max-width: 649px) 100vw, 649px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>要解决这个问题其实很简单，只要把延时的时间全部换成负数即可，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69918938451082125000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.negative i:nth-child(2) {\n   animation-delay: -1s;\n}\n\n.negative i:nth-child(3) {\n   animation-delay: -2s;\n}\n\n.negative i:nth-child(4) {\n   animation-delay: -3s;\n}`, `69918938451082125000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.negative i:nth-child(2)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -1s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.negative i:nth-child(3)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -2s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.negative i:nth-child(4)</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-delay</span><span class="token punctuation">:</span> -3s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样既保留了各个元素动画的时间差，又实现了动画效果的立即播放，且不会带来各个矩形初始状态尺寸相同的问题。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/q6crqc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="准确理解-animation-delay-负值"><a href="#%E5%87%86%E7%A1%AE%E7%90%86%E8%A7%A3-animation-delay-%E8%B4%9F%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>准确理解 animation-delay 负值</h3>\n<p>提个问题，下面代码的透明度变化是 0.75→1 还是 0.25→1？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67642786242707720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`element {\n   animation: fadeIn 1s linear -0.25s;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `67642786242707720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s linear -0.25s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>相信很多人都会搞错，因为容易受 JavaScript 中 splice() 或者 slice() 函数负值的作用误导。</p>\n<p>在很多语言中，负值表示序列的序号前移，或者时间线往前，于是，很多人就认为 animation-delay: -.25s 就是在整个播放时间线上往前移动 0.25s，因此透明度变化应该是 0.75→1。但实际上并不是这样，其实透明度变化是 0.25→1。</p>\n<p>以上变化其实不难理解，关键点就是理解何为“延时”，例如 animation-delay: 0.25s 表示动画在 0.25s 之后从 0% 开始播放，那 animation-delay: -0.25s 显然就表示在 0.25s 之前就已经从 0% 开始播放，即动画真正播放的时候动画已经执行了 0.25s，因此，我们可见的变化就是 0.25→1 这段过程。</p>\n<h2 id="reverse-和-alternate-关键字的区别和应用"><a href="#reverse-%E5%92%8C-alternate-%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>reverse 和 alternate 关键字的区别和应用</h2>\n<p>animation-direction 属性可以用来控制动画的方向，其本质上是通过控制 @keyframes 规则中定义的动画关键帧执行的方向来实现的。该属性语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21038856800357708000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation-direction: normal; /* 初始值 */\nanimation-direction: reverse;\nanimation-direction: alternate;\nanimation-direction: alternate-reverse;`, `21038856800357708000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation-direction</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span> <span class="token comment">/* 初始值 */</span>\n<span class="token property">animation-direction</span><span class="token punctuation">:</span> reverse<span class="token punctuation">;</span>\n<span class="token property">animation-direction</span><span class="token punctuation">:</span> alternate<span class="token punctuation">;</span>\n<span class="token property">animation-direction</span><span class="token punctuation">:</span> alternate-reverse<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，reverse 和 alternate 这两个关键字都有“相反”的意思，不同之处在于，reverse 关键字是让每一轮动画执行的方向相反，而 alternate 关键字是让下一轮动画的执行方向和上一轮动画的执行方向相反。</p>\n<p>举个例子，实现一个常见的淡入淡出动画效果，这里设置动画播放 2 次：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49134039385602190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   /* fadeIn 动画执行 2 次 */\n   animation: fadeIn 1s 2;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `49134039385602190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* fadeIn 动画执行 2 次 */</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s 2<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>先讲一下这一语法中的几个关键点。</p>\n<ul>\n<li>animation-direction 属性值如果是 normal，那么动画执行的方向是 0%→100%、0%→100%，每一轮的动画方向都是正常的。</li>\n<li>animation-direction 属性值如果是 reverse，那么动画执行的方向是 100%→0%、100%→0%，每一轮的动画方向都是相反的。</li>\n<li>animation-direction 属性值如果是 alternate，那么动画执行的方向是 0%→100%、100%→0%，每 2n + 1 轮的动画方向是相反的。</li>\n<li>animation-direction 属性值如果是 alternate-reverse，那么动画执行的方向是 100%→0%，0%→100%，每 2n 轮的动画方向是相反的。</li>\n</ul>\n<p>由此可见，reverse 和 alternate 关键字的区别是让动画反向播放的轮数不同。从效果表现来看，alternate 关键字的动画效果表现为来回交替播放，这也是为什么 alternate 关键字要被命名为 “alternate”（交替的、来回的）。</p>\n<h3 id="reverse-关键字的应用场景"><a href="#reverse-%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>reverse 关键字的应用场景</h3>\n<p>我有个朋友以前做过一件很傻的事情，就是在一个项目中，有的图形需要顺时针旋转，有的图形需要逆时针旋转（类似图 5-32 所示使用锥形渐变实现的加载图形），于是，我这个朋友就定义了两个旋转动画：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64418144599229630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes spin {\n   from {\n      transform: rotate(0deg);\n   }\n\n   to {\n      transform: rotate(360deg);\n   }\n}\n\n@keyframes spin2 {\n   from {\n      transform: rotate(360deg);\n   }\n\n   to {\n      transform: rotate(0deg);\n   }\n}`, `64418144599229630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin2</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17015004552115532000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.turntable {\n   animation: spin 5s 5;\n}\n\n.loading {\n   animation: spin2 1s infinite;\n}`, `17015004552115532000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.turntable</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 5s 5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin2 1s infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这就是 CSS 动画相关知识不扎实的体现，虽然效果是正常的，但代码实在烦琐。其实无须再额外定义一个逆时针动画，直接使用 reverse 关键字即可，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="842625197250024300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.turntable {\n   animation: spin 5s 5;\n}\n\n.loading {\n   animation: spin 1s reverse infinite;\n}\n\n@keyframes spin {\n   from {\n      transform: rotate(0deg);\n   }\n\n   to {\n      transform: rotate(360deg);\n   }\n}`, `842625197250024300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.turntable</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 5s 5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.loading</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s reverse infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="alternate-关键字的应用场景"><a href="#alternate-%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>alternate 关键字的应用场景</h3>\n<p>先看反例，实现一个钟摆运动。有一些对 CSS 动画不太熟悉的开发者会通过自定义动画关键帧来实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2934798899390034400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.clock-pendulum {\n   transform-origin: top;\n   animation: pendulum 2s infinite;\n}\n\n@keyframes pendulum {\n   0%,\n   100% {\n      transform: rotate(10deg);\n   }\n\n   50% {\n      transform: rotate(-10deg);\n   }\n}`, `2934798899390034400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.clock-pendulum</span> <span class="token punctuation">{</span>\n   <span class="token property">transform-origin</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> pendulum 2s infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> pendulum</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%,\n   100%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">50%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>乍一看好像效果还行，其实是有问题的，除了代码烦琐且需要额外计算之外，最大的问题在于运动效果并不准确，因为此时一个动画周期是 10deg→−10deg→10deg。对于钟摆运动，元素两次到达 0deg 的位置时运动速度最快，但是目前的 CSS 时间函数是无法同时指定两处加速点的，因此，上面这种自以为是的用法是无论如何也不可能实现真实的钟摆运动的。</p>\n<p>唯一且最佳的实现方法就是使用 alternate 关键字，同时使用 ease-in-out 作为时间函数，要知道钟摆运动是使用 ease-in-out 时间函数最具代表性的案例。代码示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5461442901201053000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.clock-pendulum {\n   transform-origin: top;\n   animation: pendulum 1s infinite alternate ease-in-out;\n}\n\n@keyframes pendulum {\n   0% {\n      transform: rotate(-10deg);\n   }\n\n   100% {\n      transform: rotate(10deg);\n   }\n}`, `5461442901201053000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.clock-pendulum</span> <span class="token punctuation">{</span>\n   <span class="token property">transform-origin</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> pendulum 1s infinite alternate ease-in-out<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> pendulum</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>10deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/k93e74?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>不过，凡事无绝对，有些动画需要通过在动画帧中自定义实现，而无法通过 alternate 关键字实现。那么，什么类型的动画无法通过 alternate 关键字实现呢？就是那种来回时间不一致的动画，典型代表就是“呼吸动画”，人的呼吸是吸气快，呼气慢，时间为 3 ～ 7s。这一类模拟人体呼吸节奏的动画都是通过调整 @keyframes 自定义关键帧中间状态的时间来实现的。例如，下面 opacity: 1 的状态就不在 50% 的位置，而是在 70% 的位置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38632570678330370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.breath {\n   animation: breath 7s infinite;\n}\n\n@keyframes breath {\n   0%,\n   100% {\n      opacity: 0;\n   }\n\n   70% {\n      opacity: 1;\n   }\n}`, `38632570678330370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.breath</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> breath 7s infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> breath</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%,\n   100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">70%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="关于-alternate-reverse"><a href="#%E5%85%B3%E4%BA%8E-alternate-reverse" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 alternate-reverse</h3>\n<p>alternate-reverse 关键字的作用是让动画第一次反向播放，然后不断来回播放。</p>\n<p>alternate-reverse 关键字不能写作 reverse-alternate，这样写是不合法的。至于为何将“alternate”写在“reverse”的前面，可能是按照首字母排序的吧。</p>\n<h2 id="动画播放次数可以是小数"><a href="#%E5%8A%A8%E7%94%BB%E6%92%AD%E6%94%BE%E6%AC%A1%E6%95%B0%E5%8F%AF%E4%BB%A5%E6%98%AF%E5%B0%8F%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动画播放次数可以是小数</h2>\n<p>动画播放的次数是可以任意指定的，很多人并不知道。我们可以使用 animation-iteration-count 属性任意指定动画播放的次数，甚至是小数。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29648066025115783000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   animation: fadeIn 1s linear both;\n   animation-iteration-count: 1.5;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `29648066025115783000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s linear both<span class="token punctuation">;</span>\n   <span class="token property">animation-iteration-count</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>动画播放的进度为 0%→100%、0%→50%，也就是在第二轮播放的时候，播放到一半就会停止，此时元素的透明度是 0.5。</p>\n<p>大家千万不要误认为 animation-iteration-count 的属性值不能为小数，该属性对小数也是可以精确解析的，这一点和 z-index 属性不一样。对比两个属性的正式语法就可以看出差别了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52209393280091280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation-iteration-count: infinite | <number>\nz-index: auto | <integer>`, `52209393280091280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation-iteration-count</span><span class="token punctuation">:</span> infinite | &lt;number>\n<span class="token property">z-index</span><span class="token punctuation">:</span> auto | &lt;integer></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>animation-iteration-count 支持的是 <code class="language-text">&lt;number&gt;</code> 数值类型，而 z-index 支持的是 <code class="language-text">&lt;integer&gt;</code> 整数类型。animation-iteration-count 的中文意思是“动画—迭代—数目”，初始值是 1，表示动画播放 1 次就结束了。</p>\n<h3 id="小数值的作用"><a href="#%E5%B0%8F%E6%95%B0%E5%80%BC%E7%9A%84%E4%BD%9C%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小数值的作用</h3>\n<p>小数值的应用场景虽然不多，但是一旦用起来，会让人非常愉悦，因为这非常体现 CSS 技术。例如，淡出效果的 CSS 关键帧代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15890038677873197000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `15890038677873197000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>页面中有些元素处于禁用态，透明度只有 40%，此时，使用完整的 fadeIn 动画就不合适（因为动画帧中的样式优先级太高，会覆盖 40% 透明度）。于是不少人会重新定义一个禁用元素的淡出动画：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93691118288136320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes disableFadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 0.4;\n   }\n}`, `93691118288136320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> disableFadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0.4<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其实大可不必，还是使用 fadeIn 动画，只要把播放次数调整为小数即可。对于 ease 时间函数，透明度提高到 40% 只需要 25% 的完整动画时间，因此，我们只需要播放 0.25 次即可，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21228938314597335000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.visible {\n   animation: fadeIn 0.25s both;\n}\n\n.visible:disabled {\n   animation: fadeIn 1s 0.25 both;\n}`, `21228938314597335000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.visible</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.25s both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.visible:disabled</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s 0.25 both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>HTML 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62091341209900474000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<input value=&quot;可用&quot; /> <input value=&quot;禁用&quot; disabled />`, `62091341209900474000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>可用<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>禁用<span class="token punctuation">"</span></span> <span class="token attr-name">disabled</span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>效果如图 5-63 所示，可以看到禁用态输入框的透明度只有 40%。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-115a3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.68039950062422%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCElEQVQoz5WR4U6DMBSFef83MuuAwjLn0F+LoCbKMrOQuWJChQKlBQ90LhnJUE9uSG/v+Wg5WF3Xaa055+WgqqrKScEAMxCAloGFEGEYEkKiKDI73XWBv4DxyiRJ4jhmjGGnbdt/wEVR4AlGKYVZPSljPsEQmKaRTS+J5W+lDGWZS+Y5L4q/Vp5n5rvOcLbfv+922+PxUFW4Fxfi61rhpDHM2CFNP7LscwL7gS9PLktR12VdIyr8STEqTEftCZZSIjqle0nZSJNan9+Q3tD3BqXNAKPeNjTWjLhPzy+vb1vG0rlDXW9hO97cdqm/JDZ1qI+Ff7vebB49f7kK7ld3wc3MWQcPDl18A7zcdP98JCaXAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 01 20 27" title="" data-src="/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-fee1c.png" data-srcset="/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-a67b7.png 200w,\n/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-0b187.png 400w,\n/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-fee1c.png 800w,\n/static/2022-03-12-01-20-27-03d398bd2629344ea81f6ac2d0b60a4b-115a3.png 801w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/s60jty?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果只希望使用淡出动画的后半截，则使用 animation-iteration-count 小数值的方法就不管用了。</p>\n<p>此时可以使用 animation-delay 负属性值实现我们想要的效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41613960388096745000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.visible-second-half {\n   animation: fadeIn 1s -0.25s;\n}`, `41613960388096745000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.visible-second-half</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s -0.25s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果只希望使用淡出动画的中间部分，可以同时使用 animation-iteration-count 小数值和 animation-delay 负时间值。例如，选取中间 50% 的时间区域：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80993588818667670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.visible-middle-part {\n   animation: fadeIn 1s -0.25s 0.75;\n}`, `80993588818667670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.visible-middle-part</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 1s -0.25s 0.75<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="关于-infinite"><a href="#%E5%85%B3%E4%BA%8E-infinite" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 infinite</h3>\n<p>关键字属性值 infinite 表示无限，作用是让动画一刻不停地无限播放，钟摆运动或者 loading 旋转就属于这样的动画。</p>\n<h3 id="关于值范围"><a href="#%E5%85%B3%E4%BA%8E%E5%80%BC%E8%8C%83%E5%9B%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于值范围</h3>\n<p>animation-iteration-count 的属性值不能是负数，否则会被认为不合法，但是可以是 0，表示动画一次也不播放。因此，如果想要重置 animation 属性，可以使用 animation: 0，比使用 animation: none 的代码少。</p>\n<h2 id="forwards-和-backwards-属性值究竟是什么意思"><a href="#forwards-%E5%92%8C-backwards-%E5%B1%9E%E6%80%A7%E5%80%BC%E7%A9%B6%E7%AB%9F%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>forwards 和 backwards 属性值究竟是什么意思</h2>\n<p>animation-fill-mode 属性的字面意思是“动画填充模式”，主要用来定义动画在执行时间之外应用的值。</p>\n<p>animation-fill-mode 属性的语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48337924861807880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation-fill-mode: none; /* 默认值 */\nanimation-fill-mode: forwards;\nanimation-fill-mode: backwards;\nanimation-fill-mode: both;`, `48337924861807880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token comment">/* 默认值 */</span>\n<span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> forwards<span class="token punctuation">;</span>\n<span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> backwards<span class="token punctuation">;</span>\n<span class="token property">animation-fill-mode</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中 none 是默认值，表示动画开始之前和动画结束之后不会对元素应用 @keyframes 规则中定义的任何样式。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67589819166823430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n   animation: fadeIn 2s 1s;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `67589819166823430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时的 .element 元素的透明度变化过程如下。</p>\n<ol>\n<li>透明度 0.5 保持 1s。</li>\n<li>透明度从 0.5 突变到 0，然后透明度从 0 逐渐过渡到 1，过程持续 2s。</li>\n<li>透明度从 1 突变到 0.5，并保持不变。</li>\n</ol>\n<p>实际上，这里的 .element 元素的透明度无论设置为多少，都会有透明度突变的糟糕体验，这显然不是我们想要的，因此需要使用 animation-fill-mode 属性优化动画效果。但 forwards 和 backwards 这两个关键字属性值不太好理解，下面详细讲解一下。</p>\n<h3 id="forwards-和-backwards-的含义"><a href="#forwards-%E5%92%8C-backwards-%E7%9A%84%E5%90%AB%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>forwards 和 backwards 的含义</h3>\n<p>forwards 是“前进”的意思，表示动画结束后（什么时候结束由 animation-iteration-count 属性决定），元素将应用当前动画结束时的属性值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98294780670846650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n   animation: fadeIn 2s 1s forwards;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `98294780670846650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s forwards<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时的 .element 元素在动画结束之后会使用 100% 这一帧的透明度属性值，因此透明度变化过程如下。</p>\n<ol>\n<li>透明度 0.5 保持 1s。</li>\n<li>透明度从 0.5 突变到 0，然后透明度从 0 逐渐过渡到 1，过程持续 2s。</li>\n<li>透明度一直保持为 1（forwards 的作用）。</li>\n</ol>\n<p>backwards 是“后退”的意思，表示在动画开始之前，元素将应用当前动画第一轮播放的第一帧的属性值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59599717825561305000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n   animation: fadeIn 2s 1s backwards;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `59599717825561305000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s backwards<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时的 .element 元素在动画开始执行之前会使用 0% 这一帧的透明度属性值，因此透明度变化过程如下。</p>\n<ol>\n<li>透明度为 0 并保持 1s 不变（backwards 的作用）。</li>\n<li>透明度由 0 逐渐过渡到 1，过程持续 2s。</li>\n<li>透明度从 1 突变到 0.5，并保持不变。</li>\n</ol>\n<p>有人可能会奇怪，forwards 语义包含“前”，为什么应用的却是最后一帧样式？而 backwards 语义包含“后”，为什么应用的却是第一帧样式？</p>\n<p>这是因为这里的 forwards 指动画向前，backwards 指动画向后。如果把时间画在一把尺子上，则动画所经过的时间就是这把尺子的一部分，如图 5-64 红色部分所示，可以看到，动画向前的方向是动画的结束位置；动画向后的方向是动画的开始位置。也就是说 forwards 表示动画的结束，backwards 表示动画的开始。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-8abf3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 20.242214532871973%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAvElEQVQI122OwQqCQBRF/f8fKFE3LrQvEHXjDxS0U4iiTEhy9L2ZeTNjFE4a1Kpzt+fAdeyP18uWpa1r+3zav7StrapF++IgIgDgMuwZ64oC8hzSdEgS2GwgiiBJhjSFLLvned918PGXBNERUnIhFCmtNXFOcUzrlfF95XsUBDoIlOdp39OuS2GohTDjSERzIomcaZrmA1LS8XRmHWPG3MbHGfmph9aYRqqaiwMbDqy/Cnmpm+1uD8jnZA7fUSPYT9c++0UAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 01 37 50" title="" data-src="/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-fee1c.png" data-srcset="/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-a67b7.png 200w,\n/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-0b187.png 400w,\n/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-fee1c.png 800w,\n/static/2022-03-12-01-37-50-03d6a08610d6409d370a812153320915-8abf3.png 1156w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>因此，forwards 的“前进”指的是最后一帧继续前进的样式，backwards 的“后退”指的是第一帧还要后退的样式。</p>\n<h3 id="forwards-和-backwards-的细节"><a href="#forwards-%E5%92%8C-backwards-%E7%9A%84%E7%BB%86%E8%8A%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>forwards 和 backwards 的细节</h3>\n<p>由于动画的最后一帧是由 animation-direction 和 animation-iteration-count 属性共同决定的，因此 forwards 有时候对应的是 @keyframes 规则中的 to 或 100% 对应的帧，有时候对应的是 @keyframes 规则中的 from 或 0% 对应的帧，具体对应细节如下表。</p>\n<table>\n<thead>\n<tr>\n<th align="left">animation-direction</th>\n<th align="left">animation-iteration-count</th>\n<th align="left">最后一个关键帧</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">normal</td>\n<td align="left">奇数或偶数（不包括 0）</td>\n<td align="left">100% 或 to</td>\n</tr>\n<tr>\n<td align="left">reverse</td>\n<td align="left">奇数或偶数（不包括 0）</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">alternate</td>\n<td align="left">正偶数</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">alternate</td>\n<td align="left">奇数</td>\n<td align="left">100% 或 to</td>\n</tr>\n<tr>\n<td align="left">alternate-reverse</td>\n<td align="left">正偶数</td>\n<td align="left">100% 或 to</td>\n</tr>\n<tr>\n<td align="left">alternate-reverse</td>\n<td align="left">奇数</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">normal 或 alternate</td>\n<td align="left">0</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">reverse 或 alternate-reverse</td>\n<td align="left">0</td>\n<td align="left">100% 或 to</td>\n</tr>\n</tbody>\n</table>\n<p>而 backwards 只取决于 animation-direction 的属性值，因为 backwards 设置的是动画第一次播放的第一帧的状态，与 animation-iteration-count 次数没有任何关系，具体对应细节如下表所示。</p>\n<table>\n<thead>\n<tr>\n<th align="left">animation-direction</th>\n<th align="left">第一个关键帧</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">normal 或 alternate</td>\n<td align="left">0% 或 from</td>\n</tr>\n<tr>\n<td align="left">reverse 或 alternate-reverse</td>\n<td align="left">100% 或 to</td>\n</tr>\n</tbody>\n</table>\n<p>可以看出，其实 animation-iteration-count 的属性值为 0 的时候，forwards 等同于 backwards。</p>\n<h3 id="记不住-forwards-和-backwards-怎么办"><a href="#%E8%AE%B0%E4%B8%8D%E4%BD%8F-forwards-%E5%92%8C-backwards-%E6%80%8E%E4%B9%88%E5%8A%9E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>记不住 forwards 和 backwards 怎么办</h3>\n<p>一个知识点往往需要反复阅读与实践才能记忆深刻，所以如果不常写 CSS 代码，则一段时间后记不清应该使用 forwards 还是 backwards 是很正常的，这个时候干脆就使用 both 关键字代替。</p>\n<p>animation-fill-mode: both 可以让元素的动画在延时等待时保持第一帧的样式，在动画结束后保持最后一帧的样式，适用于绝大多数的开发场景。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47318301751671490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0.5;\n   animation: fadeIn 2s 1s both;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `47318301751671490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0.5<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时的 .element 元素的透明度变化过程如下。</p>\n<ol>\n<li>透明度为 0 并保持 1s 不变（等同于 backwards 的作用）。</li>\n<li>透明度从 0 逐渐过渡到 1，时间持续 2s。</li>\n<li>透明度保持为 1 不变（等同于 forwards 的作用）。</li>\n</ol>\n<p>可以看到元素的透明度变化过程很流畅、很自然。</p>\n<p>还有一点小小的建议，依赖 CSS 动画保持元素的显隐状态有功能上的风险，例如动画如果没执行，元素就永远显示不出来。因此，常规的 CSS 语句里的元素样式也要同步变化，例如下面的元素显示是通过添加类名 .active 触发的，此时需要同时设置 opacity: 1，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71085860531278520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.element {\n   opacity: 0;\n}\n\n.element.active {\n   opacity: 1;\n   animation: fadeIn 2s 1s both;\n}\n\n@keyframes fadeIn {\n   0% {\n      opacity: 0;\n   }\n\n   100% {\n      opacity: 1;\n   }\n}`, `71085860531278520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.element</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.element.active</span> <span class="token punctuation">{</span>\n   <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="如何暂停和重启-css-动画"><a href="#%E5%A6%82%E4%BD%95%E6%9A%82%E5%81%9C%E5%92%8C%E9%87%8D%E5%90%AF-css-%E5%8A%A8%E7%94%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何暂停和重启 CSS 动画</h2>\n<p>CSS 动画是可以暂停的。</p>\n<p>使用 animation-play-state 属性可以控制 CSS 动画的播放和暂停，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7828165949303934000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 播放 */\nanimation-play-state: running;\n/* 暂停 */\nanimation-play-state: paused;`, `7828165949303934000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 播放 */</span>\n<span class="token property">animation-play-state</span><span class="token punctuation">:</span> running<span class="token punctuation">;</span>\n<span class="token comment">/* 暂停 */</span>\n<span class="token property">animation-play-state</span><span class="token punctuation">:</span> paused<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只要设置 animation-play-state 的属性值为 paused 就可以让一个正在播放的 CSS 动画暂停。举个例子，使用 CSS Sprites 背景图和 animation 属性实现一个可暂停的动图效果，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76309113073193390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.love {\n   width: 100px;\n   height: 100px;\n   background: url(heart-animation.png) no-repeat;\n   background-size: 2900%;\n   animation: heart-burst steps(28) 0.8s infinite both;\n}\n\n.stop {\n   animation-play-state: paused;\n}\n\n@keyframes heart-burst {\n   0% {\n      background-position: 0%;\n   }\n\n   100% {\n      background-position: 100%;\n   }\n}`, `76309113073193390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.love</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>heart-animation.png<span class="token punctuation">)</span></span> no-repeat<span class="token punctuation">;</span>\n   <span class="token property">background-size</span><span class="token punctuation">:</span> 2900%<span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> heart-burst <span class="token function">steps</span><span class="token punctuation">(</span>28<span class="token punctuation">)</span> 0.8s infinite both<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.stop</span> <span class="token punctuation">{</span>\n   <span class="token property">animation-play-state</span><span class="token punctuation">:</span> paused<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> heart-burst</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">background-position</span><span class="token punctuation">:</span> 0%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">background-position</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/r7bnpv?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>点击演示页面中间区域的按钮，会给 .love 元素添加类名 .stop，此时就会看到类似 GIF 动图的“心花怒放”效果动画瞬间被暂停了，如图 5-65 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-b25dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 42.78892072588347%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA5ElEQVQoz41RQW7CMBDk+Uh9A1I59AEceAQqNKRBtQ1pQQQIJZQYm4CJvZtuyA1U1SN7NSN5tKNxq3oAOkCHDaNb/Y3WvRPr1/tub/v0jFjipYBcwiHH89nDDI7W/bz003aHJCgFWYZFgWX5v/m2HOiUTWIAl+1oesUGAGstuQnuRkBKtNbLrJQy5jKffwkhzPV60hqM8S1MHqXSKv6MoyjSJ02yqdC3bUpO0zoHDcOqLuHhR2pzslofcvnBeBBGSbKazuLNJt2m34vFkggX07cgHLyOxuGEccH4bDgKhqTeJ4zxX+3TCXRNtmfQAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 07 20" title="" data-src="/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-fee1c.png" data-srcset="/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-a67b7.png 200w,\n/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-0b187.png 400w,\n/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-fee1c.png 800w,\n/static/2022-03-12-15-07-20-0ea6f63de575cd1c9197e1b9bf052f63-b25dc.png 1047w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>相比传统的 GIF 动图，这种使用 animation 实现的动图效果，支持无损 PNG，图像质量更高，而且可以随时播放和暂停。</p>\n<p>配合 animation-delay 负值，动画暂停可以让元素停留在动画的任一时段，我们可以利用这一特性解决一些 CSS 难题。例如，希望设置 50% 透明度的 deepskyblue 色值就可以这样处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98359277274772770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`p {\n   animation: opacityColor 1s -0.5s linear paused;\n}\n\n@keyframes opacityColor {\n   0% {\n      color: transparent;\n   }\n\n   100% {\n      color: deepskyblue;\n   }\n}`, `98359277274772770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">{</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> opacityColor 1s -0.5s linear paused<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> opacityColor</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时 <code class="language-text">&lt;p&gt;</code> 元素的 color 色值就是 50% 透明度的 deepskyblue。</p>\n<h3 id="css-动画重启"><a href="#css-%E5%8A%A8%E7%94%BB%E9%87%8D%E5%90%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 动画重启</h3>\n<p>这里顺便讲一下如何重启 CSS 动画，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49845925368798310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;element active&quot;></div>\n<style>\n   .element.active {\n      animation: fadeIn 2s 1s both;\n   }\n\n   @keyframes fadeIn {\n      0% {\n         opacity: 0;\n      }\n\n      100% {\n         opacity: 1;\n      }\n   }\n</style>`, `49845925368798310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>element active<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.element.active</span> <span class="token punctuation">{</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 2s 1s both<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>\n      <span class="token selector">0%</span> <span class="token punctuation">{</span>\n         <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token selector">100%</span> <span class="token punctuation">{</span>\n         <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>想要 CSS 动画重新执行一遍，可以使用下面的 JavaScript 代码（假设 .element 元素的 DOM 对象是 ele）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81179305461149450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ele.classList.remove(\'active\');\nele.offsetWidth; // 触发重绘\nele.classlist.add(\'active\');`, `81179305461149450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">ele<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nele<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span> <span class="token comment">// 触发重绘</span>\nele<span class="token punctuation">.</span>classlist<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果不是重新执行动画，而是让已经暂停的动画继续播放，则设置 animation-play-state 属性值为 running 即可。</p>\n<h2 id="深入理解-steps-函数"><a href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-steps-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入理解 steps() 函数</h2>\n<p>animation-timing-function 的属性值由 cubic-bezier() 函数和 steps() 函数组成。steps() 函数可以让动画效果不连续，就像楼梯，与之相对应的 cubic-bezier() 函数则更像是平滑的无障碍坡道，如图 5-66 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-9ce72.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.25816023738873%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABlUlEQVQoz2P4DwN///4Fklu3bk6ICZk/u3fDygV7tm3YvHH1/r1bD+3fdOb4zgf3rvxHBQxw1p8/f4Dk+nWrbe3NK4uzd06bWFmcl5uX0dfRvHT6pGlTeo8c2gNS9+8fFs0Qmzdt2hAdGrShq6O9uiK/MHdiX9u22dMWT+1raKiaN282TpshmjdsWB8XElhZkJeSkdze0bh3zvSlk3oam6tKS/NnzJpGQPOxE8dDI0JTU+KbW6p3TJuwatqEhpbqlubawpKiKVMnEdB88ODBzOzM1vaGg0vnL53QVddQXltTVl1XXViU39VeT0Dz0WPHMnKzZnQ0r5rUX1lbUVtbVlldUdtQm54a09XeQEDz/gMHcgvyq6vK8gqyS8sKyspLCouL8nIzE+LDe/u6cGr+B46Djx8/PXz48Nmzpw8e3H/06OHjx48eAFn37t2/f//Fi+fomi9evnLn7r13794/ffb8zt3712/cOn/x8rXrN69cvf7t2/fnL189e/4ShF68vHX77olTZ27eunP6zLnjJ8+cO3cRALZt3KSTTzUAAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 18 09" title="" data-src="/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-fee1c.png" data-srcset="/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-a67b7.png 200w,\n/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-0b187.png 400w,\n/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-fee1c.png 800w,\n/static/2022-03-12-15-18-09-bde74fdcdfd5662f4285ba254a76f14c-9ce72.png 1011w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>cubic-bezier() 函数在 5.3.2 节已经详细介绍过，这里专门深入介绍 steps() 函数及其相对应的关键字。</p>\n<p>学习 steps() 函数有一定的难度，主要是容易分不清楚 start 和 end。</p>\n<p>常见的 steps() 函数用法示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57993873807524900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`steps(5, end);\nsteps(2, start);`, `57993873807524900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">steps</span><span class="token punctuation">(</span>5<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">steps</span><span class="token punctuation">(</span>2<span class="token punctuation">,</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>语法表示就是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75791096569001800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`steps(number, position);`, `75791096569001800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">steps</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>先讲一下这一语法中的几个关键点。</p>\n<ul>\n<li>\n<p>number 指数值，且是整数值，这个很好理解，表示把动画分成了多少段。假设有如下 @keyframes 规则，定义了一段从 0 ～ 100px 的位移：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98867847559378880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes move {\n  0% {\n     left: 0;\n  }\n\n  100% {\n     left: 100px;\n  }\n}`, `98867847559378880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> move</span> <span class="token punctuation">{</span>\n  <span class="token selector">0%</span> <span class="token punctuation">{</span>\n     <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">100%</span> <span class="token punctuation">{</span>\n     <span class="token property">left</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同时 number 参数的值是 5，则相当于把这段移动的距离分成了 5 段，如图 5-67 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-5fff1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.2644098810613%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAyUlEQVQY042Oy26DMBBF/f8f1SwqkQVSHjXCxI9CU8mIRDwNeGwyUKddZtOzOrr3jjRkW1f/wPfkdu9h2zalzUE2C66I61G1UpsQVi3s03tjfPCTamjeBUFEUtf19fr9wRSXnwmlXObJJb9wTinNRMFVcT6fQsVEkTLG0jSTX5nIpRDhnkRRJARHXKy18zwDWO/+dPYOHMA0TRascxDS4I9lUUrudm9xHBOttTHP3/7POI5VVZVlSV67rusD/hcAGAbTtG3fD6/LH4FYGOiMhabRAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 25 07" title="" data-src="/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-fee1c.png" data-srcset="/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-a67b7.png 200w,\n/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-0b187.png 400w,\n/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-fee1c.png 800w,\n/static/2022-03-12-15-25-07-d0288e1c2cbb49392873c5147c343650-5fff1.png 1093w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>position 指关键字属性值，是可选参数，表示动画跳跃执行是在时间段的开始还是结束。其支持众多关键字值，这里先了解一下传统的 start 和 end 关键字。</p>\n</li>\n<li>\n<p>start 表示在时间段的开头处跳跃。</p>\n</li>\n<li>\n<p>end 表示在时间段的结束处跳跃，是默认值。</p>\n</li>\n</ul>\n<h3 id="深入理解-start-和-end-关键字"><a href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-start-%E5%92%8C-end-%E5%85%B3%E9%94%AE%E5%AD%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入理解 start 和 end 关键字</h3>\n<p>steps() 函数本质上是一个阶跃函数，阶跃函数是一种特殊的连续时间函数，可以实现从 0 突变到 1 的过程。图 5-68 所示的 steps(1, start)、steps(1, end)、steps(3, start)、steps(3, end) 就是阶跃函数。</p>\n<p>通过分析图 5-68 所示内容，我们可以得到对 start 和 end 关键字的进一步解释。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-a3fce.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 515px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 129.51456310679612%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAAsSAAALEgHS3X78AAAC5UlEQVQ4y51U23LTMBDV/38KQ6fD8MQAbSlPMKQlGSCXNnVsJ77JN8mWL/IlHFuOmzalD+xoZFnao909uysiy/xmbplu4oXCDbpBw8yw+WIT7vf7tm0x+75fVdX+IG0/r82Y4GPRRORSVnUph1GUdV7WI5hzXhTF/qn4cd6BWVo2Tbt/SRQ4z3G3fHaUCEkopZ7P/gWGpGlqWVZZls/3M0kYi2nAXwHDrOd5p24nAOMTJ0X9qtvFS25z0YPBcw6KajBa1epTVQqm5pglERNV3YJLNWMEIAy36jvqB2EcRbvdbrvdxnEMPzEPWWnr1YO92EQ0yrYuu9s4TiBsP9W2IYGppmmUJ1EUKQw2xyBxit8h/kxQz1VrKUuifIOA9ul0mvQyao+Rw/28KOaLBbwD/+pqMkTPuaZpuq4DiWMhxClzjuNABxHBQVjqwPBKsXJwsq2aFluyao42m9NEgDkCB4IgGK8IWD7546G2f6+DkW3YUUXSDtKB51pIFE9jkFXdcFE+yzOiOK0wnvaEhREYbk03RSchB0hJD3sEZ1kGblVQGNMVhdrWTQjo8VwHaqjViBdNH/CxBcYYiDy4PfRTIbsUk7atZ0tLt5nhcJHJMbBjtoCH5ayoZ3edTTS/OlL9LArZyKo9rfChtousqSV0bNqlEJqPYMdPGE9QPUpQA8i26gQFtr1Yt+KQFw5lZZFDBwroNpJlwqFRKjLVeqgEhIciRdmo69EpKH4nyNBGLo1R/uAPeOSIHHuItwoYLBDnk0frQAF8ggF1hJkcqlyapjmZTHDfaesrChnjs9nMMAzogMIuZnWAOG3bBgwuUd9HDArT9NL2KxSi47pRH1EYho+N8X+CN4zf3P7UDRPvwXyxgh1K/fWDtlje3a+1+WKJBXbCrtcZzFq2s9no09mvIIwIfs7O3/+Y3C5X9x8+XuD5Ngzz4uoa68+X1zh68/b808XV5Zev2Pn2fTK5mUL57dk7baP/BR8Z1439FXj8AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 38 46" title="" data-src="/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-a3fce.png" data-srcset="/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-96d1c.png 200w,\n/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-2b9d0.png 400w,\n/static/2022-03-12-15-38-46-3e158fb310ea4d6035e0d732876b9f8c-a3fce.png 515w" data-sizes="(max-width: 515px) 100vw, 515px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>start：表示直接开始，也就是时间段才开始，就已经执行了一个距离段。动画执行的 5 个分段点是下面这 5 个，起始点被忽略，因为时间一开始直接就到了第二个点，如图 5-69 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-0f56a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.142857142857146%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABkklEQVQoz42SS2/aUBCF/c+ziiJlk+zaVdWKVSlNG3YNpHlBSpQ44BCitHJBMcYvAjbEsjE2/uqHrApUVTnS1b0687gzZ0YgQbxapRdhv0/YbhN3u8xPTnAmk4yP45jXQigSpiGLwQBPkgjEW4zTUyxNy5xWqT1J+pojFI8UwXSKKoroUgez0yYIgrXfVxvVbNadJSwMiulShM8jsPy/jpq9YOYn6aIQN4hRpwuWQZhFGrMl4/kSXuZ5y77vYTszGg8m3eMLuqUPiOc3tO6G3Fc+0zuscv1oICXc7ft3dM5atHoaYvmA3qePXD+MuKpfcVcqoV9eIsiyzK+fjzzPbKRKhaOdHXq1I7RBn7P9fb7v7aEqT8jHdb5tbyN+/cJYH/Hj7Rvqu7s8/Za5r9c43NriplxGaDabqKqaaxBF2IpCmNwp3GQoM00vBMIZDpNWc2F828HRc5uS8LVqlYtGI9ewmOT/Jf83NldqbcpRUplhmjiJpp7n4bouk8mU0UjDMExM08IaP2NZ44xPuTCM1lbrDyqOo2UckIbjAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 43 15" title="" data-src="/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-fee1c.png" data-srcset="/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-a67b7.png 200w,\n/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-0b187.png 400w,\n/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-fee1c.png 800w,\n/static/2022-03-12-15-43-15-08a4a2e8d1f51723afbddc1bfec03a4e-0f56a.png 1050w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>end：表示戛然而止，也就是时间段一结束，当前动画执行就停止。于是，动画执行的 5 个分段点是下面这 5 个，结束点被忽略，因为在要执行结束点的时候已经没时间了，如图 5-70 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-7ea00.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.527001862197395%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQY05VQTW+CQBTcv+zNePTipT2aeGwTj5peGntr0QLWD0SMBZHyIYjIYi1EqARYtiv04KlJ3+lldmbezAKc5xhjdDql0ykWxZBlfU0jSF7gfw/ACJXiaD6PJ1M4ZOFKuoizrGTkhFAaEb+CfCUmIMZReHYWS6go1lw4Hr7Ko99xGicXizRDUZxmBUqQ6JyUuYAvCPvxhJEOlhMcWVpbb0daaDCjzzdmKMKFaHuvffVdpWXfnC0hQ89kT9D97JIrB+Nm86nRUGV5RVGdSoVtty0XPt/cPtbriiiuKapbq7H3dzvHoVuth2pV4jjDNHmeRwiBl06n3+2SKmkcuxwXeB7JE+52riSRcEkB+hASwsm2HZ4ncXVd7/V6g8EAoKLzf4d0TpIE/K7FB5imtd+7YRgGfrDZWMqHalpbw9hYW5ss5NW27WuLHyn9tg0e7JJuAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 44 26" title="" data-src="/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-fee1c.png" data-srcset="/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-a67b7.png 200w,\n/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-0b187.png 400w,\n/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-fee1c.png 800w,\n/static/2022-03-12-15-44-26-39b42c1756a91bbd1c41dd3628feb83d-7ea00.png 1074w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ul>\n<p>然而，上述的分析是站在函数的角度和时间的角度进行的，虽然仔细琢磨一下也能理解，但是由于这并不符合人的主观视角和实际感知，一段时间后，认知就会发生混乱。</p>\n<p>混乱的原因在于认知失调。steps(5) 是把动画时间段分成 5 段，对这个点的认识应该都没有问题，关键是对 steps(5, start) 的认识，看到这里是 start，几乎所有人的第一反应就是动画应用的样式是对应时间段开始的样式，不然怎么叫作“start”呢？可现实真是残酷，steps(5, start) 应用的样式不是 5 个时间段的 start 样式，而是 5 个时间段的 end 样式，例如 left: 0 到 left: 100px 的位移，最终元素表现出来的位移是 20px、40px、60px、80px 和 100px。</p>\n<p>steps(5, end) 也是反直觉的表现，其应用的是 5 个时间段的 start 样式，而不是字面上的 end 样式，例如 left: 0 到 left: 100px 的位移，最终元素表现出来的位移是 0px、20px、40px、60px 和 80px。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/e2u1f2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>大家可以看到，以 20px 为一个分段，start 的位置在分段的结束处，而 end 的位置在分段的开始处，图 5-71 所示的就是执行 5 次 step() 的位置示意图。</p>\n<p>因此，为了避免认知混乱，当需要用到 steps() 函数的时候，无须思考过于抽象的阶跃函数及其准确含义，只需要记住符合直觉认知的这么一句话：“一切都是反的。start 不是开始，而是结束；end 不是结束，而是开始。”</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-88b8f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 25.99653379549394%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA8UlEQVQY0xWNy26DMBRE+f/P6iKbKmqTGBqH8LLxA1/7Gr8g2ZVoNmd0RpqqF+p0IS29M86lFF+/5PpHpRBi5j+3+kSoUopzXhPyXdNOaDnzGyHtg54HWZlYqPbBY0jpveVGobC+5FRyXhzW+sMx5YiuN56vec/JIUaPV5MqZnDontM0OWcluJq2M5vAWkR3bihnzB0CTPNo7wNLqweAvns23biArQi+1hC996+SWdjuJpSw5lK2km9L1Bhe+75vRflIIL0POpJCa9PkS+WMAbDHQGtjDXxewEqlHXrQ2oLthvGoUirBuZBqGCfGxXIoA/8odg9ryNF7WwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 53 41" title="" data-src="/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-fee1c.png" data-srcset="/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-a67b7.png 200w,\n/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-0b187.png 400w,\n/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-fee1c.png 800w,\n/static/2022-03-12-15-53-41-ae3bb14280e9a3c1a53d23713de591fa-88b8f.png 1154w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这样，至少使用 start 和 end 关键字的时候不会犯错，至于相反的原因，可以参考图 5-68 所示的 steps() 阶跃函数慢慢理解。</p>\n<h2 id="animation-fill-mode-属性与-steps-函数同时设置会怎样"><a href="#animation-fill-mode-%E5%B1%9E%E6%80%A7%E4%B8%8E-steps-%E5%87%BD%E6%95%B0%E5%90%8C%E6%97%B6%E8%AE%BE%E7%BD%AE%E4%BC%9A%E6%80%8E%E6%A0%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>animation-fill-mode 属性与 steps() 函数同时设置会怎样</h2>\n<p>animation-fill-mode 属性和 steps() 函数同时使用，可能会影响元素的断点表现。例如，下面这个语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11599566077058566000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation: move 5s forwards steps(5, end);`, `11599566077058566000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation</span><span class="token punctuation">:</span> move 5s forwards <span class="token function">steps</span><span class="token punctuation">(</span>5<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>forwards 关键字会使动画停留在动画关键帧最后一帧的状态。于是，图 5-72 所示的 6 个分段点都会执行，整个动画停止在第六个分段点上，也就是由于设置了 animation-fill-mode，因此虽然将时间分成了 5 段，但是视觉表现上却是元素总共移动了 6 个位置。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-cc2b6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.03639672429482%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABZklEQVQY052OO2+CYBiF+cNOLg7MTl3axNXNxEabxhibNrSk9X5Hrip8gAqiIoKAUBDFfsaka5Oe4eRJzjl5X+Typ+IY2mm/DwgiGo0ikjwRxK7RcFcrJD6fbzH0X45vfNueTtexZXrE0K/Xg9rXhSa1ZtOUZQQG5zjWLT84XkuufzQP4XUXX0wncLwjxDA6rw13M19slQVDjqfY5yT/CNvICse3DNsCjsKJ2tvLmJlRsj17x2cfOL1wp/xKKZckatqSXHVI2/0uoxwmQBdyORtexlIpPJNRdJ2rVJ6TSRLDNHVZvbt7TacXmgZ6vUoi0S4W16ZZe7gvoyhgWaHTKaEoXSgglXx+2G7DP799T1cUz/PD6OhYlm1ZYRgGQWAsl45th1Hk6PoaAAg8zz9ls81qFYkv/xeiqkuWmxjGbjIVOt0+zwOGHfOCJEryfK5QNFutNwUgUjQHYUBQgigRI6rbG2z07Q+enqsnBd9BEwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 15 57 11" title="" data-src="/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-fee1c.png" data-srcset="/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-a67b7.png 200w,\n/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-0b187.png 400w,\n/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-fee1c.png 800w,\n/static/2022-03-12-15-57-11-a90adbd85f2a65764973bb54c3ddec53-cc2b6.png 1099w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这显然不是我们想要的，怎么处理呢？可以减少分段个数和减小动画运动的跨度，调整如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85346347741014180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes move {\n   0% {\n      left: 0;\n   }\n\n   100% {\n      left: 80px;\n   }\n}`, `85346347741014180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> move</span> <span class="token punctuation">{</span>\n   <span class="token selector">0%</span> <span class="token punctuation">{</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">100%</span> <span class="token punctuation">{</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>也就是将终点从 100px 改成 80px，同时将 CSS 调用改成：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83124141034837490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`animation: move 5s forwards steps(4, end);`, `83124141034837490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">animation</span><span class="token punctuation">:</span> move 5s forwards <span class="token function">steps</span><span class="token punctuation">(</span>4<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>也就是将原来的 steps(5, end) 改成 steps(4, end)，最后将 100% 这一帧交给 forwards。</p>\n<h3 id="step-start-和-step-end-关键字"><a href="#step-start-%E5%92%8C-step-end-%E5%85%B3%E9%94%AE%E5%AD%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>step-start 和 step-end 关键字</h3>\n<p>step-start 和 step-end 是 steps() 函数的简化关键字，注意，是 step-*，step 后面没有 s。step-start 等同于 steps(1, start)，表示“一步到位”；step-end 等同于 steps(1, end) 或者 steps(1)，表示“延时到位”。</p>\n<p>之所以专门设置两个关键字 step-start 和 step-end，不是因为这两个关键字常用，而是因为这两个关键字实用。它们可以让动画按照设定的关键帧步进变化，特别适合非等分的步进场景。例如实现一个打点动画，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33114221825066400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`正在加载中<dot>...</dot>\n<style>\n   dot {\n      display: inline-block;\n      height: 1em;\n      line-height: 1;\n      vertical-align: -0.25em;\n      overflow: hidden;\n   }\n\n   dot::before {\n      display: block;\n      content: \'...\\A..\\A.\';\n      white-space: pre-wrap;\n      animation: dot 3s infinite step-start both;\n   }\n\n   @keyframes dot {\n      33% {\n         transform: translateY(-2em);\n      }\n\n      66% {\n         transform: translateY(-1em);\n      }\n   }\n</style>`, `33114221825066400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html">正在加载中<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dot</span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dot</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">dot</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 1em<span class="token punctuation">;</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> -0.25em<span class="token punctuation">;</span>\n      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">dot::before</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>\n      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'...\\A..\\A.\'</span><span class="token punctuation">;</span>\n      <span class="token property">white-space</span><span class="token punctuation">:</span> pre-wrap<span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> dot 3s infinite step-start both<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@keyframes</span> dot</span> <span class="token punctuation">{</span>\n      <span class="token selector">33%</span> <span class="token punctuation">{</span>\n         <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-2em<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token selector">66%</span> <span class="token punctuation">{</span>\n         <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-1em<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 5-73 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-72de5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 648px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 29.32098765432099%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAvElEQVQY06WNyw6CMBBF+/9/Y2JiovGBmggiArIDFGl4a3nUIrJosWBwY3TjWUwmN+fOgOYLpCSe55mmWWD8zQGfEWOsLZMbhNCyrV9lSinreTX7cvvZtq0sz985d2k7abdT0PwB8P3gitLqXmV5we8VBSakrKoH7kAoDcIwimPuoDRLkiROLmcXIoSCMALjyUxWNG6cHLeua1XTZVk5Ou5e1XXdkGRlOhe4I0o7nojidrneDIajg2EshNUTRClT3M2oYDwAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 16 05 40" title="" data-src="/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-72de5.png" data-srcset="/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-bb436.png 200w,\n/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-c5634.png 400w,\n/static/2022-03-12-16-05-40-d82d7dc81918fe2823e652e588059072-72de5.png 648w" data-sizes="(max-width: 648px) 100vw, 648px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/vxnscm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>在这个例子中，如果你想通过在 @keyframes 规则中设置好 0% 和 100% 的位置，再使用 steps(2) 或 steps(3) 进行位置划分实现这个效果，你会发现位置总是对不上。其实完全不用这么麻烦的，手动设置好断点的位置，然后使用一个 step-start 关键字就搞定了，无须计算，无须微调，就算把 33% 改成 50% 功能也是正常的，只是打点速度不均匀而已，定位字符点绝对没问题。</p>\n<p>这就是 step-start 和 step-end 关键字的精妙作用，可以让任意自定义的 CSS 关键帧步进呈现，很实用。</p>\n<h3 id="新的-jump-start、jump-end、jump-none-和-jump-both-关键字"><a href="#%E6%96%B0%E7%9A%84-jump-start%E3%80%81jump-end%E3%80%81jump-none-%E5%92%8C-jump-both-%E5%85%B3%E9%94%AE%E5%AD%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新的 jump-start、jump-end、jump-none 和 jump-both 关键字</h3>\n<p>从 2019 年开始，Chrome 浏览器和 Firefox 浏览器开始陆续支持 jump- 开头的用在 steps() 函数中的关键字。下面先介绍一下 jump-start、jump-end、jump-none 和 jump-both 关键字的含义。</p>\n<ul>\n<li>jump-start：动画开始时就发生跳跃，和 start 关键字的表现一样。</li>\n<li>jump-end：动画结束时发生跳跃，和 end 关键字的表现一样。</li>\n<li>jump-none：动画开始时和结束时都不发生跳跃，然后中间部分等分跳跃。</li>\n<li>jump-both：动画开始时和结束时都发生跳跃。</li>\n</ul>\n<p>假设时间函数分为 3 段，则 jump-start、jump-end、jump-none 和 jump-both 关键字对应的阶跃函数如图 5-74 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-925e2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.33098591549296%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABNklEQVQoz4VSa0/DMAzc//9rCCEQaGMgrR1sGQ15N4nzanGXfWBlbFYURU7Odzl7MZ5HSimEALHsaW99woz3fphi5BpyGX4/XszAzjkhzbeEmHKthZlSBq7AuDh7PAeHmAjViESucmT0HqhwqodxHG6AY0y9dUJwKRXqxwyTtmNKSuGsm9RfAVflSiljdMkn5VprzgUA3GDOOZeCmpHQV8NiSvXKQyrXDUsxor0xDcaG+mcAX0pBq7Hcueo/YPC+763QIcSTZtNbhDE179Ml5pSldhASmo2BGcqtMrXV/4PrHTJSbsihY4xVh1AIZ6zrOmPMrMQFt3HGYgjTYB0bi/zTzAGgHXPmx6dn2lHG+GbTttvP3Y5M52a72xNCDrg3zZYcvlavb+v1e9t+4FouV3f3Dy/L1Q851bzNEzwzewAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 16 12 40" title="" data-src="/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-fee1c.png" data-srcset="/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-a67b7.png 200w,\n/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-0b187.png 400w,\n/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-fee1c.png 800w,\n/static/2022-03-12-16-12-40-21123e24930facbe35f64c5afe0214bb-925e2.png 1136w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>目前 jump-开头的这几个关键字的兼容性还不太好，在生产环境中还无法使用，就不进一步展开讲解了。</p>\n<h3 id="标签嵌套与动画实现的小技巧"><a href="#%E6%A0%87%E7%AD%BE%E5%B5%8C%E5%A5%97%E4%B8%8E%E5%8A%A8%E7%94%BB%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>标签嵌套与动画实现的小技巧</h3>\n<p>遇到某些属性被占用，或者动画场景复杂的情况，可以试试使用标签嵌套来实现。例如，某个悬浮提示框的居中定位是使用 transform 属性实现的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24087660224501550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.toast {\n   position: absolute;\n   left: 50%;\n   top: 50%;\n   transform: translate(-50%, -50%);\n}`, `24087660224501550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.toast</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n   <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同时希望提示框出现的时候有放大的动画效果，也就是应用下面的 CSS 动画：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60541774891111590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@keyframes scaleUp {\n   from {\n      transform: scale(0);\n   }\n\n   to {\n      transform: scale(1);\n   }\n}`, `60541774891111590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> scaleUp</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>很显然，此时 transform 属性冲突了，怎么办？很简单，使用标签进行嵌套就好了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30629768203520946000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;toast&quot;>\n   <div class-=&quot;content&quot;>提示内容</div>\n</div>\n<style>\n   .toast {\n      position: absolute;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n   }\n\n   .content {\n      color: #fff;\n      background-color: rgba(0, 0, 0, 0.75);\n      animation: scaleUp 300ms;\n   }\n</style>`, `30629768203520946000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toast<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class-</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提示内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.toast</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.content</span> <span class="token punctuation">{</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.75<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> scaleUp 300ms<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样，我们还可以通过元素嵌套，分别应用动画实现更复杂的动画效果，典型的例子就是动画时间函数分解实现抛物线运动效果。</p>\n<p>在页面中点击“加入购物车”按钮，就会看到有商品以抛物线运动的方式飞向购物车，效果如图 5-75 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-4032d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.43205574912892%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABRklEQVQoz2N4Ep70PC3/WVbJU8/gh9v3n7z26Ne37/+B4N8/IPr39y+IgNLogOFxRcPd7kmv6lpfJeXc3LJ369GrP758Bep9+vTVsvWHP3/8AjbnH5jA0Pzn9+8fP3/+//kLpOLfX4htQA2fPny+duPBr+8/gOyjp66dv3QXyADa/x8JMPzHD0B2/j99/taV6w9I0/zvHyoHgojV/Pfv39+/gQjI+P7l67rNRx/cewrU//fX73+//wAFCTkbyeLLj958/PEHxMZv898/IEVnpkxf4OS+2C9olU/gWp/ALQEh630DVwPZ/sHLHd0uzp3PgMMekOlPjx0/PX3mqbnzL86Zd3n2vIuz5kLQpdnzzk2Z/uzkKQa40ufPXzx69PjTp0+v37y5c/f+9Ru3rt+9d+/588ev3zx49frei5cPX73+9fs3sh0AEv4jrIsjQ3wAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 03 12 16 19 46" title="" data-src="/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-fee1c.png" data-srcset="/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-a67b7.png 200w,\n/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-0b187.png 400w,\n/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-fee1c.png 800w,\n/static/2022-03-12-16-19-46-56b00e19de07d2604e642d7b3b175187-4032d.png 1148w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/kqn6xv?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>假设飞出去的元素的 HTML 代码结构如下：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="57052597688173170000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<div class=&quot;fly-item&quot;>\n   <img data-src=&quot;./book.jpg&quot; />\n</div>`, `57052597688173170000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fly-item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./book.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>实现抛物线效果的关键 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48584471783616020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.fly-item,\n.fly-item > img {\n   position: absolute;\n   transition: transform 0.5s;\n}\n\n.fly-item {\n   transition-timing-function: linear;\n}\n\n.fly-item > img {\n   transition-timing-function: cubic-bezier(0.55, 0, 0.85, 0.36);\n}`, `48584471783616020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.fly-item,\n.fly-item > img</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token property">transition</span><span class="token punctuation">:</span> transform 0.5s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.fly-item</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-timing-function</span><span class="token punctuation">:</span> linear<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.fly-item > img</span> <span class="token punctuation">{</span>\n   <span class="token property">transition-timing-function</span><span class="token punctuation">:</span> <span class="token function">cubic-bezier</span><span class="token punctuation">(</span>0.55<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.85<span class="token punctuation">,</span> 0.36<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，父元素 .fly-item 只负责横向线性运动，子元素 <code class="language-text">&lt;img&gt;</code> 只负责纵向运动，只不过纵向运动是先慢后快的。</p>\n<p>将纵向运动和横向运动合并，就产生了抛物线运动的视觉效果。大家可以想象一下扔铅球，铅球水平飞行的速度其实近似匀速，但是受到重力的影响，铅球下落的速度是越来越快的，于是抛物线效果就产生了。</p>\n<p>类似的通过标签嵌套实现动画效果的例子还有很多，在这里就不一一列举了，重要的是思路和意识，希望大家遇到类似场景时能够想到这样的小技巧。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/CSS新世界更强的视觉表现/index.md absPath of file >>> MarkdownRemark",timeToRead:61,frontmatter:{date:"2022-02-13 00:55:25",path:"/css-new-world-stronger-visual-performance/",tags:"前端, CSS, CSS新世界, 读书笔记",title:"CSS新世界更强的视觉表现",draft:null}}],length:162,tag:"前端",pagesSum:33,page:3}}}});