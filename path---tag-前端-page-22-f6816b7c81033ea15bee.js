webpackJsonp([0x9ad2ff869909],{1535:function(n,s){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"优先级 如果对所有 CSS 伪类的优先级（也就是我们常说的选择器权重）进行分类，你会发现总共只有两个级别，0 级和 10 级。 0 级指没有优先级，1 级是标签选择器，10 级是类选择器，属性选择器，100 级是 ID 选择器。 伪类，伪类，既然带有“类”字，自然其优先级好类选择器一致。 但是，其中有个特殊，那就是逻辑伪类的优先级都是 0。例如：:not()，:is()，:where()等。 逻辑伪类整个选择器语句的优先级是由括号里面内容决定的，不同的逻辑伪类规则不一样，其中:not…",html:'<h1 id="优先级"><a href="#%E4%BC%98%E5%85%88%E7%BA%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优先级</h1>\n<p>如果对所有 CSS 伪类的优先级（也就是我们常说的选择器权重）进行分类，你会发现总共只有两个级别，0 级和 10 级。</p>\n<blockquote>\n<p>0 级指没有优先级，1 级是标签选择器，10 级是类选择器，属性选择器，100 级是 ID 选择器。</p>\n</blockquote>\n<p>伪类，伪类，既然带有“类”字，自然其优先级好类选择器一致。</p>\n<p>但是，其中有个特殊，那就是逻辑伪类的优先级都是 0。例如：:not()，:is()，:where()等。</p>\n<p>逻辑伪类整个选择器语句的优先级是由括号里面内容决定的，不同的逻辑伪类规则不一样，其中:not()伪类的本身没有优先级，最终优先级是由括号里面的选择器决定的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67852246432674600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`:not(.disabled) {\n} /* 优先级等同于.disabled选择器 */\n:not(a) {\n} /* 优先级等同于a选择器 */`, `67852246432674600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">:not(.disabled)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span> <span class="token comment">/* 优先级等同于.disabled选择器 */</span>\n<span class="token selector">:not(a)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span> <span class="token comment">/* 优先级等同于a选择器 */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="复杂选择器的支持"><a href="#%E5%A4%8D%E6%9D%82%E9%80%89%E6%8B%A9%E5%99%A8%E7%9A%84%E6%94%AF%E6%8C%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>复杂选择器的支持</h1>\n<p>:not()逻辑伪类出身很早，早到 IE9 浏览器都支持，不像现在的新出来的逻辑选择器，:not()伪类括号里面并不支持复杂的选择器（虽然新的规范已经让支持了，目前还没有浏览器跟进）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50420625001256710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`:not(.disabled, .read-only) {\n} /* 无效，不支持 */\n:not(.disabled),\n:not(.read-only) {\n}\n:not(a.disabled) {\n} /* 无效，不支持 */\n:not(a):not(.disabled) {\n}`, `50420625001256710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">:not(.disabled, .read-only)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span> <span class="token comment">/* 无效，不支持 */</span>\n<span class="token selector">:not(.disabled),\n:not(.read-only)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n<span class="token selector">:not(a.disabled)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span> <span class="token comment">/* 无效，不支持 */</span>\n<span class="token selector">:not(a):not(.disabled)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="否定逻辑关系"><a href="#%E5%90%A6%E5%AE%9A%E9%80%BB%E8%BE%91%E5%85%B3%E7%B3%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>否定逻辑关系</h1>\n<h2 id="连续否定的逻辑错误"><a href="#%E8%BF%9E%E7%BB%AD%E5%90%A6%E5%AE%9A%E7%9A%84%E9%80%BB%E8%BE%91%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>连续否定的逻辑错误</h2>\n<p>如果我们想要匹配既不包含.disabled 类名，又不包含.read-only 类名的<code class="language-text">&lt;input&gt;</code>元素，我们的选择器该如何书写，很多人会使用下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18184276388743092000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`input:not(.disabled),\ninput:not(.read-only) {\n}`, `18184276388743092000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">input:not(.disabled),\ninput:not(.read-only)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>逗号分隔的选择器，表示的是“或”的关系，而不是“与”的关系。因此 input:not(.disabled), input:not(.read-only)表示的含义是：不包含.disabled 类名的<code class="language-text">&lt;input&gt;</code>元素，或者不包含.read-only 类名的<code class="language-text">&lt;input&gt;</code>元素。</p>\n<p>最后导致的结果是.disabled 类名和.read-only 类名元素都会匹配。</p>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28711529129946410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!-- 均会匹配 -->\n<input class=&quot;disabled&quot; />\n<input class=&quot;read-only&quot; />`, `28711529129946410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token comment">&lt;!-- 均会匹配 --></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>disabled<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>read-only<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>因为<code class="language-text">&lt;input class=&quot;disabled&quot;&gt;</code>虽然不会匹配 input:not(.disabled)，但是会匹配 input:not(.read-only)，导致出现了不希望出现的匹配效果。</p>\n<p>这里，正确的书写方法应该是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32833854589395340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`input:not(.disabled):not(.read-only) {\n}`, `32833854589395340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">input:not(.disabled):not(.read-only)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="全局否定的逻辑错误"><a href="#%E5%85%A8%E5%B1%80%E5%90%A6%E5%AE%9A%E7%9A%84%E9%80%BB%E8%BE%91%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>全局否定的逻辑错误</h2>\n<p>例如我们希望除了<code class="language-text">&lt;article&gt;</code>标签下的<code class="language-text">&lt;p&gt;</code>元素的 margin 值都是 0，我们代码该怎么写。</p>\n<p>很多人会这样书写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12042537910909768000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`:not(article) p {\n  margin: 0;\n}`, `12042537910909768000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">:not(article) p</span> <span class="token punctuation">{</span>\n  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>看上去没有问题，实际上问题非常严重，:not(article) p 实际语义是，如果<code class="language-text">&lt;p&gt;</code>元素的祖先元素的标签名不是 article，则 margin 值是 0。</p>\n<p>其中就包括这样的场景：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73564908538997970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<article>\n  <section>\n    <p>margin此时也是0！</p>\n    <p></p>\n  </section>\n</article>`, `73564908538997970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>margin此时也是0！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，虽然<code class="language-text">&lt;p&gt;</code>元素在<code class="language-text">&lt;article&gt;</code>元素内，但是，由于同时也在<code class="language-text">&lt;section&gt;</code>元素内，于是匹配了:not(article) p 这个选择器，导致出现意料之外的样式表现。</p>\n<p>正确的书写应该是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12229496578366540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`p {\n  margin: 0;\n}\narticle p {\n  margin: 1em 0;\n}`, `12229496578366540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">{</span>\n  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">article p</span> <span class="token punctuation">{</span>\n  <span class="token property">margin</span><span class="token punctuation">:</span> 1em 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这种场景下，:not 伪类是无解的。</p>\n<p>除非强制层级元素，也就是<code class="language-text">&lt;p&gt;</code>元素是<code class="language-text">&lt;article&gt;</code>的相邻子元素元素，此时我们可以使用下面 CSS 满足我们需求，不过限制很大，建议还是使用传统重置策略：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69000976372620370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`:not(article) > p {\n  margin: 0;\n}`, `69000976372620370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">:not(article) > p</span> <span class="token punctuation">{</span>\n  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/CSS not伪类用法一览/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-11 22:34:10",path:"/css-not-pseudo-class/",tags:"前端, CSS, CSS知识点",title:"CSS not伪类用法一览",draft:null}},{excerpt:"实现方式 通常会新建一个另外的独立页面，专门用来接收传入的前端代码，通过新开窗口或者嵌入 iframe 页面的方式达到最终效果，其中可能会用到 HTML5 postMessage 等通信技术。 然而实际上，对于这个预览效果，如果代码是我们自己控制，而不是全权交给用户编辑的，是没有必要新建一个另外的预览页面，亦或者是在新窗口（新标签页）中浏览的。可以直接在当前页面构建一个文档上下文，实现更加方便快捷的预览。 核心原理 需要注意的是，当我们使用 new Blob…",html:'<h1 id="实现方式"><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现方式</h1>\n<p>通常会新建一个另外的独立页面，专门用来接收传入的前端代码，通过新开窗口或者嵌入 iframe 页面的方式达到最终效果，其中可能会用到 HTML5 postMessage 等通信技术。</p>\n<p>然而实际上，对于这个预览效果，如果代码是我们自己控制，而不是全权交给用户编辑的，是没有必要新建一个另外的预览页面，亦或者是在新窗口（新标签页）中浏览的。可以直接在当前页面构建一个文档上下文，实现更加方便快捷的预览。</p>\n<h1 id="核心原理"><a href="#%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心原理</h1>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="89950648748960280000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`// 1. 创建<iframe>元素\nvar iframe = document.createElement(\'iframe\');\n// 2. 将CSS，HTML字符串转换为Blob对象\nvar blob = new Blob([htmlCode], {\n  type: \'text/html\'\n});\n// 3. 使用URL.createObjectURL()方法将Blob对象转换为URL对象并赋予我们创建的<iframe>元素\niframe.src = URL.createObjectURL(blob);`, `89950648748960280000`)">\n              <div class="gatsby-code-button" title="js">\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 1. 创建&lt;iframe>元素</span>\n<span class="token keyword">var</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'iframe\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 2. 将CSS，HTML字符串转换为Blob对象</span>\n<span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>htmlCode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  type<span class="token punctuation">:</span> <span class="token string">\'text/html\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 3. 使用URL.createObjectURL()方法将Blob对象转换为URL对象并赋予我们创建的&lt;iframe>元素</span>\niframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>需要注意的是，当我们使用 new Blob() 对我们的字符数据进行转换的时候，一定要指定 type 为 text/html，否则，HTML 代码会被自动转移为安全的纯文本显示在<code class="language-text">&lt;iframe&gt;</code>元素中。</p>\n<h1 id="兼容性"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性</h1>\n<p>IE 浏览器遗憾并不支持 src 直接是 URL 对象。</p>\n<p>所以此技术只适用于对兼容性没有严格要求的一些项目。</p>\n<h1 id="结束语"><a href="#%E7%BB%93%E6%9D%9F%E8%AF%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结束语</h1>\n<p>其实很多效果，我们直接在结束当前页面的 window 上下文预览也没什么，但是有一些效果就不行，例如，预览针对响应式布局的 media 屏幕宽度查询下的效果，必须是真实的窗体宽度才会触发 CSS 查询语句的执行，此时，只能在<code class="language-text">&lt;iframe&gt;</code>中预览，我们只要把<code class="language-text">&lt;iframe&gt;</code>元素宽度设置到我们需要的大小就可以了，例如，需要预览类似如下 CSS 代码效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33859374209802007000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@media screen and (max-width: 480px) {\n  img {\n    max-width: 100%;\n  }\n}`, `33859374209802007000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> screen and <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 480px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token selector">img</span> <span class="token punctuation">{</span>\n    <span class="token property">max-width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>只要设置<code class="language-text">&lt;iframe&gt;</code>元素宽度为 480 像素就可以了。</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/iframe和HTML5 blob实现当前页预览/index.md absPath of file >>> MarkdownRemark",timeToRead:1,frontmatter:{date:"2019-12-11 11:53:26",path:"/iframe-html5-blob-code-view/",tags:"前端, JS, JS知识点",title:"iframe和HTML5 blob实现当前页预览",draft:null}},{excerpt:"原生 CSS.supports 语法 返回布尔值 true 或者 false，用来检测是否支持某 CSS 属性。 实际开发的时候，需要使用到对 CSS 检测场景，往往都是针对低版本的 IE 浏览器，例如 IE9-IE11，低版本的 IE 浏览器并不支持浏览器原生支持的 CSS.supports()方法。 JS 赋值再取值的检测方法 当浏览器不支持某个 CSS 属性的时候，就算你强制设置，获取的计算值也不会是你设置的属性值 注意点 getComputedStyle…",html:'<h1 id="原生-csssupports-语法"><a href="#%E5%8E%9F%E7%94%9F-csssupports-%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原生 CSS.supports 语法</h1>\n<p>返回布尔值 true 或者 false，用来检测是否支持某 CSS 属性。</p>\n<p>实际开发的时候，需要使用到对 CSS 检测场景，往往都是针对低版本的 IE 浏览器，例如 IE9-IE11，低版本的 IE 浏览器并不支持浏览器原生支持的 CSS.supports()方法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43210041582763890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// CSS.supports(propertyName, value);\n// CSS.supports(supportCondition);\n// propertyName\n// 字符串。用来检测的CSS属性名。\n// value\n// 字符串。用来检测的CSS属性值。\n// supportCondition\n// 字符串。用来检测的CSS声明、表达式或者语法。\nresult = CSS.supports(\'filter\', \'blur(5px)\');\nresult = CSS.supports(\'filter: 5px\'); // 错误语法，返回false\nresult = CSS.supports(\'--username: zhangxinxu\');\nresult = CSS.supports(\'(--username: zhangxinxu)\');\n// 支持逻辑表达，注意括号是必须的，这里语法错误，返回false\nresult = CSS.supports(\'width: fit-content or width: -webkit-fit-content\');\nresult = CSS.supports(\'(width: fit-content) or (width: -webkit-fit-content)\');`, `43210041582763890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// CSS.supports(propertyName, value);</span>\n<span class="token comment">// CSS.supports(supportCondition);</span>\n<span class="token comment">// propertyName</span>\n<span class="token comment">// 字符串。用来检测的CSS属性名。</span>\n<span class="token comment">// value</span>\n<span class="token comment">// 字符串。用来检测的CSS属性值。</span>\n<span class="token comment">// supportCondition</span>\n<span class="token comment">// 字符串。用来检测的CSS声明、表达式或者语法。</span>\nresult <span class="token operator">=</span> <span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">\'filter\'</span><span class="token punctuation">,</span> <span class="token string">\'blur(5px)\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nresult <span class="token operator">=</span> <span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">\'filter: 5px\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误语法，返回false</span>\nresult <span class="token operator">=</span> <span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">\'--username: zhangxinxu\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nresult <span class="token operator">=</span> <span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">\'(--username: zhangxinxu)\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 支持逻辑表达，注意括号是必须的，这里语法错误，返回false</span>\nresult <span class="token operator">=</span> <span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">\'width: fit-content or width: -webkit-fit-content\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nresult <span class="token operator">=</span> <span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">\'(width: fit-content) or (width: -webkit-fit-content)\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="js-赋值再取值的检测方法"><a href="#js-%E8%B5%8B%E5%80%BC%E5%86%8D%E5%8F%96%E5%80%BC%E7%9A%84%E6%A3%80%E6%B5%8B%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 赋值再取值的检测方法</h1>\n<p>当浏览器不支持某个 CSS 属性的时候，就算你强制设置，获取的计算值也不会是你设置的属性值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82027264386257520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.head.style.filter = \'blur(5px)\';\n// 注意，这里为了兼容到IE9+用了getComputedStyle方法\nresult = window.getComputedStyle(document.head).filter == \'blur(5px)\';\n// 如果是带私有前缀，正则匹配关键部分\ndocument.head.style.width = \'fit-content\';\ndocument.head.style.width = \'-moz-fit-content\';\nresult = /fit-content/.test(window.getComputedStyle(document.head).width);`, `82027264386257520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span>head<span class="token punctuation">.</span>style<span class="token punctuation">.</span>filter <span class="token operator">=</span> <span class="token string">\'blur(5px)\'</span><span class="token punctuation">;</span>\n<span class="token comment">// 注意，这里为了兼容到IE9+用了getComputedStyle方法</span>\nresult <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span>filter <span class="token operator">==</span> <span class="token string">\'blur(5px)\'</span><span class="token punctuation">;</span>\n<span class="token comment">// 如果是带私有前缀，正则匹配关键部分</span>\ndocument<span class="token punctuation">.</span>head<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">\'fit-content\'</span><span class="token punctuation">;</span>\ndocument<span class="token punctuation">.</span>head<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">\'-moz-fit-content\'</span><span class="token punctuation">;</span>\nresult <span class="token operator">=</span> <span class="token regex">/fit-content/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="注意点"><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>注意点</h2>\n<p>getComputedStyle()方法返回的是计算值，很多时候和设置的属性值并不同。</p>\n<p>例如设置行高为小数，在 IE 浏览器下返回就是 px 计算值。</p>\n<p>又或者设置 background 属性值，结果返回的是 background 兄弟姐妹一大家子值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60796104961840470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.head.style.background = \'paint(abc)\';\nresult = /paint/.test(window.getComputedStyle(document.head).background);\n// result值是true\nwindow.getComputedStyle(document.head).background;\n// &quot;rgba(0, 0, 0, 0) paint(abc) repeat scroll 0% 0% / auto padding-box border-box&quot;`, `60796104961840470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span>head<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">\'paint(abc)\'</span><span class="token punctuation">;</span>\nresult <span class="token operator">=</span> <span class="token regex">/paint/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span>background<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// result值是true</span>\nwindow<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span>background<span class="token punctuation">;</span>\n<span class="token comment">// "rgba(0, 0, 0, 0) paint(abc) repeat scroll 0% 0% / auto padding-box border-box"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>需要使用模糊匹配才行。</p>\n<h1 id="其他方法"><a href="#%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他方法</h1>\n<p>同赋值取值法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71620216040843430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.head.setAttribute(\'style\', \'filter: blur(5px)\');\nresult = !!document.head.style.filter;`, `71620216040843430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'style\'</span><span class="token punctuation">,</span> <span class="token string">\'filter: blur(5px)\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nresult <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>document<span class="token punctuation">.</span>head<span class="token punctuation">.</span>style<span class="token punctuation">.</span>filter<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>不考虑兼容性，对 CSS 的进行检测使用 CSS.supports()方法，要检测 IE 浏览器使用赋值取值法。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/JS检测CSS属性浏览器是否支持/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-11 11:36:36",path:"/js-css-supports-detect/",tags:"前端, JS, JS知识点",title:"JS检测CSS属性浏览器是否支持",draft:null}},{excerpt:"需求背景 最近在做表单分享的需求，类似于问卷调查，需要在三端（桌面端、移动端、微信端）同时兼容 技术方案 我出的方案：采用原生语法新框架写，考虑到首屏渲染的问题未采用 主管出的方案：采用后端渲染模板的方式，最大化首屏加载速度，但有以下问题： 后端渲染对服务器 CPU 的要求较高 本来打算用 oss 来减少后端渲染，但考虑到表单经常变化，且分享的链接要尽可能的保持不变，这就限制了 oss…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>最近在做表单分享的需求，类似于问卷调查，需要在三端（桌面端、移动端、微信端）同时兼容</p>\n<h1 id="技术方案"><a href="#%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术方案</h1>\n<ol>\n<li>我出的方案：采用原生语法新框架写，考虑到首屏渲染的问题未采用</li>\n<li>\n<p>主管出的方案：采用后端渲染模板的方式，最大化首屏加载速度，但有以下问题：</p>\n<ol>\n<li>后端渲染对服务器 CPU 的要求较高</li>\n<li>本来打算用 oss 来减少后端渲染，但考虑到表单经常变化，且分享的链接要尽可能的保持不变，这就限制了 oss 的使用</li>\n<li>同样由于分享的链接要尽可能的保持不变，在新的表单分享模板加入后需要后端刷数据，容错性较低</li>\n</ol>\n</li>\n<li>最终讨论结果：采用前后端分离的方式，用原生语法新框架写，需要考虑到版本兼容（新的模板数据和旧的模板数据要同时兼容，在接口里面加一个版本号）、模板枚举 wiki 的命名（减少沟通成本同时缩短分享链接的长度）、loading 页（首屏加载时间可能较长）</li>\n</ol>\n<h1 id="方案调研"><a href="#%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案调研</h1>\n<p>刚开始考虑到用官网的框架，但是由于官网的框架构建过程有太多冗余的东西、以及只能在 node v9.11.2 里面使用的原因，决定自己在 <a href="https://github.com/yeoman/generator-webapp" target="_blank" rel="nofollow noreferrer noopener">generator-webapp</a> 生成的框架上做一下改造，以下是改造的要点：</p>\n<ol>\n<li>资源文件 hash</li>\n<li>接口代理</li>\n<li>模板功能</li>\n</ol>\n<h1 id="具体实施"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E6%96%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实施</h1>\n<h2 id="构建框架搭建"><a href="#%E6%9E%84%E5%BB%BA%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建框架搭建</h2>\n<h3 id="gulp-打包优化"><a href="#gulp-%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gulp 打包优化</h3>\n<p>gulpfile.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6195590906427007000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// generated on 2019-11-07 using generator-webapp 4.0.0-6\nconst { src, dest, watch, series, parallel, lastRun } = require(\'gulp\');\nconst gulpLoadPlugins = require(\'gulp-load-plugins\');\nconst browserSync = require(\'browser-sync\');\nconst del = require(\'del\');\n// const autoprefixer = require(\'autoprefixer\');\nconst cssnano = require(\'cssnano\');\nconst { argv } = require(\'yargs\');\nconst proxy = require(\'http-proxy-middleware\');\nconst postcssPresetEnv = require(\'postcss-preset-env\');\n\nconst config = require(\'./proxy.json\');\nconst globalJSON = require(\'./global.json\');\n\nconst \\$ = gulpLoadPlugins();\nconst server = browserSync.create();\n\nconst port = argv.port || config.port || 9000;\nconst buildPath = argv.buildPath || \'build\';\nconst varsEnv = argv.server || \'master\';\nconst globalVars = globalJSON.runtime[varsEnv];\nconst publicPath = argv.publicPath || \'/form\';\n\nconst isProd = process.env.NODE_ENV === \'production\';\nconst isTest = process.env.NODE_ENV === \'test\';\nconst isDev = !isProd && !isTest;\n\n// 配置反向代理\nconst middleware = config.proxies.map((item) =>\n   proxy(item.match, {\n      target: item.host,\n      changeOrigin: true\n   })\n);\n\nfunction styles() {\n   return src(\'app/styles/*.css\')\n      .pipe(\\$.if(!isProd, \\$.sourcemaps.init()))\n      .pipe(\n         \\$.postcss([\n            // autoprefixer(),\n            // 采用 postcss 最新语法\n            postcssPresetEnv({\n               stage: 0\n            })\n         ])\n      )\n      .pipe(\\$.if(!isProd, \\$.sourcemaps.write()))\n      .pipe(dest(\'.tmp/styles\'))\n      .pipe(server.reload({ stream: true }));\n}\n\nfunction scripts() {\n   return (\n      src(\'app/scripts/**/*.js\')\n         // plumber 插件防止 gulp 报错崩溃\n         .pipe(\\$.plumber())\n         .pipe(\\$.if(!isProd, \\$.sourcemaps.init()))\n         .pipe(\\$.babel())\n         .pipe(\\$.if(!isProd, \\$.sourcemaps.write(\'.\')))\n         .pipe(dest(\'.tmp/scripts\'))\n         .pipe(server.reload({ stream: true }))\n   );\n}\n\nconst lintBase = (files) => {\n   return src(files)\n      .pipe(\\$.eslint({ fix: true }))\n      .pipe(server.reload({ stream: true, once: true }))\n      .pipe(\\$.eslint.format())\n      .pipe(\\$.if(!server.active, \\$.eslint.failAfterError()));\n};\n\nfunction lint() {\n   return lintBase(\'app/scripts/**/*.js\').pipe(dest(\'app/scripts\'));\n}\n\nfunction lintTest() {\n   return lintBase(\'test/spec/**/*.js\').pipe(dest(\'test/spec\'));\n}\n\nfunction html() {\n   // 合成 js、css 过程中，要过滤掉模板编译文件夹的代码\n   // 注意这里的 useref 插件合成 js、css 有一个问题文件行尾必须为 crlf，否则此文件不能正常合成\n   // 可用 .editorconfig 来限制文件行尾符\n   return src([\'app/**/*.html\', \'.tmp/**/*.html\', \'!app/common/**/*.html\', \'!.tmp/common/**/*.html\'])\n      .pipe(\\$.useref({ searchPath: [\'.tmp\', \'app\', \'.\'] }))\n      .pipe(\\$.if(/\\.js\\$/, \\$.uglify({ compress: { drop_console: true } })))\n      .pipe(\\$.if(/\\.css\\$/, \\$.postcss([cssnano({ safe: true, autoprefixer: false })])))\n      .pipe(\n         \\$.if(\n            /\\.html\\$/,\n            \\$.htmlmin({\n               collapseWhitespace: true,\n               minifyCSS: true,\n               minifyJS: { compress: { drop_console: true } },\n               processConditionalComments: true,\n               removeComments: true,\n               removeEmptyAttributes: true,\n               removeScriptTypeAttributes: true,\n               removeStyleLinkTypeAttributes: true\n            })\n         )\n      )\n      .pipe(dest(buildPath));\n}\n\nfunction images() {\n   return src(\'app/images/**/*\', { since: lastRun(images) }).pipe(dest(\\`\\${buildPath}/images\\`));\n}\n\nfunction fonts() {\n   return src(\'app/fonts/**/*.{eot,svg,ttf,woff,woff2}\').pipe(\n      \\$.if(!isProd, dest(\'.tmp/fonts\'), dest(\\`\\${buildPath}/fonts\\`))\n   );\n}\n\nfunction extras() {\n   // 过滤掉模板编译文件夹的代码与 html 代码\n   return src([\'app/*\', \'!app/**/*.html\', \'!app/common\'], {\n      dot: true\n   }).pipe(dest(buildPath));\n}\n\nfunction clean() {\n   return del([\'.tmp\', \\`\\${buildPath}/*\\`]);\n}\n\nfunction measureSize() {\n   return src(\\`\\${buildPath}/**/*\\`).pipe(\\$.size({ title: \'build\', gzip: true }));\n}\n\nconst build = series(\n   clean,\n   parallel(lint, series(parallel(styles, scripts, fileVarInclude), html), images, fonts, extras),\n   revAll,\n   measureSize\n);\n\nfunction startAppServer() {\n   server.init({\n      notify: false,\n      port,\n      server: {\n         baseDir: [\'.tmp\', \'app\'],\n         routes: {\n            \'/node_modules\': \'node_modules\'\n         },\n         middleware\n      }\n   });\n\n   watch([\'app/**/*.html\', \'app/images/**/*\', \'.tmp/fonts/**/*\']).on(\'change\', server.reload);\n\n   watch(\'app/styles/*.css\', styles);\n   watch(\'app/scripts/**/*.js\', scripts);\n   watch(\'app/fonts/**/*\', fonts);\n   // 监控 html 编译模板改动\n   watch(\'app/**/*.html\', fileVarInclude);\n}\n\nfunction startTestServer() {\n   server.init({\n      notify: false,\n      port,\n      ui: false,\n      server: {\n         baseDir: \'test\',\n         routes: {\n            \'/scripts\': \'.tmp/scripts\',\n            \'/node_modules\': \'node_modules\'\n         }\n      }\n   });\n\n   watch(\'app/scripts/**/*.js\', scripts);\n   watch([\'test/spec/**/*.js\', \'test/index.html\']).on(\'change\', server.reload);\n   watch(\'test/spec/**/*.js\', lintTest);\n}\n\nfunction startDistServer() {\n   server.init({\n      notify: false,\n      port,\n      server: {\n         baseDir: buildPath,\n         routes: {\n            \'/node_modules\': \'node_modules\',\n            // 注意这里的别名也要配置，否则资源访问不到\n            [publicPath]: buildPath\n         },\n         middleware\n      }\n   });\n}\n\n// 资源 hash，注意要在最后一步，同时配置路径别名，注意所有的资源引用必须以 &quot;/&quot; 开头，否则别名替换不成功\nfunction revAll() {\n   return src(\\`\\${buildPath}/**\\`)\n      .pipe(\n         \\$.revAll.revision({\n            prefix: publicPath,\n            dontRenameFile: [/^\\/favicon.ico\\$/g, \'.html\', \'robots.txt\']\n         })\n      )\n      .pipe(\\$.revDeleteOriginal())\n      .pipe(dest(buildPath));\n}\n\nfunction fileVarInclude() {\n   return src(\'app/**/*.html\')\n      .pipe(\\$.plumber())\n      .pipe(\n         \\$.fileInclude({\n            prefix: \'@@\',\n            basepath: \'@root\',\n            // 环境变量注入\n            // 需要在公共的模板文件中注入此变量\n            // <script>\n            //   window.GLOBAL_VARS = @@GLOBAL_VARS;\n            // </script>\n            context: {\n               GLOBAL_VARS: JSON.stringify(globalVars)\n            }\n         })\n      )\n      .pipe(dest(\'.tmp\'))\n      .pipe(server.reload({ stream: true }));\n}\n\nlet serve;\nif (isDev) {\n   serve = series(clean, parallel(styles, scripts, fonts, fileVarInclude), startAppServer);\n} else if (isTest) {\n   serve = series(clean, scripts, startTestServer);\n} else if (isProd) {\n   serve = series(build, startDistServer);\n}\n\nexports.serve = serve;\nexports.build = build;\nexports.default = build;`, `6195590906427007000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// generated on 2019-11-07 using generator-webapp 4.0.0-6</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> series<span class="token punctuation">,</span> parallel<span class="token punctuation">,</span> lastRun <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> gulpLoadPlugins <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> browserSync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'browser-sync\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> del <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'del\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// const autoprefixer = require(\'autoprefixer\');</span>\n<span class="token keyword">const</span> cssnano <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'cssnano\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> argv <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'yargs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'http-proxy-middleware\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssPresetEnv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-preset-env\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./proxy.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> globalJSON <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./global.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">gulpLoadPlugins</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> server <span class="token operator">=</span> browserSync<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> port <span class="token operator">=</span> argv<span class="token punctuation">.</span>port <span class="token operator">||</span> config<span class="token punctuation">.</span>port <span class="token operator">||</span> <span class="token number">9000</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> buildPath <span class="token operator">=</span> argv<span class="token punctuation">.</span>buildPath <span class="token operator">||</span> <span class="token string">\'build\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> varsEnv <span class="token operator">=</span> argv<span class="token punctuation">.</span>server <span class="token operator">||</span> <span class="token string">\'master\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> globalVars <span class="token operator">=</span> globalJSON<span class="token punctuation">.</span>runtime<span class="token punctuation">[</span>varsEnv<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> publicPath <span class="token operator">=</span> argv<span class="token punctuation">.</span>publicPath <span class="token operator">||</span> <span class="token string">\'/form\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> isTest <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">\'test\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> isDev <span class="token operator">=</span> <span class="token operator">!</span>isProd <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isTest<span class="token punctuation">;</span>\n\n<span class="token comment">// 配置反向代理</span>\n<span class="token keyword">const</span> middleware <span class="token operator">=</span> config<span class="token punctuation">.</span>proxies<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token function">proxy</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>match<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      target<span class="token punctuation">:</span> item<span class="token punctuation">.</span>host<span class="token punctuation">,</span>\n      changeOrigin<span class="token punctuation">:</span> <span class="token boolean">true</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">styles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'app/styles/*.css\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">,</span> $<span class="token punctuation">.</span>sourcemaps<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>\n         $<span class="token punctuation">.</span><span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n            <span class="token comment">// autoprefixer(),</span>\n            <span class="token operator">/</span><span class="token operator">/</span> 采用 postcss 最新语法\n            <span class="token function">postcssPresetEnv</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               stage<span class="token punctuation">:</span> <span class="token number">0</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n         <span class="token punctuation">]</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">,</span> $<span class="token punctuation">.</span>sourcemaps<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'.tmp/styles\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">{</span> stream<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">scripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'app/scripts/**/*.js\'</span><span class="token punctuation">)</span>\n         <span class="token comment">// plumber 插件防止 gulp 报错崩溃</span>\n         <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">plumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n         <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">,</span> $<span class="token punctuation">.</span>sourcemaps<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n         <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n         <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">,</span> $<span class="token punctuation">.</span>sourcemaps<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">\'.\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n         <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'.tmp/scripts\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n         <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">{</span> stream<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">lintBase</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">eslint</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fix<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">{</span> stream<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> once<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>eslint<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>server<span class="token punctuation">.</span>active<span class="token punctuation">,</span> $<span class="token punctuation">.</span>eslint<span class="token punctuation">.</span><span class="token function">failAfterError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">lint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">lintBase</span><span class="token punctuation">(</span><span class="token string">\'app/scripts/**/*.js\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'app/scripts\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">lintTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">lintBase</span><span class="token punctuation">(</span><span class="token string">\'test/spec/**/*.js\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'test/spec\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 合成 js、css 过程中，要过滤掉模板编译文件夹的代码</span>\n   <span class="token comment">// 注意这里的 useref 插件合成 js、css 有一个问题文件行尾必须为 crlf，否则此文件不能正常合成</span>\n   <span class="token comment">// 可用 .editorconfig 来限制文件行尾符</span>\n   <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'app/**/*.html\'</span><span class="token punctuation">,</span> <span class="token string">\'.tmp/**/*.html\'</span><span class="token punctuation">,</span> <span class="token string">\'!app/common/**/*.html\'</span><span class="token punctuation">,</span> <span class="token string">\'!.tmp/common/**/*.html\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">useref</span><span class="token punctuation">(</span><span class="token punctuation">{</span> searchPath<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'.tmp\'</span><span class="token punctuation">,</span> <span class="token string">\'app\'</span><span class="token punctuation">,</span> <span class="token string">\'.\'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token regex">/\\.js$/</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">uglify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> compress<span class="token punctuation">:</span> <span class="token punctuation">{</span> drop_console<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token regex">/\\.css$/</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">cssnano</span><span class="token punctuation">(</span><span class="token punctuation">{</span> safe<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> autoprefixer<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>\n         $<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span>\n            <span class="token regex">/\\.html$/</span><span class="token punctuation">,</span>\n            $<span class="token punctuation">.</span><span class="token function">htmlmin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n               minifyCSS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n               minifyJS<span class="token punctuation">:</span> <span class="token punctuation">{</span> compress<span class="token punctuation">:</span> <span class="token punctuation">{</span> drop_console<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n               processConditionalComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n               removeComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n               removeEmptyAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n               removeScriptTypeAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n               removeStyleLinkTypeAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n         <span class="token punctuation">)</span>\n      <span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span>buildPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">images</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'app/images/**/*\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> since<span class="token punctuation">:</span> <span class="token function">lastRun</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>buildPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/images</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">fonts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'app/fonts/**/*.{eot,svg,ttf,woff,woff2}\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>\n      $<span class="token punctuation">.</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">,</span> <span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'.tmp/fonts\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dest</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>buildPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/fonts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">extras</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 过滤掉模板编译文件夹的代码与 html 代码</span>\n   <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'app/*\'</span><span class="token punctuation">,</span> <span class="token string">\'!app/**/*.html\'</span><span class="token punctuation">,</span> <span class="token string">\'!app/common\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      dot<span class="token punctuation">:</span> <span class="token boolean">true</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span>buildPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'.tmp\'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>buildPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">measureSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>buildPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">\'build\'</span><span class="token punctuation">,</span> gzip<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> build <span class="token operator">=</span> <span class="token function">series</span><span class="token punctuation">(</span>\n   clean<span class="token punctuation">,</span>\n   <span class="token function">parallel</span><span class="token punctuation">(</span>lint<span class="token punctuation">,</span> <span class="token function">series</span><span class="token punctuation">(</span><span class="token function">parallel</span><span class="token punctuation">(</span>styles<span class="token punctuation">,</span> scripts<span class="token punctuation">,</span> fileVarInclude<span class="token punctuation">)</span><span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">,</span> images<span class="token punctuation">,</span> fonts<span class="token punctuation">,</span> extras<span class="token punctuation">)</span><span class="token punctuation">,</span>\n   revAll<span class="token punctuation">,</span>\n   measureSize\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">startAppServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   server<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      notify<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      port<span class="token punctuation">,</span>\n      server<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         baseDir<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'.tmp\'</span><span class="token punctuation">,</span> <span class="token string">\'app\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n         routes<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token string">\'/node_modules\'</span><span class="token punctuation">:</span> <span class="token string">\'node_modules\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         middleware\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'app/**/*.html\'</span><span class="token punctuation">,</span> <span class="token string">\'app/images/**/*\'</span><span class="token punctuation">,</span> <span class="token string">\'.tmp/fonts/**/*\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'change\'</span><span class="token punctuation">,</span> server<span class="token punctuation">.</span>reload<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">\'app/styles/*.css\'</span><span class="token punctuation">,</span> styles<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">\'app/scripts/**/*.js\'</span><span class="token punctuation">,</span> scripts<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">\'app/fonts/**/*\'</span><span class="token punctuation">,</span> fonts<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// 监控 html 编译模板改动</span>\n   <span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">\'app/**/*.html\'</span><span class="token punctuation">,</span> fileVarInclude<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">startTestServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   server<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      notify<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      port<span class="token punctuation">,</span>\n      ui<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      server<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         baseDir<span class="token punctuation">:</span> <span class="token string">\'test\'</span><span class="token punctuation">,</span>\n         routes<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token string">\'/scripts\'</span><span class="token punctuation">:</span> <span class="token string">\'.tmp/scripts\'</span><span class="token punctuation">,</span>\n            <span class="token string">\'/node_modules\'</span><span class="token punctuation">:</span> <span class="token string">\'node_modules\'</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">\'app/scripts/**/*.js\'</span><span class="token punctuation">,</span> scripts<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'test/spec/**/*.js\'</span><span class="token punctuation">,</span> <span class="token string">\'test/index.html\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'change\'</span><span class="token punctuation">,</span> server<span class="token punctuation">.</span>reload<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">\'test/spec/**/*.js\'</span><span class="token punctuation">,</span> lintTest<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">startDistServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   server<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      notify<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      port<span class="token punctuation">,</span>\n      server<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         baseDir<span class="token punctuation">:</span> buildPath<span class="token punctuation">,</span>\n         routes<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token string">\'/node_modules\'</span><span class="token punctuation">:</span> <span class="token string">\'node_modules\'</span><span class="token punctuation">,</span>\n            <span class="token comment">// 注意这里的别名也要配置，否则资源访问不到</span>\n            <span class="token punctuation">[</span>publicPath<span class="token punctuation">]</span><span class="token punctuation">:</span> buildPath\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         middleware\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 资源 hash，注意要在最后一步，同时配置路径别名，注意所有的资源引用必须以 "/" 开头，否则别名替换不成功</span>\n<span class="token keyword">function</span> <span class="token function">revAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>buildPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>\n         $<span class="token punctuation">.</span>revAll<span class="token punctuation">.</span><span class="token function">revision</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            prefix<span class="token punctuation">:</span> publicPath<span class="token punctuation">,</span>\n            dontRenameFile<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/^\\/favicon.ico$/g</span><span class="token punctuation">,</span> <span class="token string">\'.html\'</span><span class="token punctuation">,</span> <span class="token string">\'robots.txt\'</span><span class="token punctuation">]</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">revDeleteOriginal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span>buildPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">fileVarInclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'app/**/*.html\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">plumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>\n         $<span class="token punctuation">.</span><span class="token function">fileInclude</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            prefix<span class="token punctuation">:</span> <span class="token string">\'@@\'</span><span class="token punctuation">,</span>\n            basepath<span class="token punctuation">:</span> <span class="token string">\'@root\'</span><span class="token punctuation">,</span>\n            <span class="token comment">// 环境变量注入</span>\n            <span class="token comment">// 需要在公共的模板文件中注入此变量</span>\n            <span class="token comment">// &lt;script></span>\n            <span class="token comment">//   window.GLOBAL_VARS = @@GLOBAL_VARS;</span>\n            <span class="token comment">// &lt;/script></span>\n            context<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n               <span class="token constant">GLOBAL_VARS</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>globalVars<span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'.tmp\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">{</span> stream<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">let</span> serve<span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>isDev<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   serve <span class="token operator">=</span> <span class="token function">series</span><span class="token punctuation">(</span>clean<span class="token punctuation">,</span> <span class="token function">parallel</span><span class="token punctuation">(</span>styles<span class="token punctuation">,</span> scripts<span class="token punctuation">,</span> fonts<span class="token punctuation">,</span> fileVarInclude<span class="token punctuation">)</span><span class="token punctuation">,</span> startAppServer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isTest<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   serve <span class="token operator">=</span> <span class="token function">series</span><span class="token punctuation">(</span>clean<span class="token punctuation">,</span> scripts<span class="token punctuation">,</span> startTestServer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isProd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   serve <span class="token operator">=</span> <span class="token function">series</span><span class="token punctuation">(</span>build<span class="token punctuation">,</span> startDistServer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nexports<span class="token punctuation">.</span>serve <span class="token operator">=</span> serve<span class="token punctuation">;</span>\nexports<span class="token punctuation">.</span>build <span class="token operator">=</span> build<span class="token punctuation">;</span>\nexports<span class="token punctuation">.</span>default <span class="token operator">=</span> build<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="文件目录结构"><a href="#%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>文件目录结构</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-11-15-15-48-13-26cb5a37003ca0d864117a124e54dbeb-0f2f0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 455px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 154.2857142857143%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAIAAABoLHqZAAAACXBIWXMAAAsSAAALEgHS3X78AAACU0lEQVQ4y5WVSW7cMBBFdRH3pJmUOFOkqHnoVntKOzECZOEL5P4XSDXgdUwDtdTHr3r1iwqiMD+cX47rMyl4jNgxxv4V5ML96tc/22u/3TA1iBrMrGcFYU6VarbHt2a82HaOMnqv3KuCY4QQN93LOxGmqntM1CFCnhUcYkyIuo2bacZ2WIV2p6TwnfmYFJTIj7YHWyrr3TH9BrAwLiKqop/vynTjckVE7cPc2znGJTfb62/jhnHeuHYwjK8YJsxLafpFVW3dzQli3xCHCc5Zrd/+GjcCM+j5O84xTrDonp66cW36tWBVklP/mYskwxcVKdNUbmz6BVNghnyBxTltuKtsB3u27eQPHMQowTJbP1Q9QOd1O/kzCx5i/KOb38YlJTLOyMMx3d+j5zfz/oSna729LmkuqDAlr5iqo4z4mAfRCSVPV3a7aVmHWQnmCaKe8Q6OIU6tlpOrTA+2wPnBO97BLkSMMSllO1xgT6BPMfcGdsqMaazt6naGVfXTxTaTr3gXFypJHEZVu8BV2mYk3PiLsc7ylpDh/NyNZ6YdbB6A+TAL9iFmFClJlR0gIXCYu1MG5ROyu5gSpDW37WKbwdSDrnsoKuyXzQNtzDmqDLwCs7SddgNXDnIC5/F/MaQw2EcYIyxLqoVx0lAqd+HXbcOzGadFsI9xnha2oIPQo9CiYAcPzvBNmpbBARJGsWjgItfh/DgsV3gJoeEvaX+2DcBMJU0zuXaCkA3zdt+ZrH2AFZxkSpSIaMKrvBSgCdPSKySHMItFk1cd5RrcmLTwx/G8qn8QqzZdVS/hMwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 11 15 15 48 13" title="" data-src="/static/2019-11-15-15-48-13-26cb5a37003ca0d864117a124e54dbeb-0f2f0.png" data-srcset="/static/2019-11-15-15-48-13-26cb5a37003ca0d864117a124e54dbeb-f5c73.png 200w,\n/static/2019-11-15-15-48-13-26cb5a37003ca0d864117a124e54dbeb-799a4.png 400w,\n/static/2019-11-15-15-48-13-26cb5a37003ca0d864117a124e54dbeb-0f2f0.png 455w" data-sizes="(max-width: 455px) 100vw, 455px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="代码优化"><a href="#%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码优化</h2>\n<ol>\n<li>\n<p>除了在使用大量原生语法外，利用 gulp-file-include 插件大量复用了模板代码，确保多次使用的 html 代码在模板代码文件夹下。</p>\n</li>\n<li>\n<p>同时为了首屏加载速度，图片需要压缩，这里用了阿里云的 oss 图片压缩服务，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45021525171769920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 参数的功能分别是调整宽度、质量、是否是渐进式、格式转换为 jpg\nfunction compressImg(oss, width = window.innerWidth) {\n  return \\`\\${oss}?x-oss-process=image/resize,w_\\${width}/quality,q_50/interlace,1/format,jpg\\`;\n}`, `45021525171769920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 参数的功能分别是调整宽度、质量、是否是渐进式、格式转换为 jpg</span>\n<span class="token keyword">function</span> <span class="token function">compressImg</span><span class="token punctuation">(</span><span class="token parameter">oss<span class="token punctuation">,</span> width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>oss<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?x-oss-process=image/resize,w_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/quality,q_50/interlace,1/format,jpg</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>尽量在各自对应的平台加载相应的代码，比如微信分享脚本只在微信端加载，背景图只在桌面端加载，图片压缩的宽度尽可能的小</p>\n</li>\n</ol>\n<h1 id="加载效果"><a href="#%E5%8A%A0%E8%BD%BD%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>加载效果</h1>\n<p>加载大小非自定义图片部分 28.4kb，自定义图片部分 57.5kb。</p>\n<p>加载速度（不限速）264ms，3g low（限速 120 kb/s）1.01s。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-11-15-16-27-42-a8e9a3af61496e6fd0ce82a4bcfaa4d2-c26ee.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.22505800464037%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABp0lEQVQY002Nj0vicBjG919fgdNCzQvKHwcHB0Ed1JVkRdN2rZmpc9bMzFrmlGbrh0xvszWnc23f9e2+GkUfXh6eF97nebGV5ZXE5laW2mfT9Nrv5WDAHwoGv4fmgn5/KBDw4bgP9/hmZn3+QCIeZ9PpzN+9PJViqFSOJDCOImunXDa5wzOZxMafb1PTHo8Hx3GkXq8XGaTvntiMn5C7VyUWTY1jrwp5jCFT60u/WHK7miFocndhMRyNRmOxWCQSCYfDSKMTkKWJbTa50SwzzYuyWCk1uCJ2nD38Oe8tFw5a9aqhdQFwHccBAFiWpaqqMwGttm2fc0fCZUmWBEngqyfF2jGLlXK5ev2sXi1IfNHsKxC+ffLFjrm/vRbK2ae2IN/fHFE0sZPE8vR+q8UPtEdDFZ0Xw3Vf4QcoDj8qkJqG2lfFF0PWtQ5N7a0ltjDm+lxRJMeQbf3BtY3x3eS7BSDXfq+YhOEbMDVHf7AHcrf3yEsNoX2H/VhdP6xU5KHWVDrKyER/wSsEEFrA/TcEQ9McDMdjjkbdwbPY64ha71Z/Fvv9hm78B0R1gs7qLKXOAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 11 15 16 27 42" title="" data-src="/static/2019-11-15-16-27-42-a8e9a3af61496e6fd0ce82a4bcfaa4d2-fee1c.png" data-srcset="/static/2019-11-15-16-27-42-a8e9a3af61496e6fd0ce82a4bcfaa4d2-a67b7.png 200w,\n/static/2019-11-15-16-27-42-a8e9a3af61496e6fd0ce82a4bcfaa4d2-0b187.png 400w,\n/static/2019-11-15-16-27-42-a8e9a3af61496e6fd0ce82a4bcfaa4d2-fee1c.png 800w,\n/static/2019-11-15-16-27-42-a8e9a3af61496e6fd0ce82a4bcfaa4d2-b1a91.png 1200w,\n/static/2019-11-15-16-27-42-a8e9a3af61496e6fd0ce82a4bcfaa4d2-95179.png 1600w,\n/static/2019-11-15-16-27-42-a8e9a3af61496e6fd0ce82a4bcfaa4d2-c26ee.png 1724w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-11-15-16-28-14-f42acdff926771d49665fafeed0fa979-5fe3e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 24.685314685314683%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAuklEQVQY021P2W4EIQzj//9ypIFh2HANEMJRqd6t2qdaYEVJnDjKE6WUnHuBX0Raa3uZnJ855lpr/oe/vGLpYy1Zk5f0KU24CnI181N67zIA+fAnkPf/4d6VNsY5d1lrLpC19413WxtiaMwxpdZaKQWVnHNnrsDzFKJwO2W0Po4DNe99DCFGEBBrbV9711KwEA7O88RMCN+mxyjeZyKFdbgTB69f7L1hCtsQg6FkZvRAT0Q4dcyJoTmlb7OFHDC6aGk1AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 11 15 16 28 14" title="" data-src="/static/2019-11-15-16-28-14-f42acdff926771d49665fafeed0fa979-fee1c.png" data-srcset="/static/2019-11-15-16-28-14-f42acdff926771d49665fafeed0fa979-a67b7.png 200w,\n/static/2019-11-15-16-28-14-f42acdff926771d49665fafeed0fa979-0b187.png 400w,\n/static/2019-11-15-16-28-14-f42acdff926771d49665fafeed0fa979-fee1c.png 800w,\n/static/2019-11-15-16-28-14-f42acdff926771d49665fafeed0fa979-b1a91.png 1200w,\n/static/2019-11-15-16-28-14-f42acdff926771d49665fafeed0fa979-5fe3e.png 1430w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-11-15-16-30-09-d7cf482606701089fd178f161bae0fb6-4cbd1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.47582697201018%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABF0lEQVQY01WRi26EIBBF/f9PbLJZVFgQBBVUYLfd9Kht0l4emfcdhmYKeolzTCmy1hRCcKOzwaHWmvOz5FpqfVbOf2BpSsn7zt431iXlvJda9i3MdlyXuG9p20vOpZR1XfGXEznnxhg9jiNK/YtSqB1jgvX1eqWUtm1D8N67E/M8E9D0veh7SfLXic9fIC9xoc6VDCFGY0zbtl3XwYe9Efc7ulIK3VrrTyBfQvlpIdIk0QQIIaBFPt6spGxPDMNAYdLoyp4g+ZoNPVMFZlxSSlyM82A2w6D18WzG936/j9a5z814iMBA2zDj5S/IhAZy7M3H7XYXQmltMPNL3lv1sL1y8kFLzo0+TA9tBuv8NPVSdhx1GFC/AbHnxLOwfWV5AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 11 15 16 30 09" title="" data-src="/static/2019-11-15-16-30-09-d7cf482606701089fd178f161bae0fb6-fee1c.png" data-srcset="/static/2019-11-15-16-30-09-d7cf482606701089fd178f161bae0fb6-a67b7.png 200w,\n/static/2019-11-15-16-30-09-d7cf482606701089fd178f161bae0fb6-0b187.png 400w,\n/static/2019-11-15-16-30-09-d7cf482606701089fd178f161bae0fb6-fee1c.png 800w,\n/static/2019-11-15-16-30-09-d7cf482606701089fd178f161bae0fb6-4cbd1.png 1179w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-11-15-16-32-29-01c45e20b0783eb591eb982aecbcc9fc-28530.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.91559086395233%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABjElEQVQoz11S25KkIAz1/39wax9Wu21FkQYEwl3tOerDzkwqFQ4hIddmFYJC0kpNjA2MzW0r21YIIaXSWkspjTH+G5Gnm4Gb4/M5Ltq37dhPgmar2447jgq5na/QX7LWmnPJoJSavOcQvM1ujc6XsnrnczHBUa6ags30jkbFtFBSsQpKMkbhrYqZ29AIbY1P0nppSbmoCZy0P6UCW8+1URRXn8VKbxu0T8qFBV6hNn+68e+Tt0yN0gu3SX9Iv7/plMDclJ5bFT7AMOi5AV7s9m+ULdPNOL6miaERV43lO+9bzSmSs/tZfAke0N5KxsaFz834eg59b41FJ8pPgiaEsBpTz2+LdSACjDE+H4++6xrZv0zbBsYSUfnlj8bG6Oe5OAcMA/T2VIbg+t5PU/MaRnwDxkj/B7+mgfOMrBSGgyfkDEYWiPzouhaR+TLzmWMfiOia7Aa77RwrBn4kZHvra72XBDilxJcFwRrO+bqu1p4VYZmuusjMQjyn97DYYbRCYB+wFLcz0oEzMgL4AmVFc9jLrIuGAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 11 15 16 32 29" title="" data-src="/static/2019-11-15-16-32-29-01c45e20b0783eb591eb982aecbcc9fc-fee1c.png" data-srcset="/static/2019-11-15-16-32-29-01c45e20b0783eb591eb982aecbcc9fc-a67b7.png 200w,\n/static/2019-11-15-16-32-29-01c45e20b0783eb591eb982aecbcc9fc-0b187.png 400w,\n/static/2019-11-15-16-32-29-01c45e20b0783eb591eb982aecbcc9fc-fee1c.png 800w,\n/static/2019-11-15-16-32-29-01c45e20b0783eb591eb982aecbcc9fc-28530.png 1007w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/轻量级网站构建实践/index.md absPath of file >>> MarkdownRemark",timeToRead:5,frontmatter:{date:"2019-11-15 15:04:04",path:"/lightweight-website-construction/",tags:"前端, 轻量级网站, 预研",title:"轻量级网站构建实践",draft:null}},{excerpt:"需求背景 需求背景接上文  记一次组件打包为链接的实践 框架搭建接上文  Webpack 脚手架搭建笔记——记一次新项目搭建 组件轻量化 在将客服组件上线后，由于未考虑到加载的组件包的大小，尤其是初始加载的包比较大，即使是压缩过初始加载也有 600 多 k…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>需求背景接上文 <a href="/components-pack-as-library/">记一次组件打包为链接的实践</a></p>\n<p>框架搭建接上文 <a href="/webpack-template-new-project/">Webpack 脚手架搭建笔记——记一次新项目搭建</a></p>\n<h2 id="组件轻量化"><a href="#%E7%BB%84%E4%BB%B6%E8%BD%BB%E9%87%8F%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件轻量化</h2>\n<p>在将客服组件上线后，由于未考虑到加载的组件包的大小，尤其是初始加载的包比较大，即使是压缩过初始加载也有 600 多 k，严重影响首页加载，导致加载此脚本的网站需要很长时间才能响应，所以有了这次的优化任务</p>\n<h2 id="移动端适配"><a href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%80%82%E9%85%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移动端适配</h2>\n<p>根据产品要求，此客服组件还需要兼容到移动端，微信端（微信网页、小程序）</p>\n<h1 id="方案调研"><a href="#%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案调研</h1>\n<ol>\n<li>组件异步加载，减少首屏加载大小，非首屏且较大的组件预加载，这里需要 nginx 的配合</li>\n<li>去除较大的库，改用轻量级的替代库或者不用</li>\n<li>所有用到的组件最好都由自己编写，有利于定制化功能、减小组件大小</li>\n<li>移动端可以和桌面端项目写在一起分开打包</li>\n<li>代码的分层尤其是 IM 层要分离出来，便于切换不同的 IM 提供商</li>\n<li>小程序端用 webview 加载的网页，需要注意在第三方小程序上配置 nginx</li>\n</ol>\n<h1 id="具体实施"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E6%96%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实施</h1>\n<h2 id="组件异步加载"><a href="#%E7%BB%84%E4%BB%B6%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件异步加载</h2>\n<p>需要修改 webpack 配置，由于之前是在 webpack2 上开发，不能很完美的做到异步加载。此时将框架升级到和本文 <a href="/webpack-template-new-project/">Webpack 脚手架搭建笔记——记一次新项目搭建</a> 的同一版本，具体修改如下：</p>\n<ol>\n<li>\n<p>去除 mini-css-extract-plugin，防止 css 单独抽离</p>\n</li>\n<li>\n<p>聚合初始加载脚本到一个文件，异步加载的在其他文件，且对异步加载的做 hash 处理</p>\n<p>boot\\internals\\webpack\\webpack.prod.babel.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98041943479157720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`entry: {\n bundle: [\'runtime/polyfill\', path.join(process.cwd(), buildMap.indexEntry)],\n},\n\noutput: {\n filename: \'[name].js\',\n chunkFilename: \'[name].[chunkhash].chunk.js\',\n},\n\n// 关闭代码切割，防止首页产生除 bundle.js 外的其他文件\n// runtimeChunk: \'single\',\nsplitChunks: false,`, `98041943479157720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n bundle<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'runtime/polyfill\'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buildMap<span class="token punctuation">.</span>indexEntry<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\noutput<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n filename<span class="token punctuation">:</span> <span class="token string">\'[name].js\'</span><span class="token punctuation">,</span>\n chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].chunk.js\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token comment">// 关闭代码切割，防止首页产生除 bundle.js 外的其他文件</span>\n<span class="token comment">// runtimeChunk: \'single\',</span>\nsplitChunks<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>生成构建文件如下：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-11-25-49-bc4044d99bc392a402c1d0e3ce7063b2-b043c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 539px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.137291280148425%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA60lEQVQY011Q7U7DMAzso3Rja9o0dhLnoy385AcSA4QQ4/0fhXNbTTDpZDk+3zl2Ux6fXz8+pTy5uIx+HrgqqO7JDXRft1yb9uSuF5NLIog5Hzv3ABj6D1T4rng4j82h4+ublRSNS14mipVl8ml2vnCsJBOeIc2xLIg7FQqiGYOKvy82ZekpQwl4AZ03IwolpAWtQMyq96sF9GBV/PNuJcfeZQrVhTp6TbaB6rVG5Nt8/AjsQNKebHPs+OtlwLdxAFQtJ6di7eB1BXSrXay4COK5Z8iw8Lqz4bm3gROL7omDtSuBjh1/8k1zwy+Vb0zfFkV37AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 11 25 49" title="" data-src="/static/2019-10-29-11-25-49-bc4044d99bc392a402c1d0e3ce7063b2-b043c.png" data-srcset="/static/2019-10-29-11-25-49-bc4044d99bc392a402c1d0e3ce7063b2-e7723.png 200w,\n/static/2019-10-29-11-25-49-bc4044d99bc392a402c1d0e3ce7063b2-61f03.png 400w,\n/static/2019-10-29-11-25-49-bc4044d99bc392a402c1d0e3ce7063b2-b043c.png 539w" data-sizes="(max-width: 539px) 100vw, 539px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-11-26-45-0dd51dca711978fc9eedd98affc6fa2b-b1a91.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAA80lEQVQY033QW3LDIAwFUK+lbfwAJBAgIbCdJvvfVLHTTNuPZuaMRnzAFRp0vSOV0cbL7C+Lf5/wtbcRF0gY9WPGIVG9lqvU3QUF0gV4dvm1yebRpN4M7FWoAMkMebRpMmmy32abD/+/MmRf99S4NdpbZA2i/oSiLpXOIP+NPTKn08ChKlVMBbJiJzUkDVFdVANsgReQ/pcFxZwslqMCm345hNr42qhpu6d607xLvfF272S97bJp+/S8UWwhrUD1wfsCKMfCxKsL4uLBenYkkItN0vWxgYshQRBzzvyzkZ5M1LyvM5TlAc/qnkf37PFgUH/7AoQQWlIoJmRsAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 11 26 45" title="" data-src="/static/2019-10-29-11-26-45-0dd51dca711978fc9eedd98affc6fa2b-fee1c.png" data-srcset="/static/2019-10-29-11-26-45-0dd51dca711978fc9eedd98affc6fa2b-a67b7.png 200w,\n/static/2019-10-29-11-26-45-0dd51dca711978fc9eedd98affc6fa2b-0b187.png 400w,\n/static/2019-10-29-11-26-45-0dd51dca711978fc9eedd98affc6fa2b-fee1c.png 800w,\n/static/2019-10-29-11-26-45-0dd51dca711978fc9eedd98affc6fa2b-b1a91.png 1200w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>首页只会引入 bundle.js 文件，且异步组件在其他文件</p>\n<h2 id="较大组件预加载"><a href="#%E8%BE%83%E5%A4%A7%E7%BB%84%E4%BB%B6%E9%A2%84%E5%8A%A0%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>较大组件预加载</h2>\n<p>这里为了打开聊天组件时不会卡顿，使用了预加载，一定要注意要在主入口加载完成，也就是请求加载完成后在进行预加载，否则同样会造成首页加载时间过长</p>\n<p>这里采取的方案是请求完成后要提前知道加载哪个组件就立即预加载此组件（需要后端配合，不适用于点击后才知道加载哪个组件的情况。当然也可以全部预加载所有较大组件，不过为了省流就没这么做），不用等到点击后加载</p>\n<h2 id="精简依赖库"><a href="#%E7%B2%BE%E7%AE%80%E4%BE%9D%E8%B5%96%E5%BA%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>精简依赖库</h2>\n<h3 id="打包前依赖"><a href="#%E6%89%93%E5%8C%85%E5%89%8D%E4%BE%9D%E8%B5%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>打包前依赖</h3>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42198664204286680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`&quot;dependencies&quot;: {\n &quot;antd&quot;: &quot;^3.11.0&quot;,\n &quot;babel-polyfill&quot;: &quot;6.26.0&quot;,\n &quot;classnames&quot;: &quot;^2.2.5&quot;,\n &quot;element-resize-event&quot;: &quot;^2.0.9&quot;,\n &quot;immutable&quot;: &quot;3.8.1&quot;,\n &quot;invariant&quot;: &quot;2.2.2&quot;,\n &quot;lodash&quot;: &quot;4.17.2&quot;,\n &quot;md5&quot;: &quot;^2.2.1&quot;,\n &quot;moment&quot;: &quot;^2.18.1&quot;,\n &quot;prop-types&quot;: &quot;^15.6.2&quot;,\n &quot;raf&quot;: &quot;^3.4.1&quot;,\n &quot;react&quot;: &quot;16.6.0&quot;,\n &quot;react-dom&quot;: &quot;16.6.0&quot;,\n &quot;react-helmet&quot;: &quot;5.2.0&quot;,\n &quot;react-player&quot;: &quot;^1.6.4&quot;,\n &quot;react-redux&quot;: &quot;5.1.0&quot;,\n &quot;react-router&quot;: &quot;3.2.1&quot;,\n &quot;react-router-redux&quot;: &quot;4.0.6&quot;,\n &quot;react-router-scroll&quot;: &quot;0.4.4&quot;,\n &quot;redux&quot;: &quot;3.6.0&quot;,\n &quot;redux-immutable&quot;: &quot;3.0.8&quot;,\n &quot;redux-saga&quot;: &quot;0.16.2&quot;,\n &quot;reselect&quot;: &quot;2.5.4&quot;,\n &quot;rxjs&quot;: &quot;5.5.3&quot;,\n &quot;smoothscroll-polyfill&quot;: &quot;^0.3.6&quot;,\n &quot;warning&quot;: &quot;3.0.0&quot;,\n &quot;whatwg-fetch&quot;: &quot;2.0.1&quot;\n},`, `42198664204286680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n <span class="token string">"antd"</span><span class="token punctuation">:</span> <span class="token string">"^3.11.0"</span><span class="token punctuation">,</span>\n <span class="token string">"babel-polyfill"</span><span class="token punctuation">:</span> <span class="token string">"6.26.0"</span><span class="token punctuation">,</span>\n <span class="token string">"classnames"</span><span class="token punctuation">:</span> <span class="token string">"^2.2.5"</span><span class="token punctuation">,</span>\n <span class="token string">"element-resize-event"</span><span class="token punctuation">:</span> <span class="token string">"^2.0.9"</span><span class="token punctuation">,</span>\n <span class="token string">"immutable"</span><span class="token punctuation">:</span> <span class="token string">"3.8.1"</span><span class="token punctuation">,</span>\n <span class="token string">"invariant"</span><span class="token punctuation">:</span> <span class="token string">"2.2.2"</span><span class="token punctuation">,</span>\n <span class="token string">"lodash"</span><span class="token punctuation">:</span> <span class="token string">"4.17.2"</span><span class="token punctuation">,</span>\n <span class="token string">"md5"</span><span class="token punctuation">:</span> <span class="token string">"^2.2.1"</span><span class="token punctuation">,</span>\n <span class="token string">"moment"</span><span class="token punctuation">:</span> <span class="token string">"^2.18.1"</span><span class="token punctuation">,</span>\n <span class="token string">"prop-types"</span><span class="token punctuation">:</span> <span class="token string">"^15.6.2"</span><span class="token punctuation">,</span>\n <span class="token string">"raf"</span><span class="token punctuation">:</span> <span class="token string">"^3.4.1"</span><span class="token punctuation">,</span>\n <span class="token string">"react"</span><span class="token punctuation">:</span> <span class="token string">"16.6.0"</span><span class="token punctuation">,</span>\n <span class="token string">"react-dom"</span><span class="token punctuation">:</span> <span class="token string">"16.6.0"</span><span class="token punctuation">,</span>\n <span class="token string">"react-helmet"</span><span class="token punctuation">:</span> <span class="token string">"5.2.0"</span><span class="token punctuation">,</span>\n <span class="token string">"react-player"</span><span class="token punctuation">:</span> <span class="token string">"^1.6.4"</span><span class="token punctuation">,</span>\n <span class="token string">"react-redux"</span><span class="token punctuation">:</span> <span class="token string">"5.1.0"</span><span class="token punctuation">,</span>\n <span class="token string">"react-router"</span><span class="token punctuation">:</span> <span class="token string">"3.2.1"</span><span class="token punctuation">,</span>\n <span class="token string">"react-router-redux"</span><span class="token punctuation">:</span> <span class="token string">"4.0.6"</span><span class="token punctuation">,</span>\n <span class="token string">"react-router-scroll"</span><span class="token punctuation">:</span> <span class="token string">"0.4.4"</span><span class="token punctuation">,</span>\n <span class="token string">"redux"</span><span class="token punctuation">:</span> <span class="token string">"3.6.0"</span><span class="token punctuation">,</span>\n <span class="token string">"redux-immutable"</span><span class="token punctuation">:</span> <span class="token string">"3.0.8"</span><span class="token punctuation">,</span>\n <span class="token string">"redux-saga"</span><span class="token punctuation">:</span> <span class="token string">"0.16.2"</span><span class="token punctuation">,</span>\n <span class="token string">"reselect"</span><span class="token punctuation">:</span> <span class="token string">"2.5.4"</span><span class="token punctuation">,</span>\n <span class="token string">"rxjs"</span><span class="token punctuation">:</span> <span class="token string">"5.5.3"</span><span class="token punctuation">,</span>\n <span class="token string">"smoothscroll-polyfill"</span><span class="token punctuation">:</span> <span class="token string">"^0.3.6"</span><span class="token punctuation">,</span>\n <span class="token string">"warning"</span><span class="token punctuation">:</span> <span class="token string">"3.0.0"</span><span class="token punctuation">,</span>\n <span class="token string">"whatwg-fetch"</span><span class="token punctuation">:</span> <span class="token string">"2.0.1"</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="打包后依赖"><a href="#%E6%89%93%E5%8C%85%E5%90%8E%E4%BE%9D%E8%B5%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>打包后依赖</h3>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59261224722318650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`&quot;dependencies&quot;: {\n &quot;array-tree-filter&quot;: &quot;^2.1.0&quot;,\n &quot;babel-polyfill&quot;: &quot;6.26.0&quot;,\n &quot;classnames&quot;: &quot;2.2.5&quot;,\n &quot;immutable&quot;: &quot;3.8.2&quot;,\n &quot;lodash&quot;: &quot;4.17.2&quot;,\n &quot;prop-types&quot;: &quot;15.6.2&quot;,\n &quot;rc-dialog&quot;: &quot;^7.5.7&quot;,\n &quot;rc-notification&quot;: &quot;^3.3.1&quot;,\n &quot;rc-select&quot;: &quot;^9.2.0&quot;,\n &quot;rc-tooltip&quot;: &quot;^3.7.3&quot;,\n &quot;rc-upload&quot;: &quot;^2.8.1&quot;,\n &quot;react-lite&quot;: &quot;^0.15.40&quot;,\n &quot;react-loadable&quot;: &quot;5.5.0&quot;,\n &quot;rmc-cascader&quot;: &quot;^5.0.3&quot;,\n &quot;rmc-feedback&quot;: &quot;^2.0.0&quot;,\n &quot;rmc-picker&quot;: &quot;^5.0.10&quot;,\n &quot;whatwg-fetch&quot;: &quot;3.0.0&quot;\n},`, `59261224722318650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n <span class="token string">"array-tree-filter"</span><span class="token punctuation">:</span> <span class="token string">"^2.1.0"</span><span class="token punctuation">,</span>\n <span class="token string">"babel-polyfill"</span><span class="token punctuation">:</span> <span class="token string">"6.26.0"</span><span class="token punctuation">,</span>\n <span class="token string">"classnames"</span><span class="token punctuation">:</span> <span class="token string">"2.2.5"</span><span class="token punctuation">,</span>\n <span class="token string">"immutable"</span><span class="token punctuation">:</span> <span class="token string">"3.8.2"</span><span class="token punctuation">,</span>\n <span class="token string">"lodash"</span><span class="token punctuation">:</span> <span class="token string">"4.17.2"</span><span class="token punctuation">,</span>\n <span class="token string">"prop-types"</span><span class="token punctuation">:</span> <span class="token string">"15.6.2"</span><span class="token punctuation">,</span>\n <span class="token string">"rc-dialog"</span><span class="token punctuation">:</span> <span class="token string">"^7.5.7"</span><span class="token punctuation">,</span>\n <span class="token string">"rc-notification"</span><span class="token punctuation">:</span> <span class="token string">"^3.3.1"</span><span class="token punctuation">,</span>\n <span class="token string">"rc-select"</span><span class="token punctuation">:</span> <span class="token string">"^9.2.0"</span><span class="token punctuation">,</span>\n <span class="token string">"rc-tooltip"</span><span class="token punctuation">:</span> <span class="token string">"^3.7.3"</span><span class="token punctuation">,</span>\n <span class="token string">"rc-upload"</span><span class="token punctuation">:</span> <span class="token string">"^2.8.1"</span><span class="token punctuation">,</span>\n <span class="token string">"react-lite"</span><span class="token punctuation">:</span> <span class="token string">"^0.15.40"</span><span class="token punctuation">,</span>\n <span class="token string">"react-loadable"</span><span class="token punctuation">:</span> <span class="token string">"5.5.0"</span><span class="token punctuation">,</span>\n <span class="token string">"rmc-cascader"</span><span class="token punctuation">:</span> <span class="token string">"^5.0.3"</span><span class="token punctuation">,</span>\n <span class="token string">"rmc-feedback"</span><span class="token punctuation">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>\n <span class="token string">"rmc-picker"</span><span class="token punctuation">:</span> <span class="token string">"^5.0.10"</span><span class="token punctuation">,</span>\n <span class="token string">"whatwg-fetch"</span><span class="token punctuation">:</span> <span class="token string">"3.0.0"</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="主要变化"><a href="#%E4%B8%BB%E8%A6%81%E5%8F%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主要变化</h3>\n<ol>\n<li>\n<p>去除比较大的依赖库 antd、moment、rxjs</p>\n</li>\n<li>\n<p>替换 react 为 react-lite</p>\n<p>其中需要对 react-lite 做下兼容处理，不影响之前依赖 react 的代码</p>\n<p>boot\\internals\\webpack\\webpack.base.babel.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27692748805425627000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\'react\': path.resolve(process.cwd(), \'node_modules/react-lite\'),\n\'react-dom\': path.resolve(process.cwd(), \'node_modules/react-lite\'),`, `27692748805425627000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token string">\'react\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'node_modules/react-lite\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token string">\'react-dom\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'node_modules/react-lite\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h2 id="组件自编写"><a href="#%E7%BB%84%E4%BB%B6%E8%87%AA%E7%BC%96%E5%86%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件自编写</h2>\n<p>此项目的所有组件使用 antd、antd-mobile 的底层组件，以便优化包大小、自定义功能，组件接口尽量保持一致</p>\n<h3 id="antd-引入方式兼容"><a href="#antd-%E5%BC%95%E5%85%A5%E6%96%B9%E5%BC%8F%E5%85%BC%E5%AE%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>antd 引入方式兼容</h3>\n<p>之前的项目用到 antd，这里采用了和 antd 一样的引用方式。</p>\n<p>作用：有利于代码分割，不会将 antd 的组件代码分割到主入口，antd-mobile 同理。</p>\n<p>.babelrc</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17129749093013991000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[\n   &quot;import&quot;,\n   {\n     &quot;libraryName&quot;: &quot;antd&quot;,\n     &quot;libraryDirectory&quot;: &quot;components&quot;,\n     &quot;camel2DashComponentName&quot;: false\n   },\n   &quot;antd&quot;\n],\n[\n   &quot;import&quot;,\n   {\n     &quot;libraryName&quot;: &quot;antd-mobile&quot;,\n     &quot;libraryDirectory&quot;: &quot;components&quot;,\n     &quot;camel2DashComponentName&quot;: false\n   },\n   &quot;antd-mobile&quot;\n],`, `17129749093013991000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">[</span>\n   <span class="token string">"import"</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span>\n     <span class="token string">"libraryName"</span><span class="token punctuation">:</span> <span class="token string">"antd"</span><span class="token punctuation">,</span>\n     <span class="token string">"libraryDirectory"</span><span class="token punctuation">:</span> <span class="token string">"components"</span><span class="token punctuation">,</span>\n     <span class="token string">"camel2DashComponentName"</span><span class="token punctuation">:</span> <span class="token boolean">false</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token string">"antd"</span>\n<span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">[</span>\n   <span class="token string">"import"</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span>\n     <span class="token string">"libraryName"</span><span class="token punctuation">:</span> <span class="token string">"antd-mobile"</span><span class="token punctuation">,</span>\n     <span class="token string">"libraryDirectory"</span><span class="token punctuation">:</span> <span class="token string">"components"</span><span class="token punctuation">,</span>\n     <span class="token string">"camel2DashComponentName"</span><span class="token punctuation">:</span> <span class="token boolean">false</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token string">"antd-mobile"</span>\n<span class="token punctuation">]</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>文件目录如下</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-14-30-51-8a391e3492c87bc37285696d664ee742-d9a6c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 323px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 169.3498452012384%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAiCAIAAADQyG7qAAAACXBIWXMAAAsSAAALEgHS3X78AAAC9UlEQVRIx5VV2W7TUBTMbwBq0tRJHO/7vlzbiZc4cbaStgpRoaJCCPHCG6/8Al/MOC0gHrBd6byOz8zcOeOeqNn7+0+aHZJZPi9WSVqqpte/ml5N+OGYa54eL5suyaPFzrBJEOWy7tGcxgg6ZsprzQOwZQVpXO5NNw7jghGM4USgaAkzYVV8qGF6E1bGPH5xl5tINcP0zDxOy7RYM7w6GLFNtEdTacxISUbyqoIEyyPQzEsGK+oULbRopmiRZmVecZe3H9xwFiVFPF9MefViSLcbNpqKE0aSdLd8e5I1B3hRtS8b2f4DpjmZV+35+lDTdomgmF2Qf8Gq5W9Pj5YXwTDdDl4ABm1BtZPlnpcNL5zB/JeAWRmalzf3kmYn6QImvx6Mu8g+02ZlBKvYHw0njNOF7cckyWF4K/4ZDNrp5lbSHOAR1yBOx4zYDqbOhikw7N1Hy4Vh1SxbIjZdbuOPYQ6eSjFc3fIVw+v4Ws+GiZqb7+4U3cVaP8r8KO10kk+aJcNfPLmdlbYX94fTF2yWFWNbVrxSJ0w1PGjuBqaFsaBZnPKzCg07QJnM81W9vItheJLBiH9/zWaJKuuhGyY4SdDptBl56lPsw/UkIaLhzOJ54QazAcUOKKYdjLpwYG9xpxiBFyaaFSBhZbWDeWCOnDRMD0WnWGFW5V6UOGFq+zOXpEFcaDaZcFrz9FSTKAb59j27PVVeVK2vj/nqMC/3q+1RdxJWslEy/5u6ABlBk4xgebgHZ5+kCEkQZaJiwQ6UVMPgnQWaU86HcYN4BnFmexGuGgk9H0bT1CGBZ2iB6u5B1h0nSF5djN4Mxp3cfoonJ5uk2GAz1kqqTXcrk9+bTX9zfIDmpK77quPvqgajNOoaOpwU00OHaJZ/OeLOqrrRFlUr2xygGVYBDMGXFNMquwazvMqqZHP6DLb4XcDwYrldrHZg0cy8d74BYZ3xETF52cFJYj8j4P+oTNoOswZfUNyPr9PrUg6SarXZ4/8Iwf0r0G6R/QvJd2/gEfEU5wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 14 30 51" title="" data-src="/static/2019-10-29-14-30-51-8a391e3492c87bc37285696d664ee742-d9a6c.png" data-srcset="/static/2019-10-29-14-30-51-8a391e3492c87bc37285696d664ee742-82faf.png 200w,\n/static/2019-10-29-14-30-51-8a391e3492c87bc37285696d664ee742-d9a6c.png 323w" data-sizes="(max-width: 323px) 100vw, 323px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="桌面移动端分离打包"><a href="#%E6%A1%8C%E9%9D%A2%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%88%86%E7%A6%BB%E6%89%93%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>桌面移动端分离打包</h2>\n<p>考虑到桌面移动端的复用逻辑较多，所以将桌面移动端写在一个项目中，这里就涉及到了多平台分离打包</p>\n<h3 id="文件目录"><a href="#%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>文件目录</h3>\n<p>总体上来说分为 3 个文件夹，分别是公用组件、移动端组件、桌面端组件</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-14-31-53-c4aeb4255948ae5e797400ba0e98a535-32723.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 355px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 147.88732394366195%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAAsSAAALEgHS3X78AAACmklEQVQ4y42UW0/bQBCF8y+qAk3ixHfv2uv1fe3d9T0hFAIIQosQQmolVKH2tf35nbQ8JyvN67HPOfPNTmyb0muW3ogsq3Xb/6RZs6WjGZ7KTEDg0bjoRxIzP8wCmqMgWVpYUYxdP+4u7mjG87LmzVjw1nTJXEW8MJFh40z0w3YXxkUpuk+aeTY3pwtrrruHZ+L6qU8ZazfD5Y6JoR2vaCqyskuKxkbJ4ZmAMky5XF2vbp5kdzFe3LWr7eXt4/nlPaYlCosDM1laYDtuR/zynRV85QXRyVSHzqcL+3hmKNawg1zw7e46jMukEIgkhu0rtQ1i2yNpNYrVLRQmmlG2q33buqsiRpYTxa2//VbnrE+ZgKqVIbGwg6Jq6Pkg44xnZW04AewPRokwRGK5vnNwJZoBPFteeKaZKpDubWtGOG7wj5/S9Zlox7xqIHkle/ju4eT7wiwnoLIZvzwEJOP1kLG9fxymR50Dnthx8Tz+rDWvUZSUcgC8S9lD8qPOJwtYlYNQ/1A9/0nTQnZrkJ3MDMVVYc1EhGQd7xImGW8DmgEnRwO/i6cmJrpV60vK6pK3jHftsHEwPW4b7vnjDK1b69eL48e1bAe4aqhKcVVYt0nJi5qTICppwmhSGo6vCglspb96pPng+vTD6eJ0ZsBVwahkRguA5By/vnGARLZjxmomuqJqlCCBk4xkvf66IzQHtkAGhJO4UILE9bCWbJfdWxwnVQ1gDvCSQWwVSJDrkLms/IcblgvZr+G34FapsH+E+UY1hrfPhCSiXcEDriko38WW7fnNvXz6XRQV4Ak9Kb4H/wlDQFhnmgnvQA1XUXdrB6kQBmId5dTbCs9PqqKqo6yCxwwKO75nwPNkjjeDC3hG+dCN53DSinj+BeEUOu5irNURAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 14 31 53" title="" data-src="/static/2019-10-29-14-31-53-c4aeb4255948ae5e797400ba0e98a535-32723.png" data-srcset="/static/2019-10-29-14-31-53-c4aeb4255948ae5e797400ba0e98a535-d1052.png 200w,\n/static/2019-10-29-14-31-53-c4aeb4255948ae5e797400ba0e98a535-32723.png 355w" data-sizes="(max-width: 355px) 100vw, 355px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="优化环境变量配置"><a href="#%E4%BC%98%E5%8C%96%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化环境变量配置</h3>\n<p>将所有的环境变量整合到一个文件</p>\n<p>boot\\internals\\scripts\\get-build-map.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66480543907201350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const path = require(\'path\');\nconst prodEnv = process.env.PROD_ENV || \'pc\';\nconst globalJSON = require(path.resolve(process.cwd(), \'global.json\'));\n\nconst varsEnv = process.env.SERVER || \'master\';\nconst globalVars = globalJSON.runtime[varsEnv];\n\nconst RESOLVE_MODULES_MAP = {\n  pc: [\'src/common\', \'src/pc\', \'node_modules\'],\n  mobile: [\'src/common\', \'src/mobile\', \'node_modules\']\n};\n\nconst OUTPUT_PATH_MAP = {\n  pc: \'build/pc\',\n  mobile: \'build/mobile\'\n};\n\nconst resolveModules = RESOLVE_MODULES_MAP[prodEnv];\nconst outputPath = OUTPUT_PATH_MAP[prodEnv];\n\nconst INDEX_ENTRY_MAP = {\n  pc: \'src/pc/index.js\',\n  mobile: \'src/mobile/index.js\'\n};\n\nconst INDEX_HTML_MAP = {\n  pc: \'src/pc/index.html\',\n  mobile: \'src/mobile/index.html\'\n};\n\nconst indexEntry = INDEX_ENTRY_MAP[prodEnv];\nconst indexHtml = INDEX_HTML_MAP[prodEnv];\n\nmodule.exports = {\n  resolveModules,\n  outputPath,\n  indexEntry,\n  indexHtml,\n  globalVars\n};`, `66480543907201350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> prodEnv <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PROD_ENV</span> <span class="token operator">||</span> <span class="token string">\'pc\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> globalJSON <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'global.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> varsEnv <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SERVER</span> <span class="token operator">||</span> <span class="token string">\'master\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> globalVars <span class="token operator">=</span> globalJSON<span class="token punctuation">.</span>runtime<span class="token punctuation">[</span>varsEnv<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">RESOLVE_MODULES_MAP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  pc<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'src/common\'</span><span class="token punctuation">,</span> <span class="token string">\'src/pc\'</span><span class="token punctuation">,</span> <span class="token string">\'node_modules\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  mobile<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'src/common\'</span><span class="token punctuation">,</span> <span class="token string">\'src/mobile\'</span><span class="token punctuation">,</span> <span class="token string">\'node_modules\'</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">OUTPUT_PATH_MAP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  pc<span class="token punctuation">:</span> <span class="token string">\'build/pc\'</span><span class="token punctuation">,</span>\n  mobile<span class="token punctuation">:</span> <span class="token string">\'build/mobile\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> resolveModules <span class="token operator">=</span> <span class="token constant">RESOLVE_MODULES_MAP</span><span class="token punctuation">[</span>prodEnv<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> outputPath <span class="token operator">=</span> <span class="token constant">OUTPUT_PATH_MAP</span><span class="token punctuation">[</span>prodEnv<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">INDEX_ENTRY_MAP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  pc<span class="token punctuation">:</span> <span class="token string">\'src/pc/index.js\'</span><span class="token punctuation">,</span>\n  mobile<span class="token punctuation">:</span> <span class="token string">\'src/mobile/index.js\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">INDEX_HTML_MAP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  pc<span class="token punctuation">:</span> <span class="token string">\'src/pc/index.html\'</span><span class="token punctuation">,</span>\n  mobile<span class="token punctuation">:</span> <span class="token string">\'src/mobile/index.html\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> indexEntry <span class="token operator">=</span> <span class="token constant">INDEX_ENTRY_MAP</span><span class="token punctuation">[</span>prodEnv<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> indexHtml <span class="token operator">=</span> <span class="token constant">INDEX_HTML_MAP</span><span class="token punctuation">[</span>prodEnv<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  resolveModules<span class="token punctuation">,</span>\n  outputPath<span class="token punctuation">,</span>\n  indexEntry<span class="token punctuation">,</span>\n  indexHtml<span class="token punctuation">,</span>\n  globalVars\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="使用环境变量进行分离打包"><a href="#%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%BF%9B%E8%A1%8C%E5%88%86%E7%A6%BB%E6%89%93%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用环境变量进行分离打包</h3>\n<p>boot\\internals\\webpack\\webpack.base.babel.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67002975129203810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const buildMap = require(\'../scripts/get-build-map\');\n\noutput: Object.assign({ // Compile into js/build.js\n // 根据环境变量输出到不同平台\n path: path.resolve(process.cwd(), buildMap.outputPath),\n publicPath: \\`\\${buildMap.globalVars.customerServiceOrigin}/im/\\`,\n}, options.output), // Merge with env dependent settings\n\nresolve: {\n  // 根据环境变量决定相对路径的查找方式\n  modules: buildMap.resolveModules,\n},`, `67002975129203810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buildMap <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../scripts/get-build-map\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\noutput<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// Compile into js/build.js</span>\n <span class="token comment">// 根据环境变量输出到不同平台</span>\n path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buildMap<span class="token punctuation">.</span>outputPath<span class="token punctuation">)</span><span class="token punctuation">,</span>\n publicPath<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>buildMap<span class="token punctuation">.</span>globalVars<span class="token punctuation">.</span>customerServiceOrigin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/im/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>output<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Merge with env dependent settings</span>\n\nresolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 根据环境变量决定相对路径的查找方式</span>\n  modules<span class="token punctuation">:</span> buildMap<span class="token punctuation">.</span>resolveModules<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以下都是根据环境变量输出到不同平台的文件夹下</p>\n<p>boot\\internals\\webpack\\webpack.dev.babel.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88634918625963110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const buildMap = require(\'../scripts/get-build-map\');\n\n// Add hot reloading in development\nentry: [\n  \'eventsource-polyfill\', // Necessary for hot reloading with IE\n  \'webpack-hot-middleware/client?reload=true\',\n  path.join(process.cwd(), buildMap.indexEntry), // Start with src/index.js\n],\n\nnew HtmlWebpackPlugin({\n   inject: true, // Inject all files that are generated by webpack, e.g. bundle.js\n   template: buildMap.indexHtml,\n}),`, `88634918625963110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buildMap <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../scripts/get-build-map\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Add hot reloading in development</span>\nentry<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n  <span class="token string">\'eventsource-polyfill\'</span><span class="token punctuation">,</span> <span class="token comment">// Necessary for hot reloading with IE</span>\n  <span class="token string">\'webpack-hot-middleware/client?reload=true\'</span><span class="token punctuation">,</span>\n  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buildMap<span class="token punctuation">.</span>indexEntry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Start with src/index.js</span>\n<span class="token punctuation">]</span><span class="token punctuation">,</span>\n\n<span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   inject<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Inject all files that are generated by webpack, e.g. bundle.js</span>\n   template<span class="token punctuation">:</span> buildMap<span class="token punctuation">.</span>indexHtml<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>boot\\internals\\webpack\\webpack.prod.babel.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2868443071962767400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const buildMap = require(\'../scripts/get-build-map\');\n\nentry: {\n   bundle: [\'runtime/polyfill\', path.join(process.cwd(), buildMap.indexEntry)],\n},\n\nnew HtmlWebpackPlugin({\n  template: buildMap.indexHtml,\n  minify: {\n    removeComments: true,\n    collapseWhitespace: true,\n    removeRedundantAttributes: true,\n    useShortDoctype: true,\n    removeEmptyAttributes: true,\n    removeStyleLinkTypeAttributes: true,\n    keepClosingSlash: true,\n    minifyJS: true,\n    minifyCSS: true,\n    minifyURLs: true,\n  },\n  inject: true,\n}),`, `2868443071962767400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> buildMap <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../scripts/get-build-map\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nentry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n   bundle<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'runtime/polyfill\'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buildMap<span class="token punctuation">.</span>indexEntry<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  template<span class="token punctuation">:</span> buildMap<span class="token punctuation">.</span>indexHtml<span class="token punctuation">,</span>\n  minify<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    removeComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    removeRedundantAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    useShortDoctype<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    removeEmptyAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    removeStyleLinkTypeAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    keepClosingSlash<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    minifyJS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    minifyCSS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    minifyURLs<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  inject<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="优化打包脚本"><a href="#%E4%BC%98%E5%8C%96%E6%89%93%E5%8C%85%E8%84%9A%E6%9C%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化打包脚本</h3>\n<h4 id="优化编译脚本"><a href="#%E4%BC%98%E5%8C%96%E7%BC%96%E8%AF%91%E8%84%9A%E6%9C%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化编译脚本</h4>\n<p>以下是其中一个脚本，主要是根据参数传递来进行打包</p>\n<p>boot/scripts/build.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40182599966662160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shelljs = require(\'shelljs\');\nconst argv = require(\'yargs\').argv;\nconst \\$_SERVER = argv.server || \'master\';\nconst \\$_NODE_ENV = argv.env || \'production\';\nconst \\$_PROD_ENV = argv.prod || \'pc\';\n\nshelljs.exec(\n  \\`rimraf ./build/\\${\\$_PROD_ENV}/* && cross-env NODE_ENV=\\${\\$_NODE_ENV} SERVER=\\${\\$_SERVER} PROD_ENV=\\${\\$_PROD_ENV} webpack --config boot/internals/webpack/webpack.prod.babel.js --color --progress\\`,\n  { stdio: \'inherit\' }\n);`, `40182599966662160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> shelljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> argv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'yargs\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argv<span class="token punctuation">;</span>\n<span class="token keyword">const</span> $_SERVER <span class="token operator">=</span> argv<span class="token punctuation">.</span>server <span class="token operator">||</span> <span class="token string">\'master\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> $_NODE_ENV <span class="token operator">=</span> argv<span class="token punctuation">.</span>env <span class="token operator">||</span> <span class="token string">\'production\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> $_PROD_ENV <span class="token operator">=</span> argv<span class="token punctuation">.</span>prod <span class="token operator">||</span> <span class="token string">\'pc\'</span><span class="token punctuation">;</span>\n\nshelljs<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>\n  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rimraf ./build/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$_PROD_ENV<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/* &amp;&amp; cross-env NODE_ENV=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$_NODE_ENV<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SERVER=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$_SERVER<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> PROD_ENV=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$_PROD_ENV<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> webpack --config boot/internals/webpack/webpack.prod.babel.js --color --progress</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span> stdio<span class="token punctuation">:</span> <span class="token string">\'inherit\'</span> <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="多平台并行编译"><a href="#%E5%A4%9A%E5%B9%B3%E5%8F%B0%E5%B9%B6%E8%A1%8C%E7%BC%96%E8%AF%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多平台并行编译</h4>\n<p>采用 concurrently 三方库进行多平台的编译，唯一的缺点就是进度会刷屏，暂时未找到解决方案</p>\n<p>global.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57550490987166695000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`&quot;APPS&quot;: {\n &quot;dev&quot;: [\n   &quot;pc&quot;, &quot;mobile&quot;\n ],\n}`, `57550490987166695000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token string">"APPS"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n <span class="token string">"dev"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>\n   <span class="token string">"pc"</span><span class="token punctuation">,</span> <span class="token string">"mobile"</span>\n <span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>boot\\scripts\\pre-build.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54541762164205360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shelljs = require(\'shelljs\');\nconst argv = require(\'yargs\').argv;\nconst path = require(\'path\');\nconst \\$_SERVER = argv.server || \'master\';\nconst APPS = require(path.resolve(process.cwd(), \'global.json\')).APPS[\\$_SERVER];\n\nconsole.log(\\`build environment: \\${\\$_SERVER}\\`, \\`build apps: \\${APPS}\\`);\n\nconst cmd = APPS.map((APP) => \\`&quot;node boot/scripts/build --server=\\${\\$_SERVER} --prod=\\${APP}&quot;\\`);\n\n// 进度输出刷屏，待优化\n// https://github.com/kimmobrunfeldt/concurrently/issues/188\n// https://github.com/kimmobrunfeldt/concurrently/issues/85\nshelljs.exec(\\`concurrently \\${cmd.join(\' \')}\\`, { stdio: \'inherit\' });`, `54541762164205360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> shelljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> argv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'yargs\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argv<span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> $_SERVER <span class="token operator">=</span> argv<span class="token punctuation">.</span>server <span class="token operator">||</span> <span class="token string">\'master\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token constant">APPS</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'global.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">APPS</span><span class="token punctuation">[</span>$_SERVER<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">build environment: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$_SERVER<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">build apps: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">APPS</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> cmd <span class="token operator">=</span> <span class="token constant">APPS</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">APP</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">"node boot/scripts/build --server=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$_SERVER<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --prod=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">APP</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 进度输出刷屏，待优化</span>\n<span class="token comment">// https://github.com/kimmobrunfeldt/concurrently/issues/188</span>\n<span class="token comment">// https://github.com/kimmobrunfeldt/concurrently/issues/85</span>\nshelljs<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">concurrently </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cmd<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> stdio<span class="token punctuation">:</span> <span class="token string">\'inherit\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里调用会并行编译 pc、mobile 两个平台的代码</p>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92404379601628170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`&quot;scripts&quot;: {\n &quot;build:dev&quot;: &quot;node boot/scripts/pre-build --server=dev&quot;,\n}`, `92404379601628170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n <span class="token property">"build:dev"</span><span class="token operator">:</span> <span class="token string">"node boot/scripts/pre-build --server=dev"</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>编译速度：2 个平台同时编译的情况下第一次 30~40s，第二次 8~10s</p>\n<h2 id="分离打包的-nginx-配置"><a href="#%E5%88%86%E7%A6%BB%E6%89%93%E5%8C%85%E7%9A%84-nginx-%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分离打包的 nginx 配置</h2>\n<h3 id="nginx-配置"><a href="#nginx-%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>nginx 配置</h3>\n<p>由于之前第三方平台只用引入一个文件，这里的异步加载需要引入不止一个文件，所以要改下 nginx 配置，这里和主产品在一个域名下，故这里用前缀 /im/ 来代表加载客服组件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72217277342656020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`set \\$root_dir &quot;/home/frontend/pony/pc/&quot;;\n# 根据 \\$http_user_agent 来判断加载哪个目录下的脚本\nif ( \\$http_user_agent ~ &quot;(MIDP)|(WAP)|(UP.Browser)|(Smartphone)|(Obigo)|(Mobile)|(AU.Browser)|(wxd.Mms)|(WxdB.Browser)|(CLDC)|(UP.Link)|(KM.Browser)|(UCWEB)|(SEMC-Browser)|(Mini)|(Symbian)|(Palm)|(Nokia)|(Panasonic)|(MOT-)|(SonyEricsson)|(NEC-)|(Alcatel)|(Ericsson)|(BENQ)|(BenQ)|(Amoisonic)|(Amoi-)|(Capitel)|(PHILIPS)|(SAMSUNG)|(Lenovo)|(Mitsu)|(Motorola)|(SHARP)|(WAPPER)|(LG-)|(LG/)|(EG900)|(CECT)|(Compal)|(kejian)|(Bird)|(BIRD)|(G900/V1.0)|(Arima)|(CTL)|(TDG)|(Daxian)|(DAXIAN)|(DBTEL)|(Eastcom)|(EASTCOM)|(PANTECH)|(Dopod)|(Haier)|(HAIER)|(KONKA)|(KEJIAN)|(LENOVO)|(Soutec)|(SOUTEC)|(SAGEM)|(SEC-)|(SED-)|(EMOL-)|(INNO55)|(ZTE)|(iPhone)|(Android)|(Windows CE)|(Wget)|(Java)|(curl)|(Opera)&quot; )\n{\n   set \\$root_dir &quot;/home/frontend/pony/mobile/&quot;;\n}\n\n# 不缓存 bundle.js 入口文件，防止页面刷新后不是最新代码\nlocation = /im/bundle.js {\n   expires -1;\n   add_header Pragma no-cache;\n   alias &quot;\\${root_dir}/bundle.js&quot;;\n}\n\n# 其他文件照常做缓存处理，并映射到 /im 路径\nlocation ^~ /im {\n alias \\$root_dir;\n}`, `72217277342656020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token builtin class-name">set</span> <span class="token variable">$root_dir</span> <span class="token string">"/home/frontend/pony/pc/"</span><span class="token punctuation">;</span>\n<span class="token comment"># 根据 $http_user_agent 来判断加载哪个目录下的脚本</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$http_user_agent</span> ~ <span class="token string">"(MIDP)|(WAP)|(UP.Browser)|(Smartphone)|(Obigo)|(Mobile)|(AU.Browser)|(wxd.Mms)|(WxdB.Browser)|(CLDC)|(UP.Link)|(KM.Browser)|(UCWEB)|(SEMC-Browser)|(Mini)|(Symbian)|(Palm)|(Nokia)|(Panasonic)|(MOT-)|(SonyEricsson)|(NEC-)|(Alcatel)|(Ericsson)|(BENQ)|(BenQ)|(Amoisonic)|(Amoi-)|(Capitel)|(PHILIPS)|(SAMSUNG)|(Lenovo)|(Mitsu)|(Motorola)|(SHARP)|(WAPPER)|(LG-)|(LG/)|(EG900)|(CECT)|(Compal)|(kejian)|(Bird)|(BIRD)|(G900/V1.0)|(Arima)|(CTL)|(TDG)|(Daxian)|(DAXIAN)|(DBTEL)|(Eastcom)|(EASTCOM)|(PANTECH)|(Dopod)|(Haier)|(HAIER)|(KONKA)|(KEJIAN)|(LENOVO)|(Soutec)|(SOUTEC)|(SAGEM)|(SEC-)|(SED-)|(EMOL-)|(INNO55)|(ZTE)|(iPhone)|(Android)|(Windows CE)|(Wget)|(Java)|(curl)|(Opera)"</span> <span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n   <span class="token builtin class-name">set</span> <span class="token variable">$root_dir</span> <span class="token string">"/home/frontend/pony/mobile/"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment"># 不缓存 bundle.js 入口文件，防止页面刷新后不是最新代码</span>\nlocation <span class="token operator">=</span> /im/bundle.js <span class="token punctuation">{</span>\n   expires -1<span class="token punctuation">;</span>\n   add_header Pragma no-cache<span class="token punctuation">;</span>\n   <span class="token builtin class-name">alias</span> <span class="token string">"<span class="token variable">${root_dir}</span>/bundle.js"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment"># 其他文件照常做缓存处理，并映射到 /im 路径</span>\nlocation ^~ /im <span class="token punctuation">{</span>\n <span class="token builtin class-name">alias</span> <span class="token variable">$root_dir</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="webpack-配合修改"><a href="#webpack-%E9%85%8D%E5%90%88%E4%BF%AE%E6%94%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack 配合修改</h3>\n<p>webpack 也需要做下 public 的映射，否则资源访问不到，注意这里的 <code class="language-text">buildMap.globalVars.customerServiceOrigin</code> 代表主产品的域名</p>\n<p>webpack.base.babel.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1324256884977881300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`output: Object.assign({\n path: path.resolve(process.cwd(), buildMap.outputPath),\n publicPath: \\`\\${buildMap.globalVars.customerServiceOrigin}/im/\\`,\n}, options.output),`, `1324256884977881300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">output<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buildMap<span class="token punctuation">.</span>outputPath<span class="token punctuation">)</span><span class="token punctuation">,</span>\n publicPath<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>buildMap<span class="token punctuation">.</span>globalVars<span class="token punctuation">.</span>customerServiceOrigin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/im/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>output<span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="代码分层"><a href="#%E4%BB%A3%E7%A0%81%E5%88%86%E5%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码分层</h2>\n<p>这里主要对 IM 层、消息提醒功能做了分层。其他的桌面与移动端复用率不高，没有分层</p>\n<h3 id="im-层"><a href="#im-%E5%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IM 层</h3>\n<p>主要把所有与第三方提供商、调用后台的接口整合到一个类中，各种消息的回调采用消息订阅的方式进行分发调用</p>\n<h3 id="消息提醒类"><a href="#%E6%B6%88%E6%81%AF%E6%8F%90%E9%86%92%E7%B1%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息提醒类</h3>\n<p>将公共的消息提醒逻辑抽成一个类</p>\n<p>src\\common\\utils\\TitleMessage\\index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98923948928938970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import utils from \'utils\';\nimport { filePrefix } from \'containers/App/constants\';\n\nimport tungeeLogo from \'./images/tungee-logo.jpg\';\n\nclass TitleMessage {\n  constructor() {\n    // 闪烁前标题\n    this.originTitle = document.title;\n    // 计数\n    this.count = 0;\n    // 计时器\n    this.timer = null;\n    // 提示音\n    this.alertPlayer = document.createElement(\'audio\');\n    this.alertPlayer.src = \\`\\${filePrefix}message_alert.wav\\`;\n    this.alertPlayer.style.display = \'none\';\n    document.body.appendChild(this.alertPlayer);\n  }\n\n  start(msg) {\n    // 提示音\n    this.alertPlayer.play();\n    // 网页提示\n    utils.showNotification(msg, {\n      icon: tungeeLogo\n    });\n    this.stop();\n    this.timer = setInterval(() => {\n      if (this.count % 2 === 0) {\n        document.title = msg;\n      } else {\n        document.title = this.originTitle;\n      }\n      this.count += 1;\n    }, 1000);\n  }\n\n  stop() {\n    if (this.timer) {\n      clearInterval(this.timer);\n      this.timer = null;\n      this.count = 0;\n    }\n    document.title = this.originTitle;\n  }\n}\n\nexport default TitleMessage;`, `98923948928938970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">\'utils\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> filePrefix <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'containers/App/constants\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> tungeeLogo <span class="token keyword">from</span> <span class="token string">\'./images/tungee-logo.jpg\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">TitleMessage</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 闪烁前标题</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>originTitle <span class="token operator">=</span> document<span class="token punctuation">.</span>title<span class="token punctuation">;</span>\n    <span class="token comment">// 计数</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token comment">// 计时器</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token comment">// 提示音</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>alertPlayer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'audio\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>alertPlayer<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filePrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">message_alert.wav</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>alertPlayer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>alertPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 提示音</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>alertPlayer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 网页提示</span>\n    utils<span class="token punctuation">.</span><span class="token function">showNotification</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      icon<span class="token punctuation">:</span> tungeeLogo\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        document<span class="token punctuation">.</span>title <span class="token operator">=</span> msg<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>originTitle<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>originTitle<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> TitleMessage<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="小程序部署代理配置"><a href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%83%A8%E7%BD%B2%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小程序部署代理配置</h2>\n<p>小程序用到 webview 限制了接口调用必须是第三方的域名，需要更改第三方域名指向的服务器配置</p>\n<p>这里以 nginx 为例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42512340140908430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`location ^~ /im {\n  # 反代到组件所在的域名，并把参数传递过去\n  proxy_pass 组件所在的域名/im/\\$1;\n  # 传递 http_user_agent 参数，否则不能判断移动端\n  proxy_set_header User-Agent \\$http_user_agent;\n}`, `42512340140908430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">location ^~ /im <span class="token punctuation">{</span>\n  <span class="token comment"># 反代到组件所在的域名，并把参数传递过去</span>\n  proxy_pass 组件所在的域名/im/<span class="token variable">$1</span><span class="token punctuation">;</span>\n  <span class="token comment"># 传递 http_user_agent 参数，否则不能判断移动端</span>\n  proxy_set_header User-Agent <span class="token variable">$http_user_agent</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="优化效果"><a href="#%E4%BC%98%E5%8C%96%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化效果</h1>\n<h2 id="优化前"><a href="#%E4%BC%98%E5%8C%96%E5%89%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化前</h2>\n<p>优化前包大小如下图，首页/全部加载大小都为 644.58kb。</p>\n<p>加载速度（不限速）540ms，3g low（限速 120 kb/s）40.75s。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-10-25-53-8b20855ed72ce2ed6a45384912e5bf50-72d75.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.645833333333336%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAB8ElEQVQoz02Q23OaQBjF/cf7kIe+tclDm5e00TGaaeoUDRhveNcoUVAKKkHRAeWOaLwiotiu6dTkzNnZnZ39zXf2eGZKy1lP7ZW5tTcn752tu3NeppNel223aEWWLGvt2BvbsnaODQzeLBYLj7Wcuntnt3fHuqKKvCoJ4nDQxDGaJBp1rFou8P3nIc/xg54iCl2GrJTSj0W090ya5tjz51UH1zVNVZGFTptkGGo06ivy0DA0XVfns6kiAbbNMo1yPgqHb2DIXynGDF39Dx8OjrN93V3X3YObjbVar5drsBZzQ5M4lmrUCun4XTJ6C5xJ/NRPMJDjODiOEwTR73OCINgbyxwbi/kMRCWJ0tMjmktBCOSPhK4joe9xOKgr4hts23aHYWiapiiKZVnLWk0mY3Os4VgWzCSwXCEdebi/QSAfDHkTyK0ujd7Htv+d3f0xtq6Jrd81ttPkui0cy1WL8WzqF2AeIv4o5ENjP/T3f56/gP5UQ5M1RRxwbUAOOKbH0vVqBph4ytcqaNB3cXX5MXD9Oeg9l+XRKfbB2ljL5bEhXZWq5WQ2FRZ4jmXITCJUKSWwcrKOZepYNgEHEMj75fyDwA/eJm/to0Dn4rBfyiP59H2bqsXhABq7y6FhADfrxWo5FfR+uvp69u3yTJKGfwHhi//sovwClwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 10 25 53" title="" data-src="/static/2019-10-29-10-25-53-8b20855ed72ce2ed6a45384912e5bf50-fee1c.png" data-srcset="/static/2019-10-29-10-25-53-8b20855ed72ce2ed6a45384912e5bf50-a67b7.png 200w,\n/static/2019-10-29-10-25-53-8b20855ed72ce2ed6a45384912e5bf50-0b187.png 400w,\n/static/2019-10-29-10-25-53-8b20855ed72ce2ed6a45384912e5bf50-fee1c.png 800w,\n/static/2019-10-29-10-25-53-8b20855ed72ce2ed6a45384912e5bf50-b1a91.png 1200w,\n/static/2019-10-29-10-25-53-8b20855ed72ce2ed6a45384912e5bf50-95179.png 1600w,\n/static/2019-10-29-10-25-53-8b20855ed72ce2ed6a45384912e5bf50-72d75.png 1920w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-15-25-47-83d456e42382d76ff5c577d87768438d-ad506.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.81278538812785%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABAElEQVQY06VQyU7FMAzM//8PR36BC0I8Djxx6EaatE1jx1m6MG05gMSNUeTY8ow0Y5VLccbopun7vq7rqqru7x/3p+fm9da2rda66zqsjDHjOM6/ofZ9Z08Q9VobYw/SMAzWDBbfAMFw4vOEc857P/tvqMcH8/YypxKISURSSvtf2LZtXVfUc9ivRvXaeZK4QBUpCaVCMXMqKedlWUopVwVyziUXjuAIhhCCCkLEM/yEExwkiIzTxMxIBS/wPE0Tevgkosm5mQhpArMiZvIeayijyPXAw4gKMa5grUV0sEGD3p2AVbX/A4cYqZDnCB3jz+bqJeUUk/Q2c0DUK/11hS+BXMvDJjxvQAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 15 25 47" title="" data-src="/static/2019-10-29-15-25-47-83d456e42382d76ff5c577d87768438d-fee1c.png" data-srcset="/static/2019-10-29-15-25-47-83d456e42382d76ff5c577d87768438d-a67b7.png 200w,\n/static/2019-10-29-15-25-47-83d456e42382d76ff5c577d87768438d-0b187.png 400w,\n/static/2019-10-29-15-25-47-83d456e42382d76ff5c577d87768438d-fee1c.png 800w,\n/static/2019-10-29-15-25-47-83d456e42382d76ff5c577d87768438d-ad506.png 1095w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-14-46-52-b9fc2bea404c217c6783fc4d7f8fed5c-74b93.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 31.74366616989568%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5UlEQVQY01WQ627DIAyFef+3m7SpWidt1ZZmNBdCAr5gIJnR8qfmwzqAZR9hjuPYa50fdhqGvv/tuu7z8n6/flhrH7qsHcfRzW59jm1dnVtM/8PdjafBOTfrpUbY2puKGCMR/VczETOdudGkubz6t5fFBwJGoJOAGBEiYhLhlIgTpyZYRLWkVHQzmSRAHLzOA9qQAvISom/AsoVp8XpsbI1ZPQF+z9vdg/XBMCVEHRoTcxZRVGjb1IyRFkeIahIBEEGziNx8unr58mxKrY1SJecnSlGLEjEDasezrNacy76X9sk5/wHYZVboLupfhgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 14 46 52" title="" data-src="/static/2019-10-29-14-46-52-b9fc2bea404c217c6783fc4d7f8fed5c-fee1c.png" data-srcset="/static/2019-10-29-14-46-52-b9fc2bea404c217c6783fc4d7f8fed5c-a67b7.png 200w,\n/static/2019-10-29-14-46-52-b9fc2bea404c217c6783fc4d7f8fed5c-0b187.png 400w,\n/static/2019-10-29-14-46-52-b9fc2bea404c217c6783fc4d7f8fed5c-fee1c.png 800w,\n/static/2019-10-29-14-46-52-b9fc2bea404c217c6783fc4d7f8fed5c-b1a91.png 1200w,\n/static/2019-10-29-14-46-52-b9fc2bea404c217c6783fc4d7f8fed5c-74b93.png 1342w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="优化后"><a href="#%E4%BC%98%E5%8C%96%E5%90%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化后</h2>\n<h3 id="桌面端"><a href="#%E6%A1%8C%E9%9D%A2%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>桌面端</h3>\n<p>优化后，首页加载 107.08kb，全部加载 356.46kb。</p>\n<p>加载速度（不限速） 246ms，3g low （限速 120 kb/s）7s。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-14-38-30-305c548c31530d4463db6a19592acb90-a0f42.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.42271293375394%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACNklEQVQoz2WP209SARzH+Tt6rZ7aury4HnqqLVdrqd1zri22VsEEq9mgFplT09IWyzZZcXB0IkWkYgQEHRBIhHO4g1yEIFoIR87hcD+icE7EQ7X87rfvvi+f/b5fBkEUarkQ1dyiaJqiG2Tux5pC6ZVKvdI3fhCExQACSFoZAQAPCCJiYBV4LX6R5PDL/KE8I08UyWqhSVGNJt2kabJYTMwvJOfk3+WKCPjWB8y280JqURl4JnQ9nli5x5vguZkD9SvXiwwURTGcqNXIarVGbtbJQmEdMqUNUMvjak1So1uHjD/1hhgo+3rnrm2Q94XVLxMujzzf7OzGGKVSCcMwvK08QZRyORRGMnZHBoYzDjjrQFCnK21acgkeGW+w9NdYEJs1dAs+cqp8+NgGg/4jqrWa3q5UQwaDV6MJ6HR+rTao+xzU60Mqlevh8Lvus+CFyyYO+wEX7jhe2nsw/D+8VangTg+OuHHEk3e2z+VFTVaEL5g70fXxXJ/6Yi+fZTvaU95zwP8XpujfcLVessbfW+NKa0Jpjiug8BwUnLfGFiHPrNYuklueqJCpvpvuXbtD+zq+7YAbZUd+ybihhgkznLU6UDOYnBYlxsSpKWFCMBzhDPjOcF8ae65iJy/B/9Ruw2SjGi36LLlPvpx9Ne0N4R5ZanomOiKJTo55uPddzK6ZQ/1OS2+qEUCcOz5vl6HsB0nyqSmtdqM2N7b8KjY+7r0tWhudjAwyTZ2nxfvZ4ZXzeCPstP8CuQTKZbxKTaYAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 14 38 30" title="" data-src="/static/2019-10-29-14-38-30-305c548c31530d4463db6a19592acb90-fee1c.png" data-srcset="/static/2019-10-29-14-38-30-305c548c31530d4463db6a19592acb90-a67b7.png 200w,\n/static/2019-10-29-14-38-30-305c548c31530d4463db6a19592acb90-0b187.png 400w,\n/static/2019-10-29-14-38-30-305c548c31530d4463db6a19592acb90-fee1c.png 800w,\n/static/2019-10-29-14-38-30-305c548c31530d4463db6a19592acb90-b1a91.png 1200w,\n/static/2019-10-29-14-38-30-305c548c31530d4463db6a19592acb90-95179.png 1600w,\n/static/2019-10-29-14-38-30-305c548c31530d4463db6a19592acb90-a0f42.png 1902w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-15-36-51-76bad9b2f4a3bacf13b387899b58a3c1-e4a38.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.08736349453978%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABA0lEQVQY021QW04DMRDbY3MZzsIR+IQfKhXRaneb50xek2QJTiu+wIqcxPJMPFnGGGTMbV23bbtcvs7nz8vb+3o64brvO1gpZa31/2FBMRPB5Zx1zuFM3oOZOfCEuSPF9AdxCXWwtCyp1FJq7cfRv4/J9zXRj9ZbaVXAHY4GHb7ej+XpZTy/yhiJcilF0NAnphgpZk5lSiI+hdUrxW4LRgfvQwox51yWPY3PzXmrkSveYY2dcQlfYa7Xq9aaiR1EInVTOWUm96G1oTBnjkz4FQwMHwowNd5DYyjQe+/SKnT0haG1JlWSVM08ixGMfxFCeDA2r6y5OVI2G/PI/wDOTQQRfgAJp45HUt77KQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 15 36 51" title="" data-src="/static/2019-10-29-15-36-51-76bad9b2f4a3bacf13b387899b58a3c1-fee1c.png" data-srcset="/static/2019-10-29-15-36-51-76bad9b2f4a3bacf13b387899b58a3c1-a67b7.png 200w,\n/static/2019-10-29-15-36-51-76bad9b2f4a3bacf13b387899b58a3c1-0b187.png 400w,\n/static/2019-10-29-15-36-51-76bad9b2f4a3bacf13b387899b58a3c1-fee1c.png 800w,\n/static/2019-10-29-15-36-51-76bad9b2f4a3bacf13b387899b58a3c1-b1a91.png 1200w,\n/static/2019-10-29-15-36-51-76bad9b2f4a3bacf13b387899b58a3c1-e4a38.png 1282w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-15-38-36-4eda10460f371165682ad3333d6223ee-166cd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.20728534258456%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABGElEQVQY001Q7W7DIAzMo+4h97PPME390WnqtC6pugSS8GliTAKZqVStJ2TdYRt8bvZ910KMfT8MQ9d117b9fDv+vB9/21ZI2fe9lHKeZ2OMfYJzVk664WajtRjEf5rJnXvv+ZIfVUqFBwDgQUJtxkgQIG/bXkrOuZTChFkV97htW34CKz5c0by8lsNlKzk5TB4JIsc4OPAxhZhYBlqhkppySAulvKZIlNatOVz2080E75YYMUYPoLQ2zjkAOY7TNGvDttiFU0qDB2Hcl7SZcMWljm31JEX1zN6maeSK6gygu16ts5RoVopXMAyC4mKRPkb/bfDmqcllR0TwFfwfR5bxPoXVBsNCGINzuCy8JEp1ZkI8m3i26x9Z342LPyArdgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 15 38 36" title="" data-src="/static/2019-10-29-15-38-36-4eda10460f371165682ad3333d6223ee-fee1c.png" data-srcset="/static/2019-10-29-15-38-36-4eda10460f371165682ad3333d6223ee-a67b7.png 200w,\n/static/2019-10-29-15-38-36-4eda10460f371165682ad3333d6223ee-0b187.png 400w,\n/static/2019-10-29-15-38-36-4eda10460f371165682ad3333d6223ee-fee1c.png 800w,\n/static/2019-10-29-15-38-36-4eda10460f371165682ad3333d6223ee-166cd.png 1153w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="移动端"><a href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移动端</h3>\n<p>优化后，首页加载 105.89kb，全部加载 306.3kb。</p>\n<p>加载速度（不限速）236ms，3g low（限速 120 kb/s）6.98s。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-15-40-29-6b6ffe8870f8db08fa92e1a991c41bb4-c3264.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.454688318491364%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACLElEQVQoz2WR3U9SARjG+Wf6A7pok3lTa627WtLUlWuGAw1lwNxcGFg6kSA+jthFBRMRQUSPWcSHIIgnioOCgMCBwznEOJRaCK44TtnoEGZX9Ox99179nj3PXtrJjyRVP6OoBkX9rp9WimlbBn6NhfVoSJeGtUhQm4bfYGGD2ZBXKUrPJYhoFJZJMUD53Wk/pp2dklSToxoXU0wtoZ9keEi955fFfFIcVmNBJR6aNuqz0klifCytkKOAEn8mJub1JVqpdESSJ9VqlSTJWq1WiOvRLVHcOwatDu84hGhgAtl8ErGxP3qx+bmjkWF8bfXQbitxH2GSCZxWLpePz1VpbtMiH9UhvpGY+3HgrSADiRC/KGwbCIK9oAV9KjroZiBiYYE/mGM+yJgXDmiNf6IuDr6tiTrY8XVezMVNePhBsGdz4a7PeHvRkFApCNlUjsNG73Ume3vSs9r9Vji3Mx13shJu7t76YNLDC1gYq0CbFbgOLsVNpqJl8SunP9vZkexipGaAb61wAlJ4TfehZRZk7QuA/T7jHRCga8RXzdrUS3lFMrrf14kybkTplz9PjqOtcBZWb79j7to5kQ8DUccQtNgBqq9IBG3L8PZckHixlhW8irI0+akZzL2O/Rc7pIrZmX9jD513Xum2qtp1U9fkua2Hh7s3CxtdqEf5qxFKJ+p5pBUmkpYM1HzPaMzFj7l44fdMp+6WfbZbmvXTI/ZLG4b2Fa2w2vChX34SxB86lbnYVroPKgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 15 40 29" title="" data-src="/static/2019-10-29-15-40-29-6b6ffe8870f8db08fa92e1a991c41bb4-fee1c.png" data-srcset="/static/2019-10-29-15-40-29-6b6ffe8870f8db08fa92e1a991c41bb4-a67b7.png 200w,\n/static/2019-10-29-15-40-29-6b6ffe8870f8db08fa92e1a991c41bb4-0b187.png 400w,\n/static/2019-10-29-15-40-29-6b6ffe8870f8db08fa92e1a991c41bb4-fee1c.png 800w,\n/static/2019-10-29-15-40-29-6b6ffe8870f8db08fa92e1a991c41bb4-b1a91.png 1200w,\n/static/2019-10-29-15-40-29-6b6ffe8870f8db08fa92e1a991c41bb4-95179.png 1600w,\n/static/2019-10-29-15-40-29-6b6ffe8870f8db08fa92e1a991c41bb4-c3264.png 1909w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-15-43-18-75b859b8c2e7c6163baa46a51125975f-7169a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.113712374581944%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABCklEQVQY01VQ2Y7EIAzr/3/haHdfVhq2FxDCDQE6oaN5WAuqKsaWnSXnnEI4hTj3fdv35/P5J4R4PLbvn+M4pJTrum7bBgD4H8bgcl1X710bMMaUG5UvUaHKvvwfQ7DWppSoMiZbP3iLWyUW1DEGEbXRqfGsj94LM71Rm8PaiPqkJttHa22KU2nonUuRTWNONgYMKeZcchZwrii1BRUQo0cfXczgwmRLWdjOhDpbae2c4zJaaYvIUTUA1zcaLFp1StCgpMwpSTS/oKMPC0enWgyo+73l5qxn2xgjeyklBwemYiy+rSsRHw74ZdblXkL1nnNPsP7znRO0HnyBE7zUyTteIfvOReaCwb8A0POQo574wEAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 15 43 18" title="" data-src="/static/2019-10-29-15-43-18-75b859b8c2e7c6163baa46a51125975f-fee1c.png" data-srcset="/static/2019-10-29-15-43-18-75b859b8c2e7c6163baa46a51125975f-a67b7.png 200w,\n/static/2019-10-29-15-43-18-75b859b8c2e7c6163baa46a51125975f-0b187.png 400w,\n/static/2019-10-29-15-43-18-75b859b8c2e7c6163baa46a51125975f-fee1c.png 800w,\n/static/2019-10-29-15-43-18-75b859b8c2e7c6163baa46a51125975f-7169a.png 1196w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-10-29-15-44-43-c1d53694445726683314f4116e6d30c9-29961.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.02329450915141%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABA0lEQVQY002Q227DIAxA8//ftodJUx87bavWpCVAYi6+AMlMWk09ssA2vjJEJYAZp9mYaZp+Lpev8+f3x+n3fB6nzjiO1lrn3PoCwGqsH/Z937Zt8V4jACB0IADEQ9PKs2JmVXJOD/6VZ7KUIlVptT2l1EYsxIzECTMJH87a5XhttfZkqS0iBqSAHJEhE+SH2SWR+JR9ihEJEoaEQrgJM9OwtbrkMt3u6+Jz7hN57/r8ALrIeL1659SjWDtrzBLC23V9N7jEPGiFIuKs7jVrlDF6W9SGOes33Y3RAfUD/FFA27PIimIznxwOIqI2MfU5XlC/nrgCQdBTEOVAO7VSahFA+QMRLY/Rs7j+3gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 10 29 15 44 43" title="" data-src="/static/2019-10-29-15-44-43-c1d53694445726683314f4116e6d30c9-fee1c.png" data-srcset="/static/2019-10-29-15-44-43-c1d53694445726683314f4116e6d30c9-a67b7.png 200w,\n/static/2019-10-29-15-44-43-c1d53694445726683314f4116e6d30c9-0b187.png 400w,\n/static/2019-10-29-15-44-43-c1d53694445726683314f4116e6d30c9-fee1c.png 800w,\n/static/2019-10-29-15-44-43-c1d53694445726683314f4116e6d30c9-b1a91.png 1200w,\n/static/2019-10-29-15-44-43-c1d53694445726683314f4116e6d30c9-29961.png 1202w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="优化总结"><a href="#%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化总结</h1>\n<p>待优化的点：组件化复用做的不够好、以原生方式写客服组件体积会更小等等</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/构建多平台轻量化组件的实践/index.md absPath of file >>> MarkdownRemark",timeToRead:12,frontmatter:{date:"2019-10-29 09:51:53",path:"/building-platform-lightweight-components/",tags:"前端, 组件轻量化, webpack, 预研, 前端构建工具",title:"构建多平台轻量化组件的实践",draft:null}}],length:164,tag:"前端",pagesSum:33,page:22}}}});