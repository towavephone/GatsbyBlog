webpackJsonp([0x9e7fb4e3147],{1355:function(n,a){n.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"WebGL 三维方向光源 实施光照的方式有很多种，最简单的可能就是方向光源了。 方向光是指光照均匀地来自某一个方向，晴朗天气下的太阳经常被当作方向光源，它距离太远所以光线被看作是平行的照到地面上。 计算方向光非常简单，将方向光的方向和面的朝向点乘就可以得到两个方向的余弦值。 这有个例子 随意拖动其中的点，如果两点方向刚好相反，点乘结果则为 -1，如果方向相同结果为 1。 这有什么用呢？如果将三维物体的朝向和光的方向点乘，结果为 1 则物体朝向和光照方向相同，为 -…",html:'<h1 id="webgl-三维方向光源"><a href="#webgl-%E4%B8%89%E7%BB%B4%E6%96%B9%E5%90%91%E5%85%89%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维方向光源</h1>\n<p>实施光照的方式有很多种，最简单的可能就是方向光源了。</p>\n<p>方向光是指光照均匀地来自某一个方向，晴朗天气下的太阳经常被当作方向光源，它距离太远所以光线被看作是平行的照到地面上。</p>\n<p>计算方向光非常简单，将方向光的方向和面的朝向点乘就可以得到两个方向的余弦值。</p>\n<p>这有个例子</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/jstbeo?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>随意拖动其中的点，如果两点方向刚好相反，点乘结果则为 -1，如果方向相同结果为 1。</p>\n<p>这有什么用呢？如果将三维物体的朝向和光的方向点乘，结果为 1 则物体朝向和光照方向相同，为 -1 则物体朝向和光照方向相反。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/j5lmj8?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>我们可以将颜色值和点乘结果相乘，有光了！</p>\n<p>还有一个问题，我们如何知道三维物体的朝向？</p>\n<h2 id="法向量"><a href="#%E6%B3%95%E5%90%91%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>法向量</h2>\n<p>我不知道为什么叫法向量，但是在三维图形学中法向量就是描述面的朝向的单位向量。</p>\n<p>这是正方体和球体的一些法向量。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/xyb9lu?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>这些插在物体上的线就是对应顶点的法向量。</p>\n<p>注意到正方体在每个顶角有 3 个法向量。这是因为需要 3 个法向量去描述相邻的每个面的朝向。</p>\n<p>这里的法向量是基于他们的方向着色的，正 x 方向为红色，上方向为绿色，正 z 方向为蓝色。</p>\n<p>让我们来给上节中的 F 添加法向量。由于 F 非常规则并且朝向都是 <code class="language-text">x, y, z</code> 轴，所以非常简单。正面的的部分法向量为 <code class="language-text">0, 0, 1</code>，背面的部分法向量为 <code class="language-text">0, 0, -1</code>，左面为 <code class="language-text">-1, 0, 0</code>，右面为 <code class="language-text">1, 0, 0</code>，上面为 <code class="language-text">0, 1, 0</code>，然后底面为 <code class="language-text">0, -1, 0</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67393405232038310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function setNormals(gl) {\n  var normals = new Float32Array([\n    // 正面左竖\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n\n    // 正面上横\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n\n    // 正面中横\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n\n    // 背面左竖\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n\n    // 背面上横\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n\n    // 背面中横\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n\n    // 顶部\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n\n    // 上横右面\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n\n    // 上横下面\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n\n    // 上横和中横之间\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n\n    // 中横上面\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n\n    // 中横右面\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n\n    // 中横底面\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n\n    // 底部右侧\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n    1,\n    0,\n    0,\n\n    // 底面\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n\n    // 左面\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0,\n    -1,\n    0,\n    0\n  ]);\n  gl.bufferData(gl.ARRAY_BUFFER, normals, gl.STATIC_DRAW);\n}`, `67393405232038310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setNormals</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> normals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n    <span class="token comment">// 正面左竖</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 正面上横</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 正面中横</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 背面左竖</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 背面上横</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 背面中横</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 顶部</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 上横右面</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 上横下面</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 上横和中横之间</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 中横上面</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 中横右面</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 中横底面</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 底部右侧</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 底面</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// 左面</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token number">0</span>\n  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> normals<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在代码中使用它们，先移除顶点颜色以便观察光照效果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38594423865361540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 找顶点着色器中的属性\nvar positionLocation = gl.getAttribLocation(program, \'a_position\');\n// var colorLocation = gl.getAttribLocation(program, &quot;a_color&quot;);\nvar normalLocation = gl.getAttribLocation(program, \'a_normal\');\n\n// ...\n\n// // 创建一个缓冲存储颜色\n// var colorBuffer = gl.createBuffer();\n// // 绑定到 ARRAY_BUFFER\n// gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n// // 将几何数据放入缓冲\n// setColors(gl);\n\n// 创建缓冲存储法向量\nvar normalBuffer = gl.createBuffer();\n// 绑定到 ARRAY_BUFFER (可以看作 ARRAY_BUFFER = normalBuffer)\ngl.bindBuffer(gl.ARRAY_BUFFER, normalBuffer);\n// 将法向量存入缓冲\nsetNormals(gl);`, `38594423865361540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 找顶点着色器中的属性</span>\n<span class="token keyword">var</span> positionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// var colorLocation = gl.getAttribLocation(program, "a_color");</span>\n<span class="token keyword">var</span> normalLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_normal\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// // 创建一个缓冲存储颜色</span>\n<span class="token comment">// var colorBuffer = gl.createBuffer();</span>\n<span class="token comment">// // 绑定到 ARRAY_BUFFER</span>\n<span class="token comment">// gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);</span>\n<span class="token comment">// // 将几何数据放入缓冲</span>\n<span class="token comment">// setColors(gl);</span>\n\n<span class="token comment">// 创建缓冲存储法向量</span>\n<span class="token keyword">var</span> normalBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 绑定到 ARRAY_BUFFER (可以看作 ARRAY_BUFFER = normalBuffer)</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> normalBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 将法向量存入缓冲</span>\n<span class="token function">setNormals</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在渲染的时候</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52453663302129460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// // 启用颜色属性\n// gl.enableVertexAttribArray(colorLocation);\n\n// // 绑定颜色缓冲\n// gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n\n// // 告诉颜色属性怎么从 colorBuffer(ARRAY_BUFFER) 中读取颜色值\n// var size = 3;                 // 每次迭代使用 3 个单位的数据\n// var type = gl.UNSIGNED_BYTE;  // 单位数据类型是无符号 8 位整数\n// var normalize = true;         // 标准化数据 (从 0-255 转换到 0.0-1.0)\n// var stride = 0;               // 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据\n// var offset = 0;               // 从绑定缓冲的起始处开始\n// gl.vertexAttribPointer(\n//     colorLocation, size, type, normalize, stride, offset)\n\n// 启用法向量属性\ngl.enableVertexAttribArray(normalLocation);\n\n// 绑定法向量缓冲\ngl.bindBuffer(gl.ARRAY_BUFFER, normalBuffer);\n\n// 告诉法向量属性怎么从 normalBuffer (ARRAY_BUFFER) 中读取值\nvar size = 3; // 每次迭代使用 3 个单位的数据\nvar type = gl.FLOAT; // 单位数据类型是 32 位浮点型\nvar normalize = false; // 单位化 (从 0-255 转换到 0-1)\nvar stride = 0; // 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(normalLocation, size, type, normalize, stride, offset);`, `52453663302129460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// // 启用颜色属性</span>\n<span class="token comment">// gl.enableVertexAttribArray(colorLocation);</span>\n\n<span class="token comment">// // 绑定颜色缓冲</span>\n<span class="token comment">// gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);</span>\n\n<span class="token comment">// // 告诉颜色属性怎么从 colorBuffer(ARRAY_BUFFER) 中读取颜色值</span>\n<span class="token comment">// var size = 3;                 // 每次迭代使用 3 个单位的数据</span>\n<span class="token comment">// var type = gl.UNSIGNED_BYTE;  // 单位数据类型是无符号 8 位整数</span>\n<span class="token comment">// var normalize = true;         // 标准化数据 (从 0-255 转换到 0.0-1.0)</span>\n<span class="token comment">// var stride = 0;               // 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token comment">// var offset = 0;               // 从绑定缓冲的起始处开始</span>\n<span class="token comment">// gl.vertexAttribPointer(</span>\n<span class="token comment">//     colorLocation, size, type, normalize, stride, offset)</span>\n\n<span class="token comment">// 启用法向量属性</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>normalLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 绑定法向量缓冲</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> normalBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉法向量属性怎么从 normalBuffer (ARRAY_BUFFER) 中读取值</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用 3 个单位的数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是 32 位浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 单位化 (从 0-255 转换到 0-1)</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>normalLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在让着色器使用它</p>\n<p>首先在顶点着色器中只将法向量传递给片断着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38574156261639640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\n// attribute vec4 a_color;\nattribute vec3 a_normal;\n\nuniform mat4 u_matrix;\n\n// varying vec4 v_color;\nvarying vec3 v_normal;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_matrix * a_position;\n\n  // // 将颜色传到片断着色器\n  // v_color = a_color;\n\n  // 将法向量传到片断着色器\n  v_normal = a_normal;\n}`, `38574156261639640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token comment">// attribute vec4 a_color;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_matrix<span class="token punctuation">;</span>\n\n<span class="token comment">// varying vec4 v_color;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// // 将颜色传到片断着色器</span>\n  <span class="token comment">// v_color = a_color;</span>\n\n  <span class="token comment">// 将法向量传到片断着色器</span>\n  v_normal <span class="token operator">=</span> a_normal<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在片断着色器中将法向量和光照方向点乘</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70680915276963365000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\n// 从顶点着色器中传入的值\n// varying vec4 v_color;\nvarying vec3 v_normal;\n\nuniform vec3 u_reverseLightDirection;\nuniform vec4 u_color;\n\nvoid main() {\n   // 由于 v_normal 是插值出来的，有可能不是单位向量，\n   // 可以用 normalize 将其单位化。\n   vec3 normal = normalize(v_normal);\n\n   float light = dot(normal, u_reverseLightDirection);\n\n   gl_FragColor = u_color;\n\n   // 将颜色部分（不包括 alpha）和光照相乘\n   gl_FragColor.rgb *= light;\n}`, `70680915276963365000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 从顶点着色器中传入的值</span>\n<span class="token comment">// varying vec4 v_color;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_reverseLightDirection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 由于 v_normal 是插值出来的，有可能不是单位向量，</span>\n   <span class="token comment">// 可以用 normalize 将其单位化。</span>\n   <span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_normal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> u_reverseLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n\n   <span class="token comment">// 将颜色部分（不包括 alpha）和光照相乘</span>\n   gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后找到 <code class="language-text">u_color</code> 和 <code class="language-text">u_reverseLightDirection</code> 的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43058059752296530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 寻找全局变量\nvar matrixLocation = gl.getUniformLocation(program, \'u_matrix\');\nvar colorLocation = gl.getUniformLocation(program, \'u_color\');\nvar reverseLightDirectionLocation = gl.getUniformLocation(program, \'u_reverseLightDirection\');`, `43058059752296530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 寻找全局变量</span>\n<span class="token keyword">var</span> matrixLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_matrix\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> reverseLightDirectionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_reverseLightDirection\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为它们赋值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33845012024240550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 设置矩阵\ngl.uniformMatrix4fv(matrixLocation, false, worldViewProjectionMatrix);\n\n// 设置使用的颜色\ngl.uniform4fv(colorLocation, [0.2, 1, 0.2, 1]); // green\n\n// 设置光线方向\ngl.uniform3fv(reverseLightDirectionLocation, m4.normalize([0.5, 0.7, 1]));`, `33845012024240550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>matrixLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldViewProjectionMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 设置使用的颜色</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// green</span>\n\n<span class="token comment">// 设置光线方向</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>reverseLightDirectionLocation<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们之前用到的 normalize 会将原向量转换为单位向量。例子中的 x = 0.5 说明光线是从右往左照，y = 0.7 说明光线从上方往下照，z = 1 说明光线从在场景前方。对应的值表示光源大多指向场景，在靠右方和上方一点的位置。</p>\n<p>这是结果</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/vp33w2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果你旋转了 F 就会发现，F 虽然旋转了但是光照没变，我们希望随着 F 的旋转正面总是被照亮的。</p>\n<p>为了解决这个问题就需要在物体重定向时重定向法向量，和位置一样我们也可以将向量和矩阵相乘，这个矩阵显然是 world 矩阵，现在我们只传了一个矩阵 <code class="language-text">u_matrix</code>，所以先来改成传递两个矩阵，一个叫做 <code class="language-text">u_world</code> 的世界矩阵，另一个叫做 <code class="language-text">u_worldViewProjection</code> 也就是我们现在的 <code class="language-text">u_matrix</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93178964057887590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform mat4 u_worldViewProjection;\nuniform mat4 u_world;\n\nvarying vec3 v_normal;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_worldViewProjection * a_position;\n\n  // 重定向法向量并传递给片断着色器\n  v_normal = mat3(u_world) * a_normal;\n}`, `93178964057887590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldViewProjection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_world<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_worldViewProjection <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 重定向法向量并传递给片断着色器</span>\n  v_normal <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>u_world<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意到我们将 <code class="language-text">a_normal</code> 与 <code class="language-text">mat3(u_world)</code> 相乘，那是因为法向量是方向所以不用关心位移，矩阵的左上 3x3 部分才是控制姿态的。</p>\n<p>找到全局变量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3749506858830376000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 寻找全局变量\nvar worldViewProjectionLocation = gl.getUniformLocation(program, \'u_worldViewProjection\');\nvar worldLocation = gl.getUniformLocation(program, \'u_world\');`, `3749506858830376000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 寻找全局变量</span>\n<span class="token keyword">var</span> worldViewProjectionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_worldViewProjection\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> worldLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_world\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后更新它们</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72765914992871014000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 设置矩阵\ngl.uniformMatrix4fv(worldViewProjectionLocation, false, worldViewProjectionMatrix);\ngl.uniformMatrix4fv(worldLocation, false, worldMatrix);`, `72765914992871014000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldViewProjectionLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldViewProjectionMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/it9qvy?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>旋转后就会发现面对 F 的面总是被照亮的。</p>\n<p>这里有一个问题我不知道如何表述所以就用图解展示，我们用 normal 和 u_world 相乘去重定向法向量，如果世界矩阵被缩放了怎么办？事实是会得到错误的法向量。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/zzocr1?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>我从没想弄清为什么，但解决办法就是对世界矩阵求逆并转置，用这个矩阵就会得到正确的结果。</p>\n<p>在图解里中间的紫色球体是未缩放的，左边的红色球体用的世界矩阵并缩放了，你可以看出有些不太对劲。右边蓝色的球体用的是世界矩阵求逆并转置后的矩阵。</p>\n<p>点击图解循环观察不同的表示形式，你会发现在缩放严重时左边的（世界矩阵）法向量和表面没有保持垂直关系，而右边的（世界矩阵求逆并转置）一直保持垂直。最后一种模式是将它们渲染成红色，你会发现两个球体的光照结果相差非常大，基于可视化的结果可以得出使用世界矩阵求逆转置是对的。</p>\n<p>修改代码让示例使用这种矩阵，首先更新着色器，理论上我们可以直接更新 <code class="language-text">u_world</code> 的值，但是最好将它重命名以表示它真正的含义，防止混淆。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96258774696333440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform mat4 u_worldViewProjection;\nuniform mat4 u_worldInverseTranspose;\n\nvarying vec3 v_normal;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_worldViewProjection * a_position;\n\n  // 重定向法向量并传递给片断着色器\n  v_normal = mat3(u_worldInverseTranspose) * a_normal;\n}`, `96258774696333440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldViewProjection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldInverseTranspose<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_worldViewProjection <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 重定向法向量并传递给片断着色器</span>\n  v_normal <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>u_worldInverseTranspose<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后找到它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11190738018183688000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// var worldLocation = gl.getUniformLocation(program, \'u_world\');\nvar worldInverseTransposeLocation = gl.getUniformLocation(program, \'u_worldInverseTranspose\');`, `11190738018183688000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// var worldLocation = gl.getUniformLocation(program, \'u_world\');</span>\n<span class="token keyword">var</span> worldInverseTransposeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_worldInverseTranspose\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>更新它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69787377053534550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var worldViewProjectionMatrix = m4.multiply(viewProjectionMatrix, worldMatrix);\nvar worldInverseMatrix = m4.inverse(worldMatrix);\nvar worldInverseTransposeMatrix = m4.transpose(worldInverseMatrix);\n\n// 设置矩阵\ngl.uniformMatrix4fv(worldViewProjectionLocation, false, worldViewProjectionMatrix);\n// gl.uniformMatrix4fv(worldLocation, false, worldMatrix);\ngl.uniformMatrix4fv(worldInverseTransposeLocation, false, worldInverseTransposeMatrix);`, `69787377053534550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> worldViewProjectionMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>viewProjectionMatrix<span class="token punctuation">,</span> worldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> worldInverseMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span>worldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> worldInverseTransposeMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">transpose</span><span class="token punctuation">(</span>worldInverseMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldViewProjectionLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldViewProjectionMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// gl.uniformMatrix4fv(worldLocation, false, worldMatrix);</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldInverseTransposeLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldInverseTransposeMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是转置的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41073796471814040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  transpose: function(m) {\n    return [m[0], m[4], m[8], m[12], m[1], m[5], m[9], m[13], m[2], m[6], m[10], m[14], m[3], m[7], m[11], m[15]];\n  }\n\n  // ...\n};`, `41073796471814040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">transpose</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于我们并没有进行缩放，所以没有明显的变化，但防患于未然。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/vy56uh?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="mat3u_worldinversetranspose--a_normal-的可选方案"><a href="#mat3u_worldinversetranspose--a_normal-%E7%9A%84%E5%8F%AF%E9%80%89%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">mat3(u_worldInverseTranspose) * a_normal</code> 的可选方案</h2>\n<p>之前的着色器中出现了这样的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9679333696054026000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v_normal = mat3(u_worldInverseTranspose) * a_normal;`, `9679333696054026000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">v_normal <span class="token operator">=</span> <span class="token function">mat3</span><span class="token punctuation">(</span>u_worldInverseTranspose<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们也可以这样做</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35482247736863060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v_normal = (u_worldInverseTranspose * vec4(a_normal, 0)).xyz;`, `35482247736863060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">v_normal <span class="token operator">=</span> <span class="token punctuation">(</span>u_worldInverseTranspose <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>a_normal<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>由于 w 在相乘前被赋值为 0，所以在相乘后负责平移的部分与 0 相乘被移除了。我认为这可能是更常用的方式，mat3 的做法只是对我来说更简洁但我经常用前一种方法。</p>\n<p>当然另一种解决方案是将 <code class="language-text">u_worldInverseTranspose</code> 直接构造成 mat3。这有两个不能这么做的理由，第一个是我们可能需要一个完整的 <code class="language-text">u_worldInverseTranspose</code> 对象传递一个 mat4 给还要给其他地方使用，另一个是我们在 JavaScript 中的所有矩阵方法都是针对 4x4 的矩阵，如果没有其他特别的需求，没有必要构造一个 3x3 的矩阵，或者是把 4x4 转换成 3x3。</p>\n<h1 id="webgl-三维点光源"><a href="#webgl-%E4%B8%89%E7%BB%B4%E7%82%B9%E5%85%89%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维点光源</h1>\n<p>上篇中说到方向光统一来自一个方向，在渲染前设置好方向。</p>\n<p>如果代替方向而是从三维空间中选一个点当作光源，然后在着色器中根据光源和表面位置计算光照方向的话，就是点光源了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/i3grsj?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果旋转上方的表面会发现，每个点都有一个不同的面到光源的矢量，将这个矢量和法向量点乘后，表面上的每个点都会有一个不同的光照值。</p>\n<p>让我们实现它吧。</p>\n<p>首先需要一个光源位置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12376915234269247000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`uniform vec3 u_lightWorldPosition;`, `12376915234269247000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightWorldPosition<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后需要计算表面的世界坐标，我们可以将位置和世界矩阵相乘得到</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29895204137209807000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`uniform mat4 u_world;\n\n// ...\n\n// 计算表面的世界坐标\nvec3 surfaceWorldPosition = (u_world * a_position).xyz;`, `29895204137209807000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_world<span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 计算表面的世界坐标</span>\n<span class="token keyword">vec3</span> surfaceWorldPosition <span class="token operator">=</span> <span class="token punctuation">(</span>u_world <span class="token operator">*</span> a_position<span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后可以计算出一个从表面到光源的矢量，用来模拟之前的方向光，只是这次我们为表面上的每个点都计算了一个方向。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86999639268427970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;`, `86999639268427970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">v_surfaceToLight <span class="token operator">=</span> u_lightWorldPosition <span class="token operator">-</span> surfaceWorldPosition<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这是全部的内容</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48723680639680800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform vec3 u_lightWorldPosition;\n\nuniform mat4 u_world;\nuniform mat4 u_worldViewProjection;\nuniform mat4 u_worldInverseTranspose;\n\nvarying vec3 v_normal;\n\nvarying vec3 v_surfaceToLight;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_worldViewProjection * a_position;\n\n  // 重定向法向量并传递给片断着色器\n  v_normal = mat3(u_worldInverseTranspose) * a_normal;\n\n  // 计算表面的世界坐标\n  vec3 surfaceWorldPosition = (u_world * a_position).xyz;\n\n  // 计算表面到光源的方向\n  // 传递给片断着色器\n  v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;\n}`, `48723680639680800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{4,6,12,21-26}"\n              >\n                <span class="gatsby-code-button-language">glsl{4,6,12,21-26}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightWorldPosition<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_world<span class="token punctuation">;</span></span><span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldViewProjection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldInverseTranspose<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span></span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_worldViewProjection <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 重定向法向量并传递给片断着色器</span>\n  v_normal <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>u_worldInverseTranspose<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token comment">// 计算表面的世界坐标</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">vec3</span> surfaceWorldPosition <span class="token operator">=</span> <span class="token punctuation">(</span>u_world <span class="token operator">*</span> a_position<span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  <span class="token comment">// 计算表面到光源的方向</span></span><span class="gatsby-highlight-code-line">  <span class="token comment">// 传递给片断着色器</span></span><span class="gatsby-highlight-code-line">  v_surfaceToLight <span class="token operator">=</span> u_lightWorldPosition <span class="token operator">-</span> surfaceWorldPosition<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在片断着色器中需要将表面到光源的方向进行单位化，注意，虽然我们可以在顶点着色器中传递单位向量，但是 varying 会进行插值再传给片断着色器，所以片断着色器中的向量基本上不是单位向量了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60285471551877005000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\n// 从顶点着色器中传入的值\nvarying vec3 v_normal;\nvarying vec3 v_surfaceToLight;\n\n// uniform vec3 u_reverseLightDirection;\nuniform vec4 u_color;\n\nvoid main() {\n  // 由于 v_normal 是可变量，所以经过插值后不再是单位向量\n  // 单位化后会成为单位向量\n  vec3 normal = normalize(v_normal);\n\n  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\n\n  -float light = dot(normal, u_reverseLightDirection);\n  +float light = dot(normal, surfaceToLightDirection);\n\n  gl_FragColor = u_color;\n\n  // 只将颜色部分（不包含 alpha）和光照相乘\n  gl_FragColor.rgb *= light;\n}`, `60285471551877005000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{5,7}"\n              >\n                <span class="gatsby-code-button-language">glsl{5,7}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 从顶点着色器中传入的值</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line"><span class="token comment">// uniform vec3 u_reverseLightDirection;</span></span><span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 由于 v_normal 是可变量，所以经过插值后不再是单位向量</span>\n  <span class="token comment">// 单位化后会成为单位向量</span>\n  <span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_normal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">vec3</span> surfaceToLightDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToLight<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token operator">-</span><span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> u_reverseLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token operator">+</span><span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n\n  <span class="token comment">// 只将颜色部分（不包含 alpha）和光照相乘</span>\n  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后需要找到 <code class="language-text">u_world</code> 和 <code class="language-text">u_lightWorldPosition</code> 的位置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85546419056998200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// var reverseLightDirectionLocation = gl.getUniformLocation(program, \'u_reverseLightDirection\');\nvar lightWorldPositionLocation = gl.getUniformLocation(program, \'u_lightWorldPosition\');\nvar worldLocation = gl.getUniformLocation(program, \'u_world\');`, `85546419056998200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// var reverseLightDirectionLocation = gl.getUniformLocation(program, \'u_reverseLightDirection\');</span>\n<span class="token keyword">var</span> lightWorldPositionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightWorldPosition\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> worldLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_world\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>设置它们</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57866951091756550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 设置矩阵\ngl.uniformMatrix4fv(worldLocation, false, worldMatrix);\ngl.uniformMatrix4fv(worldViewProjectionLocation, false, worldViewProjectionMatrix);\n\n// ...\n\n// // 设置光照方向\n// gl.uniform3fv(reverseLightDirectionLocation, m4.normalize([0.5, 0.7, 1]));\n// 设置光源位置\ngl.uniform3fv(lightWorldPositionLocation, [20, 30, 50]);`, `57866951091756550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>worldViewProjectionLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> worldViewProjectionMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// // 设置光照方向</span>\n<span class="token comment">// gl.uniform3fv(reverseLightDirectionLocation, m4.normalize([0.5, 0.7, 1]));</span>\n<span class="token comment">// 设置光源位置</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>lightWorldPositionLocation<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是结果</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/xwmmsc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>现在我们可以加一个叫做镜面高光的东西。</p>\n<p>观察现实世界中的物体，如果物体表面恰好将光线反射到你眼前，就会显得非常明亮，像镜子一样。</p>\n<p>我们可以通过计算光线是否反射到眼前来模拟这种情况，点乘又一次起到了至关重要的作用。</p>\n<p>如何测试呢？如果入射角和反射角恰好与眼睛和和光源的夹角相同，那么光线就会反射到眼前。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/352uf4?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果我们知道了物体表面到光源的方向（刚刚已经计算过了），加上物体表面到视区/眼睛/相机的方向，再除以 2 得到 halfVector 向量，将这个向量和法向量比较，如果方向一致，那么光线就会被反射到眼前。那么如何确定方向是否一致呢？用之前的点乘就可以了。1 表示相符，0 表示垂直，-1 表示相反。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/yrs3bw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>所以首先我们需要传入相机位置，计算表面到相机的方向矢量，然后传递到片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54138172240199240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform vec3 u_lightWorldPosition;\nuniform vec3 u_viewWorldPosition;\n\nuniform mat4 u_world;\nuniform mat4 u_worldViewProjection;\nuniform mat4 u_worldInverseTranspose;\n\nvarying vec3 v_normal;\n\nvarying vec3 v_surfaceToLight;\nvarying vec3 v_surfaceToView;\n\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = u_worldViewProjection * a_position;\n\n  // 重定向法向量并传递到片断着色器\n  v_normal = mat3(u_worldInverseTranspose) * a_normal;\n\n  // 计算表面的世界坐标\n  vec3 surfaceWorldPosition = (u_world * a_position).xyz;\n\n  // 计算表面到光源的方向\n  // 然后传递到片断着色器\n  v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;\n\n  // 计算表面到相机的方向\n  // 然后传递到片断着色器\n  v_surfaceToView = u_viewWorldPosition - surfaceWorldPosition;\n}`, `54138172240199240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{5,14,30-32}"\n              >\n                <span class="gatsby-code-button-language">glsl{5,14,30-32}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec3</span> a_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightWorldPosition<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_viewWorldPosition<span class="token punctuation">;</span></span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_world<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldViewProjection<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> u_worldInverseTranspose<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToView<span class="token punctuation">;</span></span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> u_worldViewProjection <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 重定向法向量并传递到片断着色器</span>\n  v_normal <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>u_worldInverseTranspose<span class="token punctuation">)</span> <span class="token operator">*</span> a_normal<span class="token punctuation">;</span>\n\n  <span class="token comment">// 计算表面的世界坐标</span>\n  <span class="token keyword">vec3</span> surfaceWorldPosition <span class="token operator">=</span> <span class="token punctuation">(</span>u_world <span class="token operator">*</span> a_position<span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>\n\n  <span class="token comment">// 计算表面到光源的方向</span>\n  <span class="token comment">// 然后传递到片断着色器</span>\n  v_surfaceToLight <span class="token operator">=</span> u_lightWorldPosition <span class="token operator">-</span> surfaceWorldPosition<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token comment">// 计算表面到相机的方向</span></span><span class="gatsby-highlight-code-line">  <span class="token comment">// 然后传递到片断着色器</span></span><span class="gatsby-highlight-code-line">  v_surfaceToView <span class="token operator">=</span> u_viewWorldPosition <span class="token operator">-</span> surfaceWorldPosition<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在片断着色器中计算表面到光源和相机之间的 halfVector，将它和法向量相乘，查看光线是否直接反射到眼前。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78397395629008630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 从顶点着色器中传入的值\nvarying vec3 v_normal;\nvarying vec3 v_surfaceToLight;\nvarying vec3 v_surfaceToView;\n\nuniform vec4 u_color;\n\nvoid main() {\n  // 由于 v_normal 是可变量，所以经过插值后不再是单位向量，\n  // 单位化后会成为单位向量\n  vec3 normal = normalize(v_normal);\n\n  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\n  vec3 surfaceToViewDirection = normalize(v_surfaceToView);\n  vec3 halfVector = normalize(surfaceToLightDirection + surfaceToViewDirection);\n\n  float light = dot(normal, surfaceToLightDirection);\n  float specular = dot(normal, halfVector);\n\n  gl_FragColor = u_color;\n\n  // 只将颜色部分（不包含 alpha）和光照相乘\n  gl_FragColor.rgb *= light;\n\n  // 直接加上高光\n  gl_FragColor.rgb += specular;\n}`, `78397395629008630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{4,13-15,18,25-26}"\n              >\n                <span class="gatsby-code-button-language">glsl{4,13-15,18,25-26}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 从顶点着色器中传入的值</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToView<span class="token punctuation">;</span></span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 由于 v_normal 是可变量，所以经过插值后不再是单位向量，</span>\n  <span class="token comment">// 单位化后会成为单位向量</span>\n  <span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_normal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token keyword">vec3</span> surfaceToLightDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToLight<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">vec3</span> surfaceToViewDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToView<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">vec3</span> halfVector <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>surfaceToLightDirection <span class="token operator">+</span> surfaceToViewDirection<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n  <span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">  <span class="token keyword">float</span> specular <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n  gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n\n  <span class="token comment">// 只将颜色部分（不包含 alpha）和光照相乘</span>\n  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token comment">// 直接加上高光</span></span><span class="gatsby-highlight-code-line">  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">+</span><span class="token operator">=</span> specular<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后找到 <code class="language-text">u_viewWorldPosition</code> 并设置它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76469677871122070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var lightWorldPositionLocation = gl.getUniformLocation(program, \'u_lightWorldPosition\');\nvar viewWorldPositionLocation = gl.getUniformLocation(program, \'u_viewWorldPosition\');\n\n// ...\n\n// 计算相机矩阵\nvar camera = [100, 150, 200];\nvar target = [0, 35, 0];\nvar up = [0, 1, 0];\nvar cameraMatrix = makeLookAt(camera, target, up);\n\n// 设置相机位置\ngl.uniform3fv(viewWorldPositionLocation, camera);`, `76469677871122070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2,12-13}"\n              >\n                <span class="gatsby-code-button-language">js{2,12-13}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> lightWorldPositionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightWorldPosition\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> viewWorldPositionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_viewWorldPosition\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 计算相机矩阵</span>\n<span class="token keyword">var</span> camera <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> target <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> up <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> <span class="token function">makeLookAt</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> up<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token comment">// 设置相机位置</span></span><span class="gatsby-highlight-code-line">gl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>viewWorldPositionLocation<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/z123sf?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>但，亮瞎了!</p>\n<p>我们可以将点乘结果进行求幂运算来解决太亮的问题，它会把高光从线性变换变成指数变换。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/nd3lyv?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>红线越接近顶部，我们加的光照就越多，通过求幂可以将高光的部分向右移动。</p>\n<p>就把它叫做 shininess 并加到着色器中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22322622865117348000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`uniform vec4 u_color;\nuniform float u_shininess;\n\n// ...\n\n// float specular = dot(normal, halfVector);\nfloat specular = 0.0;\nif (light > 0.0) {\n   specular = pow(dot(normal, halfVector), u_shininess);\n}`, `22322622865117348000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{2,6-10}"\n              >\n                <span class="gatsby-code-button-language">glsl{2,6-10}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">float</span> u_shininess<span class="token punctuation">;</span></span>\n<span class="token comment">// ...</span>\n\n<span class="gatsby-highlight-code-line"><span class="token comment">// float specular = dot(normal, halfVector);</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">float</span> specular <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>light <span class="token operator">></span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">   specular <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>点乘结果有可能为负值，将负值求幂有可能会得到 undefined 的结果，所以我们只将点乘结果为正的部分进行计算，其他部分设置为 0.0。</p>\n<p>当然还要找到亮度的位置并设置它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90818813019559050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var shininessLocation = gl.getUniformLocation(program, \'u_shininess\');\n\n// ...\n\n// 设置亮度\ngl.uniform1f(shininessLocation, shininess);`, `90818813019559050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{1}"\n              >\n                <span class="gatsby-code-button-language">js{1}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="gatsby-highlight-code-line"><span class="token keyword">var</span> shininessLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_shininess\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 设置亮度</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>shininessLocation<span class="token punctuation">,</span> shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/lrej2i?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>最后想说的是光的颜色。</p>\n<p>在此之前我们都是将 light 和 F 的颜色直接相乘，如果想要有色光也可以为光照提供颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9722774065602090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`uniform vec4 u_color;\nuniform float u_shininess;\nuniform vec3 u_lightColor;\nuniform vec3 u_specularColor;\n\n// ...\n\n// 只将颜色部分（不包含 alpha） 和光照相乘\ngl_FragColor.rgb *= light * u_lightColor;\n\n// 直接和高光相加\ngl_FragColor.rgb += specular * u_specularColor;`, `9722774065602090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{3-4,9,12}"\n              >\n                <span class="gatsby-code-button-language">glsl{3-4,9,12}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">float</span> u_shininess<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightColor<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_specularColor<span class="token punctuation">;</span></span>\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 只将颜色部分（不包含 alpha） 和光照相乘</span>\n<span class="gatsby-highlight-code-line">gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light <span class="token operator">*</span> u_lightColor<span class="token punctuation">;</span></span>\n<span class="token comment">// 直接和高光相加</span>\n<span class="gatsby-highlight-code-line">gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">+</span><span class="token operator">=</span> specular <span class="token operator">*</span> u_specularColor<span class="token punctuation">;</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46647665040647040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var lightColorLocation = gl.getUniformLocation(program, \'u_lightColor\');\nvar specularColorLocation = gl.getUniformLocation(program, \'u_specularColor\');`, `46647665040647040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> lightColorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightColor\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> specularColorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_specularColor\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34619462700756730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 设置光照颜色\ngl.uniform3fv(lightColorLocation, m4.normalize([1, 0.6, 0.6])); // 红光\n// 设置高光颜色\ngl.uniform3fv(specularColorLocation, m4.normalize([1, 0.6, 0.6])); // 红光`, `34619462700756730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 设置光照颜色</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>lightColorLocation<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 红光</span>\n<span class="token comment">// 设置高光颜色</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>specularColorLocation<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 红光</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/fwn7lv?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="webgl-三维聚光灯"><a href="#webgl-%E4%B8%89%E7%BB%B4%E8%81%9A%E5%85%89%E7%81%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维聚光灯</h1>\n<p>在上篇文章中我们讲到点光源，计算光源到物体表面每一点的方向，然后做与方向光相同的运算，也就是对光线方向和表面法向量（表面面对的方向）做点乘运算。如果两个方向完全相同就会得到 1，应该被完全照亮。如果两个方向垂直会得到 0，相反会得到 -1。我们直接将这个值和表面的颜色相乘，实现光照效果。</p>\n<p>聚光灯只是做了少量修改，事实上如果你比较有创新能力的话，可能会根据之前学的东西知道聚光灯的实现方法。</p>\n<p>你可以把点光源想象成一个点，光线从那个点照向所有方向。实现聚光灯只需要以那个点为起点选择一个方向，作为聚光灯的方向，然后将其他光线方向与所选方向点乘，然后随意选择一个限定范围，然后判断光线是否在限定范围内，如果不在就不照亮。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/4nwjt1?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>在上方的图示中我们可以看到光线照向所有的方向，并且将每个方向的点乘结果显示在上面。然后指定一个方向表示聚光灯的方向，选择一个限定（上方以度为单位）。通过限定我们计算一个点乘限定，只需对限定值取余弦就可以得到。如果与选定聚光灯方向的点乘大于这个点乘限定，就照亮，否则不照亮。</p>\n<p>换一种方式解释，假设限定是 20 度，我们可以将它转换为弧度，然后取余弦值得到 -1 到 1 之间的数，暂且把它称作点乘空间。或者可以用这个表格表示限定值的转换。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27739279133520010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`          限制值\n   角度   |   弧度   | 点乘空间\n --------+---------+----------\n    0    |   0.0   |    1.0\n    22   |    .38  |     .93\n    45   |    .79  |     .71\n    67   |   1.17  |     .39\n    90   |   1.57  |    0.0\n   180   |   3.14  |   -1.0`, `27739279133520010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">          限制值\n   角度   |   弧度   | 点乘空间\n --------+---------+----------\n    0    |   0.0   |    1.0\n    22   |    .38  |     .93\n    45   |    .79  |     .71\n    67   |   1.17  |     .39\n    90   |   1.57  |    0.0\n   180   |   3.14  |   -1.0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们可以只需判断</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="502002998255002300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dotFromDirection = dot(surfaceToLight, -lightDirection);\nif (dotFromDirection >= limitInDotSpace) {\n  // 使用光照\n}`, `502002998255002300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLight<span class="token punctuation">,</span> <span class="token operator">-</span>lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>dotFromDirection <span class="token operator">>=</span> limitInDotSpace<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 使用光照</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>让我们来实现它。</p>\n<p>首先修改上文的片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55346073560266350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\n// 从顶点着色器传入的值\nvarying vec3 v_normal;\nvarying vec3 v_surfaceToLight;\nvarying vec3 v_surfaceToView;\n\nuniform vec4 u_color;\nuniform float u_shininess;\nuniform vec3 u_lightDirection;\nuniform float u_limit; // 在点乘空间中\n\nvoid main() {\n  // 因为 v_normal 是可变量，被插值过\n  // 所以不是单位向量，单位可以让它成为再次成为单位向量\n  vec3 normal = normalize(v_normal);\n\n  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\n  vec3 surfaceToViewDirection = normalize(v_surfaceToView);\n  vec3 halfVector = normalize(surfaceToLightDirection + surfaceToViewDirection);\n\n  // float light = dot(normal, surfaceToLightDirection);\n  float light = 0.0;\n  float specular = 0.0;\n\n  float dotFromDirection = dot(surfaceToLightDirection,\n                               -u_lightDirection);\n  if (dotFromDirection >= u_limit) {\n    light = dot(normal, surfaceToLightDirection);\n    if (light > 0.0) {\n      specular = pow(dot(normal, halfVector), u_shininess);\n    }\n  }\n\n  gl_FragColor = u_color;\n\n  // 只将颜色部分（不包含 alpha）和光照相乘\n  gl_FragColor.rgb *= light;\n\n  // 直接加上高光\n  gl_FragColor.rgb += specular;\n}`, `55346073560266350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{10-11,22-23,26-33}"\n              >\n                <span class="gatsby-code-button-language">glsl{10-11,22-23,26-33}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 从顶点着色器传入的值</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_normal<span class="token punctuation">;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToLight<span class="token punctuation">;</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec3</span> v_surfaceToView<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_color<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">float</span> u_shininess<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightDirection<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">float</span> u_limit<span class="token punctuation">;</span> <span class="token comment">// 在点乘空间中</span></span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 因为 v_normal 是可变量，被插值过</span>\n  <span class="token comment">// 所以不是单位向量，单位可以让它成为再次成为单位向量</span>\n  <span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_normal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">vec3</span> surfaceToLightDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToLight<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">vec3</span> surfaceToViewDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>v_surfaceToView<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">vec3</span> halfVector <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>surfaceToLightDirection <span class="token operator">+</span> surfaceToViewDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token comment">// float light = dot(normal, surfaceToLightDirection);</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">float</span> light <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span></span>  <span class="token keyword">float</span> specular <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token keyword">float</span> dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLightDirection<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                               <span class="token operator">-</span>u_lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>dotFromDirection <span class="token operator">>=</span> u_limit<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    light <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>light <span class="token operator">></span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      specular <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>\n  gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n\n  <span class="token comment">// 只将颜色部分（不包含 alpha）和光照相乘</span>\n  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> light<span class="token punctuation">;</span>\n\n  <span class="token comment">// 直接加上高光</span>\n  gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">+</span><span class="token operator">=</span> specular<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然我们需要找到刚才添加的全局变量的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83789951774182740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var lightDirection = [0, 0, 0];\nvar limit = degToRad(20);\n\n// ...\n\nvar lightDirectionLocation = gl.getUniformLocation(program, \'u_lightDirection\');\nvar limitLocation = gl.getUniformLocation(program, \'u_limit\');`, `83789951774182740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> lightDirection <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> limit <span class="token operator">=</span> <span class="token function">degToRad</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token keyword">var</span> lightDirectionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightDirection\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> limitLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_limit\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后设置它们</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24655453537650820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform3fv(lightDirectionLocation, lightDirection);\ngl.uniform1f(limitLocation, Math.cos(limit));`, `24655453537650820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>lightDirectionLocation<span class="token punctuation">,</span> lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>limitLocation<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/i7cotm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>一些需要注意的细节：一个是我们在上方对 <code class="language-text">u_lightDirection</code> 取负，这其实是一个等价的选择，我们希望两个方向匹配的时候能指向相同的方向，也就是需要将 <code class="language-text">surfaceToLightDirection</code> 和聚光灯的反方向相比，我们可以用很多种方式实现这个。可以在设置全局变量时传入反方向，那可能是我的首选，但是我觉得那样应该叫做 <code class="language-text">u_reverseLightDirection</code> 或 <code class="language-text">u_negativeLightDirection</code> 而不是 <code class="language-text">u_lightDirection</code>。</p>\n<p>另一件事，也许这个只是个人习惯，如果可能的话我尽量不在着色器中使用条件语句，原因是我认为着色器并不是真的使用条件语句，如果你在着色器中使用，编译器会在代码中扩展很多 0 和 1 的乘法运算来实现，所以这里并不是真的条件语句，它会将你的代码扩展成多种组合。我不确定现在是否还是这样，但是我们可以使用一些技巧来避免这种情况，你自己可以选择用或不用。</p>\n<p>有一个 GLSL 函数叫做 step，它获取两个值，如果第二个值大于或等于第一个值就返回 1.0，否则返回 0。用 JavaScript 大概可以这样表示。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90758424948698730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function step(a, b) {\n  if (b >= a) {\n    return 1;\n  } else {\n    return 0;\n  }\n}`, `90758424948698730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">step</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">>=</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>让我们使用 step 避免这种情况</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18181546377921266000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float dotFromDirection = dot(surfaceToLightDirection, -u_lightDirection);\n// 如果光线在聚光灯范围内 inLight 就为 1，否则为 0\nfloat inLight = step(u_limit, dotFromDirection);\nfloat light = inLight * dot(normal, surfaceToLightDirection);\nfloat specular = inLight * pow(dot(normal, halfVector), u_shininess);`, `18181546377921266000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLightDirection<span class="token punctuation">,</span> <span class="token operator">-</span>u_lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 如果光线在聚光灯范围内 inLight 就为 1，否则为 0</span>\n<span class="token keyword">float</span> inLight <span class="token operator">=</span> <span class="token function">step</span><span class="token punctuation">(</span>u_limit<span class="token punctuation">,</span> dotFromDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> light <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> specular <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看起来没有什么区别，这是结果</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/yd0rcc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>还有一件事，现在的聚光灯效果非常粗糙和僵硬。只有在聚光灯范围内或外，在外面就直接变黑，没有任何过渡。</p>\n<p>要修正它我们可以使用两个限定值代替原来的一个，一个内部限定一个外部限定。如果在内部限定内就使用 1.0，在外部限定外面就使用 0.0，在内部和外部限定之间就使用 1.0 到 0.0 之间的插值。</p>\n<p>这是我们实现这个的一种方式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53725209565753480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// uniform float u_limit; // 在点乘空间中\nuniform float u_innerLimit; // 在点乘空间中\nuniform float u_outerLimit; // 在点乘空间中\n\n// ...\n\nfloat dotFromDirection = dot(surfaceToLightDirection, -u_lightDirection);\n// float inLight = step(u_limit, dotFromDirection);\nfloat limitRange = u_innerLimit - u_outerLimit;\nfloat inLight = clamp((dotFromDirection - u_outerLimit) / limitRange, 0.0, 1.0);\nfloat light = inLight * dot(normal, surfaceToLightDirection);\nfloat specular = inLight * pow(dot(normal, halfVector), u_shininess);`, `53725209565753480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{1-3,8-10}"\n              >\n                <span class="gatsby-code-button-language">glsl{1-3,8-10}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="gatsby-highlight-code-line"><span class="token comment">// uniform float u_limit; // 在点乘空间中</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">float</span> u_innerLimit<span class="token punctuation">;</span> <span class="token comment">// 在点乘空间中</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">uniform</span> <span class="token keyword">float</span> u_outerLimit<span class="token punctuation">;</span> <span class="token comment">// 在点乘空间中</span></span>\n<span class="token comment">// ...</span>\n\n<span class="token keyword">float</span> dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLightDirection<span class="token punctuation">,</span> <span class="token operator">-</span>u_lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token comment">// float inLight = step(u_limit, dotFromDirection);</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">float</span> limitRange <span class="token operator">=</span> u_innerLimit <span class="token operator">-</span> u_outerLimit<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">float</span> inLight <span class="token operator">=</span> <span class="token function">clamp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dotFromDirection <span class="token operator">-</span> u_outerLimit<span class="token punctuation">)</span> <span class="token operator">/</span> limitRange<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token keyword">float</span> light <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> specular <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样就行了</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/8rzoi2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>现在我们得到了聚光灯的效果。</p>\n<p>需要注意的是如果 <code class="language-text">u_innerLimit</code> 和 <code class="language-text">u_outerLimit</code> 相等那么 limitRange 就会是 0.0，除以 0 就会导致 undefined。这在着色器中没有什么解决办法，所以只需要在 JavaScript 中确保 <code class="language-text">u_innerLimit</code> 和 <code class="language-text">u_outerLimit</code> 永远不要相等。（注意：示例代码中并没有做这个。）</p>\n<p>GLSL 也有一个函数可以稍微做一些简化，叫做 smoothstep，和 step 相似返回一个 0 到 1 之间的值，但是它获取最大和最小边界值，返回该值在边界范围映射到 0 到 1 之间的插值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45979083076079140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float dotFromDirection = dot(surfaceToLightDirection, -u_lightDirection);\n// float limitRange = u_innerLimit - u_outerLimit;\n// float inLight = clamp((dotFromDirection - u_outerLimit) / limitRange, 0.0, 1.0);\nfloat inLight = smoothstep(u_outerLimit, u_innerLimit, dotFromDirection);\nfloat light = inLight * dot(normal, surfaceToLightDirection);\nfloat specular = inLight * pow(dot(normal, halfVector), u_shininess);`, `45979083076079140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> dotFromDirection <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>surfaceToLightDirection<span class="token punctuation">,</span> <span class="token operator">-</span>u_lightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// float limitRange = u_innerLimit - u_outerLimit;</span>\n<span class="token comment">// float inLight = clamp((dotFromDirection - u_outerLimit) / limitRange, 0.0, 1.0);</span>\n<span class="token keyword">float</span> inLight <span class="token operator">=</span> <span class="token function">smoothstep</span><span class="token punctuation">(</span>u_outerLimit<span class="token punctuation">,</span> u_innerLimit<span class="token punctuation">,</span> dotFromDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> light <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> surfaceToLightDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">float</span> specular <span class="token operator">=</span> inLight <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> halfVector<span class="token punctuation">)</span><span class="token punctuation">,</span> u_shininess<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样也可以</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/5udeoe?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>不同之处是 smoothstep 使用 Hermite 插值而不是线型插值，也就是说 lowerBound 和 upperBound 之间的值插值后像下方右图所示，线型插值是左图。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-06-15-14-01-31-1095413faf7395ae3e2f26a6dc02fd83-7027d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 300px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABG0lEQVQoz32RO07DQBCGvzgviAm2IQkI8ZYQPSUFFRJCiCOko4XTcBYKzsAFaGmQaOACxPy7O1ZsE3uk2ZnV/P5mxssNHJ/ABMj6sEXNoxAn13D0CKe9cM+i/9pMPsXBclijxTqQKKTSdeWjFukGRuZLH7xA5PK5Z9gRLNVk2y75gP43xC6/qvT0NsbWxMHUPVlYMa92Tt1an3aRZqj6cIVujO1fCDsOmhv0uQYsA6QdLWyjy1XA+XKyCrQJaDr/Py+aJqyJk3ebYGDAmdV/l7pB7UErQD/Rg8VXwX7Cy7p7UjxKMfa9RWniN9/Tj7tZrNNoAsaHQZO2aSxdd8eB3G2zU/ZeiFMV9u7gXPm+fLesjUKcdRWfpLmFsz9PaTMX9FpEMQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 06 15 14 01 31" title="" data-src="/static/2022-06-15-14-01-31-1095413faf7395ae3e2f26a6dc02fd83-7027d.png" data-srcset="/static/2022-06-15-14-01-31-1095413faf7395ae3e2f26a6dc02fd83-55fa9.png 200w,\n/static/2022-06-15-14-01-31-1095413faf7395ae3e2f26a6dc02fd83-7027d.png 300w" data-sizes="(max-width: 300px) 100vw, 300px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果你觉得没什么关系的话，使用什么取决于你自己。</p>\n<p>还有一件事就是注意当 lowerBound 大于或等于 upperBound 时 smoothstep 方法会产生 undefined。它们值相等和之前的情况一样，多出的问题是 lowerBound 大于 upperBound 时，但是对于正常的聚光灯这种情况永远不会出现。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——光照/index.md absPath of file >>> MarkdownRemark",timeToRead:14,frontmatter:{date:"2022-06-07 14:38:03",path:"/webgl-fundamental-light/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——光照",draft:null}},{excerpt:"…",html:'<h1 id="技能要求"><a href="#%E6%8A%80%E8%83%BD%E8%A6%81%E6%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技能要求</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-20-23-40-33-c573d213bf4b48be7fe1974eb4f37e6c-72abb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.410182516810764%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB7ElEQVQoz32TW3ObMBSE/f9/Vx+aTqdpbNeOb/ENG+MQjAToitiuwG0ymU4fDiNp0PKdPcvIhQ6mBbTvoGK5DoVq8XipsboZ3BxgnUKnLjCnB/jbmgcSna0Bz/NWswzLoQseI9e+C9YUq22A5F5anlUNdHaFuVJsvx1EzA2dEVxTlB/CZ0F7F4x0yzeFZWlQpq9QhyOa1RLieYZqs4aYTgik+kteJjDZI3x1AoJF56OovRMG/CWUXAgPNEkCtV5C7rZsM4G7pFAvG4jdDnyNGjU6fRuI/xCGT4RRsC+uXdOQbA57PkEfD6i2L3DJEdVyAWXu7fUemt5DUDB4i8DzUZJmoAb2QmOeN5D00dc1xGTSk4nNCpJ09X4HQwtknoOQcMWK3o4J+MZdh+/fvmI+m2JkXNsTxmGUXDQevVdi9gsuPaPhMAQ9tGw9tl1nGa8HBFUMw/FNT2h0DWv04KGObfuhdNyfz6hJVpEqisaypC3HTzBpSqKWEx6Eeg/ZOh+slh5+yOG6UFgwe+XpAs2BVItniPkMkt6VJG74geAMvNhzyj/RqrwXjT6Gf+VQsm1hmEOGOQa81ZoXM5j8FfpwIJUdwswJB13cKf8TbHWfdMFRj68K01yhZCcu5kxlnPgXtv6DB4yNe/9T8EHwNxW8Tu4qLIieAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 20 23 40 33" title="" data-src="/static/2022-05-20-23-40-33-c573d213bf4b48be7fe1974eb4f37e6c-fee1c.png" data-srcset="/static/2022-05-20-23-40-33-c573d213bf4b48be7fe1974eb4f37e6c-a67b7.png 200w,\n/static/2022-05-20-23-40-33-c573d213bf4b48be7fe1974eb4f37e6c-0b187.png 400w,\n/static/2022-05-20-23-40-33-c573d213bf4b48be7fe1974eb4f37e6c-fee1c.png 800w,\n/static/2022-05-20-23-40-33-c573d213bf4b48be7fe1974eb4f37e6c-72abb.png 1041w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="显性技能"><a href="#%E6%98%BE%E6%80%A7%E6%8A%80%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>显性技能</h2>\n<h3 id="图标设计"><a href="#%E5%9B%BE%E6%A0%87%E8%AE%BE%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图标设计</h3>\n<p>即出现在界面中的图形标识符号以及应用的启动图标。图标虽然有大量的素材可以用，但是想满足项目自身需求、风格统一的图标，基本只能依靠独立绘制来完成。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-20-23-42-25-af38dd2a1835c75a3611dd10b56eb199-ad2c1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.069274653626735%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABaElEQVQoz0VRS44VMQzsm3OHkWDBggWIFSBWnGAuwXYkBh7pTidO4tiO88H93gKrYiWWyy47249vX94/PX149/br508KoWd4YGAatXSqhnF5UqYuBlFp2pqqbhPzwCIQWzjpPAw1eIonQxQInEFK4pwoAaX7JadqKLkSbl11Ms2a51qMhWqdc47e51xUMpe8Lpvrv83H04hbW6s9f5ePb6QPYTKymDG3JnDsaP0jURGXkVGZR4te2UM9uo7N8jn6+vKTK14suvgGG+l0fyH4fhZK6EixMrKid4qhWAntm+XZ7NQaM4uYl3sVNrJzt3ic+wo48kL5ReyEVnlpqasf0mWzTrY668h3qUazY8Gh/ba7Hfy4SY0M3PdbPH1KuwiWJZ6bbtVEmlJE83xHTgli6K39OQ4HYaVuvxFJM1QsXKFprasEMtkm82rMDADGtx+81Kv03l2Me4Jrv/Na737sr79fLf5Yug32D64lAqVWE9ItAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 20 23 42 25" title="" data-src="/static/2022-05-20-23-42-25-af38dd2a1835c75a3611dd10b56eb199-fee1c.png" data-srcset="/static/2022-05-20-23-42-25-af38dd2a1835c75a3611dd10b56eb199-a67b7.png 200w,\n/static/2022-05-20-23-42-25-af38dd2a1835c75a3611dd10b56eb199-0b187.png 400w,\n/static/2022-05-20-23-42-25-af38dd2a1835c75a3611dd10b56eb199-fee1c.png 800w,\n/static/2022-05-20-23-42-25-af38dd2a1835c75a3611dd10b56eb199-b1a91.png 1200w,\n/static/2022-05-20-23-42-25-af38dd2a1835c75a3611dd10b56eb199-ad2c1.png 1227w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="界面设计"><a href="#%E7%95%8C%E9%9D%A2%E8%AE%BE%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>界面设计</h3>\n<p>输出界面的视觉能力，我们定义的界面视觉能力是在不受外力干扰下，你可以输出符合规范、基本交互、平面要素的美观界面，简称就是飞机稿输出能力。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-20-23-44-53-418bcf45e1bfe3ca6309a5f97bd352cd-c849b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 85.01529051987767%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsSAAALEgHS3X78AAAEGElEQVQ4ywENBPL7AM3Ew6ijoLaxsKmmpMK+vP/9+v76+P/7+v/8+/76+fz59/z49/z6+Pv6+fz7+vz8+/z9+/v9/fz+/fz//QDm3t3a1tTV0tHU09HX1tTa2tjS1NXV19fa29rn6Ofx9fXy9/X0+vbv9vbo8vbn8fXr9Pbw9vfw9/ju9/kAKyorCAgGHRwZICAkDg4PDAwMNi8lKyceAAAAWFlY1fP/mcn4jLn2oMj2t9f2t9PznsTxgrbxgbHxrcv0AB4eHgwLCTU1NiUlLhgYHhUWFJJrSmtMOAAAAEpPTMnr/laQ7jZy6XSg7MfX58jc9bjS7bLV9q/O9avH7gAgISAAAAE6MjREOiw1LCItKShMRjlWQzAJAABCS0jA4/lgluthot9znuquzOeVv+rL2+r89/rt7feux+oAISIhAAAASzctWUg2QTUrJB4XPj0YNTQiAAAAQUpGu9/1WZDsR4jkbpjjf4SSeYOXx9Pi9/n86O75qMLnACMkIwAAAC0kIVk8MGFMNyMfHxcTFSUkKAAAAEBIRLjc82OT7UV553ui6trf4Nfd5NLb6OTq89zn+qbA5QAfIB8AAAAaFRNKPDMzLi0VFhoeGhQlIiAAAAA/RUK52/NqmvBYiuyWtu3y8/nw8fvR2+jk6fXb4/WjveUAMTIyCAkIDhEUHSAiHB0ZDA8SJSMZIB8ZAAABTlZTvd70psz1osbwpMXsrsbnrcXlnrrimLTgl7Plor3qAM/U0b3FxLXCv626t6u6t6y7tqm5uK69vLTBvr/PzcfX18LP0b3NzbrLzbrN0bjL0LfLz7jN07vP1cTU1wDv8uzq7uPp7eLl6t7y9O/////p6+Pi5tz3+PDi7enIyMHPwrfVysC/tKl/d258d26olom7l4S4l4TJwrcA1NvNnq6ImauCv8my5eTl5OPf1tvUjJWDuLyu4u7rxcjC08rD3dbQraiiLTEqMTgxbllKdEgxe0gvxrqwAM3WxZilepSgcrvGrvPw8uDf1c/VyJ2im6isn9zq5cTIw8jAubm3s6+qo0BBNUJIPXJbTHRVQn9TPsO3rQDL18WZm3abmHK8y67q4t3y8vLk6ObCt6zYyr7e7ezDyMKupZ55bGGopZ48NitCOzNyWUqRWj+RWDzAt60A09nNbXxcd4lnnKaS8fLw6ejj1NbRwLm06N7X3Ovpv8W/t6ecf3FnqqagIiQhLS8pclpJqmJBnFs9vrWsAOvu6ebp5Nvf1tPWzc3TwMTLtMzPw9XW1P79/Nvn5L3AudLHvuDX0LCpojc5MTk/OXZdT61tUKJoTcC3rADo7Ojy9PPr8O3m7Obf5uHf5uHe5d/Z4dfu8vDZ5uTDycTJw7zHxLzAvrewrqivr6i6trDAurLBu7LIycTrCHxzRTKNFwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 20 23 44 53" title="" data-src="/static/2022-05-20-23-44-53-418bcf45e1bfe3ca6309a5f97bd352cd-fee1c.png" data-srcset="/static/2022-05-20-23-44-53-418bcf45e1bfe3ca6309a5f97bd352cd-a67b7.png 200w,\n/static/2022-05-20-23-44-53-418bcf45e1bfe3ca6309a5f97bd352cd-0b187.png 400w,\n/static/2022-05-20-23-44-53-418bcf45e1bfe3ca6309a5f97bd352cd-fee1c.png 800w,\n/static/2022-05-20-23-44-53-418bcf45e1bfe3ca6309a5f97bd352cd-c849b.png 981w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="动效设计"><a href="#%E5%8A%A8%E6%95%88%E8%AE%BE%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动效设计</h3>\n<p>在输出静态页面基础上，丰富使用体验的手段。通过增加一些有趣、简单的动效，来让操作效果更生动，或者作为情感化设计的一部分。</p>\n<p><html><head></head><body><video data-src="/examples/ui-introduce-learning/2022-05-20-23-50-38.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></video></p>\n<h3 id="项目设计"><a href="#%E9%A1%B9%E7%9B%AE%E8%AE%BE%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目设计</h3>\n<p>在项目设计中，抛开产品、体验这些内容和基本视觉样式，最让人关注的东西是对项目设计规范的搭建与应用。如何在多个页面中保持视觉风格的一致性。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-20-23-57-08-cfab8d81b97709e3133d8505fe2b90fa-fc63d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.893223819301845%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAACZUlEQVQozx2SS08TYRiF5y+4MCYu/Ae60x/gUjcmxg0uXLkzEnBjNNFESbpoUGBF5JqIVuRiCCCIXKQFQqGWllg6LbRTei+9zEwv02k78PjRL3nybd7kPe85R5p1fGVxZgbH+Bgr8wtgGFgVHatapnX518qCChfNRhtaLbg4x2o0odHi3GphtWliXVhI+dMI8fARpXiUrOwnI1BTSdR0ClMrYahFTF1FVSIUY1FOwzKy/xC1oBBXFTInETLRKJlMibN0Eam/5w1P7txi0P6O5XEbsmeTqBjYcrnQNY3LZwqFvqVNQjtBHt67z9Ur14i6v7GQWSOXzKLlssyvxVic9SHNTTp4cOM6w/19GKZJPJEiKMuEw2GxNU293qCmZ/nx6Zixtym+jIxg//CRs98ucUkBW28vzzs7icZOKRQKSKquEYuctJUExTn2l89wDPahV6pUBC3rHOU4RCocRcuqmPU65zUDvWog3MRms/Giuws5qRFQdCT3+jLefQ/TM7Osb6wyYO/haUcH4YjCP99fvHtuXC4nKeVEhFLHt7HN1sAQyUSSE4+fRi3bFnOQMPlzVEIaetvFwswUu3t7lIoFHnU85ubtu0xNT/J5oIfFiQkKIhS3nCacg6GR74wNTxBYdeGeW6FUqaCXS1SqVcpGBan7dQ/jo6NkEkp708/FeZxOFznhn3NtiSPPDiGRcCBRJJ6z8PiP8B/s41lKsDqZwRRVaooqGYZJUS8jvXpvx727zaHPS0mkWhMe5YW5DctibfUXcsDPcSpFOpumJSpULhbRvCHy6QKKP8hZLi9U1lDLZZS8zn8N/mqTTDXPBAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 20 23 57 08" title="" data-src="/static/2022-05-20-23-57-08-cfab8d81b97709e3133d8505fe2b90fa-fee1c.png" data-srcset="/static/2022-05-20-23-57-08-cfab8d81b97709e3133d8505fe2b90fa-a67b7.png 200w,\n/static/2022-05-20-23-57-08-cfab8d81b97709e3133d8505fe2b90fa-0b187.png 400w,\n/static/2022-05-20-23-57-08-cfab8d81b97709e3133d8505fe2b90fa-fee1c.png 800w,\n/static/2022-05-20-23-57-08-cfab8d81b97709e3133d8505fe2b90fa-fc63d.png 974w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="标注切图"><a href="#%E6%A0%87%E6%B3%A8%E5%88%87%E5%9B%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>标注切图</h3>\n<p>最后，就是前面这些内容都输出完了，需要将设计的内容提交给程序员进行样式的开发，那么就要实现对设计内容进行标注和切图文件的输出。</p>\n<p>显性技能对于新手来说，最大的优点就是知识点是相对固定的，练习方法也是固定的，只要通过刻意练习的方法，就可以积累和提前。</p>\n<h2 id="隐性技能"><a href="#%E9%9A%90%E6%80%A7%E6%8A%80%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>隐性技能</h2>\n<h3 id="理解规范"><a href="#%E7%90%86%E8%A7%A3%E8%A7%84%E8%8C%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>理解规范</h3>\n<p>没有规范是必然输出不了界面的。但移动端的设计规范，并不是你们想的官方准备个文档，里面数值写清楚了，你背下来就行。而是理解哪些规范是必须要遵守的，哪些是可以灵活变动的（而可以自定义的是大多数）。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-21-00-01-06-8cded41a8f264a65140d5dc9fcf613c0-c849b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.361875637105%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4klEQVQoz1VS3WrVQBjMG/gWvpKv4RsIvkIvREGFc6NQ9NIfhFbBi0Nr7Y1a/PccymlPkv3fZJPdzRlnUwr6wZDNbna+mclXHb58gcWD+1geHgChQzQKyWokZ5C9Re4ccu+JHjkETENAJnZjxHXFcUSKESknVIMUiFqhPINoESTR1OhEg04JDGwwg028UnBSojcGrb7E8vMRjo9OEdjYWcJ7VJaHkczXlbHDgP8rOIueF7T1MFxjBPa+LHBrcRtPnr6G9mW/g1AG1Y5SzUWN1XqNkCJ23MTdhzhZvsGBO8NEu54OdFtD85LreijjUGuNPO3mhkpbBMYhpEY1pYTEPHp+WKr5+Qd3btzEo8fPcNK+Z55voaWF2NaYMiC1x7YVsFTb8Y51HpINfD/wjAoTVfVkj1SaSW67Dq8+foBoqXSYUDSotsW38+/4JL9iLS9hjad9i5Z5CqVJZBE7OrEkLER13RA1nHMzsWra+T2MV2k2QuDs/Ac2poa0Dhd1O5MZrm2JocBYNFKhysXHP5Wo0jCfMgY5X51tmeGKOQ/9iHEYqaqos7Ahwo8JGxLOP4UNqpGWI0kGEhR4zpuiHc8YHNdpmrAphA3HiHtd6LGVBuvmN/S759i/t8Lery0E51byb/8F9p2oAXnduEQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 21 00 01 06" title="" data-src="/static/2022-05-21-00-01-06-8cded41a8f264a65140d5dc9fcf613c0-fee1c.png" data-srcset="/static/2022-05-21-00-01-06-8cded41a8f264a65140d5dc9fcf613c0-a67b7.png 200w,\n/static/2022-05-21-00-01-06-8cded41a8f264a65140d5dc9fcf613c0-0b187.png 400w,\n/static/2022-05-21-00-01-06-8cded41a8f264a65140d5dc9fcf613c0-fee1c.png 800w,\n/static/2022-05-21-00-01-06-8cded41a8f264a65140d5dc9fcf613c0-c849b.png 981w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="交互思维"><a href="#%E4%BA%A4%E4%BA%92%E6%80%9D%E7%BB%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>交互思维</h3>\n<p>如何让产品和界面操作起来合理的思维能力。平心而论，这种能力是只能依靠自己的 “多学多看” 积累的。交互书籍带来的帮助只是解释你留意到的现象原因，但不会告诉你遇到问题的时候具体应该怎么做。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-21-00-03-09-6da6b58e0ef962b15e0d29f037816221-240b7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.752302968270214%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABsElEQVQozyWQTWsUQRCG50969eRN8JSf4NGzHkUCHkTwkptERBCDkgSyOzubmZ3vme7q7qr+mpn9yK4kvZvioah64eWlKrq8uPj44f3Vzx+Pu+2DM4fBHZmG/4H1dFivD5sT201gv9vud7uHU+33h2hnaFJylMIDd5yF7gUMQUG11rSxZuPd2ppRa6/1ZM3k7BjWwU3jGBGeSikplVJaKrLGhPUocmYQG4VApPyA48iQGiFBmxKAjImevZrIe4dQEeTeKs4Yag1NJTgvmoZLNYvjQAeyrOsSZJzliih6TjwGA2Ndxfuas6bve9K6K3LWdTXjkuj3PP27SCuh5jWThHHDE4ZRsGnjjPWhIznSToigeOvGYpW1XcuR/OBvahmDzVp2uezCSXFeXZUikgoHw6Evqqq02FrqrRsMdlp1SZa1nEnryDke3mJd2rLreQxISV6E/EihcTKr05v7JIbimpUzqYxo5qKeJ0W1ZCxZFbcN3C1TrfW3X/9evHp9v1p9Oj/P2zaYEZRmAkFix4+zUKoD5ALTtomZuF0sv6/g7O27z1++/pktXr45C4e0HBjRE2+g4xSujOKuAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 21 00 03 09" title="" data-src="/static/2022-05-21-00-03-09-6da6b58e0ef962b15e0d29f037816221-fee1c.png" data-srcset="/static/2022-05-21-00-03-09-6da6b58e0ef962b15e0d29f037816221-a67b7.png 200w,\n/static/2022-05-21-00-03-09-6da6b58e0ef962b15e0d29f037816221-0b187.png 400w,\n/static/2022-05-21-00-03-09-6da6b58e0ef962b15e0d29f037816221-fee1c.png 800w,\n/static/2022-05-21-00-03-09-6da6b58e0ef962b15e0d29f037816221-240b7.png 977w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="团队协作能力"><a href="#%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C%E8%83%BD%E5%8A%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>团队协作能力</h3>\n<p>我们如何有效的理解设计的需求，将设计的意图传递给别人，高效的评审和过稿，都是团队协作能力的体现。</p>\n<h3 id="审美水平"><a href="#%E5%AE%A1%E7%BE%8E%E6%B0%B4%E5%B9%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>审美水平</h3>\n<p>是一个设计师的品味。品味的高低是可以在作品集中感受出来的，怎么布局，怎么用配图，怎么选用设计风格。审美的落差很多时候可以填补技术上的缺陷。</p>\n<h3 id="理论掌握"><a href="#%E7%90%86%E8%AE%BA%E6%8E%8C%E6%8F%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>理论掌握</h3>\n<p>基本上上面所有讲过的细分技能点都有各自的理论、术语。设计领域中，不管多有用的理论，脱离实践都毫无意义。理论掌握的正确时机是在实践过程中查找并融汇贯通的。</p>\n<h1 id="资料准备"><a href="#%E8%B5%84%E6%96%99%E5%87%86%E5%A4%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>资料准备</h1>\n<h2 id="软件"><a href="#%E8%BD%AF%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>软件</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-21-00-11-18-67808ca8189aa95d4e51431a004b4f36-a45cc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 35.19837232960325%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAB2ElEQVQozzWRz2sTQRTH9+RNwX/Akwd704t49eyhB8GCBykqBkE8KOpFFDzloqVW21piraTQWn+gGOuPNrbGFTVoqNSIFCUxTWqyye52k2az2V8fXxKc4cubN2/eZ96bUdTkIs8fP2ThRYL45F0eTMfR/5bAdwmcFmHbgTDoKpC90PdlGRCGYVf/hy9xT3zFa9RxGxblQr5rg1aT0HEE1AbXRShs6jW26pZAO9ywJ4F0gG05VzONru+LFHwHv2GSSX+m3XJ613kCIsDxev7K6k9yf0q9kMxOsieVdgCG6/ExnaZYqWLZLZTI1REGzkd5OjvHlSOHGL98ibYAZydiRCNnePdeha010S+S02+4dvACyamXSP00v2dhNUNi4Rt9ey5yKjKGsm3fYZT9xzlxdJCB7QrH9u5Gq2hEBLar7wCjt8chO0c9+4TR07c4pwwSO3kTHYfm1wwsvWL4zjw7d5ylv/86yuyjZwxPTJFaTnHvxhCJmRlMXWdJTTE0NsInaWejUmG9vMGHtyr3ozHURRXNMtGlxXKjwcqPNSbj87xe/oJiyYN2AIZhUDXEbprY8rtN26aqGxiS8LtQIFcsUncdNNvCdGws+Yz1ao18uULJMMlrZXJahX/b5d/c493sdAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 21 00 11 18" title="" data-src="/static/2022-05-21-00-11-18-67808ca8189aa95d4e51431a004b4f36-fee1c.png" data-srcset="/static/2022-05-21-00-11-18-67808ca8189aa95d4e51431a004b4f36-a67b7.png 200w,\n/static/2022-05-21-00-11-18-67808ca8189aa95d4e51431a004b4f36-0b187.png 400w,\n/static/2022-05-21-00-11-18-67808ca8189aa95d4e51431a004b4f36-fee1c.png 800w,\n/static/2022-05-21-00-11-18-67808ca8189aa95d4e51431a004b4f36-a45cc.png 983w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="图形软件"><a href="#%E5%9B%BE%E5%BD%A2%E8%BD%AF%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图形软件</h3>\n<p>主要指的就是 Adobe 的 PS 和 AI，用来处理复杂图形样式的软件，例如复杂的图标、字体、H5 视觉等。是每个平面相关设计师都绕不开的两座大山。</p>\n<h3 id="界面软件"><a href="#%E7%95%8C%E9%9D%A2%E8%BD%AF%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>界面软件</h3>\n<p>设计 UI 界面和排版的专用软件。目前市场主要使用的工具有 Sketch / Figma / Adobe XD 三个，Sketch 只支持 Mac 系统，Adobe XD 因为更新太慢功能太少，已经不建议再花时间了解。所以主要建议从 Figma 开始学习。</p>\n<h3 id="动效软件"><a href="#%E5%8A%A8%E6%95%88%E8%BD%AF%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动效软件</h3>\n<p>用来处理交互动效的工具。新手多数以为动效必须由 Adobe Effect 来完成，其实它最适合制作的是动效中的矢量动画，但不能输出完整的动效原型。目前市面上做的最好，Windows 也支持的动效工具是 Protopie，掌握它就可以忽略类似 Principle、Origami 等其它同类软件。</p>\n<h2 id="材料准备"><a href="#%E6%9D%90%E6%96%99%E5%87%86%E5%A4%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>材料准备</h2>\n<h3 id="规范"><a href="#%E8%A7%84%E8%8C%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规范</h3>\n<ol>\n<li>IOS + 安卓官方规范</li>\n<li>字体文件，包含苹果官方要求的苹方中文字体，SF 系列英文字体，以及安卓的思源黑中文字体，以及 Roboto 英文字体。</li>\n<li>常用的图标素材库，iconfont 和 iconpark 两个网站，它们提供了大量的开源图标素材，可以直接应用。</li>\n</ol>\n<h3 id="书籍"><a href="#%E4%B9%A6%E7%B1%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>书籍</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-21-00-26-34-4857b9bcb4add8c0fc29897d90063b9c-918f8.jpg" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 131.25%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAAAAEDAgQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQIA/9oADAMBAAIQAxAAAAH09aoKGacy60MyhR//xAAcEAABBAMBAAAAAAAAAAAAAAACAAEDERASISL/2gAIAQEAAQUCGX2M2yA9mvqZ+X1pEJW2f//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/ASn/xAAXEQEBAQEAAAAAAAAAAAAAAAABACEx/9oACAECAQE/AYR0kXkX/8QAHRAAAgAHAQAAAAAAAAAAAAAAABEBAiAhMTJBYf/aAAgBAQAGPwKZ2Xpr0aRFymDBGxr0xR//xAAbEAADAQEAAwAAAAAAAAAAAAABESEAMRBBUf/aAAgBAQABPyECZEgT1htQSYzx3w4q5IcndPjP9GKsA3EJo5ai5Dz/AP/aAAwDAQACAAMAAAAQtCXA/8QAGBEBAQEBAQAAAAAAAAAAAAAAAQARITH/2gAIAQMBAT8Q0BEjTjAPSXXl/8QAGBEBAQEBAQAAAAAAAAAAAAAAAQARMUH/2gAIAQIBAT8Qe7A+DdhkEMXb/8QAHxABAAICAgIDAAAAAAAAAAAAAQARITFBUXGBkaHw/9oACAEBAAE/EArlaOsuBn2FG8Of3ctJsOWUkgRF/KFVouYVxsSogMBCysRNU0Kb96iKrRFR6D4iHRADRP/Z\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 21 00 26 34" title="" data-src="/static/2022-05-21-00-26-34-4857b9bcb4add8c0fc29897d90063b9c-dfbfc.jpg" data-srcset="/static/2022-05-21-00-26-34-4857b9bcb4add8c0fc29897d90063b9c-75a98.jpg 200w,\n/static/2022-05-21-00-26-34-4857b9bcb4add8c0fc29897d90063b9c-1f451.jpg 400w,\n/static/2022-05-21-00-26-34-4857b9bcb4add8c0fc29897d90063b9c-dfbfc.jpg 800w,\n/static/2022-05-21-00-26-34-4857b9bcb4add8c0fc29897d90063b9c-ca27a.jpg 1200w,\n/static/2022-05-21-00-26-34-4857b9bcb4add8c0fc29897d90063b9c-918f8.jpg 1280w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="软件-1"><a href="#%E8%BD%AF%E4%BB%B6-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>软件</h1>\n<p>以下都是使用即时设计</p>\n<h2 id="apple-music-界面输出"><a href="#apple-music-%E7%95%8C%E9%9D%A2%E8%BE%93%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Apple Music 界面输出</h2>\n<ol>\n<li>安装本地字体助手，之后可以看到本地字体</li>\n<li>可以从左侧拖动标尺出来，标尺显示、隐藏快捷键 <code class="language-text">shift + r</code></li>\n<li><code class="language-text">alt + 鼠标左键</code> 拖拽复制一个元素出来</li>\n<li>长按 alt 键鼠标悬浮可以看到间距</li>\n<li>鼠标框选选中多个元素</li>\n</ol>\n<h1 id="规范-1"><a href="#%E8%A7%84%E8%8C%83-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规范</h1>\n<h2 id="ui-规范是什么规范"><a href="#ui-%E8%A7%84%E8%8C%83%E6%98%AF%E4%BB%80%E4%B9%88%E8%A7%84%E8%8C%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UI 规范是什么规范</h2>\n<h3 id="规范类型梳理"><a href="#%E8%A7%84%E8%8C%83%E7%B1%BB%E5%9E%8B%E6%A2%B3%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规范类型梳理</h3>\n<p>很多人都知道学 UI 有规范，苹果的规范，安卓的规范。但是，多数人并不清楚这些规范到底是什么，有哪些，以及它们的作用、意义、内容。</p>\n<p>规范一词，可以解释为——某一行业或者行为进行定性的信息规定。它不是数学定理，而是人为制定的条件、规则、约束、限制。</p>\n<p>在从事 UI 设计师这个职业，掌握规范，就是掌握界面设计的必备条件、规则、约束、限制有哪些，确保自己做出来的东西具备可用性的，而不是毫无实现价值的飞机稿。</p>\n<p>而职业相关的规范，并不是只有苹果、安卓规范叫规范，而是包含好几种类型的规范需要我们去了解。</p>\n<p>我把它们分为下面这些类型：</p>\n<ol>\n<li>计算机规范，指的就是计算机领域的部分基础常识。有一部分知识是设计师也必须掌握的，例如图形成像、图形文件格式、字体显示原理等。</li>\n<li>硬件规范，主要指的是硬件上的特性对设计产生的影响。例如电容屏和电阻屏的操作差异，视网膜屏和低分屏的显示逻辑，折叠屏的操作和适配方式。</li>\n<li>系统规范，则是不同软件系统开发者制定出来的规范原则。系统级规范大到硬件底层系统，比如 Windows、Mac OS、Android，小到一些开源框架或软件系统，如 AntDesign、Element 等。</li>\n<li>视觉和交互规范，则是在视觉和交互领域中的一些必要规则和限制。比如视觉统一性的要求，最小可点击区域等。</li>\n</ol>\n<p>这两类规范我们会在后续的分享中一点点加入，本篇内容将围绕前三者展开。</p>\n<h3 id="学习规范的方法"><a href="#%E5%AD%A6%E4%B9%A0%E8%A7%84%E8%8C%83%E7%9A%84%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>学习规范的方法</h3>\n<p>分为 2 种即规范（强制）和建议（非强制），其中建议类规范占大部分，所以需要把规范记住，建议作为一个思考的方向</p>\n<h2 id="基础规范的扫盲"><a href="#%E5%9F%BA%E7%A1%80%E8%A7%84%E8%8C%83%E7%9A%84%E6%89%AB%E7%9B%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基础规范的扫盲</h2>\n<h3 id="屏幕和分辨率"><a href="#%E5%B1%8F%E5%B9%95%E5%92%8C%E5%88%86%E8%BE%A8%E7%8E%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>屏幕和分辨率</h3>\n<p>首先，UI 设计师产出的内容，都是在电子屏幕中显示的，是数字化的图形，而不是要打印喷绘出来的三维世界实物。所以，屏幕显示规则决定了图形的显示方式。</p>\n<p>电子屏幕成像的基本原理，即一块完整的屏幕由若干像素点组成。屏幕分辨率的参数，如 <code class="language-text">1920 * 1080</code>，指的就是这块屏幕 XY 轴包含的像素点数量。</p>\n<p>像素点是图像显示的最小单位（通道不算），每个像素点可以显示一个颜色，我们看见的电子图像，就是由这一个个色彩的 “小点” 拼装而成。</p>\n<p>随着技术的进步，屏幕分辨率越来越高，以及增加了子像素渲染技术，让我们看到的图形越来越细腻、清晰。</p>\n<p>而 iPhone 4 问世后更是带来了 “视网膜屏” 技术，3GS 使用 320480，而 4 使用 640960，像素密度提升了一倍，总量提升 4 (22) 倍。再到后来的 iPhoneX，屏幕密度再次提升一倍，总量是原来的 9 (33) 倍。</p>\n<p>那么这时候问题就来了，这些数值差距那么大，我们创建画布要以哪个参数为标准？真实项目里，我们是不是得每个尺寸做一套？</p>\n<p>在这里，我们不做过于专业的技术科普，大家只要牢记一点，在 iOS 和 Android 开发中，是没有 “像素” 这个单位的。</p>\n<p>苹果用的长度单位叫 PT，安卓的是 DP 和 SP，这些单位具体内涵大家不用去纠结，本质上它们只是一个符号、矢量单位，没有任何区别。</p>\n<p>这种单位的价值，就是可以统一一套数值体系，并运用在任何不同密度的屏幕中去，系统会自动完成对屏幕实际显示像素的换算和显示。</p>\n<p>例如，我们在 iOS 中制定了一个长宽 44pt 的图标，那么它在 3GS 中就是 1:1 的显示状态，即 44px。如果在 iPhone 4 中，就是 1:2 的状态，即 88px，在 iPhone X 中，则是 1:3 的 132px。</p>\n<p>换算成几倍，以及换算依据是什么，前期可以不用深究。只要知道用 PT 给出的数值是万能的，程序员写代码用这个单位，系统也根据这个单位计算像素值。</p>\n<p>我们在 Figma / Sketch / XD 创建的画布，实际上就是以 PT 为基础（矢量）。如果我们要输出不同屏幕密度的图像，就可以在导出面板选择导出 1x、2x、3x 的倍率即可。</p>\n<h3 id="矢量和位图"><a href="#%E7%9F%A2%E9%87%8F%E5%92%8C%E4%BD%8D%E5%9B%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>矢量和位图</h3>\n<p>上面我们说了 PT、DP、SP，本质上都是一样的东西，单位可有可无。主要的原因，就在于矢量和位图之间的原理差异上，它们是计算机领域最重要的两种图像类型，</p>\n<p>简单点说，矢量图是通过代码绘制出来的图形。比如代码指定了一个圆，那么系统就就会按圆的显示规则去解析它。而位图，则是去记录一定像素区域内，每个像素显示颜色的格式。</p>\n<p>所以，如果用矢量和位图格式分别画个圆，那么持续放大，就会发现矢量边缘依旧平滑，而位图的圆则边缘出现了深浅不一的 “锯齿”。</p>\n<p>之所以有这种差异，就是因为对于系统来说，它解析矢量文件是接受了我要 “画个圆” 的指令，不管放大还是缩小，它都按圆的方式显示。而解析位图，则仅仅是把位图中的像素色彩信息展示出来，它本身包含的了多少像素色彩信息，就显示多少。</p>\n<p>所以，矢量图形可以随意进行缩放，不会有显示上的问题。而位图因为包含的色彩信息是固定的，就没办法支持无损的放大。</p>\n<p>在矢量的世界里，也没有具体的度量单位，图形和图形之间的大小关系是比例关系而不是尺寸，只是根据我们显示的需要，它再被转换成像素呈现。所以不管是 PT、DP、SP，都没有本质区别。</p>\n<p>既然矢量可以随意缩放，位图还有什么存在必要？</p>\n<p>矢量并不是万能的，它记录图形的信息是非常有限的，适用于有明确几何关系和色彩简单的图形，比如图标、文字、扁平插画。</p>\n<p>而复杂的不规则图像，或者包含渐变、投影元素，都没法用矢量来完成，如照片、还是必须使用位图来记录才能正常显示。</p>\n<p>矢量和位图的认识涉及到项目方方面面，需要慢慢理解它们的差异和使用场景，包含切图导出格式，Lottie 动画逻辑，字体图标应用限制等。</p>\n<h3 id="图像文件格式"><a href="#%E5%9B%BE%E5%83%8F%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图像文件格式</h3>\n<p>图像文件格式，即在计算机中记录单个图像的文件格式类型、文件后缀。根据矢量和位图的区别也可以分成两个大类。</p>\n<p>首先说矢量格式，UI 中会涉及的主要就是 SVG 和 PDF 了。在 iOS 规范中，矢量格式图形要导出 PDF，而安卓中则使用 SVG。至于它们具体有什么差异，感兴趣的同学可以自己查找。</p>\n<p>除了矢量格式外，还有若干的位图，它们有各自适用的场景，我们分别介绍。</p>\n<ol>\n<li>PNG：无损的位图格式，可以显示透明背景，是 UI 位图元素切图的最佳选择。</li>\n<li>JPG：有损的位图格式，体积更小，但不能显示透明背景，适用于运营图片素材。</li>\n<li>GIF：可支持动画帧的位图格式，主要用来作为动效示意，或一些运营动画元素的素材。</li>\n<li>WEBP：近年新兴的格式，压缩效率较高，常用来作为逐帧动画的帧图形。</li>\n</ol>\n<h3 id="色彩模式认识"><a href="#%E8%89%B2%E5%BD%A9%E6%A8%A1%E5%BC%8F%E8%AE%A4%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>色彩模式认识</h3>\n<p>颜色是一门很复杂的学问，在具体学习配色前，更应该先认识颜色的底层规范——色彩模式。</p>\n<p>色彩模式是一种用来描述、记录色彩的方法，而不同场景，方法就不一样。为什么解释颜色还要用不同的方法？</p>\n<p>首先，最早系统研究色彩必然从自然界开始，我们总结了色彩的基本规律，由色相、饱和度、明度构成了色彩的三个基本要素，即 HSB 色彩模式。</p>\n<p>HSB 是描述自然界所有颜色的方法。但是，随着人类的工业、化学技术提升，以及彩色屏幕的发明，对颜色的需求和应用就越来越广泛。</p>\n<p>在专业的染印领域，形成了由青(Cyan)、红(Magenta)、黄(Yellow)、黑(Black)四种颜料作为基础调和其它色彩的体系，也就是我们常说的 CMYK 模式。</p>\n<p>而在电子屏幕中，每个像素，由红(Red)、绿(Green)、蓝(Blue)三个不同发光二极管的发光强弱来组合成一个颜色的，就叫 RGB 模式。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/UI入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:6,frontmatter:{date:"2022-05-20 23:22:56",path:"/ui-introduce-learning/",tags:"UI, 读书笔记",title:"UI入门学习",draft:null}},{excerpt:"设计原则 引言 对比（Contrast） 对比的基本思想是，要避免页面上的元素太过相似。如果元素（字体、颜色、大小、线宽、形状、空间等）不相同，那就干脆让它们截然不同。要让页面引人注目，对比通常是最重要的一个因素，正是它能使读者首先看这个页面。 重复（Repetition） 让设计中的视觉要素在整个作品中重复出现。可以重复颜色、形状、材质、空间关系、线宽、字体、大小和图片，等等。这样一来，既能增加条理性，还可以加强统一性。 对齐（Alignment…",html:'<h1 id="设计原则"><a href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设计原则</h1>\n<h2 id="引言"><a href="#%E5%BC%95%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>引言</h2>\n<h3 id="对比（contrast）"><a href="#%E5%AF%B9%E6%AF%94%EF%BC%88contrast%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对比（Contrast）</h3>\n<p>对比的基本思想是，要避免页面上的元素太过相似。如果元素（字体、颜色、大小、线宽、形状、空间等）不相同，那就干脆让它们截然不同。要让页面引人注目，对比通常是最重要的一个因素，正是它能使读者首先看这个页面。</p>\n<h3 id="重复（repetition）"><a href="#%E9%87%8D%E5%A4%8D%EF%BC%88repetition%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重复（Repetition）</h3>\n<p>让设计中的视觉要素在整个作品中重复出现。可以重复颜色、形状、材质、空间关系、线宽、字体、大小和图片，等等。这样一来，既能增加条理性，还可以加强统一性。</p>\n<h3 id="对齐（alignment）"><a href="#%E5%AF%B9%E9%BD%90%EF%BC%88alignment%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对齐（Alignment）</h3>\n<p>任何东西都不能在页面上随意安放。每个元素都应当与页面上的另一个元素有某种视觉联系。这样能建立一种清晰、精巧而且清爽的外观。</p>\n<h3 id="亲密性（proximity）"><a href="#%E4%BA%B2%E5%AF%86%E6%80%A7%EF%BC%88proximity%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>亲密性（Proximity）</h3>\n<p>彼此相关的项应当靠近，归组在一起。如果多个项相互之间存在很近的亲密性，它们就会成为一个视觉单元，而不是多个孤立的元素。这有助于组织信息，减少混乱，为读者提供清晰的结构。</p>\n<h2 id="亲密性"><a href="#%E4%BA%B2%E5%AF%86%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>亲密性</h2>\n<h3 id="案例一"><a href="#%E6%A1%88%E4%BE%8B%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>案例一</h3>\n<p>来看看下面这个企业名片的布局，这是一种很典型的布局。在这样小的空间里你看到多少个单独的元素？你的眼睛要停下来多少次才能看全这张名片上的所有信息？</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-1d472.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 732px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.09836065573771%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABV0lEQVQoz4VS2U7CQBTtZ6sx8UEhEaNGY0IQsWwvQjfp3jLQmXZmWqQWqB/kTNuwRWJycma7587dBEuRLE12zU9b1wxFcnQtTAKaReQ73CFFtqE5BVxrMp85pYGAyAwRgOgsjOeMYQTwEh4ody4K7N0IdBVxME9ZyLj6M0WHOJZV4nKhKxyvSZKTeEPiFU42JPmhfL/GSU75Mad0jeOckL2MBJwi9mCqktob+J4piz3P1V1TM+SxMhjKYnfUevOn1ke7o4hdYzyKFsFWX4ktVWqeX/cbT/3Gs9LrD+9fWhe1Tu1u3H5vXdbF+kPz7Ob16lasP0I8ZWkehI2XVWK4ZHbMisz5KzpVwkrMTUvOji2KWkb/ibPw7w5tvZR9KVrDCsxYwF+QY8lj49GeULLSQAwY2FywiQigBwkQPEc32YRZE9tQfc84+XOKpr7BJ8yeAOCwiQSB+wtjPfB73vAlNAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 48 37" title="" data-src="/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-1d472.png" data-srcset="/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-e9d85.png 200w,\n/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-b1edf.png 400w,\n/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-1d472.png 732w" data-sizes="(max-width: 732px) 100vw, 732px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>名片上的每一项看上去都与其他任何项没有关联。这样一来，首先不清楚从哪里开始读名片，另外不知道何时才算结束。如果对这张企业名片做一点调整——把相关的元素分在一组，使它们建立更近的亲密性，看看会发生什么。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-f67c7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 729px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.418381344307264%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABSElEQVQoz5WQ+U7CQBDGeWIfQBJjjELUkPCPUUKsB8jdc2m3pRftdrdbsFyG8DpOATEqJJh8mczszi8z8+XYhIBoGobM4wsGeZT4fE4h5wsaxl5AXZaS5CMm3I9GAXxtEFBulwnFklAovdyWhauSoYjV8+vHi5tuVaicFcsn+c5D9f70spIvvJXv+JzBsG84nka6Isq1mtZq6GLXxkh6ramNhm0grEi9p2fUbautJjT0xU48o78nw2KjJR+vRn5gKfU6VmUATCSjdguwIbHHqyRZcmjbszZLQ7pWNA5C5mbXMpckQ5L4Q+JASdfWbBb+A+80jeCKbcxKEs++8p/aB0+23Zlm9BB5EPY807H6A6w5tgHRdc3j4DQb6zoG1iSM5IGJDFm0DA0ej4XBHl3qgdUW1kxdDaj3j5vpexhEduY5GM59KPe2fQISde/Jf7k9YAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 51 24" title="" data-src="/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-f67c7.png" data-srcset="/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-c5342.png 200w,\n/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-4721d.png 400w,\n/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-f67c7.png 729w" data-sizes="(max-width: 729px) 100vw, 729px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h4>\n<p>如果多个项相互之间有很近的亲密性，它们就会成为一个视觉单元，而不是多个孤立的元素。就像实际生活中一样，亲密性（即紧密性）意味着存在关联。</p>\n<p>如果把类似的元素组织为一个单元，马上会带来很多变化。首先，页面会变得更有条理。其次，你会清楚地知道从哪里开始读信息，而且明白什么时候结束。另外，“空白”（字母以外的空间）也会变得更有组织。</p>\n<h3 id="案例二"><a href="#%E6%A1%88%E4%BE%8B%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>案例二</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-99df0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 25.815738963531672%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAqklEQVQY002PgQqDMAxE+//fp1XpRFGLgpVW3Jyi0z3MBh40XK5JLlHjOC7L8r6B1Dlnre26rmmauq77vr/XzPNMDCEo1PM8PzeQeu9pmKaJKW3bUic1x3FIJKVfybAoitI0TZIkjmOtNbyqKvRt2/I8z7KML/1HURTsi7/iYU7F44IxRuIwDPu+81WWpfRLpJNz1nX9ObPD68LzAgpcdDaEs7/oEDkT4PoF9LoXtf0N0lYAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 53 59" title="" data-src="/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-fee1c.png" data-srcset="/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-a67b7.png 200w,\n/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-0b187.png 400w,\n/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-fee1c.png 800w,\n/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-99df0.png 1042w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>请注意这两栏中的项目符号，看看它们和相关联的项目间的距离。中间的项目符号事实上离有些左栏的项目更近。看起来几乎就像是 4 个单独的列一样，其中有两列是项目符号。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-429c6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 25.865384615384617%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAsklEQVQY002PiQqDMBBE/f+vE4n1QpQiKijibb2SPrNQOpDJZHdn2DjDMHz+sG3bvu9t2xZFUZbl24Inxd/Muq6MYXS4jDHXdWmt7/vWFjT6vh/Hseu6uq6naZKuwFgQ4RBJtuu6YRgqpTzP830fjY0JotEviyAIlEWe5/M803rMVVVFUZSmaZIkCDjLMtmIeKnEcQwTgbNpmvM8HzMHtSwLQphfESzrwWjq8k/EcRy/tb/chBegA4NRcwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 54 55" title="" data-src="/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-fee1c.png" data-srcset="/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-a67b7.png 200w,\n/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-0b187.png 400w,\n/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-fee1c.png 800w,\n/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-429c6.png 1040w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>现在关系就清晰了，我们可以立刻分辨出哪些项目符号属于哪些项目，也可以马上看出有两列项目清单，而不是一列项目符号，一些信息，一列项目符号，再来更多的信息。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-032bb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 598px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 83.4448160535117%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC6UlEQVQ4y0VTyY4URxCdv/R/+OKLxcFcOcDB0pxsGUvIlgAhAZItGMkCBjEzPd3VPd21V3XXvnfte1Umr6oHLIVSkRkZ8eK9yDyjQ0aHfFpJRWlLKdZyMgIrKK3pWH0L1fehsZhSKDkjXTg2IaUJf8VePPscaFpsm7FjZb5Txa54zamMdLiT3/15ubxgEEocq0o92h8JGc7GNhrqiNL87sP29wdvX5//99ejf3798eWLJxfPH7/745c3129XKiP/9vObvx/9+/CHp+c/vXr/7JLSYhz6MzIcCcp0x6E5tkXUllFTBHngdmVUp0GTByg9tkds88hbvd9UiT8jxxTIZeg3aUjHuMrtwJXK1Kpyp8zsKrPbyquLyc8Ts0jNOnfaxsUJHWKATcnKjWYLFqVpmdrM8lJTd64lCeyNqbOWzsME9pbb3ugHVhHXPJz9DkxJNyMbO9PfuxAsjQxL5xAzNV7iV8zikyIxpsbJAoMtzrG1NG6CnZJnZNJFJ85d5fd1gLWrg74Jm8KFPzThyXA4QNo2pCTD5ftkRzI9xaEkyWNzt7nybBm2l9e2wYOqY4kA92zRtcSDcqfKGxABxr1gykpTlwaS69zdyxvbEHAPPBWRMTQWmYq05rmFY4qaupWFla5u23JSe5qzyZqR4dIRnHXb4IyJM3eQN5vVZ0DZOo+KxmEHzgdl49kSXgTp4++c7+fcz6zIkMyBbOLWHyeEIaFjSk4OySBHVwXk1La+NfStiVF5lrS6/YgmI38PHNCGz+1u0MLRP2zXX5jbT+hc4BYITaWRrK504YuG5NBT0WHoqiK3FLglOvRn8TAqTNh3FMcQeXahyuvx+6gy3y+jgA5JEuoSv/QnqTeacgfmtimghGMKpsYCExKq0hoY/4+KjuAZYfR5bHC7a9cSAlfmttfIiXx11p8PPcUyOIFd4KlSijmHeB2zYH1KOmiTTzYWZICTDW2KTzt20Ck7ncx/Ph/7bD6cLlMyfgXTupvmGbIadQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 57 22" title="" data-src="/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-032bb.png" data-srcset="/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-ec00a.png 200w,\n/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-80fd8.png 400w,\n/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-032bb.png 598w" data-sizes="(max-width: 598px) 100vw, 598px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>数字看起来就像是一个单独的单元，与文字无关。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-87f29.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 602px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 82.3920265780731%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACtklEQVQoz01TSW/TYBDt/+VXcOTAgTMIJJCgEkjlQCm0qAKablmcuIn3LbbjfUliO4n3j+c2UKRRNN9k3sx7M+MD0uxInZI6a6u02KzqPCEkf7Q2b8qkytflZl1kqxbJpOjigDT5QVslbRE2RUTI6tPzHyevfw9OKOpsfPtlxN2yg+/U8ctfjqy9fXr87c3F+fur4el42pu2ZYh+AKdtGdU5wMnolL48GtwcU2fvel9fXfSOBueH15efh1ns/Ty84W74F08+fnh2gmCXvwcXUVstUaKpYpQgJP1r2f63WXdGsizy6hJO1699AJMmdmU79QPfEe/G16tQN7SZYwqhp0aeaukcnpbBw+wFr6uzPPNIFbdVdoB5ELKU+ror2cnaUEXat2VDZUR+pIhj15bMOcPO+pp8Z2qsLEx8V6l2YVveg7vOdZz4/ib2l+E88jV0CD3NUGeaTEe+apuCZ8uuJVoG5ztyW68INBb3mjH0Jo92q6DeRpvESpeLahfsUmebOigPH1Zs/CoPt4mNeJ65WM1eM8AYnTo2Fowd+gpNXYaews36ikg7C2GhcxCiiBO0lXiKZwbTyXUczEm96mh3nYsQmm3B8hwJ2WA7V2Y0dTUZ9WyTB5JnhiJPwcEUMK3HztCMR7WNmiK+Z+jtMrfcBkiCU2y9fOPVeYi/EKnzgLRr0iaPtAEO5u7S9hYmC6pglcRm7GueLfmYtsYiglGZczZ0lcBV5sr0cWAoLA8NuW/o2p0mT02dEzgK+wQMKqBTlWhdY2RxAvIcM3AtYb9ngLE3V7Fj013orGUK0MkxffiGxqCnbQhohfOYqzOJHysSXe7CPfjhtnFk+DAck2emt2ArC0ia4LxMbQa2KIdaPDuwDBaauwsp/t12GTcFbnsJClgpppUurV3q4vkwvP+tQ5ZIjkm9+QPNTGSiV+YqMQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 57 41" title="" data-src="/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-87f29.png" data-srcset="/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-38577.png 200w,\n/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-26124.png 400w,\n/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-87f29.png 602w" data-sizes="(max-width: 602px) 100vw, 602px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>当数字和信息靠得更近时，我们就能发现数字和文字之间的关系了。</p>\n<h4 id="总结-1"><a href="#%E6%80%BB%E7%BB%93-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h4>\n<p>亲密性的使用很微妙，不过相当重要。布局的时候一定要明确元素和其所属元属是否在一起，留意无关元素。</p>\n<h3 id="案例三"><a href="#%E6%A1%88%E4%BE%8B%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>案例三</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-a3e5c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 748px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 57.486631016042786%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACCUlEQVQozz2Sa3OaQBSG+fP9kn7o9FtnmuklMVVULgpGCbjLXlhYwBoEowhyMf0hPSYzmdk5wy488LznoLRB0wVNw881qzInm3xTrR+z0BCL35b1c2Z+17C6dgZLZ7AybrXA4DWr4eFOtAAqDW8Aq2glTCFngkwQneLIDEIzSKwo1DkZr2NbpnYS6FSYXBjB3ivO/PoKpaZnYQa+inwVSyuUtmQahS/QKZHzSBgcqWv3YUk1HxQ2dhpbsTAEuOycTGlF20ddvJBI9diUYhWthx6Z+EwjaLQGYLvcRrNoPXT9sY9GXvqYRPOw9A9X7RpXJ/e4uU+KWX4WdUVOpX8kUwwpwBBgrjGuswPat7yFgJtBkk22lVc27KyIr4x+xviTm9zKXvZ92ENaf4wgC9c4VGhEoHOukRMpG//Mv1Byg8iNv7lLlfRXXJj53ir28xz8Iaf3x8Ejj2sUVOEi0Jg/xtCFQGcgletZuXrZ3Ke5BpnD9mAX+1nxKl//ydeKnp5XWzJGaOhBbFBgUxJbUlpRics+7DrWFkZeuscu7BTI3Uf9ER/IBKd2nDnPXKerwePTYOk+OPyNX94toFXxPEosmAVJ7AQcr6MCGFZNq+3q7+4py90d8IW7y5+ywssP6GXv5XAOFbYwYbh1bd4bBTD8K20XdJfocgkvveivNezfVye6TvQf24/Dd+o/twH8poaW2usAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 25 00 00 43" title="" data-src="/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-a3e5c.png" data-srcset="/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-24e67.png 200w,\n/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-f22f2.png 400w,\n/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-a3e5c.png 748w" data-sizes="(max-width: 748px) 100vw, 748px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这张明信片看起来很平淡，没有任何东西能吸引你来看一看正文，或许，除了那两颗心。但是更关键的是，需要一分钟才能找到真正重要的信息。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-f363d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 760px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.28947368421053%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB9UlEQVQoz1VSiW7aQBDN//9Aq0pBTUIhJkCwjc+1ja/1Cb4B45sE+h0dQxuKNFrtSPv2HTMPLW5b3HRWW+kl/8LNf0z5F3bN+NSAXE0UcSiQjwuP9vhnRn6V0EiEM+Kjo901uH64gq+lT9Xpd2I5IFVCkcYS+TjnntnJN0KfasKQZ37SzNMSLhnKOquD9zcwkNdGtZd3qRhvln4iRgmKd8o24oOtlEElQpSipFBzoG1xfQ/GbSalQGLODIe0HMo25gaem/bCcknbmGngAqSFXPCl9KE129a6NvURd+abjn5x8hjBO5WQJTA5RlD9ZSSCndqsbuBerdb3lVZVcuVP1nhiBdwGMouFKOJDn3YjIXQpZ82uoW3M+gbeLfc7Js+5PKN2B3QohPJAF7/988k7/S33E86zfz57pw/n+IXsweEorrV6z+bpe5YLhxKVeGzZC+zRjku5MCSPdv2lF160lHr5z+MFnL1vK6VsjKYxm16/2cR0bM41GCk/ZFev8oqQIC19poVcWBv1HXOt9rTgBMwfnbaQig/8maLIo+yAXQeMD5xw8SkHNF934z4wvSpQUSrVQSzKVQlpKZD22wpoNUIxZzrETg8WkP9WhvVo/xtVvx4NOOnTViv4OOA3sRjBzGMhyKQkEcIUxRA48OfqvrMvo73UH7uuNipSaBZmAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 25 00 01 39" title="" data-src="/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-f363d.png" data-srcset="/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-b96f0.png 200w,\n/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-f66e7.png 400w,\n/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-f363d.png 760w" data-sizes="(max-width: 760px) 100vw, 760px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>不用改变很多（不过，需要改变的还有不少，详见后面章节），只要把有关联的元素放在一起，然后在不同单元间增加合适的空间，就让信息变得更直观。</p>\n<h4 id="总结-2"><a href="#%E6%80%BB%E7%BB%93-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h4>\n<p>将类似的项归为一组来建立很近的亲密性时，有时需要做一些修改，如需要调整文本的大小或字体粗细，或者要改变图片的大小或放置位置，等等。正文（所读内容的主干部分）的字号不一定非得是 12 磅！期号和新闻简报发行年份等正文的辅助信息，可以占据相当小的位置。</p>\n<h3 id="案例四"><a href="#%E6%A1%88%E4%BE%8B%E5%9B%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>案例四</h3>\n<p>找到至少 8 个让第二个例子看起来更加专业的不同。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-e973b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.45086705202311%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACP0lEQVQoz0VSa2vbMBTN//8Jg7FP+zzKxlq6DcrokuZZx44jybItWZb1sGUrzqvpHrCbru3gIumCjs45V2fQH7rNsbXeoIwilhGexzk13vQn33TaeVNYqTstawnltjXXJS2Z37dtbwftvtmcWlGLq+Hd5fDuejz+/GPEbLH97SvDdVNc3A6v7sY394u3F1efboczHL/5cJlUrO3VwB9cd2yarZmswu+z+c10NolCaDePraoL04gv09nXyWy0it5ffrseT2Ykfvfxmip+Bnd7lysWpWSB4lkcRRQtE7QkqKhLXRe6FnZrFmmCRD7BKMrpIiXLLGkPjfVy0O6aOCcBjkOKohTFGVmlOMBrxKmyHMC7X37N6ZJi1SnjtXTS7Szosp08y05EGpA4TNA6I1ABRiHsFQNmUA73sjLDLMnKXOiiaiSY8qcnMMiO8wRoA4IiilcpCSlekjUuslfwmicLvAJHsintRru99Sf3zMytoGUGmudxBM7XLEmrXLgSpvUPzBQjjKYiBfLSlv/BwFxvDTcCMOB8ep4ZPhs7NK/M4H+6ipKC2o3SXVX35hkMCVFdhViyysg9jgMQzCEtienNKzOoZZqXtVBtpZy0vX6RvXdwdRwuoebr829NouUoCGLAP4H9g/MPECTXP7YQJ2ghF/74wgyN7Q28TSVLyjxTzO3r7qE1TuhG7P70MNFRFM5RrNsKhMCo+5++2aiBdZU0+dOXgkNYOayV5VXNC5FKlcM5ZSTjhOZYyFQadi7L4PwXBbOs5zl9/L8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 25 00 04 45" title="" data-src="/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-fee1c.png" data-srcset="/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-a67b7.png 200w,\n/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-0b187.png 400w,\n/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-fee1c.png 800w,\n/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-e973b.png 1038w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>不看正文来回答这个问题，左右图分别组织了多少场读书会？</p>\n<p>我们看一眼就能回答右边的传单上列了多少场读书会，因为每场读书会的信息都被归入有逻辑的亲密关系中（另外，活动名称现在加粗了，使用的是对比原则）。请注意，三场读书会之间的空白是相同的，显示出这三组之间有某些关系。就算文本字号小到不能阅读，你也马上就能知道有三个活动。</p>\n<p>虽然传单底部的小块文字小到无法阅读，你也知道那是什么，对不对？一定是售票信息和联系方式。你马上就知道这个单元并不是另一场活动，因为它和其他区块之间的亲密性是不同的。首先，根据理解对信息进行分组（这个工作心算完成，也可以在纸上把想法简单画出来）；你知道该怎么办。然后在页面上对文本进行实际分组。</p>\n<h4 id="总结-3"><a href="#%E6%80%BB%E7%BB%93-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h4>\n<p>亲密性原则并不是说所有一切都要更靠近，其真正的含义是：如果某些元素在理解上存在关联，或者相互之间存在某种关系，那么这些元素在视觉上也应当有关联。除此以外，其他孤立的元素或元素组则不应存在亲密性。位置是否靠近可以体现出元素之间是否存在关系。</p>\n<h3 id="总结-4"><a href="#%E6%80%BB%E7%BB%93-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<p>如果多个项相互之间存在很近的亲密性，它们将成为一个视觉单元，而不是多个孤立的元素。彼此相关的项应当归在一组。要有意识地注意你是怎样阅读的，你的视线怎样移动：从哪里开始；沿着怎样的路径；到哪里结束；读完之后，接下来看哪里？整个过程应当是一个合理的过程，有确定的开始，而且要有确定的结束。</p>\n<h4 id="根本目的"><a href="#%E6%A0%B9%E6%9C%AC%E7%9B%AE%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>根本目的</h4>\n<p>亲密性的根本目的是实现组织性。尽管其他原则也能达到这个目的，不过利用亲密性原则，只需简单地将相关的元素分在一组建立更近的亲密性，就能自动实现条理性和组织性。如果信息很有条理，将更容易阅读，也更容易被记住。此外还有一个很好的“副产品”，利用亲密性原则，还可以使空白（这是设计者们最喜欢的）更美观（也更有条理）。</p>\n<h4 id="如何实现"><a href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何实现</h4>\n<p>微微眯起眼睛，统计眼睛停顿的次数来数一数页面上有多少个元素。如果页面上的项超过 3 ～ 5 个（当然，这取决于具体情况），就要看看哪些孤立的元素可以归在一组建立更近的亲密性，使之成为一个视觉单元。</p>\n<h4 id="要避免的问题"><a href="#%E8%A6%81%E9%81%BF%E5%85%8D%E7%9A%84%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>要避免的问题</h4>\n<ul>\n<li>避免一个页面上有太多孤立的元素。</li>\n<li>不要在元素之间留出同样大小的空白，除非各组同属于一个子集。</li>\n<li>标题、子标题、图表标题、图片能否归入其相关材料？在这个问题上一定要非常清楚（哪怕只有一点含糊都要尽量避免）。在有很近亲密性的元素之间建立关系。</li>\n<li>不同属一组的元素之间不要建立关系！如果元素彼此无关，要把它们分开。</li>\n<li>不要仅仅因为有空白就把元素放在角落或中央。</li>\n</ul>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/写给大家看的设计书/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2022-05-19 11:40:02",path:"/the-non-designer-design-book/",tags:"UI, 读书笔记",title:"写给大家看的设计书",draft:null}},{excerpt:"WebGL 三维正射投影 上一篇文章概述了二维矩阵的工作原理，我们讲到了如何平移，旋转，缩放甚至从像素空间投影到裁剪空间，并且将这些操作通过一个矩阵实现，做三维只需要再迈出一小步。 二维例子中的二维点 (x, y) 与 3x3 的矩阵相乘，在三维中我们需要三维点 (x, y, z) 与 4x4 的矩阵相乘。 让我们将上个例子改成三维的，这里会继续使用 F，但是这次是三维的 ‘F’ 。 首先需要修改顶点着色器以支持三维处理，这是原顶点着色器 这是新着色器 它甚至变简单了！在二维中我们提供 x…",
html:'<h1 id="webgl-三维正射投影"><a href="#webgl-%E4%B8%89%E7%BB%B4%E6%AD%A3%E5%B0%84%E6%8A%95%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维正射投影</h1>\n<p>上一篇文章概述了二维矩阵的工作原理，我们讲到了如何平移，旋转，缩放甚至从像素空间投影到裁剪空间，并且将这些操作通过一个矩阵实现，做三维只需要再迈出一小步。</p>\n<p>二维例子中的二维点 (x, y) 与 3x3 的矩阵相乘，在三维中我们需要三维点 (x, y, z) 与 4x4 的矩阵相乘。</p>\n<p>让我们将上个例子改成三维的，这里会继续使用 F，但是这次是三维的 ‘F’ 。</p>\n<p>首先需要修改顶点着色器以支持三维处理，这是原顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2024482130304594700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   attribute vec2 a_position;\n\n   uniform mat3 u_matrix;\n\n   void main() {\n      // 将位置和矩阵相乘\n      gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n   }\n</script>`, `2024482130304594700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   attribute vec2 a_position<span class="token punctuation">;</span>\n\n   uniform mat3 u_matrix<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_matrix <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span>a_position<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是新着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39612345361437140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-3d&quot; type=&quot;x-shader/x-vertex&quot;>\n   attribute vec4 a_position;\n\n   uniform mat4 u_matrix;\n\n   void main() {\n      // 将位置和矩阵相乘\n      gl_Position = u_matrix * a_position;\n   }\n</script>`, `39612345361437140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2,4,8}"\n              >\n                <span class="gatsby-code-button-language">js{2,4,8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n<span class="gatsby-highlight-code-line">   attribute vec4 a_position<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line">   uniform mat4 u_matrix<span class="token punctuation">;</span></span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n<span class="gatsby-highlight-code-line">      gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span></span>   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它甚至变简单了！在二维中我们提供 x 和 y 并设置 z 为 1，在三维中我们将提供 x，y 和 z，然后将 w 设置为 1，而在属性中 w 的默认值就是 1，我们可以利用这点不用再次设置。</p>\n<p>然后提供三维数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81791172360330640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\n// 告诉属性怎么从 positionBuffer (ARRAY_BUFFER) 中读取位置\nvar size = 3; // 每次迭代使用 3 个单位的数据\nvar type = gl.FLOAT; // 单位数据类型是 32 位的浮点型\nvar normalize = false; // 不需要归一化数据\nvar stride = 0; // 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(positionAttributeLocation, size, type, normalize, stride, offset);\n\n// ...\n\n// 填充当前 ARRAY_BUFFER 缓冲\n// 使用组成 \'F\' 的数据填充缓冲.\nfunction setGeometry(gl) {\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([\n      // 左竖\n      0,\n      0,\n      0,\n      30,\n      0,\n      0,\n      0,\n      150,\n      0,\n      0,\n      150,\n      0,\n      30,\n      0,\n      0,\n      30,\n      150,\n      0,\n\n      // 上横\n      30,\n      0,\n      0,\n      100,\n      0,\n      0,\n      30,\n      30,\n      0,\n      30,\n      30,\n      0,\n      100,\n      0,\n      0,\n      100,\n      30,\n      0,\n\n      // 下横\n      30,\n      60,\n      0,\n      67,\n      60,\n      0,\n      30,\n      90,\n      0,\n      30,\n      90,\n      0,\n      67,\n      60,\n      0,\n      67,\n      90,\n      0\n    ]),\n    gl.STATIC_DRAW\n  );\n}`, `81791172360330640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4}"\n              >\n                <span class="gatsby-code-button-language">js{4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token comment">// 告诉属性怎么从 positionBuffer (ARRAY_BUFFER) 中读取位置</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用 3 个单位的数据</span></span><span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是 32 位的浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不需要归一化数据</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 填充当前 ARRAY_BUFFER 缓冲</span>\n<span class="token comment">// 使用组成 \'F\' 的数据填充缓冲.</span>\n<span class="token keyword">function</span> <span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n      <span class="token comment">// 左竖</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">150</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">150</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">150</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n\n      <span class="token comment">// 上横</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">100</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">100</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">100</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n\n      <span class="token comment">// 下横</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">60</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">67</span><span class="token punctuation">,</span>\n      <span class="token number">60</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">90</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">90</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">67</span><span class="token punctuation">,</span>\n      <span class="token number">60</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">67</span><span class="token punctuation">,</span>\n      <span class="token number">90</span><span class="token punctuation">,</span>\n      <span class="token number">0</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接下来把二维矩阵方法改成三维的</p>\n<p>这是二维（之前的）版本的 <code class="language-text">m3.translation</code>, <code class="language-text">m3.rotation</code>, 和 <code class="language-text">m3.scaling</code> 方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21175635825206387000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m3 = {\n  translation: function translation(tx, ty) {\n    return [1, 0, 0, 0, 1, 0, tx, ty, 1];\n  },\n\n  rotation: function rotation(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n    return [c, -s, 0, s, c, 0, 0, 0, 1];\n  },\n\n  scaling: function scaling(sx, sy) {\n    return [sx, 0, 0, 0, sy, 0, 0, 0, 1];\n  }\n};`, `21175635825206387000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m3 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">translation</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">translation</span><span class="token punctuation">(</span><span class="token parameter">tx<span class="token punctuation">,</span> ty</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">rotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">rotation</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">scaling</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">scaling</span><span class="token punctuation">(</span><span class="token parameter">sx<span class="token punctuation">,</span> sy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>sx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是升级到三维的版本。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64311352131926840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  translation: function(tx, ty, tz) {\n    return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tx, ty, tz, 1];\n  },\n\n  xRotation: function(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n\n    return [1, 0, 0, 0, 0, c, s, 0, 0, -s, c, 0, 0, 0, 0, 1];\n  },\n\n  yRotation: function(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n\n    return [c, 0, -s, 0, 0, 1, 0, 0, s, 0, c, 0, 0, 0, 0, 1];\n  },\n\n  zRotation: function(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n\n    return [c, s, 0, 0, -s, c, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n  },\n\n  scaling: function(sx, sy, sz) {\n    return [sx, 0, 0, 0, 0, sy, 0, 0, 0, 0, sz, 0, 0, 0, 0, 1];\n  }\n};`, `64311352131926840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">translation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">xRotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">yRotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">zRotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">scaling</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sx<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> sz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>sx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sz<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意到我们现在有三个旋转方法，在二维中只需要一个是因为我们只需要绕 Z 轴旋转，现在在三维中还可以绕 X 轴和 Y 轴旋转。它们看起来还是很简单，如果使用它们后你会发现和之前一样</p>\n<p>绕 Z 轴旋转</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11142926553355559000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`newX = x * c + y * s;\nnewY = x * -s + y * c;`, `11142926553355559000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">newX = x * c + y * s;\nnewY = x * -s + y * c;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>绕 Y 轴旋转</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63913617680740930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`newX = x * c + z * s;\nnewZ = x * -s + z * c;`, `63913617680740930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">newX = x * c + z * s;\nnewZ = x * -s + z * c;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>绕 X 轴旋转</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4840776096670773000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`newY = y * c + z * s;\nnewZ = y * -s + z * c;`, `4840776096670773000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">newY = y * c + z * s;\nnewZ = y * -s + z * c;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>它们提供这些旋转方式。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/bhlktz?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [axis-diagram](embedded-codesandbox://webgl-fundamental-3d/axis-diagram?view=preview) -->\n<p>同样的我们将实现一些简单的方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3311808434184260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`translate: function(m, tx, ty, tz) {\n   return m4.multiply(m, m4.translation(tx, ty, tz));\n},\n\nxRotate: function(m, angleInRadians) {\n   return m4.multiply(m, m4.xRotation(angleInRadians));\n},\n\nyRotate: function(m, angleInRadians) {\n   return m4.multiply(m, m4.yRotation(angleInRadians));\n},\n\nzRotate: function(m, angleInRadians) {\n   return m4.multiply(m, m4.zRotation(angleInRadians));\n},\n\nscale: function(m, sx, sy, sz) {\n   return m4.multiply(m, m4.scaling(sx, sy, sz));\n},`, `3311808434184260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">translate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">translation</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">xRotate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">xRotation</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">yRotate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">yRotation</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">zRotate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">zRotation</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">scale</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> sx<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> sz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">scaling</span><span class="token punctuation">(</span>sx<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> sz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们还需要更新投影方法，这是原代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72910800148733390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`projection: function (width, height) {\n   // 注意：这个矩阵翻转了 Y 轴，所以 0 在上方\n   return [\n      2 / width, 0, 0,\n      0, -2 / height, 0,\n      -1, 1, 1\n   ];\n},`, `72910800148733390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">projection</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 注意：这个矩阵翻转了 Y 轴，所以 0 在上方</span>\n   <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token number">2</span> <span class="token operator">/</span> width<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">/</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>\n   <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它将像素坐标转换到裁剪空间，在初次尝试三维时我们将这样做</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40291508628644790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`projection: function(width, height, depth) {\n   // 注意：这个矩阵翻转了 Y 轴，所以 0 在上方\n   return [\n      2 / width, 0, 0, 0,\n      0, -2 / height, 0, 0,\n      0, 0, 2 / depth, 0,\n      -1, 1, 0, 1,\n   ];\n},`, `40291508628644790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">projection</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 注意：这个矩阵翻转了 Y 轴，所以 0 在上方</span>\n   <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token number">2</span> <span class="token operator">/</span> width<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">/</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">/</span> depth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>就像 X 和 Y 需要从像素空间转换到裁剪空间一样，Z 也需要。在这个例子中我也将 Z 单位化了，我会传递一些和 width 相似的值给 depth，所以我们的空间将会是 0 到 width 像素宽，0 到 height 像素高，但是对于 depth 将会是 -depth / 2 到 +depth / 2 。</p>\n<p>最后需要更新计算矩阵的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73072601196762180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算矩阵\nvar matrix = m4.projection(gl.canvas.clientWidth, gl.canvas.clientHeight, 400);\nmatrix = m4.translate(matrix, translation[0], translation[1], translation[2]);\nmatrix = m4.xRotate(matrix, rotation[0]);\nmatrix = m4.yRotate(matrix, rotation[1]);\nmatrix = m4.zRotate(matrix, rotation[2]);\nmatrix = m4.scale(matrix, scale[0], scale[1], scale[2]);\n\n// 设置矩阵\ngl.uniformMatrix4fv(matrixLocation, false, matrix);`, `73072601196762180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 计算矩阵</span>\n<span class="token keyword">var</span> matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">xRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">zRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>matrixLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是结果</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/81z8xd?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step1](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step1?view=preview) -->\n<p>我们遇到的第一个问题是 F 在三维中过于扁平，所以很难看出三维效果。解决这个问题的方法是将它拉伸成三维几何体。现在的 F 是由三个矩形组成，每个矩形两个三角形。让它变三维需要 16 个矩形。三个矩形在正面，三个背面，一个左侧，四个右侧，两个上侧，三个底面。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-8917b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 225px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADdUlEQVQ4y12Te0xTVxzHL6L7SzNdFhfnK4ozi1gUQ3qhraXF1iuspaIwGAooKVuB1jBKi2DLQ2DAHQtUW4agtCnVVNGJraU+KCkqzAcPH5TVV0yMJvyjiYkxyu09P+GSy9jOP+d7fvn+Pud7cs7BsHkjaosYqz7qZrRGbQ5j62lpuq8ZYWvbGFFRs5itS8aC4VxLJ+NTAWBbSdO/sPTMMqy1dZTRFcbzC9j6sdaRhlqyz3tuNVF6SNs0Ibzse/59/4BmRduJZaxH/uR1eJzNORcAK1SbMadzktG/k/3hbN3051ibzfoMutPrIUAY4bZIB+17SkHXdBok53onN/sGGlb19Kxn/bEufxiWrNBg9+7CLMB0e+HM/BWGfXG845Hb3h6AHpmBeiDU0wPiXymH8GDo7+16+hFPS3mTDVBb1QlyR88H3OW3c1tObmQgALOw9o4AA8tPKfnG3PnPiN10D3p36qbGEvTosrQIOcoU9KAyFt2U70ZeohANxZfS47wS6ga/BFVaTgLuueqbO/KZs5MMzFhs3WyxPn5pr/PBdXHR1IOEMvCJipF91wGkqiGRvrEOrhcm04GDeOhmRhLySlXomiqL7vNIQN5eX/+fhLU1bqnFGnzfdfgC+OM1Uw9FBnBMN5zn56MAzwij8XpoTKuhE+r+gob0RvDnKND9bO6nW644GBzD70xTFs0l/KNpIPvEqSB0qTthUKihRvgGOJurRGrPLpTqykSk9hfo3qGlDXGXgMj1TnJlvUO7xX6okFuguagYFLLTT5cvq4tkYNq85uWWjnGw5plhNFZNDW83QEdhDiKDUlR+NSMkceqQ6FUKJTMZ6BxBEFK5ttSZPgHXIRII+p0Swa2QhOfu5kT+sJQBlpfavqyscpn3q/Mmqn8qoE2HMynyhQSMnuzQjyl9II1xgbzAAbKqFlAIrlA8vFUz/zPwt2k2sFrIbQnDBBly5kISy7P2EWW5D4s80o+GC/mhvYnDsAP3XIza8jNnZ5T3tyR+/5tE8ZW3/G3HiRk/IXQvVKZ/WsDeQwynevZhr8FIdoNFCbxTw/uUZ2BP0hCIYy62zU/CiVZ9GxlRsHJGH9j7jmmOjjyC4VvJsOhN5YwnhnN02rhJySzWRvCXiPCuQ0Scb0KEOypZEB7dEJ6WND73ewihi0nV1QzYd+uysP+Pz4/VkctcukeqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 16 13 50 21" title="" data-src="/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-8917b.png" data-srcset="/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-a6db4.png 200w,\n/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-8917b.png 225w" data-sizes="(max-width: 225px) 100vw, 225px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>需要列出的还有很多，16 个矩形每个有两个三角形，每个三角形有 3 个顶点，所以一共有 96 个顶点。如果你想看这些可以去示例的源码里找。</p>\n<p>我们需要绘制更多顶点所以</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10184273187241622000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制几何体\nvar primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 16 * 6;\ngl.drawArrays(primitiveType, offset, count);`, `10184273187241622000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4}"\n              >\n                <span class="gatsby-code-button-language">js{4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制几何体</span>\n<span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span></span>gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是对应结果</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/06sn49?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step2](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step2?view=preview) -->\n<p>拖动滑块很难看出它是三维的，让我们给矩形上不同的颜色。需要在顶点着色器中添加一个属性和一个可变量，将颜色值传到片断着色器中。</p>\n<p>这是新的顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33889627061902660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-3d&quot; type=&quot;x-shader/x-vertex&quot;>\n   attribute vec4 a_position;\n   attribute vec4 a_color;\n\n   uniform mat4 u_matrix;\n\n   varying vec4 v_color;\n\n   void main() {\n      // 将位置和矩阵相乘\n      gl_Position = u_matrix * a_position;\n\n      // 将颜色传递给片断着色器\n      v_color = a_color;\n   }\n</script>`, `33889627061902660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3,7,13-14}"\n              >\n                <span class="gatsby-code-button-language">js{3,7,13-14}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   attribute vec4 a_position<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">   attribute vec4 a_color<span class="token punctuation">;</span></span>\n   uniform mat4 u_matrix<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">   varying vec4 v_color<span class="token punctuation">;</span></span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n      gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">      <span class="token comment">// 将颜色传递给片断着色器</span></span><span class="gatsby-highlight-code-line">      v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span></span>   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在片断着色器中使用颜色</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25344323925423850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-3d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 从顶点着色器中传入\n   varying vec4 v_color;\n\n   void main() {\n      gl_FragColor = v_color;\n   }\n</script>`, `25344323925423850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4-5,8}"\n              >\n                <span class="gatsby-code-button-language">js{4-5,8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">   <span class="token comment">// 从顶点着色器中传入</span></span><span class="gatsby-highlight-code-line">   varying vec4 v_color<span class="token punctuation">;</span></span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">      gl_FragColor <span class="token operator">=</span> v_color<span class="token punctuation">;</span></span>   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们需要找到属性的位置，然后在另一个缓冲中存入对应的颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50301557310518730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\nvar colorLocation = gl.getAttribLocation(program, \'a_color\');\n\n// ...\n// 给颜色创建一个缓冲\nvar colorBuffer = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n// 将颜色值传入缓冲\nsetColors(gl);\n\n// ...\n// 向缓冲传入 \'F\' 的颜色值\nfunction setColors(gl) {\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Uint8Array([\n      // 正面左竖\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n\n      // 正面上横\n      200,\n      70,\n      120,\n      200,\n      70,\n      120\n    ]),\n    // ...\n    // ...\n    gl.STATIC_DRAW\n  );\n}`, `50301557310518730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n<span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token comment">// 给颜色创建一个缓冲</span>\n<span class="token keyword">var</span> colorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 将颜色值传入缓冲</span>\n<span class="token function">setColors</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token comment">// 向缓冲传入 \'F\' 的颜色值</span>\n<span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n      <span class="token comment">// 正面左竖</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n\n      <span class="token comment">// 正面上横</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token comment">// ...</span>\n    <span class="token comment">// ...</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在渲染时告诉颜色属性如何从缓冲中获取颜色值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51482614993834730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 启用颜色属性\ngl.enableVertexAttribArray(colorLocation);\n\n// 绑定颜色缓冲\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n\n// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值\nvar size = 3; // 每次迭代使用 3 个单位的数据\nvar type = gl.UNSIGNED_BYTE; // 单位数据类型是无符号 8 位整数\nvar normalize = true; // 标准化数据 (从 0-255 转换到 0.0-1.0)\nvar stride = 0; // 0 = 移动距离 * 单位距离长度sizeof(type)，每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);`, `51482614993834730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 启用颜色属性</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 绑定颜色缓冲</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用 3 个单位的数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是无符号 8 位整数</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 标准化数据 (从 0-255 转换到 0.0-1.0)</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们得到这个。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/ebud7i?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step3](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step3?view=preview) -->\n<p>它好像把 ‘F’ 的所有部分都按照提供的顺序显示出来了，正面，背面，侧面等等。有时候这并不是想要的结果，在背面的物体反而被绘制出来了。</p>\n<p><img src="/static/polygon-drawing-order-6f0c8bfb4a988b0b830d2a0fe618b6ad.gif"></p>\n<p>红色部分是 ‘F’ 的正面，但是因为它在数据的前部所以最先被绘制出来，然后它后面的面绘制后挡住了它。例如紫色部分实际上是 ‘F’ 的背面，由于它在数据中是第二个所以第二个被画出来。</p>\n<p>WebGL 中的三角形有正反面的概念，正面三角形的顶点顺序是逆时针方向，反面三角形是顺时针方向。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-6144b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 232px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.65517241379311%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAC5UlEQVQ4y2Ng42ZhqLkYzgACm/7XgGlZIxE3IMXJAAX8UlwwJoN99QwGJMDKKSxu0/v/PxOIoxmYzMAQ1G0JlsnZ7sMMorO3ervFzHH8D2Sqg/hyJqKMVedCwWq0glLBtG54DlitlImjo13F1D+efRtkQHyzrBZGsAKPKiNGqI1cNZfCb838n/0/dbU72NnFhwPBmvlkFMEKhNX04M4LXXp2X+7V///dOldlgfjhKy6C1TKs+F8KZhTs9Zsx+Uf6/0nf0v6XnwzeChK7838Wk322DoN751Kw2pTDn1nAjuhdX5d69Ov/tGPf/ocsOXMEJPb/P9BjUdPtwQqiZzl4d79O/N/7NulP3/vk/813o787FegpgV0ywQbsA/fuNWCLTdMbzGI23/uffOD9/6T97/7FbL7/3zy71RDudB5RLt7aS+GPQC4DGvqn503Sb5BLs7Z4F4PkG29FMZtl1sGChQnooovpJ378T9z7+nfSvje/00/++u8zdWcbzDxOYHhtnP4/63/P26TvQAN/A/FPkOGVZ0JOwLwSu+UuOCZDlpzuyTzzF+i6d99BBgLxz9QjX/6Hr7x8jQEai1HAmP3f+Tz+L8irU35l/J/8M/3/1N8Z//s/pvxPXOpiBrNZzSvG3KV16f+YLffB3s0Auiz95M//Gad+/wcZqhmQHMPgWWPM7lykLxM+2dY0bY17YNZmr5KiAwEzGm5Ebk5e7vrLp8G0A+LKjYzc4rK8QKalRV6HiXvXGn9gcinyn7lvWsji09vDV168r+4Tt4GBAJBj52WVg7IZCahlAyZ6QTCLmY1ZnoWDxYqNm9WBS4jdgIOfzZydh9WBnY/NHJRxQGp4JbgYmFhYGUzTGoBpUomblYvHko2Hz4qVm9eOnU/QAJsNIkDsAHQHCDsDsTsQq8IkGZkYQW6EuJKRURbI8oeq8wGKeDMyM4thM1QAqEAHiK1A3oWLMjEhVDDCaVEg1gWybIC0OEwaAF6MGEfnVjJKAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 18 11 30 35" title="" data-src="/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-6144b.png" data-srcset="/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-b0d34.png 200w,\n/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-6144b.png 232w" data-sizes="(max-width: 232px) 100vw, 232px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>WebGL 可以只绘制正面或反面三角形，可以这样开启</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85208966137193820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enable(gl.CULL_FACE);`, `85208966137193820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">CULL_FACE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>将它放在 drawScene 方法里，开启这个特性后 WebGL 默认“剔除”背面三角形，“剔除”在这里是“不用绘制”的花哨叫法。</p>\n<p>对于 WebGL 而言，一个三角形是顺时针还是逆时针是根据裁剪空间中的顶点顺序判断的，换句话说，WebGL 是根据你在顶点着色器中运算后提供的结果来判定的，这就意味着如果你把一个顺时针的三角形沿 X 轴缩放 -1，它将会变成逆时针，或者将顺时针的三角形旋转 180 度后变成逆时针。由于我们没有开启 CULL_FACE，所以可以同时看到顺时针（正面）和逆时针（反面）三角形。现在开启了，任何时候正面三角形无论是缩放还是旋转的原因导致翻转了，WebGL 就不会绘制它。这件事很有用，因为通常情况下你只需要看到你正面对的面。</p>\n<p>开启 CULL_FACE 后得到</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/lmtm5y?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step4](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step4?view=preview) -->\n<p>结果证明，大多数三角形朝向都是错的，旋转的时候你会看到背面的三角形，幸好它很容易解决，我们只需要看看哪些是三角形是反的，然后交换它们的两个顶点。例如一个反的三角形</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74773685833201830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  1,   2,   3,\n 40,  50,  60,\n700, 800, 900,`, `74773685833201830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">  1,   2,   3,\n 40,  50,  60,\n700, 800, 900,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>只需要交换后两个顶点的位置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52107260838052220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  1,   2,   3,\n700, 800, 900,\n 40,  50,  60,`, `52107260838052220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">  1,   2,   3,\n700, 800, 900,\n 40,  50,  60,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>通过修正朝向错误后得到</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/pfgtxt?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step5](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step5?view=preview) -->\n<p>这很接近实际效果了但是还有一个问题，即使所有三角形的朝向是正确的，然后背面的被剔除了，有些应该在背面的部分还是出现在了前面。</p>\n<p>深度缓冲有时也叫 Z-Buffer，是一个存储像素深度的矩形，一个深度像素对应一个着色像素，在绘制图像时组合使用。当 WebGL 绘制每个着色像素时也会写入深度像素，它的值基于顶点着色器返回的 Z 值，就像我们将 X 和 Y 转换到裁剪空间一样，Z 也在裁剪空间或者 (-1 到 +1)。这个值会被转换到深度空间( 0 到 +1)，WebGL 绘制一个着色像素之前会检查对应的深度像素，如果对应的深度像素中的深度值小于当前像素的深度值，WebGL 就不会绘制新的颜色。反之它会绘制片断着色器提供的新颜色并更新深度像素中的深度值。这也意味着在其他像素后面的像素不会被绘制。</p>\n<p>我们可以像这样开启这个特性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85046387170955850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enable(gl.DEPTH_TEST);`, `85046387170955850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在开始绘制前还需要清除深度缓冲为 1.0。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19057307832355574000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制场景\nfunction drawScene() {\n  // ...\n\n  // 清空画布和深度缓冲\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n  // ...\n}`, `19057307832355574000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制场景</span>\n<span class="token keyword">function</span> <span class="token function">drawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n\n  <span class="token comment">// 清空画布和深度缓冲</span>\n  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span> <span class="token operator">|</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在得到</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/ts2ymi?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step6](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step6?view=preview) -->\n<p>这才是三维！</p>\n<p>还有一件小事，在大多数三维数学库中没有负责像素空间与裁剪空间转换的 projection 方法。代替的是叫做 ortho 或 orthographic 的方法，它看起来像这样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68643324162525650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  orthographic: function(left, right, bottom, top, near, far) {\n    return [\n      2 / (right - left),\n      0,\n      0,\n      0,\n      0,\n      2 / (top - bottom),\n      0,\n      0,\n      0,\n      0,\n      2 / (near - far),\n      0,\n\n      (left + right) / (left - right),\n      (bottom + top) / (bottom - top),\n      (near + far) / (near - far),\n      1\n    ];\n  }\n};`, `68643324162525650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">orthographic</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> top<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>top <span class="token operator">-</span> bottom<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n\n      <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>left <span class="token operator">-</span> right<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span>bottom <span class="token operator">+</span> top<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bottom <span class="token operator">-</span> top<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span>near <span class="token operator">+</span> far<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">1</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>和我们简单的 projection 方法不同的是正射投影有更多的参数可以传递，左，右，上，下，近和远，给我们更灵活的选择。为了用这个方法实现之前的投影，需要这样调用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17684515500328346000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var left = 0;\nvar right = gl.canvas.clientWidth;\nvar bottom = gl.canvas.clientHeight;\nvar top = 0;\nvar near = 400;\nvar far = -400;\nm4.orthographic(left, right, bottom, top, near, far);`, `17684515500328346000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> right <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n<span class="token keyword">var</span> bottom <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token keyword">var</span> top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> near <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> far <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">400</span><span class="token punctuation">;</span>\nm4<span class="token punctuation">.</span><span class="token function">orthographic</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> top<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="webgl-三维透视投影"><a href="#webgl-%E4%B8%89%E7%BB%B4%E9%80%8F%E8%A7%86%E6%8A%95%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维透视投影</h1>\n<p>上一篇文章讲述了如何实现三维，那个三维用的不是透视投影，而是的所谓的“正射”投影，但那不是我们日常观看三维的方式。</p>\n<p>我们应使用透视投影代替它，但什么是透视投影？它的基础特性就是离得越远显得越小。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-222ff.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.38095238095239%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACjElEQVQoz5WPW0gUURzGT/RgdkMDU0vaHoIMsjAxC6yIQJIMr7nrKkllarigokEhle39Ioa2O7MzbjOmaRfR7K1eJAoXS11XYzWvac32UD3UU9Qw83Xc6C2IHn58f875853fIdefB7+b/DMy5afRPy1HGA7RnPkffphHZnHjxdQKcU2EZX2XGxV999Aa+gTb+BJckxJsgXeROZL/YnxJdb0Jw/xqNkzso8tykmE/UppOqe3TX9VrLwNqzZNB1TGxojoCK+rqsnVsUbWMztNciMx/QXFOfoBp5K1Eah4PyqSIYF3pZtU0MoOL/b1IrN6DlsmPqOy/j+bhKTgC7+EKSjSXYR+j1qMLlHnK3G9ezynO4DLM/pBEMpr1MskjIKeJqhVv4aizEiSboHrgEXbVH0IO04QCwQHDs6e46p+AcXwRlqkwLNNfYAl9/oNin/sGYzAskWjtenkNNSQFRI0v346NZbEghQSxFzQgurUgpZuw4UwUNCVxyDIcQUObGW08A8ZUA8ZaB8bWQLNe4Z2NaDfXSoR+VyZaWqglKsknWJtLEJMXhSRqnXk8GrqcONTp0+G8fA5MixUiz4Fra0VHYxk68zXoyt2GuwU7lZ5CDYTcHRIpLkqQM07EIDNri1qiS4ThZCKq0rai6/xh3L6khWAz0hIfOJ+Ih339EEQRLMfDK3aDbbHAV3EMojZZ6S5PRYd+n0Qe6FLkytQE1KfHq4NnD4Cvyob9igFedzs4QYT3jgC3243e3h4MDPTD4/GA46gly9JHBLCMB3xdkdKt2w1fcbJEuJK9sqn4IEwGvcq2WsFSG5/QCY6nFl4WLMtAEAQMDQ2Bj5x5I4Xe1VJ6v7rHdgiK72Yt+LI06Rcu/wbO8qWs0QAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 19 11 22 58" title="" data-src="/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-fee1c.png" data-srcset="/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-a67b7.png 200w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-0b187.png 400w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-fee1c.png 800w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-b1a91.png 1200w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-222ff.png 1344w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在上方的示例中，远处的物体会变小，想要实现例子中近大远小的效果，简单的做法就是将裁减空间中的 X 和 Y 值除以 Z 值。</p>\n<p>你可以这么想：如果一个线段是 (10, 15) 到 (20,15)，它长度为十个单位，在当前的代码中它就是 10 个像素长，但是如果我们将它除以 Z，且 Z 值 为 1</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82370380127620560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`10 / 1 = 10\n20 / 1 = 20\nabs(10-20) = 10`, `82370380127620560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">10 / 1 = 10\n20 / 1 = 20\nabs(10-20) = 10</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>它将是 10 个像素长，如果 Z 值为 2</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34354090082904265000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`10 / 2 = 5\n20 / 2 = 10\nabs(5 - 10) = 5`, `34354090082904265000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">10 / 2 = 5\n20 / 2 = 10\nabs(5 - 10) = 5</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>就是 5 像素了，当 Z 值为 3 时</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8910782147875107000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`10 / 3 = 3.333\n20 / 3 = 6.666\nabs(3.333 - 6.666) = 3.333`, `8910782147875107000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">10 / 3 = 3.333\n20 / 3 = 6.666\nabs(3.333 - 6.666) = 3.333</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>你可以看出随着 Z 变大距离就变远了，画的也会小一点。如果我们除以裁剪空间中的 Z，值可能会变大，因为 Z 是一个较小的值(-1 到 +1)。但是我们可以提供一个 fudgeFactor 因子和 Z 相乘，这样就可以调整缩放的程度。</p>\n<p>让我们来试试，首先修改顶点着色器，除以 Z 再乘以我们的 “fudgeFactor” 因子。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51311940389147020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-3d&quot; type=&quot;x-shader/x-vertex&quot;>\n  // ...\n  uniform float u_fudgeFactor;\n  // ...\n  void main() {\n    // 将位置和矩阵相乘\n    vec4 position = u_matrix * a_position;\n\n    // 调整除数\n    float zToDivideBy = 1.0 + position.z * u_fudgeFactor;\n\n    // x 和 y 除以调整后的除数\n    gl_Position = vec4(position.xy / zToDivideBy, position.zw);\n  }\n</script>`, `51311940389147020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3,9-10,12-13}"\n              >\n                <span class="gatsby-code-button-language">js{3,9-10,12-13}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n  <span class="token comment">// ...</span>\n<span class="gatsby-highlight-code-line">  uniform float u_fudgeFactor<span class="token punctuation">;</span></span>  <span class="token comment">// ...</span>\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 将位置和矩阵相乘</span>\n    vec4 position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">    <span class="token comment">// 调整除数</span></span><span class="gatsby-highlight-code-line">    float zToDivideBy <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">+</span> position<span class="token punctuation">.</span>z <span class="token operator">*</span> u_fudgeFactor<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line">    <span class="token comment">// x 和 y 除以调整后的除数</span></span><span class="gatsby-highlight-code-line">    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>xy <span class="token operator">/</span> zToDivideBy<span class="token punctuation">,</span> position<span class="token punctuation">.</span>zw<span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意，由于裁减空间中的 Z 值是 -1 到 +1 的，所以 +1 是为了让 zToDivideBy 变成 0 到 <code class="language-text">+2 * fudgeFactor</code></p>\n<p>还需要更新代码以设置 fudgeFactor。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30044240449257443000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\nvar fudgeLocation = gl.getUniformLocation(program, \'u_fudgeFactor\');\n\n// ...\nvar fudgeFactor = 1;\n// ...\nfunction drawScene() {\n  // ...\n  // 设置 fudgeFactor\n  gl.uniform1f(fudgeLocation, fudgeFactor);\n\n  // 绘制几何体\n  var primitiveType = gl.TRIANGLES;\n  var offset = 0;\n  var count = 16 * 6;\n  gl.drawArrays(primitiveType, offset, count);\n  // ...\n}`, `30044240449257443000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n<span class="token keyword">var</span> fudgeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_fudgeFactor\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">var</span> fudgeFactor <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">function</span> <span class="token function">drawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 设置 fudgeFactor</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>fudgeLocation<span class="token punctuation">,</span> fudgeFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 绘制几何体</span>\n  <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/pokxmd?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective?view=preview) -->\n<p>如果效果不明显，可以将 “fudgeFactor” 滑块从 1.0 拖到 0.0 来对比没添加这些代码之前的样子。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-24151.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 313px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.0223642172524%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+ElEQVQoz2P4////v/////77B6LA7K9/gDwwBwb+AQX+/oNz4OIMEAoo8PDf302fv9TffzX/Uu+ndwdAysDqIAb9+//n2bM1T54s/g+1Aqb52e/flZfvpK/ZX92+aF5k954Ox+t3KyGaITq/33t/ZXHD0TMWR45YvXq5DW4uSPO5naeX+teecq24aF1yw6f5afecXz8fw1346dK9s+GtR20KTsyOOHra9cmTrTC3gjX/e/PxamjrMY/ic81BN6/t3vj8/8WLX8HGg1RdKZh22DznlEfd6eScL2/OwK0Faf73F8R6feTKcfvS0/WxLUvmpWTvSPW69PbVL4iKX+8+XUqdfLoo7PoK+2MXNszf+PbZXYjR/xgggQkk73avOmhdetKz5pR5xczccx8+QxwOMvrn66/XK1r3tEXlN2/0Nr3cU/AQ4i5waIPd9/P9pwvhbYe9imcvC7/5ZD8itMFG/3z1+XzKlGPWJQ3uG5atOgfy9N9/0Kj69wek7u3hSyesS+cujZn2NP3L9/eIeALb//v1p/NFvdOWBU14GP7g43lEPMNV3Gtbdcg6p3u7++XP+0DG//uDLPv75Zfj7V1tW+3Pvd+Kohnq+DcfrmVNv7Z+3a//v/7/+//v/z/kdAbS//TTowsnfv//haoZqgRqCXbw7z8sFYMoAJqia9bsRhwAAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 23 11 12 31" title="" data-src="/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-24151.png" data-srcset="/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-8a062.png 200w,\n/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-24151.png 313w" data-sizes="(max-width: 313px) 100vw, 313px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>事实上 WebGL 会将我们提供给 <code class="language-text">gl_Position</code> 的 x, y, z, w 值自动除以 w 。</p>\n<p>我们可以通过修改着色器来证明，用 zToDivideBy 代替 <code class="language-text">gl_Position.w</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76945590555436600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   // ...\n   uniform float u_fudgeFactor;\n   // ...\n   void main() {\n      // 将位置和矩阵相乘\n      vec4 position = u_matrix * a_position;\n\n      // 调整除数\n      float zToDivideBy = 1.0 + position.z * u_fudgeFactor;\n\n      // 将 x y z 除以 zToDivideBy\n      gl_Position = vec4(position.xyz, zToDivideBy);\n\n      // 传递颜色到给片断着色器\n      v_color = a_color;\n   }\n</script>`, `76945590555436600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{13}"\n              >\n                <span class="gatsby-code-button-language">js{13}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   <span class="token comment">// ...</span>\n   uniform float u_fudgeFactor<span class="token punctuation">;</span>\n   <span class="token comment">// ...</span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n      vec4 position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n      <span class="token comment">// 调整除数</span>\n      float zToDivideBy <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">+</span> position<span class="token punctuation">.</span>z <span class="token operator">*</span> u_fudgeFactor<span class="token punctuation">;</span>\n\n      <span class="token comment">// 将 x y z 除以 zToDivideBy</span>\n<span class="gatsby-highlight-code-line">      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>xyz<span class="token punctuation">,</span> zToDivideBy<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n      <span class="token comment">// 传递颜色到给片断着色器</span>\n      v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看他们多像。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/1jhg42?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective-w](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective-w?view=preview) -->\n<p>为什么 WebGL 会自动除以 W ？因为使用矩阵的魔力，可以用把值从 z 传值到 w 。</p>\n<p>一个这样的矩阵</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65566317197028810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 0,`, `65566317197028810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 0,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>将会把 z 的值复制给 w，你可以把每列看作</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32425131708061540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x_out = x_in * 1 +\n        y_in * 0 +\n        z_in * 0 +\n        w_in * 0 ;\n\ny_out = x_in * 0 +\n        y_in * 1 +\n        z_in * 0 +\n        w_in * 0 ;\n\nz_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;\n\nw_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;`, `32425131708061540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x_out = x_in * 1 +\n        y_in * 0 +\n        z_in * 0 +\n        w_in * 0 ;\n\ny_out = x_in * 0 +\n        y_in * 1 +\n        z_in * 0 +\n        w_in * 0 ;\n\nz_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;\n\nw_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>简化后得到</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55196605470648844000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x_out = x_in;\ny_out = y_in;\nz_out = z_in;\nw_out = z_in;`, `55196605470648844000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x_out = x_in;\ny_out = y_in;\nz_out = z_in;\nw_out = z_in;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 w 原来就是 1.0 就会加 1</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38407322279174185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 1,`, `38407322279174185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 1,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>他会将 W 的运算变为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79977858307825070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 1 ;`, `79977858307825070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 1 ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为 w_in = 1.0 是已知的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13867070829520722000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = z_in + 1;`, `13867070829520722000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = z_in + 1;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>最后可以将 fudgeFactor 像这样放入矩阵中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48686889786754220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, fudgeFactor,\n0, 0, 0, 1,`, `48686889786754220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, fudgeFactor,\n0, 0, 0, 1,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>相当于</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29111195032621450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * fudgeFactor +\n        w_in * 1 ;`, `29111195032621450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * fudgeFactor +\n        w_in * 1 ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>简化后为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10753921256313537000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = z_in * fudgeFactor + 1;`, `10753921256313537000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = z_in * fudgeFactor + 1;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们来修改代码，使用这个矩阵。</p>\n<p>首先将顶点着色器还原，又变成简单的样子</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3834983660147562000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   uniform mat4 u_matrix;\n\n   void main() {\n      // 位置和矩阵相乘\n      gl_Position = u_matrix * a_position;\n      // ...\n   }\n</script>`, `3834983660147562000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   uniform mat4 u_matrix<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 位置和矩阵相乘</span>\n      gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n      <span class="token comment">// ...</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接下来定义一个方法实现 Z → W 的矩阵</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79826583056546960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function makeZToWMatrix(fudgeFactor) {\n  return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, fudgeFactor, 0, 0, 0, 1];\n}`, `79826583056546960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">makeZToWMatrix</span><span class="token punctuation">(</span><span class="token parameter">fudgeFactor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fudgeFactor<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后使用它。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93327986567628930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n// 计算矩阵\nvar matrix = makeZToWMatrix(fudgeFactor);\nmatrix = m4.multiply(matrix, m4.projection(gl.canvas.clientWidth, gl.canvas.clientHeight, 400));\nmatrix = m4.translate(matrix, translation[0], translation[1], translation[2]);\nmatrix = m4.xRotate(matrix, rotation[0]);\nmatrix = m4.yRotate(matrix, rotation[1]);\nmatrix = m4.zRotate(matrix, rotation[2]);\nmatrix = m4.scale(matrix, scale[0], scale[1], scale[2]);\n\n// ...`, `93327986567628930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3-4}"\n              >\n                <span class="gatsby-code-button-language">js{3-4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n<span class="token comment">// 计算矩阵</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> matrix <span class="token operator">=</span> <span class="token function">makeZToWMatrix</span><span class="token punctuation">(</span>fudgeFactor<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">xRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">zRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>和之前的很像。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/b0ky3t?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective-w-matrix](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective-w-matrix?view=preview) -->\n<p>这只是展示了除以 Z 值获可以实现透视投影，以及在 WebGL 中简单实现。</p>\n<p>但还有一些问题需要解决，比如将 Z 值设置为 -100 左右的时候会遇到下面的情形</p>\n<p><img src="/static/z-clipping-948d177dcce9ad96f72b6ddd71253aeb.gif"></p>\n<p>为什么会这样？为什么 F 提前消失了？WebGL 裁剪空间中的 X 和 Y 会被 +1 和 -1 裁剪，Z 也一样。我们看到的是 Z &#x3C; -1 的情况。</p>\n<p>我可以从数学方法深入探讨并寻找解决办法，但是你可以联想二维中的的解决方法。我们需要获取 Z 值，然后加上一些量，缩放一些量，就可以将任意范围映射到 -1 到 +1 的范围内。</p>\n<p>最有意思的是这件事可以在一个矩阵中完成，更方便的是，我们可以定义一个 fieldOfView 代替 fudgeFactor，计算出更合适的值。</p>\n<p>这是创建矩阵的方法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61143928590917980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  perspective: function(fieldOfViewInRadians, aspect, near, far) {\n    var f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewInRadians);\n    var rangeInv = 1.0 / (near - far);\n\n    return [f / aspect, 0, 0, 0, 0, f, 0, 0, 0, 0, (near + far) * rangeInv, -1, 0, 0, near * far * rangeInv * 2, 0];\n  }\n};\n\n// ...`, `61143928590917980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">perspective</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fieldOfViewInRadians<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> f <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> fieldOfViewInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> rangeInv <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>f <span class="token operator">/</span> aspect<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> f<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>near <span class="token operator">+</span> far<span class="token punctuation">)</span> <span class="token operator">*</span> rangeInv<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> near <span class="token operator">*</span> far <span class="token operator">*</span> rangeInv <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个矩阵会为我们完成所有转换。它可以调整单位以适应裁剪空间，它可以自定义视场角，选择 Z-裁剪面。假设有一个眼睛或者摄像机在原点(0, 0, 0)，根据 zNear 和 fieldOfView 可以将 zNear 对应到 Z = -1，在 zNear 平面上一半的 fieldOfView 长度对应画布中心到 Y = -1 或 Y = 1 的距离，X 的值通过乘以 aspect 获取，最后通过设置 zFar 对应 Z = 1，控制缩放的程度。</p>\n<p>这是矩阵的图解。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/5sl3lw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [frustum-diagram](embedded-codesandbox://webgl-fundamental-3d/frustum-diagram?view=preview) -->\n<p>正方体所在的有四个侧面的椎体叫做“视锥”，矩阵将视锥中的空间转换到裁剪空间中，zNear 决定了被正面切割的位置，zFar 决定被背面切割的位置。将 zNear 设置为 23 就会看到正方体正面被切割，将 zFar 设置为 24 就会看到正方体背面被切割。</p>\n<p>还有一个问题，矩阵假定观察位置为 0, 0, 0 并且看向 Z 轴负方向，Y 轴为上方向。这和我们目前为止做法不同，为了解决这个问题我们需要将物体放到视图范围内。</p>\n<p>我们在 (45, 150, 0) 绘制的 F，可以将它移动到 (-150, 0, -360)</p>\n<p>使用 m4.projection 方法代替之前的投影方法，可以调用 m4.perspective</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39724639285946384000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;\nvar zNear = 1;\nvar zFar = 2000;\nvar matrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);\nmatrix = m4.translate(matrix, translation[0], translation[1], translation[2]);\nmatrix = m4.xRotate(matrix, rotation[0]);\nmatrix = m4.yRotate(matrix, rotation[1]);\nmatrix = m4.zRotate(matrix, rotation[2]);\nmatrix = m4.scale(matrix, scale[0], scale[1], scale[2]);`, `39724639285946384000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> aspect <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token keyword">var</span> zNear <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> zFar <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">perspective</span><span class="token punctuation">(</span>fieldOfViewRadians<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> zNear<span class="token punctuation">,</span> zFar<span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">xRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">zRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果在这里。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/y9yucf?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective-matrix](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective-matrix?view=preview) -->\n<p>我们讲了矩阵乘法，视角和自定义 Z 范围。还有很多没讲完，但这篇文章已经很长了，所以接下来继续讲相机。</p>\n<blockquote>\n<p><strong>为什么将 F 移动到那么远的距离（Z = -360）?</strong></p>\n<p>在其他的例子中 F 都在 (45, 150, 0)，但在最后一个例子中它被移动到了 (-150, 0, -360)。为什么它被移动到那么远的地方？</p>\n<p>原因是在最后一个例子中用 m4.projection 方法将像素移动到裁减空间，我们的显示范围是 <code class="language-text">400 x 300</code> 像素，<code class="language-text">像素</code> 在三维中无法解释。所以新投影创建了一个视锥，它在 zNear 的距离时是 2 个单位高和 <code class="language-text">2 * aspect</code> 个单位宽。由于 <code class="language-text">F</code> 的大小是 150 个单位，在近平面的时候只能看到 2 个单位的高度，所以我们将它移到足够远的地方才能看到完整的它。</p>\n<p>同样的将 <code class="language-text">X</code> 从 45 移动到 -150。过去视图表示的范围是 0 到 400 个单位，现在它表示的 -1 到 +1 个单位。</p>\n</blockquote>\n<h1 id="webgl-三维相机"><a href="#webgl-%E4%B8%89%E7%BB%B4%E7%9B%B8%E6%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维相机</h1>\n<p>在上篇文章中我们将 F 移动到了视锥中，原因是 <code class="language-text">m4.perspective</code> 默认将相机放在了原点 <code class="language-text">(0, 0, 0)</code> 并且视锥的范围是 <code class="language-text">-zNear</code> 到 <code class="language-text">-zFar</code>。</p>\n<p>将物体移动到视场中可能并不是正确的方法，在实际生活中通常是移动相机去拍摄建筑物。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=0" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=0) -->\n<p>将物体移动到相机前面并不是常见做法。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=1" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=1) -->\n<p>但在上节中由于投影的原因物体需要在 -Z 轴上，我们通过将相机移动到原点，物体移动到相机前来保持原始的相对位置。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=2" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=2) -->\n<p>高效的将物体移动到相机前是非常重要的。最简单的方式是使用一个“逆向”矩阵，计算逆矩阵的数学原理比较复杂但概念很简单，逆就是你想通过一个值去抵消一个值。例如，123 的逆就是 -123，一个缩放为 5 的缩放矩阵的逆是缩放为 1/5 或 0.2 的缩放矩阵，一个绕 X 轴旋转 30° 的旋转矩阵的逆是绕 X 旋转 -30°。</p>\n<p>目前为止我们使用过平移，旋转和缩放去控制 ‘F’ 的位置和姿态，将这些矩阵相乘后得到一个矩阵，可以将物体从原始位置移动到期望的位置，大小和姿态。我们可以对相机进行同样的操作，一旦有了相机从原点移动旋转到目标位置的矩阵后，就可以计算出它的逆矩阵，利用这个逆矩阵可以不动相机，将物体从相反的方向移动到相机前。</p>\n<p>让我们来做一个三维场景，像上图一样有一圈 ‘F’ 。</p>\n<p>首先，由于 5 个物体使用的是同一个投影矩阵，所以我们将投影矩阵的计算放在循环外</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34988326777629710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算投影矩阵\nvar aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;\nvar zNear = 1;\nvar zFar = 2000;\nvar projectionMatrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);`, `34988326777629710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 计算投影矩阵</span>\n<span class="token keyword">var</span> aspect <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token keyword">var</span> zNear <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> zFar <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> projectionMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">perspective</span><span class="token punctuation">(</span>fieldOfViewRadians<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> zNear<span class="token punctuation">,</span> zFar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接着计算相机矩阵，这个矩阵代表的是相机在世界坐标中的位置和姿态。下方的代码计算的是看向原点，在半径为 <code class="language-text">radius * 1.5</code> 的圆上移动的相机。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=3" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=3) -->\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50877400747151810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var numFs = 5;\nvar radius = 200;\n\n// 计算相机的矩阵\nvar cameraMatrix = m4.yRotation(cameraAngleRadians);\ncameraMatrix = m4.translate(cameraMatrix, 0, 0, radius * 1.5);`, `50877400747151810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> numFs <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> radius <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 计算相机的矩阵</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotation</span><span class="token punctuation">(</span>cameraAngleRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\ncameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> radius <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后通过相机矩阵计算“视图矩阵”，视图矩阵是将所有物体以相反于相机的方向运动，尽管相机还是在原点但是相对关系是期望的。我们可以使用 inverse 方法计算逆矩阵（完全对立的转换矩阵），在这个例子中提供的是绕原点转动的矩阵，它的逆矩阵是移动相机以外的所有物体，好像相机在原点一样。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99274935469367360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 通过相机矩阵计算视图矩阵\nvar viewMatrix = m4.inverse(cameraMatrix);`, `99274935469367360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 通过相机矩阵计算视图矩阵</span>\n<span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>现在将视图矩阵和投影矩阵结合在一起</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69644472517765090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算组合矩阵\nvar viewProjectionMatrix = m4.multiply(projectionMatrix, viewMatrix);`, `69644472517765090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 计算组合矩阵</span>\n<span class="token keyword">var</span> viewProjectionMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>projectionMatrix<span class="token punctuation">,</span> viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>最后绘制一圈 F，将每个 F 乘以视图投影矩阵，然后旋转和向外平移 radius 个单位。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13209325677929495000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for (var ii = 0; ii < numFs; ++ii) {\n  var angle = (ii * Math.PI * 2) / numFs;\n  var x = Math.cos(angle) * radius;\n  var y = Math.sin(angle) * radius;\n\n  // 从视图投影矩阵开始\n  // 计算 F 的矩阵\n  var matrix = m4.translate(viewProjectionMatrix, x, 0, y);\n\n  // 设置矩阵\n  gl.uniformMatrix4fv(matrixLocation, false, matrix);\n\n  // 获得几何体\n  var primitiveType = gl.TRIANGLES;\n  var offset = 0;\n  var count = 16 * 6;\n  gl.drawArrays(primitiveType, offset, count);\n}`, `13209325677929495000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> numFs<span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> angle <span class="token operator">=</span> <span class="token punctuation">(</span>ii <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> numFs<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n\n  <span class="token comment">// 从视图投影矩阵开始</span>\n  <span class="token comment">// 计算 F 的矩阵</span>\n  <span class="token keyword">var</span> matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>viewProjectionMatrix<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置矩阵</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>matrixLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 获得几何体</span>\n  <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一个绕 F 旋转的相机。拖动 cameraAngle 滑块移动相机。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/2cxg3w?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-camera](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-camera?view=preview) -->\n<p>这样做没什么问题，但是有时利用旋转和平移去移动相机，让它到达期望的位置并看向期望的方向并不容易。例如你想让它总是看向一个特定的 F，而相机又在绕一圈 F 旋转，这时计算会变的相当复杂。</p>\n<p>幸好这有一个简单的方法，我们可以同时定义相机位置和朝向，然后矩阵就可以将相机放在那，基于矩阵这个工作就会变得非常简单。</p>\n<p>首先我们需要知道相机的期望位置，将它叫做 cameraPosition，然后需要知道看向或对准的目标位置，将它叫做 target。如果将 target 减去 cameraPosition 就会得到相机的朝向，将它叫做 zAxis。由于我们知道相机看向的是 -Z 方向，所以可以用另一种方式相减 <code class="language-text">cameraPosition - target</code>，将结果单位化后直接赋给矩阵的 z 区域。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47925222619554430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n| Zx | Zy | Zz |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+`, `47925222619554430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n| Zx | Zy | Zz |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>矩阵的这个区域代表的是 Z 轴。在这个例子中相机的 Z-axis 进行了单位化，单位化也就是一个做一个类似 1.0 的矢量，如果你回到二维旋转的文章，那里讲到的单位圆在二维旋转中用法，在三维中需要一个单位球，单位向量表示单位球上的点。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/d8lusx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=0" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [cross-product-diagram](embedded-codesandbox://webgl-fundamental-3d/cross-product-diagram?view=preview&initialpath=?mode=0) -->\n<p>这些信息还不够，只给了一个单位圆上点，如何来确定物体的姿态呢？这就需要填充矩阵的其他区域，尤其是 X 轴和 Y 轴。通常情况下我们知道它们互相垂直，如果再知道哪里是上方，在该例中是 <code class="language-text">(0, 1, 0)</code>，就可以使用“叉乘”去计算矩阵的 X 轴和 Y 轴。</p>\n<p>我不知道叉乘的数学意义是什么，但我知道将两个单位向量叉乘后可以得到一个和它们都垂直的向量。换句话说，如果你有一个向量指向东南方，一个向量指向上方，叉乘后会得到一个指向西南方或东北方的矢量，因为这两个矢量都和东南方和上方垂直，相乘的顺序不同得到结果相反。</p>\n<p>在任何情况下我们可以通过叉乘 zAxis 和 up 得到相机的 xAxis。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/d8lusx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=1" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [cross-product-diagram](embedded-codesandbox://webgl-fundamental-3d/cross-product-diagram?view=preview&initialpath=?mode=1) -->\n<p>现在我们有了 xAxis，可以叉乘 zAxis 和 xAxis 得到相机的 yAxis。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/d8lusx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=2" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [cross-product-diagram](embedded-codesandbox://webgl-fundamental-3d/cross-product-diagram?view=preview&initialpath=?mode=2) -->\n<p>现在将三个轴插入矩阵中，会给我们提供一个从 cameraPosition 指向 target 的转换，只需要再加上 position</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52559063620040016000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`+----+----+----+----+\n| Xx | Xy | Xz |  0 |  <- x axis\n+----+----+----+----+\n| Yx | Yy | Yz |  0 |  <- y axis\n+----+----+----+----+\n| Zx | Zy | Zz |  0 |  <- z axis\n+----+----+----+----+\n| Tx | Ty | Tz |  1 |  <- 相机位置\n+----+----+----+----+`, `52559063620040016000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">+----+----+----+----+\n| Xx | Xy | Xz |  0 |  &lt;- x axis\n+----+----+----+----+\n| Yx | Yy | Yz |  0 |  &lt;- y axis\n+----+----+----+----+\n| Zx | Zy | Zz |  0 |  &lt;- z axis\n+----+----+----+----+\n| Tx | Ty | Tz |  1 |  &lt;- 相机位置\n+----+----+----+----+</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是计算叉乘的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20709059454310695000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function cross(a, b) {\n  return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\n}`, `20709059454310695000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这是向量相减的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10251631759294888000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function subtractVectors(a, b) {\n  return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\n}`, `10251631759294888000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">subtractVectors</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这是单位化向量的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71963190261928370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function normalize(v) {\n  var length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\n  // 确定不会除以 0\n  if (length > 0.00001) {\n    return [v[0] / length, v[1] / length, v[2] / length];\n  } else {\n    return [0, 0, 0];\n  }\n}`, `71963190261928370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 确定不会除以 0</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0.00001</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> length<span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> length<span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> length<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是计算“朝向”矩阵的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11432164641139230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  lookAt: function(cameraPosition, target, up) {\n    var zAxis = normalize(subtractVectors(cameraPosition, target));\n    var xAxis = normalize(cross(up, zAxis));\n    var yAxis = normalize(cross(zAxis, xAxis));\n\n    return [\n      xAxis[0],\n      xAxis[1],\n      xAxis[2],\n      0,\n      yAxis[0],\n      yAxis[1],\n      yAxis[2],\n      0,\n      zAxis[0],\n      zAxis[1],\n      zAxis[2],\n      0,\n      cameraPosition[0],\n      cameraPosition[1],\n      cameraPosition[2],\n      1\n    ];\n  }\n};`, `11432164641139230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">lookAt</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cameraPosition<span class="token punctuation">,</span> target<span class="token punctuation">,</span> up</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> zAxis <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">subtractVectors</span><span class="token punctuation">(</span>cameraPosition<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> xAxis <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> zAxis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> yAxis <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>zAxis<span class="token punctuation">,</span> xAxis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      xAxis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      xAxis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      xAxis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      yAxis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      yAxis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      yAxis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      zAxis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      zAxis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      zAxis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      cameraPosition<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      cameraPosition<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      cameraPosition<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">1</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是在移动过程中朝向某个确切的 ‘F’ 的用法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31211397520566830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\n// 计算第一个 F 的位置\nvar fPosition = [radius, 0, 0];\n\n// 计算相机在圆上的位置矩阵\nvar cameraMatrix = m4.yRotation(cameraAngleRadians);\ncameraMatrix = m4.translate(cameraMatrix, 0, 0, radius * 1.5);\n\n// 获得矩阵中相机的位置\nvar cameraPosition = [cameraMatrix[12], cameraMatrix[13], cameraMatrix[14]];\n\nvar up = [0, 1, 0];\n\n// 计算相机的朝向矩阵\nvar cameraMatrix = m4.lookAt(cameraPosition, fPosition, up);\n\n// 通过相机矩阵获得视图矩阵\nvar viewMatrix = m4.inverse(cameraMatrix);\n\n// ...`, `31211397520566830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token comment">// 计算第一个 F 的位置</span>\n<span class="token keyword">var</span> fPosition <span class="token operator">=</span> <span class="token punctuation">[</span>radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 计算相机在圆上的位置矩阵</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotation</span><span class="token punctuation">(</span>cameraAngleRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\ncameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> radius <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获得矩阵中相机的位置</span>\n<span class="token keyword">var</span> cameraPosition <span class="token operator">=</span> <span class="token punctuation">[</span>cameraMatrix<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cameraMatrix<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cameraMatrix<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> up <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 计算相机的朝向矩阵</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>cameraPosition<span class="token punctuation">,</span> fPosition<span class="token punctuation">,</span> up<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 通过相机矩阵获得视图矩阵</span>\n<span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/9uxqkz?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-camera-look-at](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-camera-look-at?view=preview) -->\n<p>拖动滑块观察相机是如何追踪单个 ‘F’ 的。</p>\n<p>你也可以对其他东西使用 lookAt 方法而不只是相机。通常是让角色视线跟着某人，将炮塔指向目标，让物体沿着路径移动。你可以算出物体当前在路径上的位置和不久后的位置，然后将这两个值放入 lookAt 方法，可以让物体沿着路径移动并且朝着路径的方向。</p>\n<h2 id="lookat-标准"><a href="#lookat-%E6%A0%87%E5%87%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>lookAt 标准</h2>\n<p>大多数三维数学库都有 lookAt 方法，通常它是用于计算 <code class="language-text">视图矩阵</code> 而不是 <code class="language-text">相机矩阵</code>。换句话说这个矩阵将所有物体移动到相机前而不是将相机移动到物体前。</p>\n<p>我发现它并不好用，前面指出一个 lookAt 方法有很多用处，当你需要视图矩阵的时候只需要调用 inverse 方法，但当你想要让角色跟随另一个角色或者炮台跟随目标的时候，在我看来 lookAt 方法返回世界坐标中的朝向和位置转换会好一些。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/51gr6f?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-camera-look-at-heads](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-camera-look-at-heads?view=preview) -->',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——三维/index.md absPath of file >>> MarkdownRemark",timeToRead:16,frontmatter:{date:"2022-05-16 11:31:23",path:"/webgl-fundamental-3d/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——三维",draft:null}},{excerpt:"WebGL 图像处理 在 WebGL 中绘制图片需要使用纹理。和 WebGL 渲染时需要裁剪空间坐标相似，渲染纹理时需要纹理坐标，而不是像素坐标。无论纹理是什么尺寸，纹理坐标范围始终是 0.0 到 1.0 。 因为我们只用画一个矩形（其实是两个三角形），所以需要告诉 WebGL 矩形中每个顶点对应的纹理坐标。我们将使用一种特殊的叫做 varying 的变量将纹理坐标从顶点着色器传到片断着色器，它叫做“可变量” 是因为它的值有很多个，WebGL…",html:'<h1 id="webgl-图像处理"><a href="#webgl-%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 图像处理</h1>\n<p>在 WebGL 中绘制图片需要使用纹理。和 WebGL 渲染时需要裁剪空间坐标相似，渲染纹理时需要纹理坐标，而不是像素坐标。无论纹理是什么尺寸，纹理坐标范围始终是 0.0 到 1.0 。</p>\n<p>因为我们只用画一个矩形（其实是两个三角形），所以需要告诉 WebGL 矩形中每个顶点对应的纹理坐标。我们将使用一种特殊的叫做 varying 的变量将纹理坐标从顶点着色器传到片断着色器，它叫做“可变量” 是因为它的值有很多个，WebGL 会用顶点着色器中值的进行插值，然后传给对应像素执行的片断着色器。</p>\n<p>接着用顶点着色器，我们需要添加一个属性，用它接收纹理坐标然后传给片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27746421209119610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec2 a_texCoord;\n// ...\nvarying vec2 v_texCoord;\n\nvoid main() {\n   // ...\n   // 将纹理坐标传给片断着色器\n   // GPU 会在点之间进行插值\n   v_texCoord = a_texCoord;\n}`, `27746421209119610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_texCoord<span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec2</span> v_texCoord<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// ...</span>\n   <span class="token comment">// 将纹理坐标传给片断着色器</span>\n   <span class="token comment">// GPU 会在点之间进行插值</span>\n   v_texCoord <span class="token operator">=</span> a_texCoord<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后用片断着色器寻找纹理上对应的颜色</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37207870231000320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 纹理\n   uniform sampler2D u_image;\n\n   // 从顶点着色器传入的纹理坐标\n   varying vec2 v_texCoord;\n\n   void main() {\n      // 在纹理上寻找对应颜色值\n      gl_FragColor = texture2D(u_image, v_texCoord);\n   }\n</script>`, `37207870231000320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n   <span class="token comment">// 纹理</span>\n   uniform sampler2D u_image<span class="token punctuation">;</span>\n\n   <span class="token comment">// 从顶点着色器传入的纹理坐标</span>\n   varying vec2 v_texCoord<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 在纹理上寻找对应颜色值</span>\n      gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后我们需要加载一个图像，创建一个纹理然后将图像复制到纹理中。由于浏览器中的图片是异步加载的，所以我们需要重新组织一下代码，等待纹理加载，一旦加载完成就开始绘制。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79376224220242070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function main() {\n  var image = new Image();\n  image.src = \'http://someimage/on/our/server\'; // 必须在同一域名下\n  image.onload = function() {\n    render(image);\n  };\n}\n\nfunction render(image) {\n  // ...\n  // 之前的代码\n  // ...\n  // 找到纹理的地址\n  var texCoordLocation = gl.getAttribLocation(program, \'a_texCoord\');\n\n  // 给矩形提供纹理坐标\n  var texCoordBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]),\n    gl.STATIC_DRAW\n  );\n  gl.enableVertexAttribArray(texCoordLocation);\n  gl.vertexAttribPointer(texCoordLocation, 2, gl.FLOAT, false, 0, 0);\n\n  // 创建纹理\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  // 设置参数，让我们可以绘制任何尺寸的图像\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n  // 将图像上传到纹理\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n  // ...\n}`, `79376224220242070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'http://someimage/on/our/server\'</span><span class="token punctuation">;</span> <span class="token comment">// 必须在同一域名下</span>\n  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">render</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 之前的代码</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 找到纹理的地址</span>\n  <span class="token keyword">var</span> texCoordLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_texCoord\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 给矩形提供纹理坐标</span>\n  <span class="token keyword">var</span> texCoordBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> texCoordBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>texCoordLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>texCoordLocation<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 创建纹理</span>\n  <span class="token keyword">var</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置参数，让我们可以绘制任何尺寸的图像</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 将图像上传到纹理</span>\n  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是 WebGL 绘制的图像。注意：如果你想在本地运行，需要使用一个简单的 web 服务，使得 WebGL 可以加载本地图片。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/8f3085?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>这个图片没什么特别的，让我们来对它进行一些操作。把红和蓝调换位置如何？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44696938620978480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\ngl_FragColor = texture2D(u_image, v_texCoord).bgra;\n// ...`, `44696938620978480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// ...</span>\ngl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord<span class="token punctuation">)</span><span class="token punctuation">.</span>bgra<span class="token punctuation">;</span>\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>现在红色和蓝色调换位置了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/0gxj1r?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果我们的图像处理需要其他像素的颜色值怎么办？由于 WebGL 的纹理坐标范围是 0.0 到 1.0，那我们可以简单计算出移动一个像素对应的距离，onePixel = 1.0 / textureSize。</p>\n<p>这个片断着色器将每个像素的值设置为与左右像素的均值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53508426301322730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 纹理\n   uniform sampler2D u_image;\n   uniform vec2 u_textureSize;\n\n   // 从顶点着色器传入的像素坐标\n   varying vec2 v_texCoord;\n\n   void main() {\n      // 计算 1 像素对应的纹理坐标\n      vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\n      // 对左中右像素求均值\n      gl_FragColor = (\n         texture2D(u_image, v_texCoord) +\n         texture2D(u_image, v_texCoord + vec2(onePixel.x, 0.0)) +\n         texture2D(u_image, v_texCoord + vec2(-onePixel.x, 0.0))\n      ) / 3.0;\n   }\n</script>`, `53508426301322730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n   <span class="token comment">// 纹理</span>\n   uniform sampler2D u_image<span class="token punctuation">;</span>\n   uniform vec2 u_textureSize<span class="token punctuation">;</span>\n\n   <span class="token comment">// 从顶点着色器传入的像素坐标</span>\n   varying vec2 v_texCoord<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 计算 1 像素对应的纹理坐标</span>\n      vec2 onePixel <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> u_textureSize<span class="token punctuation">;</span>\n\n      <span class="token comment">// 对左中右像素求均值</span>\n      gl_FragColor <span class="token operator">=</span> <span class="token punctuation">(</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord<span class="token punctuation">)</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> <span class="token function">vec2</span><span class="token punctuation">(</span>onePixel<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span>onePixel<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们需要在 JavaScript 中传入纹理的大小。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12241029079222864000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\nvar textureSizeLocation = gl.getUniformLocation(program, \'u_textureSize\');\n\n// ...\n\n// 设置图像的大小\ngl.uniform2f(textureSizeLocation, image.width, image.height);\n\n// ...`, `12241029079222864000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token keyword">var</span> textureSizeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_textureSize\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 设置图像的大小</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>textureSizeLocation<span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以和上方没有模糊处理的图片对比一下。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/nrpkhw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>知道了怎么获取像素值，现在我们来做一些图片处理常用的卷积内核。在这个例子中我们将使用 3×3 的内核，卷积内核就是一个 3×3 的矩阵，矩阵中的每一项代表当前处理的像素和周围 8 个像素的乘法因子，相乘后将结果加起来除以内核权重（内核中所有值的和或 1.0，取二者中较大者），这有一个不错的<a href="https://docs.gimp.org/2.6/en/plug-in-convmatrix.html" target="_blank" rel="nofollow noreferrer noopener">相关文章</a>，这里是 C++ 实现的一些<a href="https://www.codeproject.com/KB/graphics/ImageConvolution.aspx" target="_blank" rel="nofollow noreferrer noopener">具体代码</a>。</p>\n<p>我们将在片断着色器中计算卷积，所以创建一个新的片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50568343042553760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 纹理\n   uniform sampler2D u_image;\n   uniform vec2 u_textureSize;\n   uniform float u_kernel[9];\n   uniform float u_kernelWeight;\n\n   // 从顶点着色器传入的纹理坐标\n   varying vec2 v_texCoord;\n\n   void main() {\n      vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n      vec4 colorSum =\n         texture2D(u_image, v_texCoord + onePixel * vec2(-1, -1)) * u_kernel[0] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(0, -1)) * u_kernel[1] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(1, -1)) * u_kernel[2] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(-1, 0)) * u_kernel[3] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(0, 0)) * u_kernel[4] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(1, 0)) * u_kernel[5] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(-1, 1)) * u_kernel[6] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(0, 1)) * u_kernel[7] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(1, 1)) * u_kernel[8];\n\n      // 只把 rgb 值求和除以权重\n      // 将阿尔法值设为 1.0\n      gl_FragColor = vec4((colorSum / u_kernelWeight).rgb, 1.0);\n   }\n</script>`, `50568343042553760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n   <span class="token comment">// 纹理</span>\n   uniform sampler2D u_image<span class="token punctuation">;</span>\n   uniform vec2 u_textureSize<span class="token punctuation">;</span>\n   uniform float u_kernel<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   uniform float u_kernelWeight<span class="token punctuation">;</span>\n\n   <span class="token comment">// 从顶点着色器传入的纹理坐标</span>\n   varying vec2 v_texCoord<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      vec2 onePixel <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> u_textureSize<span class="token punctuation">;</span>\n      vec4 colorSum <span class="token operator">=</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 只把 rgb 值求和除以权重</span>\n      <span class="token comment">// 将阿尔法值设为 1.0</span>\n      gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>colorSum <span class="token operator">/</span> u_kernelWeight<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 JavaScript 中我们需要提供卷积内核和它的权重</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49847735285402050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function computeKernelWeight(kernel) {\n  var weight = kernel.reduce(function(prev, curr) {\n    return prev + curr;\n  });\n  return weight <= 0 ? 1 : weight;\n}\n\n// ...\nvar kernelLocation = gl.getUniformLocation(program, \'u_kernel[0]\');\nvar kernelWeightLocation = gl.getUniformLocation(program, \'u_kernelWeight\');\n// ...\nvar edgeDetectKernel = [-1, -1, -1, -1, 8, -1, -1, -1, -1];\n\ngl.uniform1fv(kernelLocation, edgeDetectKernel);\ngl.uniform1f(kernelWeightLocation, computeKernelWeight(edgeDetectKernel));\n// ...`, `49847735285402050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">computeKernelWeight</span><span class="token punctuation">(</span><span class="token parameter">kernel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> weight <span class="token operator">=</span> kernel<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> curr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> prev <span class="token operator">+</span> curr<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> weight <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> weight<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">var</span> kernelLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_kernel[0]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> kernelWeightLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_kernelWeight\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">var</span> edgeDetectKernel <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1fv</span><span class="token punctuation">(</span>kernelLocation<span class="token punctuation">,</span> edgeDetectKernel<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>kernelWeightLocation<span class="token punctuation">,</span> <span class="token function">computeKernelWeight</span><span class="token punctuation">(</span>edgeDetectKernel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看！可以用下拉菜单选择不同的卷积内核。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/drq261?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="为什么-u_image-没有设置还能正常运行？"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-u_image-%E6%B2%A1%E6%9C%89%E8%AE%BE%E7%BD%AE%E8%BF%98%E8%83%BD%E6%AD%A3%E5%B8%B8%E8%BF%90%E8%A1%8C%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么 u_image 没有设置还能正常运行？</h2>\n<p>全局变量默认为 0 所以 <code class="language-text">u_image</code> 默认使用纹理单元 0。纹理单元 0 默认为当前活跃纹理，所以调用 bindTexture 会将纹理绑定到单元 0。</p>\n<p>WebGL 有一个纹理单元队列，每个 sampler 全局变量的值对应着一个纹理单元，它会从对应的单元寻找纹理数据，你可以将纹理设置到你想用的纹理单元。</p>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69642189440431860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var textureUnitIndex = 6; // 用单元 6\nvar u_imageLoc = gl.getUniformLocation(program, \'u_image\');\ngl.uniform1i(u_imageLoc, textureUnitIndex);`, `69642189440431860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> textureUnitIndex <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 用单元 6</span>\n<span class="token keyword">var</span> u_imageLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_image\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_imageLoc<span class="token punctuation">,</span> textureUnitIndex<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>为了将纹理设置在不同的单元你可以调用 gl.activeTexture。 例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21141631492984760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绑定纹理到单元 6\ngl.activeTexture(gl.TEXTURE6);\ngl.bindTexture(gl.TEXTURE_2D, someTexture);`, `21141631492984760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绑定纹理到单元 6</span>\ngl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> someTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这样也可以</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44353564682691310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var textureUnitIndex = 6; // 使用纹理单元 6\n// 绑定纹理到单元 6\ngl.activeTexture(gl.TEXTURE0 + textureUnitIndex);\ngl.bindTexture(gl.TEXTURE_2D, someTexture);`, `44353564682691310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> textureUnitIndex <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 使用纹理单元 6</span>\n<span class="token comment">// 绑定纹理到单元 6</span>\ngl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span> <span class="token operator">+</span> textureUnitIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> someTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所有支持 WebGL 的环境，在片断着色器中至少有 8 个纹理单元，顶点着色器中可以是 0 个。所以如果你使用超过 8 个纹理单元就应该调用 <code class="language-text">gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)</code> 查看单元个数，或者调用 <code class="language-text">gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)</code> 查看顶点着色器中可以用几个纹理单元。超过 99% 的机器在顶点着色器中至少有 4 个纹理单元。</p>\n<h2 id="在-glsl-中为什么变量的前缀都是-a_-u_-或-v_？"><a href="#%E5%9C%A8-glsl-%E4%B8%AD%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%98%E9%87%8F%E7%9A%84%E5%89%8D%E7%BC%80%E9%83%BD%E6%98%AF-a_-u_-%E6%88%96-v_%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 GLSL 中为什么变量的前缀都是 <code class="language-text">a_</code>, <code class="language-text">u_</code> 或 <code class="language-text">v_</code>？</h2>\n<p>那只是一个命名约定，不是强制要求的。但是对我来说可以轻松通过名字知道值从哪里来，<code class="language-text">a_</code> 代表属性，值从缓冲中提供；<code class="language-text">u_</code> 代表全局变量，直接对着色器设置；<code class="language-text">v_</code> 代表可变量，是从顶点着色器的顶点中插值来出来的</p>\n<h1 id="webgl-进一步处理图像"><a href="#webgl-%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%A4%84%E7%90%86%E5%9B%BE%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 进一步处理图像</h1>\n<p>图像处理的下一个问题是如何同时施加多种效果？</p>\n<p>当然，你可以试着在运行时创建着色器，根据用户从交互界面选择的一些效果，创建一个可以全部实现的着色器。尽管有人用过<a href="https://www.youtube.com/watch?v=cQUn0Zeh-0Q" target="_blank" rel="nofollow noreferrer noopener">在运行时创建渲染效果</a>，但是大部分情况下是不适合的。</p>\n<p>一个更灵活的方式是使用 2 个或以上的纹理，然后交替渲染它们，像乒乓球一样每次渲染一种效果，传给另一个渲染下一个效果，如下所示。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24139618903962014000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`原始图像    -> [模糊]     -> 纹理 1\n纹理 1      -> [锐化]     -> 纹理 2\n纹理 2      -> [边缘检测] -> 纹理 1\n纹理 1      -> [模糊]     -> 纹理 2\n纹理 2      -> [平滑]     -> 画布`, `24139618903962014000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">原始图像    -&gt; [模糊]     -&gt; 纹理 1\n纹理 1      -&gt; [锐化]     -&gt; 纹理 2\n纹理 2      -&gt; [边缘检测] -&gt; 纹理 1\n纹理 1      -&gt; [模糊]     -&gt; 纹理 2\n纹理 2      -&gt; [平滑]     -&gt; 画布</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个操作需要使用帧缓冲来实现。在 WebGL 和 OpenGL 中，帧缓冲事实上是一个糟糕的名字。WebGL/OpenGL 中的帧缓冲只是一系列状态（一列附加物）不是任何形式的缓冲。但是当我们给帧缓冲绑定一个纹理后，可以将渲染结果写入那个纹理。</p>\n<p>首先让我们把以前创建纹理的代码写到一个方法里</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50850805189350500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function createAndSetupTexture(gl) {\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  // 设置材质，这样我们可以对任意大小的图像进行像素操作\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n  return texture;\n}\n\n// 创建一个纹理并写入图像\nvar originalImageTexture = createAndSetupTexture(gl);\ngl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);`, `50850805189350500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createAndSetupTexture</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置材质，这样我们可以对任意大小的图像进行像素操作</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> texture<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 创建一个纹理并写入图像</span>\n<span class="token keyword">var</span> originalImageTexture <span class="token operator">=</span> <span class="token function">createAndSetupTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在让我们用这个方法生成两个纹理并绑定到两个帧缓冲。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35842512998593890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建两个纹理绑定到帧缓冲\nvar textures = [];\nvar framebuffers = [];\nfor (var ii = 0; ii < 2; ++ii) {\n  var texture = createAndSetupTexture(gl);\n  textures.push(texture);\n\n  // 设置纹理大小和图像大小一致\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, image.width, image.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n  // 创建一个帧缓冲\n  var fbo = gl.createFramebuffer();\n  framebuffers.push(fbo);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n\n  // 绑定纹理到帧缓冲\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n}`, `35842512998593890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建两个纹理绑定到帧缓冲</span>\n<span class="token keyword">var</span> textures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> framebuffers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> texture <span class="token operator">=</span> <span class="token function">createAndSetupTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  textures<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置纹理大小和图像大小一致</span>\n  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 创建一个帧缓冲</span>\n  <span class="token keyword">var</span> fbo <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createFramebuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  framebuffers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 绑定纹理到帧缓冲</span>\n  gl<span class="token punctuation">.</span><span class="token function">framebufferTexture2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COLOR_ATTACHMENT0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在让我们做一些卷积核并按使用顺序存入列表中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1304448879701647400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 定义一些卷积核\nvar kernels = {\n  normal: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n  gaussianBlur: [0.045, 0.122, 0.045, 0.122, 0.332, 0.122, 0.045, 0.122, 0.045],\n  unsharpen: [-1, -1, -1, -1, 9, -1, -1, -1, -1],\n  emboss: [-2, -1, 0, -1, 1, 1, 0, 1, 2]\n};\n\n// 将要使用的效果列表\nvar effectsToApply = [\'gaussianBlur\', \'emboss\', \'gaussianBlur\', \'unsharpen\'];`, `1304448879701647400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 定义一些卷积核</span>\n<span class="token keyword">var</span> kernels <span class="token operator">=</span> <span class="token punctuation">{</span>\n  normal<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  gaussianBlur<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.045</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.045</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.332</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.045</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.045</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  unsharpen<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  emboss<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 将要使用的效果列表</span>\n<span class="token keyword">var</span> effectsToApply <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'gaussianBlur\'</span><span class="token punctuation">,</span> <span class="token string">\'emboss\'</span><span class="token punctuation">,</span> <span class="token string">\'gaussianBlur\'</span><span class="token punctuation">,</span> <span class="token string">\'unsharpen\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后让我们使用所有渲染效果，像乒乓一样来回渲染</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3033514399942860300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 从原始图像开始\ngl.bindTexture(gl.TEXTURE_2D, originalImageTexture);\n\n// 在渲染效果时不翻转 y 轴\ngl.uniform1f(flipYLocation, 1);\n\n// 循环施加每一种渲染效果\nfor (var ii = 0; ii < effectsToApply.length; ++ii) {\n  // 使用两个帧缓冲中的一个\n  setFramebuffer(framebuffers[ii % 2], image.width, image.height);\n\n  drawWithKernel(effectsToApply[ii]);\n\n  // 下次绘制时使用刚才的渲染结果\n  gl.bindTexture(gl.TEXTURE_2D, textures[ii % 2]);\n}\n\n// 最后将结果绘制到画布\ngl.uniform1f(flipYLocation, -1); // 需要绕 y 轴翻转\nsetFramebuffer(null, canvas.width, canvas.height);\ndrawWithKernel(\'normal\');\n\nfunction setFramebuffer(fbo, width, height) {\n  // 设定当前使用帧缓冲\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n\n  // 告诉着色器分辨率是多少\n  gl.uniform2f(resolutionLocation, width, height);\n\n  // 告诉 WebGL 帧缓冲需要的视图大小\n  gl.viewport(0, 0, width, height);\n}\n\nfunction drawWithKernel(name) {\n  // 设置卷积核\n  gl.uniform1fv(kernelLocation, kernels[name]);\n\n  // 画出矩形\n  gl.drawArrays(gl.TRIANGLES, 0, 6);\n}`, `3033514399942860300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 从原始图像开始</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> originalImageTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在渲染效果时不翻转 y 轴</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 循环施加每一种渲染效果</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> effectsToApply<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 使用两个帧缓冲中的一个</span>\n  <span class="token function">setFramebuffer</span><span class="token punctuation">(</span>framebuffers<span class="token punctuation">[</span>ii <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token function">drawWithKernel</span><span class="token punctuation">(</span>effectsToApply<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 下次绘制时使用刚才的渲染结果</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> textures<span class="token punctuation">[</span>ii <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 最后将结果绘制到画布</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 需要绕 y 轴翻转</span>\n<span class="token function">setFramebuffer</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">drawWithKernel</span><span class="token punctuation">(</span><span class="token string">\'normal\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">setFramebuffer</span><span class="token punctuation">(</span><span class="token parameter">fbo<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 设定当前使用帧缓冲</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 告诉着色器分辨率是多少</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionLocation<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 告诉 WebGL 帧缓冲需要的视图大小</span>\n  gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">drawWithKernel</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 设置卷积核</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniform1fv</span><span class="token punctuation">(</span>kernelLocation<span class="token punctuation">,</span> kernels<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 画出矩形</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面是一个可交互示例，用了稍微灵活一点的用户交互。勾选表示开启对应效果，拖拽改变渲染顺序。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/1f3ywc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>有些东西需要回顾一下。</p>\n<p>调用 gl.bindFramebuffer 设置为 null 是告诉 WebGL 你想在画布上绘制，而不是在帧缓冲上。</p>\n<p>WebGL 需要从裁剪空间对应到屏幕像素，设置 gl.viewport 就是为了实现这个。因为我们的帧缓冲的大小和画布的大小不同，所以我们需要给帧缓冲设置一个合适的视图大小让它渲染到对应的纹理上，最后再渲染到画布上。</p>\n<p>原例中，我们在渲染时绕 y 轴翻转是因为 WebGL 的 0, 0 点在左下角而不是常见二维屏幕坐标的左上角。而在帧缓冲中绘制的时候不需要翻转，因为帧缓冲不用显示，谁上谁下无所谓，最重要的是我们计算中的 0, 0 也对应帧缓冲中的 0, 0 像素。为了解决这个问题，通过在着色器中添加一个输入来决定是否翻转。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85427668439947180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   // ...\n   uniform float u_flipY;\n   // ...\n\n   void main() {\n      // ...\n\n      gl_Position = vec4(clipSpace * vec2(1, u_flipY), 0, 1);\n\n      // ...\n   }\n</script>`, `85427668439947180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   <span class="token comment">// ...</span>\n   uniform float u_flipY<span class="token punctuation">;</span>\n   <span class="token comment">// ...</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...</span>\n\n      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> u_flipY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// ...</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在渲染的时候可以这样设置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47890027256641330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\nvar flipYLocation = gl.getUniformLocation(program, \'u_flipY\');\n\n// ...\n\n// 不翻转\ngl.uniform1f(flipYLocation, 1);\n\n// ...\n\n// 翻转\ngl.uniform1f(flipYLocation, -1);`, `47890027256641330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token keyword">var</span> flipYLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_flipY\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 不翻转</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 翻转</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为了让这个例子简单化，我只用了一个 GLSL 实现了多种渲染效果。如果专做图像处理可能需要多个 GLSL 程序，一个调节色彩、饱和度和明度，一个调节亮度和对比度，一个做反色，一个做色彩平衡，等等。你需要用代码更换 GLSL 程序，并更新程序对应的参数。我想过写一个类似的例子，但最好留给读者自己实现，因为多个 GLSL 程序和参数需要良好的重构，不然代码会一团糟，所以它是一个很好的练习机会。</p>\n<p>希望这个和之前的例子让你更了解 WebGL，从二维开始讲解是希望你更有利于对 WebGL 的理解。如果有时间我会试着写一些关于如何实现三维效果的文章，讲一些一些关于 WebGL 的底层原理和细节。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——图像处理/index.md absPath of file >>> MarkdownRemark",timeToRead:8,frontmatter:{date:"2022-04-29 11:05:21",path:"/webgl-fundamental-image-processing/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——图像处理",draft:null}}],page:5,pagesSum:45,length:224,prevPath:"/page/4",nextPath:"/page/6"}}}});